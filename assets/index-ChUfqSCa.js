(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const O of document.querySelectorAll('link[rel="modulepreload"]'))D(O);new MutationObserver(O=>{for(const F of O)if(F.type==="childList")for(const X of F.addedNodes)X.tagName==="LINK"&&X.rel==="modulepreload"&&D(X)}).observe(document,{childList:!0,subtree:!0});function S(O){const F={};return O.integrity&&(F.integrity=O.integrity),O.referrerPolicy&&(F.referrerPolicy=O.referrerPolicy),O.crossOrigin==="use-credentials"?F.credentials="include":O.crossOrigin==="anonymous"?F.credentials="omit":F.credentials="same-origin",F}function D(O){if(O.ep)return;O.ep=!0;const F=S(O);fetch(O.href,F)}})();function y1(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var Ix={exports:{}},Bg={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u2;function wM(){if(u2)return Bg;u2=1;var m=Symbol.for("react.transitional.element"),v=Symbol.for("react.fragment");function S(D,O,F){var X=null;if(F!==void 0&&(X=""+F),O.key!==void 0&&(X=""+O.key),"key"in O){F={};for(var r in O)r!=="key"&&(F[r]=O[r])}else F=O;return O=F.ref,{$$typeof:m,type:D,key:X,ref:O!==void 0?O:null,props:F}}return Bg.Fragment=v,Bg.jsx=S,Bg.jsxs=S,Bg}var h2;function TM(){return h2||(h2=1,Ix.exports=wM()),Ix.exports}var _e=TM(),Rx={exports:{}},$n={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d2;function SM(){if(d2)return $n;d2=1;var m=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),F=Symbol.for("react.consumer"),X=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),re=Symbol.for("react.suspense"),J=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),ze=Symbol.iterator;function je(We){return We===null||typeof We!="object"?null:(We=ze&&We[ze]||We["@@iterator"],typeof We=="function"?We:null)}var ft={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Le=Object.assign,Fe={};function qe(We,Jt,Ei){this.props=We,this.context=Jt,this.refs=Fe,this.updater=Ei||ft}qe.prototype.isReactComponent={},qe.prototype.setState=function(We,Jt){if(typeof We!="object"&&typeof We!="function"&&We!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,We,Jt,"setState")},qe.prototype.forceUpdate=function(We){this.updater.enqueueForceUpdate(this,We,"forceUpdate")};function He(){}He.prototype=qe.prototype;function tt(We,Jt,Ei){this.props=We,this.context=Jt,this.refs=Fe,this.updater=Ei||ft}var mt=tt.prototype=new He;mt.constructor=tt,Le(mt,qe.prototype),mt.isPureReactComponent=!0;var Tt=Array.isArray,kt={H:null,A:null,T:null,S:null,V:null},At=Object.prototype.hasOwnProperty;function ot(We,Jt,Ei,Ot,ji,An){return Ei=An.ref,{$$typeof:m,type:We,key:Jt,ref:Ei!==void 0?Ei:null,props:An}}function hi(We,Jt){return ot(We.type,Jt,void 0,void 0,void 0,We.props)}function Mi(We){return typeof We=="object"&&We!==null&&We.$$typeof===m}function ti(We){var Jt={"=":"=0",":":"=2"};return"$"+We.replace(/[=:]/g,function(Ei){return Jt[Ei]})}var Rt=/\/+/g;function ui(We,Jt){return typeof We=="object"&&We!==null&&We.key!=null?ti(""+We.key):Jt.toString(36)}function Si(){}function di(We){switch(We.status){case"fulfilled":return We.value;case"rejected":throw We.reason;default:switch(typeof We.status=="string"?We.then(Si,Si):(We.status="pending",We.then(function(Jt){We.status==="pending"&&(We.status="fulfilled",We.value=Jt)},function(Jt){We.status==="pending"&&(We.status="rejected",We.reason=Jt)})),We.status){case"fulfilled":return We.value;case"rejected":throw We.reason}}throw We}function ii(We,Jt,Ei,Ot,ji){var An=typeof We;(An==="undefined"||An==="boolean")&&(We=null);var Xi=!1;if(We===null)Xi=!0;else switch(An){case"bigint":case"string":case"number":Xi=!0;break;case"object":switch(We.$$typeof){case m:case v:Xi=!0;break;case oe:return Xi=We._init,ii(Xi(We._payload),Jt,Ei,Ot,ji)}}if(Xi)return ji=ji(We),Xi=Ot===""?"."+ui(We,0):Ot,Tt(ji)?(Ei="",Xi!=null&&(Ei=Xi.replace(Rt,"$&/")+"/"),ii(ji,Jt,Ei,"",function(Aa){return Aa})):ji!=null&&(Mi(ji)&&(ji=hi(ji,Ei+(ji.key==null||We&&We.key===ji.key?"":(""+ji.key).replace(Rt,"$&/")+"/")+Xi)),Jt.push(ji)),1;Xi=0;var nr=Ot===""?".":Ot+":";if(Tt(We))for(var sr=0;sr<We.length;sr++)Ot=We[sr],An=nr+ui(Ot,sr),Xi+=ii(Ot,Jt,Ei,An,ji);else if(sr=je(We),typeof sr=="function")for(We=sr.call(We),sr=0;!(Ot=We.next()).done;)Ot=Ot.value,An=nr+ui(Ot,sr++),Xi+=ii(Ot,Jt,Ei,An,ji);else if(An==="object"){if(typeof We.then=="function")return ii(di(We),Jt,Ei,Ot,ji);throw Jt=String(We),Error("Objects are not valid as a React child (found: "+(Jt==="[object Object]"?"object with keys {"+Object.keys(We).join(", ")+"}":Jt)+"). If you meant to render a collection of children, use an array instead.")}return Xi}function pt(We,Jt,Ei){if(We==null)return We;var Ot=[],ji=0;return ii(We,Ot,"","",function(An){return Jt.call(Ei,An,ji++)}),Ot}function ni(We){if(We._status===-1){var Jt=We._result;Jt=Jt(),Jt.then(function(Ei){(We._status===0||We._status===-1)&&(We._status=1,We._result=Ei)},function(Ei){(We._status===0||We._status===-1)&&(We._status=2,We._result=Ei)}),We._status===-1&&(We._status=0,We._result=Jt)}if(We._status===1)return We._result.default;throw We._result}var pi=typeof reportError=="function"?reportError:function(We){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Jt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof We=="object"&&We!==null&&typeof We.message=="string"?String(We.message):String(We),error:We});if(!window.dispatchEvent(Jt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",We);return}console.error(We)};function ai(){}return $n.Children={map:pt,forEach:function(We,Jt,Ei){pt(We,function(){Jt.apply(this,arguments)},Ei)},count:function(We){var Jt=0;return pt(We,function(){Jt++}),Jt},toArray:function(We){return pt(We,function(Jt){return Jt})||[]},only:function(We){if(!Mi(We))throw Error("React.Children.only expected to receive a single React element child.");return We}},$n.Component=qe,$n.Fragment=S,$n.Profiler=O,$n.PureComponent=tt,$n.StrictMode=D,$n.Suspense=re,$n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=kt,$n.__COMPILER_RUNTIME={__proto__:null,c:function(We){return kt.H.useMemoCache(We)}},$n.cache=function(We){return function(){return We.apply(null,arguments)}},$n.cloneElement=function(We,Jt,Ei){if(We==null)throw Error("The argument must be a React element, but you passed "+We+".");var Ot=Le({},We.props),ji=We.key,An=void 0;if(Jt!=null)for(Xi in Jt.ref!==void 0&&(An=void 0),Jt.key!==void 0&&(ji=""+Jt.key),Jt)!At.call(Jt,Xi)||Xi==="key"||Xi==="__self"||Xi==="__source"||Xi==="ref"&&Jt.ref===void 0||(Ot[Xi]=Jt[Xi]);var Xi=arguments.length-2;if(Xi===1)Ot.children=Ei;else if(1<Xi){for(var nr=Array(Xi),sr=0;sr<Xi;sr++)nr[sr]=arguments[sr+2];Ot.children=nr}return ot(We.type,ji,void 0,void 0,An,Ot)},$n.createContext=function(We){return We={$$typeof:X,_currentValue:We,_currentValue2:We,_threadCount:0,Provider:null,Consumer:null},We.Provider=We,We.Consumer={$$typeof:F,_context:We},We},$n.createElement=function(We,Jt,Ei){var Ot,ji={},An=null;if(Jt!=null)for(Ot in Jt.key!==void 0&&(An=""+Jt.key),Jt)At.call(Jt,Ot)&&Ot!=="key"&&Ot!=="__self"&&Ot!=="__source"&&(ji[Ot]=Jt[Ot]);var Xi=arguments.length-2;if(Xi===1)ji.children=Ei;else if(1<Xi){for(var nr=Array(Xi),sr=0;sr<Xi;sr++)nr[sr]=arguments[sr+2];ji.children=nr}if(We&&We.defaultProps)for(Ot in Xi=We.defaultProps,Xi)ji[Ot]===void 0&&(ji[Ot]=Xi[Ot]);return ot(We,An,void 0,void 0,null,ji)},$n.createRef=function(){return{current:null}},$n.forwardRef=function(We){return{$$typeof:r,render:We}},$n.isValidElement=Mi,$n.lazy=function(We){return{$$typeof:oe,_payload:{_status:-1,_result:We},_init:ni}},$n.memo=function(We,Jt){return{$$typeof:J,type:We,compare:Jt===void 0?null:Jt}},$n.startTransition=function(We){var Jt=kt.T,Ei={};kt.T=Ei;try{var Ot=We(),ji=kt.S;ji!==null&&ji(Ei,Ot),typeof Ot=="object"&&Ot!==null&&typeof Ot.then=="function"&&Ot.then(ai,pi)}catch(An){pi(An)}finally{kt.T=Jt}},$n.unstable_useCacheRefresh=function(){return kt.H.useCacheRefresh()},$n.use=function(We){return kt.H.use(We)},$n.useActionState=function(We,Jt,Ei){return kt.H.useActionState(We,Jt,Ei)},$n.useCallback=function(We,Jt){return kt.H.useCallback(We,Jt)},$n.useContext=function(We){return kt.H.useContext(We)},$n.useDebugValue=function(){},$n.useDeferredValue=function(We,Jt){return kt.H.useDeferredValue(We,Jt)},$n.useEffect=function(We,Jt,Ei){var Ot=kt.H;if(typeof Ei=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ot.useEffect(We,Jt)},$n.useId=function(){return kt.H.useId()},$n.useImperativeHandle=function(We,Jt,Ei){return kt.H.useImperativeHandle(We,Jt,Ei)},$n.useInsertionEffect=function(We,Jt){return kt.H.useInsertionEffect(We,Jt)},$n.useLayoutEffect=function(We,Jt){return kt.H.useLayoutEffect(We,Jt)},$n.useMemo=function(We,Jt){return kt.H.useMemo(We,Jt)},$n.useOptimistic=function(We,Jt){return kt.H.useOptimistic(We,Jt)},$n.useReducer=function(We,Jt,Ei){return kt.H.useReducer(We,Jt,Ei)},$n.useRef=function(We){return kt.H.useRef(We)},$n.useState=function(We){return kt.H.useState(We)},$n.useSyncExternalStore=function(We,Jt,Ei){return kt.H.useSyncExternalStore(We,Jt,Ei)},$n.useTransition=function(){return kt.H.useTransition()},$n.version="19.1.0",$n}var f2;function v1(){return f2||(f2=1,Rx.exports=SM()),Rx.exports}var Ie=v1();const Zi=y1(Ie);var Dx={exports:{}},Ng={},zx={exports:{}},Lx={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p2;function EM(){return p2||(p2=1,function(m){function v(pt,ni){var pi=pt.length;pt.push(ni);e:for(;0<pi;){var ai=pi-1>>>1,We=pt[ai];if(0<O(We,ni))pt[ai]=ni,pt[pi]=We,pi=ai;else break e}}function S(pt){return pt.length===0?null:pt[0]}function D(pt){if(pt.length===0)return null;var ni=pt[0],pi=pt.pop();if(pi!==ni){pt[0]=pi;e:for(var ai=0,We=pt.length,Jt=We>>>1;ai<Jt;){var Ei=2*(ai+1)-1,Ot=pt[Ei],ji=Ei+1,An=pt[ji];if(0>O(Ot,pi))ji<We&&0>O(An,Ot)?(pt[ai]=An,pt[ji]=pi,ai=ji):(pt[ai]=Ot,pt[Ei]=pi,ai=Ei);else if(ji<We&&0>O(An,pi))pt[ai]=An,pt[ji]=pi,ai=ji;else break e}}return ni}function O(pt,ni){var pi=pt.sortIndex-ni.sortIndex;return pi!==0?pi:pt.id-ni.id}if(m.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var F=performance;m.unstable_now=function(){return F.now()}}else{var X=Date,r=X.now();m.unstable_now=function(){return X.now()-r}}var re=[],J=[],oe=1,ze=null,je=3,ft=!1,Le=!1,Fe=!1,qe=!1,He=typeof setTimeout=="function"?setTimeout:null,tt=typeof clearTimeout=="function"?clearTimeout:null,mt=typeof setImmediate<"u"?setImmediate:null;function Tt(pt){for(var ni=S(J);ni!==null;){if(ni.callback===null)D(J);else if(ni.startTime<=pt)D(J),ni.sortIndex=ni.expirationTime,v(re,ni);else break;ni=S(J)}}function kt(pt){if(Fe=!1,Tt(pt),!Le)if(S(re)!==null)Le=!0,At||(At=!0,ui());else{var ni=S(J);ni!==null&&ii(kt,ni.startTime-pt)}}var At=!1,ot=-1,hi=5,Mi=-1;function ti(){return qe?!0:!(m.unstable_now()-Mi<hi)}function Rt(){if(qe=!1,At){var pt=m.unstable_now();Mi=pt;var ni=!0;try{e:{Le=!1,Fe&&(Fe=!1,tt(ot),ot=-1),ft=!0;var pi=je;try{t:{for(Tt(pt),ze=S(re);ze!==null&&!(ze.expirationTime>pt&&ti());){var ai=ze.callback;if(typeof ai=="function"){ze.callback=null,je=ze.priorityLevel;var We=ai(ze.expirationTime<=pt);if(pt=m.unstable_now(),typeof We=="function"){ze.callback=We,Tt(pt),ni=!0;break t}ze===S(re)&&D(re),Tt(pt)}else D(re);ze=S(re)}if(ze!==null)ni=!0;else{var Jt=S(J);Jt!==null&&ii(kt,Jt.startTime-pt),ni=!1}}break e}finally{ze=null,je=pi,ft=!1}ni=void 0}}finally{ni?ui():At=!1}}}var ui;if(typeof mt=="function")ui=function(){mt(Rt)};else if(typeof MessageChannel<"u"){var Si=new MessageChannel,di=Si.port2;Si.port1.onmessage=Rt,ui=function(){di.postMessage(null)}}else ui=function(){He(Rt,0)};function ii(pt,ni){ot=He(function(){pt(m.unstable_now())},ni)}m.unstable_IdlePriority=5,m.unstable_ImmediatePriority=1,m.unstable_LowPriority=4,m.unstable_NormalPriority=3,m.unstable_Profiling=null,m.unstable_UserBlockingPriority=2,m.unstable_cancelCallback=function(pt){pt.callback=null},m.unstable_forceFrameRate=function(pt){0>pt||125<pt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):hi=0<pt?Math.floor(1e3/pt):5},m.unstable_getCurrentPriorityLevel=function(){return je},m.unstable_next=function(pt){switch(je){case 1:case 2:case 3:var ni=3;break;default:ni=je}var pi=je;je=ni;try{return pt()}finally{je=pi}},m.unstable_requestPaint=function(){qe=!0},m.unstable_runWithPriority=function(pt,ni){switch(pt){case 1:case 2:case 3:case 4:case 5:break;default:pt=3}var pi=je;je=pt;try{return ni()}finally{je=pi}},m.unstable_scheduleCallback=function(pt,ni,pi){var ai=m.unstable_now();switch(typeof pi=="object"&&pi!==null?(pi=pi.delay,pi=typeof pi=="number"&&0<pi?ai+pi:ai):pi=ai,pt){case 1:var We=-1;break;case 2:We=250;break;case 5:We=1073741823;break;case 4:We=1e4;break;default:We=5e3}return We=pi+We,pt={id:oe++,callback:ni,priorityLevel:pt,startTime:pi,expirationTime:We,sortIndex:-1},pi>ai?(pt.sortIndex=pi,v(J,pt),S(re)===null&&pt===S(J)&&(Fe?(tt(ot),ot=-1):Fe=!0,ii(kt,pi-ai))):(pt.sortIndex=We,v(re,pt),Le||ft||(Le=!0,At||(At=!0,ui()))),pt},m.unstable_shouldYield=ti,m.unstable_wrapCallback=function(pt){var ni=je;return function(){var pi=je;je=ni;try{return pt.apply(this,arguments)}finally{je=pi}}}}(Lx)),Lx}var m2;function AM(){return m2||(m2=1,zx.exports=EM()),zx.exports}var Ox={exports:{}},no={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _2;function MM(){if(_2)return no;_2=1;var m=v1();function v(re){var J="https://react.dev/errors/"+re;if(1<arguments.length){J+="?args[]="+encodeURIComponent(arguments[1]);for(var oe=2;oe<arguments.length;oe++)J+="&args[]="+encodeURIComponent(arguments[oe])}return"Minified React error #"+re+"; visit "+J+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function S(){}var D={d:{f:S,r:function(){throw Error(v(522))},D:S,C:S,L:S,m:S,X:S,S,M:S},p:0,findDOMNode:null},O=Symbol.for("react.portal");function F(re,J,oe){var ze=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O,key:ze==null?null:""+ze,children:re,containerInfo:J,implementation:oe}}var X=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(re,J){if(re==="font")return"";if(typeof J=="string")return J==="use-credentials"?J:""}return no.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,no.createPortal=function(re,J){var oe=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!J||J.nodeType!==1&&J.nodeType!==9&&J.nodeType!==11)throw Error(v(299));return F(re,J,null,oe)},no.flushSync=function(re){var J=X.T,oe=D.p;try{if(X.T=null,D.p=2,re)return re()}finally{X.T=J,D.p=oe,D.d.f()}},no.preconnect=function(re,J){typeof re=="string"&&(J?(J=J.crossOrigin,J=typeof J=="string"?J==="use-credentials"?J:"":void 0):J=null,D.d.C(re,J))},no.prefetchDNS=function(re){typeof re=="string"&&D.d.D(re)},no.preinit=function(re,J){if(typeof re=="string"&&J&&typeof J.as=="string"){var oe=J.as,ze=r(oe,J.crossOrigin),je=typeof J.integrity=="string"?J.integrity:void 0,ft=typeof J.fetchPriority=="string"?J.fetchPriority:void 0;oe==="style"?D.d.S(re,typeof J.precedence=="string"?J.precedence:void 0,{crossOrigin:ze,integrity:je,fetchPriority:ft}):oe==="script"&&D.d.X(re,{crossOrigin:ze,integrity:je,fetchPriority:ft,nonce:typeof J.nonce=="string"?J.nonce:void 0})}},no.preinitModule=function(re,J){if(typeof re=="string")if(typeof J=="object"&&J!==null){if(J.as==null||J.as==="script"){var oe=r(J.as,J.crossOrigin);D.d.M(re,{crossOrigin:oe,integrity:typeof J.integrity=="string"?J.integrity:void 0,nonce:typeof J.nonce=="string"?J.nonce:void 0})}}else J==null&&D.d.M(re)},no.preload=function(re,J){if(typeof re=="string"&&typeof J=="object"&&J!==null&&typeof J.as=="string"){var oe=J.as,ze=r(oe,J.crossOrigin);D.d.L(re,oe,{crossOrigin:ze,integrity:typeof J.integrity=="string"?J.integrity:void 0,nonce:typeof J.nonce=="string"?J.nonce:void 0,type:typeof J.type=="string"?J.type:void 0,fetchPriority:typeof J.fetchPriority=="string"?J.fetchPriority:void 0,referrerPolicy:typeof J.referrerPolicy=="string"?J.referrerPolicy:void 0,imageSrcSet:typeof J.imageSrcSet=="string"?J.imageSrcSet:void 0,imageSizes:typeof J.imageSizes=="string"?J.imageSizes:void 0,media:typeof J.media=="string"?J.media:void 0})}},no.preloadModule=function(re,J){if(typeof re=="string")if(J){var oe=r(J.as,J.crossOrigin);D.d.m(re,{as:typeof J.as=="string"&&J.as!=="script"?J.as:void 0,crossOrigin:oe,integrity:typeof J.integrity=="string"?J.integrity:void 0})}else D.d.m(re)},no.requestFormReset=function(re){D.d.r(re)},no.unstable_batchedUpdates=function(re,J){return re(J)},no.useFormState=function(re,J,oe){return X.H.useFormState(re,J,oe)},no.useFormStatus=function(){return X.H.useHostTransitionStatus()},no.version="19.1.0",no}var g2;function gT(){if(g2)return Ox.exports;g2=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(v){console.error(v)}}return m(),Ox.exports=MM(),Ox.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y2;function CM(){if(y2)return Ng;y2=1;var m=AM(),v=v1(),S=gT();function D(o){var f="https://react.dev/errors/"+o;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)f+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+o+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function O(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function F(o){var f=o,x=o;if(o.alternate)for(;f.return;)f=f.return;else{o=f;do f=o,(f.flags&4098)!==0&&(x=f.return),o=f.return;while(o)}return f.tag===3?x:null}function X(o){if(o.tag===13){var f=o.memoizedState;if(f===null&&(o=o.alternate,o!==null&&(f=o.memoizedState)),f!==null)return f.dehydrated}return null}function r(o){if(F(o)!==o)throw Error(D(188))}function re(o){var f=o.alternate;if(!f){if(f=F(o),f===null)throw Error(D(188));return f!==o?null:o}for(var x=o,R=f;;){var B=x.return;if(B===null)break;var G=B.alternate;if(G===null){if(R=B.return,R!==null){x=R;continue}break}if(B.child===G.child){for(G=B.child;G;){if(G===x)return r(B),o;if(G===R)return r(B),f;G=G.sibling}throw Error(D(188))}if(x.return!==R.return)x=B,R=G;else{for(var se=!1,be=B.child;be;){if(be===x){se=!0,x=B,R=G;break}if(be===R){se=!0,R=B,x=G;break}be=be.sibling}if(!se){for(be=G.child;be;){if(be===x){se=!0,x=G,R=B;break}if(be===R){se=!0,R=G,x=B;break}be=be.sibling}if(!se)throw Error(D(189))}}if(x.alternate!==R)throw Error(D(190))}if(x.tag!==3)throw Error(D(188));return x.stateNode.current===x?o:f}function J(o){var f=o.tag;if(f===5||f===26||f===27||f===6)return o;for(o=o.child;o!==null;){if(f=J(o),f!==null)return f;o=o.sibling}return null}var oe=Object.assign,ze=Symbol.for("react.element"),je=Symbol.for("react.transitional.element"),ft=Symbol.for("react.portal"),Le=Symbol.for("react.fragment"),Fe=Symbol.for("react.strict_mode"),qe=Symbol.for("react.profiler"),He=Symbol.for("react.provider"),tt=Symbol.for("react.consumer"),mt=Symbol.for("react.context"),Tt=Symbol.for("react.forward_ref"),kt=Symbol.for("react.suspense"),At=Symbol.for("react.suspense_list"),ot=Symbol.for("react.memo"),hi=Symbol.for("react.lazy"),Mi=Symbol.for("react.activity"),ti=Symbol.for("react.memo_cache_sentinel"),Rt=Symbol.iterator;function ui(o){return o===null||typeof o!="object"?null:(o=Rt&&o[Rt]||o["@@iterator"],typeof o=="function"?o:null)}var Si=Symbol.for("react.client.reference");function di(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===Si?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case Le:return"Fragment";case qe:return"Profiler";case Fe:return"StrictMode";case kt:return"Suspense";case At:return"SuspenseList";case Mi:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case ft:return"Portal";case mt:return(o.displayName||"Context")+".Provider";case tt:return(o._context.displayName||"Context")+".Consumer";case Tt:var f=o.render;return o=o.displayName,o||(o=f.displayName||f.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case ot:return f=o.displayName||null,f!==null?f:di(o.type)||"Memo";case hi:f=o._payload,o=o._init;try{return di(o(f))}catch{}}return null}var ii=Array.isArray,pt=v.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ni=S.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pi={pending:!1,data:null,method:null,action:null},ai=[],We=-1;function Jt(o){return{current:o}}function Ei(o){0>We||(o.current=ai[We],ai[We]=null,We--)}function Ot(o,f){We++,ai[We]=o.current,o.current=f}var ji=Jt(null),An=Jt(null),Xi=Jt(null),nr=Jt(null);function sr(o,f){switch(Ot(Xi,f),Ot(An,o),Ot(ji,null),f.nodeType){case 9:case 11:o=(o=f.documentElement)&&(o=o.namespaceURI)?By(o):0;break;default:if(o=f.tagName,f=f.namespaceURI)f=By(f),o=Ny(f,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}Ei(ji),Ot(ji,o)}function Aa(){Ei(ji),Ei(An),Ei(Xi)}function de(o){o.memoizedState!==null&&Ot(nr,o);var f=ji.current,x=Ny(f,o.type);f!==x&&(Ot(An,o),Ot(ji,x))}function us(o){An.current===o&&(Ei(ji),Ei(An)),nr.current===o&&(Ei(nr),Lp._currentValue=pi)}var Ts=Object.prototype.hasOwnProperty,ks=m.unstable_scheduleCallback,Ft=m.unstable_cancelCallback,Ss=m.unstable_shouldYield,ya=m.unstable_requestPaint,qr=m.unstable_now,ln=m.unstable_getCurrentPriorityLevel,Br=m.unstable_ImmediatePriority,Bs=m.unstable_UserBlockingPriority,Es=m.unstable_NormalPriority,Qe=m.unstable_LowPriority,Mt=m.unstable_IdlePriority,vt=m.log,bi=m.unstable_setDisableYieldValue,gi=null,ri=null;function vi(o){if(typeof vt=="function"&&bi(o),ri&&typeof ri.setStrictMode=="function")try{ri.setStrictMode(gi,o)}catch{}}var sn=Math.clz32?Math.clz32:hc,or=Math.log,Gr=Math.LN2;function hc(o){return o>>>=0,o===0?32:31-(or(o)/Gr|0)|0}var hs=256,ds=4194304;function Wr(o){var f=o&42;if(f!==0)return f;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function Ns(o,f,x){var R=o.pendingLanes;if(R===0)return 0;var B=0,G=o.suspendedLanes,se=o.pingedLanes;o=o.warmLanes;var be=R&134217727;return be!==0?(R=be&~G,R!==0?B=Wr(R):(se&=be,se!==0?B=Wr(se):x||(x=be&~o,x!==0&&(B=Wr(x))))):(be=R&~G,be!==0?B=Wr(be):se!==0?B=Wr(se):x||(x=R&~o,x!==0&&(B=Wr(x)))),B===0?0:f!==0&&f!==B&&(f&G)===0&&(G=B&-B,x=f&-f,G>=x||G===32&&(x&4194048)!==0)?f:B}function Kn(o,f){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&f)===0}function Nn(o,f){switch(o){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bu(){var o=hs;return hs<<=1,(hs&4194048)===0&&(hs=256),o}function dc(){var o=ds;return ds<<=1,(ds&62914560)===0&&(ds=4194304),o}function Ma(o){for(var f=[],x=0;31>x;x++)f.push(o);return f}function so(o,f){o.pendingLanes|=f,f!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function fh(o,f,x,R,B,G){var se=o.pendingLanes;o.pendingLanes=x,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=x,o.entangledLanes&=x,o.errorRecoveryDisabledLanes&=x,o.shellSuspendCounter=0;var be=o.entanglements,Ye=o.expirationTimes,Et=o.hiddenUpdates;for(x=se&~x;0<x;){var Zt=31-sn(x),Qt=1<<Zt;be[Zt]=0,Ye[Zt]=-1;var It=Et[Zt];if(It!==null)for(Et[Zt]=null,Zt=0;Zt<It.length;Zt++){var Lt=It[Zt];Lt!==null&&(Lt.lane&=-536870913)}x&=~Qt}R!==0&&fc(o,R,0),G!==0&&B===0&&o.tag!==0&&(o.suspendedLanes|=G&~(se&~f))}function fc(o,f,x){o.pendingLanes|=f,o.suspendedLanes&=~f;var R=31-sn(f);o.entangledLanes|=f,o.entanglements[R]=o.entanglements[R]|1073741824|x&4194090}function ph(o,f){var x=o.entangledLanes|=f;for(o=o.entanglements;x;){var R=31-sn(x),B=1<<R;B&f|o[R]&f&&(o[R]|=f),x&=~B}}function wu(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function pc(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function at(){var o=ni.p;return o!==0?o:(o=window.event,o===void 0?32:pg(o.type))}function ie(o,f){var x=ni.p;try{return ni.p=o,f()}finally{ni.p=x}}var ae=Math.random().toString(36).slice(2),ge="__reactFiber$"+ae,Ae="__reactProps$"+ae,Me="__reactContainer$"+ae,Oe="__reactEvents$"+ae,Je="__reactListeners$"+ae,Be="__reactHandles$"+ae,it="__reactResources$"+ae,lt="__reactMarker$"+ae;function rt(o){delete o[ge],delete o[Ae],delete o[Oe],delete o[Je],delete o[Be]}function Dt(o){var f=o[ge];if(f)return f;for(var x=o.parentNode;x;){if(f=x[Me]||x[ge]){if(x=f.alternate,f.child!==null||x!==null&&x.child!==null)for(o=jy(o);o!==null;){if(x=o[ge])return x;o=jy(o)}return f}o=x,x=o.parentNode}return null}function Ht(o){if(o=o[ge]||o[Me]){var f=o.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return o}return null}function Yt(o){var f=o.tag;if(f===5||f===26||f===27||f===6)return o.stateNode;throw Error(D(33))}function zi(o){var f=o[it];return f||(f=o[it]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function Ai(o){o[lt]=!0}var qi=new Set,$i={};function Fn(o,f){Jn(o,f),Jn(o+"Capture",f)}function Jn(o,f){for($i[o]=f,o=0;o<f.length;o++)qi.add(f[o])}var rn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Rn={},Dn={};function kn(o){return Ts.call(Dn,o)?!0:Ts.call(Rn,o)?!1:rn.test(o)?Dn[o]=!0:(Rn[o]=!0,!1)}function fr(o,f,x){if(kn(f))if(x===null)o.removeAttribute(f);else{switch(typeof x){case"undefined":case"function":case"symbol":o.removeAttribute(f);return;case"boolean":var R=f.toLowerCase().slice(0,5);if(R!=="data-"&&R!=="aria-"){o.removeAttribute(f);return}}o.setAttribute(f,""+x)}}function Nr(o,f,x){if(x===null)o.removeAttribute(f);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(f);return}o.setAttribute(f,""+x)}}function Mr(o,f,x,R){if(R===null)o.removeAttribute(x);else{switch(typeof R){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(x);return}o.setAttributeNS(f,x,""+R)}}var fs,Ca;function Cr(o){if(fs===void 0)try{throw Error()}catch(x){var f=x.stack.trim().match(/\n( *(at )?)/);fs=f&&f[1]||"",Ca=-1<x.stack.indexOf(`
    at`)?" (<anonymous>)":-1<x.stack.indexOf("@")?"@unknown:0:0":""}return`
`+fs+o+Ca}var Kr=!1;function vl(o,f){if(!o||Kr)return"";Kr=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var R={DetermineComponentFrameRoot:function(){try{if(f){var Qt=function(){throw Error()};if(Object.defineProperty(Qt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Qt,[])}catch(Lt){var It=Lt}Reflect.construct(o,[],Qt)}else{try{Qt.call()}catch(Lt){It=Lt}o.call(Qt.prototype)}}else{try{throw Error()}catch(Lt){It=Lt}(Qt=o())&&typeof Qt.catch=="function"&&Qt.catch(function(){})}}catch(Lt){if(Lt&&It&&typeof Lt.stack=="string")return[Lt.stack,It.stack]}return[null,null]}};R.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var B=Object.getOwnPropertyDescriptor(R.DetermineComponentFrameRoot,"name");B&&B.configurable&&Object.defineProperty(R.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var G=R.DetermineComponentFrameRoot(),se=G[0],be=G[1];if(se&&be){var Ye=se.split(`
`),Et=be.split(`
`);for(B=R=0;R<Ye.length&&!Ye[R].includes("DetermineComponentFrameRoot");)R++;for(;B<Et.length&&!Et[B].includes("DetermineComponentFrameRoot");)B++;if(R===Ye.length||B===Et.length)for(R=Ye.length-1,B=Et.length-1;1<=R&&0<=B&&Ye[R]!==Et[B];)B--;for(;1<=R&&0<=B;R--,B--)if(Ye[R]!==Et[B]){if(R!==1||B!==1)do if(R--,B--,0>B||Ye[R]!==Et[B]){var Zt=`
`+Ye[R].replace(" at new "," at ");return o.displayName&&Zt.includes("<anonymous>")&&(Zt=Zt.replace("<anonymous>",o.displayName)),Zt}while(1<=R&&0<=B);break}}}finally{Kr=!1,Error.prepareStackTrace=x}return(x=o?o.displayName||o.name:"")?Cr(x):""}function Fs(o){switch(o.tag){case 26:case 27:case 5:return Cr(o.type);case 16:return Cr("Lazy");case 13:return Cr("Suspense");case 19:return Cr("SuspenseList");case 0:case 15:return vl(o.type,!1);case 11:return vl(o.type.render,!1);case 1:return vl(o.type,!0);case 31:return Cr("Activity");default:return""}}function Mo(o){try{var f="";do f+=Fs(o),o=o.return;while(o);return f}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}function ps(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function mh(o){var f=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function _h(o){var f=mh(o)?"checked":"value",x=Object.getOwnPropertyDescriptor(o.constructor.prototype,f),R=""+o[f];if(!o.hasOwnProperty(f)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var B=x.get,G=x.set;return Object.defineProperty(o,f,{configurable:!0,get:function(){return B.call(this)},set:function(se){R=""+se,G.call(this,se)}}),Object.defineProperty(o,f,{enumerable:x.enumerable}),{getValue:function(){return R},setValue:function(se){R=""+se},stopTracking:function(){o._valueTracker=null,delete o[f]}}}}function Zo(o){o._valueTracker||(o._valueTracker=_h(o))}function Ad(o){if(!o)return!1;var f=o._valueTracker;if(!f)return!0;var x=f.getValue(),R="";return o&&(R=mh(o)?o.checked?"true":"false":o.value),o=R,o!==x?(f.setValue(o),!0):!1}function gh(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var am=/[\n"\\]/g;function ms(o){return o.replace(am,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function xl(o,f,x,R,B,G,se,be){o.name="",se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"?o.type=se:o.removeAttribute("type"),f!=null?se==="number"?(f===0&&o.value===""||o.value!=f)&&(o.value=""+ps(f)):o.value!==""+ps(f)&&(o.value=""+ps(f)):se!=="submit"&&se!=="reset"||o.removeAttribute("value"),f!=null?As(o,se,ps(f)):x!=null?As(o,se,ps(x)):R!=null&&o.removeAttribute("value"),B==null&&G!=null&&(o.defaultChecked=!!G),B!=null&&(o.checked=B&&typeof B!="function"&&typeof B!="symbol"),be!=null&&typeof be!="function"&&typeof be!="symbol"&&typeof be!="boolean"?o.name=""+ps(be):o.removeAttribute("name")}function _s(o,f,x,R,B,G,se,be){if(G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(o.type=G),f!=null||x!=null){if(!(G!=="submit"&&G!=="reset"||f!=null))return;x=x!=null?""+ps(x):"",f=f!=null?""+ps(f):x,be||f===o.value||(o.value=f),o.defaultValue=f}R=R??B,R=typeof R!="function"&&typeof R!="symbol"&&!!R,o.checked=be?o.checked:!!R,o.defaultChecked=!!R,se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"&&(o.name=se)}function As(o,f,x){f==="number"&&gh(o.ownerDocument)===o||o.defaultValue===""+x||(o.defaultValue=""+x)}function Ms(o,f,x,R){if(o=o.options,f){f={};for(var B=0;B<x.length;B++)f["$"+x[B]]=!0;for(x=0;x<o.length;x++)B=f.hasOwnProperty("$"+o[x].value),o[x].selected!==B&&(o[x].selected=B),B&&R&&(o[x].defaultSelected=!0)}else{for(x=""+ps(x),f=null,B=0;B<o.length;B++){if(o[B].value===x){o[B].selected=!0,R&&(o[B].defaultSelected=!0);return}f!==null||o[B].disabled||(f=o[B])}f!==null&&(f.selected=!0)}}function gs(o,f,x){if(f!=null&&(f=""+ps(f),f!==o.value&&(o.value=f),x==null)){o.defaultValue!==f&&(o.defaultValue=f);return}o.defaultValue=x!=null?""+ps(x):""}function Ya(o,f,x,R){if(f==null){if(R!=null){if(x!=null)throw Error(D(92));if(ii(R)){if(1<R.length)throw Error(D(93));R=R[0]}x=R}x==null&&(x=""),f=x}x=ps(f),o.defaultValue=x,R=o.textContent,R===x&&R!==""&&R!==null&&(o.value=R)}function oo(o,f){if(f){var x=o.firstChild;if(x&&x===o.lastChild&&x.nodeType===3){x.nodeValue=f;return}}o.textContent=f}var Kf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function yh(o,f,x){var R=f.indexOf("--")===0;x==null||typeof x=="boolean"||x===""?R?o.setProperty(f,""):f==="float"?o.cssFloat="":o[f]="":R?o.setProperty(f,x):typeof x!="number"||x===0||Kf.has(f)?f==="float"?o.cssFloat=x:o[f]=(""+x).trim():o[f]=x+"px"}function Vs(o,f,x){if(f!=null&&typeof f!="object")throw Error(D(62));if(o=o.style,x!=null){for(var R in x)!x.hasOwnProperty(R)||f!=null&&f.hasOwnProperty(R)||(R.indexOf("--")===0?o.setProperty(R,""):R==="float"?o.cssFloat="":o[R]="");for(var B in f)R=f[B],f.hasOwnProperty(B)&&x[B]!==R&&yh(o,B,R)}else for(var G in f)f.hasOwnProperty(G)&&yh(o,G,f[G])}function Ia(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sm=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Jf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wa(o){return Jf.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var Mn=null;function vh(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var yi=null,mc=null;function Qf(o){var f=Ht(o);if(f&&(o=f.stateNode)){var x=o[Ae]||null;e:switch(o=f.stateNode,f.type){case"input":if(xl(o,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name),f=x.name,x.type==="radio"&&f!=null){for(x=o;x.parentNode;)x=x.parentNode;for(x=x.querySelectorAll('input[name="'+ms(""+f)+'"][type="radio"]'),f=0;f<x.length;f++){var R=x[f];if(R!==o&&R.form===o.form){var B=R[Ae]||null;if(!B)throw Error(D(90));xl(R,B.value,B.defaultValue,B.defaultValue,B.checked,B.defaultChecked,B.type,B.name)}}for(f=0;f<x.length;f++)R=x[f],R.form===o.form&&Ad(R)}break e;case"textarea":gs(o,x.value,x.defaultValue);break e;case"select":f=x.value,f!=null&&Ms(o,!!x.multiple,f,!1)}}}var _c=!1;function bn(o,f,x){if(_c)return o(f,x);_c=!0;try{var R=o(f);return R}finally{if(_c=!1,(yi!==null||mc!==null)&&(bp(),yi&&(f=yi,o=mc,mc=yi=null,Qf(f),o)))for(f=0;f<o.length;f++)Qf(o[f])}}function Fa(o,f){var x=o.stateNode;if(x===null)return null;var R=x[Ae]||null;if(R===null)return null;x=R[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(o=o.type,R=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!R;break e;default:o=!1}if(o)return null;if(x&&typeof x!="function")throw Error(D(231,f,typeof x));return x}var Us=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bl=!1;if(Us)try{var si={};Object.defineProperty(si,"passive",{get:function(){bl=!0}}),window.addEventListener("test",si,si),window.removeEventListener("test",si,si)}catch{bl=!1}var dn=null,gn=null,aa=null;function gc(){if(aa)return aa;var o,f=gn,x=f.length,R,B="value"in dn?dn.value:dn.textContent,G=B.length;for(o=0;o<x&&f[o]===B[o];o++);var se=x-o;for(R=1;R<=se&&f[x-R]===B[G-R];R++);return aa=B.slice(o,1<R?1-R:void 0)}function yn(o){var f=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&f===13&&(o=13)):o=f,o===10&&(o=13),32<=o||o===13?o:0}function js(){return!0}function Tu(){return!1}function Hr(o){function f(x,R,B,G,se){this._reactName=x,this._targetInst=B,this.type=R,this.nativeEvent=G,this.target=se,this.currentTarget=null;for(var be in o)o.hasOwnProperty(be)&&(x=o[be],this[be]=x?x(G):G[be]);return this.isDefaultPrevented=(G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1)?js:Tu,this.isPropagationStopped=Tu,this}return oe(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var x=this.nativeEvent;x&&(x.preventDefault?x.preventDefault():typeof x.returnValue!="unknown"&&(x.returnValue=!1),this.isDefaultPrevented=js)},stopPropagation:function(){var x=this.nativeEvent;x&&(x.stopPropagation?x.stopPropagation():typeof x.cancelBubble!="unknown"&&(x.cancelBubble=!0),this.isPropagationStopped=js)},persist:function(){},isPersistent:js}),f}var Lr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pr=Hr(Lr),Ka=oe({},Lr,{view:0,detail:0}),Su=Hr(Ka),xh,wl,Tl,Sl=oe({},Ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lo,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Tl&&(Tl&&o.type==="mousemove"?(xh=o.screenX-Tl.screenX,wl=o.screenY-Tl.screenY):wl=xh=0,Tl=o),xh)},movementY:function(o){return"movementY"in o?o.movementY:wl}}),va=Hr(Sl),Co=oe({},Sl,{dataTransfer:0}),Ra=Hr(Co),bh=oe({},Ka,{relatedTarget:0}),Cs=Hr(bh),Fr=oe({},Lr,{animationName:0,elapsedTime:0,pseudoElement:0}),sa=Hr(Fr),$o=oe({},Lr,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),Ir=Hr($o),ep=oe({},Lr,{data:0}),ys=Hr(ep),Eu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},El={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function F_(o){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(o):(o=Xo[o])?!!f[o]:!1}function lo(){return F_}var V_=oe({},Ka,{key:function(o){if(o.key){var f=Eu[o.key]||o.key;if(f!=="Unidentified")return f}return o.type==="keypress"?(o=yn(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?El[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lo,charCode:function(o){return o.type==="keypress"?yn(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?yn(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),Md=Hr(V_),Va=oe({},Sl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),om=Hr(Va),yc=oe({},Ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lo}),lm=Hr(yc),wh=oe({},Lr,{propertyName:0,elapsedTime:0,pseudoElement:0}),U_=Hr(wh),j_=oe({},Sl,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),Th=Hr(j_),Sh=oe({},Lr,{newState:0,oldState:0}),q_=Hr(Sh),vc=[9,13,27,32],Yo=Us&&"CompositionEvent"in window,Al=null;Us&&"documentMode"in document&&(Al=document.documentMode);var Ml=Us&&"TextEvent"in window&&!Al,Cd=Us&&(!Yo||Al&&8<Al&&11>=Al),cm=" ",um=!1;function tp(o,f){switch(o){case"keyup":return vc.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hm(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Is=!1;function en(o,f){switch(o){case"compositionend":return hm(f);case"keypress":return f.which!==32?null:(um=!0,cm);case"textInput":return o=f.data,o===cm&&um?null:o;default:return null}}function mi(o,f){if(Is)return o==="compositionend"||!Yo&&tp(o,f)?(o=gc(),aa=gn=dn=null,Is=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Cd&&f.locale!=="ko"?null:f.data;default:return null}}var Id={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ni(o){var f=o&&o.nodeName&&o.nodeName.toLowerCase();return f==="input"?!!Id[o.type]:f==="textarea"}function Io(o,f,x,R){yi?mc?mc.push(R):mc=[R]:yi=R,f=bf(f,"onChange"),0<f.length&&(x=new pr("onChange","change",null,x,R),o.push({event:x,listeners:f}))}var Ro=null,Ii=null;function ip(o){Qc(o,0)}function Do(o){var f=Yt(o);if(Ad(f))return o}function xc(o,f){if(o==="change")return f}var Rd=!1;if(Us){var Cl;if(Us){var mr="oninput"in document;if(!mr){var Au=document.createElement("div");Au.setAttribute("oninput","return;"),mr=typeof Au.oninput=="function"}Cl=mr}else Cl=!1;Rd=Cl&&(!document.documentMode||9<document.documentMode)}function Bt(){Ro&&(Ro.detachEvent("onpropertychange",Eh),Ii=Ro=null)}function Eh(o){if(o.propertyName==="value"&&Do(Ii)){var f=[];Io(f,Ii,o,vh(o)),bn(ip,f)}}function Wo(o,f,x){o==="focusin"?(Bt(),Ro=f,Ii=x,Ro.attachEvent("onpropertychange",Eh)):o==="focusout"&&Bt()}function xa(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Do(Ii)}function dm(o,f){if(o==="click")return Do(f)}function Dd(o,f){if(o==="input"||o==="change")return Do(f)}function Ko(o,f){return o===f&&(o!==0||1/o===1/f)||o!==o&&f!==f}var ba=typeof Object.is=="function"?Object.is:Ko;function qs(o,f){if(ba(o,f))return!0;if(typeof o!="object"||o===null||typeof f!="object"||f===null)return!1;var x=Object.keys(o),R=Object.keys(f);if(x.length!==R.length)return!1;for(R=0;R<x.length;R++){var B=x[R];if(!Ts.call(f,B)||!ba(o[B],f[B]))return!1}return!0}function bc(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function wc(o,f){var x=bc(o);o=0;for(var R;x;){if(x.nodeType===3){if(R=o+x.textContent.length,o<=f&&R>=f)return{node:x,offset:f-o};o=R}e:{for(;x;){if(x.nextSibling){x=x.nextSibling;break e}x=x.parentNode}x=void 0}x=bc(x)}}function fm(o,f){return o&&f?o===f?!0:o&&o.nodeType===3?!1:f&&f.nodeType===3?fm(o,f.parentNode):"contains"in o?o.contains(f):o.compareDocumentPosition?!!(o.compareDocumentPosition(f)&16):!1:!1}function pm(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var f=gh(o.document);f instanceof o.HTMLIFrameElement;){try{var x=typeof f.contentWindow.location.href=="string"}catch{x=!1}if(x)o=f.contentWindow;else break;f=gh(o.document)}return f}function Ah(o){var f=o&&o.nodeName&&o.nodeName.toLowerCase();return f&&(f==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||f==="textarea"||o.contentEditable==="true")}var mm=Us&&"documentMode"in document&&11>=document.documentMode,Tc=null,zd=null,Il=null,np=!1;function Rl(o,f,x){var R=x.window===x?x.document:x.nodeType===9?x:x.ownerDocument;np||Tc==null||Tc!==gh(R)||(R=Tc,"selectionStart"in R&&Ah(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),Il&&qs(Il,R)||(Il=R,R=bf(zd,"onSelect"),0<R.length&&(f=new pr("onSelect","select",null,f,x),o.push({event:f,listeners:R}),f.target=Tc)))}function Sc(o,f){var x={};return x[o.toLowerCase()]=f.toLowerCase(),x["Webkit"+o]="webkit"+f,x["Moz"+o]="moz"+f,x}var Mu={animationend:Sc("Animation","AnimationEnd"),animationiteration:Sc("Animation","AnimationIteration"),animationstart:Sc("Animation","AnimationStart"),transitionrun:Sc("Transition","TransitionRun"),transitionstart:Sc("Transition","TransitionStart"),transitioncancel:Sc("Transition","TransitionCancel"),transitionend:Sc("Transition","TransitionEnd")},Cu={},rp={};Us&&(rp=document.createElement("div").style,"AnimationEvent"in window||(delete Mu.animationend.animation,delete Mu.animationiteration.animation,delete Mu.animationstart.animation),"TransitionEvent"in window||delete Mu.transitionend.transition);function co(o){if(Cu[o])return Cu[o];if(!Mu[o])return o;var f=Mu[o],x;for(x in f)if(f.hasOwnProperty(x)&&x in rp)return Cu[o]=f[x];return o}var Gs=co("animationend"),Ld=co("animationiteration"),Mh=co("animationstart"),Ch=co("transitionrun"),Od=co("transitionstart"),Dl=co("transitioncancel"),Ih=co("transitionend"),Pd=new Map,Jo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Jo.push("scrollEnd");function Ua(o,f){Pd.set(o,f),Fn(f,[o])}var Iu=new WeakMap;function ja(o,f){if(typeof o=="object"&&o!==null){var x=Iu.get(o);return x!==void 0?x:(f={value:o,source:f,stack:Mo(f)},Iu.set(o,f),f)}return{value:o,source:f,stack:Mo(f)}}var oa=[],Hs=0,zl=0;function Ru(){for(var o=Hs,f=zl=Hs=0;f<o;){var x=oa[f];oa[f++]=null;var R=oa[f];oa[f++]=null;var B=oa[f];oa[f++]=null;var G=oa[f];if(oa[f++]=null,R!==null&&B!==null){var se=R.pending;se===null?B.next=B:(B.next=se.next,se.next=B),R.pending=B}G!==0&&cn(x,B,G)}}function Ec(o,f,x,R){oa[Hs++]=o,oa[Hs++]=f,oa[Hs++]=x,oa[Hs++]=R,zl|=R,o.lanes|=R,o=o.alternate,o!==null&&(o.lanes|=R)}function Ac(o,f,x,R){return Ec(o,f,x,R),Rh(o)}function Ja(o,f){return Ec(o,null,null,f),Rh(o)}function cn(o,f,x){o.lanes|=x;var R=o.alternate;R!==null&&(R.lanes|=x);for(var B=!1,G=o.return;G!==null;)G.childLanes|=x,R=G.alternate,R!==null&&(R.childLanes|=x),G.tag===22&&(o=G.stateNode,o===null||o._visibility&1||(B=!0)),o=G,G=G.return;return o.tag===3?(G=o.stateNode,B&&f!==null&&(B=31-sn(x),o=G.hiddenUpdates,R=o[B],R===null?o[B]=[f]:R.push(f),f.lane=x|536870912),G):null}function Rh(o){if(50<Wc)throw Wc=0,nc=null,Error(D(185));for(var f=o.return;f!==null;)o=f,f=o.return;return o.tag===3?o.stateNode:null}var Mc={};function Du(o,f,x,R){this.tag=o,this.key=x,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qa(o,f,x,R){return new Du(o,f,x,R)}function ap(o){return o=o.prototype,!(!o||!o.isReactComponent)}function jn(o,f){var x=o.alternate;return x===null?(x=Qa(o.tag,f,o.key,o.mode),x.elementType=o.elementType,x.type=o.type,x.stateNode=o.stateNode,x.alternate=o,o.alternate=x):(x.pendingProps=f,x.type=o.type,x.flags=0,x.subtreeFlags=0,x.deletions=null),x.flags=o.flags&65011712,x.childLanes=o.childLanes,x.lanes=o.lanes,x.child=o.child,x.memoizedProps=o.memoizedProps,x.memoizedState=o.memoizedState,x.updateQueue=o.updateQueue,f=o.dependencies,x.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},x.sibling=o.sibling,x.index=o.index,x.ref=o.ref,x.refCleanup=o.refCleanup,x}function _m(o,f){o.flags&=65011714;var x=o.alternate;return x===null?(o.childLanes=0,o.lanes=f,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=x.childLanes,o.lanes=x.lanes,o.child=x.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=x.memoizedProps,o.memoizedState=x.memoizedState,o.updateQueue=x.updateQueue,o.type=x.type,f=x.dependencies,o.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),o}function zu(o,f,x,R,B,G){var se=0;if(R=o,typeof o=="function")ap(o)&&(se=1);else if(typeof o=="string")se=Hy(o,x,ji.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case Mi:return o=Qa(31,x,f,B),o.elementType=Mi,o.lanes=G,o;case Le:return Qo(x.children,B,G,f);case Fe:se=8,B|=24;break;case qe:return o=Qa(12,x,f,B|2),o.elementType=qe,o.lanes=G,o;case kt:return o=Qa(13,x,f,B),o.elementType=kt,o.lanes=G,o;case At:return o=Qa(19,x,f,B),o.elementType=At,o.lanes=G,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case He:case mt:se=10;break e;case tt:se=9;break e;case Tt:se=11;break e;case ot:se=14;break e;case hi:se=16,R=null;break e}se=29,x=Error(D(130,o===null?"null":typeof o,"")),R=null}return f=Qa(se,x,f,B),f.elementType=o,f.type=R,f.lanes=G,f}function Qo(o,f,x,R){return o=Qa(7,o,R,f),o.lanes=x,o}function Dh(o,f,x){return o=Qa(6,o,null,f),o.lanes=x,o}function zh(o,f,x){return f=Qa(4,o.children!==null?o.children:[],o.key,f),f.lanes=x,f.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},f}var Cc=[],Ic=0,kd=null,Ll=0,qa=[],Rs=0,da=null,uo=1,Zs="";function zo(o,f){Cc[Ic++]=Ll,Cc[Ic++]=kd,kd=o,Ll=f}function Bd(o,f,x){qa[Rs++]=uo,qa[Rs++]=Zs,qa[Rs++]=da,da=o;var R=uo;o=Zs;var B=32-sn(R)-1;R&=~(1<<B),x+=1;var G=32-sn(f)+B;if(30<G){var se=B-B%5;G=(R&(1<<se)-1).toString(32),R>>=se,B-=se,uo=1<<32-sn(f)+B|x<<B|R,Zs=G+o}else uo=1<<G|x<<B|R,Zs=o}function Lh(o){o.return!==null&&(zo(o,1),Bd(o,1,0))}function Oh(o){for(;o===kd;)kd=Cc[--Ic],Cc[Ic]=null,Ll=Cc[--Ic],Cc[Ic]=null;for(;o===da;)da=qa[--Rs],qa[Rs]=null,Zs=qa[--Rs],qa[Rs]=null,uo=qa[--Rs],qa[Rs]=null}var wa=null,Or=null,tr=!1,Lo=null,ho=!1,Nd=Error(D(519));function $s(o){var f=Error(D(418,""));throw Bh(ja(f,o)),Nd}function gm(o){var f=o.stateNode,x=o.type,R=o.memoizedProps;switch(f[ge]=o,f[Ae]=R,x){case"dialog":Un("cancel",f),Un("close",f);break;case"iframe":case"object":case"embed":Un("load",f);break;case"video":case"audio":for(x=0;x<xf.length;x++)Un(xf[x],f);break;case"source":Un("error",f);break;case"img":case"image":case"link":Un("error",f),Un("load",f);break;case"details":Un("toggle",f);break;case"input":Un("invalid",f),_s(f,R.value,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name,!0),Zo(f);break;case"select":Un("invalid",f);break;case"textarea":Un("invalid",f),Ya(f,R.value,R.defaultValue,R.children),Zo(f)}x=R.children,typeof x!="string"&&typeof x!="number"&&typeof x!="bigint"||f.textContent===""+x||R.suppressHydrationWarning===!0||Zm(f.textContent,x)?(R.popover!=null&&(Un("beforetoggle",f),Un("toggle",f)),R.onScroll!=null&&Un("scroll",f),R.onScrollEnd!=null&&Un("scrollend",f),R.onClick!=null&&(f.onclick=Tf),f=!0):f=!1,f||$s(o)}function ym(o){for(wa=o.return;wa;)switch(wa.tag){case 5:case 13:ho=!1;return;case 27:case 3:ho=!0;return;default:wa=wa.return}}function Ph(o){if(o!==wa)return!1;if(!tr)return ym(o),tr=!0,!1;var f=o.tag,x;if((x=f!==3&&f!==27)&&((x=f===5)&&(x=o.type,x=!(x!=="form"&&x!=="button")||eg(o.type,o.memoizedProps)),x=!x),x&&Or&&$s(o),ym(o),f===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(D(317));e:{for(o=o.nextSibling,f=0;o;){if(o.nodeType===8)if(x=o.data,x==="/$"){if(f===0){Or=yo(o.nextSibling);break e}f--}else x!=="$"&&x!=="$!"&&x!=="$?"||f++;o=o.nextSibling}Or=null}}else f===27?(f=Or,eu(o.type)?(o=Km,Km=null,Or=o):Or=f):Or=wa?yo(o.stateNode.nextSibling):null;return!0}function kh(){Or=wa=null,tr=!1}function vm(){var o=Lo;return o!==null&&(fn===null?fn=o:fn.push.apply(fn,o),Lo=null),o}function Bh(o){Lo===null?Lo=[o]:Lo.push(o)}var Rc=Jt(null),el=null,fo=null;function Ds(o,f,x){Ot(Rc,f._currentValue),f._currentValue=x}function Oo(o){o._currentValue=Rc.current,Ei(Rc)}function Fd(o,f,x){for(;o!==null;){var R=o.alternate;if((o.childLanes&f)!==f?(o.childLanes|=f,R!==null&&(R.childLanes|=f)):R!==null&&(R.childLanes&f)!==f&&(R.childLanes|=f),o===x)break;o=o.return}}function Nh(o,f,x,R){var B=o.child;for(B!==null&&(B.return=o);B!==null;){var G=B.dependencies;if(G!==null){var se=B.child;G=G.firstContext;e:for(;G!==null;){var be=G;G=B;for(var Ye=0;Ye<f.length;Ye++)if(be.context===f[Ye]){G.lanes|=x,be=G.alternate,be!==null&&(be.lanes|=x),Fd(G.return,x,o),R||(se=null);break e}G=be.next}}else if(B.tag===18){if(se=B.return,se===null)throw Error(D(341));se.lanes|=x,G=se.alternate,G!==null&&(G.lanes|=x),Fd(se,x,o),se=null}else se=B.child;if(se!==null)se.return=B;else for(se=B;se!==null;){if(se===o){se=null;break}if(B=se.sibling,B!==null){B.return=se.return,se=B;break}se=se.return}B=se}}function Ol(o,f,x,R){o=null;for(var B=f,G=!1;B!==null;){if(!G){if((B.flags&524288)!==0)G=!0;else if((B.flags&262144)!==0)break}if(B.tag===10){var se=B.alternate;if(se===null)throw Error(D(387));if(se=se.memoizedProps,se!==null){var be=B.type;ba(B.pendingProps.value,se.value)||(o!==null?o.push(be):o=[be])}}else if(B===nr.current){if(se=B.alternate,se===null)throw Error(D(387));se.memoizedState.memoizedState!==B.memoizedState.memoizedState&&(o!==null?o.push(Lp):o=[Lp])}B=B.return}o!==null&&Nh(f,o,x,R),f.flags|=262144}function es(o){for(o=o.firstContext;o!==null;){if(!ba(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function tl(o){el=o,fo=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Pr(o){return Dc(el,o)}function Lu(o,f){return el===null&&tl(o),Dc(o,f)}function Dc(o,f){var x=f._currentValue;if(f={context:f,memoizedValue:x,next:null},fo===null){if(o===null)throw Error(D(308));fo=f,o.dependencies={lanes:0,firstContext:f},o.flags|=524288}else fo=fo.next=f;return x}var Vd=typeof AbortController<"u"?AbortController:function(){var o=[],f=this.signal={aborted:!1,addEventListener:function(x,R){o.push(R)}};this.abort=function(){f.aborted=!0,o.forEach(function(x){return x()})}},xm=m.unstable_scheduleCallback,sp=m.unstable_NormalPriority,Zr={$$typeof:mt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ud(){return{controller:new Vd,data:new Map,refCount:0}}function Ou(o){o.refCount--,o.refCount===0&&xm(sp,function(){o.controller.abort()})}var il=null,op=0,zc=0,Pl=null;function jd(o,f){if(il===null){var x=il=[];op=0,zc=Nm(),Pl={status:"pending",value:void 0,then:function(R){x.push(R)}}}return op++,f.then(qd,qd),f}function qd(){if(--op===0&&il!==null){Pl!==null&&(Pl.status="fulfilled");var o=il;il=null,zc=0,Pl=null;for(var f=0;f<o.length;f++)(0,o[f])()}}function Gd(o,f){var x=[],R={status:"pending",value:null,reason:null,then:function(B){x.push(B)}};return o.then(function(){R.status="fulfilled",R.value=f;for(var B=0;B<x.length;B++)(0,x[B])(f)},function(B){for(R.status="rejected",R.reason=B,B=0;B<x.length;B++)(0,x[B])(void 0)}),R}var Lc=pt.S;pt.S=function(o,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&jd(o,f),Lc!==null&&Lc(o,f)};var nl=Jt(null);function kl(){var o=nl.current;return o!==null?o:Ti.pooledCache}function Pu(o,f){f===null?Ot(nl,nl.current):Ot(nl,f.pool)}function Fh(){var o=kl();return o===null?null:{parent:Zr._currentValue,pool:o}}var Bl=Error(D(460)),ku=Error(D(474)),Vh=Error(D(542)),Hd={then:function(){}};function Oc(o){return o=o.status,o==="fulfilled"||o==="rejected"}function Pc(){}function Wt(o,f,x){switch(x=o[x],x===void 0?o.push(f):x!==f&&(f.then(Pc,Pc),f=x),f.status){case"fulfilled":return f.value;case"rejected":throw o=f.reason,rl(o),o;default:if(typeof f.status=="string")f.then(Pc,Pc);else{if(o=Ti,o!==null&&100<o.shellSuspendCounter)throw Error(D(482));o=f,o.status="pending",o.then(function(R){if(f.status==="pending"){var B=f;B.status="fulfilled",B.value=R}},function(R){if(f.status==="pending"){var B=f;B.status="rejected",B.reason=R}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw o=f.reason,rl(o),o}throw kc=f,Bl}}var kc=null;function Zd(){if(kc===null)throw Error(D(459));var o=kc;return kc=null,o}function rl(o){if(o===Bl||o===Vh)throw Error(D(483))}var la=!1;function _i(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Uh(o,f){o=o.updateQueue,f.updateQueue===o&&(f.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function Nl(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function al(o,f,x){var R=o.updateQueue;if(R===null)return null;if(R=R.shared,(Gi&2)!==0){var B=R.pending;return B===null?f.next=f:(f.next=B.next,B.next=f),R.pending=f,f=Rh(o),cn(o,null,x),f}return Ec(o,R,f,x),Rh(o)}function Fl(o,f,x){if(f=f.updateQueue,f!==null&&(f=f.shared,(x&4194048)!==0)){var R=f.lanes;R&=o.pendingLanes,x|=R,f.lanes=x,ph(o,x)}}function jh(o,f){var x=o.updateQueue,R=o.alternate;if(R!==null&&(R=R.updateQueue,x===R)){var B=null,G=null;if(x=x.firstBaseUpdate,x!==null){do{var se={lane:x.lane,tag:x.tag,payload:x.payload,callback:null,next:null};G===null?B=G=se:G=G.next=se,x=x.next}while(x!==null);G===null?B=G=f:G=G.next=f}else B=G=f;x={baseState:R.baseState,firstBaseUpdate:B,lastBaseUpdate:G,shared:R.shared,callbacks:R.callbacks},o.updateQueue=x;return}o=x.lastBaseUpdate,o===null?x.firstBaseUpdate=f:o.next=f,x.lastBaseUpdate=f}var $d=!1;function Vl(){if($d){var o=Pl;if(o!==null)throw o}}function Bc(o,f,x,R){$d=!1;var B=o.updateQueue;la=!1;var G=B.firstBaseUpdate,se=B.lastBaseUpdate,be=B.shared.pending;if(be!==null){B.shared.pending=null;var Ye=be,Et=Ye.next;Ye.next=null,se===null?G=Et:se.next=Et,se=Ye;var Zt=o.alternate;Zt!==null&&(Zt=Zt.updateQueue,be=Zt.lastBaseUpdate,be!==se&&(be===null?Zt.firstBaseUpdate=Et:be.next=Et,Zt.lastBaseUpdate=Ye))}if(G!==null){var Qt=B.baseState;se=0,Zt=Et=Ye=null,be=G;do{var It=be.lane&-536870913,Lt=It!==be.lane;if(Lt?(li&It)===It:(R&It)===It){It!==0&&It===zc&&($d=!0),Zt!==null&&(Zt=Zt.next={lane:0,tag:be.tag,payload:be.payload,callback:null,next:null});e:{var En=o,vn=be;It=f;var Sr=x;switch(vn.tag){case 1:if(En=vn.payload,typeof En=="function"){Qt=En.call(Sr,Qt,It);break e}Qt=En;break e;case 3:En.flags=En.flags&-65537|128;case 0:if(En=vn.payload,It=typeof En=="function"?En.call(Sr,Qt,It):En,It==null)break e;Qt=oe({},Qt,It);break e;case 2:la=!0}}It=be.callback,It!==null&&(o.flags|=64,Lt&&(o.flags|=8192),Lt=B.callbacks,Lt===null?B.callbacks=[It]:Lt.push(It))}else Lt={lane:It,tag:be.tag,payload:be.payload,callback:be.callback,next:null},Zt===null?(Et=Zt=Lt,Ye=Qt):Zt=Zt.next=Lt,se|=It;if(be=be.next,be===null){if(be=B.shared.pending,be===null)break;Lt=be,be=Lt.next,Lt.next=null,B.lastBaseUpdate=Lt,B.shared.pending=null}}while(!0);Zt===null&&(Ye=Qt),B.baseState=Ye,B.firstBaseUpdate=Et,B.lastBaseUpdate=Zt,G===null&&(B.shared.lanes=0),vr|=se,o.lanes=se,o.memoizedState=Qt}}function lp(o,f){if(typeof o!="function")throw Error(D(191,o));o.call(f)}function Xd(o,f){var x=o.callbacks;if(x!==null)for(o.callbacks=null,o=0;o<x.length;o++)lp(x[o],f)}var ts=Jt(null),Bu=Jt(0);function Yd(o,f){o=rr,Ot(Bu,o),Ot(ts,f),rr=o|f.baseLanes}function Da(){Ot(Bu,rr),Ot(ts,ts.current)}function Po(){rr=Bu.current,Ei(ts),Ei(Bu)}var Xs=0,Bn=null,ir=null,Vr=null,qh=!1,za=!1,Ln=!1,sl=0,Nc=0,Ul=null,Wd=0;function Rr(){throw Error(D(321))}function jl(o,f){if(f===null)return!1;for(var x=0;x<f.length&&x<o.length;x++)if(!ba(o[x],f[x]))return!1;return!0}function ql(o,f,x,R,B,G){return Xs=G,Bn=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,pt.H=o===null||o.memoizedState===null?hp:dp,Ln=!1,G=x(R,B),Ln=!1,za&&(G=Pt(f,x,R,B)),Fc(o),G}function Fc(o){pt.H=td;var f=ir!==null&&ir.next!==null;if(Xs=0,Vr=ir=Bn=null,qh=!1,Nc=0,Ul=null,f)throw Error(D(300));o===null||yr||(o=o.dependencies,o!==null&&es(o)&&(yr=!0))}function Pt(o,f,x,R){Bn=o;var B=0;do{if(za&&(Ul=null),Nc=0,za=!1,25<=B)throw Error(D(301));if(B+=1,Vr=ir=null,o.updateQueue!=null){var G=o.updateQueue;G.lastEffect=null,G.events=null,G.stores=null,G.memoCache!=null&&(G.memoCache.index=0)}pt.H=Tm,G=f(x,R)}while(za);return G}function Kt(){var o=pt.H,f=o.useState()[0];return f=typeof f.then=="function"?Vc(f):f,o=o.useState()[0],(ir!==null?ir.memoizedState:null)!==o&&(Bn.flags|=1024),f}function Gl(){var o=sl!==0;return sl=0,o}function lr(o,f,x){f.updateQueue=o.updateQueue,f.flags&=-2053,o.lanes&=~x}function $e(o){if(qh){for(o=o.memoizedState;o!==null;){var f=o.queue;f!==null&&(f.pending=null),o=o.next}qh=!1}Xs=0,Vr=ir=Bn=null,za=!1,Nc=sl=0,Ul=null}function is(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vr===null?Bn.memoizedState=Vr=o:Vr=Vr.next=o,Vr}function Ur(){if(ir===null){var o=Bn.alternate;o=o!==null?o.memoizedState:null}else o=ir.next;var f=Vr===null?Bn.memoizedState:Vr.next;if(f!==null)Vr=f,ir=o;else{if(o===null)throw Bn.alternate===null?Error(D(467)):Error(D(310));ir=o,o={memoizedState:ir.memoizedState,baseState:ir.baseState,baseQueue:ir.baseQueue,queue:ir.queue,next:null},Vr===null?Bn.memoizedState=Vr=o:Vr=Vr.next=o}return Vr}function Gh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Vc(o){var f=Nc;return Nc+=1,Ul===null&&(Ul=[]),o=Wt(Ul,o,f),f=Bn,(Vr===null?f.memoizedState:Vr.next)===null&&(f=f.alternate,pt.H=f===null||f.memoizedState===null?hp:dp),o}function Hh(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return Vc(o);if(o.$$typeof===mt)return Pr(o)}throw Error(D(438,String(o)))}function Kd(o){var f=null,x=Bn.updateQueue;if(x!==null&&(f=x.memoCache),f==null){var R=Bn.alternate;R!==null&&(R=R.updateQueue,R!==null&&(R=R.memoCache,R!=null&&(f={data:R.data.map(function(B){return B.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),x===null&&(x=Gh(),Bn.updateQueue=x),x.memoCache=f,x=f.data[f.index],x===void 0)for(x=f.data[f.index]=Array(o),R=0;R<o;R++)x[R]=ti;return f.index++,x}function vs(o,f){return typeof f=="function"?f(o):f}function Jd(o){var f=Ur();return cp(f,ir,o)}function cp(o,f,x){var R=o.queue;if(R===null)throw Error(D(311));R.lastRenderedReducer=x;var B=o.baseQueue,G=R.pending;if(G!==null){if(B!==null){var se=B.next;B.next=G.next,G.next=se}f.baseQueue=B=G,R.pending=null}if(G=o.baseState,B===null)o.memoizedState=G;else{f=B.next;var be=se=null,Ye=null,Et=f,Zt=!1;do{var Qt=Et.lane&-536870913;if(Qt!==Et.lane?(li&Qt)===Qt:(Xs&Qt)===Qt){var It=Et.revertLane;if(It===0)Ye!==null&&(Ye=Ye.next={lane:0,revertLane:0,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null}),Qt===zc&&(Zt=!0);else if((Xs&It)===It){Et=Et.next,It===zc&&(Zt=!0);continue}else Qt={lane:0,revertLane:Et.revertLane,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null},Ye===null?(be=Ye=Qt,se=G):Ye=Ye.next=Qt,Bn.lanes|=It,vr|=It;Qt=Et.action,Ln&&x(G,Qt),G=Et.hasEagerState?Et.eagerState:x(G,Qt)}else It={lane:Qt,revertLane:Et.revertLane,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null},Ye===null?(be=Ye=It,se=G):Ye=Ye.next=It,Bn.lanes|=Qt,vr|=Qt;Et=Et.next}while(Et!==null&&Et!==f);if(Ye===null?se=G:Ye.next=be,!ba(G,o.memoizedState)&&(yr=!0,Zt&&(x=Pl,x!==null)))throw x;o.memoizedState=G,o.baseState=se,o.baseQueue=Ye,R.lastRenderedState=G}return B===null&&(R.lanes=0),[o.memoizedState,R.dispatch]}function Qd(o){var f=Ur(),x=f.queue;if(x===null)throw Error(D(311));x.lastRenderedReducer=o;var R=x.dispatch,B=x.pending,G=f.memoizedState;if(B!==null){x.pending=null;var se=B=B.next;do G=o(G,se.action),se=se.next;while(se!==B);ba(G,f.memoizedState)||(yr=!0),f.memoizedState=G,f.baseQueue===null&&(f.baseState=G),x.lastRenderedState=G}return[G,R]}function Zh(o,f,x){var R=Bn,B=Ur(),G=tr;if(G){if(x===void 0)throw Error(D(407));x=x()}else x=f();var se=!ba((ir||B).memoizedState,x);se&&(B.memoizedState=x,yr=!0),B=B.queue;var be=tf.bind(null,R,B,o);if(Ys(2048,8,be,[o]),B.getSnapshot!==f||se||Vr!==null&&Vr.memoizedState.tag&1){if(R.flags|=2048,$l(9,ns(),ef.bind(null,R,B,x,f),null),Ti===null)throw Error(D(349));G||(Xs&124)!==0||ol(R,f,x)}return x}function ol(o,f,x){o.flags|=16384,o={getSnapshot:f,value:x},f=Bn.updateQueue,f===null?(f=Gh(),Bn.updateQueue=f,f.stores=[o]):(x=f.stores,x===null?f.stores=[o]:x.push(o))}function ef(o,f,x,R){f.value=x,f.getSnapshot=R,Hl(f)&&$h(o)}function tf(o,f,x){return x(function(){Hl(f)&&$h(o)})}function Hl(o){var f=o.getSnapshot;o=o.value;try{var x=f();return!ba(o,x)}catch{return!0}}function $h(o){var f=Ja(o,2);f!==null&&to(f,o,2)}function Zl(o){var f=is();if(typeof o=="function"){var x=o;if(o=x(),Ln){vi(!0);try{x()}finally{vi(!1)}}}return f.memoizedState=f.baseState=o,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:o},f}function ko(o,f,x,R){return o.baseState=x,cp(o,ir,typeof R=="function"?R:vs)}function bm(o,f,x,R,B){if(qu(o))throw Error(D(485));if(o=f.action,o!==null){var G={payload:B,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(se){G.listeners.push(se)}};pt.T!==null?x(!0):G.isTransition=!1,R(G),x=f.pending,x===null?(G.next=f.pending=G,Jr(f,G)):(G.next=x.next,f.pending=x.next=G)}}function Jr(o,f){var x=f.action,R=f.payload,B=o.state;if(f.isTransition){var G=pt.T,se={};pt.T=se;try{var be=x(B,R),Ye=pt.S;Ye!==null&&Ye(se,be),wm(o,f,be)}catch(Et){Hn(o,f,Et)}finally{pt.T=G}}else try{G=x(B,R),wm(o,f,G)}catch(Et){Hn(o,f,Et)}}function wm(o,f,x){x!==null&&typeof x=="object"&&typeof x.then=="function"?x.then(function(R){Nu(o,f,R)},function(R){return Hn(o,f,R)}):Nu(o,f,x)}function Nu(o,f,x){f.status="fulfilled",f.value=x,wn(f),o.state=x,f=o.pending,f!==null&&(x=f.next,x===f?o.pending=null:(x=x.next,f.next=x,Jr(o,x)))}function Hn(o,f,x){var R=o.pending;if(o.pending=null,R!==null){R=R.next;do f.status="rejected",f.reason=x,wn(f),f=f.next;while(f!==R)}o.action=null}function wn(o){o=o.listeners;for(var f=0;f<o.length;f++)(0,o[f])()}function up(o,f){return f}function Bo(o,f){if(tr){var x=Ti.formState;if(x!==null){e:{var R=Bn;if(tr){if(Or){t:{for(var B=Or,G=ho;B.nodeType!==8;){if(!G){B=null;break t}if(B=yo(B.nextSibling),B===null){B=null;break t}}G=B.data,B=G==="F!"||G==="F"?B:null}if(B){Or=yo(B.nextSibling),R=B.data==="F!";break e}}$s(R)}R=!1}R&&(f=x[0])}}return x=is(),x.memoizedState=x.baseState=f,R={pending:null,lanes:0,dispatch:null,lastRenderedReducer:up,lastRenderedState:f},x.queue=R,x=ed.bind(null,Bn,R),R.dispatch=x,R=Zl(!1),G=ju.bind(null,Bn,!1,R.queue),R=is(),B={state:f,dispatch:null,action:o,pending:null},R.queue=B,x=bm.bind(null,Bn,B,G,x),B.dispatch=x,R.memoizedState=o,[f,x,!1]}function Uc(o){var f=Ur();return No(f,ir,o)}function No(o,f,x){if(f=cp(o,f,up)[0],o=Jd(vs)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var R=Vc(f)}catch(se){throw se===Bl?Vh:se}else R=f;f=Ur();var B=f.queue,G=B.dispatch;return x!==f.memoizedState&&(Bn.flags|=2048,$l(9,ns(),jc.bind(null,B,x),null)),[R,G,o]}function jc(o,f){o.action=f}function Fu(o){var f=Ur(),x=ir;if(x!==null)return No(f,x,o);Ur(),f=f.memoizedState,x=Ur();var R=x.queue.dispatch;return x.memoizedState=o,[f,R,!1]}function $l(o,f,x,R){return o={tag:o,create:x,deps:R,inst:f,next:null},f=Bn.updateQueue,f===null&&(f=Gh(),Bn.updateQueue=f),x=f.lastEffect,x===null?f.lastEffect=o.next=o:(R=x.next,x.next=o,o.next=R,f.lastEffect=o),o}function ns(){return{destroy:void 0,resource:void 0}}function nf(){return Ur().memoizedState}function xs(o,f,x,R){var B=is();R=R===void 0?null:R,Bn.flags|=o,B.memoizedState=$l(1|f,ns(),x,R)}function Ys(o,f,x,R){var B=Ur();R=R===void 0?null:R;var G=B.memoizedState.inst;ir!==null&&R!==null&&jl(R,ir.memoizedState.deps)?B.memoizedState=$l(f,G,x,R):(Bn.flags|=o,B.memoizedState=$l(1|f,G,x,R))}function Xh(o,f){xs(8390656,8,o,f)}function Yh(o,f){Ys(2048,8,o,f)}function rf(o,f){return Ys(4,2,o,f)}function af(o,f){return Ys(4,4,o,f)}function Xl(o,f){if(typeof f=="function"){o=o();var x=f(o);return function(){typeof x=="function"?x():f(null)}}if(f!=null)return o=o(),f.current=o,function(){f.current=null}}function sf(o,f,x){x=x!=null?x.concat([o]):null,Ys(4,4,Xl.bind(null,f,o),x)}function Fo(){}function of(o,f){var x=Ur();f=f===void 0?null:f;var R=x.memoizedState;return f!==null&&jl(f,R[1])?R[0]:(x.memoizedState=[o,f],o)}function Vu(o,f){var x=Ur();f=f===void 0?null:f;var R=x.memoizedState;if(f!==null&&jl(f,R[1]))return R[0];if(R=o(),Ln){vi(!0);try{o()}finally{vi(!1)}}return x.memoizedState=[R,f],R}function Wh(o,f,x){return x===void 0||(Xs&1073741824)!==0?o.memoizedState=f:(o.memoizedState=x,o=_f(),Bn.lanes|=o,vr|=o,x)}function lf(o,f,x,R){return ba(x,f)?x:ts.current!==null?(o=Wh(o,x,R),ba(o,f)||(yr=!0),o):(Xs&42)===0?(yr=!0,o.memoizedState=x):(o=_f(),Bn.lanes|=o,vr|=o,f)}function ca(o,f,x,R,B){var G=ni.p;ni.p=G!==0&&8>G?G:8;var se=pt.T,be={};pt.T=be,ju(o,!1,f,x);try{var Ye=B(),Et=pt.S;if(Et!==null&&Et(be,Ye),Ye!==null&&typeof Ye=="object"&&typeof Ye.then=="function"){var Zt=Gd(Ye,R);Yl(o,f,Zt,Ha(o))}else Yl(o,f,R,Ha(o))}catch(Qt){Yl(o,f,{then:function(){},status:"rejected",reason:Qt},Ha())}finally{ni.p=G,pt.T=se}}function cf(){}function Uu(o,f,x,R){if(o.tag!==5)throw Error(D(476));var B=rs(o).queue;ca(o,B,f,pi,x===null?cf:function(){return Kh(o),x(R)})}function rs(o){var f=o.memoizedState;if(f!==null)return f;f={memoizedState:pi,baseState:pi,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:pi},next:null};var x={};return f.next={memoizedState:x,baseState:x,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:x},next:null},o.memoizedState=f,o=o.alternate,o!==null&&(o.memoizedState=f),f}function Kh(o){var f=rs(o).next.queue;Yl(o,f,{},Ha())}function Jh(){return Pr(Lp)}function uf(){return Ur().memoizedState}function qc(){return Ur().memoizedState}function Qh(o){for(var f=o.return;f!==null;){switch(f.tag){case 24:case 3:var x=Ha();o=Nl(x);var R=al(f,o,x);R!==null&&(to(R,f,x),Fl(R,f,x)),f={cache:Ud()},o.payload=f;return}f=f.return}}function hf(o,f,x){var R=Ha();x={lane:R,revertLane:0,action:x,hasEagerState:!1,eagerState:null,next:null},qu(o)?df(f,x):(x=Ac(o,f,x,R),x!==null&&(to(x,o,R),Gu(x,f,R)))}function ed(o,f,x){var R=Ha();Yl(o,f,x,R)}function Yl(o,f,x,R){var B={lane:R,revertLane:0,action:x,hasEagerState:!1,eagerState:null,next:null};if(qu(o))df(f,B);else{var G=o.alternate;if(o.lanes===0&&(G===null||G.lanes===0)&&(G=f.lastRenderedReducer,G!==null))try{var se=f.lastRenderedState,be=G(se,x);if(B.hasEagerState=!0,B.eagerState=be,ba(be,se))return Ec(o,f,B,0),Ti===null&&Ru(),!1}catch{}finally{}if(x=Ac(o,f,B,R),x!==null)return to(x,o,R),Gu(x,f,R),!0}return!1}function ju(o,f,x,R){if(R={lane:2,revertLane:Nm(),action:R,hasEagerState:!1,eagerState:null,next:null},qu(o)){if(f)throw Error(D(479))}else f=Ac(o,x,R,2),f!==null&&to(f,o,2)}function qu(o){var f=o.alternate;return o===Bn||f!==null&&f===Bn}function df(o,f){za=qh=!0;var x=o.pending;x===null?f.next=f:(f.next=x.next,x.next=f),o.pending=f}function Gu(o,f,x){if((x&4194048)!==0){var R=f.lanes;R&=o.pendingLanes,x|=R,f.lanes=x,ph(o,x)}}var td={readContext:Pr,use:Hh,useCallback:Rr,useContext:Rr,useEffect:Rr,useImperativeHandle:Rr,useLayoutEffect:Rr,useInsertionEffect:Rr,useMemo:Rr,useReducer:Rr,useRef:Rr,useState:Rr,useDebugValue:Rr,useDeferredValue:Rr,useTransition:Rr,useSyncExternalStore:Rr,useId:Rr,useHostTransitionStatus:Rr,useFormState:Rr,useActionState:Rr,useOptimistic:Rr,useMemoCache:Rr,useCacheRefresh:Rr},hp={readContext:Pr,use:Hh,useCallback:function(o,f){return is().memoizedState=[o,f===void 0?null:f],o},useContext:Pr,useEffect:Xh,useImperativeHandle:function(o,f,x){x=x!=null?x.concat([o]):null,xs(4194308,4,Xl.bind(null,f,o),x)},useLayoutEffect:function(o,f){return xs(4194308,4,o,f)},useInsertionEffect:function(o,f){xs(4,2,o,f)},useMemo:function(o,f){var x=is();f=f===void 0?null:f;var R=o();if(Ln){vi(!0);try{o()}finally{vi(!1)}}return x.memoizedState=[R,f],R},useReducer:function(o,f,x){var R=is();if(x!==void 0){var B=x(f);if(Ln){vi(!0);try{x(f)}finally{vi(!1)}}}else B=f;return R.memoizedState=R.baseState=B,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:B},R.queue=o,o=o.dispatch=hf.bind(null,Bn,o),[R.memoizedState,o]},useRef:function(o){var f=is();return o={current:o},f.memoizedState=o},useState:function(o){o=Zl(o);var f=o.queue,x=ed.bind(null,Bn,f);return f.dispatch=x,[o.memoizedState,x]},useDebugValue:Fo,useDeferredValue:function(o,f){var x=is();return Wh(x,o,f)},useTransition:function(){var o=Zl(!1);return o=ca.bind(null,Bn,o.queue,!0,!1),is().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,f,x){var R=Bn,B=is();if(tr){if(x===void 0)throw Error(D(407));x=x()}else{if(x=f(),Ti===null)throw Error(D(349));(li&124)!==0||ol(R,f,x)}B.memoizedState=x;var G={value:x,getSnapshot:f};return B.queue=G,Xh(tf.bind(null,R,G,o),[o]),R.flags|=2048,$l(9,ns(),ef.bind(null,R,G,x,f),null),x},useId:function(){var o=is(),f=Ti.identifierPrefix;if(tr){var x=Zs,R=uo;x=(R&~(1<<32-sn(R)-1)).toString(32)+x,f="«"+f+"R"+x,x=sl++,0<x&&(f+="H"+x.toString(32)),f+="»"}else x=Wd++,f="«"+f+"r"+x.toString(32)+"»";return o.memoizedState=f},useHostTransitionStatus:Jh,useFormState:Bo,useActionState:Bo,useOptimistic:function(o){var f=is();f.memoizedState=f.baseState=o;var x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=x,f=ju.bind(null,Bn,!0,x),x.dispatch=f,[o,f]},useMemoCache:Kd,useCacheRefresh:function(){return is().memoizedState=Qh.bind(null,Bn)}},dp={readContext:Pr,use:Hh,useCallback:of,useContext:Pr,useEffect:Yh,useImperativeHandle:sf,useInsertionEffect:rf,useLayoutEffect:af,useMemo:Vu,useReducer:Jd,useRef:nf,useState:function(){return Jd(vs)},useDebugValue:Fo,useDeferredValue:function(o,f){var x=Ur();return lf(x,ir.memoizedState,o,f)},useTransition:function(){var o=Jd(vs)[0],f=Ur().memoizedState;return[typeof o=="boolean"?o:Vc(o),f]},useSyncExternalStore:Zh,useId:uf,useHostTransitionStatus:Jh,useFormState:Uc,useActionState:Uc,useOptimistic:function(o,f){var x=Ur();return ko(x,ir,o,f)},useMemoCache:Kd,useCacheRefresh:qc},Tm={readContext:Pr,use:Hh,useCallback:of,useContext:Pr,useEffect:Yh,useImperativeHandle:sf,useInsertionEffect:rf,useLayoutEffect:af,useMemo:Vu,useReducer:Qd,useRef:nf,useState:function(){return Qd(vs)},useDebugValue:Fo,useDeferredValue:function(o,f){var x=Ur();return ir===null?Wh(x,o,f):lf(x,ir.memoizedState,o,f)},useTransition:function(){var o=Qd(vs)[0],f=Ur().memoizedState;return[typeof o=="boolean"?o:Vc(o),f]},useSyncExternalStore:Zh,useId:uf,useHostTransitionStatus:Jh,useFormState:Fu,useActionState:Fu,useOptimistic:function(o,f){var x=Ur();return ir!==null?ko(x,ir,o,f):(x.baseState=o,[o,x.queue.dispatch])},useMemoCache:Kd,useCacheRefresh:qc},Gc=null,ll=0;function Wl(o){var f=ll;return ll+=1,Gc===null&&(Gc=[]),Wt(Gc,o,f)}function Ta(o,f){f=f.props.ref,o.ref=f!==void 0?f:null}function Kl(o,f){throw f.$$typeof===ze?Error(D(525)):(o=Object.prototype.toString.call(f),Error(D(31,o==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":o)))}function fp(o){var f=o._init;return f(o._payload)}function pp(o){function f(dt,st){if(o){var wt=dt.deletions;wt===null?(dt.deletions=[st],dt.flags|=16):wt.push(st)}}function x(dt,st){if(!o)return null;for(;st!==null;)f(dt,st),st=st.sibling;return null}function R(dt){for(var st=new Map;dt!==null;)dt.key!==null?st.set(dt.key,dt):st.set(dt.index,dt),dt=dt.sibling;return st}function B(dt,st){return dt=jn(dt,st),dt.index=0,dt.sibling=null,dt}function G(dt,st,wt){return dt.index=wt,o?(wt=dt.alternate,wt!==null?(wt=wt.index,wt<st?(dt.flags|=67108866,st):wt):(dt.flags|=67108866,st)):(dt.flags|=1048576,st)}function se(dt){return o&&dt.alternate===null&&(dt.flags|=67108866),dt}function be(dt,st,wt,$t){return st===null||st.tag!==6?(st=Dh(wt,dt.mode,$t),st.return=dt,st):(st=B(st,wt),st.return=dt,st)}function Ye(dt,st,wt,$t){var Vi=wt.type;return Vi===Le?Zt(dt,st,wt.props.children,$t,wt.key):st!==null&&(st.elementType===Vi||typeof Vi=="object"&&Vi!==null&&Vi.$$typeof===hi&&fp(Vi)===st.type)?(st=B(st,wt.props),Ta(st,wt),st.return=dt,st):(st=zu(wt.type,wt.key,wt.props,null,dt.mode,$t),Ta(st,wt),st.return=dt,st)}function Et(dt,st,wt,$t){return st===null||st.tag!==4||st.stateNode.containerInfo!==wt.containerInfo||st.stateNode.implementation!==wt.implementation?(st=zh(wt,dt.mode,$t),st.return=dt,st):(st=B(st,wt.children||[]),st.return=dt,st)}function Zt(dt,st,wt,$t,Vi){return st===null||st.tag!==7?(st=Qo(wt,dt.mode,$t,Vi),st.return=dt,st):(st=B(st,wt),st.return=dt,st)}function Qt(dt,st,wt){if(typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint")return st=Dh(""+st,dt.mode,wt),st.return=dt,st;if(typeof st=="object"&&st!==null){switch(st.$$typeof){case je:return wt=zu(st.type,st.key,st.props,null,dt.mode,wt),Ta(wt,st),wt.return=dt,wt;case ft:return st=zh(st,dt.mode,wt),st.return=dt,st;case hi:var $t=st._init;return st=$t(st._payload),Qt(dt,st,wt)}if(ii(st)||ui(st))return st=Qo(st,dt.mode,wt,null),st.return=dt,st;if(typeof st.then=="function")return Qt(dt,Wl(st),wt);if(st.$$typeof===mt)return Qt(dt,Lu(dt,st),wt);Kl(dt,st)}return null}function It(dt,st,wt,$t){var Vi=st!==null?st.key:null;if(typeof wt=="string"&&wt!==""||typeof wt=="number"||typeof wt=="bigint")return Vi!==null?null:be(dt,st,""+wt,$t);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case je:return wt.key===Vi?Ye(dt,st,wt,$t):null;case ft:return wt.key===Vi?Et(dt,st,wt,$t):null;case hi:return Vi=wt._init,wt=Vi(wt._payload),It(dt,st,wt,$t)}if(ii(wt)||ui(wt))return Vi!==null?null:Zt(dt,st,wt,$t,null);if(typeof wt.then=="function")return It(dt,st,Wl(wt),$t);if(wt.$$typeof===mt)return It(dt,st,Lu(dt,wt),$t);Kl(dt,wt)}return null}function Lt(dt,st,wt,$t,Vi){if(typeof $t=="string"&&$t!==""||typeof $t=="number"||typeof $t=="bigint")return dt=dt.get(wt)||null,be(st,dt,""+$t,Vi);if(typeof $t=="object"&&$t!==null){switch($t.$$typeof){case je:return dt=dt.get($t.key===null?wt:$t.key)||null,Ye(st,dt,$t,Vi);case ft:return dt=dt.get($t.key===null?wt:$t.key)||null,Et(st,dt,$t,Vi);case hi:var Xn=$t._init;return $t=Xn($t._payload),Lt(dt,st,wt,$t,Vi)}if(ii($t)||ui($t))return dt=dt.get(wt)||null,Zt(st,dt,$t,Vi,null);if(typeof $t.then=="function")return Lt(dt,st,wt,Wl($t),Vi);if($t.$$typeof===mt)return Lt(dt,st,wt,Lu(st,$t),Vi);Kl(st,$t)}return null}function En(dt,st,wt,$t){for(var Vi=null,Xn=null,tn=st,xn=st=0,$a=null;tn!==null&&xn<wt.length;xn++){tn.index>xn?($a=tn,tn=null):$a=tn.sibling;var cr=It(dt,tn,wt[xn],$t);if(cr===null){tn===null&&(tn=$a);break}o&&tn&&cr.alternate===null&&f(dt,tn),st=G(cr,st,xn),Xn===null?Vi=cr:Xn.sibling=cr,Xn=cr,tn=$a}if(xn===wt.length)return x(dt,tn),tr&&zo(dt,xn),Vi;if(tn===null){for(;xn<wt.length;xn++)tn=Qt(dt,wt[xn],$t),tn!==null&&(st=G(tn,st,xn),Xn===null?Vi=tn:Xn.sibling=tn,Xn=tn);return tr&&zo(dt,xn),Vi}for(tn=R(tn);xn<wt.length;xn++)$a=Lt(tn,dt,xn,wt[xn],$t),$a!==null&&(o&&$a.alternate!==null&&tn.delete($a.key===null?xn:$a.key),st=G($a,st,xn),Xn===null?Vi=$a:Xn.sibling=$a,Xn=$a);return o&&tn.forEach(function(au){return f(dt,au)}),tr&&zo(dt,xn),Vi}function vn(dt,st,wt,$t){if(wt==null)throw Error(D(151));for(var Vi=null,Xn=null,tn=st,xn=st=0,$a=null,cr=wt.next();tn!==null&&!cr.done;xn++,cr=wt.next()){tn.index>xn?($a=tn,tn=null):$a=tn.sibling;var au=It(dt,tn,cr.value,$t);if(au===null){tn===null&&(tn=$a);break}o&&tn&&au.alternate===null&&f(dt,tn),st=G(au,st,xn),Xn===null?Vi=au:Xn.sibling=au,Xn=au,tn=$a}if(cr.done)return x(dt,tn),tr&&zo(dt,xn),Vi;if(tn===null){for(;!cr.done;xn++,cr=wt.next())cr=Qt(dt,cr.value,$t),cr!==null&&(st=G(cr,st,xn),Xn===null?Vi=cr:Xn.sibling=cr,Xn=cr);return tr&&zo(dt,xn),Vi}for(tn=R(tn);!cr.done;xn++,cr=wt.next())cr=Lt(tn,dt,xn,cr.value,$t),cr!==null&&(o&&cr.alternate!==null&&tn.delete(cr.key===null?xn:cr.key),st=G(cr,st,xn),Xn===null?Vi=cr:Xn.sibling=cr,Xn=cr);return o&&tn.forEach(function(_g){return f(dt,_g)}),tr&&zo(dt,xn),Vi}function Sr(dt,st,wt,$t){if(typeof wt=="object"&&wt!==null&&wt.type===Le&&wt.key===null&&(wt=wt.props.children),typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case je:e:{for(var Vi=wt.key;st!==null;){if(st.key===Vi){if(Vi=wt.type,Vi===Le){if(st.tag===7){x(dt,st.sibling),$t=B(st,wt.props.children),$t.return=dt,dt=$t;break e}}else if(st.elementType===Vi||typeof Vi=="object"&&Vi!==null&&Vi.$$typeof===hi&&fp(Vi)===st.type){x(dt,st.sibling),$t=B(st,wt.props),Ta($t,wt),$t.return=dt,dt=$t;break e}x(dt,st);break}else f(dt,st);st=st.sibling}wt.type===Le?($t=Qo(wt.props.children,dt.mode,$t,wt.key),$t.return=dt,dt=$t):($t=zu(wt.type,wt.key,wt.props,null,dt.mode,$t),Ta($t,wt),$t.return=dt,dt=$t)}return se(dt);case ft:e:{for(Vi=wt.key;st!==null;){if(st.key===Vi)if(st.tag===4&&st.stateNode.containerInfo===wt.containerInfo&&st.stateNode.implementation===wt.implementation){x(dt,st.sibling),$t=B(st,wt.children||[]),$t.return=dt,dt=$t;break e}else{x(dt,st);break}else f(dt,st);st=st.sibling}$t=zh(wt,dt.mode,$t),$t.return=dt,dt=$t}return se(dt);case hi:return Vi=wt._init,wt=Vi(wt._payload),Sr(dt,st,wt,$t)}if(ii(wt))return En(dt,st,wt,$t);if(ui(wt)){if(Vi=ui(wt),typeof Vi!="function")throw Error(D(150));return wt=Vi.call(wt),vn(dt,st,wt,$t)}if(typeof wt.then=="function")return Sr(dt,st,Wl(wt),$t);if(wt.$$typeof===mt)return Sr(dt,st,Lu(dt,wt),$t);Kl(dt,wt)}return typeof wt=="string"&&wt!==""||typeof wt=="number"||typeof wt=="bigint"?(wt=""+wt,st!==null&&st.tag===6?(x(dt,st.sibling),$t=B(st,wt),$t.return=dt,dt=$t):(x(dt,st),$t=Dh(wt,dt.mode,$t),$t.return=dt,dt=$t),se(dt)):x(dt,st)}return function(dt,st,wt,$t){try{ll=0;var Vi=Sr(dt,st,wt,$t);return Gc=null,Vi}catch(tn){if(tn===Bl||tn===Vh)throw tn;var Xn=Qa(29,tn,null,dt.mode);return Xn.lanes=$t,Xn.return=dt,Xn}finally{}}}var Hu=pp(!0),Sm=pp(!1),On=Jt(null),po=null;function Vo(o){var f=o.alternate;Ot(jr,jr.current&1),Ot(On,o),po===null&&(f===null||ts.current!==null||f.memoizedState!==null)&&(po=o)}function Em(o){if(o.tag===22){if(Ot(jr,jr.current),Ot(On,o),po===null){var f=o.alternate;f!==null&&f.memoizedState!==null&&(po=o)}}else Ws()}function Ws(){Ot(jr,jr.current),Ot(On,On.current)}function mo(o){Ei(On),po===o&&(po=null),Ei(jr)}var jr=Jt(0);function Hc(o){for(var f=o;f!==null;){if(f.tag===13){var x=f.memoizedState;if(x!==null&&(x=x.dehydrated,x===null||x.data==="$?"||Wm(x)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===o)break;for(;f.sibling===null;){if(f.return===null||f.return===o)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function Ks(o,f,x,R){f=o.memoizedState,x=x(R,f),x=x==null?f:oe({},f,x),o.memoizedState=x,o.lanes===0&&(o.updateQueue.baseState=x)}var Zc={enqueueSetState:function(o,f,x){o=o._reactInternals;var R=Ha(),B=Nl(R);B.payload=f,x!=null&&(B.callback=x),f=al(o,B,R),f!==null&&(to(f,o,R),Fl(f,o,R))},enqueueReplaceState:function(o,f,x){o=o._reactInternals;var R=Ha(),B=Nl(R);B.tag=1,B.payload=f,x!=null&&(B.callback=x),f=al(o,B,R),f!==null&&(to(f,o,R),Fl(f,o,R))},enqueueForceUpdate:function(o,f){o=o._reactInternals;var x=Ha(),R=Nl(x);R.tag=2,f!=null&&(R.callback=f),f=al(o,R,x),f!==null&&(to(f,o,x),Fl(f,o,x))}};function Tr(o,f,x,R,B,G,se){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(R,G,se):f.prototype&&f.prototype.isPureReactComponent?!qs(x,R)||!qs(B,G):!0}function zs(o,f,x,R){o=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(x,R),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(x,R),f.state!==o&&Zc.enqueueReplaceState(f,f.state,null)}function Js(o,f){var x=f;if("ref"in f){x={};for(var R in f)R!=="ref"&&(x[R]=f[R])}if(o=o.defaultProps){x===f&&(x=oe({},x));for(var B in o)x[B]===void 0&&(x[B]=o[B])}return x}var Jl=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function mp(o){Jl(o)}function _p(o){console.error(o)}function Zu(o){Jl(o)}function $u(o,f){try{var x=o.onUncaughtError;x(f.value,{componentStack:f.stack})}catch(R){setTimeout(function(){throw R})}}function Am(o,f,x){try{var R=o.onCaughtError;R(x.value,{componentStack:x.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(B){setTimeout(function(){throw B})}}function id(o,f,x){return x=Nl(x),x.tag=3,x.payload={element:null},x.callback=function(){$u(o,f)},x}function ff(o){return o=Nl(o),o.tag=3,o}function Xu(o,f,x,R){var B=x.type.getDerivedStateFromError;if(typeof B=="function"){var G=R.value;o.payload=function(){return B(G)},o.callback=function(){Am(f,x,R)}}var se=x.stateNode;se!==null&&typeof se.componentDidCatch=="function"&&(o.callback=function(){Am(f,x,R),typeof B!="function"&&(ta===null?ta=new Set([this]):ta.add(this));var be=R.stack;this.componentDidCatch(R.value,{componentStack:be!==null?be:""})})}function $c(o,f,x,R,B){if(x.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){if(f=x.alternate,f!==null&&Ol(f,x,B,!0),x=On.current,x!==null){switch(x.tag){case 13:return po===null?rc():x.alternate===null&&Pn===0&&(Pn=3),x.flags&=-257,x.flags|=65536,x.lanes=B,R===Hd?x.flags|=16384:(f=x.updateQueue,f===null?x.updateQueue=new Set([R]):f.add(R),Tp(o,R,B)),!1;case 22:return x.flags|=65536,R===Hd?x.flags|=16384:(f=x.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([R])},x.updateQueue=f):(x=f.retryQueue,x===null?f.retryQueue=new Set([R]):x.add(R)),Tp(o,R,B)),!1}throw Error(D(435,x.tag))}return Tp(o,R,B),rc(),!1}if(tr)return f=On.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=B,R!==Nd&&(o=Error(D(422),{cause:R}),Bh(ja(o,x)))):(R!==Nd&&(f=Error(D(423),{cause:R}),Bh(ja(f,x))),o=o.current.alternate,o.flags|=65536,B&=-B,o.lanes|=B,R=ja(R,x),B=id(o.stateNode,R,B),jh(o,B),Pn!==4&&(Pn=2)),!1;var G=Error(D(520),{cause:R});if(G=ja(G,x),mn===null?mn=[G]:mn.push(G),Pn!==4&&(Pn=2),f===null)return!0;R=ja(R,x),x=f;do{switch(x.tag){case 3:return x.flags|=65536,o=B&-B,x.lanes|=o,o=id(x.stateNode,R,o),jh(x,o),!1;case 1:if(f=x.type,G=x.stateNode,(x.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&(ta===null||!ta.has(G))))return x.flags|=65536,B&=-B,x.lanes|=B,B=ff(B),Xu(B,o,x,R),jh(x,B),!1}x=x.return}while(x!==null);return!1}var Uo=Error(D(461)),yr=!1;function kr(o,f,x,R){f.child=o===null?Sm(f,null,x,R):Hu(f,o.child,x,R)}function Ql(o,f,x,R,B){x=x.render;var G=f.ref;if("ref"in R){var se={};for(var be in R)be!=="ref"&&(se[be]=R[be])}else se=R;return tl(f),R=ql(o,f,x,se,G,B),be=Gl(),o!==null&&!yr?(lr(o,f,B),Ga(o,f,B)):(tr&&be&&Lh(f),f.flags|=1,kr(o,f,R,B),f.child)}function cl(o,f,x,R,B){if(o===null){var G=x.type;return typeof G=="function"&&!ap(G)&&G.defaultProps===void 0&&x.compare===null?(f.tag=15,f.type=G,Mm(o,f,G,R,B)):(o=zu(x.type,null,R,f,f.mode,B),o.ref=f.ref,o.return=f,f.child=o)}if(G=o.child,!yp(o,B)){var se=G.memoizedProps;if(x=x.compare,x=x!==null?x:qs,x(se,R)&&o.ref===f.ref)return Ga(o,f,B)}return f.flags|=1,o=jn(G,R),o.ref=f.ref,o.return=f,f.child=o}function Mm(o,f,x,R,B){if(o!==null){var G=o.memoizedProps;if(qs(G,R)&&o.ref===f.ref)if(yr=!1,f.pendingProps=R=G,yp(o,B))(o.flags&131072)!==0&&(yr=!0);else return f.lanes=o.lanes,Ga(o,f,B)}return pf(o,f,x,R,B)}function Cm(o,f,x){var R=f.pendingProps,B=R.children,G=o!==null?o.memoizedState:null;if(R.mode==="hidden"){if((f.flags&128)!==0){if(R=G!==null?G.baseLanes|x:x,o!==null){for(B=f.child=o.child,G=0;B!==null;)G=G|B.lanes|B.childLanes,B=B.sibling;f.childLanes=G&~R}else f.childLanes=0,f.child=null;return Im(o,f,R,x)}if((x&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},o!==null&&Pu(f,G!==null?G.cachePool:null),G!==null?Yd(f,G):Da(),Em(f);else return f.lanes=f.childLanes=536870912,Im(o,f,G!==null?G.baseLanes|x:x,x)}else G!==null?(Pu(f,G.cachePool),Yd(f,G),Ws(),f.memoizedState=null):(o!==null&&Pu(f,null),Da(),Ws());return kr(o,f,B,x),f.child}function Im(o,f,x,R){var B=kl();return B=B===null?null:{parent:Zr._currentValue,pool:B},f.memoizedState={baseLanes:x,cachePool:B},o!==null&&Pu(f,null),Da(),Em(f),o!==null&&Ol(o,f,R,!0),null}function Xc(o,f){var x=f.ref;if(x===null)o!==null&&o.ref!==null&&(f.flags|=4194816);else{if(typeof x!="function"&&typeof x!="object")throw Error(D(284));(o===null||o.ref!==x)&&(f.flags|=4194816)}}function pf(o,f,x,R,B){return tl(f),x=ql(o,f,x,R,void 0,B),R=Gl(),o!==null&&!yr?(lr(o,f,B),Ga(o,f,B)):(tr&&R&&Lh(f),f.flags|=1,kr(o,f,x,B),f.child)}function La(o,f,x,R,B,G){return tl(f),f.updateQueue=null,x=Pt(f,R,x,B),Fc(o),R=Gl(),o!==null&&!yr?(lr(o,f,G),Ga(o,f,G)):(tr&&R&&Lh(f),f.flags|=1,kr(o,f,x,G),f.child)}function Yc(o,f,x,R,B){if(tl(f),f.stateNode===null){var G=Mc,se=x.contextType;typeof se=="object"&&se!==null&&(G=Pr(se)),G=new x(R,G),f.memoizedState=G.state!==null&&G.state!==void 0?G.state:null,G.updater=Zc,f.stateNode=G,G._reactInternals=f,G=f.stateNode,G.props=R,G.state=f.memoizedState,G.refs={},_i(f),se=x.contextType,G.context=typeof se=="object"&&se!==null?Pr(se):Mc,G.state=f.memoizedState,se=x.getDerivedStateFromProps,typeof se=="function"&&(Ks(f,x,se,R),G.state=f.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof G.getSnapshotBeforeUpdate=="function"||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(se=G.state,typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount(),se!==G.state&&Zc.enqueueReplaceState(G,G.state,null),Bc(f,R,G,B),Vl(),G.state=f.memoizedState),typeof G.componentDidMount=="function"&&(f.flags|=4194308),R=!0}else if(o===null){G=f.stateNode;var be=f.memoizedProps,Ye=Js(x,be);G.props=Ye;var Et=G.context,Zt=x.contextType;se=Mc,typeof Zt=="object"&&Zt!==null&&(se=Pr(Zt));var Qt=x.getDerivedStateFromProps;Zt=typeof Qt=="function"||typeof G.getSnapshotBeforeUpdate=="function",be=f.pendingProps!==be,Zt||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(be||Et!==se)&&zs(f,G,R,se),la=!1;var It=f.memoizedState;G.state=It,Bc(f,R,G,B),Vl(),Et=f.memoizedState,be||It!==Et||la?(typeof Qt=="function"&&(Ks(f,x,Qt,R),Et=f.memoizedState),(Ye=la||Tr(f,x,Ye,R,It,Et,se))?(Zt||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount()),typeof G.componentDidMount=="function"&&(f.flags|=4194308)):(typeof G.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=R,f.memoizedState=Et),G.props=R,G.state=Et,G.context=se,R=Ye):(typeof G.componentDidMount=="function"&&(f.flags|=4194308),R=!1)}else{G=f.stateNode,Uh(o,f),se=f.memoizedProps,Zt=Js(x,se),G.props=Zt,Qt=f.pendingProps,It=G.context,Et=x.contextType,Ye=Mc,typeof Et=="object"&&Et!==null&&(Ye=Pr(Et)),be=x.getDerivedStateFromProps,(Et=typeof be=="function"||typeof G.getSnapshotBeforeUpdate=="function")||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(se!==Qt||It!==Ye)&&zs(f,G,R,Ye),la=!1,It=f.memoizedState,G.state=It,Bc(f,R,G,B),Vl();var Lt=f.memoizedState;se!==Qt||It!==Lt||la||o!==null&&o.dependencies!==null&&es(o.dependencies)?(typeof be=="function"&&(Ks(f,x,be,R),Lt=f.memoizedState),(Zt=la||Tr(f,x,Zt,R,It,Lt,Ye)||o!==null&&o.dependencies!==null&&es(o.dependencies))?(Et||typeof G.UNSAFE_componentWillUpdate!="function"&&typeof G.componentWillUpdate!="function"||(typeof G.componentWillUpdate=="function"&&G.componentWillUpdate(R,Lt,Ye),typeof G.UNSAFE_componentWillUpdate=="function"&&G.UNSAFE_componentWillUpdate(R,Lt,Ye)),typeof G.componentDidUpdate=="function"&&(f.flags|=4),typeof G.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof G.componentDidUpdate!="function"||se===o.memoizedProps&&It===o.memoizedState||(f.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||se===o.memoizedProps&&It===o.memoizedState||(f.flags|=1024),f.memoizedProps=R,f.memoizedState=Lt),G.props=R,G.state=Lt,G.context=Ye,R=Zt):(typeof G.componentDidUpdate!="function"||se===o.memoizedProps&&It===o.memoizedState||(f.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||se===o.memoizedProps&&It===o.memoizedState||(f.flags|=1024),R=!1)}return G=R,Xc(o,f),R=(f.flags&128)!==0,G||R?(G=f.stateNode,x=R&&typeof x.getDerivedStateFromError!="function"?null:G.render(),f.flags|=1,o!==null&&R?(f.child=Hu(f,o.child,null,B),f.child=Hu(f,null,x,B)):kr(o,f,x,B),f.memoizedState=G.state,o=f.child):o=Ga(o,f,B),o}function gp(o,f,x,R){return kh(),f.flags|=256,kr(o,f,x,R),f.child}var mf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ec(o){return{baseLanes:o,cachePool:Fh()}}function Yu(o,f,x){return o=o!==null?o.childLanes&~x:0,f&&(o|=Ki),o}function bs(o,f,x){var R=f.pendingProps,B=!1,G=(f.flags&128)!==0,se;if((se=G)||(se=o!==null&&o.memoizedState===null?!1:(jr.current&2)!==0),se&&(B=!0,f.flags&=-129),se=(f.flags&32)!==0,f.flags&=-33,o===null){if(tr){if(B?Vo(f):Ws(),tr){var be=Or,Ye;if(Ye=be){e:{for(Ye=be,be=ho;Ye.nodeType!==8;){if(!be){be=null;break e}if(Ye=yo(Ye.nextSibling),Ye===null){be=null;break e}}be=Ye}be!==null?(f.memoizedState={dehydrated:be,treeContext:da!==null?{id:uo,overflow:Zs}:null,retryLane:536870912,hydrationErrors:null},Ye=Qa(18,null,null,0),Ye.stateNode=be,Ye.return=f,f.child=Ye,wa=f,Or=null,Ye=!0):Ye=!1}Ye||$s(f)}if(be=f.memoizedState,be!==null&&(be=be.dehydrated,be!==null))return Wm(be)?f.lanes=32:f.lanes=536870912,null;mo(f)}return be=R.children,R=R.fallback,B?(Ws(),B=f.mode,be=ul({mode:"hidden",children:be},B),R=Qo(R,B,x,null),be.return=f,R.return=f,be.sibling=R,f.child=be,B=f.child,B.memoizedState=ec(x),B.childLanes=Yu(o,se,x),f.memoizedState=mf,R):(Vo(f),as(f,be))}if(Ye=o.memoizedState,Ye!==null&&(be=Ye.dehydrated,be!==null)){if(G)f.flags&256?(Vo(f),f.flags&=-257,f=hl(o,f,x)):f.memoizedState!==null?(Ws(),f.child=o.child,f.flags|=128,f=null):(Ws(),B=R.fallback,be=f.mode,R=ul({mode:"visible",children:R.children},be),B=Qo(B,be,x,null),B.flags|=2,R.return=f,B.return=f,R.sibling=B,f.child=R,Hu(f,o.child,null,x),R=f.child,R.memoizedState=ec(x),R.childLanes=Yu(o,se,x),f.memoizedState=mf,f=B);else if(Vo(f),Wm(be)){if(se=be.nextSibling&&be.nextSibling.dataset,se)var Et=se.dgst;se=Et,R=Error(D(419)),R.stack="",R.digest=se,Bh({value:R,source:null,stack:null}),f=hl(o,f,x)}else if(yr||Ol(o,f,x,!1),se=(x&o.childLanes)!==0,yr||se){if(se=Ti,se!==null&&(R=x&-x,R=(R&42)!==0?1:wu(R),R=(R&(se.suspendedLanes|x))!==0?0:R,R!==0&&R!==Ye.retryLane))throw Ye.retryLane=R,Ja(o,R),to(se,o,R),Uo;be.data==="$?"||rc(),f=hl(o,f,x)}else be.data==="$?"?(f.flags|=192,f.child=o.child,f=null):(o=Ye.treeContext,Or=yo(be.nextSibling),wa=f,tr=!0,Lo=null,ho=!1,o!==null&&(qa[Rs++]=uo,qa[Rs++]=Zs,qa[Rs++]=da,uo=o.id,Zs=o.overflow,da=f),f=as(f,R.children),f.flags|=4096);return f}return B?(Ws(),B=R.fallback,be=f.mode,Ye=o.child,Et=Ye.sibling,R=jn(Ye,{mode:"hidden",children:R.children}),R.subtreeFlags=Ye.subtreeFlags&65011712,Et!==null?B=jn(Et,B):(B=Qo(B,be,x,null),B.flags|=2),B.return=f,R.return=f,R.sibling=B,f.child=R,R=B,B=f.child,be=o.child.memoizedState,be===null?be=ec(x):(Ye=be.cachePool,Ye!==null?(Et=Zr._currentValue,Ye=Ye.parent!==Et?{parent:Et,pool:Et}:Ye):Ye=Fh(),be={baseLanes:be.baseLanes|x,cachePool:Ye}),B.memoizedState=be,B.childLanes=Yu(o,se,x),f.memoizedState=mf,R):(Vo(f),x=o.child,o=x.sibling,x=jn(x,{mode:"visible",children:R.children}),x.return=f,x.sibling=null,o!==null&&(se=f.deletions,se===null?(f.deletions=[o],f.flags|=16):se.push(o)),f.child=x,f.memoizedState=null,x)}function as(o,f){return f=ul({mode:"visible",children:f},o.mode),f.return=o,o.child=f}function ul(o,f){return o=Qa(22,o,null,f),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function hl(o,f,x){return Hu(f,o.child,null,x),o=as(f,f.pendingProps.children),o.flags|=2,f.memoizedState=null,o}function tc(o,f,x){o.lanes|=f;var R=o.alternate;R!==null&&(R.lanes|=f),Fd(o.return,f,x)}function nd(o,f,x,R,B){var G=o.memoizedState;G===null?o.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:R,tail:x,tailMode:B}:(G.isBackwards=f,G.rendering=null,G.renderingStartTime=0,G.last=R,G.tail=x,G.tailMode=B)}function Tn(o,f,x){var R=f.pendingProps,B=R.revealOrder,G=R.tail;if(kr(o,f,R.children,x),R=jr.current,(R&2)!==0)R=R&1|2,f.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=f.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&tc(o,x,f);else if(o.tag===19)tc(o,x,f);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===f)break e;for(;o.sibling===null;){if(o.return===null||o.return===f)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}R&=1}switch(Ot(jr,R),B){case"forwards":for(x=f.child,B=null;x!==null;)o=x.alternate,o!==null&&Hc(o)===null&&(B=x),x=x.sibling;x=B,x===null?(B=f.child,f.child=null):(B=x.sibling,x.sibling=null),nd(f,!1,B,x,G);break;case"backwards":for(x=null,B=f.child,f.child=null;B!==null;){if(o=B.alternate,o!==null&&Hc(o)===null){f.child=B;break}o=B.sibling,B.sibling=x,x=B,B=o}nd(f,!0,x,null,G);break;case"together":nd(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function Ga(o,f,x){if(o!==null&&(f.dependencies=o.dependencies),vr|=f.lanes,(x&f.childLanes)===0)if(o!==null){if(Ol(o,f,x,!1),(x&f.childLanes)===0)return null}else return null;if(o!==null&&f.child!==o.child)throw Error(D(153));if(f.child!==null){for(o=f.child,x=jn(o,o.pendingProps),f.child=x,x.return=f;o.sibling!==null;)o=o.sibling,x=x.sibling=jn(o,o.pendingProps),x.return=f;x.sibling=null}return f.child}function yp(o,f){return(o.lanes&f)!==0?!0:(o=o.dependencies,!!(o!==null&&es(o)))}function G_(o,f,x){switch(f.tag){case 3:sr(f,f.stateNode.containerInfo),Ds(f,Zr,o.memoizedState.cache),kh();break;case 27:case 5:de(f);break;case 4:sr(f,f.stateNode.containerInfo);break;case 10:Ds(f,f.type,f.memoizedProps.value);break;case 13:var R=f.memoizedState;if(R!==null)return R.dehydrated!==null?(Vo(f),f.flags|=128,null):(x&f.child.childLanes)!==0?bs(o,f,x):(Vo(f),o=Ga(o,f,x),o!==null?o.sibling:null);Vo(f);break;case 19:var B=(o.flags&128)!==0;if(R=(x&f.childLanes)!==0,R||(Ol(o,f,x,!1),R=(x&f.childLanes)!==0),B){if(R)return Tn(o,f,x);f.flags|=128}if(B=f.memoizedState,B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),Ot(jr,jr.current),R)break;return null;case 22:case 23:return f.lanes=0,Cm(o,f,x);case 24:Ds(f,Zr,o.memoizedState.cache)}return Ga(o,f,x)}function rd(o,f,x){if(o!==null)if(o.memoizedProps!==f.pendingProps)yr=!0;else{if(!yp(o,x)&&(f.flags&128)===0)return yr=!1,G_(o,f,x);yr=(o.flags&131072)!==0}else yr=!1,tr&&(f.flags&1048576)!==0&&Bd(f,Ll,f.index);switch(f.lanes=0,f.tag){case 16:e:{o=f.pendingProps;var R=f.elementType,B=R._init;if(R=B(R._payload),f.type=R,typeof R=="function")ap(R)?(o=Js(R,o),f.tag=1,f=Yc(null,f,R,o,x)):(f.tag=0,f=pf(null,f,R,o,x));else{if(R!=null){if(B=R.$$typeof,B===Tt){f.tag=11,f=Ql(null,f,R,o,x);break e}else if(B===ot){f.tag=14,f=cl(null,f,R,o,x);break e}}throw f=di(R)||R,Error(D(306,f,""))}}return f;case 0:return pf(o,f,f.type,f.pendingProps,x);case 1:return R=f.type,B=Js(R,f.pendingProps),Yc(o,f,R,B,x);case 3:e:{if(sr(f,f.stateNode.containerInfo),o===null)throw Error(D(387));R=f.pendingProps;var G=f.memoizedState;B=G.element,Uh(o,f),Bc(f,R,null,x);var se=f.memoizedState;if(R=se.cache,Ds(f,Zr,R),R!==G.cache&&Nh(f,[Zr],x,!0),Vl(),R=se.element,G.isDehydrated)if(G={element:R,isDehydrated:!1,cache:se.cache},f.updateQueue.baseState=G,f.memoizedState=G,f.flags&256){f=gp(o,f,R,x);break e}else if(R!==B){B=ja(Error(D(424)),f),Bh(B),f=gp(o,f,R,x);break e}else{switch(o=f.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(Or=yo(o.firstChild),wa=f,tr=!0,Lo=null,ho=!0,x=Sm(f,null,R,x),f.child=x;x;)x.flags=x.flags&-3|4096,x=x.sibling}else{if(kh(),R===B){f=Ga(o,f,x);break e}kr(o,f,R,x)}f=f.child}return f;case 26:return Xc(o,f),o===null?(x=og(f.type,null,f.pendingProps,null))?f.memoizedState=x:tr||(x=f.type,o=f.pendingProps,R=Ap(Xi.current).createElement(x),R[ge]=f,R[Ae]=o,Za(R,x,o),Ai(R),f.stateNode=R):f.memoizedState=og(f.type,o.memoizedProps,f.pendingProps,o.memoizedState),null;case 27:return de(f),o===null&&tr&&(R=f.stateNode=rg(f.type,f.pendingProps,Xi.current),wa=f,ho=!0,B=Or,eu(f.type)?(Km=B,Or=yo(R.firstChild)):Or=B),kr(o,f,f.pendingProps.children,x),Xc(o,f),o===null&&(f.flags|=4194304),f.child;case 5:return o===null&&tr&&((B=R=Or)&&(R=Uy(R,f.type,f.pendingProps,ho),R!==null?(f.stateNode=R,wa=f,Or=yo(R.firstChild),ho=!1,B=!0):B=!1),B||$s(f)),de(f),B=f.type,G=f.pendingProps,se=o!==null?o.memoizedProps:null,R=G.children,eg(B,G)?R=null:se!==null&&eg(B,se)&&(f.flags|=32),f.memoizedState!==null&&(B=ql(o,f,Kt,null,null,x),Lp._currentValue=B),Xc(o,f),kr(o,f,R,x),f.child;case 6:return o===null&&tr&&((o=x=Or)&&(x=Ym(x,f.pendingProps,ho),x!==null?(f.stateNode=x,wa=f,Or=null,o=!0):o=!1),o||$s(f)),null;case 13:return bs(o,f,x);case 4:return sr(f,f.stateNode.containerInfo),R=f.pendingProps,o===null?f.child=Hu(f,null,R,x):kr(o,f,R,x),f.child;case 11:return Ql(o,f,f.type,f.pendingProps,x);case 7:return kr(o,f,f.pendingProps,x),f.child;case 8:return kr(o,f,f.pendingProps.children,x),f.child;case 12:return kr(o,f,f.pendingProps.children,x),f.child;case 10:return R=f.pendingProps,Ds(f,f.type,R.value),kr(o,f,R.children,x),f.child;case 9:return B=f.type._context,R=f.pendingProps.children,tl(f),B=Pr(B),R=R(B),f.flags|=1,kr(o,f,R,x),f.child;case 14:return cl(o,f,f.type,f.pendingProps,x);case 15:return Mm(o,f,f.type,f.pendingProps,x);case 19:return Tn(o,f,x);case 31:return R=f.pendingProps,x=f.mode,R={mode:R.mode,children:R.children},o===null?(x=ul(R,x),x.ref=f.ref,f.child=x,x.return=f,f=x):(x=jn(o.child,R),x.ref=f.ref,f.child=x,x.return=f,f=x),f;case 22:return Cm(o,f,x);case 24:return tl(f),R=Pr(Zr),o===null?(B=kl(),B===null&&(B=Ti,G=Ud(),B.pooledCache=G,G.refCount++,G!==null&&(B.pooledCacheLanes|=x),B=G),f.memoizedState={parent:R,cache:B},_i(f),Ds(f,Zr,B)):((o.lanes&x)!==0&&(Uh(o,f),Bc(f,null,null,x),Vl()),B=o.memoizedState,G=f.memoizedState,B.parent!==R?(B={parent:R,cache:R},f.memoizedState=B,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=B),Ds(f,Zr,R)):(R=G.cache,Ds(f,Zr,R),R!==B.cache&&Nh(f,[Zr],x,!0))),kr(o,f,f.pendingProps.children,x),f.child;case 29:throw f.pendingProps}throw Error(D(156,f.tag))}function Sa(o){o.flags|=4}function ss(o,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!dg(f)){if(f=On.current,f!==null&&((li&4194048)===li?po!==null:(li&62914560)!==li&&(li&536870912)===0||f!==po))throw kc=Hd,ku;o.flags|=8192}}function Qr(o,f){f!==null&&(o.flags|=4),o.flags&16384&&(f=o.tag!==22?dc():536870912,o.lanes|=f,Zn|=f)}function Ea(o,f){if(!tr)switch(o.tailMode){case"hidden":f=o.tail;for(var x=null;f!==null;)f.alternate!==null&&(x=f),f=f.sibling;x===null?o.tail=null:x.sibling=null;break;case"collapsed":x=o.tail;for(var R=null;x!==null;)x.alternate!==null&&(R=x),x=x.sibling;R===null?f||o.tail===null?o.tail=null:o.tail.sibling=null:R.sibling=null}}function Vn(o){var f=o.alternate!==null&&o.alternate.child===o.child,x=0,R=0;if(f)for(var B=o.child;B!==null;)x|=B.lanes|B.childLanes,R|=B.subtreeFlags&65011712,R|=B.flags&65011712,B.return=o,B=B.sibling;else for(B=o.child;B!==null;)x|=B.lanes|B.childLanes,R|=B.subtreeFlags,R|=B.flags,B.return=o,B=B.sibling;return o.subtreeFlags|=R,o.childLanes=x,f}function vp(o,f,x){var R=f.pendingProps;switch(Oh(f),f.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vn(f),null;case 1:return Vn(f),null;case 3:return x=f.stateNode,R=null,o!==null&&(R=o.memoizedState.cache),f.memoizedState.cache!==R&&(f.flags|=2048),Oo(Zr),Aa(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(o===null||o.child===null)&&(Ph(f)?Sa(f):o===null||o.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,vm())),Vn(f),null;case 26:return x=f.memoizedState,o===null?(Sa(f),x!==null?(Vn(f),ss(f,x)):(Vn(f),f.flags&=-16777217)):x?x!==o.memoizedState?(Sa(f),Vn(f),ss(f,x)):(Vn(f),f.flags&=-16777217):(o.memoizedProps!==R&&Sa(f),Vn(f),f.flags&=-16777217),null;case 27:us(f),x=Xi.current;var B=f.type;if(o!==null&&f.stateNode!=null)o.memoizedProps!==R&&Sa(f);else{if(!R){if(f.stateNode===null)throw Error(D(166));return Vn(f),null}o=ji.current,Ph(f)?gm(f):(o=rg(B,R,x),f.stateNode=o,Sa(f))}return Vn(f),null;case 5:if(us(f),x=f.type,o!==null&&f.stateNode!=null)o.memoizedProps!==R&&Sa(f);else{if(!R){if(f.stateNode===null)throw Error(D(166));return Vn(f),null}if(o=ji.current,Ph(f))gm(f);else{switch(B=Ap(Xi.current),o){case 1:o=B.createElementNS("http://www.w3.org/2000/svg",x);break;case 2:o=B.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;default:switch(x){case"svg":o=B.createElementNS("http://www.w3.org/2000/svg",x);break;case"math":o=B.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;case"script":o=B.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof R.is=="string"?B.createElement("select",{is:R.is}):B.createElement("select"),R.multiple?o.multiple=!0:R.size&&(o.size=R.size);break;default:o=typeof R.is=="string"?B.createElement(x,{is:R.is}):B.createElement(x)}}o[ge]=f,o[Ae]=R;e:for(B=f.child;B!==null;){if(B.tag===5||B.tag===6)o.appendChild(B.stateNode);else if(B.tag!==4&&B.tag!==27&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===f)break e;for(;B.sibling===null;){if(B.return===null||B.return===f)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}f.stateNode=o;e:switch(Za(o,x,R),x){case"button":case"input":case"select":case"textarea":o=!!R.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&Sa(f)}}return Vn(f),f.flags&=-16777217,null;case 6:if(o&&f.stateNode!=null)o.memoizedProps!==R&&Sa(f);else{if(typeof R!="string"&&f.stateNode===null)throw Error(D(166));if(o=Xi.current,Ph(f)){if(o=f.stateNode,x=f.memoizedProps,R=null,B=wa,B!==null)switch(B.tag){case 27:case 5:R=B.memoizedProps}o[ge]=f,o=!!(o.nodeValue===x||R!==null&&R.suppressHydrationWarning===!0||Zm(o.nodeValue,x)),o||$s(f)}else o=Ap(o).createTextNode(R),o[ge]=f,f.stateNode=o}return Vn(f),null;case 13:if(R=f.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(B=Ph(f),R!==null&&R.dehydrated!==null){if(o===null){if(!B)throw Error(D(318));if(B=f.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(D(317));B[ge]=f}else kh(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Vn(f),B=!1}else B=vm(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=B),B=!0;if(!B)return f.flags&256?(mo(f),f):(mo(f),null)}if(mo(f),(f.flags&128)!==0)return f.lanes=x,f;if(x=R!==null,o=o!==null&&o.memoizedState!==null,x){R=f.child,B=null,R.alternate!==null&&R.alternate.memoizedState!==null&&R.alternate.memoizedState.cachePool!==null&&(B=R.alternate.memoizedState.cachePool.pool);var G=null;R.memoizedState!==null&&R.memoizedState.cachePool!==null&&(G=R.memoizedState.cachePool.pool),G!==B&&(R.flags|=2048)}return x!==o&&x&&(f.child.flags|=8192),Qr(f,f.updateQueue),Vn(f),null;case 4:return Aa(),o===null&&Hm(f.stateNode.containerInfo),Vn(f),null;case 10:return Oo(f.type),Vn(f),null;case 19:if(Ei(jr),B=f.memoizedState,B===null)return Vn(f),null;if(R=(f.flags&128)!==0,G=B.rendering,G===null)if(R)Ea(B,!1);else{if(Pn!==0||o!==null&&(o.flags&128)!==0)for(o=f.child;o!==null;){if(G=Hc(o),G!==null){for(f.flags|=128,Ea(B,!1),o=G.updateQueue,f.updateQueue=o,Qr(f,o),f.subtreeFlags=0,o=x,x=f.child;x!==null;)_m(x,o),x=x.sibling;return Ot(jr,jr.current&1|2),f.child}o=o.sibling}B.tail!==null&&qr()>Dr&&(f.flags|=128,R=!0,Ea(B,!1),f.lanes=4194304)}else{if(!R)if(o=Hc(G),o!==null){if(f.flags|=128,R=!0,o=o.updateQueue,f.updateQueue=o,Qr(f,o),Ea(B,!0),B.tail===null&&B.tailMode==="hidden"&&!G.alternate&&!tr)return Vn(f),null}else 2*qr()-B.renderingStartTime>Dr&&x!==536870912&&(f.flags|=128,R=!0,Ea(B,!1),f.lanes=4194304);B.isBackwards?(G.sibling=f.child,f.child=G):(o=B.last,o!==null?o.sibling=G:f.child=G,B.last=G)}return B.tail!==null?(f=B.tail,B.rendering=f,B.tail=f.sibling,B.renderingStartTime=qr(),f.sibling=null,o=jr.current,Ot(jr,R?o&1|2:o&1),f):(Vn(f),null);case 22:case 23:return mo(f),Po(),R=f.memoizedState!==null,o!==null?o.memoizedState!==null!==R&&(f.flags|=8192):R&&(f.flags|=8192),R?(x&536870912)!==0&&(f.flags&128)===0&&(Vn(f),f.subtreeFlags&6&&(f.flags|=8192)):Vn(f),x=f.updateQueue,x!==null&&Qr(f,x.retryQueue),x=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(x=o.memoizedState.cachePool.pool),R=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(R=f.memoizedState.cachePool.pool),R!==x&&(f.flags|=2048),o!==null&&Ei(nl),null;case 24:return x=null,o!==null&&(x=o.memoizedState.cache),f.memoizedState.cache!==x&&(f.flags|=2048),Oo(Zr),Vn(f),null;case 25:return null;case 30:return null}throw Error(D(156,f.tag))}function os(o,f){switch(Oh(f),f.tag){case 1:return o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 3:return Oo(Zr),Aa(),o=f.flags,(o&65536)!==0&&(o&128)===0?(f.flags=o&-65537|128,f):null;case 26:case 27:case 5:return us(f),null;case 13:if(mo(f),o=f.memoizedState,o!==null&&o.dehydrated!==null){if(f.alternate===null)throw Error(D(340));kh()}return o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 19:return Ei(jr),null;case 4:return Aa(),null;case 10:return Oo(f.type),null;case 22:case 23:return mo(f),Po(),o!==null&&Ei(nl),o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 24:return Oo(Zr),null;case 25:return null;default:return null}}function xp(o,f){switch(Oh(f),f.tag){case 3:Oo(Zr),Aa();break;case 26:case 27:case 5:us(f);break;case 4:Aa();break;case 13:mo(f);break;case 19:Ei(jr);break;case 10:Oo(f.type);break;case 22:case 23:mo(f),Po(),o!==null&&Ei(nl);break;case 24:Oo(Zr)}}function Qs(o,f){try{var x=f.updateQueue,R=x!==null?x.lastEffect:null;if(R!==null){var B=R.next;x=B;do{if((x.tag&o)===o){R=void 0;var G=x.create,se=x.inst;R=G(),se.destroy=R}x=x.next}while(x!==B)}}catch(be){zr(f,f.return,be)}}function ic(o,f,x){try{var R=f.updateQueue,B=R!==null?R.lastEffect:null;if(B!==null){var G=B.next;R=G;do{if((R.tag&o)===o){var se=R.inst,be=se.destroy;if(be!==void 0){se.destroy=void 0,B=f;var Ye=x,Et=be;try{Et()}catch(Zt){zr(B,Ye,Zt)}}}R=R.next}while(R!==G)}}catch(Zt){zr(f,f.return,Zt)}}function h(o){var f=o.updateQueue;if(f!==null){var x=o.stateNode;try{Xd(f,x)}catch(R){zr(o,o.return,R)}}}function t(o,f,x){x.props=Js(o.type,o.memoizedProps),x.state=o.memoizedState;try{x.componentWillUnmount()}catch(R){zr(o,f,R)}}function n(o,f){try{var x=o.ref;if(x!==null){switch(o.tag){case 26:case 27:case 5:var R=o.stateNode;break;case 30:R=o.stateNode;break;default:R=o.stateNode}typeof x=="function"?o.refCleanup=x(R):x.current=R}}catch(B){zr(o,f,B)}}function u(o,f){var x=o.ref,R=o.refCleanup;if(x!==null)if(typeof R=="function")try{R()}catch(B){zr(o,f,B)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof x=="function")try{x(null)}catch(B){zr(o,f,B)}else x.current=null}function p(o){var f=o.type,x=o.memoizedProps,R=o.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":x.autoFocus&&R.focus();break e;case"img":x.src?R.src=x.src:x.srcSet&&(R.srcset=x.srcSet)}}catch(B){zr(o,o.return,B)}}function g(o,f,x){try{var R=o.stateNode;ky(R,o.type,x,f),R[Ae]=f}catch(B){zr(o,o.return,B)}}function b(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&eu(o.type)||o.tag===4}function I(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||b(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&eu(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function L(o,f,x){var R=o.tag;if(R===5||R===6)o=o.stateNode,f?(x.nodeType===9?x.body:x.nodeName==="HTML"?x.ownerDocument.body:x).insertBefore(o,f):(f=x.nodeType===9?x.body:x.nodeName==="HTML"?x.ownerDocument.body:x,f.appendChild(o),x=x._reactRootContainer,x!=null||f.onclick!==null||(f.onclick=Tf));else if(R!==4&&(R===27&&eu(o.type)&&(x=o.stateNode,f=null),o=o.child,o!==null))for(L(o,f,x),o=o.sibling;o!==null;)L(o,f,x),o=o.sibling}function P(o,f,x){var R=o.tag;if(R===5||R===6)o=o.stateNode,f?x.insertBefore(o,f):x.appendChild(o);else if(R!==4&&(R===27&&eu(o.type)&&(x=o.stateNode),o=o.child,o!==null))for(P(o,f,x),o=o.sibling;o!==null;)P(o,f,x),o=o.sibling}function k(o){var f=o.stateNode,x=o.memoizedProps;try{for(var R=o.type,B=f.attributes;B.length;)f.removeAttributeNode(B[0]);Za(f,R,x),f[ge]=o,f[Ae]=x}catch(G){zr(o,o.return,G)}}var U=!1,j=!1,$=!1,Q=typeof WeakSet=="function"?WeakSet:Set,W=null;function te(o,f){if(o=o.containerInfo,Ep=i_,o=pm(o),Ah(o)){if("selectionStart"in o)var x={start:o.selectionStart,end:o.selectionEnd};else e:{x=(x=o.ownerDocument)&&x.defaultView||window;var R=x.getSelection&&x.getSelection();if(R&&R.rangeCount!==0){x=R.anchorNode;var B=R.anchorOffset,G=R.focusNode;R=R.focusOffset;try{x.nodeType,G.nodeType}catch{x=null;break e}var se=0,be=-1,Ye=-1,Et=0,Zt=0,Qt=o,It=null;t:for(;;){for(var Lt;Qt!==x||B!==0&&Qt.nodeType!==3||(be=se+B),Qt!==G||R!==0&&Qt.nodeType!==3||(Ye=se+R),Qt.nodeType===3&&(se+=Qt.nodeValue.length),(Lt=Qt.firstChild)!==null;)It=Qt,Qt=Lt;for(;;){if(Qt===o)break t;if(It===x&&++Et===B&&(be=se),It===G&&++Zt===R&&(Ye=se),(Lt=Qt.nextSibling)!==null)break;Qt=It,It=Qt.parentNode}Qt=Lt}x=be===-1||Ye===-1?null:{start:be,end:Ye}}else x=null}x=x||{start:0,end:0}}else x=null;for(Go={focusedElem:o,selectionRange:x},i_=!1,W=f;W!==null;)if(f=W,o=f.child,(f.subtreeFlags&1024)!==0&&o!==null)o.return=f,W=o;else for(;W!==null;){switch(f=W,G=f.alternate,o=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&G!==null){o=void 0,x=f,B=G.memoizedProps,G=G.memoizedState,R=x.stateNode;try{var En=Js(x.type,B,x.elementType===x.type);o=R.getSnapshotBeforeUpdate(En,G),R.__reactInternalSnapshotBeforeUpdate=o}catch(vn){zr(x,x.return,vn)}}break;case 3:if((o&1024)!==0){if(o=f.stateNode.containerInfo,x=o.nodeType,x===9)Sf(o);else if(x===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":Sf(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(D(163))}if(o=f.sibling,o!==null){o.return=f.return,W=o;break}W=f.return}}function ne(o,f,x){var R=x.flags;switch(x.tag){case 0:case 11:case 15:Ct(o,x),R&4&&Qs(5,x);break;case 1:if(Ct(o,x),R&4)if(o=x.stateNode,f===null)try{o.componentDidMount()}catch(se){zr(x,x.return,se)}else{var B=Js(x.type,f.memoizedProps);f=f.memoizedState;try{o.componentDidUpdate(B,f,o.__reactInternalSnapshotBeforeUpdate)}catch(se){zr(x,x.return,se)}}R&64&&h(x),R&512&&n(x,x.return);break;case 3:if(Ct(o,x),R&64&&(o=x.updateQueue,o!==null)){if(f=null,x.child!==null)switch(x.child.tag){case 27:case 5:f=x.child.stateNode;break;case 1:f=x.child.stateNode}try{Xd(o,f)}catch(se){zr(x,x.return,se)}}break;case 27:f===null&&R&4&&k(x);case 26:case 5:Ct(o,x),f===null&&R&4&&p(x),R&512&&n(x,x.return);break;case 12:Ct(o,x);break;case 13:Ct(o,x),R&4&&ve(o,x),R&64&&(o=x.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(x=M0.bind(null,x),ng(o,x))));break;case 22:if(R=x.memoizedState!==null||U,!R){f=f!==null&&f.memoizedState!==null||j,B=U;var G=j;U=R,(j=f)&&!G?ut(o,x,(x.subtreeFlags&8772)!==0):Ct(o,x),U=B,j=G}break;case 30:break;default:Ct(o,x)}}function ce(o){var f=o.alternate;f!==null&&(o.alternate=null,ce(f)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(f=o.stateNode,f!==null&&rt(f)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var me=null,fe=!1;function we(o,f,x){for(x=x.child;x!==null;)ye(o,f,x),x=x.sibling}function ye(o,f,x){if(ri&&typeof ri.onCommitFiberUnmount=="function")try{ri.onCommitFiberUnmount(gi,x)}catch{}switch(x.tag){case 26:j||u(x,f),we(o,f,x),x.memoizedState?x.memoizedState.count--:x.stateNode&&(x=x.stateNode,x.parentNode.removeChild(x));break;case 27:j||u(x,f);var R=me,B=fe;eu(x.type)&&(me=x.stateNode,fe=!1),we(o,f,x),Ef(x.stateNode),me=R,fe=B;break;case 5:j||u(x,f);case 6:if(R=me,B=fe,me=null,we(o,f,x),me=R,fe=B,me!==null)if(fe)try{(me.nodeType===9?me.body:me.nodeName==="HTML"?me.ownerDocument.body:me).removeChild(x.stateNode)}catch(G){zr(x,f,G)}else try{me.removeChild(x.stateNode)}catch(G){zr(x,f,G)}break;case 18:me!==null&&(fe?(o=me,ig(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,x.stateNode),Xr(o)):ig(me,x.stateNode));break;case 4:R=me,B=fe,me=x.stateNode.containerInfo,fe=!0,we(o,f,x),me=R,fe=B;break;case 0:case 11:case 14:case 15:j||ic(2,x,f),j||ic(4,x,f),we(o,f,x);break;case 1:j||(u(x,f),R=x.stateNode,typeof R.componentWillUnmount=="function"&&t(x,f,R)),we(o,f,x);break;case 21:we(o,f,x);break;case 22:j=(R=j)||x.memoizedState!==null,we(o,f,x),j=R;break;default:we(o,f,x)}}function ve(o,f){if(f.memoizedState===null&&(o=f.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Xr(o)}catch(x){zr(f,f.return,x)}}function xe(o){switch(o.tag){case 13:case 19:var f=o.stateNode;return f===null&&(f=o.stateNode=new Q),f;case 22:return o=o.stateNode,f=o._retryCache,f===null&&(f=o._retryCache=new Q),f;default:throw Error(D(435,o.tag))}}function Se(o,f){var x=xe(o);f.forEach(function(R){var B=ia.bind(null,o,R);x.has(R)||(x.add(R),R.then(B,B))})}function Ce(o,f){var x=f.deletions;if(x!==null)for(var R=0;R<x.length;R++){var B=x[R],G=o,se=f,be=se;e:for(;be!==null;){switch(be.tag){case 27:if(eu(be.type)){me=be.stateNode,fe=!1;break e}break;case 5:me=be.stateNode,fe=!1;break e;case 3:case 4:me=be.stateNode.containerInfo,fe=!0;break e}be=be.return}if(me===null)throw Error(D(160));ye(G,se,B),me=null,fe=!1,G=B.alternate,G!==null&&(G.return=null),B.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)Ge(f,o),f=f.sibling}var Ke=null;function Ge(o,f){var x=o.alternate,R=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Ce(f,o),ct(o),R&4&&(ic(3,o,o.return),Qs(3,o),ic(5,o,o.return));break;case 1:Ce(f,o),ct(o),R&512&&(j||x===null||u(x,x.return)),R&64&&U&&(o=o.updateQueue,o!==null&&(R=o.callbacks,R!==null&&(x=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=x===null?R:x.concat(R))));break;case 26:var B=Ke;if(Ce(f,o),ct(o),R&512&&(j||x===null||u(x,x.return)),R&4){var G=x!==null?x.memoizedState:null;if(R=o.memoizedState,x===null)if(R===null)if(o.stateNode===null){e:{R=o.type,x=o.memoizedProps,B=B.ownerDocument||B;t:switch(R){case"title":G=B.getElementsByTagName("title")[0],(!G||G[lt]||G[ge]||G.namespaceURI==="http://www.w3.org/2000/svg"||G.hasAttribute("itemprop"))&&(G=B.createElement(R),B.head.insertBefore(G,B.querySelector("head > title"))),Za(G,R,x),G[ge]=o,Ai(G),R=G;break e;case"link":var se=ug("link","href",B).get(R+(x.href||""));if(se){for(var be=0;be<se.length;be++)if(G=se[be],G.getAttribute("href")===(x.href==null||x.href===""?null:x.href)&&G.getAttribute("rel")===(x.rel==null?null:x.rel)&&G.getAttribute("title")===(x.title==null?null:x.title)&&G.getAttribute("crossorigin")===(x.crossOrigin==null?null:x.crossOrigin)){se.splice(be,1);break t}}G=B.createElement(R),Za(G,R,x),B.head.appendChild(G);break;case"meta":if(se=ug("meta","content",B).get(R+(x.content||""))){for(be=0;be<se.length;be++)if(G=se[be],G.getAttribute("content")===(x.content==null?null:""+x.content)&&G.getAttribute("name")===(x.name==null?null:x.name)&&G.getAttribute("property")===(x.property==null?null:x.property)&&G.getAttribute("http-equiv")===(x.httpEquiv==null?null:x.httpEquiv)&&G.getAttribute("charset")===(x.charSet==null?null:x.charSet)){se.splice(be,1);break t}}G=B.createElement(R),Za(G,R,x),B.head.appendChild(G);break;default:throw Error(D(468,R))}G[ge]=o,Ai(G),R=G}o.stateNode=R}else hg(B,o.type,o.stateNode);else o.stateNode=Rp(B,R,o.memoizedProps);else G!==R?(G===null?x.stateNode!==null&&(x=x.stateNode,x.parentNode.removeChild(x)):G.count--,R===null?hg(B,o.type,o.stateNode):Rp(B,R,o.memoizedProps)):R===null&&o.stateNode!==null&&g(o,o.memoizedProps,x.memoizedProps)}break;case 27:Ce(f,o),ct(o),R&512&&(j||x===null||u(x,x.return)),x!==null&&R&4&&g(o,o.memoizedProps,x.memoizedProps);break;case 5:if(Ce(f,o),ct(o),R&512&&(j||x===null||u(x,x.return)),o.flags&32){B=o.stateNode;try{oo(B,"")}catch(Lt){zr(o,o.return,Lt)}}R&4&&o.stateNode!=null&&(B=o.memoizedProps,g(o,B,x!==null?x.memoizedProps:B)),R&1024&&($=!0);break;case 6:if(Ce(f,o),ct(o),R&4){if(o.stateNode===null)throw Error(D(162));R=o.memoizedProps,x=o.stateNode;try{x.nodeValue=R}catch(Lt){zr(o,o.return,Lt)}}break;case 3:if(Df=null,B=Ke,Ke=Af(f.containerInfo),Ce(f,o),Ke=B,ct(o),R&4&&x!==null&&x.memoizedState.isDehydrated)try{Xr(f.containerInfo)}catch(Lt){zr(o,o.return,Lt)}$&&($=!1,_t(o));break;case 4:R=Ke,Ke=Af(o.stateNode.containerInfo),Ce(f,o),ct(o),Ke=R;break;case 12:Ce(f,o),ct(o);break;case 13:Ce(f,o),ct(o),o.child.flags&8192&&o.memoizedState!==null!=(x!==null&&x.memoizedState!==null)&&(Qn=qr()),R&4&&(R=o.updateQueue,R!==null&&(o.updateQueue=null,Se(o,R)));break;case 22:B=o.memoizedState!==null;var Ye=x!==null&&x.memoizedState!==null,Et=U,Zt=j;if(U=Et||B,j=Zt||Ye,Ce(f,o),j=Zt,U=Et,ct(o),R&8192)e:for(f=o.stateNode,f._visibility=B?f._visibility&-2:f._visibility|1,B&&(x===null||Ye||U||j||Ve(o)),x=null,f=o;;){if(f.tag===5||f.tag===26){if(x===null){Ye=x=f;try{if(G=Ye.stateNode,B)se=G.style,typeof se.setProperty=="function"?se.setProperty("display","none","important"):se.display="none";else{be=Ye.stateNode;var Qt=Ye.memoizedProps.style,It=Qt!=null&&Qt.hasOwnProperty("display")?Qt.display:null;be.style.display=It==null||typeof It=="boolean"?"":(""+It).trim()}}catch(Lt){zr(Ye,Ye.return,Lt)}}}else if(f.tag===6){if(x===null){Ye=f;try{Ye.stateNode.nodeValue=B?"":Ye.memoizedProps}catch(Lt){zr(Ye,Ye.return,Lt)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===o)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===o)break e;for(;f.sibling===null;){if(f.return===null||f.return===o)break e;x===f&&(x=null),f=f.return}x===f&&(x=null),f.sibling.return=f.return,f=f.sibling}R&4&&(R=o.updateQueue,R!==null&&(x=R.retryQueue,x!==null&&(R.retryQueue=null,Se(o,x))));break;case 19:Ce(f,o),ct(o),R&4&&(R=o.updateQueue,R!==null&&(o.updateQueue=null,Se(o,R)));break;case 30:break;case 21:break;default:Ce(f,o),ct(o)}}function ct(o){var f=o.flags;if(f&2){try{for(var x,R=o.return;R!==null;){if(b(R)){x=R;break}R=R.return}if(x==null)throw Error(D(160));switch(x.tag){case 27:var B=x.stateNode,G=I(o);P(o,G,B);break;case 5:var se=x.stateNode;x.flags&32&&(oo(se,""),x.flags&=-33);var be=I(o);P(o,be,se);break;case 3:case 4:var Ye=x.stateNode.containerInfo,Et=I(o);L(o,Et,Ye);break;default:throw Error(D(161))}}catch(Zt){zr(o,o.return,Zt)}o.flags&=-3}f&4096&&(o.flags&=-4097)}function _t(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var f=o;_t(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),o=o.sibling}}function Ct(o,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)ne(o,f.alternate,f),f=f.sibling}function Ve(o){for(o=o.child;o!==null;){var f=o;switch(f.tag){case 0:case 11:case 14:case 15:ic(4,f,f.return),Ve(f);break;case 1:u(f,f.return);var x=f.stateNode;typeof x.componentWillUnmount=="function"&&t(f,f.return,x),Ve(f);break;case 27:Ef(f.stateNode);case 26:case 5:u(f,f.return),Ve(f);break;case 22:f.memoizedState===null&&Ve(f);break;case 30:Ve(f);break;default:Ve(f)}o=o.sibling}}function ut(o,f,x){for(x=x&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var R=f.alternate,B=o,G=f,se=G.flags;switch(G.tag){case 0:case 11:case 15:ut(B,G,x),Qs(4,G);break;case 1:if(ut(B,G,x),R=G,B=R.stateNode,typeof B.componentDidMount=="function")try{B.componentDidMount()}catch(Et){zr(R,R.return,Et)}if(R=G,B=R.updateQueue,B!==null){var be=R.stateNode;try{var Ye=B.shared.hiddenCallbacks;if(Ye!==null)for(B.shared.hiddenCallbacks=null,B=0;B<Ye.length;B++)lp(Ye[B],be)}catch(Et){zr(R,R.return,Et)}}x&&se&64&&h(G),n(G,G.return);break;case 27:k(G);case 26:case 5:ut(B,G,x),x&&R===null&&se&4&&p(G),n(G,G.return);break;case 12:ut(B,G,x);break;case 13:ut(B,G,x),x&&se&4&&ve(B,G);break;case 22:G.memoizedState===null&&ut(B,G,x),n(G,G.return);break;case 30:break;default:ut(B,G,x)}f=f.sibling}}function Ne(o,f){var x=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(x=o.memoizedState.cachePool.pool),o=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(o=f.memoizedState.cachePool.pool),o!==x&&(o!=null&&o.refCount++,x!=null&&Ou(x))}function ht(o,f){o=null,f.alternate!==null&&(o=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==o&&(f.refCount++,o!=null&&Ou(o))}function nt(o,f,x,R){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)yt(o,f,x,R),f=f.sibling}function yt(o,f,x,R){var B=f.flags;switch(f.tag){case 0:case 11:case 15:nt(o,f,x,R),B&2048&&Qs(9,f);break;case 1:nt(o,f,x,R);break;case 3:nt(o,f,x,R),B&2048&&(o=null,f.alternate!==null&&(o=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==o&&(f.refCount++,o!=null&&Ou(o)));break;case 12:if(B&2048){nt(o,f,x,R),o=f.stateNode;try{var G=f.memoizedProps,se=G.id,be=G.onPostCommit;typeof be=="function"&&be(se,f.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(Ye){zr(f,f.return,Ye)}}else nt(o,f,x,R);break;case 13:nt(o,f,x,R);break;case 23:break;case 22:G=f.stateNode,se=f.alternate,f.memoizedState!==null?G._visibility&2?nt(o,f,x,R):gt(o,f):G._visibility&2?nt(o,f,x,R):(G._visibility|=2,et(o,f,x,R,(f.subtreeFlags&10256)!==0)),B&2048&&Ne(se,f);break;case 24:nt(o,f,x,R),B&2048&&ht(f.alternate,f);break;default:nt(o,f,x,R)}}function et(o,f,x,R,B){for(B=B&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var G=o,se=f,be=x,Ye=R,Et=se.flags;switch(se.tag){case 0:case 11:case 15:et(G,se,be,Ye,B),Qs(8,se);break;case 23:break;case 22:var Zt=se.stateNode;se.memoizedState!==null?Zt._visibility&2?et(G,se,be,Ye,B):gt(G,se):(Zt._visibility|=2,et(G,se,be,Ye,B)),B&&Et&2048&&Ne(se.alternate,se);break;case 24:et(G,se,be,Ye,B),B&&Et&2048&&ht(se.alternate,se);break;default:et(G,se,be,Ye,B)}f=f.sibling}}function gt(o,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var x=o,R=f,B=R.flags;switch(R.tag){case 22:gt(x,R),B&2048&&Ne(R.alternate,R);break;case 24:gt(x,R),B&2048&&ht(R.alternate,R);break;default:gt(x,R)}f=f.sibling}}var Vt=8192;function Ut(o){if(o.subtreeFlags&Vt)for(o=o.child;o!==null;)Gt(o),o=o.sibling}function Gt(o){switch(o.tag){case 26:Ut(o),o.flags&Vt&&o.memoizedState!==null&&Zy(Ke,o.memoizedState,o.memoizedProps);break;case 5:Ut(o);break;case 3:case 4:var f=Ke;Ke=Af(o.stateNode.containerInfo),Ut(o),Ke=f;break;case 22:o.memoizedState===null&&(f=o.alternate,f!==null&&f.memoizedState!==null?(f=Vt,Vt=16777216,Ut(o),Vt=f):Ut(o));break;default:Ut(o)}}function oi(o){var f=o.alternate;if(f!==null&&(o=f.child,o!==null)){f.child=null;do f=o.sibling,o.sibling=null,o=f;while(o!==null)}}function Di(o){var f=o.deletions;if((o.flags&16)!==0){if(f!==null)for(var x=0;x<f.length;x++){var R=f[x];W=R,Ci(R,o)}oi(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)xi(o),o=o.sibling}function xi(o){switch(o.tag){case 0:case 11:case 15:Di(o),o.flags&2048&&ic(9,o,o.return);break;case 3:Di(o);break;case 12:Di(o);break;case 22:var f=o.stateNode;o.memoizedState!==null&&f._visibility&2&&(o.return===null||o.return.tag!==13)?(f._visibility&=-3,Ri(o)):Di(o);break;default:Di(o)}}function Ri(o){var f=o.deletions;if((o.flags&16)!==0){if(f!==null)for(var x=0;x<f.length;x++){var R=f[x];W=R,Ci(R,o)}oi(o)}for(o=o.child;o!==null;){switch(f=o,f.tag){case 0:case 11:case 15:ic(8,f,f.return),Ri(f);break;case 22:x=f.stateNode,x._visibility&2&&(x._visibility&=-3,Ri(f));break;default:Ri(f)}o=o.sibling}}function Ci(o,f){for(;W!==null;){var x=W;switch(x.tag){case 0:case 11:case 15:ic(8,x,f);break;case 23:case 22:if(x.memoizedState!==null&&x.memoizedState.cachePool!==null){var R=x.memoizedState.cachePool.pool;R!=null&&R.refCount++}break;case 24:Ou(x.memoizedState.cache)}if(R=x.child,R!==null)R.return=x,W=R;else e:for(x=o;W!==null;){R=W;var B=R.sibling,G=R.return;if(ce(R),R===x){W=null;break e}if(B!==null){B.return=G,W=B;break e}W=G}}}var on={getCacheForType:function(o){var f=Pr(Zr),x=f.data.get(o);return x===void 0&&(x=o(),f.data.set(o,x)),x}},Sn=typeof WeakMap=="function"?WeakMap:Map,Gi=0,Ti=null,Fi=null,li=0,jt=0,Hi=null,pn=!1,hn=!1,hr=!1,rr=0,Pn=0,vr=0,fa=0,pa=0,Ki=0,Zn=0,mn=null,fn=null,ea=!1,Qn=0,Dr=1/0,Ls=null,ta=null,xr=0,$r=null,Oa=null,ma=0,_o=0,eo=null,jo=null,Wc=0,nc=null;function Ha(){if((Gi&2)!==0&&li!==0)return li&-li;if(pt.T!==null){var o=zc;return o!==0?o:Nm()}return at()}function _f(){Ki===0&&(Ki=(li&536870912)===0||tr?bu():536870912);var o=On.current;return o!==null&&(o.flags|=32),Ki}function to(o,f,x){(o===Ti&&(jt===2||jt===9)||o.cancelPendingCommit!==null)&&(ad(o,0),Kc(o,li,Ki,!1)),so(o,x),((Gi&2)===0||o!==Ti)&&(o===Ti&&((Gi&2)===0&&(fa|=x),Pn===4&&Kc(o,li,Ki,!1)),io(o))}function by(o,f,x){if((Gi&6)!==0)throw Error(D(327));var R=!x&&(f&124)===0&&(f&o.expiredLanes)===0||Kn(o,f),B=R?wp(o,f):ua(o,f,!0),G=R;do{if(B===0){hn&&!R&&Kc(o,f,0,!1);break}else{if(x=o.current.alternate,G&&!Ty(x)){B=ua(o,f,!1),G=!1;continue}if(B===2){if(G=f,o.errorRecoveryDisabledLanes&G)var se=0;else se=o.pendingLanes&-536870913,se=se!==0?se:se&536870912?536870912:0;if(se!==0){f=se;e:{var be=o;B=mn;var Ye=be.current.memoizedState.isDehydrated;if(Ye&&(ad(be,se).flags|=256),se=ua(be,se,!1),se!==2){if(hr&&!Ye){be.errorRecoveryDisabledLanes|=G,fa|=G,B=4;break e}G=fn,fn=B,G!==null&&(fn===null?fn=G:fn.push.apply(fn,G))}B=se}if(G=!1,B!==2)continue}}if(B===1){ad(o,0),Kc(o,f,0,!0);break}e:{switch(R=o,G=B,G){case 0:case 1:throw Error(D(345));case 4:if((f&4194048)!==f)break;case 6:Kc(R,f,Ki,!pn);break e;case 2:fn=null;break;case 3:case 5:break;default:throw Error(D(329))}if((f&62914560)===f&&(B=Qn+300-qr(),10<B)){if(Kc(R,f,Ki,!pn),Ns(R,0,!0)!==0)break e;R.timeoutHandle=Fy(wy.bind(null,R,x,fn,Ls,ea,f,Ki,fa,Zn,pn,G,2,-0,0),B);break e}wy(R,x,fn,Ls,ea,f,Ki,fa,Zn,pn,G,0,-0,0)}}break}while(!0);io(o)}function wy(o,f,x,R,B,G,se,be,Ye,Et,Zt,Qt,It,Lt){if(o.timeoutHandle=-1,Qt=f.subtreeFlags,(Qt&8192||(Qt&16785408)===16785408)&&(zf={stylesheets:null,count:0,unsuspend:O0},Gt(f),Qt=$y(),Qt!==null)){o.cancelPendingCommit=Qt(Ku.bind(null,o,f,G,x,R,B,se,be,Ye,Zt,1,It,Lt)),Kc(o,G,se,!Et);return}Ku(o,f,G,x,R,B,se,be,Ye)}function Ty(o){for(var f=o;;){var x=f.tag;if((x===0||x===11||x===15)&&f.flags&16384&&(x=f.updateQueue,x!==null&&(x=x.stores,x!==null)))for(var R=0;R<x.length;R++){var B=x[R],G=B.getSnapshot;B=B.value;try{if(!ba(G(),B))return!1}catch{return!1}}if(x=f.child,f.subtreeFlags&16384&&x!==null)x.return=f,f=x;else{if(f===o)break;for(;f.sibling===null;){if(f.return===null||f.return===o)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function Kc(o,f,x,R){f&=~pa,f&=~fa,o.suspendedLanes|=f,o.pingedLanes&=~f,R&&(o.warmLanes|=f),R=o.expirationTimes;for(var B=f;0<B;){var G=31-sn(B),se=1<<G;R[G]=-1,B&=~se}x!==0&&fc(o,x,f)}function bp(){return(Gi&6)===0?(od(0),!1):!0}function Rm(){if(Fi!==null){if(jt===0)var o=Fi.return;else o=Fi,fo=el=null,$e(o),Gc=null,ll=0,o=Fi;for(;o!==null;)xp(o.alternate,o),o=o.return;Fi=null}}function ad(o,f){var x=o.timeoutHandle;x!==-1&&(o.timeoutHandle=-1,R0(x)),x=o.cancelPendingCommit,x!==null&&(o.cancelPendingCommit=null,x()),Rm(),Ti=o,Fi=x=jn(o.current,null),li=f,jt=0,Hi=null,pn=!1,hn=Kn(o,f),hr=!1,Zn=Ki=pa=fa=vr=Pn=0,fn=mn=null,ea=!1,(f&8)!==0&&(f|=f&32);var R=o.entangledLanes;if(R!==0)for(o=o.entanglements,R&=f;0<R;){var B=31-sn(R),G=1<<B;f|=o[B],R&=~G}return rr=f,Ru(),x}function H_(o,f){Bn=null,pt.H=td,f===Bl||f===Vh?(f=Zd(),jt=3):f===ku?(f=Zd(),jt=4):jt=f===Uo?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Hi=f,Fi===null&&(Pn=1,$u(o,ja(f,o.current)))}function Z_(){var o=pt.H;return pt.H=td,o===null?td:o}function Dm(){var o=pt.A;return pt.A=on,o}function rc(){Pn=4,pn||(li&4194048)!==li&&On.current!==null||(hn=!0),(vr&134217727)===0&&(fa&134217727)===0||Ti===null||Kc(Ti,li,Ki,!1)}function ua(o,f,x){var R=Gi;Gi|=2;var B=Z_(),G=Dm();(Ti!==o||li!==f)&&(Ls=null,ad(o,f)),f=!1;var se=Pn;e:do try{if(jt!==0&&Fi!==null){var be=Fi,Ye=Hi;switch(jt){case 8:Rm(),se=6;break e;case 3:case 2:case 9:case 6:On.current===null&&(f=!0);var Et=jt;if(jt=0,Hi=null,gf(o,be,Ye,Et),x&&hn){se=0;break e}break;default:Et=jt,jt=0,Hi=null,gf(o,be,Ye,Et)}}Sy(),se=Pn;break}catch(Zt){H_(o,Zt)}while(!0);return f&&o.shellSuspendCounter++,fo=el=null,Gi=R,pt.H=B,pt.A=G,Fi===null&&(Ti=null,li=0,Ru()),se}function Sy(){for(;Fi!==null;)Ey(Fi)}function wp(o,f){var x=Gi;Gi|=2;var R=Z_(),B=Dm();Ti!==o||li!==f?(Ls=null,Dr=qr()+500,ad(o,f)):hn=Kn(o,f);e:do try{if(jt!==0&&Fi!==null){f=Fi;var G=Hi;t:switch(jt){case 1:jt=0,Hi=null,gf(o,f,G,1);break;case 2:case 9:if(Oc(G)){jt=0,Hi=null,Ay(f);break}f=function(){jt!==2&&jt!==9||Ti!==o||(jt=7),io(o)},G.then(f,f);break e;case 3:jt=7;break e;case 4:jt=5;break e;case 7:Oc(G)?(jt=0,Hi=null,Ay(f)):(jt=0,Hi=null,gf(o,f,G,7));break;case 5:var se=null;switch(Fi.tag){case 26:se=Fi.memoizedState;case 5:case 27:var be=Fi;if(!se||dg(se)){jt=0,Hi=null;var Ye=be.sibling;if(Ye!==null)Fi=Ye;else{var Et=be.return;Et!==null?(Fi=Et,Wu(Et)):Fi=null}break t}}jt=0,Hi=null,gf(o,f,G,5);break;case 6:jt=0,Hi=null,gf(o,f,G,6);break;case 8:Rm(),Pn=6;break e;default:throw Error(D(462))}}E0();break}catch(Zt){H_(o,Zt)}while(!0);return fo=el=null,pt.H=R,pt.A=B,Gi=x,Fi!==null?0:(Ti=null,li=0,Ru(),Pn)}function E0(){for(;Fi!==null&&!Ss();)Ey(Fi)}function Ey(o){var f=rd(o.alternate,o,rr);o.memoizedProps=o.pendingProps,f===null?Wu(o):Fi=f}function Ay(o){var f=o,x=f.alternate;switch(f.tag){case 15:case 0:f=La(x,f,f.pendingProps,f.type,void 0,li);break;case 11:f=La(x,f,f.pendingProps,f.type.render,f.ref,li);break;case 5:$e(f);default:xp(x,f),f=Fi=_m(f,rr),f=rd(x,f,rr)}o.memoizedProps=o.pendingProps,f===null?Wu(o):Fi=f}function gf(o,f,x,R){fo=el=null,$e(f),Gc=null,ll=0;var B=f.return;try{if($c(o,B,f,x,li)){Pn=1,$u(o,ja(x,o.current)),Fi=null;return}}catch(G){if(B!==null)throw Fi=B,G;Pn=1,$u(o,ja(x,o.current)),Fi=null;return}f.flags&32768?(tr||R===1?o=!0:hn||(li&536870912)!==0?o=!1:(pn=o=!0,(R===2||R===9||R===3||R===6)&&(R=On.current,R!==null&&R.tag===13&&(R.flags|=16384))),$_(f,o)):Wu(f)}function Wu(o){var f=o;do{if((f.flags&32768)!==0){$_(f,pn);return}o=f.return;var x=vp(f.alternate,f,rr);if(x!==null){Fi=x;return}if(f=f.sibling,f!==null){Fi=f;return}Fi=f=o}while(f!==null);Pn===0&&(Pn=5)}function $_(o,f){do{var x=os(o.alternate,o);if(x!==null){x.flags&=32767,Fi=x;return}if(x=o.return,x!==null&&(x.flags|=32768,x.subtreeFlags=0,x.deletions=null),!f&&(o=o.sibling,o!==null)){Fi=o;return}Fi=o=x}while(o!==null);Pn=6,Fi=null}function Ku(o,f,x,R,B,G,se,be,Ye){o.cancelPendingCommit=null;do zm();while(xr!==0);if((Gi&6)!==0)throw Error(D(327));if(f!==null){if(f===o.current)throw Error(D(177));if(G=f.lanes|f.childLanes,G|=zl,fh(o,x,G,se,be,Ye),o===Ti&&(Fi=Ti=null,li=0),Oa=f,$r=o,ma=x,_o=G,eo=B,jo=R,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,Lm(Es,function(){return Ry(),null})):(o.callbackNode=null,o.callbackPriority=0),R=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||R){R=pt.T,pt.T=null,B=ni.p,ni.p=2,se=Gi,Gi|=4;try{te(o,f,x)}finally{Gi=se,ni.p=B,pt.T=R}}xr=1,yf(),My(),Cy()}}function yf(){if(xr===1){xr=0;var o=$r,f=Oa,x=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||x){x=pt.T,pt.T=null;var R=ni.p;ni.p=2;var B=Gi;Gi|=4;try{Ge(f,o);var G=Go,se=pm(o.containerInfo),be=G.focusedElem,Ye=G.selectionRange;if(se!==be&&be&&be.ownerDocument&&fm(be.ownerDocument.documentElement,be)){if(Ye!==null&&Ah(be)){var Et=Ye.start,Zt=Ye.end;if(Zt===void 0&&(Zt=Et),"selectionStart"in be)be.selectionStart=Et,be.selectionEnd=Math.min(Zt,be.value.length);else{var Qt=be.ownerDocument||document,It=Qt&&Qt.defaultView||window;if(It.getSelection){var Lt=It.getSelection(),En=be.textContent.length,vn=Math.min(Ye.start,En),Sr=Ye.end===void 0?vn:Math.min(Ye.end,En);!Lt.extend&&vn>Sr&&(se=Sr,Sr=vn,vn=se);var dt=wc(be,vn),st=wc(be,Sr);if(dt&&st&&(Lt.rangeCount!==1||Lt.anchorNode!==dt.node||Lt.anchorOffset!==dt.offset||Lt.focusNode!==st.node||Lt.focusOffset!==st.offset)){var wt=Qt.createRange();wt.setStart(dt.node,dt.offset),Lt.removeAllRanges(),vn>Sr?(Lt.addRange(wt),Lt.extend(st.node,st.offset)):(wt.setEnd(st.node,st.offset),Lt.addRange(wt))}}}}for(Qt=[],Lt=be;Lt=Lt.parentNode;)Lt.nodeType===1&&Qt.push({element:Lt,left:Lt.scrollLeft,top:Lt.scrollTop});for(typeof be.focus=="function"&&be.focus(),be=0;be<Qt.length;be++){var $t=Qt[be];$t.element.scrollLeft=$t.left,$t.element.scrollTop=$t.top}}i_=!!Ep,Go=Ep=null}finally{Gi=B,ni.p=R,pt.T=x}}o.current=f,xr=2}}function My(){if(xr===2){xr=0;var o=$r,f=Oa,x=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||x){x=pt.T,pt.T=null;var R=ni.p;ni.p=2;var B=Gi;Gi|=4;try{ne(o,f.alternate,f)}finally{Gi=B,ni.p=R,pt.T=x}}xr=3}}function Cy(){if(xr===4||xr===3){xr=0,ya();var o=$r,f=Oa,x=ma,R=jo;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?xr=5:(xr=0,Oa=$r=null,Iy(o,o.pendingLanes));var B=o.pendingLanes;if(B===0&&(ta=null),pc(x),f=f.stateNode,ri&&typeof ri.onCommitFiberRoot=="function")try{ri.onCommitFiberRoot(gi,f,void 0,(f.current.flags&128)===128)}catch{}if(R!==null){f=pt.T,B=ni.p,ni.p=2,pt.T=null;try{for(var G=o.onRecoverableError,se=0;se<R.length;se++){var be=R[se];G(be.value,{componentStack:be.stack})}}finally{pt.T=f,ni.p=B}}(ma&3)!==0&&zm(),io(o),B=o.pendingLanes,(x&4194090)!==0&&(B&42)!==0?o===nc?Wc++:(Wc=0,nc=o):Wc=0,od(0)}}function Iy(o,f){(o.pooledCacheLanes&=f)===0&&(f=o.pooledCache,f!=null&&(o.pooledCache=null,Ou(f)))}function zm(o){return yf(),My(),Cy(),Ry()}function Ry(){if(xr!==5)return!1;var o=$r,f=_o;_o=0;var x=pc(ma),R=pt.T,B=ni.p;try{ni.p=32>x?32:x,pt.T=null,x=eo,eo=null;var G=$r,se=ma;if(xr=0,Oa=$r=null,ma=0,(Gi&6)!==0)throw Error(D(331));var be=Gi;if(Gi|=4,xi(G.current),yt(G,G.current,se,x),Gi=be,od(0,!1),ri&&typeof ri.onPostCommitFiberRoot=="function")try{ri.onPostCommitFiberRoot(gi,G)}catch{}return!0}finally{ni.p=B,pt.T=R,Iy(o,f)}}function Dy(o,f,x){f=ja(x,f),f=id(o.stateNode,f,2),o=al(o,f,2),o!==null&&(so(o,2),io(o))}function zr(o,f,x){if(o.tag===3)Dy(o,o,x);else for(;f!==null;){if(f.tag===3){Dy(f,o,x);break}else if(f.tag===1){var R=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(ta===null||!ta.has(R))){o=ja(x,o),x=ff(2),R=al(f,x,2),R!==null&&(Xu(x,R,f,o),so(R,2),io(R));break}}f=f.return}}function Tp(o,f,x){var R=o.pingCache;if(R===null){R=o.pingCache=new Sn;var B=new Set;R.set(f,B)}else B=R.get(f),B===void 0&&(B=new Set,R.set(f,B));B.has(x)||(hr=!0,B.add(x),o=A0.bind(null,o,f,x),f.then(o,o))}function A0(o,f,x){var R=o.pingCache;R!==null&&R.delete(f),o.pingedLanes|=o.suspendedLanes&x,o.warmLanes&=~x,Ti===o&&(li&x)===x&&(Pn===4||Pn===3&&(li&62914560)===li&&300>qr()-Qn?(Gi&2)===0&&ad(o,0):pa|=x,Zn===li&&(Zn=0)),io(o)}function sd(o,f){f===0&&(f=dc()),o=Ja(o,f),o!==null&&(so(o,f),io(o))}function M0(o){var f=o.memoizedState,x=0;f!==null&&(x=f.retryLane),sd(o,x)}function ia(o,f){var x=0;switch(o.tag){case 13:var R=o.stateNode,B=o.memoizedState;B!==null&&(x=B.retryLane);break;case 19:R=o.stateNode;break;case 22:R=o.stateNode._retryCache;break;default:throw Error(D(314))}R!==null&&R.delete(f),sd(o,x)}function Lm(o,f){return ks(o,f)}var Sp=null,Jc=null,vf=!1,Ju=!1,Om=!1,Qu=0;function io(o){o!==Jc&&o.next===null&&(Jc===null?Sp=Jc=o:Jc=Jc.next=o),Ju=!0,vf||(vf=!0,Y_())}function od(o,f){if(!Om&&Ju){Om=!0;do for(var x=!1,R=Sp;R!==null;){if(o!==0){var B=R.pendingLanes;if(B===0)var G=0;else{var se=R.suspendedLanes,be=R.pingedLanes;G=(1<<31-sn(42|o)+1)-1,G&=B&~(se&~be),G=G&201326741?G&201326741|1:G?G|2:0}G!==0&&(x=!0,Bm(R,G))}else G=li,G=Ns(R,R===Ti?G:0,R.cancelPendingCommit!==null||R.timeoutHandle!==-1),(G&3)===0||Kn(R,G)||(x=!0,Bm(R,G));R=R.next}while(x);Om=!1}}function Pm(){zy()}function zy(){Ju=vf=!1;var o=0;Qu!==0&&(I0()&&(o=Qu),Qu=0);for(var f=qr(),x=null,R=Sp;R!==null;){var B=R.next,G=X_(R,f);G===0?(R.next=null,x===null?Sp=B:x.next=B,B===null&&(Jc=x)):(x=R,(o!==0||(G&3)!==0)&&(Ju=!0)),R=B}od(o)}function X_(o,f){for(var x=o.suspendedLanes,R=o.pingedLanes,B=o.expirationTimes,G=o.pendingLanes&-62914561;0<G;){var se=31-sn(G),be=1<<se,Ye=B[se];Ye===-1?((be&x)===0||(be&R)!==0)&&(B[se]=Nn(be,f)):Ye<=f&&(o.expiredLanes|=be),G&=~be}if(f=Ti,x=li,x=Ns(o,o===f?x:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),R=o.callbackNode,x===0||o===f&&(jt===2||jt===9)||o.cancelPendingCommit!==null)return R!==null&&R!==null&&Ft(R),o.callbackNode=null,o.callbackPriority=0;if((x&3)===0||Kn(o,x)){if(f=x&-x,f===o.callbackPriority)return f;switch(R!==null&&Ft(R),pc(x)){case 2:case 8:x=Bs;break;case 32:x=Es;break;case 268435456:x=Mt;break;default:x=Es}return R=km.bind(null,o),x=ks(x,R),o.callbackPriority=f,o.callbackNode=x,f}return R!==null&&R!==null&&Ft(R),o.callbackPriority=2,o.callbackNode=null,2}function km(o,f){if(xr!==0&&xr!==5)return o.callbackNode=null,o.callbackPriority=0,null;var x=o.callbackNode;if(zm()&&o.callbackNode!==x)return null;var R=li;return R=Ns(o,o===Ti?R:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),R===0?null:(by(o,R,f),X_(o,qr()),o.callbackNode!=null&&o.callbackNode===x?km.bind(null,o):null)}function Bm(o,f){if(zm())return null;by(o,f,!0)}function Y_(){Vy(function(){(Gi&6)!==0?ks(Br,Pm):zy()})}function Nm(){return Qu===0&&(Qu=bu()),Qu}function Fm(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:Wa(""+o)}function W_(o,f){var x=f.ownerDocument.createElement("input");return x.name=f.name,x.value=f.value,o.id&&x.setAttribute("form",o.id),f.parentNode.insertBefore(x,f),o=new FormData(o),x.parentNode.removeChild(x),o}function K_(o,f,x,R,B){if(f==="submit"&&x&&x.stateNode===B){var G=Fm((B[Ae]||null).action),se=R.submitter;se&&(f=(f=se[Ae]||null)?Fm(f.formAction):se.getAttribute("formAction"),f!==null&&(G=f,se=null));var be=new pr("action","action",null,R,B);o.push({event:be,listeners:[{instance:null,listener:function(){if(R.defaultPrevented){if(Qu!==0){var Ye=se?W_(B,se):new FormData(B);Uu(x,{pending:!0,data:Ye,method:B.method,action:G},null,Ye)}}else typeof G=="function"&&(be.preventDefault(),Ye=se?W_(B,se):new FormData(B),Uu(x,{pending:!0,data:Ye,method:B.method,action:G},G,Ye))},currentTarget:B}]})}}for(var Vm=0;Vm<Jo.length;Vm++){var Um=Jo[Vm],jm=Um.toLowerCase(),Ly=Um[0].toUpperCase()+Um.slice(1);Ua(jm,"on"+Ly)}Ua(Gs,"onAnimationEnd"),Ua(Ld,"onAnimationIteration"),Ua(Mh,"onAnimationStart"),Ua("dblclick","onDoubleClick"),Ua("focusin","onFocus"),Ua("focusout","onBlur"),Ua(Ch,"onTransitionRun"),Ua(Od,"onTransitionStart"),Ua(Dl,"onTransitionCancel"),Ua(Ih,"onTransitionEnd"),Jn("onMouseEnter",["mouseout","mouseover"]),Jn("onMouseLeave",["mouseout","mouseover"]),Jn("onPointerEnter",["pointerout","pointerover"]),Jn("onPointerLeave",["pointerout","pointerover"]),Fn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(xf));function Qc(o,f){f=(f&4)!==0;for(var x=0;x<o.length;x++){var R=o[x],B=R.event;R=R.listeners;e:{var G=void 0;if(f)for(var se=R.length-1;0<=se;se--){var be=R[se],Ye=be.instance,Et=be.currentTarget;if(be=be.listener,Ye!==G&&B.isPropagationStopped())break e;G=be,B.currentTarget=Et;try{G(B)}catch(Zt){Jl(Zt)}B.currentTarget=null,G=Ye}else for(se=0;se<R.length;se++){if(be=R[se],Ye=be.instance,Et=be.currentTarget,be=be.listener,Ye!==G&&B.isPropagationStopped())break e;G=be,B.currentTarget=Et;try{G(B)}catch(Zt){Jl(Zt)}B.currentTarget=null,G=Ye}}}}function Un(o,f){var x=f[Oe];x===void 0&&(x=f[Oe]=new Set);var R=o+"__bubble";x.has(R)||(Py(f,o,2,!1),x.add(R))}function qm(o,f,x){var R=0;f&&(R|=4),Py(x,o,R,f)}var Gm="_reactListening"+Math.random().toString(36).slice(2);function Hm(o){if(!o[Gm]){o[Gm]=!0,qi.forEach(function(x){x!=="selectionchange"&&(Oy.has(x)||qm(x,!1,o),qm(x,!0,o))});var f=o.nodeType===9?o:o.ownerDocument;f===null||f[Gm]||(f[Gm]=!0,qm("selectionchange",!1,f))}}function Py(o,f,x,R){switch(pg(f)){case 2:var B=B0;break;case 8:B=fg;break;default:B=Op}x=B.bind(null,f,x,o),B=void 0,!bl||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(B=!0),R?B!==void 0?o.addEventListener(f,x,{capture:!0,passive:B}):o.addEventListener(f,x,!0):B!==void 0?o.addEventListener(f,x,{passive:B}):o.addEventListener(f,x,!1)}function J_(o,f,x,R,B){var G=R;if((f&1)===0&&(f&2)===0&&R!==null)e:for(;;){if(R===null)return;var se=R.tag;if(se===3||se===4){var be=R.stateNode.containerInfo;if(be===B)break;if(se===4)for(se=R.return;se!==null;){var Ye=se.tag;if((Ye===3||Ye===4)&&se.stateNode.containerInfo===B)return;se=se.return}for(;be!==null;){if(se=Dt(be),se===null)return;if(Ye=se.tag,Ye===5||Ye===6||Ye===26||Ye===27){R=G=se;continue e}be=be.parentNode}}R=R.return}bn(function(){var Et=G,Zt=vh(x),Qt=[];e:{var It=Pd.get(o);if(It!==void 0){var Lt=pr,En=o;switch(o){case"keypress":if(yn(x)===0)break e;case"keydown":case"keyup":Lt=Md;break;case"focusin":En="focus",Lt=Cs;break;case"focusout":En="blur",Lt=Cs;break;case"beforeblur":case"afterblur":Lt=Cs;break;case"click":if(x.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Lt=va;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Lt=Ra;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Lt=lm;break;case Gs:case Ld:case Mh:Lt=sa;break;case Ih:Lt=U_;break;case"scroll":case"scrollend":Lt=Su;break;case"wheel":Lt=Th;break;case"copy":case"cut":case"paste":Lt=Ir;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Lt=om;break;case"toggle":case"beforetoggle":Lt=q_}var vn=(f&4)!==0,Sr=!vn&&(o==="scroll"||o==="scrollend"),dt=vn?It!==null?It+"Capture":null:It;vn=[];for(var st=Et,wt;st!==null;){var $t=st;if(wt=$t.stateNode,$t=$t.tag,$t!==5&&$t!==26&&$t!==27||wt===null||dt===null||($t=Fa(st,dt),$t!=null&&vn.push(go(st,$t,wt))),Sr)break;st=st.return}0<vn.length&&(It=new Lt(It,En,null,x,Zt),Qt.push({event:It,listeners:vn}))}}if((f&7)===0){e:{if(It=o==="mouseover"||o==="pointerover",Lt=o==="mouseout"||o==="pointerout",It&&x!==Mn&&(En=x.relatedTarget||x.fromElement)&&(Dt(En)||En[Me]))break e;if((Lt||It)&&(It=Zt.window===Zt?Zt:(It=Zt.ownerDocument)?It.defaultView||It.parentWindow:window,Lt?(En=x.relatedTarget||x.toElement,Lt=Et,En=En?Dt(En):null,En!==null&&(Sr=F(En),vn=En.tag,En!==Sr||vn!==5&&vn!==27&&vn!==6)&&(En=null)):(Lt=null,En=Et),Lt!==En)){if(vn=va,$t="onMouseLeave",dt="onMouseEnter",st="mouse",(o==="pointerout"||o==="pointerover")&&(vn=om,$t="onPointerLeave",dt="onPointerEnter",st="pointer"),Sr=Lt==null?It:Yt(Lt),wt=En==null?It:Yt(En),It=new vn($t,st+"leave",Lt,x,Zt),It.target=Sr,It.relatedTarget=wt,$t=null,Dt(Zt)===Et&&(vn=new vn(dt,st+"enter",En,x,Zt),vn.target=wt,vn.relatedTarget=Sr,$t=vn),Sr=$t,Lt&&En)t:{for(vn=Lt,dt=En,st=0,wt=vn;wt;wt=wf(wt))st++;for(wt=0,$t=dt;$t;$t=wf($t))wt++;for(;0<st-wt;)vn=wf(vn),st--;for(;0<wt-st;)dt=wf(dt),wt--;for(;st--;){if(vn===dt||dt!==null&&vn===dt.alternate)break t;vn=wf(vn),dt=wf(dt)}vn=null}else vn=null;Lt!==null&&Q_(Qt,It,Lt,vn,!1),En!==null&&Sr!==null&&Q_(Qt,Sr,En,vn,!0)}}e:{if(It=Et?Yt(Et):window,Lt=It.nodeName&&It.nodeName.toLowerCase(),Lt==="select"||Lt==="input"&&It.type==="file")var Vi=xc;else if(Ni(It))if(Rd)Vi=Dd;else{Vi=xa;var Xn=Wo}else Lt=It.nodeName,!Lt||Lt.toLowerCase()!=="input"||It.type!=="checkbox"&&It.type!=="radio"?Et&&Ia(Et.elementType)&&(Vi=xc):Vi=dm;if(Vi&&(Vi=Vi(o,Et))){Io(Qt,Vi,x,Zt);break e}Xn&&Xn(o,It,Et),o==="focusout"&&Et&&It.type==="number"&&Et.memoizedProps.value!=null&&As(It,"number",It.value)}switch(Xn=Et?Yt(Et):window,o){case"focusin":(Ni(Xn)||Xn.contentEditable==="true")&&(Tc=Xn,zd=Et,Il=null);break;case"focusout":Il=zd=Tc=null;break;case"mousedown":np=!0;break;case"contextmenu":case"mouseup":case"dragend":np=!1,Rl(Qt,x,Zt);break;case"selectionchange":if(mm)break;case"keydown":case"keyup":Rl(Qt,x,Zt)}var tn;if(Yo)e:{switch(o){case"compositionstart":var xn="onCompositionStart";break e;case"compositionend":xn="onCompositionEnd";break e;case"compositionupdate":xn="onCompositionUpdate";break e}xn=void 0}else Is?tp(o,x)&&(xn="onCompositionEnd"):o==="keydown"&&x.keyCode===229&&(xn="onCompositionStart");xn&&(Cd&&x.locale!=="ko"&&(Is||xn!=="onCompositionStart"?xn==="onCompositionEnd"&&Is&&(tn=gc()):(dn=Zt,gn="value"in dn?dn.value:dn.textContent,Is=!0)),Xn=bf(Et,xn),0<Xn.length&&(xn=new ys(xn,o,null,x,Zt),Qt.push({event:xn,listeners:Xn}),tn?xn.data=tn:(tn=hm(x),tn!==null&&(xn.data=tn)))),(tn=Ml?en(o,x):mi(o,x))&&(xn=bf(Et,"onBeforeInput"),0<xn.length&&(Xn=new ys("onBeforeInput","beforeinput",null,x,Zt),Qt.push({event:Xn,listeners:xn}),Xn.data=tn)),K_(Qt,o,Et,x,Zt)}Qc(Qt,f)})}function go(o,f,x){return{instance:o,listener:f,currentTarget:x}}function bf(o,f){for(var x=f+"Capture",R=[];o!==null;){var B=o,G=B.stateNode;if(B=B.tag,B!==5&&B!==26&&B!==27||G===null||(B=Fa(o,x),B!=null&&R.unshift(go(o,B,G)),B=Fa(o,f),B!=null&&R.push(go(o,B,G))),o.tag===3)return R;o=o.return}return[]}function wf(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function Q_(o,f,x,R,B){for(var G=f._reactName,se=[];x!==null&&x!==R;){var be=x,Ye=be.alternate,Et=be.stateNode;if(be=be.tag,Ye!==null&&Ye===R)break;be!==5&&be!==26&&be!==27||Et===null||(Ye=Et,B?(Et=Fa(x,G),Et!=null&&se.unshift(go(x,Et,Ye))):B||(Et=Fa(x,G),Et!=null&&se.push(go(x,Et,Ye)))),x=x.return}se.length!==0&&o.push({event:f,listeners:se})}var ld=/\r\n?/g,C0=/\u0000|\uFFFD/g;function qo(o){return(typeof o=="string"?o:""+o).replace(ld,`
`).replace(C0,"")}function Zm(o,f){return f=qo(f),qo(o)===f}function Tf(){}function br(o,f,x,R,B,G){switch(x){case"children":typeof R=="string"?f==="body"||f==="textarea"&&R===""||oo(o,R):(typeof R=="number"||typeof R=="bigint")&&f!=="body"&&oo(o,""+R);break;case"className":Nr(o,"class",R);break;case"tabIndex":Nr(o,"tabindex",R);break;case"dir":case"role":case"viewBox":case"width":case"height":Nr(o,x,R);break;case"style":Vs(o,R,G);break;case"data":if(f!=="object"){Nr(o,"data",R);break}case"src":case"href":if(R===""&&(f!=="a"||x!=="href")){o.removeAttribute(x);break}if(R==null||typeof R=="function"||typeof R=="symbol"||typeof R=="boolean"){o.removeAttribute(x);break}R=Wa(""+R),o.setAttribute(x,R);break;case"action":case"formAction":if(typeof R=="function"){o.setAttribute(x,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof G=="function"&&(x==="formAction"?(f!=="input"&&br(o,f,"name",B.name,B,null),br(o,f,"formEncType",B.formEncType,B,null),br(o,f,"formMethod",B.formMethod,B,null),br(o,f,"formTarget",B.formTarget,B,null)):(br(o,f,"encType",B.encType,B,null),br(o,f,"method",B.method,B,null),br(o,f,"target",B.target,B,null)));if(R==null||typeof R=="symbol"||typeof R=="boolean"){o.removeAttribute(x);break}R=Wa(""+R),o.setAttribute(x,R);break;case"onClick":R!=null&&(o.onclick=Tf);break;case"onScroll":R!=null&&Un("scroll",o);break;case"onScrollEnd":R!=null&&Un("scrollend",o);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(D(61));if(x=R.__html,x!=null){if(B.children!=null)throw Error(D(60));o.innerHTML=x}}break;case"multiple":o.multiple=R&&typeof R!="function"&&typeof R!="symbol";break;case"muted":o.muted=R&&typeof R!="function"&&typeof R!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(R==null||typeof R=="function"||typeof R=="boolean"||typeof R=="symbol"){o.removeAttribute("xlink:href");break}x=Wa(""+R),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",x);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":R!=null&&typeof R!="function"&&typeof R!="symbol"?o.setAttribute(x,""+R):o.removeAttribute(x);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":R&&typeof R!="function"&&typeof R!="symbol"?o.setAttribute(x,""):o.removeAttribute(x);break;case"capture":case"download":R===!0?o.setAttribute(x,""):R!==!1&&R!=null&&typeof R!="function"&&typeof R!="symbol"?o.setAttribute(x,R):o.removeAttribute(x);break;case"cols":case"rows":case"size":case"span":R!=null&&typeof R!="function"&&typeof R!="symbol"&&!isNaN(R)&&1<=R?o.setAttribute(x,R):o.removeAttribute(x);break;case"rowSpan":case"start":R==null||typeof R=="function"||typeof R=="symbol"||isNaN(R)?o.removeAttribute(x):o.setAttribute(x,R);break;case"popover":Un("beforetoggle",o),Un("toggle",o),fr(o,"popover",R);break;case"xlinkActuate":Mr(o,"http://www.w3.org/1999/xlink","xlink:actuate",R);break;case"xlinkArcrole":Mr(o,"http://www.w3.org/1999/xlink","xlink:arcrole",R);break;case"xlinkRole":Mr(o,"http://www.w3.org/1999/xlink","xlink:role",R);break;case"xlinkShow":Mr(o,"http://www.w3.org/1999/xlink","xlink:show",R);break;case"xlinkTitle":Mr(o,"http://www.w3.org/1999/xlink","xlink:title",R);break;case"xlinkType":Mr(o,"http://www.w3.org/1999/xlink","xlink:type",R);break;case"xmlBase":Mr(o,"http://www.w3.org/XML/1998/namespace","xml:base",R);break;case"xmlLang":Mr(o,"http://www.w3.org/XML/1998/namespace","xml:lang",R);break;case"xmlSpace":Mr(o,"http://www.w3.org/XML/1998/namespace","xml:space",R);break;case"is":fr(o,"is",R);break;case"innerText":case"textContent":break;default:(!(2<x.length)||x[0]!=="o"&&x[0]!=="O"||x[1]!=="n"&&x[1]!=="N")&&(x=sm.get(x)||x,fr(o,x,R))}}function $m(o,f,x,R,B,G){switch(x){case"style":Vs(o,R,G);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(D(61));if(x=R.__html,x!=null){if(B.children!=null)throw Error(D(60));o.innerHTML=x}}break;case"children":typeof R=="string"?oo(o,R):(typeof R=="number"||typeof R=="bigint")&&oo(o,""+R);break;case"onScroll":R!=null&&Un("scroll",o);break;case"onScrollEnd":R!=null&&Un("scrollend",o);break;case"onClick":R!=null&&(o.onclick=Tf);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$i.hasOwnProperty(x))e:{if(x[0]==="o"&&x[1]==="n"&&(B=x.endsWith("Capture"),f=x.slice(2,B?x.length-7:void 0),G=o[Ae]||null,G=G!=null?G[x]:null,typeof G=="function"&&o.removeEventListener(f,G,B),typeof R=="function")){typeof G!="function"&&G!==null&&(x in o?o[x]=null:o.hasAttribute(x)&&o.removeAttribute(x)),o.addEventListener(f,R,B);break e}x in o?o[x]=R:R===!0?o.setAttribute(x,""):fr(o,x,R)}}}function Za(o,f,x){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Un("error",o),Un("load",o);var R=!1,B=!1,G;for(G in x)if(x.hasOwnProperty(G)){var se=x[G];if(se!=null)switch(G){case"src":R=!0;break;case"srcSet":B=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(D(137,f));default:br(o,f,G,se,x,null)}}B&&br(o,f,"srcSet",x.srcSet,x,null),R&&br(o,f,"src",x.src,x,null);return;case"input":Un("invalid",o);var be=G=se=B=null,Ye=null,Et=null;for(R in x)if(x.hasOwnProperty(R)){var Zt=x[R];if(Zt!=null)switch(R){case"name":B=Zt;break;case"type":se=Zt;break;case"checked":Ye=Zt;break;case"defaultChecked":Et=Zt;break;case"value":G=Zt;break;case"defaultValue":be=Zt;break;case"children":case"dangerouslySetInnerHTML":if(Zt!=null)throw Error(D(137,f));break;default:br(o,f,R,Zt,x,null)}}_s(o,G,be,Ye,Et,se,B,!1),Zo(o);return;case"select":Un("invalid",o),R=se=G=null;for(B in x)if(x.hasOwnProperty(B)&&(be=x[B],be!=null))switch(B){case"value":G=be;break;case"defaultValue":se=be;break;case"multiple":R=be;default:br(o,f,B,be,x,null)}f=G,x=se,o.multiple=!!R,f!=null?Ms(o,!!R,f,!1):x!=null&&Ms(o,!!R,x,!0);return;case"textarea":Un("invalid",o),G=B=R=null;for(se in x)if(x.hasOwnProperty(se)&&(be=x[se],be!=null))switch(se){case"value":R=be;break;case"defaultValue":B=be;break;case"children":G=be;break;case"dangerouslySetInnerHTML":if(be!=null)throw Error(D(91));break;default:br(o,f,se,be,x,null)}Ya(o,R,B,G),Zo(o);return;case"option":for(Ye in x)if(x.hasOwnProperty(Ye)&&(R=x[Ye],R!=null))switch(Ye){case"selected":o.selected=R&&typeof R!="function"&&typeof R!="symbol";break;default:br(o,f,Ye,R,x,null)}return;case"dialog":Un("beforetoggle",o),Un("toggle",o),Un("cancel",o),Un("close",o);break;case"iframe":case"object":Un("load",o);break;case"video":case"audio":for(R=0;R<xf.length;R++)Un(xf[R],o);break;case"image":Un("error",o),Un("load",o);break;case"details":Un("toggle",o);break;case"embed":case"source":case"link":Un("error",o),Un("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Et in x)if(x.hasOwnProperty(Et)&&(R=x[Et],R!=null))switch(Et){case"children":case"dangerouslySetInnerHTML":throw Error(D(137,f));default:br(o,f,Et,R,x,null)}return;default:if(Ia(f)){for(Zt in x)x.hasOwnProperty(Zt)&&(R=x[Zt],R!==void 0&&$m(o,f,Zt,R,x,void 0));return}}for(be in x)x.hasOwnProperty(be)&&(R=x[be],R!=null&&br(o,f,be,R,x,null))}function ky(o,f,x,R){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var B=null,G=null,se=null,be=null,Ye=null,Et=null,Zt=null;for(Lt in x){var Qt=x[Lt];if(x.hasOwnProperty(Lt)&&Qt!=null)switch(Lt){case"checked":break;case"value":break;case"defaultValue":Ye=Qt;default:R.hasOwnProperty(Lt)||br(o,f,Lt,null,R,Qt)}}for(var It in R){var Lt=R[It];if(Qt=x[It],R.hasOwnProperty(It)&&(Lt!=null||Qt!=null))switch(It){case"type":G=Lt;break;case"name":B=Lt;break;case"checked":Et=Lt;break;case"defaultChecked":Zt=Lt;break;case"value":se=Lt;break;case"defaultValue":be=Lt;break;case"children":case"dangerouslySetInnerHTML":if(Lt!=null)throw Error(D(137,f));break;default:Lt!==Qt&&br(o,f,It,Lt,R,Qt)}}xl(o,se,be,Ye,Et,Zt,G,B);return;case"select":Lt=se=be=It=null;for(G in x)if(Ye=x[G],x.hasOwnProperty(G)&&Ye!=null)switch(G){case"value":break;case"multiple":Lt=Ye;default:R.hasOwnProperty(G)||br(o,f,G,null,R,Ye)}for(B in R)if(G=R[B],Ye=x[B],R.hasOwnProperty(B)&&(G!=null||Ye!=null))switch(B){case"value":It=G;break;case"defaultValue":be=G;break;case"multiple":se=G;default:G!==Ye&&br(o,f,B,G,R,Ye)}f=be,x=se,R=Lt,It!=null?Ms(o,!!x,It,!1):!!R!=!!x&&(f!=null?Ms(o,!!x,f,!0):Ms(o,!!x,x?[]:"",!1));return;case"textarea":Lt=It=null;for(be in x)if(B=x[be],x.hasOwnProperty(be)&&B!=null&&!R.hasOwnProperty(be))switch(be){case"value":break;case"children":break;default:br(o,f,be,null,R,B)}for(se in R)if(B=R[se],G=x[se],R.hasOwnProperty(se)&&(B!=null||G!=null))switch(se){case"value":It=B;break;case"defaultValue":Lt=B;break;case"children":break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(D(91));break;default:B!==G&&br(o,f,se,B,R,G)}gs(o,It,Lt);return;case"option":for(var En in x)if(It=x[En],x.hasOwnProperty(En)&&It!=null&&!R.hasOwnProperty(En))switch(En){case"selected":o.selected=!1;break;default:br(o,f,En,null,R,It)}for(Ye in R)if(It=R[Ye],Lt=x[Ye],R.hasOwnProperty(Ye)&&It!==Lt&&(It!=null||Lt!=null))switch(Ye){case"selected":o.selected=It&&typeof It!="function"&&typeof It!="symbol";break;default:br(o,f,Ye,It,R,Lt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vn in x)It=x[vn],x.hasOwnProperty(vn)&&It!=null&&!R.hasOwnProperty(vn)&&br(o,f,vn,null,R,It);for(Et in R)if(It=R[Et],Lt=x[Et],R.hasOwnProperty(Et)&&It!==Lt&&(It!=null||Lt!=null))switch(Et){case"children":case"dangerouslySetInnerHTML":if(It!=null)throw Error(D(137,f));break;default:br(o,f,Et,It,R,Lt)}return;default:if(Ia(f)){for(var Sr in x)It=x[Sr],x.hasOwnProperty(Sr)&&It!==void 0&&!R.hasOwnProperty(Sr)&&$m(o,f,Sr,void 0,R,It);for(Zt in R)It=R[Zt],Lt=x[Zt],!R.hasOwnProperty(Zt)||It===Lt||It===void 0&&Lt===void 0||$m(o,f,Zt,It,R,Lt);return}}for(var dt in x)It=x[dt],x.hasOwnProperty(dt)&&It!=null&&!R.hasOwnProperty(dt)&&br(o,f,dt,null,R,It);for(Qt in R)It=R[Qt],Lt=x[Qt],!R.hasOwnProperty(Qt)||It===Lt||It==null&&Lt==null||br(o,f,Qt,It,R,Lt)}var Ep=null,Go=null;function Ap(o){return o.nodeType===9?o:o.ownerDocument}function By(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ny(o,f){if(o===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&f==="foreignObject"?0:o}function eg(o,f){return o==="textarea"||o==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var tg=null;function I0(){var o=window.event;return o&&o.type==="popstate"?o===tg?!1:(tg=o,!0):(tg=null,!1)}var Fy=typeof setTimeout=="function"?setTimeout:void 0,R0=typeof clearTimeout=="function"?clearTimeout:void 0,eh=typeof Promise=="function"?Promise:void 0,Vy=typeof queueMicrotask=="function"?queueMicrotask:typeof eh<"u"?function(o){return eh.resolve(null).then(o).catch(Xm)}:Fy;function Xm(o){setTimeout(function(){throw o})}function eu(o){return o==="head"}function ig(o,f){var x=f,R=0,B=0;do{var G=x.nextSibling;if(o.removeChild(x),G&&G.nodeType===8)if(x=G.data,x==="/$"){if(0<R&&8>R){x=R;var se=o.ownerDocument;if(x&1&&Ef(se.documentElement),x&2&&Ef(se.body),x&4)for(x=se.head,Ef(x),se=x.firstChild;se;){var be=se.nextSibling,Ye=se.nodeName;se[lt]||Ye==="SCRIPT"||Ye==="STYLE"||Ye==="LINK"&&se.rel.toLowerCase()==="stylesheet"||x.removeChild(se),se=be}}if(B===0){o.removeChild(G),Xr(f);return}B--}else x==="$"||x==="$?"||x==="$!"?B++:R=x.charCodeAt(0)-48;else R=0;x=G}while(x);Xr(f)}function Sf(o){var f=o.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var x=f;switch(f=f.nextSibling,x.nodeName){case"HTML":case"HEAD":case"BODY":Sf(x),rt(x);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(x.rel.toLowerCase()==="stylesheet")continue}o.removeChild(x)}}function Uy(o,f,x,R){for(;o.nodeType===1;){var B=x;if(o.nodeName.toLowerCase()!==f.toLowerCase()){if(!R&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(R){if(!o[lt])switch(f){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(G=o.getAttribute("rel"),G==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(G!==B.rel||o.getAttribute("href")!==(B.href==null||B.href===""?null:B.href)||o.getAttribute("crossorigin")!==(B.crossOrigin==null?null:B.crossOrigin)||o.getAttribute("title")!==(B.title==null?null:B.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(G=o.getAttribute("src"),(G!==(B.src==null?null:B.src)||o.getAttribute("type")!==(B.type==null?null:B.type)||o.getAttribute("crossorigin")!==(B.crossOrigin==null?null:B.crossOrigin))&&G&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(f==="input"&&o.type==="hidden"){var G=B.name==null?null:""+B.name;if(B.type==="hidden"&&o.getAttribute("name")===G)return o}else return o;if(o=yo(o.nextSibling),o===null)break}return null}function Ym(o,f,x){if(f==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!x||(o=yo(o.nextSibling),o===null))return null;return o}function Wm(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function ng(o,f){var x=o.ownerDocument;if(o.data!=="$?"||x.readyState==="complete")f();else{var R=function(){f(),x.removeEventListener("DOMContentLoaded",R)};x.addEventListener("DOMContentLoaded",R),o._reactRetry=R}}function yo(o){for(;o!=null;o=o.nextSibling){var f=o.nodeType;if(f===1||f===3)break;if(f===8){if(f=o.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return o}var Km=null;function jy(o){o=o.previousSibling;for(var f=0;o;){if(o.nodeType===8){var x=o.data;if(x==="$"||x==="$!"||x==="$?"){if(f===0)return o;f--}else x==="/$"&&f++}o=o.previousSibling}return null}function rg(o,f,x){switch(f=Ap(x),o){case"html":if(o=f.documentElement,!o)throw Error(D(452));return o;case"head":if(o=f.head,!o)throw Error(D(453));return o;case"body":if(o=f.body,!o)throw Error(D(454));return o;default:throw Error(D(451))}}function Ef(o){for(var f=o.attributes;f.length;)o.removeAttributeNode(f[0]);rt(o)}var vo=new Map,ag=new Set;function Af(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var ac=ni.d;ni.d={f:sg,r:D0,D:z0,C:Gy,L:th,m:Mp,X:Jm,S:Cp,M:Ip};function sg(){var o=ac.f(),f=bp();return o||f}function D0(o){var f=Ht(o);f!==null&&f.tag===5&&f.type==="form"?Kh(f):ac.r(o)}var Mf=typeof document>"u"?null:document;function qy(o,f,x){var R=Mf;if(R&&typeof f=="string"&&f){var B=ms(f);B='link[rel="'+o+'"][href="'+B+'"]',typeof x=="string"&&(B+='[crossorigin="'+x+'"]'),ag.has(B)||(ag.add(B),o={rel:o,crossOrigin:x,href:f},R.querySelector(B)===null&&(f=R.createElement("link"),Za(f,"link",o),Ai(f),R.head.appendChild(f)))}}function z0(o){ac.D(o),qy("dns-prefetch",o,null)}function Gy(o,f){ac.C(o,f),qy("preconnect",o,f)}function th(o,f,x){ac.L(o,f,x);var R=Mf;if(R&&o&&f){var B='link[rel="preload"][as="'+ms(f)+'"]';f==="image"&&x&&x.imageSrcSet?(B+='[imagesrcset="'+ms(x.imageSrcSet)+'"]',typeof x.imageSizes=="string"&&(B+='[imagesizes="'+ms(x.imageSizes)+'"]')):B+='[href="'+ms(o)+'"]';var G=B;switch(f){case"style":G=cd(o);break;case"script":G=If(o)}vo.has(G)||(o=oe({rel:"preload",href:f==="image"&&x&&x.imageSrcSet?void 0:o,as:f},x),vo.set(G,o),R.querySelector(B)!==null||f==="style"&&R.querySelector(Cf(G))||f==="script"&&R.querySelector(Rf(G))||(f=R.createElement("link"),Za(f,"link",o),Ai(f),R.head.appendChild(f)))}}function Mp(o,f){ac.m(o,f);var x=Mf;if(x&&o){var R=f&&typeof f.as=="string"?f.as:"script",B='link[rel="modulepreload"][as="'+ms(R)+'"][href="'+ms(o)+'"]',G=B;switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":G=If(o)}if(!vo.has(G)&&(o=oe({rel:"modulepreload",href:o},f),vo.set(G,o),x.querySelector(B)===null)){switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(x.querySelector(Rf(G)))return}R=x.createElement("link"),Za(R,"link",o),Ai(R),x.head.appendChild(R)}}}function Cp(o,f,x){ac.S(o,f,x);var R=Mf;if(R&&o){var B=zi(R).hoistableStyles,G=cd(o);f=f||"default";var se=B.get(G);if(!se){var be={loading:0,preload:null};if(se=R.querySelector(Cf(G)))be.loading=5;else{o=oe({rel:"stylesheet",href:o,"data-precedence":f},x),(x=vo.get(G))&&cg(o,x);var Ye=se=R.createElement("link");Ai(Ye),Za(Ye,"link",o),Ye._p=new Promise(function(Et,Zt){Ye.onload=Et,Ye.onerror=Zt}),Ye.addEventListener("load",function(){be.loading|=1}),Ye.addEventListener("error",function(){be.loading|=2}),be.loading|=4,Dp(se,f,R)}se={type:"stylesheet",instance:se,count:1,state:be},B.set(G,se)}}}function Jm(o,f){ac.X(o,f);var x=Mf;if(x&&o){var R=zi(x).hoistableScripts,B=If(o),G=R.get(B);G||(G=x.querySelector(Rf(B)),G||(o=oe({src:o,async:!0},f),(f=vo.get(B))&&Qm(o,f),G=x.createElement("script"),Ai(G),Za(G,"link",o),x.head.appendChild(G)),G={type:"script",instance:G,count:1,state:null},R.set(B,G))}}function Ip(o,f){ac.M(o,f);var x=Mf;if(x&&o){var R=zi(x).hoistableScripts,B=If(o),G=R.get(B);G||(G=x.querySelector(Rf(B)),G||(o=oe({src:o,async:!0,type:"module"},f),(f=vo.get(B))&&Qm(o,f),G=x.createElement("script"),Ai(G),Za(G,"link",o),x.head.appendChild(G)),G={type:"script",instance:G,count:1,state:null},R.set(B,G))}}function og(o,f,x,R){var B=(B=Xi.current)?Af(B):null;if(!B)throw Error(D(446));switch(o){case"meta":case"title":return null;case"style":return typeof x.precedence=="string"&&typeof x.href=="string"?(f=cd(x.href),x=zi(B).hoistableStyles,R=x.get(f),R||(R={type:"style",instance:null,count:0,state:null},x.set(f,R)),R):{type:"void",instance:null,count:0,state:null};case"link":if(x.rel==="stylesheet"&&typeof x.href=="string"&&typeof x.precedence=="string"){o=cd(x.href);var G=zi(B).hoistableStyles,se=G.get(o);if(se||(B=B.ownerDocument||B,se={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},G.set(o,se),(G=B.querySelector(Cf(o)))&&!G._p&&(se.instance=G,se.state.loading=5),vo.has(o)||(x={rel:"preload",as:"style",href:x.href,crossOrigin:x.crossOrigin,integrity:x.integrity,media:x.media,hrefLang:x.hrefLang,referrerPolicy:x.referrerPolicy},vo.set(o,x),G||L0(B,o,x,se.state))),f&&R===null)throw Error(D(528,""));return se}if(f&&R!==null)throw Error(D(529,""));return null;case"script":return f=x.async,x=x.src,typeof x=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=If(x),x=zi(B).hoistableScripts,R=x.get(f),R||(R={type:"script",instance:null,count:0,state:null},x.set(f,R)),R):{type:"void",instance:null,count:0,state:null};default:throw Error(D(444,o))}}function cd(o){return'href="'+ms(o)+'"'}function Cf(o){return'link[rel="stylesheet"]['+o+"]"}function lg(o){return oe({},o,{"data-precedence":o.precedence,precedence:null})}function L0(o,f,x,R){o.querySelector('link[rel="preload"][as="style"]['+f+"]")?R.loading=1:(f=o.createElement("link"),R.preload=f,f.addEventListener("load",function(){return R.loading|=1}),f.addEventListener("error",function(){return R.loading|=2}),Za(f,"link",x),Ai(f),o.head.appendChild(f))}function If(o){return'[src="'+ms(o)+'"]'}function Rf(o){return"script[async]"+o}function Rp(o,f,x){if(f.count++,f.instance===null)switch(f.type){case"style":var R=o.querySelector('style[data-href~="'+ms(x.href)+'"]');if(R)return f.instance=R,Ai(R),R;var B=oe({},x,{"data-href":x.href,"data-precedence":x.precedence,href:null,precedence:null});return R=(o.ownerDocument||o).createElement("style"),Ai(R),Za(R,"style",B),Dp(R,x.precedence,o),f.instance=R;case"stylesheet":B=cd(x.href);var G=o.querySelector(Cf(B));if(G)return f.state.loading|=4,f.instance=G,Ai(G),G;R=lg(x),(B=vo.get(B))&&cg(R,B),G=(o.ownerDocument||o).createElement("link"),Ai(G);var se=G;return se._p=new Promise(function(be,Ye){se.onload=be,se.onerror=Ye}),Za(G,"link",R),f.state.loading|=4,Dp(G,x.precedence,o),f.instance=G;case"script":return G=If(x.src),(B=o.querySelector(Rf(G)))?(f.instance=B,Ai(B),B):(R=x,(B=vo.get(G))&&(R=oe({},x),Qm(R,B)),o=o.ownerDocument||o,B=o.createElement("script"),Ai(B),Za(B,"link",R),o.head.appendChild(B),f.instance=B);case"void":return null;default:throw Error(D(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(R=f.instance,f.state.loading|=4,Dp(R,x.precedence,o));return f.instance}function Dp(o,f,x){for(var R=x.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),B=R.length?R[R.length-1]:null,G=B,se=0;se<R.length;se++){var be=R[se];if(be.dataset.precedence===f)G=be;else if(G!==B)break}G?G.parentNode.insertBefore(o,G.nextSibling):(f=x.nodeType===9?x.head:x,f.insertBefore(o,f.firstChild))}function cg(o,f){o.crossOrigin==null&&(o.crossOrigin=f.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=f.referrerPolicy),o.title==null&&(o.title=f.title)}function Qm(o,f){o.crossOrigin==null&&(o.crossOrigin=f.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=f.referrerPolicy),o.integrity==null&&(o.integrity=f.integrity)}var Df=null;function ug(o,f,x){if(Df===null){var R=new Map,B=Df=new Map;B.set(x,R)}else B=Df,R=B.get(x),R||(R=new Map,B.set(x,R));if(R.has(o))return R;for(R.set(o,null),x=x.getElementsByTagName(o),B=0;B<x.length;B++){var G=x[B];if(!(G[lt]||G[ge]||o==="link"&&G.getAttribute("rel")==="stylesheet")&&G.namespaceURI!=="http://www.w3.org/2000/svg"){var se=G.getAttribute(f)||"";se=o+se;var be=R.get(se);be?be.push(G):R.set(se,[G])}}return R}function hg(o,f,x){o=o.ownerDocument||o,o.head.insertBefore(x,f==="title"?o.querySelector("head > title"):null)}function Hy(o,f,x){if(x===1||f.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return o=f.disabled,typeof f.precedence=="string"&&o==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function dg(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var zf=null;function O0(){}function Zy(o,f,x){if(zf===null)throw Error(D(475));var R=zf;if(f.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var B=cd(x.href),G=o.querySelector(Cf(B));if(G){o=G._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(R.count++,R=ih.bind(R),o.then(R,R)),f.state.loading|=4,f.instance=G,Ai(G);return}G=o.ownerDocument||o,x=lg(x),(B=vo.get(B))&&cg(x,B),G=G.createElement("link"),Ai(G);var se=G;se._p=new Promise(function(be,Ye){se.onload=be,se.onerror=Ye}),Za(G,"link",x),f.instance=G}R.stylesheets===null&&(R.stylesheets=new Map),R.stylesheets.set(f,o),(o=f.state.preload)&&(f.state.loading&3)===0&&(R.count++,f=ih.bind(R),o.addEventListener("load",f),o.addEventListener("error",f))}}function $y(){if(zf===null)throw Error(D(475));var o=zf;return o.stylesheets&&o.count===0&&e_(o,o.stylesheets),0<o.count?function(f){var x=setTimeout(function(){if(o.stylesheets&&e_(o,o.stylesheets),o.unsuspend){var R=o.unsuspend;o.unsuspend=null,R()}},6e4);return o.unsuspend=f,function(){o.unsuspend=null,clearTimeout(x)}}:null}function ih(){if(this.count--,this.count===0){if(this.stylesheets)e_(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var zp=null;function e_(o,f){o.stylesheets=null,o.unsuspend!==null&&(o.count++,zp=new Map,f.forEach(P0,o),zp=null,ih.call(o))}function P0(o,f){if(!(f.state.loading&4)){var x=zp.get(o);if(x)var R=x.get(null);else{x=new Map,zp.set(o,x);for(var B=o.querySelectorAll("link[data-precedence],style[data-precedence]"),G=0;G<B.length;G++){var se=B[G];(se.nodeName==="LINK"||se.getAttribute("media")!=="not all")&&(x.set(se.dataset.precedence,se),R=se)}R&&x.set(null,R)}B=f.instance,se=B.getAttribute("data-precedence"),G=x.get(se)||R,G===R&&x.set(null,B),x.set(se,B),this.count++,R=ih.bind(this),B.addEventListener("load",R),B.addEventListener("error",R),G?G.parentNode.insertBefore(B,G.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(B,o.firstChild)),f.state.loading|=4}}var Lp={$$typeof:mt,Provider:null,Consumer:null,_currentValue:pi,_currentValue2:pi,_threadCount:0};function k0(o,f,x,R,B,G,se,be){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ma(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ma(0),this.hiddenUpdates=Ma(null),this.identifierPrefix=R,this.onUncaughtError=B,this.onCaughtError=G,this.onRecoverableError=se,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=be,this.incompleteTransitions=new Map}function Xy(o,f,x,R,B,G,se,be,Ye,Et,Zt,Qt){return o=new k0(o,f,x,se,be,Ye,Et,Qt),f=1,G===!0&&(f|=24),G=Qa(3,null,null,f),o.current=G,G.stateNode=o,f=Ud(),f.refCount++,o.pooledCache=f,f.refCount++,G.memoizedState={element:R,isDehydrated:x,cache:f},_i(G),o}function Yy(o){return o?(o=Mc,o):Mc}function Wy(o,f,x,R,B,G){B=Yy(B),R.context===null?R.context=B:R.pendingContext=B,R=Nl(f),R.payload={element:x},G=G===void 0?null:G,G!==null&&(R.callback=G),x=al(o,R,f),x!==null&&(to(x,o,f),Fl(x,o,f))}function Ky(o,f){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var x=o.retryLane;o.retryLane=x!==0&&x<f?x:f}}function t_(o,f){Ky(o,f),(o=o.alternate)&&Ky(o,f)}function Jy(o){if(o.tag===13){var f=Ja(o,67108864);f!==null&&to(f,o,67108864),t_(o,67108864)}}var i_=!0;function B0(o,f,x,R){var B=pt.T;pt.T=null;var G=ni.p;try{ni.p=2,Op(o,f,x,R)}finally{ni.p=G,pt.T=B}}function fg(o,f,x,R){var B=pt.T;pt.T=null;var G=ni.p;try{ni.p=8,Op(o,f,x,R)}finally{ni.p=G,pt.T=B}}function Op(o,f,x,R){if(i_){var B=n_(R);if(B===null)J_(o,f,R,Pp,x),mg(o,R);else if(N0(B,o,f,x,R))R.stopPropagation();else if(mg(o,R),f&4&&-1<kp.indexOf(o)){for(;B!==null;){var G=Ht(B);if(G!==null)switch(G.tag){case 3:if(G=G.stateNode,G.current.memoizedState.isDehydrated){var se=Wr(G.pendingLanes);if(se!==0){var be=G;for(be.pendingLanes|=2,be.entangledLanes|=2;se;){var Ye=1<<31-sn(se);be.entanglements[1]|=Ye,se&=~Ye}io(G),(Gi&6)===0&&(Dr=qr()+500,od(0))}}break;case 13:be=Ja(G,2),be!==null&&to(be,G,2),bp(),t_(G,2)}if(G=n_(R),G===null&&J_(o,f,R,Pp,x),G===B)break;B=G}B!==null&&R.stopPropagation()}else J_(o,f,R,null,x)}}function n_(o){return o=vh(o),r_(o)}var Pp=null;function r_(o){if(Pp=null,o=Dt(o),o!==null){var f=F(o);if(f===null)o=null;else{var x=f.tag;if(x===13){if(o=X(f),o!==null)return o;o=null}else if(x===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;o=null}else f!==o&&(o=null)}}return Pp=o,null}function pg(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ln()){case Br:return 2;case Bs:return 8;case Es:case Qe:return 32;case Mt:return 268435456;default:return 32}default:return 32}}var a_=!1,tu=null,iu=null,nu=null,ud=new Map,Lf=new Map,nh=[],kp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function mg(o,f){switch(o){case"focusin":case"focusout":tu=null;break;case"dragenter":case"dragleave":iu=null;break;case"mouseover":case"mouseout":nu=null;break;case"pointerover":case"pointerout":ud.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lf.delete(f.pointerId)}}function Bp(o,f,x,R,B,G){return o===null||o.nativeEvent!==G?(o={blockedOn:f,domEventName:x,eventSystemFlags:R,nativeEvent:G,targetContainers:[B]},f!==null&&(f=Ht(f),f!==null&&Jy(f)),o):(o.eventSystemFlags|=R,f=o.targetContainers,B!==null&&f.indexOf(B)===-1&&f.push(B),o)}function N0(o,f,x,R,B){switch(f){case"focusin":return tu=Bp(tu,o,f,x,R,B),!0;case"dragenter":return iu=Bp(iu,o,f,x,R,B),!0;case"mouseover":return nu=Bp(nu,o,f,x,R,B),!0;case"pointerover":var G=B.pointerId;return ud.set(G,Bp(ud.get(G)||null,o,f,x,R,B)),!0;case"gotpointercapture":return G=B.pointerId,Lf.set(G,Bp(Lf.get(G)||null,o,f,x,R,B)),!0}return!1}function Qy(o){var f=Dt(o.target);if(f!==null){var x=F(f);if(x!==null){if(f=x.tag,f===13){if(f=X(x),f!==null){o.blockedOn=f,ie(o.priority,function(){if(x.tag===13){var R=Ha();R=wu(R);var B=Ja(x,R);B!==null&&to(B,x,R),t_(x,R)}});return}}else if(f===3&&x.stateNode.current.memoizedState.isDehydrated){o.blockedOn=x.tag===3?x.stateNode.containerInfo:null;return}}}o.blockedOn=null}function s_(o){if(o.blockedOn!==null)return!1;for(var f=o.targetContainers;0<f.length;){var x=n_(o.nativeEvent);if(x===null){x=o.nativeEvent;var R=new x.constructor(x.type,x);Mn=R,x.target.dispatchEvent(R),Mn=null}else return f=Ht(x),f!==null&&Jy(f),o.blockedOn=x,!1;f.shift()}return!0}function ev(o,f,x){s_(o)&&x.delete(f)}function F0(){a_=!1,tu!==null&&s_(tu)&&(tu=null),iu!==null&&s_(iu)&&(iu=null),nu!==null&&s_(nu)&&(nu=null),ud.forEach(ev),Lf.forEach(ev)}function o_(o,f){o.blockedOn===f&&(o.blockedOn=null,a_||(a_=!0,m.unstable_scheduleCallback(m.unstable_NormalPriority,F0)))}var Np=null;function tv(o){Np!==o&&(Np=o,m.unstable_scheduleCallback(m.unstable_NormalPriority,function(){Np===o&&(Np=null);for(var f=0;f<o.length;f+=3){var x=o[f],R=o[f+1],B=o[f+2];if(typeof R!="function"){if(r_(R||x)===null)continue;break}var G=Ht(x);G!==null&&(o.splice(f,3),f-=3,Uu(G,{pending:!0,data:B,method:x.method,action:R},R,B))}}))}function Xr(o){function f(Ye){return o_(Ye,o)}tu!==null&&o_(tu,o),iu!==null&&o_(iu,o),nu!==null&&o_(nu,o),ud.forEach(f),Lf.forEach(f);for(var x=0;x<nh.length;x++){var R=nh[x];R.blockedOn===o&&(R.blockedOn=null)}for(;0<nh.length&&(x=nh[0],x.blockedOn===null);)Qy(x),x.blockedOn===null&&nh.shift();if(x=(o.ownerDocument||o).$$reactFormReplay,x!=null)for(R=0;R<x.length;R+=3){var B=x[R],G=x[R+1],se=B[Ae]||null;if(typeof G=="function")se||tv(x);else if(se){var be=null;if(G&&G.hasAttribute("formAction")){if(B=G,se=G[Ae]||null)be=se.formAction;else if(r_(B)!==null)continue}else be=se.action;typeof be=="function"?x[R+1]=be:(x.splice(R,3),R-=3),tv(x)}}}function xo(o){this._internalRoot=o}Fp.prototype.render=xo.prototype.render=function(o){var f=this._internalRoot;if(f===null)throw Error(D(409));var x=f.current,R=Ha();Wy(x,R,o,f,null,null)},Fp.prototype.unmount=xo.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var f=o.containerInfo;Wy(o.current,2,null,o,null,null),bp(),f[Me]=null}};function Fp(o){this._internalRoot=o}Fp.prototype.unstable_scheduleHydration=function(o){if(o){var f=at();o={blockedOn:null,target:o,priority:f};for(var x=0;x<nh.length&&f!==0&&f<nh[x].priority;x++);nh.splice(x,0,o),x===0&&Qy(o)}};var l_=v.version;if(l_!=="19.1.0")throw Error(D(527,l_,"19.1.0"));ni.findDOMNode=function(o){var f=o._reactInternals;if(f===void 0)throw typeof o.render=="function"?Error(D(188)):(o=Object.keys(o).join(","),Error(D(268,o)));return o=re(f),o=o!==null?J(o):null,o=o===null?null:o.stateNode,o};var c_={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:pt,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{gi=ru.inject(c_),ri=ru}catch{}}return Ng.createRoot=function(o,f){if(!O(o))throw Error(D(299));var x=!1,R="",B=mp,G=_p,se=Zu,be=null;return f!=null&&(f.unstable_strictMode===!0&&(x=!0),f.identifierPrefix!==void 0&&(R=f.identifierPrefix),f.onUncaughtError!==void 0&&(B=f.onUncaughtError),f.onCaughtError!==void 0&&(G=f.onCaughtError),f.onRecoverableError!==void 0&&(se=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(be=f.unstable_transitionCallbacks)),f=Xy(o,1,!1,null,null,x,R,B,G,se,be,null),o[Me]=f.current,Hm(o),new xo(f)},Ng.hydrateRoot=function(o,f,x){if(!O(o))throw Error(D(299));var R=!1,B="",G=mp,se=_p,be=Zu,Ye=null,Et=null;return x!=null&&(x.unstable_strictMode===!0&&(R=!0),x.identifierPrefix!==void 0&&(B=x.identifierPrefix),x.onUncaughtError!==void 0&&(G=x.onUncaughtError),x.onCaughtError!==void 0&&(se=x.onCaughtError),x.onRecoverableError!==void 0&&(be=x.onRecoverableError),x.unstable_transitionCallbacks!==void 0&&(Ye=x.unstable_transitionCallbacks),x.formState!==void 0&&(Et=x.formState)),f=Xy(o,1,!0,f,x??null,R,B,G,se,be,Ye,Et),f.context=Yy(null),x=f.current,R=Ha(),R=wu(R),B=Nl(R),B.callback=null,al(x,B,R),x=R,f.current.lanes=x,so(f,x),io(f),o[Me]=f.current,Hm(o),new Fp(f)},Ng.version="19.1.0",Ng}var v2;function IM(){if(v2)return Dx.exports;v2=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(v){console.error(v)}}return m(),Dx.exports=CM(),Dx.exports}var RM=IM(),Fg={},x2;function DM(){if(x2)return Fg;x2=1,Object.defineProperty(Fg,"__esModule",{value:!0}),Fg.parse=X,Fg.serialize=J;const m=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,v=/^[\u0021-\u003A\u003C-\u007E]*$/,S=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,D=/^[\u0020-\u003A\u003D-\u007E]*$/,O=Object.prototype.toString,F=(()=>{const je=function(){};return je.prototype=Object.create(null),je})();function X(je,ft){const Le=new F,Fe=je.length;if(Fe<2)return Le;const qe=(ft==null?void 0:ft.decode)||oe;let He=0;do{const tt=je.indexOf("=",He);if(tt===-1)break;const mt=je.indexOf(";",He),Tt=mt===-1?Fe:mt;if(tt>Tt){He=je.lastIndexOf(";",tt-1)+1;continue}const kt=r(je,He,tt),At=re(je,tt,kt),ot=je.slice(kt,At);if(Le[ot]===void 0){let hi=r(je,tt+1,Tt),Mi=re(je,Tt,hi);const ti=qe(je.slice(hi,Mi));Le[ot]=ti}He=Tt+1}while(He<Fe);return Le}function r(je,ft,Le){do{const Fe=je.charCodeAt(ft);if(Fe!==32&&Fe!==9)return ft}while(++ft<Le);return Le}function re(je,ft,Le){for(;ft>Le;){const Fe=je.charCodeAt(--ft);if(Fe!==32&&Fe!==9)return ft+1}return Le}function J(je,ft,Le){const Fe=(Le==null?void 0:Le.encode)||encodeURIComponent;if(!m.test(je))throw new TypeError(`argument name is invalid: ${je}`);const qe=Fe(ft);if(!v.test(qe))throw new TypeError(`argument val is invalid: ${ft}`);let He=je+"="+qe;if(!Le)return He;if(Le.maxAge!==void 0){if(!Number.isInteger(Le.maxAge))throw new TypeError(`option maxAge is invalid: ${Le.maxAge}`);He+="; Max-Age="+Le.maxAge}if(Le.domain){if(!S.test(Le.domain))throw new TypeError(`option domain is invalid: ${Le.domain}`);He+="; Domain="+Le.domain}if(Le.path){if(!D.test(Le.path))throw new TypeError(`option path is invalid: ${Le.path}`);He+="; Path="+Le.path}if(Le.expires){if(!ze(Le.expires)||!Number.isFinite(Le.expires.valueOf()))throw new TypeError(`option expires is invalid: ${Le.expires}`);He+="; Expires="+Le.expires.toUTCString()}if(Le.httpOnly&&(He+="; HttpOnly"),Le.secure&&(He+="; Secure"),Le.partitioned&&(He+="; Partitioned"),Le.priority)switch(typeof Le.priority=="string"?Le.priority.toLowerCase():void 0){case"low":He+="; Priority=Low";break;case"medium":He+="; Priority=Medium";break;case"high":He+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${Le.priority}`)}if(Le.sameSite)switch(typeof Le.sameSite=="string"?Le.sameSite.toLowerCase():Le.sameSite){case!0:case"strict":He+="; SameSite=Strict";break;case"lax":He+="; SameSite=Lax";break;case"none":He+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${Le.sameSite}`)}return He}function oe(je){if(je.indexOf("%")===-1)return je;try{return decodeURIComponent(je)}catch{return je}}function ze(je){return O.call(je)==="[object Date]"}return Fg}DM();/**
 * react-router v7.4.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var b2="popstate";function zM(m={}){function v(D,O){let{pathname:F,search:X,hash:r}=D.location;return Zx("",{pathname:F,search:X,hash:r},O.state&&O.state.usr||null,O.state&&O.state.key||"default")}function S(D,O){return typeof O=="string"?O:Kg(O)}return OM(v,S,null,m)}function ha(m,v){if(m===!1||m===null||typeof m>"u")throw new Error(v)}function mu(m,v){if(!m){typeof console<"u"&&console.warn(v);try{throw new Error(v)}catch{}}}function LM(){return Math.random().toString(36).substring(2,10)}function w2(m,v){return{usr:m.state,key:m.key,idx:v}}function Zx(m,v,S=null,D){return{pathname:typeof m=="string"?m:m.pathname,search:"",hash:"",...typeof v=="string"?z_(v):v,state:S,key:v&&v.key||D||LM()}}function Kg({pathname:m="/",search:v="",hash:S=""}){return v&&v!=="?"&&(m+=v.charAt(0)==="?"?v:"?"+v),S&&S!=="#"&&(m+=S.charAt(0)==="#"?S:"#"+S),m}function z_(m){let v={};if(m){let S=m.indexOf("#");S>=0&&(v.hash=m.substring(S),m=m.substring(0,S));let D=m.indexOf("?");D>=0&&(v.search=m.substring(D),m=m.substring(0,D)),m&&(v.pathname=m)}return v}function OM(m,v,S,D={}){let{window:O=document.defaultView,v5Compat:F=!1}=D,X=O.history,r="POP",re=null,J=oe();J==null&&(J=0,X.replaceState({...X.state,idx:J},""));function oe(){return(X.state||{idx:null}).idx}function ze(){r="POP";let qe=oe(),He=qe==null?null:qe-J;J=qe,re&&re({action:r,location:Fe.location,delta:He})}function je(qe,He){r="PUSH";let tt=Zx(Fe.location,qe,He);J=oe()+1;let mt=w2(tt,J),Tt=Fe.createHref(tt);try{X.pushState(mt,"",Tt)}catch(kt){if(kt instanceof DOMException&&kt.name==="DataCloneError")throw kt;O.location.assign(Tt)}F&&re&&re({action:r,location:Fe.location,delta:1})}function ft(qe,He){r="REPLACE";let tt=Zx(Fe.location,qe,He);J=oe();let mt=w2(tt,J),Tt=Fe.createHref(tt);X.replaceState(mt,"",Tt),F&&re&&re({action:r,location:Fe.location,delta:0})}function Le(qe){let He=O.location.origin!=="null"?O.location.origin:O.location.href,tt=typeof qe=="string"?qe:Kg(qe);return tt=tt.replace(/ $/,"%20"),ha(He,`No window.location.(origin|href) available to create URL for href: ${tt}`),new URL(tt,He)}let Fe={get action(){return r},get location(){return m(O,X)},listen(qe){if(re)throw new Error("A history only accepts one active listener");return O.addEventListener(b2,ze),re=qe,()=>{O.removeEventListener(b2,ze),re=null}},createHref(qe){return v(O,qe)},createURL:Le,encodeLocation(qe){let He=Le(qe);return{pathname:He.pathname,search:He.search,hash:He.hash}},push:je,replace:ft,go(qe){return X.go(qe)}};return Fe}function yT(m,v,S="/"){return PM(m,v,S,!1)}function PM(m,v,S,D){let O=typeof v=="string"?z_(v):v,F=wd(O.pathname||"/",S);if(F==null)return null;let X=vT(m);kM(X);let r=null;for(let re=0;r==null&&re<X.length;++re){let J=$M(F);r=HM(X[re],J,D)}return r}function vT(m,v=[],S=[],D=""){let O=(F,X,r)=>{let re={relativePath:r===void 0?F.path||"":r,caseSensitive:F.caseSensitive===!0,childrenIndex:X,route:F};re.relativePath.startsWith("/")&&(ha(re.relativePath.startsWith(D),`Absolute route path "${re.relativePath}" nested under path "${D}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),re.relativePath=re.relativePath.slice(D.length));let J=xd([D,re.relativePath]),oe=S.concat(re);F.children&&F.children.length>0&&(ha(F.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${J}".`),vT(F.children,v,oe,J)),!(F.path==null&&!F.index)&&v.push({path:J,score:qM(J,F.index),routesMeta:oe})};return m.forEach((F,X)=>{var r;if(F.path===""||!((r=F.path)!=null&&r.includes("?")))O(F,X);else for(let re of xT(F.path))O(F,X,re)}),v}function xT(m){let v=m.split("/");if(v.length===0)return[];let[S,...D]=v,O=S.endsWith("?"),F=S.replace(/\?$/,"");if(D.length===0)return O?[F,""]:[F];let X=xT(D.join("/")),r=[];return r.push(...X.map(re=>re===""?F:[F,re].join("/"))),O&&r.push(...X),r.map(re=>m.startsWith("/")&&re===""?"/":re)}function kM(m){m.sort((v,S)=>v.score!==S.score?S.score-v.score:GM(v.routesMeta.map(D=>D.childrenIndex),S.routesMeta.map(D=>D.childrenIndex)))}var BM=/^:[\w-]+$/,NM=3,FM=2,VM=1,UM=10,jM=-2,T2=m=>m==="*";function qM(m,v){let S=m.split("/"),D=S.length;return S.some(T2)&&(D+=jM),v&&(D+=FM),S.filter(O=>!T2(O)).reduce((O,F)=>O+(BM.test(F)?NM:F===""?VM:UM),D)}function GM(m,v){return m.length===v.length&&m.slice(0,-1).every((D,O)=>D===v[O])?m[m.length-1]-v[v.length-1]:0}function HM(m,v,S=!1){let{routesMeta:D}=m,O={},F="/",X=[];for(let r=0;r<D.length;++r){let re=D[r],J=r===D.length-1,oe=F==="/"?v:v.slice(F.length)||"/",ze=Zv({path:re.relativePath,caseSensitive:re.caseSensitive,end:J},oe),je=re.route;if(!ze&&J&&S&&!D[D.length-1].route.index&&(ze=Zv({path:re.relativePath,caseSensitive:re.caseSensitive,end:!1},oe)),!ze)return null;Object.assign(O,ze.params),X.push({params:O,pathname:xd([F,ze.pathname]),pathnameBase:KM(xd([F,ze.pathnameBase])),route:je}),ze.pathnameBase!=="/"&&(F=xd([F,ze.pathnameBase]))}return X}function Zv(m,v){typeof m=="string"&&(m={path:m,caseSensitive:!1,end:!0});let[S,D]=ZM(m.path,m.caseSensitive,m.end),O=v.match(S);if(!O)return null;let F=O[0],X=F.replace(/(.)\/+$/,"$1"),r=O.slice(1);return{params:D.reduce((J,{paramName:oe,isOptional:ze},je)=>{if(oe==="*"){let Le=r[je]||"";X=F.slice(0,F.length-Le.length).replace(/(.)\/+$/,"$1")}const ft=r[je];return ze&&!ft?J[oe]=void 0:J[oe]=(ft||"").replace(/%2F/g,"/"),J},{}),pathname:F,pathnameBase:X,pattern:m}}function ZM(m,v=!1,S=!0){mu(m==="*"||!m.endsWith("*")||m.endsWith("/*"),`Route path "${m}" will be treated as if it were "${m.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${m.replace(/\*$/,"/*")}".`);let D=[],O="^"+m.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(X,r,re)=>(D.push({paramName:r,isOptional:re!=null}),re?"/?([^\\/]+)?":"/([^\\/]+)"));return m.endsWith("*")?(D.push({paramName:"*"}),O+=m==="*"||m==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):S?O+="\\/*$":m!==""&&m!=="/"&&(O+="(?:(?=\\/|$))"),[new RegExp(O,v?void 0:"i"),D]}function $M(m){try{return m.split("/").map(v=>decodeURIComponent(v).replace(/\//g,"%2F")).join("/")}catch(v){return mu(!1,`The URL path "${m}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${v}).`),m}}function wd(m,v){if(v==="/")return m;if(!m.toLowerCase().startsWith(v.toLowerCase()))return null;let S=v.endsWith("/")?v.length-1:v.length,D=m.charAt(S);return D&&D!=="/"?null:m.slice(S)||"/"}function XM(m,v="/"){let{pathname:S,search:D="",hash:O=""}=typeof m=="string"?z_(m):m;return{pathname:S?S.startsWith("/")?S:YM(S,v):v,search:JM(D),hash:QM(O)}}function YM(m,v){let S=v.replace(/\/+$/,"").split("/");return m.split("/").forEach(O=>{O===".."?S.length>1&&S.pop():O!=="."&&S.push(O)}),S.length>1?S.join("/"):"/"}function Px(m,v,S,D){return`Cannot include a '${m}' character in a manually specified \`to.${v}\` field [${JSON.stringify(D)}].  Please separate it out to the \`to.${S}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function WM(m){return m.filter((v,S)=>S===0||v.route.path&&v.route.path.length>0)}function x1(m){let v=WM(m);return v.map((S,D)=>D===v.length-1?S.pathname:S.pathnameBase)}function b1(m,v,S,D=!1){let O;typeof m=="string"?O=z_(m):(O={...m},ha(!O.pathname||!O.pathname.includes("?"),Px("?","pathname","search",O)),ha(!O.pathname||!O.pathname.includes("#"),Px("#","pathname","hash",O)),ha(!O.search||!O.search.includes("#"),Px("#","search","hash",O)));let F=m===""||O.pathname==="",X=F?"/":O.pathname,r;if(X==null)r=S;else{let ze=v.length-1;if(!D&&X.startsWith("..")){let je=X.split("/");for(;je[0]==="..";)je.shift(),ze-=1;O.pathname=je.join("/")}r=ze>=0?v[ze]:"/"}let re=XM(O,r),J=X&&X!=="/"&&X.endsWith("/"),oe=(F||X===".")&&S.endsWith("/");return!re.pathname.endsWith("/")&&(J||oe)&&(re.pathname+="/"),re}var xd=m=>m.join("/").replace(/\/\/+/g,"/"),KM=m=>m.replace(/\/+$/,"").replace(/^\/*/,"/"),JM=m=>!m||m==="?"?"":m.startsWith("?")?m:"?"+m,QM=m=>!m||m==="#"?"":m.startsWith("#")?m:"#"+m;function eC(m){return m!=null&&typeof m.status=="number"&&typeof m.statusText=="string"&&typeof m.internal=="boolean"&&"data"in m}var bT=["POST","PUT","PATCH","DELETE"];new Set(bT);var tC=["GET",...bT];new Set(tC);var L_=Ie.createContext(null);L_.displayName="DataRouter";var l0=Ie.createContext(null);l0.displayName="DataRouterState";var wT=Ie.createContext({isTransitioning:!1});wT.displayName="ViewTransition";var iC=Ie.createContext(new Map);iC.displayName="Fetchers";var nC=Ie.createContext(null);nC.displayName="Await";var gu=Ie.createContext(null);gu.displayName="Navigation";var fy=Ie.createContext(null);fy.displayName="Location";var uc=Ie.createContext({outlet:null,matches:[],isDataRoute:!1});uc.displayName="Route";var w1=Ie.createContext(null);w1.displayName="RouteError";function rC(m,{relative:v}={}){ha(O_(),"useHref() may be used only in the context of a <Router> component.");let{basename:S,navigator:D}=Ie.useContext(gu),{hash:O,pathname:F,search:X}=py(m,{relative:v}),r=F;return S!=="/"&&(r=F==="/"?S:xd([S,F])),D.createHref({pathname:r,search:X,hash:O})}function O_(){return Ie.useContext(fy)!=null}function dh(){return ha(O_(),"useLocation() may be used only in the context of a <Router> component."),Ie.useContext(fy).location}var TT="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function ST(m){Ie.useContext(gu).static||Ie.useLayoutEffect(m)}function Wf(){let{isDataRoute:m}=Ie.useContext(uc);return m?vC():aC()}function aC(){ha(O_(),"useNavigate() may be used only in the context of a <Router> component.");let m=Ie.useContext(L_),{basename:v,navigator:S}=Ie.useContext(gu),{matches:D}=Ie.useContext(uc),{pathname:O}=dh(),F=JSON.stringify(x1(D)),X=Ie.useRef(!1);return ST(()=>{X.current=!0}),Ie.useCallback((re,J={})=>{if(mu(X.current,TT),!X.current)return;if(typeof re=="number"){S.go(re);return}let oe=b1(re,JSON.parse(F),O,J.relative==="path");m==null&&v!=="/"&&(oe.pathname=oe.pathname==="/"?v:xd([v,oe.pathname])),(J.replace?S.replace:S.push)(oe,J.state,J)},[v,S,F,O,m])}var sC=Ie.createContext(null);function oC(m){let v=Ie.useContext(uc).outlet;return v&&Ie.createElement(sC.Provider,{value:m},v)}function ET(){let{matches:m}=Ie.useContext(uc),v=m[m.length-1];return v?v.params:{}}function py(m,{relative:v}={}){let{matches:S}=Ie.useContext(uc),{pathname:D}=dh(),O=JSON.stringify(x1(S));return Ie.useMemo(()=>b1(m,JSON.parse(O),D,v==="path"),[m,O,D,v])}function lC(m,v){return AT(m,v)}function AT(m,v,S,D){var tt;ha(O_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:O,static:F}=Ie.useContext(gu),{matches:X}=Ie.useContext(uc),r=X[X.length-1],re=r?r.params:{},J=r?r.pathname:"/",oe=r?r.pathnameBase:"/",ze=r&&r.route;{let mt=ze&&ze.path||"";MT(J,!ze||mt.endsWith("*")||mt.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${J}" (under <Route path="${mt}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${mt}"> to <Route path="${mt==="/"?"*":`${mt}/*`}">.`)}let je=dh(),ft;if(v){let mt=typeof v=="string"?z_(v):v;ha(oe==="/"||((tt=mt.pathname)==null?void 0:tt.startsWith(oe)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${oe}" but pathname "${mt.pathname}" was given in the \`location\` prop.`),ft=mt}else ft=je;let Le=ft.pathname||"/",Fe=Le;if(oe!=="/"){let mt=oe.replace(/^\//,"").split("/");Fe="/"+Le.replace(/^\//,"").split("/").slice(mt.length).join("/")}let qe=!F&&S&&S.matches&&S.matches.length>0?S.matches:yT(m,{pathname:Fe});mu(ze||qe!=null,`No routes matched location "${ft.pathname}${ft.search}${ft.hash}" `),mu(qe==null||qe[qe.length-1].route.element!==void 0||qe[qe.length-1].route.Component!==void 0||qe[qe.length-1].route.lazy!==void 0,`Matched leaf route at location "${ft.pathname}${ft.search}${ft.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let He=fC(qe&&qe.map(mt=>Object.assign({},mt,{params:Object.assign({},re,mt.params),pathname:xd([oe,O.encodeLocation?O.encodeLocation(mt.pathname).pathname:mt.pathname]),pathnameBase:mt.pathnameBase==="/"?oe:xd([oe,O.encodeLocation?O.encodeLocation(mt.pathnameBase).pathname:mt.pathnameBase])})),X,S,D);return v&&He?Ie.createElement(fy.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ft},navigationType:"POP"}},He):He}function cC(){let m=yC(),v=eC(m)?`${m.status} ${m.statusText}`:m instanceof Error?m.message:JSON.stringify(m),S=m instanceof Error?m.stack:null,D="rgba(200,200,200, 0.5)",O={padding:"0.5rem",backgroundColor:D},F={padding:"2px 4px",backgroundColor:D},X=null;return console.error("Error handled by React Router default ErrorBoundary:",m),X=Ie.createElement(Ie.Fragment,null,Ie.createElement("p",null,"💿 Hey developer 👋"),Ie.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Ie.createElement("code",{style:F},"ErrorBoundary")," or"," ",Ie.createElement("code",{style:F},"errorElement")," prop on your route.")),Ie.createElement(Ie.Fragment,null,Ie.createElement("h2",null,"Unexpected Application Error!"),Ie.createElement("h3",{style:{fontStyle:"italic"}},v),S?Ie.createElement("pre",{style:O},S):null,X)}var uC=Ie.createElement(cC,null),hC=class extends Ie.Component{constructor(m){super(m),this.state={location:m.location,revalidation:m.revalidation,error:m.error}}static getDerivedStateFromError(m){return{error:m}}static getDerivedStateFromProps(m,v){return v.location!==m.location||v.revalidation!=="idle"&&m.revalidation==="idle"?{error:m.error,location:m.location,revalidation:m.revalidation}:{error:m.error!==void 0?m.error:v.error,location:v.location,revalidation:m.revalidation||v.revalidation}}componentDidCatch(m,v){console.error("React Router caught the following error during render",m,v)}render(){return this.state.error!==void 0?Ie.createElement(uc.Provider,{value:this.props.routeContext},Ie.createElement(w1.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function dC({routeContext:m,match:v,children:S}){let D=Ie.useContext(L_);return D&&D.static&&D.staticContext&&(v.route.errorElement||v.route.ErrorBoundary)&&(D.staticContext._deepestRenderedBoundaryId=v.route.id),Ie.createElement(uc.Provider,{value:m},S)}function fC(m,v=[],S=null,D=null){if(m==null){if(!S)return null;if(S.errors)m=S.matches;else if(v.length===0&&!S.initialized&&S.matches.length>0)m=S.matches;else return null}let O=m,F=S==null?void 0:S.errors;if(F!=null){let re=O.findIndex(J=>J.route.id&&(F==null?void 0:F[J.route.id])!==void 0);ha(re>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(F).join(",")}`),O=O.slice(0,Math.min(O.length,re+1))}let X=!1,r=-1;if(S)for(let re=0;re<O.length;re++){let J=O[re];if((J.route.HydrateFallback||J.route.hydrateFallbackElement)&&(r=re),J.route.id){let{loaderData:oe,errors:ze}=S,je=J.route.loader&&!oe.hasOwnProperty(J.route.id)&&(!ze||ze[J.route.id]===void 0);if(J.route.lazy||je){X=!0,r>=0?O=O.slice(0,r+1):O=[O[0]];break}}}return O.reduceRight((re,J,oe)=>{let ze,je=!1,ft=null,Le=null;S&&(ze=F&&J.route.id?F[J.route.id]:void 0,ft=J.route.errorElement||uC,X&&(r<0&&oe===0?(MT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),je=!0,Le=null):r===oe&&(je=!0,Le=J.route.hydrateFallbackElement||null)));let Fe=v.concat(O.slice(0,oe+1)),qe=()=>{let He;return ze?He=ft:je?He=Le:J.route.Component?He=Ie.createElement(J.route.Component,null):J.route.element?He=J.route.element:He=re,Ie.createElement(dC,{match:J,routeContext:{outlet:re,matches:Fe,isDataRoute:S!=null},children:He})};return S&&(J.route.ErrorBoundary||J.route.errorElement||oe===0)?Ie.createElement(hC,{location:S.location,revalidation:S.revalidation,component:ft,error:ze,children:qe(),routeContext:{outlet:null,matches:Fe,isDataRoute:!0}}):qe()},null)}function T1(m){return`${m} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function pC(m){let v=Ie.useContext(L_);return ha(v,T1(m)),v}function mC(m){let v=Ie.useContext(l0);return ha(v,T1(m)),v}function _C(m){let v=Ie.useContext(uc);return ha(v,T1(m)),v}function S1(m){let v=_C(m),S=v.matches[v.matches.length-1];return ha(S.route.id,`${m} can only be used on routes that contain a unique "id"`),S.route.id}function gC(){return S1("useRouteId")}function yC(){var D;let m=Ie.useContext(w1),v=mC("useRouteError"),S=S1("useRouteError");return m!==void 0?m:(D=v.errors)==null?void 0:D[S]}function vC(){let{router:m}=pC("useNavigate"),v=S1("useNavigate"),S=Ie.useRef(!1);return ST(()=>{S.current=!0}),Ie.useCallback(async(O,F={})=>{mu(S.current,TT),S.current&&(typeof O=="number"?m.navigate(O):await m.navigate(O,{fromRouteId:v,...F}))},[m,v])}var S2={};function MT(m,v,S){!v&&!S2[m]&&(S2[m]=!0,mu(!1,S))}Ie.memo(xC);function xC({routes:m,future:v,state:S}){return AT(m,void 0,S,v)}function bC({to:m,replace:v,state:S,relative:D}){ha(O_(),"<Navigate> may be used only in the context of a <Router> component.");let{static:O}=Ie.useContext(gu);mu(!O,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:F}=Ie.useContext(uc),{pathname:X}=dh(),r=Wf(),re=b1(m,x1(F),X,D==="path"),J=JSON.stringify(re);return Ie.useEffect(()=>{r(JSON.parse(J),{replace:v,state:S,relative:D})},[r,J,D,v,S]),null}function wC(m){return oC(m.context)}function sh(m){ha(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function TC({basename:m="/",children:v=null,location:S,navigationType:D="POP",navigator:O,static:F=!1}){ha(!O_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let X=m.replace(/^\/*/,"/"),r=Ie.useMemo(()=>({basename:X,navigator:O,static:F,future:{}}),[X,O,F]);typeof S=="string"&&(S=z_(S));let{pathname:re="/",search:J="",hash:oe="",state:ze=null,key:je="default"}=S,ft=Ie.useMemo(()=>{let Le=wd(re,X);return Le==null?null:{location:{pathname:Le,search:J,hash:oe,state:ze,key:je},navigationType:D}},[X,re,J,oe,ze,je,D]);return mu(ft!=null,`<Router basename="${X}"> is not able to match the URL "${re}${J}${oe}" because it does not start with the basename, so the <Router> won't render anything.`),ft==null?null:Ie.createElement(gu.Provider,{value:r},Ie.createElement(fy.Provider,{children:v,value:ft}))}function SC({children:m,location:v}){return lC($x(m),v)}function $x(m,v=[]){let S=[];return Ie.Children.forEach(m,(D,O)=>{if(!Ie.isValidElement(D))return;let F=[...v,O];if(D.type===Ie.Fragment){S.push.apply(S,$x(D.props.children,F));return}ha(D.type===sh,`[${typeof D.type=="string"?D.type:D.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ha(!D.props.index||!D.props.children,"An index route cannot have child routes.");let X={id:D.props.id||F.join("-"),caseSensitive:D.props.caseSensitive,element:D.props.element,Component:D.props.Component,index:D.props.index,path:D.props.path,loader:D.props.loader,action:D.props.action,hydrateFallbackElement:D.props.hydrateFallbackElement,HydrateFallback:D.props.HydrateFallback,errorElement:D.props.errorElement,ErrorBoundary:D.props.ErrorBoundary,hasErrorBoundary:D.props.hasErrorBoundary===!0||D.props.ErrorBoundary!=null||D.props.errorElement!=null,shouldRevalidate:D.props.shouldRevalidate,handle:D.props.handle,lazy:D.props.lazy};D.props.children&&(X.children=$x(D.props.children,F)),S.push(X)}),S}var Bv="get",Nv="application/x-www-form-urlencoded";function c0(m){return m!=null&&typeof m.tagName=="string"}function EC(m){return c0(m)&&m.tagName.toLowerCase()==="button"}function AC(m){return c0(m)&&m.tagName.toLowerCase()==="form"}function MC(m){return c0(m)&&m.tagName.toLowerCase()==="input"}function CC(m){return!!(m.metaKey||m.altKey||m.ctrlKey||m.shiftKey)}function IC(m,v){return m.button===0&&(!v||v==="_self")&&!CC(m)}var Ov=null;function RC(){if(Ov===null)try{new FormData(document.createElement("form"),0),Ov=!1}catch{Ov=!0}return Ov}var DC=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function kx(m){return m!=null&&!DC.has(m)?(mu(!1,`"${m}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nv}"`),null):m}function zC(m,v){let S,D,O,F,X;if(AC(m)){let r=m.getAttribute("action");D=r?wd(r,v):null,S=m.getAttribute("method")||Bv,O=kx(m.getAttribute("enctype"))||Nv,F=new FormData(m)}else if(EC(m)||MC(m)&&(m.type==="submit"||m.type==="image")){let r=m.form;if(r==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let re=m.getAttribute("formaction")||r.getAttribute("action");if(D=re?wd(re,v):null,S=m.getAttribute("formmethod")||r.getAttribute("method")||Bv,O=kx(m.getAttribute("formenctype"))||kx(r.getAttribute("enctype"))||Nv,F=new FormData(r,m),!RC()){let{name:J,type:oe,value:ze}=m;if(oe==="image"){let je=J?`${J}.`:"";F.append(`${je}x`,"0"),F.append(`${je}y`,"0")}else J&&F.append(J,ze)}}else{if(c0(m))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');S=Bv,D=null,O=Nv,X=m}return F&&O==="text/plain"&&(X=F,F=void 0),{action:D,method:S.toLowerCase(),encType:O,formData:F,body:X}}function E1(m,v){if(m===!1||m===null||typeof m>"u")throw new Error(v)}async function LC(m,v){if(m.id in v)return v[m.id];try{let S=await import(m.module);return v[m.id]=S,S}catch(S){return console.error(`Error loading route module \`${m.module}\`, reloading page...`),console.error(S),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function OC(m){return m==null?!1:m.href==null?m.rel==="preload"&&typeof m.imageSrcSet=="string"&&typeof m.imageSizes=="string":typeof m.rel=="string"&&typeof m.href=="string"}async function PC(m,v,S){let D=await Promise.all(m.map(async O=>{let F=v.routes[O.route.id];if(F){let X=await LC(F,S);return X.links?X.links():[]}return[]}));return FC(D.flat(1).filter(OC).filter(O=>O.rel==="stylesheet"||O.rel==="preload").map(O=>O.rel==="stylesheet"?{...O,rel:"prefetch",as:"style"}:{...O,rel:"prefetch"}))}function E2(m,v,S,D,O,F){let X=(re,J)=>S[J]?re.route.id!==S[J].route.id:!0,r=(re,J)=>{var oe;return S[J].pathname!==re.pathname||((oe=S[J].route.path)==null?void 0:oe.endsWith("*"))&&S[J].params["*"]!==re.params["*"]};return F==="assets"?v.filter((re,J)=>X(re,J)||r(re,J)):F==="data"?v.filter((re,J)=>{var ze;let oe=D.routes[re.route.id];if(!oe||!oe.hasLoader)return!1;if(X(re,J)||r(re,J))return!0;if(re.route.shouldRevalidate){let je=re.route.shouldRevalidate({currentUrl:new URL(O.pathname+O.search+O.hash,window.origin),currentParams:((ze=S[0])==null?void 0:ze.params)||{},nextUrl:new URL(m,window.origin),nextParams:re.params,defaultShouldRevalidate:!0});if(typeof je=="boolean")return je}return!0}):[]}function kC(m,v,{includeHydrateFallback:S}={}){return BC(m.map(D=>{let O=v.routes[D.route.id];if(!O)return[];let F=[O.module];return O.clientActionModule&&(F=F.concat(O.clientActionModule)),O.clientLoaderModule&&(F=F.concat(O.clientLoaderModule)),S&&O.hydrateFallbackModule&&(F=F.concat(O.hydrateFallbackModule)),O.imports&&(F=F.concat(O.imports)),F}).flat(1))}function BC(m){return[...new Set(m)]}function NC(m){let v={},S=Object.keys(m).sort();for(let D of S)v[D]=m[D];return v}function FC(m,v){let S=new Set;return new Set(v),m.reduce((D,O)=>{let F=JSON.stringify(NC(O));return S.has(F)||(S.add(F),D.push({key:F,link:O})),D},[])}function VC(m,v){let S=typeof m=="string"?new URL(m,typeof window>"u"?"server://singlefetch/":window.location.origin):m;return S.pathname==="/"?S.pathname="_root.data":v&&wd(S.pathname,v)==="/"?S.pathname=`${v.replace(/\/$/,"")}/_root.data`:S.pathname=`${S.pathname.replace(/\/$/,"")}.data`,S}function CT(){let m=Ie.useContext(L_);return E1(m,"You must render this element inside a <DataRouterContext.Provider> element"),m}function UC(){let m=Ie.useContext(l0);return E1(m,"You must render this element inside a <DataRouterStateContext.Provider> element"),m}var A1=Ie.createContext(void 0);A1.displayName="FrameworkContext";function IT(){let m=Ie.useContext(A1);return E1(m,"You must render this element inside a <HydratedRouter> element"),m}function jC(m,v){let S=Ie.useContext(A1),[D,O]=Ie.useState(!1),[F,X]=Ie.useState(!1),{onFocus:r,onBlur:re,onMouseEnter:J,onMouseLeave:oe,onTouchStart:ze}=v,je=Ie.useRef(null);Ie.useEffect(()=>{if(m==="render"&&X(!0),m==="viewport"){let Fe=He=>{He.forEach(tt=>{X(tt.isIntersecting)})},qe=new IntersectionObserver(Fe,{threshold:.5});return je.current&&qe.observe(je.current),()=>{qe.disconnect()}}},[m]),Ie.useEffect(()=>{if(D){let Fe=setTimeout(()=>{X(!0)},100);return()=>{clearTimeout(Fe)}}},[D]);let ft=()=>{O(!0)},Le=()=>{O(!1),X(!1)};return S?m!=="intent"?[F,je,{}]:[F,je,{onFocus:Vg(r,ft),onBlur:Vg(re,Le),onMouseEnter:Vg(J,ft),onMouseLeave:Vg(oe,Le),onTouchStart:Vg(ze,ft)}]:[!1,je,{}]}function Vg(m,v){return S=>{m&&m(S),S.defaultPrevented||v(S)}}function qC({page:m,...v}){let{router:S}=CT(),D=Ie.useMemo(()=>yT(S.routes,m,S.basename),[S.routes,m,S.basename]);return D?Ie.createElement(HC,{page:m,matches:D,...v}):null}function GC(m){let{manifest:v,routeModules:S}=IT(),[D,O]=Ie.useState([]);return Ie.useEffect(()=>{let F=!1;return PC(m,v,S).then(X=>{F||O(X)}),()=>{F=!0}},[m,v,S]),D}function HC({page:m,matches:v,...S}){let D=dh(),{manifest:O,routeModules:F}=IT(),{basename:X}=CT(),{loaderData:r,matches:re}=UC(),J=Ie.useMemo(()=>E2(m,v,re,O,D,"data"),[m,v,re,O,D]),oe=Ie.useMemo(()=>E2(m,v,re,O,D,"assets"),[m,v,re,O,D]),ze=Ie.useMemo(()=>{if(m===D.pathname+D.search+D.hash)return[];let Le=new Set,Fe=!1;if(v.forEach(He=>{var mt;let tt=O.routes[He.route.id];!tt||!tt.hasLoader||(!J.some(Tt=>Tt.route.id===He.route.id)&&He.route.id in r&&((mt=F[He.route.id])!=null&&mt.shouldRevalidate)||tt.hasClientLoader?Fe=!0:Le.add(He.route.id))}),Le.size===0)return[];let qe=VC(m,X);return Fe&&Le.size>0&&qe.searchParams.set("_routes",v.filter(He=>Le.has(He.route.id)).map(He=>He.route.id).join(",")),[qe.pathname+qe.search]},[X,r,D,O,J,v,m,F]),je=Ie.useMemo(()=>kC(oe,O),[oe,O]),ft=GC(oe);return Ie.createElement(Ie.Fragment,null,ze.map(Le=>Ie.createElement("link",{key:Le,rel:"prefetch",as:"fetch",href:Le,...S})),je.map(Le=>Ie.createElement("link",{key:Le,rel:"modulepreload",href:Le,...S})),ft.map(({key:Le,link:Fe})=>Ie.createElement("link",{key:Le,...Fe})))}function ZC(...m){return v=>{m.forEach(S=>{typeof S=="function"?S(v):S!=null&&(S.current=v)})}}var RT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{RT&&(window.__reactRouterVersion="7.4.1")}catch{}function $C({basename:m,children:v,window:S}){let D=Ie.useRef();D.current==null&&(D.current=zM({window:S,v5Compat:!0}));let O=D.current,[F,X]=Ie.useState({action:O.action,location:O.location}),r=Ie.useCallback(re=>{Ie.startTransition(()=>X(re))},[X]);return Ie.useLayoutEffect(()=>O.listen(r),[O,r]),Ie.createElement(TC,{basename:m,children:v,location:F.location,navigationType:F.action,navigator:O})}var DT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$v=Ie.forwardRef(function({onClick:v,discover:S="render",prefetch:D="none",relative:O,reloadDocument:F,replace:X,state:r,target:re,to:J,preventScrollReset:oe,viewTransition:ze,...je},ft){let{basename:Le}=Ie.useContext(gu),Fe=typeof J=="string"&&DT.test(J),qe,He=!1;if(typeof J=="string"&&Fe&&(qe=J,RT))try{let Mi=new URL(window.location.href),ti=J.startsWith("//")?new URL(Mi.protocol+J):new URL(J),Rt=wd(ti.pathname,Le);ti.origin===Mi.origin&&Rt!=null?J=Rt+ti.search+ti.hash:He=!0}catch{mu(!1,`<Link to="${J}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let tt=rC(J,{relative:O}),[mt,Tt,kt]=jC(D,je),At=KC(J,{replace:X,state:r,target:re,preventScrollReset:oe,relative:O,viewTransition:ze});function ot(Mi){v&&v(Mi),Mi.defaultPrevented||At(Mi)}let hi=Ie.createElement("a",{...je,...kt,href:qe||tt,onClick:He||F?v:ot,ref:ZC(ft,Tt),target:re,"data-discover":!Fe&&S==="render"?"true":void 0});return mt&&!Fe?Ie.createElement(Ie.Fragment,null,hi,Ie.createElement(qC,{page:tt})):hi});$v.displayName="Link";var XC=Ie.forwardRef(function({"aria-current":v="page",caseSensitive:S=!1,className:D="",end:O=!1,style:F,to:X,viewTransition:r,children:re,...J},oe){let ze=py(X,{relative:J.relative}),je=dh(),ft=Ie.useContext(l0),{navigator:Le,basename:Fe}=Ie.useContext(gu),qe=ft!=null&&i3(ze)&&r===!0,He=Le.encodeLocation?Le.encodeLocation(ze).pathname:ze.pathname,tt=je.pathname,mt=ft&&ft.navigation&&ft.navigation.location?ft.navigation.location.pathname:null;S||(tt=tt.toLowerCase(),mt=mt?mt.toLowerCase():null,He=He.toLowerCase()),mt&&Fe&&(mt=wd(mt,Fe)||mt);const Tt=He!=="/"&&He.endsWith("/")?He.length-1:He.length;let kt=tt===He||!O&&tt.startsWith(He)&&tt.charAt(Tt)==="/",At=mt!=null&&(mt===He||!O&&mt.startsWith(He)&&mt.charAt(He.length)==="/"),ot={isActive:kt,isPending:At,isTransitioning:qe},hi=kt?v:void 0,Mi;typeof D=="function"?Mi=D(ot):Mi=[D,kt?"active":null,At?"pending":null,qe?"transitioning":null].filter(Boolean).join(" ");let ti=typeof F=="function"?F(ot):F;return Ie.createElement($v,{...J,"aria-current":hi,className:Mi,ref:oe,style:ti,to:X,viewTransition:r},typeof re=="function"?re(ot):re)});XC.displayName="NavLink";var YC=Ie.forwardRef(({discover:m="render",fetcherKey:v,navigate:S,reloadDocument:D,replace:O,state:F,method:X=Bv,action:r,onSubmit:re,relative:J,preventScrollReset:oe,viewTransition:ze,...je},ft)=>{let Le=e3(),Fe=t3(r,{relative:J}),qe=X.toLowerCase()==="get"?"get":"post",He=typeof r=="string"&&DT.test(r),tt=mt=>{if(re&&re(mt),mt.defaultPrevented)return;mt.preventDefault();let Tt=mt.nativeEvent.submitter,kt=(Tt==null?void 0:Tt.getAttribute("formmethod"))||X;Le(Tt||mt.currentTarget,{fetcherKey:v,method:kt,navigate:S,replace:O,state:F,relative:J,preventScrollReset:oe,viewTransition:ze})};return Ie.createElement("form",{ref:ft,method:qe,action:Fe,onSubmit:D?re:tt,...je,"data-discover":!He&&m==="render"?"true":void 0})});YC.displayName="Form";function WC(m){return`${m} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function zT(m){let v=Ie.useContext(L_);return ha(v,WC(m)),v}function KC(m,{target:v,replace:S,state:D,preventScrollReset:O,relative:F,viewTransition:X}={}){let r=Wf(),re=dh(),J=py(m,{relative:F});return Ie.useCallback(oe=>{if(IC(oe,v)){oe.preventDefault();let ze=S!==void 0?S:Kg(re)===Kg(J);r(m,{replace:ze,state:D,preventScrollReset:O,relative:F,viewTransition:X})}},[re,r,J,S,D,v,m,O,F,X])}var JC=0,QC=()=>`__${String(++JC)}__`;function e3(){let{router:m}=zT("useSubmit"),{basename:v}=Ie.useContext(gu),S=gC();return Ie.useCallback(async(D,O={})=>{let{action:F,method:X,encType:r,formData:re,body:J}=zC(D,v);if(O.navigate===!1){let oe=O.fetcherKey||QC();await m.fetch(oe,S,O.action||F,{preventScrollReset:O.preventScrollReset,formData:re,body:J,formMethod:O.method||X,formEncType:O.encType||r,flushSync:O.flushSync})}else await m.navigate(O.action||F,{preventScrollReset:O.preventScrollReset,formData:re,body:J,formMethod:O.method||X,formEncType:O.encType||r,replace:O.replace,state:O.state,fromRouteId:S,flushSync:O.flushSync,viewTransition:O.viewTransition})},[m,v,S])}function t3(m,{relative:v}={}){let{basename:S}=Ie.useContext(gu),D=Ie.useContext(uc);ha(D,"useFormAction must be used inside a RouteContext");let[O]=D.matches.slice(-1),F={...py(m||".",{relative:v})},X=dh();if(m==null){F.search=X.search;let r=new URLSearchParams(F.search),re=r.getAll("index");if(re.some(oe=>oe==="")){r.delete("index"),re.filter(ze=>ze).forEach(ze=>r.append("index",ze));let oe=r.toString();F.search=oe?`?${oe}`:""}}return(!m||m===".")&&O.route.index&&(F.search=F.search?F.search.replace(/^\?/,"?index&"):"?index"),S!=="/"&&(F.pathname=F.pathname==="/"?S:xd([S,F.pathname])),Kg(F)}function i3(m,v={}){let S=Ie.useContext(wT);ha(S!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:D}=zT("useViewTransitionState"),O=py(m,{relative:v.relative});if(!S.isTransitioning)return!1;let F=wd(S.currentLocation.pathname,D)||S.currentLocation.pathname,X=wd(S.nextLocation.pathname,D)||S.nextLocation.pathname;return Zv(O.pathname,X)!=null||Zv(O.pathname,F)!=null}new TextEncoder;var M1=gT();const n3=y1(M1),r3=()=>{const[m,v]=Ie.useState(!1),[S,D]=Ie.useState(!1),[O,F]=Ie.useState(!1),X=dh(),r=Wf();Ie.useEffect(()=>{const J=localStorage.getItem("isAuthenticated"),oe=localStorage.getItem("isAdmin");D(J==="true"),F(oe==="true")},[X]);const re=()=>v(!m);return _e.jsx("nav",{className:"bg-gray-700 shadow-lg fixed w-full z-50",children:_e.jsxs("div",{className:"container mx-auto flex justify-between items-center px-4 py-3",children:[_e.jsx("a",{className:"text-2xl font-semibold tracking-wide text-white",href:"/",children:"CampQuest"}),_e.jsxs("button",{className:"lg:hidden p-2 border-2 rounded-md text-white",onClick:re,"aria-label":"Toggle navigation",children:[_e.jsx("span",{className:"block w-6 h-0.5 bg-white mb-2"}),_e.jsx("span",{className:"block w-6 h-0.5 bg-white mb-2"}),_e.jsx("span",{className:"block w-6 h-0.5 bg-white"})]}),_e.jsx("div",{className:`lg:flex flex-col lg:flex-row lg:space-x-6 mt-4 lg:mt-0 ${m?"block":"hidden"}`,children:_e.jsx("ul",{className:"navbar-nav flex flex-col lg:flex-row gap-6 relative",children:[{name:"Home",path:"/"},{name:"Campgrounds",path:"/campgrounds"},...S?[{name:"New Campground",path:"/new",show:X.pathname!=="/"},{name:"Logout",path:"#",onClick:()=>{localStorage.clear(),D(!1),F(!1),r("/")}}]:[{name:"Register",path:"/register"},{name:"Login",path:"/login"}]].flat().map(J=>(J.show===void 0||J.show)&&_e.jsx("li",{className:"nav-item relative",children:_e.jsxs("a",{className:"nav-link text-white hover:text-gray-300 transition-all duration-300 cursor-pointer px-3 py-2 relative",href:J.path,onClick:J.onClick,children:[J.name,X.pathname===J.path&&_e.jsx("div",{className:"absolute left-0 bottom-0 w-full h-1 bg-white rounded-lg transition-all duration-300"})]})},J.path))})})]})})},a3=()=>_e.jsx("footer",{className:"bg-light text-center text-lg-start mt-auto",children:_e.jsx("div",{className:"text-center p-3 text-gray-400 text-md",style:{backgroundColor:"rgba(0, 0, 0, 0.2)"},children:"© 2025 CampQuest. All rights reserved."})}),s3=()=>_e.jsxs("div",{className:"d-flex flex-column min-vh-100",children:[_e.jsx(r3,{}),_e.jsx("main",{className:"flex-grow-1 pt-[-20px] d-flex justify-content-center align-items-center",children:_e.jsx(wC,{})}),_e.jsx(a3,{})]});function LT(m,v){return function(){return m.apply(v,arguments)}}const{toString:o3}=Object.prototype,{getPrototypeOf:C1}=Object,u0=(m=>v=>{const S=o3.call(v);return m[S]||(m[S]=S.slice(8,-1).toLowerCase())})(Object.create(null)),yu=m=>(m=m.toLowerCase(),v=>u0(v)===m),h0=m=>v=>typeof v===m,{isArray:P_}=Array,Jg=h0("undefined");function l3(m){return m!==null&&!Jg(m)&&m.constructor!==null&&!Jg(m.constructor)&&gl(m.constructor.isBuffer)&&m.constructor.isBuffer(m)}const OT=yu("ArrayBuffer");function c3(m){let v;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?v=ArrayBuffer.isView(m):v=m&&m.buffer&&OT(m.buffer),v}const u3=h0("string"),gl=h0("function"),PT=h0("number"),d0=m=>m!==null&&typeof m=="object",h3=m=>m===!0||m===!1,Fv=m=>{if(u0(m)!=="object")return!1;const v=C1(m);return(v===null||v===Object.prototype||Object.getPrototypeOf(v)===null)&&!(Symbol.toStringTag in m)&&!(Symbol.iterator in m)},d3=yu("Date"),f3=yu("File"),p3=yu("Blob"),m3=yu("FileList"),_3=m=>d0(m)&&gl(m.pipe),g3=m=>{let v;return m&&(typeof FormData=="function"&&m instanceof FormData||gl(m.append)&&((v=u0(m))==="formdata"||v==="object"&&gl(m.toString)&&m.toString()==="[object FormData]"))},y3=yu("URLSearchParams"),[v3,x3,b3,w3]=["ReadableStream","Request","Response","Headers"].map(yu),T3=m=>m.trim?m.trim():m.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function my(m,v,{allOwnKeys:S=!1}={}){if(m===null||typeof m>"u")return;let D,O;if(typeof m!="object"&&(m=[m]),P_(m))for(D=0,O=m.length;D<O;D++)v.call(null,m[D],D,m);else{const F=S?Object.getOwnPropertyNames(m):Object.keys(m),X=F.length;let r;for(D=0;D<X;D++)r=F[D],v.call(null,m[r],r,m)}}function kT(m,v){v=v.toLowerCase();const S=Object.keys(m);let D=S.length,O;for(;D-- >0;)if(O=S[D],v===O.toLowerCase())return O;return null}const Yp=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,BT=m=>!Jg(m)&&m!==Yp;function Xx(){const{caseless:m}=BT(this)&&this||{},v={},S=(D,O)=>{const F=m&&kT(v,O)||O;Fv(v[F])&&Fv(D)?v[F]=Xx(v[F],D):Fv(D)?v[F]=Xx({},D):P_(D)?v[F]=D.slice():v[F]=D};for(let D=0,O=arguments.length;D<O;D++)arguments[D]&&my(arguments[D],S);return v}const S3=(m,v,S,{allOwnKeys:D}={})=>(my(v,(O,F)=>{S&&gl(O)?m[F]=LT(O,S):m[F]=O},{allOwnKeys:D}),m),E3=m=>(m.charCodeAt(0)===65279&&(m=m.slice(1)),m),A3=(m,v,S,D)=>{m.prototype=Object.create(v.prototype,D),m.prototype.constructor=m,Object.defineProperty(m,"super",{value:v.prototype}),S&&Object.assign(m.prototype,S)},M3=(m,v,S,D)=>{let O,F,X;const r={};if(v=v||{},m==null)return v;do{for(O=Object.getOwnPropertyNames(m),F=O.length;F-- >0;)X=O[F],(!D||D(X,m,v))&&!r[X]&&(v[X]=m[X],r[X]=!0);m=S!==!1&&C1(m)}while(m&&(!S||S(m,v))&&m!==Object.prototype);return v},C3=(m,v,S)=>{m=String(m),(S===void 0||S>m.length)&&(S=m.length),S-=v.length;const D=m.indexOf(v,S);return D!==-1&&D===S},I3=m=>{if(!m)return null;if(P_(m))return m;let v=m.length;if(!PT(v))return null;const S=new Array(v);for(;v-- >0;)S[v]=m[v];return S},R3=(m=>v=>m&&v instanceof m)(typeof Uint8Array<"u"&&C1(Uint8Array)),D3=(m,v)=>{const D=(m&&m[Symbol.iterator]).call(m);let O;for(;(O=D.next())&&!O.done;){const F=O.value;v.call(m,F[0],F[1])}},z3=(m,v)=>{let S;const D=[];for(;(S=m.exec(v))!==null;)D.push(S);return D},L3=yu("HTMLFormElement"),O3=m=>m.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(S,D,O){return D.toUpperCase()+O}),A2=(({hasOwnProperty:m})=>(v,S)=>m.call(v,S))(Object.prototype),P3=yu("RegExp"),NT=(m,v)=>{const S=Object.getOwnPropertyDescriptors(m),D={};my(S,(O,F)=>{let X;(X=v(O,F,m))!==!1&&(D[F]=X||O)}),Object.defineProperties(m,D)},k3=m=>{NT(m,(v,S)=>{if(gl(m)&&["arguments","caller","callee"].indexOf(S)!==-1)return!1;const D=m[S];if(gl(D)){if(v.enumerable=!1,"writable"in v){v.writable=!1;return}v.set||(v.set=()=>{throw Error("Can not rewrite read-only method '"+S+"'")})}})},B3=(m,v)=>{const S={},D=O=>{O.forEach(F=>{S[F]=!0})};return P_(m)?D(m):D(String(m).split(v)),S},N3=()=>{},F3=(m,v)=>m!=null&&Number.isFinite(m=+m)?m:v;function V3(m){return!!(m&&gl(m.append)&&m[Symbol.toStringTag]==="FormData"&&m[Symbol.iterator])}const U3=m=>{const v=new Array(10),S=(D,O)=>{if(d0(D)){if(v.indexOf(D)>=0)return;if(!("toJSON"in D)){v[O]=D;const F=P_(D)?[]:{};return my(D,(X,r)=>{const re=S(X,O+1);!Jg(re)&&(F[r]=re)}),v[O]=void 0,F}}return D};return S(m,0)},j3=yu("AsyncFunction"),q3=m=>m&&(d0(m)||gl(m))&&gl(m.then)&&gl(m.catch),FT=((m,v)=>m?setImmediate:v?((S,D)=>(Yp.addEventListener("message",({source:O,data:F})=>{O===Yp&&F===S&&D.length&&D.shift()()},!1),O=>{D.push(O),Yp.postMessage(S,"*")}))(`axios@${Math.random()}`,[]):S=>setTimeout(S))(typeof setImmediate=="function",gl(Yp.postMessage)),G3=typeof queueMicrotask<"u"?queueMicrotask.bind(Yp):typeof process<"u"&&process.nextTick||FT,qt={isArray:P_,isArrayBuffer:OT,isBuffer:l3,isFormData:g3,isArrayBufferView:c3,isString:u3,isNumber:PT,isBoolean:h3,isObject:d0,isPlainObject:Fv,isReadableStream:v3,isRequest:x3,isResponse:b3,isHeaders:w3,isUndefined:Jg,isDate:d3,isFile:f3,isBlob:p3,isRegExp:P3,isFunction:gl,isStream:_3,isURLSearchParams:y3,isTypedArray:R3,isFileList:m3,forEach:my,merge:Xx,extend:S3,trim:T3,stripBOM:E3,inherits:A3,toFlatObject:M3,kindOf:u0,kindOfTest:yu,endsWith:C3,toArray:I3,forEachEntry:D3,matchAll:z3,isHTMLForm:L3,hasOwnProperty:A2,hasOwnProp:A2,reduceDescriptors:NT,freezeMethods:k3,toObjectSet:B3,toCamelCase:O3,noop:N3,toFiniteNumber:F3,findKey:kT,global:Yp,isContextDefined:BT,isSpecCompliantForm:V3,toJSONObject:U3,isAsyncFn:j3,isThenable:q3,setImmediate:FT,asap:G3};function qn(m,v,S,D,O){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=m,this.name="AxiosError",v&&(this.code=v),S&&(this.config=S),D&&(this.request=D),O&&(this.response=O,this.status=O.status?O.status:null)}qt.inherits(qn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:qt.toJSONObject(this.config),code:this.code,status:this.status}}});const VT=qn.prototype,UT={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(m=>{UT[m]={value:m}});Object.defineProperties(qn,UT);Object.defineProperty(VT,"isAxiosError",{value:!0});qn.from=(m,v,S,D,O,F)=>{const X=Object.create(VT);return qt.toFlatObject(m,X,function(re){return re!==Error.prototype},r=>r!=="isAxiosError"),qn.call(X,m.message,v,S,D,O),X.cause=m,X.name=m.name,F&&Object.assign(X,F),X};const H3=null;function Yx(m){return qt.isPlainObject(m)||qt.isArray(m)}function jT(m){return qt.endsWith(m,"[]")?m.slice(0,-2):m}function M2(m,v,S){return m?m.concat(v).map(function(O,F){return O=jT(O),!S&&F?"["+O+"]":O}).join(S?".":""):v}function Z3(m){return qt.isArray(m)&&!m.some(Yx)}const $3=qt.toFlatObject(qt,{},null,function(v){return/^is[A-Z]/.test(v)});function f0(m,v,S){if(!qt.isObject(m))throw new TypeError("target must be an object");v=v||new FormData,S=qt.toFlatObject(S,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Fe,qe){return!qt.isUndefined(qe[Fe])});const D=S.metaTokens,O=S.visitor||oe,F=S.dots,X=S.indexes,re=(S.Blob||typeof Blob<"u"&&Blob)&&qt.isSpecCompliantForm(v);if(!qt.isFunction(O))throw new TypeError("visitor must be a function");function J(Le){if(Le===null)return"";if(qt.isDate(Le))return Le.toISOString();if(!re&&qt.isBlob(Le))throw new qn("Blob is not supported. Use a Buffer instead.");return qt.isArrayBuffer(Le)||qt.isTypedArray(Le)?re&&typeof Blob=="function"?new Blob([Le]):Buffer.from(Le):Le}function oe(Le,Fe,qe){let He=Le;if(Le&&!qe&&typeof Le=="object"){if(qt.endsWith(Fe,"{}"))Fe=D?Fe:Fe.slice(0,-2),Le=JSON.stringify(Le);else if(qt.isArray(Le)&&Z3(Le)||(qt.isFileList(Le)||qt.endsWith(Fe,"[]"))&&(He=qt.toArray(Le)))return Fe=jT(Fe),He.forEach(function(mt,Tt){!(qt.isUndefined(mt)||mt===null)&&v.append(X===!0?M2([Fe],Tt,F):X===null?Fe:Fe+"[]",J(mt))}),!1}return Yx(Le)?!0:(v.append(M2(qe,Fe,F),J(Le)),!1)}const ze=[],je=Object.assign($3,{defaultVisitor:oe,convertValue:J,isVisitable:Yx});function ft(Le,Fe){if(!qt.isUndefined(Le)){if(ze.indexOf(Le)!==-1)throw Error("Circular reference detected in "+Fe.join("."));ze.push(Le),qt.forEach(Le,function(He,tt){(!(qt.isUndefined(He)||He===null)&&O.call(v,He,qt.isString(tt)?tt.trim():tt,Fe,je))===!0&&ft(He,Fe?Fe.concat(tt):[tt])}),ze.pop()}}if(!qt.isObject(m))throw new TypeError("data must be an object");return ft(m),v}function C2(m){const v={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(m).replace(/[!'()~]|%20|%00/g,function(D){return v[D]})}function I1(m,v){this._pairs=[],m&&f0(m,this,v)}const qT=I1.prototype;qT.append=function(v,S){this._pairs.push([v,S])};qT.toString=function(v){const S=v?function(D){return v.call(this,D,C2)}:C2;return this._pairs.map(function(O){return S(O[0])+"="+S(O[1])},"").join("&")};function X3(m){return encodeURIComponent(m).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function GT(m,v,S){if(!v)return m;const D=S&&S.encode||X3;qt.isFunction(S)&&(S={serialize:S});const O=S&&S.serialize;let F;if(O?F=O(v,S):F=qt.isURLSearchParams(v)?v.toString():new I1(v,S).toString(D),F){const X=m.indexOf("#");X!==-1&&(m=m.slice(0,X)),m+=(m.indexOf("?")===-1?"?":"&")+F}return m}class I2{constructor(){this.handlers=[]}use(v,S,D){return this.handlers.push({fulfilled:v,rejected:S,synchronous:D?D.synchronous:!1,runWhen:D?D.runWhen:null}),this.handlers.length-1}eject(v){this.handlers[v]&&(this.handlers[v]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(v){qt.forEach(this.handlers,function(D){D!==null&&v(D)})}}const HT={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Y3=typeof URLSearchParams<"u"?URLSearchParams:I1,W3=typeof FormData<"u"?FormData:null,K3=typeof Blob<"u"?Blob:null,J3={isBrowser:!0,classes:{URLSearchParams:Y3,FormData:W3,Blob:K3},protocols:["http","https","file","blob","url","data"]},R1=typeof window<"u"&&typeof document<"u",Wx=typeof navigator=="object"&&navigator||void 0,Q3=R1&&(!Wx||["ReactNative","NativeScript","NS"].indexOf(Wx.product)<0),eI=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",tI=R1&&window.location.href||"http://localhost",iI=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:R1,hasStandardBrowserEnv:Q3,hasStandardBrowserWebWorkerEnv:eI,navigator:Wx,origin:tI},Symbol.toStringTag,{value:"Module"})),ro={...iI,...J3};function nI(m,v){return f0(m,new ro.classes.URLSearchParams,Object.assign({visitor:function(S,D,O,F){return ro.isNode&&qt.isBuffer(S)?(this.append(D,S.toString("base64")),!1):F.defaultVisitor.apply(this,arguments)}},v))}function rI(m){return qt.matchAll(/\w+|\[(\w*)]/g,m).map(v=>v[0]==="[]"?"":v[1]||v[0])}function aI(m){const v={},S=Object.keys(m);let D;const O=S.length;let F;for(D=0;D<O;D++)F=S[D],v[F]=m[F];return v}function ZT(m){function v(S,D,O,F){let X=S[F++];if(X==="__proto__")return!0;const r=Number.isFinite(+X),re=F>=S.length;return X=!X&&qt.isArray(O)?O.length:X,re?(qt.hasOwnProp(O,X)?O[X]=[O[X],D]:O[X]=D,!r):((!O[X]||!qt.isObject(O[X]))&&(O[X]=[]),v(S,D,O[X],F)&&qt.isArray(O[X])&&(O[X]=aI(O[X])),!r)}if(qt.isFormData(m)&&qt.isFunction(m.entries)){const S={};return qt.forEachEntry(m,(D,O)=>{v(rI(D),O,S,0)}),S}return null}function sI(m,v,S){if(qt.isString(m))try{return(v||JSON.parse)(m),qt.trim(m)}catch(D){if(D.name!=="SyntaxError")throw D}return(S||JSON.stringify)(m)}const _y={transitional:HT,adapter:["xhr","http","fetch"],transformRequest:[function(v,S){const D=S.getContentType()||"",O=D.indexOf("application/json")>-1,F=qt.isObject(v);if(F&&qt.isHTMLForm(v)&&(v=new FormData(v)),qt.isFormData(v))return O?JSON.stringify(ZT(v)):v;if(qt.isArrayBuffer(v)||qt.isBuffer(v)||qt.isStream(v)||qt.isFile(v)||qt.isBlob(v)||qt.isReadableStream(v))return v;if(qt.isArrayBufferView(v))return v.buffer;if(qt.isURLSearchParams(v))return S.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),v.toString();let r;if(F){if(D.indexOf("application/x-www-form-urlencoded")>-1)return nI(v,this.formSerializer).toString();if((r=qt.isFileList(v))||D.indexOf("multipart/form-data")>-1){const re=this.env&&this.env.FormData;return f0(r?{"files[]":v}:v,re&&new re,this.formSerializer)}}return F||O?(S.setContentType("application/json",!1),sI(v)):v}],transformResponse:[function(v){const S=this.transitional||_y.transitional,D=S&&S.forcedJSONParsing,O=this.responseType==="json";if(qt.isResponse(v)||qt.isReadableStream(v))return v;if(v&&qt.isString(v)&&(D&&!this.responseType||O)){const X=!(S&&S.silentJSONParsing)&&O;try{return JSON.parse(v)}catch(r){if(X)throw r.name==="SyntaxError"?qn.from(r,qn.ERR_BAD_RESPONSE,this,null,this.response):r}}return v}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ro.classes.FormData,Blob:ro.classes.Blob},validateStatus:function(v){return v>=200&&v<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};qt.forEach(["delete","get","head","post","put","patch"],m=>{_y.headers[m]={}});const oI=qt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),lI=m=>{const v={};let S,D,O;return m&&m.split(`
`).forEach(function(X){O=X.indexOf(":"),S=X.substring(0,O).trim().toLowerCase(),D=X.substring(O+1).trim(),!(!S||v[S]&&oI[S])&&(S==="set-cookie"?v[S]?v[S].push(D):v[S]=[D]:v[S]=v[S]?v[S]+", "+D:D)}),v},R2=Symbol("internals");function Ug(m){return m&&String(m).trim().toLowerCase()}function Vv(m){return m===!1||m==null?m:qt.isArray(m)?m.map(Vv):String(m)}function cI(m){const v=Object.create(null),S=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let D;for(;D=S.exec(m);)v[D[1]]=D[2];return v}const uI=m=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(m.trim());function Bx(m,v,S,D,O){if(qt.isFunction(D))return D.call(this,v,S);if(O&&(v=S),!!qt.isString(v)){if(qt.isString(D))return v.indexOf(D)!==-1;if(qt.isRegExp(D))return D.test(v)}}function hI(m){return m.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(v,S,D)=>S.toUpperCase()+D)}function dI(m,v){const S=qt.toCamelCase(" "+v);["get","set","has"].forEach(D=>{Object.defineProperty(m,D+S,{value:function(O,F,X){return this[D].call(this,v,O,F,X)},configurable:!0})})}let Ho=class{constructor(v){v&&this.set(v)}set(v,S,D){const O=this;function F(r,re,J){const oe=Ug(re);if(!oe)throw new Error("header name must be a non-empty string");const ze=qt.findKey(O,oe);(!ze||O[ze]===void 0||J===!0||J===void 0&&O[ze]!==!1)&&(O[ze||re]=Vv(r))}const X=(r,re)=>qt.forEach(r,(J,oe)=>F(J,oe,re));if(qt.isPlainObject(v)||v instanceof this.constructor)X(v,S);else if(qt.isString(v)&&(v=v.trim())&&!uI(v))X(lI(v),S);else if(qt.isHeaders(v))for(const[r,re]of v.entries())F(re,r,D);else v!=null&&F(S,v,D);return this}get(v,S){if(v=Ug(v),v){const D=qt.findKey(this,v);if(D){const O=this[D];if(!S)return O;if(S===!0)return cI(O);if(qt.isFunction(S))return S.call(this,O,D);if(qt.isRegExp(S))return S.exec(O);throw new TypeError("parser must be boolean|regexp|function")}}}has(v,S){if(v=Ug(v),v){const D=qt.findKey(this,v);return!!(D&&this[D]!==void 0&&(!S||Bx(this,this[D],D,S)))}return!1}delete(v,S){const D=this;let O=!1;function F(X){if(X=Ug(X),X){const r=qt.findKey(D,X);r&&(!S||Bx(D,D[r],r,S))&&(delete D[r],O=!0)}}return qt.isArray(v)?v.forEach(F):F(v),O}clear(v){const S=Object.keys(this);let D=S.length,O=!1;for(;D--;){const F=S[D];(!v||Bx(this,this[F],F,v,!0))&&(delete this[F],O=!0)}return O}normalize(v){const S=this,D={};return qt.forEach(this,(O,F)=>{const X=qt.findKey(D,F);if(X){S[X]=Vv(O),delete S[F];return}const r=v?hI(F):String(F).trim();r!==F&&delete S[F],S[r]=Vv(O),D[r]=!0}),this}concat(...v){return this.constructor.concat(this,...v)}toJSON(v){const S=Object.create(null);return qt.forEach(this,(D,O)=>{D!=null&&D!==!1&&(S[O]=v&&qt.isArray(D)?D.join(", "):D)}),S}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([v,S])=>v+": "+S).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(v){return v instanceof this?v:new this(v)}static concat(v,...S){const D=new this(v);return S.forEach(O=>D.set(O)),D}static accessor(v){const D=(this[R2]=this[R2]={accessors:{}}).accessors,O=this.prototype;function F(X){const r=Ug(X);D[r]||(dI(O,X),D[r]=!0)}return qt.isArray(v)?v.forEach(F):F(v),this}};Ho.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);qt.reduceDescriptors(Ho.prototype,({value:m},v)=>{let S=v[0].toUpperCase()+v.slice(1);return{get:()=>m,set(D){this[S]=D}}});qt.freezeMethods(Ho);function Nx(m,v){const S=this||_y,D=v||S,O=Ho.from(D.headers);let F=D.data;return qt.forEach(m,function(r){F=r.call(S,F,O.normalize(),v?v.status:void 0)}),O.normalize(),F}function $T(m){return!!(m&&m.__CANCEL__)}function k_(m,v,S){qn.call(this,m??"canceled",qn.ERR_CANCELED,v,S),this.name="CanceledError"}qt.inherits(k_,qn,{__CANCEL__:!0});function XT(m,v,S){const D=S.config.validateStatus;!S.status||!D||D(S.status)?m(S):v(new qn("Request failed with status code "+S.status,[qn.ERR_BAD_REQUEST,qn.ERR_BAD_RESPONSE][Math.floor(S.status/100)-4],S.config,S.request,S))}function fI(m){const v=/^([-+\w]{1,25})(:?\/\/|:)/.exec(m);return v&&v[1]||""}function pI(m,v){m=m||10;const S=new Array(m),D=new Array(m);let O=0,F=0,X;return v=v!==void 0?v:1e3,function(re){const J=Date.now(),oe=D[F];X||(X=J),S[O]=re,D[O]=J;let ze=F,je=0;for(;ze!==O;)je+=S[ze++],ze=ze%m;if(O=(O+1)%m,O===F&&(F=(F+1)%m),J-X<v)return;const ft=oe&&J-oe;return ft?Math.round(je*1e3/ft):void 0}}function mI(m,v){let S=0,D=1e3/v,O,F;const X=(J,oe=Date.now())=>{S=oe,O=null,F&&(clearTimeout(F),F=null),m.apply(null,J)};return[(...J)=>{const oe=Date.now(),ze=oe-S;ze>=D?X(J,oe):(O=J,F||(F=setTimeout(()=>{F=null,X(O)},D-ze)))},()=>O&&X(O)]}const Xv=(m,v,S=3)=>{let D=0;const O=pI(50,250);return mI(F=>{const X=F.loaded,r=F.lengthComputable?F.total:void 0,re=X-D,J=O(re),oe=X<=r;D=X;const ze={loaded:X,total:r,progress:r?X/r:void 0,bytes:re,rate:J||void 0,estimated:J&&r&&oe?(r-X)/J:void 0,event:F,lengthComputable:r!=null,[v?"download":"upload"]:!0};m(ze)},S)},D2=(m,v)=>{const S=m!=null;return[D=>v[0]({lengthComputable:S,total:m,loaded:D}),v[1]]},z2=m=>(...v)=>qt.asap(()=>m(...v)),_I=ro.hasStandardBrowserEnv?((m,v)=>S=>(S=new URL(S,ro.origin),m.protocol===S.protocol&&m.host===S.host&&(v||m.port===S.port)))(new URL(ro.origin),ro.navigator&&/(msie|trident)/i.test(ro.navigator.userAgent)):()=>!0,gI=ro.hasStandardBrowserEnv?{write(m,v,S,D,O,F){const X=[m+"="+encodeURIComponent(v)];qt.isNumber(S)&&X.push("expires="+new Date(S).toGMTString()),qt.isString(D)&&X.push("path="+D),qt.isString(O)&&X.push("domain="+O),F===!0&&X.push("secure"),document.cookie=X.join("; ")},read(m){const v=document.cookie.match(new RegExp("(^|;\\s*)("+m+")=([^;]*)"));return v?decodeURIComponent(v[3]):null},remove(m){this.write(m,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function yI(m){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(m)}function vI(m,v){return v?m.replace(/\/?\/$/,"")+"/"+v.replace(/^\/+/,""):m}function YT(m,v,S){let D=!yI(v);return m&&(D||S==!1)?vI(m,v):v}const L2=m=>m instanceof Ho?{...m}:m;function Qp(m,v){v=v||{};const S={};function D(J,oe,ze,je){return qt.isPlainObject(J)&&qt.isPlainObject(oe)?qt.merge.call({caseless:je},J,oe):qt.isPlainObject(oe)?qt.merge({},oe):qt.isArray(oe)?oe.slice():oe}function O(J,oe,ze,je){if(qt.isUndefined(oe)){if(!qt.isUndefined(J))return D(void 0,J,ze,je)}else return D(J,oe,ze,je)}function F(J,oe){if(!qt.isUndefined(oe))return D(void 0,oe)}function X(J,oe){if(qt.isUndefined(oe)){if(!qt.isUndefined(J))return D(void 0,J)}else return D(void 0,oe)}function r(J,oe,ze){if(ze in v)return D(J,oe);if(ze in m)return D(void 0,J)}const re={url:F,method:F,data:F,baseURL:X,transformRequest:X,transformResponse:X,paramsSerializer:X,timeout:X,timeoutMessage:X,withCredentials:X,withXSRFToken:X,adapter:X,responseType:X,xsrfCookieName:X,xsrfHeaderName:X,onUploadProgress:X,onDownloadProgress:X,decompress:X,maxContentLength:X,maxBodyLength:X,beforeRedirect:X,transport:X,httpAgent:X,httpsAgent:X,cancelToken:X,socketPath:X,responseEncoding:X,validateStatus:r,headers:(J,oe,ze)=>O(L2(J),L2(oe),ze,!0)};return qt.forEach(Object.keys(Object.assign({},m,v)),function(oe){const ze=re[oe]||O,je=ze(m[oe],v[oe],oe);qt.isUndefined(je)&&ze!==r||(S[oe]=je)}),S}const WT=m=>{const v=Qp({},m);let{data:S,withXSRFToken:D,xsrfHeaderName:O,xsrfCookieName:F,headers:X,auth:r}=v;v.headers=X=Ho.from(X),v.url=GT(YT(v.baseURL,v.url,v.allowAbsoluteUrls),m.params,m.paramsSerializer),r&&X.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):"")));let re;if(qt.isFormData(S)){if(ro.hasStandardBrowserEnv||ro.hasStandardBrowserWebWorkerEnv)X.setContentType(void 0);else if((re=X.getContentType())!==!1){const[J,...oe]=re?re.split(";").map(ze=>ze.trim()).filter(Boolean):[];X.setContentType([J||"multipart/form-data",...oe].join("; "))}}if(ro.hasStandardBrowserEnv&&(D&&qt.isFunction(D)&&(D=D(v)),D||D!==!1&&_I(v.url))){const J=O&&F&&gI.read(F);J&&X.set(O,J)}return v},xI=typeof XMLHttpRequest<"u",bI=xI&&function(m){return new Promise(function(S,D){const O=WT(m);let F=O.data;const X=Ho.from(O.headers).normalize();let{responseType:r,onUploadProgress:re,onDownloadProgress:J}=O,oe,ze,je,ft,Le;function Fe(){ft&&ft(),Le&&Le(),O.cancelToken&&O.cancelToken.unsubscribe(oe),O.signal&&O.signal.removeEventListener("abort",oe)}let qe=new XMLHttpRequest;qe.open(O.method.toUpperCase(),O.url,!0),qe.timeout=O.timeout;function He(){if(!qe)return;const mt=Ho.from("getAllResponseHeaders"in qe&&qe.getAllResponseHeaders()),kt={data:!r||r==="text"||r==="json"?qe.responseText:qe.response,status:qe.status,statusText:qe.statusText,headers:mt,config:m,request:qe};XT(function(ot){S(ot),Fe()},function(ot){D(ot),Fe()},kt),qe=null}"onloadend"in qe?qe.onloadend=He:qe.onreadystatechange=function(){!qe||qe.readyState!==4||qe.status===0&&!(qe.responseURL&&qe.responseURL.indexOf("file:")===0)||setTimeout(He)},qe.onabort=function(){qe&&(D(new qn("Request aborted",qn.ECONNABORTED,m,qe)),qe=null)},qe.onerror=function(){D(new qn("Network Error",qn.ERR_NETWORK,m,qe)),qe=null},qe.ontimeout=function(){let Tt=O.timeout?"timeout of "+O.timeout+"ms exceeded":"timeout exceeded";const kt=O.transitional||HT;O.timeoutErrorMessage&&(Tt=O.timeoutErrorMessage),D(new qn(Tt,kt.clarifyTimeoutError?qn.ETIMEDOUT:qn.ECONNABORTED,m,qe)),qe=null},F===void 0&&X.setContentType(null),"setRequestHeader"in qe&&qt.forEach(X.toJSON(),function(Tt,kt){qe.setRequestHeader(kt,Tt)}),qt.isUndefined(O.withCredentials)||(qe.withCredentials=!!O.withCredentials),r&&r!=="json"&&(qe.responseType=O.responseType),J&&([je,Le]=Xv(J,!0),qe.addEventListener("progress",je)),re&&qe.upload&&([ze,ft]=Xv(re),qe.upload.addEventListener("progress",ze),qe.upload.addEventListener("loadend",ft)),(O.cancelToken||O.signal)&&(oe=mt=>{qe&&(D(!mt||mt.type?new k_(null,m,qe):mt),qe.abort(),qe=null)},O.cancelToken&&O.cancelToken.subscribe(oe),O.signal&&(O.signal.aborted?oe():O.signal.addEventListener("abort",oe)));const tt=fI(O.url);if(tt&&ro.protocols.indexOf(tt)===-1){D(new qn("Unsupported protocol "+tt+":",qn.ERR_BAD_REQUEST,m));return}qe.send(F||null)})},wI=(m,v)=>{const{length:S}=m=m?m.filter(Boolean):[];if(v||S){let D=new AbortController,O;const F=function(J){if(!O){O=!0,r();const oe=J instanceof Error?J:this.reason;D.abort(oe instanceof qn?oe:new k_(oe instanceof Error?oe.message:oe))}};let X=v&&setTimeout(()=>{X=null,F(new qn(`timeout ${v} of ms exceeded`,qn.ETIMEDOUT))},v);const r=()=>{m&&(X&&clearTimeout(X),X=null,m.forEach(J=>{J.unsubscribe?J.unsubscribe(F):J.removeEventListener("abort",F)}),m=null)};m.forEach(J=>J.addEventListener("abort",F));const{signal:re}=D;return re.unsubscribe=()=>qt.asap(r),re}},TI=function*(m,v){let S=m.byteLength;if(S<v){yield m;return}let D=0,O;for(;D<S;)O=D+v,yield m.slice(D,O),D=O},SI=async function*(m,v){for await(const S of EI(m))yield*TI(S,v)},EI=async function*(m){if(m[Symbol.asyncIterator]){yield*m;return}const v=m.getReader();try{for(;;){const{done:S,value:D}=await v.read();if(S)break;yield D}}finally{await v.cancel()}},O2=(m,v,S,D)=>{const O=SI(m,v);let F=0,X,r=re=>{X||(X=!0,D&&D(re))};return new ReadableStream({async pull(re){try{const{done:J,value:oe}=await O.next();if(J){r(),re.close();return}let ze=oe.byteLength;if(S){let je=F+=ze;S(je)}re.enqueue(new Uint8Array(oe))}catch(J){throw r(J),J}},cancel(re){return r(re),O.return()}},{highWaterMark:2})},p0=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",KT=p0&&typeof ReadableStream=="function",AI=p0&&(typeof TextEncoder=="function"?(m=>v=>m.encode(v))(new TextEncoder):async m=>new Uint8Array(await new Response(m).arrayBuffer())),JT=(m,...v)=>{try{return!!m(...v)}catch{return!1}},MI=KT&&JT(()=>{let m=!1;const v=new Request(ro.origin,{body:new ReadableStream,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!v}),P2=64*1024,Kx=KT&&JT(()=>qt.isReadableStream(new Response("").body)),Yv={stream:Kx&&(m=>m.body)};p0&&(m=>{["text","arrayBuffer","blob","formData","stream"].forEach(v=>{!Yv[v]&&(Yv[v]=qt.isFunction(m[v])?S=>S[v]():(S,D)=>{throw new qn(`Response type '${v}' is not supported`,qn.ERR_NOT_SUPPORT,D)})})})(new Response);const CI=async m=>{if(m==null)return 0;if(qt.isBlob(m))return m.size;if(qt.isSpecCompliantForm(m))return(await new Request(ro.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(qt.isArrayBufferView(m)||qt.isArrayBuffer(m))return m.byteLength;if(qt.isURLSearchParams(m)&&(m=m+""),qt.isString(m))return(await AI(m)).byteLength},II=async(m,v)=>{const S=qt.toFiniteNumber(m.getContentLength());return S??CI(v)},RI=p0&&(async m=>{let{url:v,method:S,data:D,signal:O,cancelToken:F,timeout:X,onDownloadProgress:r,onUploadProgress:re,responseType:J,headers:oe,withCredentials:ze="same-origin",fetchOptions:je}=WT(m);J=J?(J+"").toLowerCase():"text";let ft=wI([O,F&&F.toAbortSignal()],X),Le;const Fe=ft&&ft.unsubscribe&&(()=>{ft.unsubscribe()});let qe;try{if(re&&MI&&S!=="get"&&S!=="head"&&(qe=await II(oe,D))!==0){let kt=new Request(v,{method:"POST",body:D,duplex:"half"}),At;if(qt.isFormData(D)&&(At=kt.headers.get("content-type"))&&oe.setContentType(At),kt.body){const[ot,hi]=D2(qe,Xv(z2(re)));D=O2(kt.body,P2,ot,hi)}}qt.isString(ze)||(ze=ze?"include":"omit");const He="credentials"in Request.prototype;Le=new Request(v,{...je,signal:ft,method:S.toUpperCase(),headers:oe.normalize().toJSON(),body:D,duplex:"half",credentials:He?ze:void 0});let tt=await fetch(Le);const mt=Kx&&(J==="stream"||J==="response");if(Kx&&(r||mt&&Fe)){const kt={};["status","statusText","headers"].forEach(Mi=>{kt[Mi]=tt[Mi]});const At=qt.toFiniteNumber(tt.headers.get("content-length")),[ot,hi]=r&&D2(At,Xv(z2(r),!0))||[];tt=new Response(O2(tt.body,P2,ot,()=>{hi&&hi(),Fe&&Fe()}),kt)}J=J||"text";let Tt=await Yv[qt.findKey(Yv,J)||"text"](tt,m);return!mt&&Fe&&Fe(),await new Promise((kt,At)=>{XT(kt,At,{data:Tt,headers:Ho.from(tt.headers),status:tt.status,statusText:tt.statusText,config:m,request:Le})})}catch(He){throw Fe&&Fe(),He&&He.name==="TypeError"&&/fetch/i.test(He.message)?Object.assign(new qn("Network Error",qn.ERR_NETWORK,m,Le),{cause:He.cause||He}):qn.from(He,He&&He.code,m,Le)}}),Jx={http:H3,xhr:bI,fetch:RI};qt.forEach(Jx,(m,v)=>{if(m){try{Object.defineProperty(m,"name",{value:v})}catch{}Object.defineProperty(m,"adapterName",{value:v})}});const k2=m=>`- ${m}`,DI=m=>qt.isFunction(m)||m===null||m===!1,QT={getAdapter:m=>{m=qt.isArray(m)?m:[m];const{length:v}=m;let S,D;const O={};for(let F=0;F<v;F++){S=m[F];let X;if(D=S,!DI(S)&&(D=Jx[(X=String(S)).toLowerCase()],D===void 0))throw new qn(`Unknown adapter '${X}'`);if(D)break;O[X||"#"+F]=D}if(!D){const F=Object.entries(O).map(([r,re])=>`adapter ${r} `+(re===!1?"is not supported by the environment":"is not available in the build"));let X=v?F.length>1?`since :
`+F.map(k2).join(`
`):" "+k2(F[0]):"as no adapter specified";throw new qn("There is no suitable adapter to dispatch the request "+X,"ERR_NOT_SUPPORT")}return D},adapters:Jx};function Fx(m){if(m.cancelToken&&m.cancelToken.throwIfRequested(),m.signal&&m.signal.aborted)throw new k_(null,m)}function B2(m){return Fx(m),m.headers=Ho.from(m.headers),m.data=Nx.call(m,m.transformRequest),["post","put","patch"].indexOf(m.method)!==-1&&m.headers.setContentType("application/x-www-form-urlencoded",!1),QT.getAdapter(m.adapter||_y.adapter)(m).then(function(D){return Fx(m),D.data=Nx.call(m,m.transformResponse,D),D.headers=Ho.from(D.headers),D},function(D){return $T(D)||(Fx(m),D&&D.response&&(D.response.data=Nx.call(m,m.transformResponse,D.response),D.response.headers=Ho.from(D.response.headers))),Promise.reject(D)})}const eS="1.8.4",m0={};["object","boolean","number","function","string","symbol"].forEach((m,v)=>{m0[m]=function(D){return typeof D===m||"a"+(v<1?"n ":" ")+m}});const N2={};m0.transitional=function(v,S,D){function O(F,X){return"[Axios v"+eS+"] Transitional option '"+F+"'"+X+(D?". "+D:"")}return(F,X,r)=>{if(v===!1)throw new qn(O(X," has been removed"+(S?" in "+S:"")),qn.ERR_DEPRECATED);return S&&!N2[X]&&(N2[X]=!0,console.warn(O(X," has been deprecated since v"+S+" and will be removed in the near future"))),v?v(F,X,r):!0}};m0.spelling=function(v){return(S,D)=>(console.warn(`${D} is likely a misspelling of ${v}`),!0)};function zI(m,v,S){if(typeof m!="object")throw new qn("options must be an object",qn.ERR_BAD_OPTION_VALUE);const D=Object.keys(m);let O=D.length;for(;O-- >0;){const F=D[O],X=v[F];if(X){const r=m[F],re=r===void 0||X(r,F,m);if(re!==!0)throw new qn("option "+F+" must be "+re,qn.ERR_BAD_OPTION_VALUE);continue}if(S!==!0)throw new qn("Unknown option "+F,qn.ERR_BAD_OPTION)}}const Uv={assertOptions:zI,validators:m0},ah=Uv.validators;let Kp=class{constructor(v){this.defaults=v,this.interceptors={request:new I2,response:new I2}}async request(v,S){try{return await this._request(v,S)}catch(D){if(D instanceof Error){let O={};Error.captureStackTrace?Error.captureStackTrace(O):O=new Error;const F=O.stack?O.stack.replace(/^.+\n/,""):"";try{D.stack?F&&!String(D.stack).endsWith(F.replace(/^.+\n.+\n/,""))&&(D.stack+=`
`+F):D.stack=F}catch{}}throw D}}_request(v,S){typeof v=="string"?(S=S||{},S.url=v):S=v||{},S=Qp(this.defaults,S);const{transitional:D,paramsSerializer:O,headers:F}=S;D!==void 0&&Uv.assertOptions(D,{silentJSONParsing:ah.transitional(ah.boolean),forcedJSONParsing:ah.transitional(ah.boolean),clarifyTimeoutError:ah.transitional(ah.boolean)},!1),O!=null&&(qt.isFunction(O)?S.paramsSerializer={serialize:O}:Uv.assertOptions(O,{encode:ah.function,serialize:ah.function},!0)),S.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?S.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:S.allowAbsoluteUrls=!0),Uv.assertOptions(S,{baseUrl:ah.spelling("baseURL"),withXsrfToken:ah.spelling("withXSRFToken")},!0),S.method=(S.method||this.defaults.method||"get").toLowerCase();let X=F&&qt.merge(F.common,F[S.method]);F&&qt.forEach(["delete","get","head","post","put","patch","common"],Le=>{delete F[Le]}),S.headers=Ho.concat(X,F);const r=[];let re=!0;this.interceptors.request.forEach(function(Fe){typeof Fe.runWhen=="function"&&Fe.runWhen(S)===!1||(re=re&&Fe.synchronous,r.unshift(Fe.fulfilled,Fe.rejected))});const J=[];this.interceptors.response.forEach(function(Fe){J.push(Fe.fulfilled,Fe.rejected)});let oe,ze=0,je;if(!re){const Le=[B2.bind(this),void 0];for(Le.unshift.apply(Le,r),Le.push.apply(Le,J),je=Le.length,oe=Promise.resolve(S);ze<je;)oe=oe.then(Le[ze++],Le[ze++]);return oe}je=r.length;let ft=S;for(ze=0;ze<je;){const Le=r[ze++],Fe=r[ze++];try{ft=Le(ft)}catch(qe){Fe.call(this,qe);break}}try{oe=B2.call(this,ft)}catch(Le){return Promise.reject(Le)}for(ze=0,je=J.length;ze<je;)oe=oe.then(J[ze++],J[ze++]);return oe}getUri(v){v=Qp(this.defaults,v);const S=YT(v.baseURL,v.url,v.allowAbsoluteUrls);return GT(S,v.params,v.paramsSerializer)}};qt.forEach(["delete","get","head","options"],function(v){Kp.prototype[v]=function(S,D){return this.request(Qp(D||{},{method:v,url:S,data:(D||{}).data}))}});qt.forEach(["post","put","patch"],function(v){function S(D){return function(F,X,r){return this.request(Qp(r||{},{method:v,headers:D?{"Content-Type":"multipart/form-data"}:{},url:F,data:X}))}}Kp.prototype[v]=S(),Kp.prototype[v+"Form"]=S(!0)});let LI=class tS{constructor(v){if(typeof v!="function")throw new TypeError("executor must be a function.");let S;this.promise=new Promise(function(F){S=F});const D=this;this.promise.then(O=>{if(!D._listeners)return;let F=D._listeners.length;for(;F-- >0;)D._listeners[F](O);D._listeners=null}),this.promise.then=O=>{let F;const X=new Promise(r=>{D.subscribe(r),F=r}).then(O);return X.cancel=function(){D.unsubscribe(F)},X},v(function(F,X,r){D.reason||(D.reason=new k_(F,X,r),S(D.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(v){if(this.reason){v(this.reason);return}this._listeners?this._listeners.push(v):this._listeners=[v]}unsubscribe(v){if(!this._listeners)return;const S=this._listeners.indexOf(v);S!==-1&&this._listeners.splice(S,1)}toAbortSignal(){const v=new AbortController,S=D=>{v.abort(D)};return this.subscribe(S),v.signal.unsubscribe=()=>this.unsubscribe(S),v.signal}static source(){let v;return{token:new tS(function(O){v=O}),cancel:v}}};function OI(m){return function(S){return m.apply(null,S)}}function PI(m){return qt.isObject(m)&&m.isAxiosError===!0}const Qx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Qx).forEach(([m,v])=>{Qx[v]=m});function iS(m){const v=new Kp(m),S=LT(Kp.prototype.request,v);return qt.extend(S,Kp.prototype,v,{allOwnKeys:!0}),qt.extend(S,v,null,{allOwnKeys:!0}),S.create=function(O){return iS(Qp(m,O))},S}const Na=iS(_y);Na.Axios=Kp;Na.CanceledError=k_;Na.CancelToken=LI;Na.isCancel=$T;Na.VERSION=eS;Na.toFormData=f0;Na.AxiosError=qn;Na.Cancel=Na.CanceledError;Na.all=function(v){return Promise.all(v)};Na.spread=OI;Na.isAxiosError=PI;Na.mergeConfig=Qp;Na.AxiosHeaders=Ho;Na.formToJSON=m=>ZT(qt.isHTMLForm(m)?new FormData(m):m);Na.getAdapter=QT.getAdapter;Na.HttpStatusCode=Qx;Na.default=Na;const{Axios:SO,AxiosError:EO,CanceledError:AO,isCancel:MO,CancelToken:CO,VERSION:IO,all:RO,Cancel:DO,isAxiosError:zO,spread:LO,toFormData:OO,AxiosHeaders:PO,HttpStatusCode:kO,formToJSON:BO,getAdapter:NO,mergeConfig:FO}=Na,So=Na.create({baseURL:"http://localhost:3000",withCredentials:!0});So.interceptors.request.use(m=>{const v=localStorage.getItem("token");return v&&(m.headers.Authorization=`Bearer ${v}`),m},m=>Promise.reject(m));/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kI=m=>m.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),BI=m=>m.replace(/^([A-Z])|[\s-_]+(\w)/g,(v,S,D)=>D?D.toUpperCase():S.toLowerCase()),F2=m=>{const v=BI(m);return v.charAt(0).toUpperCase()+v.slice(1)},nS=(...m)=>m.filter((v,S,D)=>!!v&&v.trim()!==""&&D.indexOf(v)===S).join(" ").trim();/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var NI={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FI=Ie.forwardRef(({color:m="currentColor",size:v=24,strokeWidth:S=2,absoluteStrokeWidth:D,className:O="",children:F,iconNode:X,...r},re)=>Ie.createElement("svg",{ref:re,...NI,width:v,height:v,stroke:m,strokeWidth:D?Number(S)*24/Number(v):S,className:nS("lucide",O),...r},[...X.map(([J,oe])=>Ie.createElement(J,oe)),...Array.isArray(F)?F:[F]]));/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vu=(m,v)=>{const S=Ie.forwardRef(({className:D,...O},F)=>Ie.createElement(FI,{ref:F,iconNode:v,className:nS(`lucide-${kI(F2(m))}`,`lucide-${m}`,D),...O}));return S.displayName=F2(m),S};/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VI=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],e1=vu("chevron-left",VI);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UI=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],jI=vu("chevron-right",UI);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],GI=vu("circle-plus",qI);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HI=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ZI=vu("eye",HI);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $I=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],D1=vu("loader-circle",$I);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XI=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],rS=vu("map-pin",XI);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YI=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],WI=vu("square-pen",YI);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KI=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],V2=vu("star",KI);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JI=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],QI=vu("trash-2",JI);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eR=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],aS=vu("upload",eR);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tR=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],z1=vu("x",tR),iR=()=>{const[m,v]=Ie.useState([]),[S,D]=Ie.useState(!1);return Ie.useEffect(()=>{(async()=>{D(!0);try{const F=await So.get("/campgrounds");v(F.data)}catch(F){console.error("Error fetching campgrounds:",F)}finally{D(!1)}})()},[]),_e.jsxs("div",{className:"container mx-auto p-6 pt-20",children:[_e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-10",children:[_e.jsx("h1",{className:"text-4xl font-extrabold text-gray-900",children:"Discover Campgrounds"}),_e.jsxs($v,{to:"/campgrounds/new",className:"mt-4 md:mt-0 flex items-center bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-lg shadow-md transition-all",children:[_e.jsx(GI,{className:"w-6 h-6 mr-2"}),"Add Campground"]})]}),_e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:m.filter(O=>O.approved).map(O=>_e.jsxs("div",{className:"bg-white shadow-lg rounded-xl overflow-hidden hover:shadow-xl transition-shadow duration-300 flex flex-col",children:[_e.jsx("div",{className:"relative h-56 overflow-hidden",children:_e.jsx("img",{crossOrigin:"anonymous",className:"w-full h-full object-cover transition-transform duration-300 hover:scale-110",alt:O.title,src:O.images.length?O.images[0].url:"https://res.cloudinary.com/sushanttulasi/image/upload/v1717844643/CampQuest/r8ltrfojrdl5t45jqnps.jpg"})}),_e.jsxs("div",{className:"p-5 flex flex-col flex-1",children:[_e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2 truncate",children:O.title}),_e.jsx("p",{className:"text-gray-700 mb-4 line-clamp-3 flex-1",children:O.description}),_e.jsxs("div",{className:"flex items-center text-gray-500 mb-4",children:[_e.jsx(rS,{className:"w-5 h-5 mr-2"}),_e.jsx("span",{className:"text-sm truncate",children:O.location})]}),_e.jsxs($v,{className:"inline-flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-lg shadow-md transition-all w-full",to:`/campgrounds/${O._id}`,children:[_e.jsx(ZI,{className:"w-5 h-5 mr-2"}),"View Details"]})]})]},O._id))})]})};function nR(){return _e.jsxs("div",{className:"w-full h-screen flex flex-col justify-between text-center text-white relative",style:{backgroundImage:"url('/githubs_pages/homebg.webp')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[_e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40 z-0"}),_e.jsx("div",{className:"fixed top-0 left-0 w-full z-50",children:_e.jsx(rR,{})}),_e.jsxs("main",{className:"flex flex-col items-center justify-center flex-grow pt-24 px-6 z-10",children:[_e.jsx("h1",{className:"text-3xl font-semibold drop-shadow-lg",children:"Sahyadri Explorers!"}),_e.jsxs("p",{className:"text-lg mt-4 max-w-2xl font-thin drop-shadow-md",children:["Welcome to Sahyadri Explorers! ",_e.jsx("br",{}),"From Peaks to Valleys Explore the Sahyadri Way... ",_e.jsx("br",{}),"Explore the unexplored with Sahyadri Explorers. ",_e.jsx("br",{})]}),_e.jsx("a",{href:"/campgrounds",className:"mt-6 px-4 text-xl py-3 bg-white text-black font-semibold rounded-lg shadow-lg hover:bg-gray-200 transition",children:"Book Trek!"})]}),_e.jsx("div",{className:"fixed bottom-0 left-0 w-full z-20",children:_e.jsx(aR,{})})]})}const rR=()=>{const[m,v]=Ie.useState(!1),S=dh(),D=()=>v(!m);return _e.jsx("nav",{className:"bg-transparent shadow-lg fixed w-full z-50",children:_e.jsxs("div",{className:"container mx-auto flex justify-between items-center px-4 py-3",children:[_e.jsx("a",{className:"text-2xl font-semibold tracking-wide text-white",href:"/",children:"Sahyadri Explorers!"}),_e.jsxs("button",{className:"lg:hidden p-2 border-2 rounded-md text-white",onClick:D,"aria-label":"Toggle navigation",children:[_e.jsx("span",{className:"block w-6 h-0.5 bg-white mb-2"}),_e.jsx("span",{className:"block w-6 h-0.5 bg-white mb-2"}),_e.jsx("span",{className:"block w-6 h-0.5 bg-white"})]}),_e.jsx("div",{className:`lg:flex flex-col lg:flex-row lg:space-x-6 mt-4 lg:mt-0 ${m?"block":"hidden"}`,children:_e.jsx("ul",{className:"navbar-nav flex flex-col lg:flex-row gap-6 relative",children:[{name:"Home",path:"/"},{name:"Campgrounds",path:"/campgrounds"},{name:"Register",path:"/register"},{name:"New Campground",path:"/new",show:S.pathname!=="/"},{name:"Login",path:"/login"}].map(O=>(O.show===void 0||O.show)&&_e.jsx("li",{className:"nav-item relative",children:_e.jsxs("a",{className:"nav-link text-white hover:text-gray-300 transition-all duration-300 cursor-pointer px-3 py-2 relative",href:O.path,children:[O.name,S.pathname===O.path&&_e.jsx("div",{className:"absolute left-0 bottom-0 w-full h-1 bg-white rounded-lg transition-all duration-300"})]})},O.path))})})]})})},aR=()=>_e.jsx("footer",{className:"bg-light text-center text-lg-start mt-auto",children:_e.jsx("div",{className:"text-center p-3 text-gray-400 text-md",style:{backgroundColor:"rgba(0, 0, 0, 0.2)"},children:"© 2025 Sahyadri Explorers!. All rights reserved."})});function sS(m){var v,S,D="";if(typeof m=="string"||typeof m=="number")D+=m;else if(typeof m=="object")if(Array.isArray(m)){var O=m.length;for(v=0;v<O;v++)m[v]&&(S=sS(m[v]))&&(D&&(D+=" "),D+=S)}else for(S in m)m[S]&&(D&&(D+=" "),D+=S);return D}function bd(){for(var m,v,S=0,D="",O=arguments.length;S<O;S++)(m=arguments[S])&&(v=sS(m))&&(D&&(D+=" "),D+=v);return D}function sR(m){if(typeof document>"u")return;let v=document.head||document.getElementsByTagName("head")[0],S=document.createElement("style");S.type="text/css",v.firstChild?v.insertBefore(S,v.firstChild):v.appendChild(S),S.styleSheet?S.styleSheet.cssText=m:S.appendChild(document.createTextNode(m))}sR(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var gy=m=>typeof m=="number"&&!isNaN(m),em=m=>typeof m=="string",Td=m=>typeof m=="function",oR=m=>em(m)||gy(m),t1=m=>em(m)||Td(m)?m:null,lR=(m,v)=>m===!1||gy(m)&&m>0?m:v,i1=m=>Ie.isValidElement(m)||em(m)||Td(m)||gy(m);function cR(m,v,S=300){let{scrollHeight:D,style:O}=m;requestAnimationFrame(()=>{O.minHeight="initial",O.height=D+"px",O.transition=`all ${S}ms`,requestAnimationFrame(()=>{O.height="0",O.padding="0",O.margin="0",setTimeout(v,S)})})}function uR({enter:m,exit:v,appendPosition:S=!1,collapse:D=!0,collapseDuration:O=300}){return function({children:F,position:X,preventExitTransition:r,done:re,nodeRef:J,isIn:oe,playToast:ze}){let je=S?`${m}--${X}`:m,ft=S?`${v}--${X}`:v,Le=Ie.useRef(0);return Ie.useLayoutEffect(()=>{let Fe=J.current,qe=je.split(" "),He=tt=>{tt.target===J.current&&(ze(),Fe.removeEventListener("animationend",He),Fe.removeEventListener("animationcancel",He),Le.current===0&&tt.type!=="animationcancel"&&Fe.classList.remove(...qe))};Fe.classList.add(...qe),Fe.addEventListener("animationend",He),Fe.addEventListener("animationcancel",He)},[]),Ie.useEffect(()=>{let Fe=J.current,qe=()=>{Fe.removeEventListener("animationend",qe),D?cR(Fe,re,O):re()};oe||(r?qe():(Le.current=1,Fe.className+=` ${ft}`,Fe.addEventListener("animationend",qe)))},[oe]),Zi.createElement(Zi.Fragment,null,F)}}function U2(m,v){return{content:oS(m.content,m.props),containerId:m.props.containerId,id:m.props.toastId,theme:m.props.theme,type:m.props.type,data:m.props.data||{},isLoading:m.props.isLoading,icon:m.props.icon,reason:m.removalReason,status:v}}function oS(m,v,S=!1){return Ie.isValidElement(m)&&!em(m.type)?Ie.cloneElement(m,{closeToast:v.closeToast,toastProps:v,data:v.data,isPaused:S}):Td(m)?m({closeToast:v.closeToast,toastProps:v,data:v.data,isPaused:S}):m}function hR({closeToast:m,theme:v,ariaLabel:S="close"}){return Zi.createElement("button",{className:`Toastify__close-button Toastify__close-button--${v}`,type:"button",onClick:D=>{D.stopPropagation(),m(!0)},"aria-label":S},Zi.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Zi.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function dR({delay:m,isRunning:v,closeToast:S,type:D="default",hide:O,className:F,controlledProgress:X,progress:r,rtl:re,isIn:J,theme:oe}){let ze=O||X&&r===0,je={animationDuration:`${m}ms`,animationPlayState:v?"running":"paused"};X&&(je.transform=`scaleX(${r})`);let ft=bd("Toastify__progress-bar",X?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${oe}`,`Toastify__progress-bar--${D}`,{"Toastify__progress-bar--rtl":re}),Le=Td(F)?F({rtl:re,type:D,defaultClassName:ft}):bd(ft,F),Fe={[X&&r>=1?"onTransitionEnd":"onAnimationEnd"]:X&&r<1?null:()=>{J&&S()}};return Zi.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":ze},Zi.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${oe} Toastify__progress-bar--${D}`}),Zi.createElement("div",{role:"progressbar","aria-hidden":ze?"true":"false","aria-label":"notification timer",className:Le,style:je,...Fe}))}var fR=1,lS=()=>`${fR++}`;function pR(m,v,S){let D=1,O=0,F=[],X=[],r=v,re=new Map,J=new Set,oe=tt=>(J.add(tt),()=>J.delete(tt)),ze=()=>{X=Array.from(re.values()),J.forEach(tt=>tt())},je=({containerId:tt,toastId:mt,updateId:Tt})=>{let kt=tt?tt!==m:m!==1,At=re.has(mt)&&Tt==null;return kt||At},ft=(tt,mt)=>{re.forEach(Tt=>{var kt;(mt==null||mt===Tt.props.toastId)&&((kt=Tt.toggle)==null||kt.call(Tt,tt))})},Le=tt=>{var mt,Tt;(Tt=(mt=tt.props)==null?void 0:mt.onClose)==null||Tt.call(mt,tt.removalReason),tt.isActive=!1},Fe=tt=>{if(tt==null)re.forEach(Le);else{let mt=re.get(tt);mt&&Le(mt)}ze()},qe=()=>{O-=F.length,F=[]},He=tt=>{var mt,Tt;let{toastId:kt,updateId:At}=tt.props,ot=At==null;tt.staleId&&re.delete(tt.staleId),tt.isActive=!0,re.set(kt,tt),ze(),S(U2(tt,ot?"added":"updated")),ot&&((Tt=(mt=tt.props).onOpen)==null||Tt.call(mt))};return{id:m,props:r,observe:oe,toggle:ft,removeToast:Fe,toasts:re,clearQueue:qe,buildToast:(tt,mt)=>{if(je(mt))return;let{toastId:Tt,updateId:kt,data:At,staleId:ot,delay:hi}=mt,Mi=kt==null;Mi&&O++;let ti={...r,style:r.toastStyle,key:D++,...Object.fromEntries(Object.entries(mt).filter(([ui,Si])=>Si!=null)),toastId:Tt,updateId:kt,data:At,isIn:!1,className:t1(mt.className||r.toastClassName),progressClassName:t1(mt.progressClassName||r.progressClassName),autoClose:mt.isLoading?!1:lR(mt.autoClose,r.autoClose),closeToast(ui){re.get(Tt).removalReason=ui,Fe(Tt)},deleteToast(){let ui=re.get(Tt);if(ui!=null){if(S(U2(ui,"removed")),re.delete(Tt),O--,O<0&&(O=0),F.length>0){He(F.shift());return}ze()}}};ti.closeButton=r.closeButton,mt.closeButton===!1||i1(mt.closeButton)?ti.closeButton=mt.closeButton:mt.closeButton===!0&&(ti.closeButton=i1(r.closeButton)?r.closeButton:!0);let Rt={content:tt,props:ti,staleId:ot};r.limit&&r.limit>0&&O>r.limit&&Mi?F.push(Rt):gy(hi)?setTimeout(()=>{He(Rt)},hi):He(Rt)},setProps(tt){r=tt},setToggle:(tt,mt)=>{let Tt=re.get(tt);Tt&&(Tt.toggle=mt)},isToastActive:tt=>{var mt;return(mt=re.get(tt))==null?void 0:mt.isActive},getSnapshot:()=>X}}var Eo=new Map,Qg=[],n1=new Set,mR=m=>n1.forEach(v=>v(m)),cS=()=>Eo.size>0;function _R(){Qg.forEach(m=>hS(m.content,m.options)),Qg=[]}var gR=(m,{containerId:v})=>{var S;return(S=Eo.get(v||1))==null?void 0:S.toasts.get(m)};function uS(m,v){var S;if(v)return!!((S=Eo.get(v))!=null&&S.isToastActive(m));let D=!1;return Eo.forEach(O=>{O.isToastActive(m)&&(D=!0)}),D}function yR(m){if(!cS()){Qg=Qg.filter(v=>m!=null&&v.options.toastId!==m);return}if(m==null||oR(m))Eo.forEach(v=>{v.removeToast(m)});else if(m&&("containerId"in m||"id"in m)){let v=Eo.get(m.containerId);v?v.removeToast(m.id):Eo.forEach(S=>{S.removeToast(m.id)})}}var vR=(m={})=>{Eo.forEach(v=>{v.props.limit&&(!m.containerId||v.id===m.containerId)&&v.clearQueue()})};function hS(m,v){i1(m)&&(cS()||Qg.push({content:m,options:v}),Eo.forEach(S=>{S.buildToast(m,v)}))}function xR(m){var v;(v=Eo.get(m.containerId||1))==null||v.setToggle(m.id,m.fn)}function dS(m,v){Eo.forEach(S=>{(v==null||!(v!=null&&v.containerId)||(v==null?void 0:v.containerId)===S.id)&&S.toggle(m,v==null?void 0:v.id)})}function bR(m){let v=m.containerId||1;return{subscribe(S){let D=pR(v,m,mR);Eo.set(v,D);let O=D.observe(S);return _R(),()=>{O(),Eo.delete(v)}},setProps(S){var D;(D=Eo.get(v))==null||D.setProps(S)},getSnapshot(){var S;return(S=Eo.get(v))==null?void 0:S.getSnapshot()}}}function wR(m){return n1.add(m),()=>{n1.delete(m)}}function TR(m){return m&&(em(m.toastId)||gy(m.toastId))?m.toastId:lS()}function yy(m,v){return hS(m,v),v.toastId}function _0(m,v){return{...v,type:v&&v.type||m,toastId:TR(v)}}function g0(m){return(v,S)=>yy(v,_0(m,S))}function gr(m,v){return yy(m,_0("default",v))}gr.loading=(m,v)=>yy(m,_0("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...v}));function SR(m,{pending:v,error:S,success:D},O){let F;v&&(F=em(v)?gr.loading(v,O):gr.loading(v.render,{...O,...v}));let X={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},r=(J,oe,ze)=>{if(oe==null){gr.dismiss(F);return}let je={type:J,...X,...O,data:ze},ft=em(oe)?{render:oe}:oe;return F?gr.update(F,{...je,...ft}):gr(ft.render,{...je,...ft}),ze},re=Td(m)?m():m;return re.then(J=>r("success",D,J)).catch(J=>r("error",S,J)),re}gr.promise=SR;gr.success=g0("success");gr.info=g0("info");gr.error=g0("error");gr.warning=g0("warning");gr.warn=gr.warning;gr.dark=(m,v)=>yy(m,_0("default",{theme:"dark",...v}));function ER(m){yR(m)}gr.dismiss=ER;gr.clearWaitingQueue=vR;gr.isActive=uS;gr.update=(m,v={})=>{let S=gR(m,v);if(S){let{props:D,content:O}=S,F={delay:100,...D,...v,toastId:v.toastId||m,updateId:lS()};F.toastId!==m&&(F.staleId=m);let X=F.render||O;delete F.render,yy(X,F)}};gr.done=m=>{gr.update(m,{progress:1})};gr.onChange=wR;gr.play=m=>dS(!0,m);gr.pause=m=>dS(!1,m);function AR(m){var v;let{subscribe:S,getSnapshot:D,setProps:O}=Ie.useRef(bR(m)).current;O(m);let F=(v=Ie.useSyncExternalStore(S,D,D))==null?void 0:v.slice();function X(r){if(!F)return[];let re=new Map;return m.newestOnTop&&F.reverse(),F.forEach(J=>{let{position:oe}=J.props;re.has(oe)||re.set(oe,[]),re.get(oe).push(J)}),Array.from(re,J=>r(J[0],J[1]))}return{getToastToRender:X,isToastActive:uS,count:F==null?void 0:F.length}}function MR(m){let[v,S]=Ie.useState(!1),[D,O]=Ie.useState(!1),F=Ie.useRef(null),X=Ie.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:r,pauseOnHover:re,closeToast:J,onClick:oe,closeOnClick:ze}=m;xR({id:m.toastId,containerId:m.containerId,fn:S}),Ie.useEffect(()=>{if(m.pauseOnFocusLoss)return je(),()=>{ft()}},[m.pauseOnFocusLoss]);function je(){document.hasFocus()||He(),window.addEventListener("focus",qe),window.addEventListener("blur",He)}function ft(){window.removeEventListener("focus",qe),window.removeEventListener("blur",He)}function Le(ot){if(m.draggable===!0||m.draggable===ot.pointerType){tt();let hi=F.current;X.canCloseOnClick=!0,X.canDrag=!0,hi.style.transition="none",m.draggableDirection==="x"?(X.start=ot.clientX,X.removalDistance=hi.offsetWidth*(m.draggablePercent/100)):(X.start=ot.clientY,X.removalDistance=hi.offsetHeight*(m.draggablePercent===80?m.draggablePercent*1.5:m.draggablePercent)/100)}}function Fe(ot){let{top:hi,bottom:Mi,left:ti,right:Rt}=F.current.getBoundingClientRect();ot.nativeEvent.type!=="touchend"&&m.pauseOnHover&&ot.clientX>=ti&&ot.clientX<=Rt&&ot.clientY>=hi&&ot.clientY<=Mi?He():qe()}function qe(){S(!0)}function He(){S(!1)}function tt(){X.didMove=!1,document.addEventListener("pointermove",Tt),document.addEventListener("pointerup",kt)}function mt(){document.removeEventListener("pointermove",Tt),document.removeEventListener("pointerup",kt)}function Tt(ot){let hi=F.current;if(X.canDrag&&hi){X.didMove=!0,v&&He(),m.draggableDirection==="x"?X.delta=ot.clientX-X.start:X.delta=ot.clientY-X.start,X.start!==ot.clientX&&(X.canCloseOnClick=!1);let Mi=m.draggableDirection==="x"?`${X.delta}px, var(--y)`:`0, calc(${X.delta}px + var(--y))`;hi.style.transform=`translate3d(${Mi},0)`,hi.style.opacity=`${1-Math.abs(X.delta/X.removalDistance)}`}}function kt(){mt();let ot=F.current;if(X.canDrag&&X.didMove&&ot){if(X.canDrag=!1,Math.abs(X.delta)>X.removalDistance){O(!0),m.closeToast(!0),m.collapseAll();return}ot.style.transition="transform 0.2s, opacity 0.2s",ot.style.removeProperty("transform"),ot.style.removeProperty("opacity")}}let At={onPointerDown:Le,onPointerUp:Fe};return r&&re&&(At.onMouseEnter=He,m.stacked||(At.onMouseLeave=qe)),ze&&(At.onClick=ot=>{oe&&oe(ot),X.canCloseOnClick&&J(!0)}),{playToast:qe,pauseToast:He,isRunning:v,preventExitTransition:D,toastRef:F,eventHandlers:At}}var CR=typeof window<"u"?Ie.useLayoutEffect:Ie.useEffect,y0=({theme:m,type:v,isLoading:S,...D})=>Zi.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:m==="colored"?"currentColor":`var(--toastify-icon-color-${v})`,...D});function IR(m){return Zi.createElement(y0,{...m},Zi.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function RR(m){return Zi.createElement(y0,{...m},Zi.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function DR(m){return Zi.createElement(y0,{...m},Zi.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function zR(m){return Zi.createElement(y0,{...m},Zi.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function LR(){return Zi.createElement("div",{className:"Toastify__spinner"})}var r1={info:RR,warning:IR,success:DR,error:zR,spinner:LR},OR=m=>m in r1;function PR({theme:m,type:v,isLoading:S,icon:D}){let O=null,F={theme:m,type:v};return D===!1||(Td(D)?O=D({...F,isLoading:S}):Ie.isValidElement(D)?O=Ie.cloneElement(D,F):S?O=r1.spinner():OR(v)&&(O=r1[v](F))),O}var kR=m=>{let{isRunning:v,preventExitTransition:S,toastRef:D,eventHandlers:O,playToast:F}=MR(m),{closeButton:X,children:r,autoClose:re,onClick:J,type:oe,hideProgressBar:ze,closeToast:je,transition:ft,position:Le,className:Fe,style:qe,progressClassName:He,updateId:tt,role:mt,progress:Tt,rtl:kt,toastId:At,deleteToast:ot,isIn:hi,isLoading:Mi,closeOnClick:ti,theme:Rt,ariaLabel:ui}=m,Si=bd("Toastify__toast",`Toastify__toast-theme--${Rt}`,`Toastify__toast--${oe}`,{"Toastify__toast--rtl":kt},{"Toastify__toast--close-on-click":ti}),di=Td(Fe)?Fe({rtl:kt,position:Le,type:oe,defaultClassName:Si}):bd(Si,Fe),ii=PR(m),pt=!!Tt||!re,ni={closeToast:je,type:oe,theme:Rt},pi=null;return X===!1||(Td(X)?pi=X(ni):Ie.isValidElement(X)?pi=Ie.cloneElement(X,ni):pi=hR(ni)),Zi.createElement(ft,{isIn:hi,done:ot,position:Le,preventExitTransition:S,nodeRef:D,playToast:F},Zi.createElement("div",{id:At,tabIndex:0,onClick:J,"data-in":hi,className:di,...O,style:qe,ref:D,...hi&&{role:mt,"aria-label":ui}},ii!=null&&Zi.createElement("div",{className:bd("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!Mi})},ii),oS(r,m,!v),pi,!m.customProgressBar&&Zi.createElement(dR,{...tt&&!pt?{key:`p-${tt}`}:{},rtl:kt,theme:Rt,delay:re,isRunning:v,isIn:hi,closeToast:je,hide:ze,type:oe,className:He,controlledProgress:pt,progress:Tt||0})))},BR=(m,v=!1)=>({enter:`Toastify--animate Toastify__${m}-enter`,exit:`Toastify--animate Toastify__${m}-exit`,appendPosition:v}),NR=uR(BR("bounce",!0)),FR={position:"top-right",transition:NR,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:m=>m.altKey&&m.code==="KeyT"};function VR(m){let v={...FR,...m},S=m.stacked,[D,O]=Ie.useState(!0),F=Ie.useRef(null),{getToastToRender:X,isToastActive:r,count:re}=AR(v),{className:J,style:oe,rtl:ze,containerId:je,hotKeys:ft}=v;function Le(qe){let He=bd("Toastify__toast-container",`Toastify__toast-container--${qe}`,{"Toastify__toast-container--rtl":ze});return Td(J)?J({position:qe,rtl:ze,defaultClassName:He}):bd(He,t1(J))}function Fe(){S&&(O(!0),gr.play())}return CR(()=>{var qe;if(S){let He=F.current.querySelectorAll('[data-in="true"]'),tt=12,mt=(qe=v.position)==null?void 0:qe.includes("top"),Tt=0,kt=0;Array.from(He).reverse().forEach((At,ot)=>{let hi=At;hi.classList.add("Toastify__toast--stacked"),ot>0&&(hi.dataset.collapsed=`${D}`),hi.dataset.pos||(hi.dataset.pos=mt?"top":"bot");let Mi=Tt*(D?.2:1)+(D?0:tt*ot);hi.style.setProperty("--y",`${mt?Mi:Mi*-1}px`),hi.style.setProperty("--g",`${tt}`),hi.style.setProperty("--s",`${1-(D?kt:0)}`),Tt+=hi.offsetHeight,kt+=.025})}},[D,re,S]),Ie.useEffect(()=>{function qe(He){var tt;let mt=F.current;ft(He)&&((tt=mt.querySelector('[tabIndex="0"]'))==null||tt.focus(),O(!1),gr.pause()),He.key==="Escape"&&(document.activeElement===mt||mt!=null&&mt.contains(document.activeElement))&&(O(!0),gr.play())}return document.addEventListener("keydown",qe),()=>{document.removeEventListener("keydown",qe)}},[ft]),Zi.createElement("section",{ref:F,className:"Toastify",id:je,onMouseEnter:()=>{S&&(O(!1),gr.pause())},onMouseLeave:Fe,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":v["aria-label"]},X((qe,He)=>{let tt=He.length?{...oe}:{...oe,pointerEvents:"none"};return Zi.createElement("div",{tabIndex:-1,className:Le(qe),"data-stacked":S,style:tt,key:`c-${qe}`},He.map(({content:mt,props:Tt})=>Zi.createElement(kR,{...Tt,stacked:S,collapseAll:Fe,isIn:r(Tt.toastId,Tt.containerId),key:`t-${Tt.key}`},mt)))}))}const UR=()=>{const[m,v]=Ie.useState(""),[S,D]=Ie.useState(""),[O,F]=Ie.useState(!1),X=Wf(),r=async re=>{var J,oe;re.preventDefault();try{F(!0);const ze=await So.post("/login",{email:m,password:S}),{success:je,message:ft,user:Le,token:Fe}=ze.data;if(je&&Fe){localStorage.setItem("token",Fe),localStorage.setItem("user",JSON.stringify(Le)),localStorage.setItem("isAuthenticated","true"),localStorage.setItem("isAdmin",Le.isAdmin),So.defaults.headers.common.Authorization=`Bearer ${Fe}`;const qe=localStorage.getItem("returnTo")||"/campgrounds";localStorage.removeItem("returnTo"),gr.success(ft),X(qe)}else gr.error(ft)}catch(ze){console.error("Error logging in:",ze),gr.error(((oe=(J=ze.response)==null?void 0:J.data)==null?void 0:oe.message)||"Error logging in")}finally{F(!1)}};return _e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:_e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg w-96",children:[_e.jsx("h2",{className:"text-2xl font-semibold text-center text-gray-700 mb-6",children:"Login"}),_e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[_e.jsxs("div",{children:[_e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Email"}),_e.jsx("input",{type:"email",value:m,onChange:re=>v(re.target.value),required:!0,className:"w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200"})]}),_e.jsxs("div",{children:[_e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Password"}),_e.jsx("input",{type:"password",value:S,onChange:re=>D(re.target.value),required:!0,className:"w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200"})]}),_e.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-300",children:"Login"})]}),_e.jsxs("p",{className:"text-center text-sm text-gray-500 mt-4",children:["Don't have an account?"," ",_e.jsx("a",{href:"/register",className:"text-blue-500 hover:underline",children:"Sign up"})]})]})})},jR=()=>{const[m,v]=Ie.useState(""),[S,D]=Ie.useState(""),[O,F]=Ie.useState(""),X=Wf(),r=async re=>{var J,oe;re.preventDefault();try{const ze=await So.post("/register",{username:m,email:S,password:O}),{success:je,message:ft,user:Le,token:Fe}=ze.data;je?(localStorage.setItem("token",Fe),localStorage.setItem("user",JSON.stringify(Le)),localStorage.setItem("isAuthenticated","true"),localStorage.setItem("isAdmin",Le.isAdmin),gr.success(ft),X("/campgrounds")):gr.error(ft)}catch(ze){console.error("Error registering:",ze),gr.error(((oe=(J=ze.response)==null?void 0:J.data)==null?void 0:oe.message)||"Error registering")}};return _e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:_e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg w-96",children:[_e.jsx("h2",{className:"text-2xl font-semibold text-center text-gray-700 mb-6",children:"Register"}),_e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[_e.jsxs("div",{children:[_e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Username"}),_e.jsx("input",{type:"text",value:m,onChange:re=>v(re.target.value),required:!0,className:"w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200"})]}),_e.jsxs("div",{children:[_e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Email"}),_e.jsx("input",{type:"email",value:S,onChange:re=>D(re.target.value),required:!0,className:"w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200"})]}),_e.jsxs("div",{children:[_e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Password"}),_e.jsx("input",{type:"password",value:O,onChange:re=>F(re.target.value),required:!0,className:"w-full px-4 py-2 mt-1 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200"})]}),_e.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-300",children:"Register"})]}),_e.jsxs("p",{className:"text-center text-sm text-gray-500 mt-4",children:["Already have an account?"," ",_e.jsx("a",{href:"/login",className:"text-blue-500 hover:underline",children:"Login"})]})]})})},qR=Ie.createContext(),GR=({children:m})=>{const[v,S]=Ie.useState(!1),[D,O]=Ie.useState(0),F=()=>{O(r=>r+1),S(!0)},X=()=>{O(r=>{const re=r-1;return re<=0?(S(!1),0):re})};return _e.jsxs(qR.Provider,{value:{loading:v,startLoading:F,stopLoading:X},children:[v&&_e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:_e.jsx(D1,{className:"w-8 h-8 text-white animate-spin"})}),m]})};var vy=m=>m.type==="checkbox",Wp=m=>m instanceof Date,To=m=>m==null;const fS=m=>typeof m=="object";var Ba=m=>!To(m)&&!Array.isArray(m)&&fS(m)&&!Wp(m),pS=m=>Ba(m)&&m.target?vy(m.target)?m.target.checked:m.target.value:m,HR=m=>m.substring(0,m.search(/\.\d+(\.|$)/))||m,mS=(m,v)=>m.has(HR(v)),ZR=m=>{const v=m.constructor&&m.constructor.prototype;return Ba(v)&&v.hasOwnProperty("isPrototypeOf")},L1=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ps(m){let v;const S=Array.isArray(m),D=typeof FileList<"u"?m instanceof FileList:!1;if(m instanceof Date)v=new Date(m);else if(m instanceof Set)v=new Set(m);else if(!(L1&&(m instanceof Blob||D))&&(S||Ba(m)))if(v=S?[]:{},!S&&!ZR(m))v=m;else for(const O in m)m.hasOwnProperty(O)&&(v[O]=Ps(m[O]));else return m;return v}var v0=m=>Array.isArray(m)?m.filter(Boolean):[],ka=m=>m===void 0,Pi=(m,v,S)=>{if(!v||!Ba(m))return S;const D=v0(v.split(/[,[\].]+?/)).reduce((O,F)=>To(O)?O:O[F],m);return ka(D)||D===m?ka(m[v])?S:m[v]:D},ml=m=>typeof m=="boolean",O1=m=>/^\w*$/.test(m),_S=m=>v0(m.replace(/["|']|\]/g,"").split(/\.|\[/)),Ar=(m,v,S)=>{let D=-1;const O=O1(v)?[v]:_S(v),F=O.length,X=F-1;for(;++D<F;){const r=O[D];let re=S;if(D!==X){const J=m[r];re=Ba(J)||Array.isArray(J)?J:isNaN(+O[D+1])?{}:[]}if(r==="__proto__"||r==="constructor"||r==="prototype")return;m[r]=re,m=m[r]}};const Wv={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},hu={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},dd={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},gS=Zi.createContext(null),x0=()=>Zi.useContext(gS),$R=m=>{const{children:v,...S}=m;return Zi.createElement(gS.Provider,{value:S},v)};var yS=(m,v,S,D=!0)=>{const O={defaultValues:v._defaultValues};for(const F in m)Object.defineProperty(O,F,{get:()=>{const X=F;return v._proxyFormState[X]!==hu.all&&(v._proxyFormState[X]=!D||hu.all),S&&(S[X]=!0),m[X]}});return O};function XR(m){const v=x0(),{control:S=v.control,disabled:D,name:O,exact:F}=m||{},[X,r]=Zi.useState(S._formState),re=Zi.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),J=Zi.useRef(O);return J.current=O,Zi.useEffect(()=>S._subscribe({name:J.current,formState:re.current,exact:F,callback:oe=>{!D&&r({...S._formState,...oe})}}),[S,D,F]),Zi.useEffect(()=>{re.current.isValid&&S._setValid(!0)},[S]),Zi.useMemo(()=>yS(X,S,re.current,!1),[X,S])}var lh=m=>typeof m=="string",vS=(m,v,S,D,O)=>lh(m)?(D&&v.watch.add(m),Pi(S,m,O)):Array.isArray(m)?m.map(F=>(D&&v.watch.add(F),Pi(S,F))):(D&&(v.watchAll=!0),S);function YR(m){const v=x0(),{control:S=v.control,name:D,defaultValue:O,disabled:F,exact:X}=m||{},r=Zi.useRef(D),re=Zi.useRef(O);r.current=D,Zi.useEffect(()=>S._subscribe({name:r.current,formState:{values:!0},exact:X,callback:ze=>!F&&oe(vS(r.current,S._names,ze.values||S._formValues,!1,re.current))}),[S,F,X]);const[J,oe]=Zi.useState(S._getWatch(D,O));return Zi.useEffect(()=>S._removeUnmounted()),J}function WR(m){const v=x0(),{name:S,disabled:D,control:O=v.control,shouldUnregister:F}=m,X=mS(O._names.array,S),r=YR({control:O,name:S,defaultValue:Pi(O._formValues,S,Pi(O._defaultValues,S,m.defaultValue)),exact:!0}),re=XR({control:O,name:S,exact:!0}),J=Zi.useRef(m),oe=Zi.useRef(O.register(S,{...m.rules,value:r,...ml(m.disabled)?{disabled:m.disabled}:{}})),ze=Zi.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Pi(re.errors,S)},isDirty:{enumerable:!0,get:()=>!!Pi(re.dirtyFields,S)},isTouched:{enumerable:!0,get:()=>!!Pi(re.touchedFields,S)},isValidating:{enumerable:!0,get:()=>!!Pi(re.validatingFields,S)},error:{enumerable:!0,get:()=>Pi(re.errors,S)}}),[re,S]),je=Zi.useCallback(qe=>oe.current.onChange({target:{value:pS(qe),name:S},type:Wv.CHANGE}),[S]),ft=Zi.useCallback(()=>oe.current.onBlur({target:{value:Pi(O._formValues,S),name:S},type:Wv.BLUR}),[S,O._formValues]),Le=Zi.useCallback(qe=>{const He=Pi(O._fields,S);He&&qe&&(He._f.ref={focus:()=>qe.focus(),select:()=>qe.select(),setCustomValidity:tt=>qe.setCustomValidity(tt),reportValidity:()=>qe.reportValidity()})},[O._fields,S]),Fe=Zi.useMemo(()=>({name:S,value:r,...ml(D)||re.disabled?{disabled:re.disabled||D}:{},onChange:je,onBlur:ft,ref:Le}),[S,D,re.disabled,je,ft,Le,r]);return Zi.useEffect(()=>{const qe=O._options.shouldUnregister||F;O.register(S,{...J.current.rules,...ml(J.current.disabled)?{disabled:J.current.disabled}:{}});const He=(tt,mt)=>{const Tt=Pi(O._fields,tt);Tt&&Tt._f&&(Tt._f.mount=mt)};if(He(S,!0),qe){const tt=Ps(Pi(O._options.defaultValues,S));Ar(O._defaultValues,S,tt),ka(Pi(O._formValues,S))&&Ar(O._formValues,S,tt)}return!X&&O.register(S),()=>{(X?qe&&!O._state.action:qe)?O.unregister(S):He(S,!1)}},[S,O,X,F]),Zi.useEffect(()=>{O._setDisabledField({disabled:D,name:S})},[D,S,O]),Zi.useMemo(()=>({field:Fe,formState:re,fieldState:ze}),[Fe,re,ze])}const KR=m=>m.render(WR(m));var xS=(m,v,S,D,O)=>v?{...S[m],types:{...S[m]&&S[m].types?S[m].types:{},[D]:O||!0}}:{},Xg=m=>Array.isArray(m)?m:[m],j2=()=>{let m=[];return{get observers(){return m},next:O=>{for(const F of m)F.next&&F.next(O)},subscribe:O=>(m.push(O),{unsubscribe:()=>{m=m.filter(F=>F!==O)}}),unsubscribe:()=>{m=[]}}},a1=m=>To(m)||!fS(m);function Gf(m,v){if(a1(m)||a1(v))return m===v;if(Wp(m)&&Wp(v))return m.getTime()===v.getTime();const S=Object.keys(m),D=Object.keys(v);if(S.length!==D.length)return!1;for(const O of S){const F=m[O];if(!D.includes(O))return!1;if(O!=="ref"){const X=v[O];if(Wp(F)&&Wp(X)||Ba(F)&&Ba(X)||Array.isArray(F)&&Array.isArray(X)?!Gf(F,X):F!==X)return!1}}return!0}var wo=m=>Ba(m)&&!Object.keys(m).length,P1=m=>m.type==="file",du=m=>typeof m=="function",Kv=m=>{if(!L1)return!1;const v=m?m.ownerDocument:0;return m instanceof(v&&v.defaultView?v.defaultView.HTMLElement:HTMLElement)},bS=m=>m.type==="select-multiple",k1=m=>m.type==="radio",JR=m=>k1(m)||vy(m),Vx=m=>Kv(m)&&m.isConnected;function QR(m,v){const S=v.slice(0,-1).length;let D=0;for(;D<S;)m=ka(m)?D++:m[v[D++]];return m}function eD(m){for(const v in m)if(m.hasOwnProperty(v)&&!ka(m[v]))return!1;return!0}function cs(m,v){const S=Array.isArray(v)?v:O1(v)?[v]:_S(v),D=S.length===1?m:QR(m,S),O=S.length-1,F=S[O];return D&&delete D[F],O!==0&&(Ba(D)&&wo(D)||Array.isArray(D)&&eD(D))&&cs(m,S.slice(0,-1)),m}var wS=m=>{for(const v in m)if(du(m[v]))return!0;return!1};function Jv(m,v={}){const S=Array.isArray(m);if(Ba(m)||S)for(const D in m)Array.isArray(m[D])||Ba(m[D])&&!wS(m[D])?(v[D]=Array.isArray(m[D])?[]:{},Jv(m[D],v[D])):To(m[D])||(v[D]=!0);return v}function TS(m,v,S){const D=Array.isArray(m);if(Ba(m)||D)for(const O in m)Array.isArray(m[O])||Ba(m[O])&&!wS(m[O])?ka(v)||a1(S[O])?S[O]=Array.isArray(m[O])?Jv(m[O],[]):{...Jv(m[O])}:TS(m[O],To(v)?{}:v[O],S[O]):S[O]=!Gf(m[O],v[O]);return S}var jg=(m,v)=>TS(m,v,Jv(v));const q2={value:!1,isValid:!1},G2={value:!0,isValid:!0};var SS=m=>{if(Array.isArray(m)){if(m.length>1){const v=m.filter(S=>S&&S.checked&&!S.disabled).map(S=>S.value);return{value:v,isValid:!!v.length}}return m[0].checked&&!m[0].disabled?m[0].attributes&&!ka(m[0].attributes.value)?ka(m[0].value)||m[0].value===""?G2:{value:m[0].value,isValid:!0}:G2:q2}return q2},ES=(m,{valueAsNumber:v,valueAsDate:S,setValueAs:D})=>ka(m)?m:v?m===""?NaN:m&&+m:S&&lh(m)?new Date(m):D?D(m):m;const H2={isValid:!1,value:null};var AS=m=>Array.isArray(m)?m.reduce((v,S)=>S&&S.checked&&!S.disabled?{isValid:!0,value:S.value}:v,H2):H2;function Z2(m){const v=m.ref;return P1(v)?v.files:k1(v)?AS(m.refs).value:bS(v)?[...v.selectedOptions].map(({value:S})=>S):vy(v)?SS(m.refs).value:ES(ka(v.value)?m.ref.value:v.value,m)}var tD=(m,v,S,D)=>{const O={};for(const F of m){const X=Pi(v,F);X&&Ar(O,F,X._f)}return{criteriaMode:S,names:[...m],fields:O,shouldUseNativeValidation:D}},Qv=m=>m instanceof RegExp,qg=m=>ka(m)?m:Qv(m)?m.source:Ba(m)?Qv(m.value)?m.value.source:m.value:m,$2=m=>({isOnSubmit:!m||m===hu.onSubmit,isOnBlur:m===hu.onBlur,isOnChange:m===hu.onChange,isOnAll:m===hu.all,isOnTouch:m===hu.onTouched});const X2="AsyncFunction";var iD=m=>!!m&&!!m.validate&&!!(du(m.validate)&&m.validate.constructor.name===X2||Ba(m.validate)&&Object.values(m.validate).find(v=>v.constructor.name===X2)),nD=m=>m.mount&&(m.required||m.min||m.max||m.maxLength||m.minLength||m.pattern||m.validate),Y2=(m,v,S)=>!S&&(v.watchAll||v.watch.has(m)||[...v.watch].some(D=>m.startsWith(D)&&/^\.\w+/.test(m.slice(D.length))));const Yg=(m,v,S,D)=>{for(const O of S||Object.keys(m)){const F=Pi(m,O);if(F){const{_f:X,...r}=F;if(X){if(X.refs&&X.refs[0]&&v(X.refs[0],O)&&!D)return!0;if(X.ref&&v(X.ref,X.name)&&!D)return!0;if(Yg(r,v))break}else if(Ba(r)&&Yg(r,v))break}}};function W2(m,v,S){const D=Pi(m,S);if(D||O1(S))return{error:D,name:S};const O=S.split(".");for(;O.length;){const F=O.join("."),X=Pi(v,F),r=Pi(m,F);if(X&&!Array.isArray(X)&&S!==F)return{name:S};if(r&&r.type)return{name:F,error:r};O.pop()}return{name:S}}var rD=(m,v,S,D)=>{S(m);const{name:O,...F}=m;return wo(F)||Object.keys(F).length>=Object.keys(v).length||Object.keys(F).find(X=>v[X]===(!D||hu.all))},aD=(m,v,S)=>!m||!v||m===v||Xg(m).some(D=>D&&(S?D===v:D.startsWith(v)||v.startsWith(D))),sD=(m,v,S,D,O)=>O.isOnAll?!1:!S&&O.isOnTouch?!(v||m):(S?D.isOnBlur:O.isOnBlur)?!m:(S?D.isOnChange:O.isOnChange)?m:!0,oD=(m,v)=>!v0(Pi(m,v)).length&&cs(m,v),lD=(m,v,S)=>{const D=Xg(Pi(m,S));return Ar(D,"root",v[S]),Ar(m,S,D),m},jv=m=>lh(m);function K2(m,v,S="validate"){if(jv(m)||Array.isArray(m)&&m.every(jv)||ml(m)&&!m)return{type:S,message:jv(m)?m:"",ref:v}}var T_=m=>Ba(m)&&!Qv(m)?m:{value:m,message:""},J2=async(m,v,S,D,O,F)=>{const{ref:X,refs:r,required:re,maxLength:J,minLength:oe,min:ze,max:je,pattern:ft,validate:Le,name:Fe,valueAsNumber:qe,mount:He}=m._f,tt=Pi(S,Fe);if(!He||v.has(Fe))return{};const mt=r?r[0]:X,Tt=ui=>{O&&mt.reportValidity&&(mt.setCustomValidity(ml(ui)?"":ui||""),mt.reportValidity())},kt={},At=k1(X),ot=vy(X),hi=At||ot,Mi=(qe||P1(X))&&ka(X.value)&&ka(tt)||Kv(X)&&X.value===""||tt===""||Array.isArray(tt)&&!tt.length,ti=xS.bind(null,Fe,D,kt),Rt=(ui,Si,di,ii=dd.maxLength,pt=dd.minLength)=>{const ni=ui?Si:di;kt[Fe]={type:ui?ii:pt,message:ni,ref:X,...ti(ui?ii:pt,ni)}};if(F?!Array.isArray(tt)||!tt.length:re&&(!hi&&(Mi||To(tt))||ml(tt)&&!tt||ot&&!SS(r).isValid||At&&!AS(r).isValid)){const{value:ui,message:Si}=jv(re)?{value:!!re,message:re}:T_(re);if(ui&&(kt[Fe]={type:dd.required,message:Si,ref:mt,...ti(dd.required,Si)},!D))return Tt(Si),kt}if(!Mi&&(!To(ze)||!To(je))){let ui,Si;const di=T_(je),ii=T_(ze);if(!To(tt)&&!isNaN(tt)){const pt=X.valueAsNumber||tt&&+tt;To(di.value)||(ui=pt>di.value),To(ii.value)||(Si=pt<ii.value)}else{const pt=X.valueAsDate||new Date(tt),ni=We=>new Date(new Date().toDateString()+" "+We),pi=X.type=="time",ai=X.type=="week";lh(di.value)&&tt&&(ui=pi?ni(tt)>ni(di.value):ai?tt>di.value:pt>new Date(di.value)),lh(ii.value)&&tt&&(Si=pi?ni(tt)<ni(ii.value):ai?tt<ii.value:pt<new Date(ii.value))}if((ui||Si)&&(Rt(!!ui,di.message,ii.message,dd.max,dd.min),!D))return Tt(kt[Fe].message),kt}if((J||oe)&&!Mi&&(lh(tt)||F&&Array.isArray(tt))){const ui=T_(J),Si=T_(oe),di=!To(ui.value)&&tt.length>+ui.value,ii=!To(Si.value)&&tt.length<+Si.value;if((di||ii)&&(Rt(di,ui.message,Si.message),!D))return Tt(kt[Fe].message),kt}if(ft&&!Mi&&lh(tt)){const{value:ui,message:Si}=T_(ft);if(Qv(ui)&&!tt.match(ui)&&(kt[Fe]={type:dd.pattern,message:Si,ref:X,...ti(dd.pattern,Si)},!D))return Tt(Si),kt}if(Le){if(du(Le)){const ui=await Le(tt,S),Si=K2(ui,mt);if(Si&&(kt[Fe]={...Si,...ti(dd.validate,Si.message)},!D))return Tt(Si.message),kt}else if(Ba(Le)){let ui={};for(const Si in Le){if(!wo(ui)&&!D)break;const di=K2(await Le[Si](tt,S),mt,Si);di&&(ui={...di,...ti(Si,di.message)},Tt(di.message),D&&(kt[Fe]=ui))}if(!wo(ui)&&(kt[Fe]={ref:mt,...ui},!D))return kt}}return Tt(!0),kt};const cD={mode:hu.onSubmit,reValidateMode:hu.onChange,shouldFocusError:!0};function uD(m={}){let v={...cD,...m},S={submitCount:0,isDirty:!1,isLoading:du(v.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:v.errors||{},disabled:v.disabled||!1};const D={};let O=Ba(v.defaultValues)||Ba(v.values)?Ps(v.values||v.defaultValues)||{}:{},F=v.shouldUnregister?{}:Ps(O),X={action:!1,mount:!1,watch:!1},r={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},re,J=0;const oe={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let ze={...oe};const je={array:j2(),state:j2()},ft=$2(v.mode),Le=$2(v.reValidateMode),Fe=v.criteriaMode===hu.all,qe=Qe=>Mt=>{clearTimeout(J),J=setTimeout(Qe,Mt)},He=async Qe=>{if(!v.disabled&&(oe.isValid||ze.isValid||Qe)){const Mt=v.resolver?wo((await Mi()).errors):await Rt(D,!0);Mt!==S.isValid&&je.state.next({isValid:Mt})}},tt=(Qe,Mt)=>{!v.disabled&&(oe.isValidating||oe.validatingFields||ze.isValidating||ze.validatingFields)&&((Qe||Array.from(r.mount)).forEach(vt=>{vt&&(Mt?Ar(S.validatingFields,vt,Mt):cs(S.validatingFields,vt))}),je.state.next({validatingFields:S.validatingFields,isValidating:!wo(S.validatingFields)}))},mt=(Qe,Mt=[],vt,bi,gi=!0,ri=!0)=>{if(bi&&vt&&!v.disabled){if(X.action=!0,ri&&Array.isArray(Pi(D,Qe))){const vi=vt(Pi(D,Qe),bi.argA,bi.argB);gi&&Ar(D,Qe,vi)}if(ri&&Array.isArray(Pi(S.errors,Qe))){const vi=vt(Pi(S.errors,Qe),bi.argA,bi.argB);gi&&Ar(S.errors,Qe,vi),oD(S.errors,Qe)}if((oe.touchedFields||ze.touchedFields)&&ri&&Array.isArray(Pi(S.touchedFields,Qe))){const vi=vt(Pi(S.touchedFields,Qe),bi.argA,bi.argB);gi&&Ar(S.touchedFields,Qe,vi)}(oe.dirtyFields||ze.dirtyFields)&&(S.dirtyFields=jg(O,F)),je.state.next({name:Qe,isDirty:Si(Qe,Mt),dirtyFields:S.dirtyFields,errors:S.errors,isValid:S.isValid})}else Ar(F,Qe,Mt)},Tt=(Qe,Mt)=>{Ar(S.errors,Qe,Mt),je.state.next({errors:S.errors})},kt=Qe=>{S.errors=Qe,je.state.next({errors:S.errors,isValid:!1})},At=(Qe,Mt,vt,bi)=>{const gi=Pi(D,Qe);if(gi){const ri=Pi(F,Qe,ka(vt)?Pi(O,Qe):vt);ka(ri)||bi&&bi.defaultChecked||Mt?Ar(F,Qe,Mt?ri:Z2(gi._f)):pt(Qe,ri),X.mount&&He()}},ot=(Qe,Mt,vt,bi,gi)=>{let ri=!1,vi=!1;const sn={name:Qe};if(!v.disabled){if(!vt||bi){(oe.isDirty||ze.isDirty)&&(vi=S.isDirty,S.isDirty=sn.isDirty=Si(),ri=vi!==sn.isDirty);const or=Gf(Pi(O,Qe),Mt);vi=!!Pi(S.dirtyFields,Qe),or?cs(S.dirtyFields,Qe):Ar(S.dirtyFields,Qe,!0),sn.dirtyFields=S.dirtyFields,ri=ri||(oe.dirtyFields||ze.dirtyFields)&&vi!==!or}if(vt){const or=Pi(S.touchedFields,Qe);or||(Ar(S.touchedFields,Qe,vt),sn.touchedFields=S.touchedFields,ri=ri||(oe.touchedFields||ze.touchedFields)&&or!==vt)}ri&&gi&&je.state.next(sn)}return ri?sn:{}},hi=(Qe,Mt,vt,bi)=>{const gi=Pi(S.errors,Qe),ri=(oe.isValid||ze.isValid)&&ml(Mt)&&S.isValid!==Mt;if(v.delayError&&vt?(re=qe(()=>Tt(Qe,vt)),re(v.delayError)):(clearTimeout(J),re=null,vt?Ar(S.errors,Qe,vt):cs(S.errors,Qe)),(vt?!Gf(gi,vt):gi)||!wo(bi)||ri){const vi={...bi,...ri&&ml(Mt)?{isValid:Mt}:{},errors:S.errors,name:Qe};S={...S,...vi},je.state.next(vi)}},Mi=async Qe=>{tt(Qe,!0);const Mt=await v.resolver(F,v.context,tD(Qe||r.mount,D,v.criteriaMode,v.shouldUseNativeValidation));return tt(Qe),Mt},ti=async Qe=>{const{errors:Mt}=await Mi(Qe);if(Qe)for(const vt of Qe){const bi=Pi(Mt,vt);bi?Ar(S.errors,vt,bi):cs(S.errors,vt)}else S.errors=Mt;return Mt},Rt=async(Qe,Mt,vt={valid:!0})=>{for(const bi in Qe){const gi=Qe[bi];if(gi){const{_f:ri,...vi}=gi;if(ri){const sn=r.array.has(ri.name),or=gi._f&&iD(gi._f);or&&oe.validatingFields&&tt([bi],!0);const Gr=await J2(gi,r.disabled,F,Fe,v.shouldUseNativeValidation&&!Mt,sn);if(or&&oe.validatingFields&&tt([bi]),Gr[ri.name]&&(vt.valid=!1,Mt))break;!Mt&&(Pi(Gr,ri.name)?sn?lD(S.errors,Gr,ri.name):Ar(S.errors,ri.name,Gr[ri.name]):cs(S.errors,ri.name))}!wo(vi)&&await Rt(vi,Mt,vt)}}return vt.valid},ui=()=>{for(const Qe of r.unMount){const Mt=Pi(D,Qe);Mt&&(Mt._f.refs?Mt._f.refs.every(vt=>!Vx(vt)):!Vx(Mt._f.ref))&&Aa(Qe)}r.unMount=new Set},Si=(Qe,Mt)=>!v.disabled&&(Qe&&Mt&&Ar(F,Qe,Mt),!Gf(Ei(),O)),di=(Qe,Mt,vt)=>vS(Qe,r,{...X.mount?F:ka(Mt)?O:lh(Qe)?{[Qe]:Mt}:Mt},vt,Mt),ii=Qe=>v0(Pi(X.mount?F:O,Qe,v.shouldUnregister?Pi(O,Qe,[]):[])),pt=(Qe,Mt,vt={})=>{const bi=Pi(D,Qe);let gi=Mt;if(bi){const ri=bi._f;ri&&(!ri.disabled&&Ar(F,Qe,ES(Mt,ri)),gi=Kv(ri.ref)&&To(Mt)?"":Mt,bS(ri.ref)?[...ri.ref.options].forEach(vi=>vi.selected=gi.includes(vi.value)):ri.refs?vy(ri.ref)?ri.refs.length>1?ri.refs.forEach(vi=>(!vi.defaultChecked||!vi.disabled)&&(vi.checked=Array.isArray(gi)?!!gi.find(sn=>sn===vi.value):gi===vi.value)):ri.refs[0]&&(ri.refs[0].checked=!!gi):ri.refs.forEach(vi=>vi.checked=vi.value===gi):P1(ri.ref)?ri.ref.value="":(ri.ref.value=gi,ri.ref.type||je.state.next({name:Qe,values:Ps(F)})))}(vt.shouldDirty||vt.shouldTouch)&&ot(Qe,gi,vt.shouldTouch,vt.shouldDirty,!0),vt.shouldValidate&&Jt(Qe)},ni=(Qe,Mt,vt)=>{for(const bi in Mt){const gi=Mt[bi],ri=`${Qe}.${bi}`,vi=Pi(D,ri);(r.array.has(Qe)||Ba(gi)||vi&&!vi._f)&&!Wp(gi)?ni(ri,gi,vt):pt(ri,gi,vt)}},pi=(Qe,Mt,vt={})=>{const bi=Pi(D,Qe),gi=r.array.has(Qe),ri=Ps(Mt);Ar(F,Qe,ri),gi?(je.array.next({name:Qe,values:Ps(F)}),(oe.isDirty||oe.dirtyFields||ze.isDirty||ze.dirtyFields)&&vt.shouldDirty&&je.state.next({name:Qe,dirtyFields:jg(O,F),isDirty:Si(Qe,ri)})):bi&&!bi._f&&!To(ri)?ni(Qe,ri,vt):pt(Qe,ri,vt),Y2(Qe,r)&&je.state.next({...S}),je.state.next({name:X.mount?Qe:void 0,values:Ps(F)})},ai=async Qe=>{X.mount=!0;const Mt=Qe.target;let vt=Mt.name,bi=!0;const gi=Pi(D,vt),ri=vi=>{bi=Number.isNaN(vi)||Wp(vi)&&isNaN(vi.getTime())||Gf(vi,Pi(F,vt,vi))};if(gi){let vi,sn;const or=Mt.type?Z2(gi._f):pS(Qe),Gr=Qe.type===Wv.BLUR||Qe.type===Wv.FOCUS_OUT,hc=!nD(gi._f)&&!v.resolver&&!Pi(S.errors,vt)&&!gi._f.deps||sD(Gr,Pi(S.touchedFields,vt),S.isSubmitted,Le,ft),hs=Y2(vt,r,Gr);Ar(F,vt,or),Gr?(gi._f.onBlur&&gi._f.onBlur(Qe),re&&re(0)):gi._f.onChange&&gi._f.onChange(Qe);const ds=ot(vt,or,Gr),Wr=!wo(ds)||hs;if(!Gr&&je.state.next({name:vt,type:Qe.type,values:Ps(F)}),hc)return(oe.isValid||ze.isValid)&&(v.mode==="onBlur"?Gr&&He():Gr||He()),Wr&&je.state.next({name:vt,...hs?{}:ds});if(!Gr&&hs&&je.state.next({...S}),v.resolver){const{errors:Ns}=await Mi([vt]);if(ri(or),bi){const Kn=W2(S.errors,D,vt),Nn=W2(Ns,D,Kn.name||vt);vi=Nn.error,vt=Nn.name,sn=wo(Ns)}}else tt([vt],!0),vi=(await J2(gi,r.disabled,F,Fe,v.shouldUseNativeValidation))[vt],tt([vt]),ri(or),bi&&(vi?sn=!1:(oe.isValid||ze.isValid)&&(sn=await Rt(D,!0)));bi&&(gi._f.deps&&Jt(gi._f.deps),hi(vt,sn,vi,ds))}},We=(Qe,Mt)=>{if(Pi(S.errors,Mt)&&Qe.focus)return Qe.focus(),1},Jt=async(Qe,Mt={})=>{let vt,bi;const gi=Xg(Qe);if(v.resolver){const ri=await ti(ka(Qe)?Qe:gi);vt=wo(ri),bi=Qe?!gi.some(vi=>Pi(ri,vi)):vt}else Qe?(bi=(await Promise.all(gi.map(async ri=>{const vi=Pi(D,ri);return await Rt(vi&&vi._f?{[ri]:vi}:vi)}))).every(Boolean),!(!bi&&!S.isValid)&&He()):bi=vt=await Rt(D);return je.state.next({...!lh(Qe)||(oe.isValid||ze.isValid)&&vt!==S.isValid?{}:{name:Qe},...v.resolver||!Qe?{isValid:vt}:{},errors:S.errors}),Mt.shouldFocus&&!bi&&Yg(D,We,Qe?gi:r.mount),bi},Ei=Qe=>{const Mt={...X.mount?F:O};return ka(Qe)?Mt:lh(Qe)?Pi(Mt,Qe):Qe.map(vt=>Pi(Mt,vt))},Ot=(Qe,Mt)=>({invalid:!!Pi((Mt||S).errors,Qe),isDirty:!!Pi((Mt||S).dirtyFields,Qe),error:Pi((Mt||S).errors,Qe),isValidating:!!Pi(S.validatingFields,Qe),isTouched:!!Pi((Mt||S).touchedFields,Qe)}),ji=Qe=>{Qe&&Xg(Qe).forEach(Mt=>cs(S.errors,Mt)),je.state.next({errors:Qe?S.errors:{}})},An=(Qe,Mt,vt)=>{const bi=(Pi(D,Qe,{_f:{}})._f||{}).ref,gi=Pi(S.errors,Qe)||{},{ref:ri,message:vi,type:sn,...or}=gi;Ar(S.errors,Qe,{...or,...Mt,ref:bi}),je.state.next({name:Qe,errors:S.errors,isValid:!1}),vt&&vt.shouldFocus&&bi&&bi.focus&&bi.focus()},Xi=(Qe,Mt)=>du(Qe)?je.state.subscribe({next:vt=>Qe(di(void 0,Mt),vt)}):di(Qe,Mt,!0),nr=Qe=>je.state.subscribe({next:Mt=>{aD(Qe.name,Mt.name,Qe.exact)&&rD(Mt,Qe.formState||oe,Br,Qe.reRenderRoot)&&Qe.callback({values:{...F},...S,...Mt})}}).unsubscribe,sr=Qe=>(X.mount=!0,ze={...ze,...Qe.formState},nr({...Qe,formState:ze})),Aa=(Qe,Mt={})=>{for(const vt of Qe?Xg(Qe):r.mount)r.mount.delete(vt),r.array.delete(vt),Mt.keepValue||(cs(D,vt),cs(F,vt)),!Mt.keepError&&cs(S.errors,vt),!Mt.keepDirty&&cs(S.dirtyFields,vt),!Mt.keepTouched&&cs(S.touchedFields,vt),!Mt.keepIsValidating&&cs(S.validatingFields,vt),!v.shouldUnregister&&!Mt.keepDefaultValue&&cs(O,vt);je.state.next({values:Ps(F)}),je.state.next({...S,...Mt.keepDirty?{isDirty:Si()}:{}}),!Mt.keepIsValid&&He()},de=({disabled:Qe,name:Mt})=>{(ml(Qe)&&X.mount||Qe||r.disabled.has(Mt))&&(Qe?r.disabled.add(Mt):r.disabled.delete(Mt))},us=(Qe,Mt={})=>{let vt=Pi(D,Qe);const bi=ml(Mt.disabled)||ml(v.disabled);return Ar(D,Qe,{...vt||{},_f:{...vt&&vt._f?vt._f:{ref:{name:Qe}},name:Qe,mount:!0,...Mt}}),r.mount.add(Qe),vt?de({disabled:ml(Mt.disabled)?Mt.disabled:v.disabled,name:Qe}):At(Qe,!0,Mt.value),{...bi?{disabled:Mt.disabled||v.disabled}:{},...v.progressive?{required:!!Mt.required,min:qg(Mt.min),max:qg(Mt.max),minLength:qg(Mt.minLength),maxLength:qg(Mt.maxLength),pattern:qg(Mt.pattern)}:{},name:Qe,onChange:ai,onBlur:ai,ref:gi=>{if(gi){us(Qe,Mt),vt=Pi(D,Qe);const ri=ka(gi.value)&&gi.querySelectorAll&&gi.querySelectorAll("input,select,textarea")[0]||gi,vi=JR(ri),sn=vt._f.refs||[];if(vi?sn.find(or=>or===ri):ri===vt._f.ref)return;Ar(D,Qe,{_f:{...vt._f,...vi?{refs:[...sn.filter(Vx),ri,...Array.isArray(Pi(O,Qe))?[{}]:[]],ref:{type:ri.type,name:Qe}}:{ref:ri}}}),At(Qe,!1,void 0,ri)}else vt=Pi(D,Qe,{}),vt._f&&(vt._f.mount=!1),(v.shouldUnregister||Mt.shouldUnregister)&&!(mS(r.array,Qe)&&X.action)&&r.unMount.add(Qe)}}},Ts=()=>v.shouldFocusError&&Yg(D,We,r.mount),ks=Qe=>{ml(Qe)&&(je.state.next({disabled:Qe}),Yg(D,(Mt,vt)=>{const bi=Pi(D,vt);bi&&(Mt.disabled=bi._f.disabled||Qe,Array.isArray(bi._f.refs)&&bi._f.refs.forEach(gi=>{gi.disabled=bi._f.disabled||Qe}))},0,!1))},Ft=(Qe,Mt)=>async vt=>{let bi;vt&&(vt.preventDefault&&vt.preventDefault(),vt.persist&&vt.persist());let gi=Ps(F);if(je.state.next({isSubmitting:!0}),v.resolver){const{errors:ri,values:vi}=await Mi();S.errors=ri,gi=vi}else await Rt(D);if(r.disabled.size)for(const ri of r.disabled)Ar(gi,ri,void 0);if(cs(S.errors,"root"),wo(S.errors)){je.state.next({errors:{}});try{await Qe(gi,vt)}catch(ri){bi=ri}}else Mt&&await Mt({...S.errors},vt),Ts(),setTimeout(Ts);if(je.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:wo(S.errors)&&!bi,submitCount:S.submitCount+1,errors:S.errors}),bi)throw bi},Ss=(Qe,Mt={})=>{Pi(D,Qe)&&(ka(Mt.defaultValue)?pi(Qe,Ps(Pi(O,Qe))):(pi(Qe,Mt.defaultValue),Ar(O,Qe,Ps(Mt.defaultValue))),Mt.keepTouched||cs(S.touchedFields,Qe),Mt.keepDirty||(cs(S.dirtyFields,Qe),S.isDirty=Mt.defaultValue?Si(Qe,Ps(Pi(O,Qe))):Si()),Mt.keepError||(cs(S.errors,Qe),oe.isValid&&He()),je.state.next({...S}))},ya=(Qe,Mt={})=>{const vt=Qe?Ps(Qe):O,bi=Ps(vt),gi=wo(Qe),ri=gi?O:bi;if(Mt.keepDefaultValues||(O=vt),!Mt.keepValues){if(Mt.keepDirtyValues){const vi=new Set([...r.mount,...Object.keys(jg(O,F))]);for(const sn of Array.from(vi))Pi(S.dirtyFields,sn)?Ar(ri,sn,Pi(F,sn)):pi(sn,Pi(ri,sn))}else{if(L1&&ka(Qe))for(const vi of r.mount){const sn=Pi(D,vi);if(sn&&sn._f){const or=Array.isArray(sn._f.refs)?sn._f.refs[0]:sn._f.ref;if(Kv(or)){const Gr=or.closest("form");if(Gr){Gr.reset();break}}}}for(const vi of r.mount)pi(vi,Pi(ri,vi))}F=Ps(ri),je.array.next({values:{...ri}}),je.state.next({values:{...ri}})}r={mount:Mt.keepDirtyValues?r.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},X.mount=!oe.isValid||!!Mt.keepIsValid||!!Mt.keepDirtyValues,X.watch=!!v.shouldUnregister,je.state.next({submitCount:Mt.keepSubmitCount?S.submitCount:0,isDirty:gi?!1:Mt.keepDirty?S.isDirty:!!(Mt.keepDefaultValues&&!Gf(Qe,O)),isSubmitted:Mt.keepIsSubmitted?S.isSubmitted:!1,dirtyFields:gi?{}:Mt.keepDirtyValues?Mt.keepDefaultValues&&F?jg(O,F):S.dirtyFields:Mt.keepDefaultValues&&Qe?jg(O,Qe):Mt.keepDirty?S.dirtyFields:{},touchedFields:Mt.keepTouched?S.touchedFields:{},errors:Mt.keepErrors?S.errors:{},isSubmitSuccessful:Mt.keepIsSubmitSuccessful?S.isSubmitSuccessful:!1,isSubmitting:!1})},qr=(Qe,Mt)=>ya(du(Qe)?Qe(F):Qe,Mt),ln=(Qe,Mt={})=>{const vt=Pi(D,Qe),bi=vt&&vt._f;if(bi){const gi=bi.refs?bi.refs[0]:bi.ref;gi.focus&&(gi.focus(),Mt.shouldSelect&&du(gi.select)&&gi.select())}},Br=Qe=>{S={...S,...Qe}},Es={control:{register:us,unregister:Aa,getFieldState:Ot,handleSubmit:Ft,setError:An,_subscribe:nr,_runSchema:Mi,_getWatch:di,_getDirty:Si,_setValid:He,_setFieldArray:mt,_setDisabledField:de,_setErrors:kt,_getFieldArray:ii,_reset:ya,_resetDefaultValues:()=>du(v.defaultValues)&&v.defaultValues().then(Qe=>{qr(Qe,v.resetOptions),je.state.next({isLoading:!1})}),_removeUnmounted:ui,_disableForm:ks,_subjects:je,_proxyFormState:oe,get _fields(){return D},get _formValues(){return F},get _state(){return X},set _state(Qe){X=Qe},get _defaultValues(){return O},get _names(){return r},set _names(Qe){r=Qe},get _formState(){return S},get _options(){return v},set _options(Qe){v={...v,...Qe}}},subscribe:sr,trigger:Jt,register:us,handleSubmit:Ft,watch:Xi,setValue:pi,getValues:Ei,reset:qr,resetField:Ss,clearErrors:ji,unregister:Aa,setError:An,setFocus:ln,getFieldState:Ot};return{...Es,formControl:Es}}function MS(m={}){const v=Zi.useRef(void 0),S=Zi.useRef(void 0),[D,O]=Zi.useState({isDirty:!1,isValidating:!1,isLoading:du(m.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:m.errors||{},disabled:m.disabled||!1,defaultValues:du(m.defaultValues)?void 0:m.defaultValues});v.current||(v.current={...m.formControl?m.formControl:uD(m),formState:D},m.formControl&&m.defaultValues&&!du(m.defaultValues)&&m.formControl.reset(m.defaultValues,m.resetOptions));const F=v.current.control;return F._options=m,Zi.useLayoutEffect(()=>F._subscribe({formState:F._proxyFormState,callback:()=>O({...F._formState}),reRenderRoot:!0}),[F]),Zi.useEffect(()=>F._disableForm(m.disabled),[F,m.disabled]),Zi.useEffect(()=>{if(F._proxyFormState.isDirty){const X=F._getDirty();X!==D.isDirty&&F._subjects.state.next({isDirty:X})}},[F,D.isDirty]),Zi.useEffect(()=>{m.values&&!Gf(m.values,S.current)?(F._reset(m.values,F._options.resetOptions),S.current=m.values,O(X=>({...X}))):F._resetDefaultValues()},[m.values,F]),Zi.useEffect(()=>{m.errors&&!wo(m.errors)&&F._setErrors(m.errors)},[m.errors,F]),Zi.useEffect(()=>{F._state.mount||(F._setValid(),F._state.mount=!0),F._state.watch&&(F._state.watch=!1,F._subjects.state.next({...F._formState})),F._removeUnmounted()}),Zi.useEffect(()=>{m.shouldUnregister&&F._subjects.state.next({values:F._getWatch()})},[m.shouldUnregister,F]),v.current.formState=yS(D,F),v.current}const Q2=(m,v,S)=>{if(m&&"reportValidity"in m){const D=Pi(S,v);m.setCustomValidity(D&&D.message||""),m.reportValidity()}},CS=(m,v)=>{for(const S in v.fields){const D=v.fields[S];D&&D.ref&&"reportValidity"in D.ref?Q2(D.ref,S,m):D&&D.refs&&D.refs.forEach(O=>Q2(O,S,m))}},hD=(m,v)=>{v.shouldUseNativeValidation&&CS(m,v);const S={};for(const D in m){const O=Pi(v.fields,D),F=Object.assign(m[D]||{},{ref:O&&O.ref});if(dD(v.names||Object.keys(m),D)){const X=Object.assign({},Pi(S,D));Ar(X,"root",F),Ar(S,D,X)}else Ar(S,D,F)}return S},dD=(m,v)=>{const S=eT(v);return m.some(D=>eT(D).match(`^${S}\\.\\d+`))};function eT(m){return m.replace(/\]|\[/g,"")}function fD(m,v){for(var S={};m.length;){var D=m[0],O=D.code,F=D.message,X=D.path.join(".");if(!S[X])if("unionErrors"in D){var r=D.unionErrors[0].errors[0];S[X]={message:r.message,type:r.code}}else S[X]={message:F,type:O};if("unionErrors"in D&&D.unionErrors.forEach(function(oe){return oe.errors.forEach(function(ze){return m.push(ze)})}),v){var re=S[X].types,J=re&&re[D.code];S[X]=xS(X,v,S,O,J?[].concat(J,D.message):D.message)}m.shift()}return S}function IS(m,v,S){return S===void 0&&(S={}),function(D,O,F){try{return Promise.resolve(function(X,r){try{var re=Promise.resolve(m[S.mode==="sync"?"parse":"parseAsync"](D,v)).then(function(J){return F.shouldUseNativeValidation&&CS({},F),{errors:{},values:S.raw?Object.assign({},D):J}})}catch(J){return r(J)}return re&&re.then?re.then(void 0,r):re}(0,function(X){if(function(r){return Array.isArray(r==null?void 0:r.errors)}(X))return{values:{},errors:hD(fD(X.errors,!F.shouldUseNativeValidation&&F.criteriaMode==="all"),F)};throw X}))}catch(X){return Promise.reject(X)}}}var dr;(function(m){m.assertEqual=O=>O;function v(O){}m.assertIs=v;function S(O){throw new Error}m.assertNever=S,m.arrayToEnum=O=>{const F={};for(const X of O)F[X]=X;return F},m.getValidEnumValues=O=>{const F=m.objectKeys(O).filter(r=>typeof O[O[r]]!="number"),X={};for(const r of F)X[r]=O[r];return m.objectValues(X)},m.objectValues=O=>m.objectKeys(O).map(function(F){return O[F]}),m.objectKeys=typeof Object.keys=="function"?O=>Object.keys(O):O=>{const F=[];for(const X in O)Object.prototype.hasOwnProperty.call(O,X)&&F.push(X);return F},m.find=(O,F)=>{for(const X of O)if(F(X))return X},m.isInteger=typeof Number.isInteger=="function"?O=>Number.isInteger(O):O=>typeof O=="number"&&isFinite(O)&&Math.floor(O)===O;function D(O,F=" | "){return O.map(X=>typeof X=="string"?`'${X}'`:X).join(F)}m.joinValues=D,m.jsonStringifyReplacer=(O,F)=>typeof F=="bigint"?F.toString():F})(dr||(dr={}));var s1;(function(m){m.mergeShapes=(v,S)=>({...v,...S})})(s1||(s1={}));const Ui=dr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),pd=m=>{switch(typeof m){case"undefined":return Ui.undefined;case"string":return Ui.string;case"number":return isNaN(m)?Ui.nan:Ui.number;case"boolean":return Ui.boolean;case"function":return Ui.function;case"bigint":return Ui.bigint;case"symbol":return Ui.symbol;case"object":return Array.isArray(m)?Ui.array:m===null?Ui.null:m.then&&typeof m.then=="function"&&m.catch&&typeof m.catch=="function"?Ui.promise:typeof Map<"u"&&m instanceof Map?Ui.map:typeof Set<"u"&&m instanceof Set?Ui.set:typeof Date<"u"&&m instanceof Date?Ui.date:Ui.object;default:return Ui.unknown}},fi=dr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pD=m=>JSON.stringify(m,null,2).replace(/"([^"]+)":/g,"$1:");class yl extends Error{get errors(){return this.issues}constructor(v){super(),this.issues=[],this.addIssue=D=>{this.issues=[...this.issues,D]},this.addIssues=(D=[])=>{this.issues=[...this.issues,...D]};const S=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,S):this.__proto__=S,this.name="ZodError",this.issues=v}format(v){const S=v||function(F){return F.message},D={_errors:[]},O=F=>{for(const X of F.issues)if(X.code==="invalid_union")X.unionErrors.map(O);else if(X.code==="invalid_return_type")O(X.returnTypeError);else if(X.code==="invalid_arguments")O(X.argumentsError);else if(X.path.length===0)D._errors.push(S(X));else{let r=D,re=0;for(;re<X.path.length;){const J=X.path[re];re===X.path.length-1?(r[J]=r[J]||{_errors:[]},r[J]._errors.push(S(X))):r[J]=r[J]||{_errors:[]},r=r[J],re++}}};return O(this),D}static assert(v){if(!(v instanceof yl))throw new Error(`Not a ZodError: ${v}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,dr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(v=S=>S.message){const S={},D=[];for(const O of this.issues)O.path.length>0?(S[O.path[0]]=S[O.path[0]]||[],S[O.path[0]].push(v(O))):D.push(v(O));return{formErrors:D,fieldErrors:S}}get formErrors(){return this.flatten()}}yl.create=m=>new yl(m);const C_=(m,v)=>{let S;switch(m.code){case fi.invalid_type:m.received===Ui.undefined?S="Required":S=`Expected ${m.expected}, received ${m.received}`;break;case fi.invalid_literal:S=`Invalid literal value, expected ${JSON.stringify(m.expected,dr.jsonStringifyReplacer)}`;break;case fi.unrecognized_keys:S=`Unrecognized key(s) in object: ${dr.joinValues(m.keys,", ")}`;break;case fi.invalid_union:S="Invalid input";break;case fi.invalid_union_discriminator:S=`Invalid discriminator value. Expected ${dr.joinValues(m.options)}`;break;case fi.invalid_enum_value:S=`Invalid enum value. Expected ${dr.joinValues(m.options)}, received '${m.received}'`;break;case fi.invalid_arguments:S="Invalid function arguments";break;case fi.invalid_return_type:S="Invalid function return type";break;case fi.invalid_date:S="Invalid date";break;case fi.invalid_string:typeof m.validation=="object"?"includes"in m.validation?(S=`Invalid input: must include "${m.validation.includes}"`,typeof m.validation.position=="number"&&(S=`${S} at one or more positions greater than or equal to ${m.validation.position}`)):"startsWith"in m.validation?S=`Invalid input: must start with "${m.validation.startsWith}"`:"endsWith"in m.validation?S=`Invalid input: must end with "${m.validation.endsWith}"`:dr.assertNever(m.validation):m.validation!=="regex"?S=`Invalid ${m.validation}`:S="Invalid";break;case fi.too_small:m.type==="array"?S=`Array must contain ${m.exact?"exactly":m.inclusive?"at least":"more than"} ${m.minimum} element(s)`:m.type==="string"?S=`String must contain ${m.exact?"exactly":m.inclusive?"at least":"over"} ${m.minimum} character(s)`:m.type==="number"?S=`Number must be ${m.exact?"exactly equal to ":m.inclusive?"greater than or equal to ":"greater than "}${m.minimum}`:m.type==="date"?S=`Date must be ${m.exact?"exactly equal to ":m.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(m.minimum))}`:S="Invalid input";break;case fi.too_big:m.type==="array"?S=`Array must contain ${m.exact?"exactly":m.inclusive?"at most":"less than"} ${m.maximum} element(s)`:m.type==="string"?S=`String must contain ${m.exact?"exactly":m.inclusive?"at most":"under"} ${m.maximum} character(s)`:m.type==="number"?S=`Number must be ${m.exact?"exactly":m.inclusive?"less than or equal to":"less than"} ${m.maximum}`:m.type==="bigint"?S=`BigInt must be ${m.exact?"exactly":m.inclusive?"less than or equal to":"less than"} ${m.maximum}`:m.type==="date"?S=`Date must be ${m.exact?"exactly":m.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(m.maximum))}`:S="Invalid input";break;case fi.custom:S="Invalid input";break;case fi.invalid_intersection_types:S="Intersection results could not be merged";break;case fi.not_multiple_of:S=`Number must be a multiple of ${m.multipleOf}`;break;case fi.not_finite:S="Number must be finite";break;default:S=v.defaultError,dr.assertNever(m)}return{message:S}};let RS=C_;function mD(m){RS=m}function e0(){return RS}const t0=m=>{const{data:v,path:S,errorMaps:D,issueData:O}=m,F=[...S,...O.path||[]],X={...O,path:F};if(O.message!==void 0)return{...O,path:F,message:O.message};let r="";const re=D.filter(J=>!!J).slice().reverse();for(const J of re)r=J(X,{data:v,defaultError:r}).message;return{...O,path:F,message:r}},_D=[];function Bi(m,v){const S=e0(),D=t0({issueData:v,data:m.data,path:m.path,errorMaps:[m.common.contextualErrorMap,m.schemaErrorMap,S,S===C_?void 0:C_].filter(O=>!!O)});m.common.issues.push(D)}class ao{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(v,S){const D=[];for(const O of S){if(O.status==="aborted")return zn;O.status==="dirty"&&v.dirty(),D.push(O.value)}return{status:v.value,value:D}}static async mergeObjectAsync(v,S){const D=[];for(const O of S){const F=await O.key,X=await O.value;D.push({key:F,value:X})}return ao.mergeObjectSync(v,D)}static mergeObjectSync(v,S){const D={};for(const O of S){const{key:F,value:X}=O;if(F.status==="aborted"||X.status==="aborted")return zn;F.status==="dirty"&&v.dirty(),X.status==="dirty"&&v.dirty(),F.value!=="__proto__"&&(typeof X.value<"u"||O.alwaysSet)&&(D[F.value]=X.value)}return{status:v.value,value:D}}}const zn=Object.freeze({status:"aborted"}),A_=m=>({status:"dirty",value:m}),Ao=m=>({status:"valid",value:m}),o1=m=>m.status==="aborted",l1=m=>m.status==="dirty",tm=m=>m.status==="valid",ey=m=>typeof Promise<"u"&&m instanceof Promise;function i0(m,v,S,D){if(typeof v=="function"?m!==v||!0:!v.has(m))throw new TypeError("Cannot read private member from an object whose class did not declare it");return v.get(m)}function DS(m,v,S,D,O){if(typeof v=="function"?m!==v||!0:!v.has(m))throw new TypeError("Cannot write private member to an object whose class did not declare it");return v.set(m,S),S}var nn;(function(m){m.errToObj=v=>typeof v=="string"?{message:v}:v||{},m.toString=v=>typeof v=="string"?v:v==null?void 0:v.message})(nn||(nn={}));var Zg,$g;class uh{constructor(v,S,D,O){this._cachedPath=[],this.parent=v,this.data=S,this._path=D,this._key=O}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const tT=(m,v)=>{if(tm(v))return{success:!0,data:v.value};if(!m.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const S=new yl(m.common.issues);return this._error=S,this._error}}};function Gn(m){if(!m)return{};const{errorMap:v,invalid_type_error:S,required_error:D,description:O}=m;if(v&&(S||D))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return v?{errorMap:v,description:O}:{errorMap:(X,r)=>{var re,J;const{message:oe}=m;return X.code==="invalid_enum_value"?{message:oe??r.defaultError}:typeof r.data>"u"?{message:(re=oe??D)!==null&&re!==void 0?re:r.defaultError}:X.code!=="invalid_type"?{message:r.defaultError}:{message:(J=oe??S)!==null&&J!==void 0?J:r.defaultError}},description:O}}class Wn{get description(){return this._def.description}_getType(v){return pd(v.data)}_getOrReturnCtx(v,S){return S||{common:v.parent.common,data:v.data,parsedType:pd(v.data),schemaErrorMap:this._def.errorMap,path:v.path,parent:v.parent}}_processInputParams(v){return{status:new ao,ctx:{common:v.parent.common,data:v.data,parsedType:pd(v.data),schemaErrorMap:this._def.errorMap,path:v.path,parent:v.parent}}}_parseSync(v){const S=this._parse(v);if(ey(S))throw new Error("Synchronous parse encountered promise.");return S}_parseAsync(v){const S=this._parse(v);return Promise.resolve(S)}parse(v,S){const D=this.safeParse(v,S);if(D.success)return D.data;throw D.error}safeParse(v,S){var D;const O={common:{issues:[],async:(D=S==null?void 0:S.async)!==null&&D!==void 0?D:!1,contextualErrorMap:S==null?void 0:S.errorMap},path:(S==null?void 0:S.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:v,parsedType:pd(v)},F=this._parseSync({data:v,path:O.path,parent:O});return tT(O,F)}"~validate"(v){var S,D;const O={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:v,parsedType:pd(v)};if(!this["~standard"].async)try{const F=this._parseSync({data:v,path:[],parent:O});return tm(F)?{value:F.value}:{issues:O.common.issues}}catch(F){!((D=(S=F==null?void 0:F.message)===null||S===void 0?void 0:S.toLowerCase())===null||D===void 0)&&D.includes("encountered")&&(this["~standard"].async=!0),O.common={issues:[],async:!0}}return this._parseAsync({data:v,path:[],parent:O}).then(F=>tm(F)?{value:F.value}:{issues:O.common.issues})}async parseAsync(v,S){const D=await this.safeParseAsync(v,S);if(D.success)return D.data;throw D.error}async safeParseAsync(v,S){const D={common:{issues:[],contextualErrorMap:S==null?void 0:S.errorMap,async:!0},path:(S==null?void 0:S.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:v,parsedType:pd(v)},O=this._parse({data:v,path:D.path,parent:D}),F=await(ey(O)?O:Promise.resolve(O));return tT(D,F)}refine(v,S){const D=O=>typeof S=="string"||typeof S>"u"?{message:S}:typeof S=="function"?S(O):S;return this._refinement((O,F)=>{const X=v(O),r=()=>F.addIssue({code:fi.custom,...D(O)});return typeof Promise<"u"&&X instanceof Promise?X.then(re=>re?!0:(r(),!1)):X?!0:(r(),!1)})}refinement(v,S){return this._refinement((D,O)=>v(D)?!0:(O.addIssue(typeof S=="function"?S(D,O):S),!1))}_refinement(v){return new _u({schema:this,typeName:In.ZodEffects,effect:{type:"refinement",refinement:v}})}superRefine(v){return this._refinement(v)}constructor(v){this.spa=this.safeParseAsync,this._def=v,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:S=>this["~validate"](S)}}optional(){return ch.create(this,this._def)}nullable(){return Yf.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return pu.create(this)}promise(){return R_.create(this,this._def)}or(v){return ry.create([this,v],this._def)}and(v){return ay.create(this,v,this._def)}transform(v){return new _u({...Gn(this._def),schema:this,typeName:In.ZodEffects,effect:{type:"transform",transform:v}})}default(v){const S=typeof v=="function"?v:()=>v;return new uy({...Gn(this._def),innerType:this,defaultValue:S,typeName:In.ZodDefault})}brand(){return new B1({typeName:In.ZodBranded,type:this,...Gn(this._def)})}catch(v){const S=typeof v=="function"?v:()=>v;return new hy({...Gn(this._def),innerType:this,catchValue:S,typeName:In.ZodCatch})}describe(v){const S=this.constructor;return new S({...this._def,description:v})}pipe(v){return xy.create(this,v)}readonly(){return dy.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const gD=/^c[^\s-]{8,}$/i,yD=/^[0-9a-z]+$/,vD=/^[0-9A-HJKMNP-TV-Z]{26}$/i,xD=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bD=/^[a-z0-9_-]{21}$/i,wD=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,TD=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,SD=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ED="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ux;const AD=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,MD=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,CD=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ID=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,RD=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,DD=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,zS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",zD=new RegExp(`^${zS}$`);function LS(m){let v="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return m.precision?v=`${v}\\.\\d{${m.precision}}`:m.precision==null&&(v=`${v}(\\.\\d+)?`),v}function LD(m){return new RegExp(`^${LS(m)}$`)}function OS(m){let v=`${zS}T${LS(m)}`;const S=[];return S.push(m.local?"Z?":"Z"),m.offset&&S.push("([+-]\\d{2}:?\\d{2})"),v=`${v}(${S.join("|")})`,new RegExp(`^${v}$`)}function OD(m,v){return!!((v==="v4"||!v)&&AD.test(m)||(v==="v6"||!v)&&CD.test(m))}function PD(m,v){if(!wD.test(m))return!1;try{const[S]=m.split("."),D=S.replace(/-/g,"+").replace(/_/g,"/").padEnd(S.length+(4-S.length%4)%4,"="),O=JSON.parse(atob(D));return!(typeof O!="object"||O===null||!O.typ||!O.alg||v&&O.alg!==v)}catch{return!1}}function kD(m,v){return!!((v==="v4"||!v)&&MD.test(m)||(v==="v6"||!v)&&ID.test(m))}class fu extends Wn{_parse(v){if(this._def.coerce&&(v.data=String(v.data)),this._getType(v)!==Ui.string){const F=this._getOrReturnCtx(v);return Bi(F,{code:fi.invalid_type,expected:Ui.string,received:F.parsedType}),zn}const D=new ao;let O;for(const F of this._def.checks)if(F.kind==="min")v.data.length<F.value&&(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.too_small,minimum:F.value,type:"string",inclusive:!0,exact:!1,message:F.message}),D.dirty());else if(F.kind==="max")v.data.length>F.value&&(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.too_big,maximum:F.value,type:"string",inclusive:!0,exact:!1,message:F.message}),D.dirty());else if(F.kind==="length"){const X=v.data.length>F.value,r=v.data.length<F.value;(X||r)&&(O=this._getOrReturnCtx(v,O),X?Bi(O,{code:fi.too_big,maximum:F.value,type:"string",inclusive:!0,exact:!0,message:F.message}):r&&Bi(O,{code:fi.too_small,minimum:F.value,type:"string",inclusive:!0,exact:!0,message:F.message}),D.dirty())}else if(F.kind==="email")SD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"email",code:fi.invalid_string,message:F.message}),D.dirty());else if(F.kind==="emoji")Ux||(Ux=new RegExp(ED,"u")),Ux.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"emoji",code:fi.invalid_string,message:F.message}),D.dirty());else if(F.kind==="uuid")xD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"uuid",code:fi.invalid_string,message:F.message}),D.dirty());else if(F.kind==="nanoid")bD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"nanoid",code:fi.invalid_string,message:F.message}),D.dirty());else if(F.kind==="cuid")gD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"cuid",code:fi.invalid_string,message:F.message}),D.dirty());else if(F.kind==="cuid2")yD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"cuid2",code:fi.invalid_string,message:F.message}),D.dirty());else if(F.kind==="ulid")vD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"ulid",code:fi.invalid_string,message:F.message}),D.dirty());else if(F.kind==="url")try{new URL(v.data)}catch{O=this._getOrReturnCtx(v,O),Bi(O,{validation:"url",code:fi.invalid_string,message:F.message}),D.dirty()}else F.kind==="regex"?(F.regex.lastIndex=0,F.regex.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"regex",code:fi.invalid_string,message:F.message}),D.dirty())):F.kind==="trim"?v.data=v.data.trim():F.kind==="includes"?v.data.includes(F.value,F.position)||(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.invalid_string,validation:{includes:F.value,position:F.position},message:F.message}),D.dirty()):F.kind==="toLowerCase"?v.data=v.data.toLowerCase():F.kind==="toUpperCase"?v.data=v.data.toUpperCase():F.kind==="startsWith"?v.data.startsWith(F.value)||(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.invalid_string,validation:{startsWith:F.value},message:F.message}),D.dirty()):F.kind==="endsWith"?v.data.endsWith(F.value)||(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.invalid_string,validation:{endsWith:F.value},message:F.message}),D.dirty()):F.kind==="datetime"?OS(F).test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.invalid_string,validation:"datetime",message:F.message}),D.dirty()):F.kind==="date"?zD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.invalid_string,validation:"date",message:F.message}),D.dirty()):F.kind==="time"?LD(F).test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.invalid_string,validation:"time",message:F.message}),D.dirty()):F.kind==="duration"?TD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"duration",code:fi.invalid_string,message:F.message}),D.dirty()):F.kind==="ip"?OD(v.data,F.version)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"ip",code:fi.invalid_string,message:F.message}),D.dirty()):F.kind==="jwt"?PD(v.data,F.alg)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"jwt",code:fi.invalid_string,message:F.message}),D.dirty()):F.kind==="cidr"?kD(v.data,F.version)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"cidr",code:fi.invalid_string,message:F.message}),D.dirty()):F.kind==="base64"?RD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"base64",code:fi.invalid_string,message:F.message}),D.dirty()):F.kind==="base64url"?DD.test(v.data)||(O=this._getOrReturnCtx(v,O),Bi(O,{validation:"base64url",code:fi.invalid_string,message:F.message}),D.dirty()):dr.assertNever(F);return{status:D.value,value:v.data}}_regex(v,S,D){return this.refinement(O=>v.test(O),{validation:S,code:fi.invalid_string,...nn.errToObj(D)})}_addCheck(v){return new fu({...this._def,checks:[...this._def.checks,v]})}email(v){return this._addCheck({kind:"email",...nn.errToObj(v)})}url(v){return this._addCheck({kind:"url",...nn.errToObj(v)})}emoji(v){return this._addCheck({kind:"emoji",...nn.errToObj(v)})}uuid(v){return this._addCheck({kind:"uuid",...nn.errToObj(v)})}nanoid(v){return this._addCheck({kind:"nanoid",...nn.errToObj(v)})}cuid(v){return this._addCheck({kind:"cuid",...nn.errToObj(v)})}cuid2(v){return this._addCheck({kind:"cuid2",...nn.errToObj(v)})}ulid(v){return this._addCheck({kind:"ulid",...nn.errToObj(v)})}base64(v){return this._addCheck({kind:"base64",...nn.errToObj(v)})}base64url(v){return this._addCheck({kind:"base64url",...nn.errToObj(v)})}jwt(v){return this._addCheck({kind:"jwt",...nn.errToObj(v)})}ip(v){return this._addCheck({kind:"ip",...nn.errToObj(v)})}cidr(v){return this._addCheck({kind:"cidr",...nn.errToObj(v)})}datetime(v){var S,D;return typeof v=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:v}):this._addCheck({kind:"datetime",precision:typeof(v==null?void 0:v.precision)>"u"?null:v==null?void 0:v.precision,offset:(S=v==null?void 0:v.offset)!==null&&S!==void 0?S:!1,local:(D=v==null?void 0:v.local)!==null&&D!==void 0?D:!1,...nn.errToObj(v==null?void 0:v.message)})}date(v){return this._addCheck({kind:"date",message:v})}time(v){return typeof v=="string"?this._addCheck({kind:"time",precision:null,message:v}):this._addCheck({kind:"time",precision:typeof(v==null?void 0:v.precision)>"u"?null:v==null?void 0:v.precision,...nn.errToObj(v==null?void 0:v.message)})}duration(v){return this._addCheck({kind:"duration",...nn.errToObj(v)})}regex(v,S){return this._addCheck({kind:"regex",regex:v,...nn.errToObj(S)})}includes(v,S){return this._addCheck({kind:"includes",value:v,position:S==null?void 0:S.position,...nn.errToObj(S==null?void 0:S.message)})}startsWith(v,S){return this._addCheck({kind:"startsWith",value:v,...nn.errToObj(S)})}endsWith(v,S){return this._addCheck({kind:"endsWith",value:v,...nn.errToObj(S)})}min(v,S){return this._addCheck({kind:"min",value:v,...nn.errToObj(S)})}max(v,S){return this._addCheck({kind:"max",value:v,...nn.errToObj(S)})}length(v,S){return this._addCheck({kind:"length",value:v,...nn.errToObj(S)})}nonempty(v){return this.min(1,nn.errToObj(v))}trim(){return new fu({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new fu({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new fu({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(v=>v.kind==="datetime")}get isDate(){return!!this._def.checks.find(v=>v.kind==="date")}get isTime(){return!!this._def.checks.find(v=>v.kind==="time")}get isDuration(){return!!this._def.checks.find(v=>v.kind==="duration")}get isEmail(){return!!this._def.checks.find(v=>v.kind==="email")}get isURL(){return!!this._def.checks.find(v=>v.kind==="url")}get isEmoji(){return!!this._def.checks.find(v=>v.kind==="emoji")}get isUUID(){return!!this._def.checks.find(v=>v.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(v=>v.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(v=>v.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(v=>v.kind==="cuid2")}get isULID(){return!!this._def.checks.find(v=>v.kind==="ulid")}get isIP(){return!!this._def.checks.find(v=>v.kind==="ip")}get isCIDR(){return!!this._def.checks.find(v=>v.kind==="cidr")}get isBase64(){return!!this._def.checks.find(v=>v.kind==="base64")}get isBase64url(){return!!this._def.checks.find(v=>v.kind==="base64url")}get minLength(){let v=null;for(const S of this._def.checks)S.kind==="min"&&(v===null||S.value>v)&&(v=S.value);return v}get maxLength(){let v=null;for(const S of this._def.checks)S.kind==="max"&&(v===null||S.value<v)&&(v=S.value);return v}}fu.create=m=>{var v;return new fu({checks:[],typeName:In.ZodString,coerce:(v=m==null?void 0:m.coerce)!==null&&v!==void 0?v:!1,...Gn(m)})};function BD(m,v){const S=(m.toString().split(".")[1]||"").length,D=(v.toString().split(".")[1]||"").length,O=S>D?S:D,F=parseInt(m.toFixed(O).replace(".","")),X=parseInt(v.toFixed(O).replace(".",""));return F%X/Math.pow(10,O)}class Zf extends Wn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(v){if(this._def.coerce&&(v.data=Number(v.data)),this._getType(v)!==Ui.number){const F=this._getOrReturnCtx(v);return Bi(F,{code:fi.invalid_type,expected:Ui.number,received:F.parsedType}),zn}let D;const O=new ao;for(const F of this._def.checks)F.kind==="int"?dr.isInteger(v.data)||(D=this._getOrReturnCtx(v,D),Bi(D,{code:fi.invalid_type,expected:"integer",received:"float",message:F.message}),O.dirty()):F.kind==="min"?(F.inclusive?v.data<F.value:v.data<=F.value)&&(D=this._getOrReturnCtx(v,D),Bi(D,{code:fi.too_small,minimum:F.value,type:"number",inclusive:F.inclusive,exact:!1,message:F.message}),O.dirty()):F.kind==="max"?(F.inclusive?v.data>F.value:v.data>=F.value)&&(D=this._getOrReturnCtx(v,D),Bi(D,{code:fi.too_big,maximum:F.value,type:"number",inclusive:F.inclusive,exact:!1,message:F.message}),O.dirty()):F.kind==="multipleOf"?BD(v.data,F.value)!==0&&(D=this._getOrReturnCtx(v,D),Bi(D,{code:fi.not_multiple_of,multipleOf:F.value,message:F.message}),O.dirty()):F.kind==="finite"?Number.isFinite(v.data)||(D=this._getOrReturnCtx(v,D),Bi(D,{code:fi.not_finite,message:F.message}),O.dirty()):dr.assertNever(F);return{status:O.value,value:v.data}}gte(v,S){return this.setLimit("min",v,!0,nn.toString(S))}gt(v,S){return this.setLimit("min",v,!1,nn.toString(S))}lte(v,S){return this.setLimit("max",v,!0,nn.toString(S))}lt(v,S){return this.setLimit("max",v,!1,nn.toString(S))}setLimit(v,S,D,O){return new Zf({...this._def,checks:[...this._def.checks,{kind:v,value:S,inclusive:D,message:nn.toString(O)}]})}_addCheck(v){return new Zf({...this._def,checks:[...this._def.checks,v]})}int(v){return this._addCheck({kind:"int",message:nn.toString(v)})}positive(v){return this._addCheck({kind:"min",value:0,inclusive:!1,message:nn.toString(v)})}negative(v){return this._addCheck({kind:"max",value:0,inclusive:!1,message:nn.toString(v)})}nonpositive(v){return this._addCheck({kind:"max",value:0,inclusive:!0,message:nn.toString(v)})}nonnegative(v){return this._addCheck({kind:"min",value:0,inclusive:!0,message:nn.toString(v)})}multipleOf(v,S){return this._addCheck({kind:"multipleOf",value:v,message:nn.toString(S)})}finite(v){return this._addCheck({kind:"finite",message:nn.toString(v)})}safe(v){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:nn.toString(v)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:nn.toString(v)})}get minValue(){let v=null;for(const S of this._def.checks)S.kind==="min"&&(v===null||S.value>v)&&(v=S.value);return v}get maxValue(){let v=null;for(const S of this._def.checks)S.kind==="max"&&(v===null||S.value<v)&&(v=S.value);return v}get isInt(){return!!this._def.checks.find(v=>v.kind==="int"||v.kind==="multipleOf"&&dr.isInteger(v.value))}get isFinite(){let v=null,S=null;for(const D of this._def.checks){if(D.kind==="finite"||D.kind==="int"||D.kind==="multipleOf")return!0;D.kind==="min"?(S===null||D.value>S)&&(S=D.value):D.kind==="max"&&(v===null||D.value<v)&&(v=D.value)}return Number.isFinite(S)&&Number.isFinite(v)}}Zf.create=m=>new Zf({checks:[],typeName:In.ZodNumber,coerce:(m==null?void 0:m.coerce)||!1,...Gn(m)});class $f extends Wn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(v){if(this._def.coerce)try{v.data=BigInt(v.data)}catch{return this._getInvalidInput(v)}if(this._getType(v)!==Ui.bigint)return this._getInvalidInput(v);let D;const O=new ao;for(const F of this._def.checks)F.kind==="min"?(F.inclusive?v.data<F.value:v.data<=F.value)&&(D=this._getOrReturnCtx(v,D),Bi(D,{code:fi.too_small,type:"bigint",minimum:F.value,inclusive:F.inclusive,message:F.message}),O.dirty()):F.kind==="max"?(F.inclusive?v.data>F.value:v.data>=F.value)&&(D=this._getOrReturnCtx(v,D),Bi(D,{code:fi.too_big,type:"bigint",maximum:F.value,inclusive:F.inclusive,message:F.message}),O.dirty()):F.kind==="multipleOf"?v.data%F.value!==BigInt(0)&&(D=this._getOrReturnCtx(v,D),Bi(D,{code:fi.not_multiple_of,multipleOf:F.value,message:F.message}),O.dirty()):dr.assertNever(F);return{status:O.value,value:v.data}}_getInvalidInput(v){const S=this._getOrReturnCtx(v);return Bi(S,{code:fi.invalid_type,expected:Ui.bigint,received:S.parsedType}),zn}gte(v,S){return this.setLimit("min",v,!0,nn.toString(S))}gt(v,S){return this.setLimit("min",v,!1,nn.toString(S))}lte(v,S){return this.setLimit("max",v,!0,nn.toString(S))}lt(v,S){return this.setLimit("max",v,!1,nn.toString(S))}setLimit(v,S,D,O){return new $f({...this._def,checks:[...this._def.checks,{kind:v,value:S,inclusive:D,message:nn.toString(O)}]})}_addCheck(v){return new $f({...this._def,checks:[...this._def.checks,v]})}positive(v){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:nn.toString(v)})}negative(v){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:nn.toString(v)})}nonpositive(v){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:nn.toString(v)})}nonnegative(v){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:nn.toString(v)})}multipleOf(v,S){return this._addCheck({kind:"multipleOf",value:v,message:nn.toString(S)})}get minValue(){let v=null;for(const S of this._def.checks)S.kind==="min"&&(v===null||S.value>v)&&(v=S.value);return v}get maxValue(){let v=null;for(const S of this._def.checks)S.kind==="max"&&(v===null||S.value<v)&&(v=S.value);return v}}$f.create=m=>{var v;return new $f({checks:[],typeName:In.ZodBigInt,coerce:(v=m==null?void 0:m.coerce)!==null&&v!==void 0?v:!1,...Gn(m)})};class ty extends Wn{_parse(v){if(this._def.coerce&&(v.data=!!v.data),this._getType(v)!==Ui.boolean){const D=this._getOrReturnCtx(v);return Bi(D,{code:fi.invalid_type,expected:Ui.boolean,received:D.parsedType}),zn}return Ao(v.data)}}ty.create=m=>new ty({typeName:In.ZodBoolean,coerce:(m==null?void 0:m.coerce)||!1,...Gn(m)});class im extends Wn{_parse(v){if(this._def.coerce&&(v.data=new Date(v.data)),this._getType(v)!==Ui.date){const F=this._getOrReturnCtx(v);return Bi(F,{code:fi.invalid_type,expected:Ui.date,received:F.parsedType}),zn}if(isNaN(v.data.getTime())){const F=this._getOrReturnCtx(v);return Bi(F,{code:fi.invalid_date}),zn}const D=new ao;let O;for(const F of this._def.checks)F.kind==="min"?v.data.getTime()<F.value&&(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.too_small,message:F.message,inclusive:!0,exact:!1,minimum:F.value,type:"date"}),D.dirty()):F.kind==="max"?v.data.getTime()>F.value&&(O=this._getOrReturnCtx(v,O),Bi(O,{code:fi.too_big,message:F.message,inclusive:!0,exact:!1,maximum:F.value,type:"date"}),D.dirty()):dr.assertNever(F);return{status:D.value,value:new Date(v.data.getTime())}}_addCheck(v){return new im({...this._def,checks:[...this._def.checks,v]})}min(v,S){return this._addCheck({kind:"min",value:v.getTime(),message:nn.toString(S)})}max(v,S){return this._addCheck({kind:"max",value:v.getTime(),message:nn.toString(S)})}get minDate(){let v=null;for(const S of this._def.checks)S.kind==="min"&&(v===null||S.value>v)&&(v=S.value);return v!=null?new Date(v):null}get maxDate(){let v=null;for(const S of this._def.checks)S.kind==="max"&&(v===null||S.value<v)&&(v=S.value);return v!=null?new Date(v):null}}im.create=m=>new im({checks:[],coerce:(m==null?void 0:m.coerce)||!1,typeName:In.ZodDate,...Gn(m)});class n0 extends Wn{_parse(v){if(this._getType(v)!==Ui.symbol){const D=this._getOrReturnCtx(v);return Bi(D,{code:fi.invalid_type,expected:Ui.symbol,received:D.parsedType}),zn}return Ao(v.data)}}n0.create=m=>new n0({typeName:In.ZodSymbol,...Gn(m)});class iy extends Wn{_parse(v){if(this._getType(v)!==Ui.undefined){const D=this._getOrReturnCtx(v);return Bi(D,{code:fi.invalid_type,expected:Ui.undefined,received:D.parsedType}),zn}return Ao(v.data)}}iy.create=m=>new iy({typeName:In.ZodUndefined,...Gn(m)});class ny extends Wn{_parse(v){if(this._getType(v)!==Ui.null){const D=this._getOrReturnCtx(v);return Bi(D,{code:fi.invalid_type,expected:Ui.null,received:D.parsedType}),zn}return Ao(v.data)}}ny.create=m=>new ny({typeName:In.ZodNull,...Gn(m)});class I_ extends Wn{constructor(){super(...arguments),this._any=!0}_parse(v){return Ao(v.data)}}I_.create=m=>new I_({typeName:In.ZodAny,...Gn(m)});class Jp extends Wn{constructor(){super(...arguments),this._unknown=!0}_parse(v){return Ao(v.data)}}Jp.create=m=>new Jp({typeName:In.ZodUnknown,...Gn(m)});class Sd extends Wn{_parse(v){const S=this._getOrReturnCtx(v);return Bi(S,{code:fi.invalid_type,expected:Ui.never,received:S.parsedType}),zn}}Sd.create=m=>new Sd({typeName:In.ZodNever,...Gn(m)});class r0 extends Wn{_parse(v){if(this._getType(v)!==Ui.undefined){const D=this._getOrReturnCtx(v);return Bi(D,{code:fi.invalid_type,expected:Ui.void,received:D.parsedType}),zn}return Ao(v.data)}}r0.create=m=>new r0({typeName:In.ZodVoid,...Gn(m)});class pu extends Wn{_parse(v){const{ctx:S,status:D}=this._processInputParams(v),O=this._def;if(S.parsedType!==Ui.array)return Bi(S,{code:fi.invalid_type,expected:Ui.array,received:S.parsedType}),zn;if(O.exactLength!==null){const X=S.data.length>O.exactLength.value,r=S.data.length<O.exactLength.value;(X||r)&&(Bi(S,{code:X?fi.too_big:fi.too_small,minimum:r?O.exactLength.value:void 0,maximum:X?O.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:O.exactLength.message}),D.dirty())}if(O.minLength!==null&&S.data.length<O.minLength.value&&(Bi(S,{code:fi.too_small,minimum:O.minLength.value,type:"array",inclusive:!0,exact:!1,message:O.minLength.message}),D.dirty()),O.maxLength!==null&&S.data.length>O.maxLength.value&&(Bi(S,{code:fi.too_big,maximum:O.maxLength.value,type:"array",inclusive:!0,exact:!1,message:O.maxLength.message}),D.dirty()),S.common.async)return Promise.all([...S.data].map((X,r)=>O.type._parseAsync(new uh(S,X,S.path,r)))).then(X=>ao.mergeArray(D,X));const F=[...S.data].map((X,r)=>O.type._parseSync(new uh(S,X,S.path,r)));return ao.mergeArray(D,F)}get element(){return this._def.type}min(v,S){return new pu({...this._def,minLength:{value:v,message:nn.toString(S)}})}max(v,S){return new pu({...this._def,maxLength:{value:v,message:nn.toString(S)}})}length(v,S){return new pu({...this._def,exactLength:{value:v,message:nn.toString(S)}})}nonempty(v){return this.min(1,v)}}pu.create=(m,v)=>new pu({type:m,minLength:null,maxLength:null,exactLength:null,typeName:In.ZodArray,...Gn(v)});function E_(m){if(m instanceof ga){const v={};for(const S in m.shape){const D=m.shape[S];v[S]=ch.create(E_(D))}return new ga({...m._def,shape:()=>v})}else return m instanceof pu?new pu({...m._def,type:E_(m.element)}):m instanceof ch?ch.create(E_(m.unwrap())):m instanceof Yf?Yf.create(E_(m.unwrap())):m instanceof hh?hh.create(m.items.map(v=>E_(v))):m}class ga extends Wn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const v=this._def.shape(),S=dr.objectKeys(v);return this._cached={shape:v,keys:S}}_parse(v){if(this._getType(v)!==Ui.object){const J=this._getOrReturnCtx(v);return Bi(J,{code:fi.invalid_type,expected:Ui.object,received:J.parsedType}),zn}const{status:D,ctx:O}=this._processInputParams(v),{shape:F,keys:X}=this._getCached(),r=[];if(!(this._def.catchall instanceof Sd&&this._def.unknownKeys==="strip"))for(const J in O.data)X.includes(J)||r.push(J);const re=[];for(const J of X){const oe=F[J],ze=O.data[J];re.push({key:{status:"valid",value:J},value:oe._parse(new uh(O,ze,O.path,J)),alwaysSet:J in O.data})}if(this._def.catchall instanceof Sd){const J=this._def.unknownKeys;if(J==="passthrough")for(const oe of r)re.push({key:{status:"valid",value:oe},value:{status:"valid",value:O.data[oe]}});else if(J==="strict")r.length>0&&(Bi(O,{code:fi.unrecognized_keys,keys:r}),D.dirty());else if(J!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const J=this._def.catchall;for(const oe of r){const ze=O.data[oe];re.push({key:{status:"valid",value:oe},value:J._parse(new uh(O,ze,O.path,oe)),alwaysSet:oe in O.data})}}return O.common.async?Promise.resolve().then(async()=>{const J=[];for(const oe of re){const ze=await oe.key,je=await oe.value;J.push({key:ze,value:je,alwaysSet:oe.alwaysSet})}return J}).then(J=>ao.mergeObjectSync(D,J)):ao.mergeObjectSync(D,re)}get shape(){return this._def.shape()}strict(v){return nn.errToObj,new ga({...this._def,unknownKeys:"strict",...v!==void 0?{errorMap:(S,D)=>{var O,F,X,r;const re=(X=(F=(O=this._def).errorMap)===null||F===void 0?void 0:F.call(O,S,D).message)!==null&&X!==void 0?X:D.defaultError;return S.code==="unrecognized_keys"?{message:(r=nn.errToObj(v).message)!==null&&r!==void 0?r:re}:{message:re}}}:{}})}strip(){return new ga({...this._def,unknownKeys:"strip"})}passthrough(){return new ga({...this._def,unknownKeys:"passthrough"})}extend(v){return new ga({...this._def,shape:()=>({...this._def.shape(),...v})})}merge(v){return new ga({unknownKeys:v._def.unknownKeys,catchall:v._def.catchall,shape:()=>({...this._def.shape(),...v._def.shape()}),typeName:In.ZodObject})}setKey(v,S){return this.augment({[v]:S})}catchall(v){return new ga({...this._def,catchall:v})}pick(v){const S={};return dr.objectKeys(v).forEach(D=>{v[D]&&this.shape[D]&&(S[D]=this.shape[D])}),new ga({...this._def,shape:()=>S})}omit(v){const S={};return dr.objectKeys(this.shape).forEach(D=>{v[D]||(S[D]=this.shape[D])}),new ga({...this._def,shape:()=>S})}deepPartial(){return E_(this)}partial(v){const S={};return dr.objectKeys(this.shape).forEach(D=>{const O=this.shape[D];v&&!v[D]?S[D]=O:S[D]=O.optional()}),new ga({...this._def,shape:()=>S})}required(v){const S={};return dr.objectKeys(this.shape).forEach(D=>{if(v&&!v[D])S[D]=this.shape[D];else{let F=this.shape[D];for(;F instanceof ch;)F=F._def.innerType;S[D]=F}}),new ga({...this._def,shape:()=>S})}keyof(){return PS(dr.objectKeys(this.shape))}}ga.create=(m,v)=>new ga({shape:()=>m,unknownKeys:"strip",catchall:Sd.create(),typeName:In.ZodObject,...Gn(v)});ga.strictCreate=(m,v)=>new ga({shape:()=>m,unknownKeys:"strict",catchall:Sd.create(),typeName:In.ZodObject,...Gn(v)});ga.lazycreate=(m,v)=>new ga({shape:m,unknownKeys:"strip",catchall:Sd.create(),typeName:In.ZodObject,...Gn(v)});class ry extends Wn{_parse(v){const{ctx:S}=this._processInputParams(v),D=this._def.options;function O(F){for(const r of F)if(r.result.status==="valid")return r.result;for(const r of F)if(r.result.status==="dirty")return S.common.issues.push(...r.ctx.common.issues),r.result;const X=F.map(r=>new yl(r.ctx.common.issues));return Bi(S,{code:fi.invalid_union,unionErrors:X}),zn}if(S.common.async)return Promise.all(D.map(async F=>{const X={...S,common:{...S.common,issues:[]},parent:null};return{result:await F._parseAsync({data:S.data,path:S.path,parent:X}),ctx:X}})).then(O);{let F;const X=[];for(const re of D){const J={...S,common:{...S.common,issues:[]},parent:null},oe=re._parseSync({data:S.data,path:S.path,parent:J});if(oe.status==="valid")return oe;oe.status==="dirty"&&!F&&(F={result:oe,ctx:J}),J.common.issues.length&&X.push(J.common.issues)}if(F)return S.common.issues.push(...F.ctx.common.issues),F.result;const r=X.map(re=>new yl(re));return Bi(S,{code:fi.invalid_union,unionErrors:r}),zn}}get options(){return this._def.options}}ry.create=(m,v)=>new ry({options:m,typeName:In.ZodUnion,...Gn(v)});const fd=m=>m instanceof oy?fd(m.schema):m instanceof _u?fd(m.innerType()):m instanceof ly?[m.value]:m instanceof Xf?m.options:m instanceof cy?dr.objectValues(m.enum):m instanceof uy?fd(m._def.innerType):m instanceof iy?[void 0]:m instanceof ny?[null]:m instanceof ch?[void 0,...fd(m.unwrap())]:m instanceof Yf?[null,...fd(m.unwrap())]:m instanceof B1||m instanceof dy?fd(m.unwrap()):m instanceof hy?fd(m._def.innerType):[];class b0 extends Wn{_parse(v){const{ctx:S}=this._processInputParams(v);if(S.parsedType!==Ui.object)return Bi(S,{code:fi.invalid_type,expected:Ui.object,received:S.parsedType}),zn;const D=this.discriminator,O=S.data[D],F=this.optionsMap.get(O);return F?S.common.async?F._parseAsync({data:S.data,path:S.path,parent:S}):F._parseSync({data:S.data,path:S.path,parent:S}):(Bi(S,{code:fi.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[D]}),zn)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(v,S,D){const O=new Map;for(const F of S){const X=fd(F.shape[v]);if(!X.length)throw new Error(`A discriminator value for key \`${v}\` could not be extracted from all schema options`);for(const r of X){if(O.has(r))throw new Error(`Discriminator property ${String(v)} has duplicate value ${String(r)}`);O.set(r,F)}}return new b0({typeName:In.ZodDiscriminatedUnion,discriminator:v,options:S,optionsMap:O,...Gn(D)})}}function c1(m,v){const S=pd(m),D=pd(v);if(m===v)return{valid:!0,data:m};if(S===Ui.object&&D===Ui.object){const O=dr.objectKeys(v),F=dr.objectKeys(m).filter(r=>O.indexOf(r)!==-1),X={...m,...v};for(const r of F){const re=c1(m[r],v[r]);if(!re.valid)return{valid:!1};X[r]=re.data}return{valid:!0,data:X}}else if(S===Ui.array&&D===Ui.array){if(m.length!==v.length)return{valid:!1};const O=[];for(let F=0;F<m.length;F++){const X=m[F],r=v[F],re=c1(X,r);if(!re.valid)return{valid:!1};O.push(re.data)}return{valid:!0,data:O}}else return S===Ui.date&&D===Ui.date&&+m==+v?{valid:!0,data:m}:{valid:!1}}class ay extends Wn{_parse(v){const{status:S,ctx:D}=this._processInputParams(v),O=(F,X)=>{if(o1(F)||o1(X))return zn;const r=c1(F.value,X.value);return r.valid?((l1(F)||l1(X))&&S.dirty(),{status:S.value,value:r.data}):(Bi(D,{code:fi.invalid_intersection_types}),zn)};return D.common.async?Promise.all([this._def.left._parseAsync({data:D.data,path:D.path,parent:D}),this._def.right._parseAsync({data:D.data,path:D.path,parent:D})]).then(([F,X])=>O(F,X)):O(this._def.left._parseSync({data:D.data,path:D.path,parent:D}),this._def.right._parseSync({data:D.data,path:D.path,parent:D}))}}ay.create=(m,v,S)=>new ay({left:m,right:v,typeName:In.ZodIntersection,...Gn(S)});class hh extends Wn{_parse(v){const{status:S,ctx:D}=this._processInputParams(v);if(D.parsedType!==Ui.array)return Bi(D,{code:fi.invalid_type,expected:Ui.array,received:D.parsedType}),zn;if(D.data.length<this._def.items.length)return Bi(D,{code:fi.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),zn;!this._def.rest&&D.data.length>this._def.items.length&&(Bi(D,{code:fi.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),S.dirty());const F=[...D.data].map((X,r)=>{const re=this._def.items[r]||this._def.rest;return re?re._parse(new uh(D,X,D.path,r)):null}).filter(X=>!!X);return D.common.async?Promise.all(F).then(X=>ao.mergeArray(S,X)):ao.mergeArray(S,F)}get items(){return this._def.items}rest(v){return new hh({...this._def,rest:v})}}hh.create=(m,v)=>{if(!Array.isArray(m))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new hh({items:m,typeName:In.ZodTuple,rest:null,...Gn(v)})};class sy extends Wn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(v){const{status:S,ctx:D}=this._processInputParams(v);if(D.parsedType!==Ui.object)return Bi(D,{code:fi.invalid_type,expected:Ui.object,received:D.parsedType}),zn;const O=[],F=this._def.keyType,X=this._def.valueType;for(const r in D.data)O.push({key:F._parse(new uh(D,r,D.path,r)),value:X._parse(new uh(D,D.data[r],D.path,r)),alwaysSet:r in D.data});return D.common.async?ao.mergeObjectAsync(S,O):ao.mergeObjectSync(S,O)}get element(){return this._def.valueType}static create(v,S,D){return S instanceof Wn?new sy({keyType:v,valueType:S,typeName:In.ZodRecord,...Gn(D)}):new sy({keyType:fu.create(),valueType:v,typeName:In.ZodRecord,...Gn(S)})}}class a0 extends Wn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(v){const{status:S,ctx:D}=this._processInputParams(v);if(D.parsedType!==Ui.map)return Bi(D,{code:fi.invalid_type,expected:Ui.map,received:D.parsedType}),zn;const O=this._def.keyType,F=this._def.valueType,X=[...D.data.entries()].map(([r,re],J)=>({key:O._parse(new uh(D,r,D.path,[J,"key"])),value:F._parse(new uh(D,re,D.path,[J,"value"]))}));if(D.common.async){const r=new Map;return Promise.resolve().then(async()=>{for(const re of X){const J=await re.key,oe=await re.value;if(J.status==="aborted"||oe.status==="aborted")return zn;(J.status==="dirty"||oe.status==="dirty")&&S.dirty(),r.set(J.value,oe.value)}return{status:S.value,value:r}})}else{const r=new Map;for(const re of X){const J=re.key,oe=re.value;if(J.status==="aborted"||oe.status==="aborted")return zn;(J.status==="dirty"||oe.status==="dirty")&&S.dirty(),r.set(J.value,oe.value)}return{status:S.value,value:r}}}}a0.create=(m,v,S)=>new a0({valueType:v,keyType:m,typeName:In.ZodMap,...Gn(S)});class nm extends Wn{_parse(v){const{status:S,ctx:D}=this._processInputParams(v);if(D.parsedType!==Ui.set)return Bi(D,{code:fi.invalid_type,expected:Ui.set,received:D.parsedType}),zn;const O=this._def;O.minSize!==null&&D.data.size<O.minSize.value&&(Bi(D,{code:fi.too_small,minimum:O.minSize.value,type:"set",inclusive:!0,exact:!1,message:O.minSize.message}),S.dirty()),O.maxSize!==null&&D.data.size>O.maxSize.value&&(Bi(D,{code:fi.too_big,maximum:O.maxSize.value,type:"set",inclusive:!0,exact:!1,message:O.maxSize.message}),S.dirty());const F=this._def.valueType;function X(re){const J=new Set;for(const oe of re){if(oe.status==="aborted")return zn;oe.status==="dirty"&&S.dirty(),J.add(oe.value)}return{status:S.value,value:J}}const r=[...D.data.values()].map((re,J)=>F._parse(new uh(D,re,D.path,J)));return D.common.async?Promise.all(r).then(re=>X(re)):X(r)}min(v,S){return new nm({...this._def,minSize:{value:v,message:nn.toString(S)}})}max(v,S){return new nm({...this._def,maxSize:{value:v,message:nn.toString(S)}})}size(v,S){return this.min(v,S).max(v,S)}nonempty(v){return this.min(1,v)}}nm.create=(m,v)=>new nm({valueType:m,minSize:null,maxSize:null,typeName:In.ZodSet,...Gn(v)});class M_ extends Wn{constructor(){super(...arguments),this.validate=this.implement}_parse(v){const{ctx:S}=this._processInputParams(v);if(S.parsedType!==Ui.function)return Bi(S,{code:fi.invalid_type,expected:Ui.function,received:S.parsedType}),zn;function D(r,re){return t0({data:r,path:S.path,errorMaps:[S.common.contextualErrorMap,S.schemaErrorMap,e0(),C_].filter(J=>!!J),issueData:{code:fi.invalid_arguments,argumentsError:re}})}function O(r,re){return t0({data:r,path:S.path,errorMaps:[S.common.contextualErrorMap,S.schemaErrorMap,e0(),C_].filter(J=>!!J),issueData:{code:fi.invalid_return_type,returnTypeError:re}})}const F={errorMap:S.common.contextualErrorMap},X=S.data;if(this._def.returns instanceof R_){const r=this;return Ao(async function(...re){const J=new yl([]),oe=await r._def.args.parseAsync(re,F).catch(ft=>{throw J.addIssue(D(re,ft)),J}),ze=await Reflect.apply(X,this,oe);return await r._def.returns._def.type.parseAsync(ze,F).catch(ft=>{throw J.addIssue(O(ze,ft)),J})})}else{const r=this;return Ao(function(...re){const J=r._def.args.safeParse(re,F);if(!J.success)throw new yl([D(re,J.error)]);const oe=Reflect.apply(X,this,J.data),ze=r._def.returns.safeParse(oe,F);if(!ze.success)throw new yl([O(oe,ze.error)]);return ze.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...v){return new M_({...this._def,args:hh.create(v).rest(Jp.create())})}returns(v){return new M_({...this._def,returns:v})}implement(v){return this.parse(v)}strictImplement(v){return this.parse(v)}static create(v,S,D){return new M_({args:v||hh.create([]).rest(Jp.create()),returns:S||Jp.create(),typeName:In.ZodFunction,...Gn(D)})}}class oy extends Wn{get schema(){return this._def.getter()}_parse(v){const{ctx:S}=this._processInputParams(v);return this._def.getter()._parse({data:S.data,path:S.path,parent:S})}}oy.create=(m,v)=>new oy({getter:m,typeName:In.ZodLazy,...Gn(v)});class ly extends Wn{_parse(v){if(v.data!==this._def.value){const S=this._getOrReturnCtx(v);return Bi(S,{received:S.data,code:fi.invalid_literal,expected:this._def.value}),zn}return{status:"valid",value:v.data}}get value(){return this._def.value}}ly.create=(m,v)=>new ly({value:m,typeName:In.ZodLiteral,...Gn(v)});function PS(m,v){return new Xf({values:m,typeName:In.ZodEnum,...Gn(v)})}class Xf extends Wn{constructor(){super(...arguments),Zg.set(this,void 0)}_parse(v){if(typeof v.data!="string"){const S=this._getOrReturnCtx(v),D=this._def.values;return Bi(S,{expected:dr.joinValues(D),received:S.parsedType,code:fi.invalid_type}),zn}if(i0(this,Zg)||DS(this,Zg,new Set(this._def.values)),!i0(this,Zg).has(v.data)){const S=this._getOrReturnCtx(v),D=this._def.values;return Bi(S,{received:S.data,code:fi.invalid_enum_value,options:D}),zn}return Ao(v.data)}get options(){return this._def.values}get enum(){const v={};for(const S of this._def.values)v[S]=S;return v}get Values(){const v={};for(const S of this._def.values)v[S]=S;return v}get Enum(){const v={};for(const S of this._def.values)v[S]=S;return v}extract(v,S=this._def){return Xf.create(v,{...this._def,...S})}exclude(v,S=this._def){return Xf.create(this.options.filter(D=>!v.includes(D)),{...this._def,...S})}}Zg=new WeakMap;Xf.create=PS;class cy extends Wn{constructor(){super(...arguments),$g.set(this,void 0)}_parse(v){const S=dr.getValidEnumValues(this._def.values),D=this._getOrReturnCtx(v);if(D.parsedType!==Ui.string&&D.parsedType!==Ui.number){const O=dr.objectValues(S);return Bi(D,{expected:dr.joinValues(O),received:D.parsedType,code:fi.invalid_type}),zn}if(i0(this,$g)||DS(this,$g,new Set(dr.getValidEnumValues(this._def.values))),!i0(this,$g).has(v.data)){const O=dr.objectValues(S);return Bi(D,{received:D.data,code:fi.invalid_enum_value,options:O}),zn}return Ao(v.data)}get enum(){return this._def.values}}$g=new WeakMap;cy.create=(m,v)=>new cy({values:m,typeName:In.ZodNativeEnum,...Gn(v)});class R_ extends Wn{unwrap(){return this._def.type}_parse(v){const{ctx:S}=this._processInputParams(v);if(S.parsedType!==Ui.promise&&S.common.async===!1)return Bi(S,{code:fi.invalid_type,expected:Ui.promise,received:S.parsedType}),zn;const D=S.parsedType===Ui.promise?S.data:Promise.resolve(S.data);return Ao(D.then(O=>this._def.type.parseAsync(O,{path:S.path,errorMap:S.common.contextualErrorMap})))}}R_.create=(m,v)=>new R_({type:m,typeName:In.ZodPromise,...Gn(v)});class _u extends Wn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===In.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(v){const{status:S,ctx:D}=this._processInputParams(v),O=this._def.effect||null,F={addIssue:X=>{Bi(D,X),X.fatal?S.abort():S.dirty()},get path(){return D.path}};if(F.addIssue=F.addIssue.bind(F),O.type==="preprocess"){const X=O.transform(D.data,F);if(D.common.async)return Promise.resolve(X).then(async r=>{if(S.value==="aborted")return zn;const re=await this._def.schema._parseAsync({data:r,path:D.path,parent:D});return re.status==="aborted"?zn:re.status==="dirty"||S.value==="dirty"?A_(re.value):re});{if(S.value==="aborted")return zn;const r=this._def.schema._parseSync({data:X,path:D.path,parent:D});return r.status==="aborted"?zn:r.status==="dirty"||S.value==="dirty"?A_(r.value):r}}if(O.type==="refinement"){const X=r=>{const re=O.refinement(r,F);if(D.common.async)return Promise.resolve(re);if(re instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return r};if(D.common.async===!1){const r=this._def.schema._parseSync({data:D.data,path:D.path,parent:D});return r.status==="aborted"?zn:(r.status==="dirty"&&S.dirty(),X(r.value),{status:S.value,value:r.value})}else return this._def.schema._parseAsync({data:D.data,path:D.path,parent:D}).then(r=>r.status==="aborted"?zn:(r.status==="dirty"&&S.dirty(),X(r.value).then(()=>({status:S.value,value:r.value}))))}if(O.type==="transform")if(D.common.async===!1){const X=this._def.schema._parseSync({data:D.data,path:D.path,parent:D});if(!tm(X))return X;const r=O.transform(X.value,F);if(r instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:S.value,value:r}}else return this._def.schema._parseAsync({data:D.data,path:D.path,parent:D}).then(X=>tm(X)?Promise.resolve(O.transform(X.value,F)).then(r=>({status:S.value,value:r})):X);dr.assertNever(O)}}_u.create=(m,v,S)=>new _u({schema:m,typeName:In.ZodEffects,effect:v,...Gn(S)});_u.createWithPreprocess=(m,v,S)=>new _u({schema:v,effect:{type:"preprocess",transform:m},typeName:In.ZodEffects,...Gn(S)});class ch extends Wn{_parse(v){return this._getType(v)===Ui.undefined?Ao(void 0):this._def.innerType._parse(v)}unwrap(){return this._def.innerType}}ch.create=(m,v)=>new ch({innerType:m,typeName:In.ZodOptional,...Gn(v)});class Yf extends Wn{_parse(v){return this._getType(v)===Ui.null?Ao(null):this._def.innerType._parse(v)}unwrap(){return this._def.innerType}}Yf.create=(m,v)=>new Yf({innerType:m,typeName:In.ZodNullable,...Gn(v)});class uy extends Wn{_parse(v){const{ctx:S}=this._processInputParams(v);let D=S.data;return S.parsedType===Ui.undefined&&(D=this._def.defaultValue()),this._def.innerType._parse({data:D,path:S.path,parent:S})}removeDefault(){return this._def.innerType}}uy.create=(m,v)=>new uy({innerType:m,typeName:In.ZodDefault,defaultValue:typeof v.default=="function"?v.default:()=>v.default,...Gn(v)});class hy extends Wn{_parse(v){const{ctx:S}=this._processInputParams(v),D={...S,common:{...S.common,issues:[]}},O=this._def.innerType._parse({data:D.data,path:D.path,parent:{...D}});return ey(O)?O.then(F=>({status:"valid",value:F.status==="valid"?F.value:this._def.catchValue({get error(){return new yl(D.common.issues)},input:D.data})})):{status:"valid",value:O.status==="valid"?O.value:this._def.catchValue({get error(){return new yl(D.common.issues)},input:D.data})}}removeCatch(){return this._def.innerType}}hy.create=(m,v)=>new hy({innerType:m,typeName:In.ZodCatch,catchValue:typeof v.catch=="function"?v.catch:()=>v.catch,...Gn(v)});class s0 extends Wn{_parse(v){if(this._getType(v)!==Ui.nan){const D=this._getOrReturnCtx(v);return Bi(D,{code:fi.invalid_type,expected:Ui.nan,received:D.parsedType}),zn}return{status:"valid",value:v.data}}}s0.create=m=>new s0({typeName:In.ZodNaN,...Gn(m)});const ND=Symbol("zod_brand");class B1 extends Wn{_parse(v){const{ctx:S}=this._processInputParams(v),D=S.data;return this._def.type._parse({data:D,path:S.path,parent:S})}unwrap(){return this._def.type}}class xy extends Wn{_parse(v){const{status:S,ctx:D}=this._processInputParams(v);if(D.common.async)return(async()=>{const F=await this._def.in._parseAsync({data:D.data,path:D.path,parent:D});return F.status==="aborted"?zn:F.status==="dirty"?(S.dirty(),A_(F.value)):this._def.out._parseAsync({data:F.value,path:D.path,parent:D})})();{const O=this._def.in._parseSync({data:D.data,path:D.path,parent:D});return O.status==="aborted"?zn:O.status==="dirty"?(S.dirty(),{status:"dirty",value:O.value}):this._def.out._parseSync({data:O.value,path:D.path,parent:D})}}static create(v,S){return new xy({in:v,out:S,typeName:In.ZodPipeline})}}class dy extends Wn{_parse(v){const S=this._def.innerType._parse(v),D=O=>(tm(O)&&(O.value=Object.freeze(O.value)),O);return ey(S)?S.then(O=>D(O)):D(S)}unwrap(){return this._def.innerType}}dy.create=(m,v)=>new dy({innerType:m,typeName:In.ZodReadonly,...Gn(v)});function iT(m,v){const S=typeof m=="function"?m(v):typeof m=="string"?{message:m}:m;return typeof S=="string"?{message:S}:S}function kS(m,v={},S){return m?I_.create().superRefine((D,O)=>{var F,X;const r=m(D);if(r instanceof Promise)return r.then(re=>{var J,oe;if(!re){const ze=iT(v,D),je=(oe=(J=ze.fatal)!==null&&J!==void 0?J:S)!==null&&oe!==void 0?oe:!0;O.addIssue({code:"custom",...ze,fatal:je})}});if(!r){const re=iT(v,D),J=(X=(F=re.fatal)!==null&&F!==void 0?F:S)!==null&&X!==void 0?X:!0;O.addIssue({code:"custom",...re,fatal:J})}}):I_.create()}const FD={object:ga.lazycreate};var In;(function(m){m.ZodString="ZodString",m.ZodNumber="ZodNumber",m.ZodNaN="ZodNaN",m.ZodBigInt="ZodBigInt",m.ZodBoolean="ZodBoolean",m.ZodDate="ZodDate",m.ZodSymbol="ZodSymbol",m.ZodUndefined="ZodUndefined",m.ZodNull="ZodNull",m.ZodAny="ZodAny",m.ZodUnknown="ZodUnknown",m.ZodNever="ZodNever",m.ZodVoid="ZodVoid",m.ZodArray="ZodArray",m.ZodObject="ZodObject",m.ZodUnion="ZodUnion",m.ZodDiscriminatedUnion="ZodDiscriminatedUnion",m.ZodIntersection="ZodIntersection",m.ZodTuple="ZodTuple",m.ZodRecord="ZodRecord",m.ZodMap="ZodMap",m.ZodSet="ZodSet",m.ZodFunction="ZodFunction",m.ZodLazy="ZodLazy",m.ZodLiteral="ZodLiteral",m.ZodEnum="ZodEnum",m.ZodEffects="ZodEffects",m.ZodNativeEnum="ZodNativeEnum",m.ZodOptional="ZodOptional",m.ZodNullable="ZodNullable",m.ZodDefault="ZodDefault",m.ZodCatch="ZodCatch",m.ZodPromise="ZodPromise",m.ZodBranded="ZodBranded",m.ZodPipeline="ZodPipeline",m.ZodReadonly="ZodReadonly"})(In||(In={}));const VD=(m,v={message:`Input not instance of ${m.name}`})=>kS(S=>S instanceof m,v),BS=fu.create,NS=Zf.create,UD=s0.create,jD=$f.create,FS=ty.create,qD=im.create,GD=n0.create,HD=iy.create,ZD=ny.create,$D=I_.create,XD=Jp.create,YD=Sd.create,WD=r0.create,KD=pu.create,JD=ga.create,QD=ga.strictCreate,ez=ry.create,tz=b0.create,iz=ay.create,nz=hh.create,rz=sy.create,az=a0.create,sz=nm.create,oz=M_.create,lz=oy.create,cz=ly.create,uz=Xf.create,hz=cy.create,dz=R_.create,nT=_u.create,fz=ch.create,pz=Yf.create,mz=_u.createWithPreprocess,_z=xy.create,gz=()=>BS().optional(),yz=()=>NS().optional(),vz=()=>FS().optional(),xz={string:m=>fu.create({...m,coerce:!0}),number:m=>Zf.create({...m,coerce:!0}),boolean:m=>ty.create({...m,coerce:!0}),bigint:m=>$f.create({...m,coerce:!0}),date:m=>im.create({...m,coerce:!0})},bz=zn;var oh=Object.freeze({__proto__:null,defaultErrorMap:C_,setErrorMap:mD,getErrorMap:e0,makeIssue:t0,EMPTY_PATH:_D,addIssueToContext:Bi,ParseStatus:ao,INVALID:zn,DIRTY:A_,OK:Ao,isAborted:o1,isDirty:l1,isValid:tm,isAsync:ey,get util(){return dr},get objectUtil(){return s1},ZodParsedType:Ui,getParsedType:pd,ZodType:Wn,datetimeRegex:OS,ZodString:fu,ZodNumber:Zf,ZodBigInt:$f,ZodBoolean:ty,ZodDate:im,ZodSymbol:n0,ZodUndefined:iy,ZodNull:ny,ZodAny:I_,ZodUnknown:Jp,ZodNever:Sd,ZodVoid:r0,ZodArray:pu,ZodObject:ga,ZodUnion:ry,ZodDiscriminatedUnion:b0,ZodIntersection:ay,ZodTuple:hh,ZodRecord:sy,ZodMap:a0,ZodSet:nm,ZodFunction:M_,ZodLazy:oy,ZodLiteral:ly,ZodEnum:Xf,ZodNativeEnum:cy,ZodPromise:R_,ZodEffects:_u,ZodTransformer:_u,ZodOptional:ch,ZodNullable:Yf,ZodDefault:uy,ZodCatch:hy,ZodNaN:s0,BRAND:ND,ZodBranded:B1,ZodPipeline:xy,ZodReadonly:dy,custom:kS,Schema:Wn,ZodSchema:Wn,late:FD,get ZodFirstPartyTypeKind(){return In},coerce:xz,any:$D,array:KD,bigint:jD,boolean:FS,date:qD,discriminatedUnion:tz,effect:nT,enum:uz,function:oz,instanceof:VD,intersection:iz,lazy:lz,literal:cz,map:az,nan:UD,nativeEnum:hz,never:YD,null:ZD,nullable:pz,number:NS,object:JD,oboolean:vz,onumber:yz,optional:fz,ostring:gz,pipeline:_z,preprocess:mz,promise:dz,record:rz,set:sz,strictObject:QD,string:BS,symbol:GD,transformer:nT,tuple:nz,undefined:HD,union:ez,unknown:XD,void:WD,NEVER:bz,ZodIssueCode:fi,quotelessJson:pD,ZodError:yl});function rT(m,v){if(typeof m=="function")return m(v);m!=null&&(m.current=v)}function VS(...m){return v=>{let S=!1;const D=m.map(O=>{const F=rT(O,v);return!S&&typeof F=="function"&&(S=!0),F});if(S)return()=>{for(let O=0;O<D.length;O++){const F=D[O];typeof F=="function"?F():rT(m[O],null)}}}}function rm(...m){return Ie.useCallback(VS(...m),m)}var D_=Ie.forwardRef((m,v)=>{const{children:S,...D}=m,O=Ie.Children.toArray(S),F=O.find(Tz);if(F){const X=F.props.children,r=O.map(re=>re===F?Ie.Children.count(X)>1?Ie.Children.only(null):Ie.isValidElement(X)?X.props.children:null:re);return _e.jsx(u1,{...D,ref:v,children:Ie.isValidElement(X)?Ie.cloneElement(X,void 0,r):null})}return _e.jsx(u1,{...D,ref:v,children:S})});D_.displayName="Slot";var u1=Ie.forwardRef((m,v)=>{const{children:S,...D}=m;if(Ie.isValidElement(S)){const O=Ez(S),F=Sz(D,S.props);return S.type!==Ie.Fragment&&(F.ref=v?VS(v,O):O),Ie.cloneElement(S,F)}return Ie.Children.count(S)>1?Ie.Children.only(null):null});u1.displayName="SlotClone";var wz=({children:m})=>_e.jsx(_e.Fragment,{children:m});function Tz(m){return Ie.isValidElement(m)&&m.type===wz}function Sz(m,v){const S={...v};for(const D in v){const O=m[D],F=v[D];/^on[A-Z]/.test(D)?O&&F?S[D]=(...r)=>{F(...r),O(...r)}:O&&(S[D]=O):D==="style"?S[D]={...O,...F}:D==="className"&&(S[D]=[O,F].filter(Boolean).join(" "))}return{...m,...S}}function Ez(m){var D,O;let v=(D=Object.getOwnPropertyDescriptor(m.props,"ref"))==null?void 0:D.get,S=v&&"isReactWarning"in v&&v.isReactWarning;return S?m.ref:(v=(O=Object.getOwnPropertyDescriptor(m,"ref"))==null?void 0:O.get,S=v&&"isReactWarning"in v&&v.isReactWarning,S?m.props.ref:m.props.ref||m.ref)}const aT=m=>typeof m=="boolean"?`${m}`:m===0?"0":m,sT=bd,N1=(m,v)=>S=>{var D;if((v==null?void 0:v.variants)==null)return sT(m,S==null?void 0:S.class,S==null?void 0:S.className);const{variants:O,defaultVariants:F}=v,X=Object.keys(O).map(J=>{const oe=S==null?void 0:S[J],ze=F==null?void 0:F[J];if(oe===null)return null;const je=aT(oe)||aT(ze);return O[J][je]}),r=S&&Object.entries(S).reduce((J,oe)=>{let[ze,je]=oe;return je===void 0||(J[ze]=je),J},{}),re=v==null||(D=v.compoundVariants)===null||D===void 0?void 0:D.reduce((J,oe)=>{let{class:ze,className:je,...ft}=oe;return Object.entries(ft).every(Le=>{let[Fe,qe]=Le;return Array.isArray(qe)?qe.includes({...F,...r}[Fe]):{...F,...r}[Fe]===qe})?[...J,ze,je]:J},[]);return sT(m,X,re,S==null?void 0:S.class,S==null?void 0:S.className)},F1="-",Az=m=>{const v=Cz(m),{conflictingClassGroups:S,conflictingClassGroupModifiers:D}=m;return{getClassGroupId:X=>{const r=X.split(F1);return r[0]===""&&r.length!==1&&r.shift(),US(r,v)||Mz(X)},getConflictingClassGroupIds:(X,r)=>{const re=S[X]||[];return r&&D[X]?[...re,...D[X]]:re}}},US=(m,v)=>{var X;if(m.length===0)return v.classGroupId;const S=m[0],D=v.nextPart.get(S),O=D?US(m.slice(1),D):void 0;if(O)return O;if(v.validators.length===0)return;const F=m.join(F1);return(X=v.validators.find(({validator:r})=>r(F)))==null?void 0:X.classGroupId},oT=/^\[(.+)\]$/,Mz=m=>{if(oT.test(m)){const v=oT.exec(m)[1],S=v==null?void 0:v.substring(0,v.indexOf(":"));if(S)return"arbitrary.."+S}},Cz=m=>{const{theme:v,classGroups:S}=m,D={nextPart:new Map,validators:[]};for(const O in S)h1(S[O],D,O,v);return D},h1=(m,v,S,D)=>{m.forEach(O=>{if(typeof O=="string"){const F=O===""?v:lT(v,O);F.classGroupId=S;return}if(typeof O=="function"){if(Iz(O)){h1(O(D),v,S,D);return}v.validators.push({validator:O,classGroupId:S});return}Object.entries(O).forEach(([F,X])=>{h1(X,lT(v,F),S,D)})})},lT=(m,v)=>{let S=m;return v.split(F1).forEach(D=>{S.nextPart.has(D)||S.nextPart.set(D,{nextPart:new Map,validators:[]}),S=S.nextPart.get(D)}),S},Iz=m=>m.isThemeGetter,Rz=m=>{if(m<1)return{get:()=>{},set:()=>{}};let v=0,S=new Map,D=new Map;const O=(F,X)=>{S.set(F,X),v++,v>m&&(v=0,D=S,S=new Map)};return{get(F){let X=S.get(F);if(X!==void 0)return X;if((X=D.get(F))!==void 0)return O(F,X),X},set(F,X){S.has(F)?S.set(F,X):O(F,X)}}},d1="!",f1=":",Dz=f1.length,zz=m=>{const{prefix:v,experimentalParseClassName:S}=m;let D=O=>{const F=[];let X=0,r=0,re=0,J;for(let Le=0;Le<O.length;Le++){let Fe=O[Le];if(X===0&&r===0){if(Fe===f1){F.push(O.slice(re,Le)),re=Le+Dz;continue}if(Fe==="/"){J=Le;continue}}Fe==="["?X++:Fe==="]"?X--:Fe==="("?r++:Fe===")"&&r--}const oe=F.length===0?O:O.substring(re),ze=Lz(oe),je=ze!==oe,ft=J&&J>re?J-re:void 0;return{modifiers:F,hasImportantModifier:je,baseClassName:ze,maybePostfixModifierPosition:ft}};if(v){const O=v+f1,F=D;D=X=>X.startsWith(O)?F(X.substring(O.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:X,maybePostfixModifierPosition:void 0}}if(S){const O=D;D=F=>S({className:F,parseClassName:O})}return D},Lz=m=>m.endsWith(d1)?m.substring(0,m.length-1):m.startsWith(d1)?m.substring(1):m,Oz=m=>{const v=Object.fromEntries(m.orderSensitiveModifiers.map(D=>[D,!0]));return D=>{if(D.length<=1)return D;const O=[];let F=[];return D.forEach(X=>{X[0]==="["||v[X]?(O.push(...F.sort(),X),F=[]):F.push(X)}),O.push(...F.sort()),O}},Pz=m=>({cache:Rz(m.cacheSize),parseClassName:zz(m),sortModifiers:Oz(m),...Az(m)}),kz=/\s+/,Bz=(m,v)=>{const{parseClassName:S,getClassGroupId:D,getConflictingClassGroupIds:O,sortModifiers:F}=v,X=[],r=m.trim().split(kz);let re="";for(let J=r.length-1;J>=0;J-=1){const oe=r[J],{isExternal:ze,modifiers:je,hasImportantModifier:ft,baseClassName:Le,maybePostfixModifierPosition:Fe}=S(oe);if(ze){re=oe+(re.length>0?" "+re:re);continue}let qe=!!Fe,He=D(qe?Le.substring(0,Fe):Le);if(!He){if(!qe){re=oe+(re.length>0?" "+re:re);continue}if(He=D(Le),!He){re=oe+(re.length>0?" "+re:re);continue}qe=!1}const tt=F(je).join(":"),mt=ft?tt+d1:tt,Tt=mt+He;if(X.includes(Tt))continue;X.push(Tt);const kt=O(He,qe);for(let At=0;At<kt.length;++At){const ot=kt[At];X.push(mt+ot)}re=oe+(re.length>0?" "+re:re)}return re};function Nz(){let m=0,v,S,D="";for(;m<arguments.length;)(v=arguments[m++])&&(S=jS(v))&&(D&&(D+=" "),D+=S);return D}const jS=m=>{if(typeof m=="string")return m;let v,S="";for(let D=0;D<m.length;D++)m[D]&&(v=jS(m[D]))&&(S&&(S+=" "),S+=v);return S};function Fz(m,...v){let S,D,O,F=X;function X(re){const J=v.reduce((oe,ze)=>ze(oe),m());return S=Pz(J),D=S.cache.get,O=S.cache.set,F=r,r(re)}function r(re){const J=D(re);if(J)return J;const oe=Bz(re,S);return O(re,oe),oe}return function(){return F(Nz.apply(null,arguments))}}const ws=m=>{const v=S=>S[m]||[];return v.isThemeGetter=!0,v},qS=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,GS=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Vz=/^\d+\/\d+$/,Uz=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,jz=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,qz=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Gz=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Hz=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,S_=m=>Vz.test(m),ar=m=>!!m&&!Number.isNaN(Number(m)),jf=m=>!!m&&Number.isInteger(Number(m)),cT=m=>m.endsWith("%")&&ar(m.slice(0,-1)),qf=m=>Uz.test(m),Zz=()=>!0,$z=m=>jz.test(m)&&!qz.test(m),V1=()=>!1,Xz=m=>Gz.test(m),Yz=m=>Hz.test(m),Wz=m=>!Ji(m)&&!Qi(m),Kz=m=>B_(m,$S,V1),Ji=m=>qS.test(m),Xp=m=>B_(m,XS,$z),jx=m=>B_(m,lL,ar),Jz=m=>B_(m,HS,V1),Qz=m=>B_(m,ZS,Yz),eL=m=>B_(m,V1,Xz),Qi=m=>GS.test(m),Gg=m=>N_(m,XS),tL=m=>N_(m,cL),iL=m=>N_(m,HS),nL=m=>N_(m,$S),rL=m=>N_(m,ZS),aL=m=>N_(m,uL,!0),B_=(m,v,S)=>{const D=qS.exec(m);return D?D[1]?v(D[1]):S(D[2]):!1},N_=(m,v,S=!1)=>{const D=GS.exec(m);return D?D[1]?v(D[1]):S:!1},HS=m=>m==="position",sL=new Set(["image","url"]),ZS=m=>sL.has(m),oL=new Set(["length","size","percentage"]),$S=m=>oL.has(m),XS=m=>m==="length",lL=m=>m==="number",cL=m=>m==="family-name",uL=m=>m==="shadow",hL=()=>{const m=ws("color"),v=ws("font"),S=ws("text"),D=ws("font-weight"),O=ws("tracking"),F=ws("leading"),X=ws("breakpoint"),r=ws("container"),re=ws("spacing"),J=ws("radius"),oe=ws("shadow"),ze=ws("inset-shadow"),je=ws("drop-shadow"),ft=ws("blur"),Le=ws("perspective"),Fe=ws("aspect"),qe=ws("ease"),He=ws("animate"),tt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],mt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Tt=()=>["auto","hidden","clip","visible","scroll"],kt=()=>["auto","contain","none"],At=()=>[Qi,Ji,re],ot=()=>[S_,"full","auto",...At()],hi=()=>[jf,"none","subgrid",Qi,Ji],Mi=()=>["auto",{span:["full",jf,Qi,Ji]},jf,Qi,Ji],ti=()=>[jf,"auto",Qi,Ji],Rt=()=>["auto","min","max","fr",Qi,Ji],ui=()=>["start","end","center","between","around","evenly","stretch","baseline"],Si=()=>["start","end","center","stretch"],di=()=>["auto",...At()],ii=()=>[S_,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...At()],pt=()=>[m,Qi,Ji],ni=()=>[cT,Gg,Xp],pi=()=>["","none","full",J,Qi,Ji],ai=()=>["",ar,Gg,Xp],We=()=>["solid","dashed","dotted","double"],Jt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ei=()=>["","none",ft,Qi,Ji],Ot=()=>["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Qi,Ji],ji=()=>["none",ar,Qi,Ji],An=()=>["none",ar,Qi,Ji],Xi=()=>[ar,Qi,Ji],nr=()=>[S_,"full",...At()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[qf],breakpoint:[qf],color:[Zz],container:[qf],"drop-shadow":[qf],ease:["in","out","in-out"],font:[Wz],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[qf],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[qf],shadow:[qf],spacing:["px",ar],text:[qf],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",S_,Ji,Qi,Fe]}],container:["container"],columns:[{columns:[ar,Ji,Qi,r]}],"break-after":[{"break-after":tt()}],"break-before":[{"break-before":tt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...mt(),Ji,Qi]}],overflow:[{overflow:Tt()}],"overflow-x":[{"overflow-x":Tt()}],"overflow-y":[{"overflow-y":Tt()}],overscroll:[{overscroll:kt()}],"overscroll-x":[{"overscroll-x":kt()}],"overscroll-y":[{"overscroll-y":kt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:ot()}],"inset-x":[{"inset-x":ot()}],"inset-y":[{"inset-y":ot()}],start:[{start:ot()}],end:[{end:ot()}],top:[{top:ot()}],right:[{right:ot()}],bottom:[{bottom:ot()}],left:[{left:ot()}],visibility:["visible","invisible","collapse"],z:[{z:[jf,"auto",Qi,Ji]}],basis:[{basis:[S_,"full","auto",r,...At()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[ar,S_,"auto","initial","none",Ji]}],grow:[{grow:["",ar,Qi,Ji]}],shrink:[{shrink:["",ar,Qi,Ji]}],order:[{order:[jf,"first","last","none",Qi,Ji]}],"grid-cols":[{"grid-cols":hi()}],"col-start-end":[{col:Mi()}],"col-start":[{"col-start":ti()}],"col-end":[{"col-end":ti()}],"grid-rows":[{"grid-rows":hi()}],"row-start-end":[{row:Mi()}],"row-start":[{"row-start":ti()}],"row-end":[{"row-end":ti()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Rt()}],"auto-rows":[{"auto-rows":Rt()}],gap:[{gap:At()}],"gap-x":[{"gap-x":At()}],"gap-y":[{"gap-y":At()}],"justify-content":[{justify:[...ui(),"normal"]}],"justify-items":[{"justify-items":[...Si(),"normal"]}],"justify-self":[{"justify-self":["auto",...Si()]}],"align-content":[{content:["normal",...ui()]}],"align-items":[{items:[...Si(),"baseline"]}],"align-self":[{self:["auto",...Si(),"baseline"]}],"place-content":[{"place-content":ui()}],"place-items":[{"place-items":[...Si(),"baseline"]}],"place-self":[{"place-self":["auto",...Si()]}],p:[{p:At()}],px:[{px:At()}],py:[{py:At()}],ps:[{ps:At()}],pe:[{pe:At()}],pt:[{pt:At()}],pr:[{pr:At()}],pb:[{pb:At()}],pl:[{pl:At()}],m:[{m:di()}],mx:[{mx:di()}],my:[{my:di()}],ms:[{ms:di()}],me:[{me:di()}],mt:[{mt:di()}],mr:[{mr:di()}],mb:[{mb:di()}],ml:[{ml:di()}],"space-x":[{"space-x":At()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":At()}],"space-y-reverse":["space-y-reverse"],size:[{size:ii()}],w:[{w:[r,"screen",...ii()]}],"min-w":[{"min-w":[r,"screen","none",...ii()]}],"max-w":[{"max-w":[r,"screen","none","prose",{screen:[X]},...ii()]}],h:[{h:["screen",...ii()]}],"min-h":[{"min-h":["screen","none",...ii()]}],"max-h":[{"max-h":["screen",...ii()]}],"font-size":[{text:["base",S,Gg,Xp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[D,Qi,jx]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",cT,Ji]}],"font-family":[{font:[tL,Ji,v]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[O,Qi,Ji]}],"line-clamp":[{"line-clamp":[ar,"none",Qi,jx]}],leading:[{leading:[F,...At()]}],"list-image":[{"list-image":["none",Qi,Ji]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Qi,Ji]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:pt()}],"text-color":[{text:pt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...We(),"wavy"]}],"text-decoration-thickness":[{decoration:[ar,"from-font","auto",Qi,Xp]}],"text-decoration-color":[{decoration:pt()}],"underline-offset":[{"underline-offset":[ar,"auto",Qi,Ji]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:At()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Qi,Ji]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Qi,Ji]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...mt(),iL,Jz]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:["auto","cover","contain",nL,Kz]}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},jf,Qi,Ji],radial:["",Qi,Ji],conic:[jf,Qi,Ji]},rL,Qz]}],"bg-color":[{bg:pt()}],"gradient-from-pos":[{from:ni()}],"gradient-via-pos":[{via:ni()}],"gradient-to-pos":[{to:ni()}],"gradient-from":[{from:pt()}],"gradient-via":[{via:pt()}],"gradient-to":[{to:pt()}],rounded:[{rounded:pi()}],"rounded-s":[{"rounded-s":pi()}],"rounded-e":[{"rounded-e":pi()}],"rounded-t":[{"rounded-t":pi()}],"rounded-r":[{"rounded-r":pi()}],"rounded-b":[{"rounded-b":pi()}],"rounded-l":[{"rounded-l":pi()}],"rounded-ss":[{"rounded-ss":pi()}],"rounded-se":[{"rounded-se":pi()}],"rounded-ee":[{"rounded-ee":pi()}],"rounded-es":[{"rounded-es":pi()}],"rounded-tl":[{"rounded-tl":pi()}],"rounded-tr":[{"rounded-tr":pi()}],"rounded-br":[{"rounded-br":pi()}],"rounded-bl":[{"rounded-bl":pi()}],"border-w":[{border:ai()}],"border-w-x":[{"border-x":ai()}],"border-w-y":[{"border-y":ai()}],"border-w-s":[{"border-s":ai()}],"border-w-e":[{"border-e":ai()}],"border-w-t":[{"border-t":ai()}],"border-w-r":[{"border-r":ai()}],"border-w-b":[{"border-b":ai()}],"border-w-l":[{"border-l":ai()}],"divide-x":[{"divide-x":ai()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ai()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...We(),"hidden","none"]}],"divide-style":[{divide:[...We(),"hidden","none"]}],"border-color":[{border:pt()}],"border-color-x":[{"border-x":pt()}],"border-color-y":[{"border-y":pt()}],"border-color-s":[{"border-s":pt()}],"border-color-e":[{"border-e":pt()}],"border-color-t":[{"border-t":pt()}],"border-color-r":[{"border-r":pt()}],"border-color-b":[{"border-b":pt()}],"border-color-l":[{"border-l":pt()}],"divide-color":[{divide:pt()}],"outline-style":[{outline:[...We(),"none","hidden"]}],"outline-offset":[{"outline-offset":[ar,Qi,Ji]}],"outline-w":[{outline:["",ar,Gg,Xp]}],"outline-color":[{outline:[m]}],shadow:[{shadow:["","none",oe,aL,eL]}],"shadow-color":[{shadow:pt()}],"inset-shadow":[{"inset-shadow":["none",Qi,Ji,ze]}],"inset-shadow-color":[{"inset-shadow":pt()}],"ring-w":[{ring:ai()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:pt()}],"ring-offset-w":[{"ring-offset":[ar,Xp]}],"ring-offset-color":[{"ring-offset":pt()}],"inset-ring-w":[{"inset-ring":ai()}],"inset-ring-color":[{"inset-ring":pt()}],opacity:[{opacity:[ar,Qi,Ji]}],"mix-blend":[{"mix-blend":[...Jt(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Jt()}],filter:[{filter:["","none",Qi,Ji]}],blur:[{blur:Ei()}],brightness:[{brightness:[ar,Qi,Ji]}],contrast:[{contrast:[ar,Qi,Ji]}],"drop-shadow":[{"drop-shadow":["","none",je,Qi,Ji]}],grayscale:[{grayscale:["",ar,Qi,Ji]}],"hue-rotate":[{"hue-rotate":[ar,Qi,Ji]}],invert:[{invert:["",ar,Qi,Ji]}],saturate:[{saturate:[ar,Qi,Ji]}],sepia:[{sepia:["",ar,Qi,Ji]}],"backdrop-filter":[{"backdrop-filter":["","none",Qi,Ji]}],"backdrop-blur":[{"backdrop-blur":Ei()}],"backdrop-brightness":[{"backdrop-brightness":[ar,Qi,Ji]}],"backdrop-contrast":[{"backdrop-contrast":[ar,Qi,Ji]}],"backdrop-grayscale":[{"backdrop-grayscale":["",ar,Qi,Ji]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[ar,Qi,Ji]}],"backdrop-invert":[{"backdrop-invert":["",ar,Qi,Ji]}],"backdrop-opacity":[{"backdrop-opacity":[ar,Qi,Ji]}],"backdrop-saturate":[{"backdrop-saturate":[ar,Qi,Ji]}],"backdrop-sepia":[{"backdrop-sepia":["",ar,Qi,Ji]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":At()}],"border-spacing-x":[{"border-spacing-x":At()}],"border-spacing-y":[{"border-spacing-y":At()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Qi,Ji]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[ar,"initial",Qi,Ji]}],ease:[{ease:["linear","initial",qe,Qi,Ji]}],delay:[{delay:[ar,Qi,Ji]}],animate:[{animate:["none",He,Qi,Ji]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[Le,Qi,Ji]}],"perspective-origin":[{"perspective-origin":Ot()}],rotate:[{rotate:ji()}],"rotate-x":[{"rotate-x":ji()}],"rotate-y":[{"rotate-y":ji()}],"rotate-z":[{"rotate-z":ji()}],scale:[{scale:An()}],"scale-x":[{"scale-x":An()}],"scale-y":[{"scale-y":An()}],"scale-z":[{"scale-z":An()}],"scale-3d":["scale-3d"],skew:[{skew:Xi()}],"skew-x":[{"skew-x":Xi()}],"skew-y":[{"skew-y":Xi()}],transform:[{transform:[Qi,Ji,"","none","gpu","cpu"]}],"transform-origin":[{origin:Ot()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:nr()}],"translate-x":[{"translate-x":nr()}],"translate-y":[{"translate-y":nr()}],"translate-z":[{"translate-z":nr()}],"translate-none":["translate-none"],accent:[{accent:pt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:pt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Qi,Ji]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":At()}],"scroll-mx":[{"scroll-mx":At()}],"scroll-my":[{"scroll-my":At()}],"scroll-ms":[{"scroll-ms":At()}],"scroll-me":[{"scroll-me":At()}],"scroll-mt":[{"scroll-mt":At()}],"scroll-mr":[{"scroll-mr":At()}],"scroll-mb":[{"scroll-mb":At()}],"scroll-ml":[{"scroll-ml":At()}],"scroll-p":[{"scroll-p":At()}],"scroll-px":[{"scroll-px":At()}],"scroll-py":[{"scroll-py":At()}],"scroll-ps":[{"scroll-ps":At()}],"scroll-pe":[{"scroll-pe":At()}],"scroll-pt":[{"scroll-pt":At()}],"scroll-pr":[{"scroll-pr":At()}],"scroll-pb":[{"scroll-pb":At()}],"scroll-pl":[{"scroll-pl":At()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Qi,Ji]}],fill:[{fill:["none",...pt()]}],"stroke-w":[{stroke:[ar,Gg,Xp,jx]}],stroke:[{stroke:["none",...pt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["before","after","placeholder","file","marker","selection","first-line","first-letter","backdrop","*","**"]}},dL=Fz(hL);function Xa(...m){return dL(bd(m))}const fL=N1("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),lc=Ie.forwardRef(({className:m,variant:v,size:S,asChild:D=!1,...O},F)=>{const X=D?D_:"button";return _e.jsx(X,{className:Xa(fL({variant:v,size:S,className:m})),ref:F,...O})});lc.displayName="Button";const U1=Ie.forwardRef(({className:m,...v},S)=>_e.jsx("div",{ref:S,className:Xa("rounded-xl border bg-card text-card-foreground shadow",m),...v}));U1.displayName="Card";const j1=Ie.forwardRef(({className:m,...v},S)=>_e.jsx("div",{ref:S,className:Xa("flex flex-col space-y-1.5 p-6",m),...v}));j1.displayName="CardHeader";const q1=Ie.forwardRef(({className:m,...v},S)=>_e.jsx("div",{ref:S,className:Xa("font-semibold leading-none tracking-tight",m),...v}));q1.displayName="CardTitle";const G1=Ie.forwardRef(({className:m,...v},S)=>_e.jsx("div",{ref:S,className:Xa("text-sm text-muted-foreground",m),...v}));G1.displayName="CardDescription";const H1=Ie.forwardRef(({className:m,...v},S)=>_e.jsx("div",{ref:S,className:Xa("p-6 pt-0",m),...v}));H1.displayName="CardContent";const Z1=Ie.forwardRef(({className:m,...v},S)=>_e.jsx("div",{ref:S,className:Xa("flex items-center p-6 pt-0",m),...v}));Z1.displayName="CardFooter";var pL=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],xu=pL.reduce((m,v)=>{const S=Ie.forwardRef((D,O)=>{const{asChild:F,...X}=D,r=F?D_:v;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),_e.jsx(r,{...X,ref:O})});return S.displayName=`Primitive.${v}`,{...m,[v]:S}},{});function YS(m,v){m&&M1.flushSync(()=>m.dispatchEvent(v))}var mL="Label",WS=Ie.forwardRef((m,v)=>_e.jsx(xu.label,{...m,ref:v,onMouseDown:S=>{var O;S.target.closest("button, input, select, textarea")||((O=m.onMouseDown)==null||O.call(m,S),!S.defaultPrevented&&S.detail>1&&S.preventDefault())}}));WS.displayName=mL;var KS=WS;const _L=N1("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),JS=Ie.forwardRef(({className:m,...v},S)=>_e.jsx(KS,{ref:S,className:Xa(_L(),m),...v}));JS.displayName=KS.displayName;const QS=$R,eE=Ie.createContext({}),Hf=({...m})=>_e.jsx(eE.Provider,{value:{name:m.name},children:_e.jsx(KR,{...m})}),w0=()=>{const m=Ie.useContext(eE),v=Ie.useContext(tE),{getFieldState:S,formState:D}=x0(),O=S(m.name,D);if(!m)throw new Error("useFormField should be used within <FormField>");const{id:F}=v;return{id:F,name:m.name,formItemId:`${F}-form-item`,formDescriptionId:`${F}-form-item-description`,formMessageId:`${F}-form-item-message`,...O}},tE=Ie.createContext({}),md=Ie.forwardRef(({className:m,...v},S)=>{const D=Ie.useId();return _e.jsx(tE.Provider,{value:{id:D},children:_e.jsx("div",{ref:S,className:Xa("space-y-2",m),...v})})});md.displayName="FormItem";const cc=Ie.forwardRef(({className:m,...v},S)=>{const{error:D,formItemId:O}=w0();return _e.jsx(JS,{ref:S,className:Xa(D&&"text-destructive",m),htmlFor:O,...v})});cc.displayName="FormLabel";const _d=Ie.forwardRef(({...m},v)=>{const{error:S,formItemId:D,formDescriptionId:O,formMessageId:F}=w0();return _e.jsx(D_,{ref:v,id:D,"aria-describedby":S?`${O} ${F}`:`${O}`,"aria-invalid":!!S,...m})});_d.displayName="FormControl";const gd=Ie.forwardRef(({className:m,...v},S)=>{const{formDescriptionId:D}=w0();return _e.jsx("p",{ref:S,id:D,className:Xa("text-[0.8rem] text-muted-foreground",m),...v})});gd.displayName="FormDescription";const yd=Ie.forwardRef(({className:m,children:v,...S},D)=>{const{error:O,formMessageId:F}=w0(),X=O?String((O==null?void 0:O.message)??""):v;return X?_e.jsx("p",{ref:D,id:F,className:Xa("text-[0.8rem] font-medium text-destructive",m),...S,children:X}):null});yd.displayName="FormMessage";const vd=Ie.forwardRef(({className:m,type:v,...S},D)=>_e.jsx("input",{type:v,className:Xa("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",m),ref:D,...S}));vd.displayName="Input";const $1=Ie.forwardRef(({className:m,...v},S)=>_e.jsx("textarea",{className:Xa("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",m),ref:S,...v}));$1.displayName="Textarea";const uT=m=>{let v;const S=new Set,D=(J,oe)=>{const ze=typeof J=="function"?J(v):J;if(!Object.is(ze,v)){const je=v;v=oe??(typeof ze!="object"||ze===null)?ze:Object.assign({},v,ze),S.forEach(ft=>ft(v,je))}},O=()=>v,r={setState:D,getState:O,getInitialState:()=>re,subscribe:J=>(S.add(J),()=>S.delete(J))},re=v=m(D,O,r);return r},gL=m=>m?uT(m):uT,yL=m=>m;function vL(m,v=yL){const S=Zi.useSyncExternalStore(m.subscribe,()=>v(m.getState()),()=>v(m.getInitialState()));return Zi.useDebugValue(S),S}const hT=m=>{const v=gL(m),S=D=>vL(v,D);return Object.assign(S,v),S},xL=m=>m?hT(m):hT,bL=xL(m=>({toasts:[],addToast:v=>m(S=>({toasts:[...S.toasts,v]})),removeToast:v=>m(S=>({toasts:S.toasts.filter(D=>D.id!==v)}))})),X1=()=>{const{addToast:m,removeToast:v}=bL(),S=D=>{const O=Math.random().toString(36).substr(2,9),F={id:O,duration:3e3,position:"top-right",...D};m(F),setTimeout(()=>v(O),F.duration)};return{toast:S,success:D=>S({message:D,type:"success"}),error:D=>S({message:D,type:"error"}),info:D=>S({message:D,type:"info"})}},wL=1,TL=1e6;let qx=0;function SL(){return qx=(qx+1)%Number.MAX_SAFE_INTEGER,qx.toString()}const Gx=new Map,dT=m=>{if(Gx.has(m))return;const v=setTimeout(()=>{Gx.delete(m),Wg({type:"REMOVE_TOAST",toastId:m})},TL);Gx.set(m,v)},EL=(m,v)=>{switch(v.type){case"ADD_TOAST":return{...m,toasts:[v.toast,...m.toasts].slice(0,wL)};case"UPDATE_TOAST":return{...m,toasts:m.toasts.map(S=>S.id===v.toast.id?{...S,...v.toast}:S)};case"DISMISS_TOAST":{const{toastId:S}=v;return S?dT(S):m.toasts.forEach(D=>{dT(D.id)}),{...m,toasts:m.toasts.map(D=>D.id===S||S===void 0?{...D,open:!1}:D)}}case"REMOVE_TOAST":return v.toastId===void 0?{...m,toasts:[]}:{...m,toasts:m.toasts.filter(S=>S.id!==v.toastId)}}},qv=[];let Gv={toasts:[]};function Wg(m){Gv=EL(Gv,m),qv.forEach(v=>{v(Gv)})}function AL({...m}){const v=SL(),S=O=>Wg({type:"UPDATE_TOAST",toast:{...O,id:v}}),D=()=>Wg({type:"DISMISS_TOAST",toastId:v});return Wg({type:"ADD_TOAST",toast:{...m,id:v,open:!0,onOpenChange:O=>{O||D()}}}),{id:v,dismiss:D,update:S}}function ML(){const[m,v]=Ie.useState(Gv);return Ie.useEffect(()=>(qv.push(v),()=>{const S=qv.indexOf(v);S>-1&&qv.splice(S,1)}),[m]),{...m,toast:AL,dismiss:S=>Wg({type:"DISMISS_TOAST",toastId:S})}}function _l(m,v,{checkForDefaultPrevented:S=!0}={}){return function(O){if(m==null||m(O),S===!1||!O.defaultPrevented)return v==null?void 0:v(O)}}function iE(m,v=[]){let S=[];function D(F,X){const r=Ie.createContext(X),re=S.length;S=[...S,X];const J=ze=>{var He;const{scope:je,children:ft,...Le}=ze,Fe=((He=je==null?void 0:je[m])==null?void 0:He[re])||r,qe=Ie.useMemo(()=>Le,Object.values(Le));return _e.jsx(Fe.Provider,{value:qe,children:ft})};J.displayName=F+"Provider";function oe(ze,je){var Fe;const ft=((Fe=je==null?void 0:je[m])==null?void 0:Fe[re])||r,Le=Ie.useContext(ft);if(Le)return Le;if(X!==void 0)return X;throw new Error(`\`${ze}\` must be used within \`${F}\``)}return[J,oe]}const O=()=>{const F=S.map(X=>Ie.createContext(X));return function(r){const re=(r==null?void 0:r[m])||F;return Ie.useMemo(()=>({[`__scope${m}`]:{...r,[m]:re}}),[r,re])}};return O.scopeName=m,[D,CL(O,...v)]}function CL(...m){const v=m[0];if(m.length===1)return v;const S=()=>{const D=m.map(O=>({useScope:O(),scopeName:O.scopeName}));return function(F){const X=D.reduce((r,{useScope:re,scopeName:J})=>{const ze=re(F)[`__scope${J}`];return{...r,...ze}},{});return Ie.useMemo(()=>({[`__scope${v.scopeName}`]:X}),[X])}};return S.scopeName=v.scopeName,S}function IL(m){const v=m+"CollectionProvider",[S,D]=iE(v),[O,F]=S(v,{collectionRef:{current:null},itemMap:new Map}),X=ft=>{const{scope:Le,children:Fe}=ft,qe=Zi.useRef(null),He=Zi.useRef(new Map).current;return _e.jsx(O,{scope:Le,itemMap:He,collectionRef:qe,children:Fe})};X.displayName=v;const r=m+"CollectionSlot",re=Zi.forwardRef((ft,Le)=>{const{scope:Fe,children:qe}=ft,He=F(r,Fe),tt=rm(Le,He.collectionRef);return _e.jsx(D_,{ref:tt,children:qe})});re.displayName=r;const J=m+"CollectionItemSlot",oe="data-radix-collection-item",ze=Zi.forwardRef((ft,Le)=>{const{scope:Fe,children:qe,...He}=ft,tt=Zi.useRef(null),mt=rm(Le,tt),Tt=F(J,Fe);return Zi.useEffect(()=>(Tt.itemMap.set(tt,{ref:tt,...He}),()=>void Tt.itemMap.delete(tt))),_e.jsx(D_,{[oe]:"",ref:mt,children:qe})});ze.displayName=J;function je(ft){const Le=F(m+"CollectionConsumer",ft);return Zi.useCallback(()=>{const qe=Le.collectionRef.current;if(!qe)return[];const He=Array.from(qe.querySelectorAll(`[${oe}]`));return Array.from(Le.itemMap.values()).sort((Tt,kt)=>He.indexOf(Tt.ref.current)-He.indexOf(kt.ref.current))},[Le.collectionRef,Le.itemMap])}return[{Provider:X,Slot:re,ItemSlot:ze},je,D]}function Ed(m){const v=Ie.useRef(m);return Ie.useEffect(()=>{v.current=m}),Ie.useMemo(()=>(...S)=>{var D;return(D=v.current)==null?void 0:D.call(v,...S)},[])}function RL(m,v=globalThis==null?void 0:globalThis.document){const S=Ed(m);Ie.useEffect(()=>{const D=O=>{O.key==="Escape"&&S(O)};return v.addEventListener("keydown",D,{capture:!0}),()=>v.removeEventListener("keydown",D,{capture:!0})},[S,v])}var DL="DismissableLayer",p1="dismissableLayer.update",zL="dismissableLayer.pointerDownOutside",LL="dismissableLayer.focusOutside",fT,nE=Ie.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),rE=Ie.forwardRef((m,v)=>{const{disableOutsidePointerEvents:S=!1,onEscapeKeyDown:D,onPointerDownOutside:O,onFocusOutside:F,onInteractOutside:X,onDismiss:r,...re}=m,J=Ie.useContext(nE),[oe,ze]=Ie.useState(null),je=(oe==null?void 0:oe.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ft]=Ie.useState({}),Le=rm(v,ot=>ze(ot)),Fe=Array.from(J.layers),[qe]=[...J.layersWithOutsidePointerEventsDisabled].slice(-1),He=Fe.indexOf(qe),tt=oe?Fe.indexOf(oe):-1,mt=J.layersWithOutsidePointerEventsDisabled.size>0,Tt=tt>=He,kt=PL(ot=>{const hi=ot.target,Mi=[...J.branches].some(ti=>ti.contains(hi));!Tt||Mi||(O==null||O(ot),X==null||X(ot),ot.defaultPrevented||r==null||r())},je),At=kL(ot=>{const hi=ot.target;[...J.branches].some(ti=>ti.contains(hi))||(F==null||F(ot),X==null||X(ot),ot.defaultPrevented||r==null||r())},je);return RL(ot=>{tt===J.layers.size-1&&(D==null||D(ot),!ot.defaultPrevented&&r&&(ot.preventDefault(),r()))},je),Ie.useEffect(()=>{if(oe)return S&&(J.layersWithOutsidePointerEventsDisabled.size===0&&(fT=je.body.style.pointerEvents,je.body.style.pointerEvents="none"),J.layersWithOutsidePointerEventsDisabled.add(oe)),J.layers.add(oe),pT(),()=>{S&&J.layersWithOutsidePointerEventsDisabled.size===1&&(je.body.style.pointerEvents=fT)}},[oe,je,S,J]),Ie.useEffect(()=>()=>{oe&&(J.layers.delete(oe),J.layersWithOutsidePointerEventsDisabled.delete(oe),pT())},[oe,J]),Ie.useEffect(()=>{const ot=()=>ft({});return document.addEventListener(p1,ot),()=>document.removeEventListener(p1,ot)},[]),_e.jsx(xu.div,{...re,ref:Le,style:{pointerEvents:mt?Tt?"auto":"none":void 0,...m.style},onFocusCapture:_l(m.onFocusCapture,At.onFocusCapture),onBlurCapture:_l(m.onBlurCapture,At.onBlurCapture),onPointerDownCapture:_l(m.onPointerDownCapture,kt.onPointerDownCapture)})});rE.displayName=DL;var OL="DismissableLayerBranch",aE=Ie.forwardRef((m,v)=>{const S=Ie.useContext(nE),D=Ie.useRef(null),O=rm(v,D);return Ie.useEffect(()=>{const F=D.current;if(F)return S.branches.add(F),()=>{S.branches.delete(F)}},[S.branches]),_e.jsx(xu.div,{...m,ref:O})});aE.displayName=OL;function PL(m,v=globalThis==null?void 0:globalThis.document){const S=Ed(m),D=Ie.useRef(!1),O=Ie.useRef(()=>{});return Ie.useEffect(()=>{const F=r=>{if(r.target&&!D.current){let re=function(){sE(zL,S,J,{discrete:!0})};const J={originalEvent:r};r.pointerType==="touch"?(v.removeEventListener("click",O.current),O.current=re,v.addEventListener("click",O.current,{once:!0})):re()}else v.removeEventListener("click",O.current);D.current=!1},X=window.setTimeout(()=>{v.addEventListener("pointerdown",F)},0);return()=>{window.clearTimeout(X),v.removeEventListener("pointerdown",F),v.removeEventListener("click",O.current)}},[v,S]),{onPointerDownCapture:()=>D.current=!0}}function kL(m,v=globalThis==null?void 0:globalThis.document){const S=Ed(m),D=Ie.useRef(!1);return Ie.useEffect(()=>{const O=F=>{F.target&&!D.current&&sE(LL,S,{originalEvent:F},{discrete:!1})};return v.addEventListener("focusin",O),()=>v.removeEventListener("focusin",O)},[v,S]),{onFocusCapture:()=>D.current=!0,onBlurCapture:()=>D.current=!1}}function pT(){const m=new CustomEvent(p1);document.dispatchEvent(m)}function sE(m,v,S,{discrete:D}){const O=S.originalEvent.target,F=new CustomEvent(m,{bubbles:!1,cancelable:!0,detail:S});v&&O.addEventListener(m,v,{once:!0}),D?YS(O,F):O.dispatchEvent(F)}var BL=rE,NL=aE,o0=globalThis!=null&&globalThis.document?Ie.useLayoutEffect:()=>{},FL="Portal",oE=Ie.forwardRef((m,v)=>{var r;const{container:S,...D}=m,[O,F]=Ie.useState(!1);o0(()=>F(!0),[]);const X=S||O&&((r=globalThis==null?void 0:globalThis.document)==null?void 0:r.body);return X?n3.createPortal(_e.jsx(xu.div,{...D,ref:v}),X):null});oE.displayName=FL;function VL(m,v){return Ie.useReducer((S,D)=>v[S][D]??S,m)}var lE=m=>{const{present:v,children:S}=m,D=UL(v),O=typeof S=="function"?S({present:D.isPresent}):Ie.Children.only(S),F=rm(D.ref,jL(O));return typeof S=="function"||D.isPresent?Ie.cloneElement(O,{ref:F}):null};lE.displayName="Presence";function UL(m){const[v,S]=Ie.useState(),D=Ie.useRef({}),O=Ie.useRef(m),F=Ie.useRef("none"),X=m?"mounted":"unmounted",[r,re]=VL(X,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Ie.useEffect(()=>{const J=Pv(D.current);F.current=r==="mounted"?J:"none"},[r]),o0(()=>{const J=D.current,oe=O.current;if(oe!==m){const je=F.current,ft=Pv(J);m?re("MOUNT"):ft==="none"||(J==null?void 0:J.display)==="none"?re("UNMOUNT"):re(oe&&je!==ft?"ANIMATION_OUT":"UNMOUNT"),O.current=m}},[m,re]),o0(()=>{if(v){let J;const oe=v.ownerDocument.defaultView??window,ze=ft=>{const Fe=Pv(D.current).includes(ft.animationName);if(ft.target===v&&Fe&&(re("ANIMATION_END"),!O.current)){const qe=v.style.animationFillMode;v.style.animationFillMode="forwards",J=oe.setTimeout(()=>{v.style.animationFillMode==="forwards"&&(v.style.animationFillMode=qe)})}},je=ft=>{ft.target===v&&(F.current=Pv(D.current))};return v.addEventListener("animationstart",je),v.addEventListener("animationcancel",ze),v.addEventListener("animationend",ze),()=>{oe.clearTimeout(J),v.removeEventListener("animationstart",je),v.removeEventListener("animationcancel",ze),v.removeEventListener("animationend",ze)}}else re("ANIMATION_END")},[v,re]),{isPresent:["mounted","unmountSuspended"].includes(r),ref:Ie.useCallback(J=>{J&&(D.current=getComputedStyle(J)),S(J)},[])}}function Pv(m){return(m==null?void 0:m.animationName)||"none"}function jL(m){var D,O;let v=(D=Object.getOwnPropertyDescriptor(m.props,"ref"))==null?void 0:D.get,S=v&&"isReactWarning"in v&&v.isReactWarning;return S?m.ref:(v=(O=Object.getOwnPropertyDescriptor(m,"ref"))==null?void 0:O.get,S=v&&"isReactWarning"in v&&v.isReactWarning,S?m.props.ref:m.props.ref||m.ref)}function qL({prop:m,defaultProp:v,onChange:S=()=>{}}){const[D,O]=GL({defaultProp:v,onChange:S}),F=m!==void 0,X=F?m:D,r=Ed(S),re=Ie.useCallback(J=>{if(F){const ze=typeof J=="function"?J(m):J;ze!==m&&r(ze)}else O(J)},[F,m,O,r]);return[X,re]}function GL({defaultProp:m,onChange:v}){const S=Ie.useState(m),[D]=S,O=Ie.useRef(D),F=Ed(v);return Ie.useEffect(()=>{O.current!==D&&(F(D),O.current=D)},[D,O,F]),S}var HL="VisuallyHidden",Y1=Ie.forwardRef((m,v)=>_e.jsx(xu.span,{...m,ref:v,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...m.style}}));Y1.displayName=HL;var W1="ToastProvider",[K1,ZL,$L]=IL("Toast"),[cE,VO]=iE("Toast",[$L]),[XL,T0]=cE(W1),uE=m=>{const{__scopeToast:v,label:S="Notification",duration:D=5e3,swipeDirection:O="right",swipeThreshold:F=50,children:X}=m,[r,re]=Ie.useState(null),[J,oe]=Ie.useState(0),ze=Ie.useRef(!1),je=Ie.useRef(!1);return S.trim()||console.error(`Invalid prop \`label\` supplied to \`${W1}\`. Expected non-empty \`string\`.`),_e.jsx(K1.Provider,{scope:v,children:_e.jsx(XL,{scope:v,label:S,duration:D,swipeDirection:O,swipeThreshold:F,toastCount:J,viewport:r,onViewportChange:re,onToastAdd:Ie.useCallback(()=>oe(ft=>ft+1),[]),onToastRemove:Ie.useCallback(()=>oe(ft=>ft-1),[]),isFocusedToastEscapeKeyDownRef:ze,isClosePausedRef:je,children:X})})};uE.displayName=W1;var hE="ToastViewport",YL=["F8"],m1="toast.viewportPause",_1="toast.viewportResume",dE=Ie.forwardRef((m,v)=>{const{__scopeToast:S,hotkey:D=YL,label:O="Notifications ({hotkey})",...F}=m,X=T0(hE,S),r=ZL(S),re=Ie.useRef(null),J=Ie.useRef(null),oe=Ie.useRef(null),ze=Ie.useRef(null),je=rm(v,ze,X.onViewportChange),ft=D.join("+").replace(/Key/g,"").replace(/Digit/g,""),Le=X.toastCount>0;Ie.useEffect(()=>{const qe=He=>{var mt;D.length!==0&&D.every(Tt=>He[Tt]||He.code===Tt)&&((mt=ze.current)==null||mt.focus())};return document.addEventListener("keydown",qe),()=>document.removeEventListener("keydown",qe)},[D]),Ie.useEffect(()=>{const qe=re.current,He=ze.current;if(Le&&qe&&He){const tt=()=>{if(!X.isClosePausedRef.current){const At=new CustomEvent(m1);He.dispatchEvent(At),X.isClosePausedRef.current=!0}},mt=()=>{if(X.isClosePausedRef.current){const At=new CustomEvent(_1);He.dispatchEvent(At),X.isClosePausedRef.current=!1}},Tt=At=>{!qe.contains(At.relatedTarget)&&mt()},kt=()=>{qe.contains(document.activeElement)||mt()};return qe.addEventListener("focusin",tt),qe.addEventListener("focusout",Tt),qe.addEventListener("pointermove",tt),qe.addEventListener("pointerleave",kt),window.addEventListener("blur",tt),window.addEventListener("focus",mt),()=>{qe.removeEventListener("focusin",tt),qe.removeEventListener("focusout",Tt),qe.removeEventListener("pointermove",tt),qe.removeEventListener("pointerleave",kt),window.removeEventListener("blur",tt),window.removeEventListener("focus",mt)}}},[Le,X.isClosePausedRef]);const Fe=Ie.useCallback(({tabbingDirection:qe})=>{const tt=r().map(mt=>{const Tt=mt.ref.current,kt=[Tt,...lO(Tt)];return qe==="forwards"?kt:kt.reverse()});return(qe==="forwards"?tt.reverse():tt).flat()},[r]);return Ie.useEffect(()=>{const qe=ze.current;if(qe){const He=tt=>{var kt,At,ot;const mt=tt.altKey||tt.ctrlKey||tt.metaKey;if(tt.key==="Tab"&&!mt){const hi=document.activeElement,Mi=tt.shiftKey;if(tt.target===qe&&Mi){(kt=J.current)==null||kt.focus();return}const ui=Fe({tabbingDirection:Mi?"backwards":"forwards"}),Si=ui.findIndex(di=>di===hi);Hx(ui.slice(Si+1))?tt.preventDefault():Mi?(At=J.current)==null||At.focus():(ot=oe.current)==null||ot.focus()}};return qe.addEventListener("keydown",He),()=>qe.removeEventListener("keydown",He)}},[r,Fe]),_e.jsxs(NL,{ref:re,role:"region","aria-label":O.replace("{hotkey}",ft),tabIndex:-1,style:{pointerEvents:Le?void 0:"none"},children:[Le&&_e.jsx(g1,{ref:J,onFocusFromOutsideViewport:()=>{const qe=Fe({tabbingDirection:"forwards"});Hx(qe)}}),_e.jsx(K1.Slot,{scope:S,children:_e.jsx(xu.ol,{tabIndex:-1,...F,ref:je})}),Le&&_e.jsx(g1,{ref:oe,onFocusFromOutsideViewport:()=>{const qe=Fe({tabbingDirection:"backwards"});Hx(qe)}})]})});dE.displayName=hE;var fE="ToastFocusProxy",g1=Ie.forwardRef((m,v)=>{const{__scopeToast:S,onFocusFromOutsideViewport:D,...O}=m,F=T0(fE,S);return _e.jsx(Y1,{"aria-hidden":!0,tabIndex:0,...O,ref:v,style:{position:"fixed"},onFocus:X=>{var J;const r=X.relatedTarget;!((J=F.viewport)!=null&&J.contains(r))&&D()}})});g1.displayName=fE;var S0="Toast",WL="toast.swipeStart",KL="toast.swipeMove",JL="toast.swipeCancel",QL="toast.swipeEnd",pE=Ie.forwardRef((m,v)=>{const{forceMount:S,open:D,defaultOpen:O,onOpenChange:F,...X}=m,[r=!0,re]=qL({prop:D,defaultProp:O,onChange:F});return _e.jsx(lE,{present:S||r,children:_e.jsx(iO,{open:r,...X,ref:v,onClose:()=>re(!1),onPause:Ed(m.onPause),onResume:Ed(m.onResume),onSwipeStart:_l(m.onSwipeStart,J=>{J.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:_l(m.onSwipeMove,J=>{const{x:oe,y:ze}=J.detail.delta;J.currentTarget.setAttribute("data-swipe","move"),J.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${oe}px`),J.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${ze}px`)}),onSwipeCancel:_l(m.onSwipeCancel,J=>{J.currentTarget.setAttribute("data-swipe","cancel"),J.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),J.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),J.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),J.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:_l(m.onSwipeEnd,J=>{const{x:oe,y:ze}=J.detail.delta;J.currentTarget.setAttribute("data-swipe","end"),J.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),J.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),J.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${oe}px`),J.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${ze}px`),re(!1)})})})});pE.displayName=S0;var[eO,tO]=cE(S0,{onClose(){}}),iO=Ie.forwardRef((m,v)=>{const{__scopeToast:S,type:D="foreground",duration:O,open:F,onClose:X,onEscapeKeyDown:r,onPause:re,onResume:J,onSwipeStart:oe,onSwipeMove:ze,onSwipeCancel:je,onSwipeEnd:ft,...Le}=m,Fe=T0(S0,S),[qe,He]=Ie.useState(null),tt=rm(v,di=>He(di)),mt=Ie.useRef(null),Tt=Ie.useRef(null),kt=O||Fe.duration,At=Ie.useRef(0),ot=Ie.useRef(kt),hi=Ie.useRef(0),{onToastAdd:Mi,onToastRemove:ti}=Fe,Rt=Ed(()=>{var ii;(qe==null?void 0:qe.contains(document.activeElement))&&((ii=Fe.viewport)==null||ii.focus()),X()}),ui=Ie.useCallback(di=>{!di||di===1/0||(window.clearTimeout(hi.current),At.current=new Date().getTime(),hi.current=window.setTimeout(Rt,di))},[Rt]);Ie.useEffect(()=>{const di=Fe.viewport;if(di){const ii=()=>{ui(ot.current),J==null||J()},pt=()=>{const ni=new Date().getTime()-At.current;ot.current=ot.current-ni,window.clearTimeout(hi.current),re==null||re()};return di.addEventListener(m1,pt),di.addEventListener(_1,ii),()=>{di.removeEventListener(m1,pt),di.removeEventListener(_1,ii)}}},[Fe.viewport,kt,re,J,ui]),Ie.useEffect(()=>{F&&!Fe.isClosePausedRef.current&&ui(kt)},[F,kt,Fe.isClosePausedRef,ui]),Ie.useEffect(()=>(Mi(),()=>ti()),[Mi,ti]);const Si=Ie.useMemo(()=>qe?bE(qe):null,[qe]);return Fe.viewport?_e.jsxs(_e.Fragment,{children:[Si&&_e.jsx(nO,{__scopeToast:S,role:"status","aria-live":D==="foreground"?"assertive":"polite","aria-atomic":!0,children:Si}),_e.jsx(eO,{scope:S,onClose:Rt,children:M1.createPortal(_e.jsx(K1.ItemSlot,{scope:S,children:_e.jsx(BL,{asChild:!0,onEscapeKeyDown:_l(r,()=>{Fe.isFocusedToastEscapeKeyDownRef.current||Rt(),Fe.isFocusedToastEscapeKeyDownRef.current=!1}),children:_e.jsx(xu.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":F?"open":"closed","data-swipe-direction":Fe.swipeDirection,...Le,ref:tt,style:{userSelect:"none",touchAction:"none",...m.style},onKeyDown:_l(m.onKeyDown,di=>{di.key==="Escape"&&(r==null||r(di.nativeEvent),di.nativeEvent.defaultPrevented||(Fe.isFocusedToastEscapeKeyDownRef.current=!0,Rt()))}),onPointerDown:_l(m.onPointerDown,di=>{di.button===0&&(mt.current={x:di.clientX,y:di.clientY})}),onPointerMove:_l(m.onPointerMove,di=>{if(!mt.current)return;const ii=di.clientX-mt.current.x,pt=di.clientY-mt.current.y,ni=!!Tt.current,pi=["left","right"].includes(Fe.swipeDirection),ai=["left","up"].includes(Fe.swipeDirection)?Math.min:Math.max,We=pi?ai(0,ii):0,Jt=pi?0:ai(0,pt),Ei=di.pointerType==="touch"?10:2,Ot={x:We,y:Jt},ji={originalEvent:di,delta:Ot};ni?(Tt.current=Ot,kv(KL,ze,ji,{discrete:!1})):mT(Ot,Fe.swipeDirection,Ei)?(Tt.current=Ot,kv(WL,oe,ji,{discrete:!1}),di.target.setPointerCapture(di.pointerId)):(Math.abs(ii)>Ei||Math.abs(pt)>Ei)&&(mt.current=null)}),onPointerUp:_l(m.onPointerUp,di=>{const ii=Tt.current,pt=di.target;if(pt.hasPointerCapture(di.pointerId)&&pt.releasePointerCapture(di.pointerId),Tt.current=null,mt.current=null,ii){const ni=di.currentTarget,pi={originalEvent:di,delta:ii};mT(ii,Fe.swipeDirection,Fe.swipeThreshold)?kv(QL,ft,pi,{discrete:!0}):kv(JL,je,pi,{discrete:!0}),ni.addEventListener("click",ai=>ai.preventDefault(),{once:!0})}})})})}),Fe.viewport)})]}):null}),nO=m=>{const{__scopeToast:v,children:S,...D}=m,O=T0(S0,v),[F,X]=Ie.useState(!1),[r,re]=Ie.useState(!1);return sO(()=>X(!0)),Ie.useEffect(()=>{const J=window.setTimeout(()=>re(!0),1e3);return()=>window.clearTimeout(J)},[]),r?null:_e.jsx(oE,{asChild:!0,children:_e.jsx(Y1,{...D,children:F&&_e.jsxs(_e.Fragment,{children:[O.label," ",S]})})})},rO="ToastTitle",mE=Ie.forwardRef((m,v)=>{const{__scopeToast:S,...D}=m;return _e.jsx(xu.div,{...D,ref:v})});mE.displayName=rO;var aO="ToastDescription",_E=Ie.forwardRef((m,v)=>{const{__scopeToast:S,...D}=m;return _e.jsx(xu.div,{...D,ref:v})});_E.displayName=aO;var gE="ToastAction",yE=Ie.forwardRef((m,v)=>{const{altText:S,...D}=m;return S.trim()?_e.jsx(xE,{altText:S,asChild:!0,children:_e.jsx(J1,{...D,ref:v})}):(console.error(`Invalid prop \`altText\` supplied to \`${gE}\`. Expected non-empty \`string\`.`),null)});yE.displayName=gE;var vE="ToastClose",J1=Ie.forwardRef((m,v)=>{const{__scopeToast:S,...D}=m,O=tO(vE,S);return _e.jsx(xE,{asChild:!0,children:_e.jsx(xu.button,{type:"button",...D,ref:v,onClick:_l(m.onClick,O.onClose)})})});J1.displayName=vE;var xE=Ie.forwardRef((m,v)=>{const{__scopeToast:S,altText:D,...O}=m;return _e.jsx(xu.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":D||void 0,...O,ref:v})});function bE(m){const v=[];return Array.from(m.childNodes).forEach(D=>{if(D.nodeType===D.TEXT_NODE&&D.textContent&&v.push(D.textContent),oO(D)){const O=D.ariaHidden||D.hidden||D.style.display==="none",F=D.dataset.radixToastAnnounceExclude==="";if(!O)if(F){const X=D.dataset.radixToastAnnounceAlt;X&&v.push(X)}else v.push(...bE(D))}}),v}function kv(m,v,S,{discrete:D}){const O=S.originalEvent.currentTarget,F=new CustomEvent(m,{bubbles:!0,cancelable:!0,detail:S});v&&O.addEventListener(m,v,{once:!0}),D?YS(O,F):O.dispatchEvent(F)}var mT=(m,v,S=0)=>{const D=Math.abs(m.x),O=Math.abs(m.y),F=D>O;return v==="left"||v==="right"?F&&D>S:!F&&O>S};function sO(m=()=>{}){const v=Ed(m);o0(()=>{let S=0,D=0;return S=window.requestAnimationFrame(()=>D=window.requestAnimationFrame(v)),()=>{window.cancelAnimationFrame(S),window.cancelAnimationFrame(D)}},[v])}function oO(m){return m.nodeType===m.ELEMENT_NODE}function lO(m){const v=[],S=document.createTreeWalker(m,NodeFilter.SHOW_ELEMENT,{acceptNode:D=>{const O=D.tagName==="INPUT"&&D.type==="hidden";return D.disabled||D.hidden||O?NodeFilter.FILTER_SKIP:D.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;S.nextNode();)v.push(S.currentNode);return v}function Hx(m){const v=document.activeElement;return m.some(S=>S===v?!0:(S.focus(),document.activeElement!==v))}var cO=uE,wE=dE,TE=pE,SE=mE,EE=_E,AE=yE,ME=J1;const uO=cO,CE=Ie.forwardRef(({className:m,...v},S)=>_e.jsx(wE,{ref:S,className:Xa("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",m),...v}));CE.displayName=wE.displayName;const hO=N1("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),IE=Ie.forwardRef(({className:m,variant:v,...S},D)=>_e.jsx(TE,{ref:D,className:Xa(hO({variant:v}),m),...S}));IE.displayName=TE.displayName;const dO=Ie.forwardRef(({className:m,...v},S)=>_e.jsx(AE,{ref:S,className:Xa("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",m),...v}));dO.displayName=AE.displayName;const RE=Ie.forwardRef(({className:m,...v},S)=>_e.jsx(ME,{ref:S,className:Xa("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",m),"toast-close":"",...v,children:_e.jsx(z1,{className:"h-4 w-4"})}));RE.displayName=ME.displayName;const DE=Ie.forwardRef(({className:m,...v},S)=>_e.jsx(SE,{ref:S,className:Xa("text-sm font-semibold [&+div]:text-xs",m),...v}));DE.displayName=SE.displayName;const zE=Ie.forwardRef(({className:m,...v},S)=>_e.jsx(EE,{ref:S,className:Xa("text-sm opacity-90",m),...v}));zE.displayName=EE.displayName;function Q1(){const{toasts:m}=ML();return _e.jsxs(uO,{children:[m.map(function({id:v,title:S,description:D,action:O,...F}){return _e.jsxs(IE,{...F,children:[_e.jsxs("div",{className:"grid gap-1",children:[S&&_e.jsx(DE,{children:S}),D&&_e.jsx(zE,{children:D})]}),O,_e.jsx(RE,{})]},v)}),_e.jsx(CE,{})]})}const fO=oh.object({title:oh.string().min(3,{message:"Title must be at least 3 characters"}),location:oh.string().min(3,{message:"Location is required"}),description:oh.string().min(10,{message:"Description must be at least 10 characters"}),price:oh.string().refine(m=>!isNaN(Number(m))&&Number(m)>0,{message:"Price must be a positive number"})});function pO(){const m=Wf(),{toast:v}=X1(),[S,D]=Ie.useState([]),[O,F]=Ie.useState([]),[X,r]=Ie.useState(!1),[re,J]=Ie.useState(!1),oe=MS({resolver:IS(fO),defaultValues:{title:"",location:"",description:"",price:""},mode:"onChange"}),ze=Le=>{if(!Le.target.files||Le.target.files.length===0)return;const Fe=Array.from(Le.target.files);D(He=>[...He,...Fe]);const qe=Fe.map(He=>URL.createObjectURL(He));F(He=>[...He,...qe])},je=Le=>{URL.revokeObjectURL(O[Le]),D(S.filter((Fe,qe)=>qe!==Le)),F(O.filter((Fe,qe)=>qe!==Le))};async function ft(Le){if(S.length===0){v({title:"Error",description:"Please upload at least one image",variant:"destructive"});return}r(!0),J(!0);try{const Fe=new FormData;Object.entries(Le).forEach(([He,tt])=>{Fe.append(`campground[${He}]`,tt)}),S.forEach(He=>{Fe.append("image",He)});const qe=await So.post("/campgrounds",Fe,{headers:{"Content-Type":"multipart/form-data",authorization:`Bearer ${localStorage.getItem("token")}`}});v({title:"Success!",description:"Your campground has been created"}),m("/campgrounds")}catch(Fe){console.error("Error creating campground:",Fe),v({title:"Error",description:"Failed to create campground. Please try again.",variant:"destructive"})}finally{r(!1),J(!1)}}return _e.jsxs("div",{className:"container mx-auto pt-20 px-4 md:px-6",style:{height:"94vh"},children:[_e.jsx(Q1,{}),_e.jsx("div",{className:"max-w-4xl mx-auto h-[80vh] bg-white rounded-lg shadow-2xl border border-black",children:_e.jsxs(U1,{className:"border-none shadow-lg h-full flex flex-col",children:[_e.jsxs(j1,{className:"bg-primary/5 rounded-t-lg flex-shrink-0",children:[_e.jsx(q1,{className:"text-4xl font-bold mb-2",children:"Create New Campground"}),_e.jsx(G1,{className:"text-lg",children:"Fill in the details below to add your campground"})]}),_e.jsx(H1,{className:"flex-grow overflow-y-auto p-8",children:_e.jsx(QS,{...oe,children:_e.jsxs("form",{onSubmit:oe.handleSubmit(ft),className:"space-y-8",children:[_e.jsx(Hf,{control:oe.control,name:"title",render:({field:Le})=>_e.jsxs(md,{children:[_e.jsx(cc,{className:"text-xl font-semibold",children:"Campground Name"}),_e.jsx(_d,{children:_e.jsx(vd,{placeholder:"Sunset Peak Campsite",...Le,className:"text-lg py-6"})}),_e.jsx(gd,{className:"text-base",children:"Give your campground a descriptive name"}),_e.jsx(yd,{className:"text-base"})]})}),_e.jsx(Hf,{control:oe.control,name:"location",render:({field:Le})=>_e.jsxs(md,{children:[_e.jsx(cc,{className:"text-xl font-semibold",children:"Location"}),_e.jsx(_d,{children:_e.jsx(vd,{placeholder:"Himachal Pradesh, India",...Le,className:"text-lg py-6"})}),_e.jsx(gd,{className:"text-base",children:"Where is this campground located?"}),_e.jsx(yd,{className:"text-base"})]})}),_e.jsx(Hf,{control:oe.control,name:"description",render:({field:Le})=>_e.jsxs(md,{children:[_e.jsx(cc,{className:"text-xl font-semibold",children:"Description"}),_e.jsx(_d,{children:_e.jsx($1,{placeholder:"Describe the campground, its surroundings, and what makes it special...",className:"min-h-[150px] text-lg",value:Le.value,onChange:Le.onChange})}),_e.jsx(gd,{className:"text-base",children:"Include details about amenities, views, and nearby attractions"}),_e.jsx(yd,{className:"text-base"})]})}),_e.jsx(Hf,{control:oe.control,name:"price",render:({field:Le})=>_e.jsxs(md,{children:[_e.jsx(cc,{className:"text-xl font-semibold",children:"Price per night (₹)"}),_e.jsx(_d,{children:_e.jsxs("div",{className:"relative",children:[_e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"₹"}),_e.jsx(vd,{className:"pl-7 text-lg py-6",placeholder:"1000",value:Le.value,onChange:Le.onChange})]})}),_e.jsx(gd,{className:"text-base",children:"Set a reasonable price per night in Indian Rupees"}),_e.jsx(yd,{className:"text-base"})]})}),_e.jsxs("div",{className:"space-y-4",children:[_e.jsx(cc,{className:"block text-xl font-semibold",children:"Images"}),_e.jsxs("div",{className:"flex items-center gap-4",children:[_e.jsxs("label",{htmlFor:"image",className:"flex items-center justify-center gap-2 px-6 py-4 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors text-lg",children:[_e.jsx(aS,{className:"h-6 w-6 text-gray-500"}),_e.jsx("span",{children:"Upload Photos"}),_e.jsx(vd,{id:"image",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:ze})]}),_e.jsxs("p",{className:"text-base text-gray-500",children:[S.length," ",S.length===1?"file":"files"," ","selected"]})]}),O.length>0&&_e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4",children:O.map((Le,Fe)=>_e.jsxs("div",{className:"relative group",children:[_e.jsx("img",{src:Le||"/placeholder.svg",alt:`Preview ${Fe+1}`,className:"h-32 w-full object-cover rounded-md"}),_e.jsx("button",{type:"button",onClick:()=>je(Fe),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:_e.jsx(z1,{className:"h-5 w-5"})})]},Fe))}),O.length===0&&_e.jsx("p",{className:"text-base text-gray-500 italic",children:"Please upload at least one image of the campground"})]})]})})}),_e.jsx(Z1,{className:"flex justify-between p-6 border-t flex-shrink-0",children:_e.jsxs("div",{className:"flex w-full justify-between",children:[_e.jsx(lc,{type:"button",variant:"outline",onClick:()=>m("/campgrounds"),className:"text-lg px-6 py-5",children:"Cancel"}),_e.jsx(lc,{type:"submit",disabled:X,onClick:oe.handleSubmit(ft),className:"text-lg px-8 py-5",children:X?_e.jsxs(_e.Fragment,{children:[_e.jsx(D1,{className:"mr-2 h-5 w-5 animate-spin"}),"Creating..."]}):"Create Campground"})]})})]})})]})}var Hv={exports:{}},mO=Hv.exports,_T;function _O(){return _T||(_T=1,function(m,v){(function(S,D){m.exports=D()})(mO,function(){var S,D,O;function F(r,re){if(!S)S=re;else if(!D)D=re;else{var J="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+S+")(sharedChunk); ("+D+")(sharedChunk); self.onerror = null;",oe={};S(oe),O=re(oe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(O.workerUrl=window.URL.createObjectURL(new Blob([J],{type:"text/javascript"})))}}F(["exports"],function(r){function re(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var J,oe={},ze={};function je(){if(J)return ze;J=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.setMatrixArrayType=function(c){ze.ARRAY_TYPE=e=c},ze.toRadian=function(c){return c*s},ze.equals=function(c,l){return Math.abs(c-l)<=a*Math.max(1,Math.abs(c),Math.abs(l))},ze.RANDOM=ze.ARRAY_TYPE=ze.EPSILON=void 0;var a=1e-6;ze.EPSILON=a;var e=typeof Float32Array<"u"?Float32Array:Array;ze.ARRAY_TYPE=e;var i=Math.random;ze.RANDOM=i;var s=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var c=0,l=arguments.length;l--;)c+=arguments[l]*arguments[l];return Math.sqrt(c)}),ze}var ft,Le={};function Fe(){if(ft)return Le;function a(l){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},a(l)}ft=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.create=function(){var l=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},Le.clone=function(l){var d=new e.ARRAY_TYPE(4);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d},Le.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l},Le.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l},Le.fromValues=function(l,d,y,w){var A=new e.ARRAY_TYPE(4);return A[0]=l,A[1]=d,A[2]=y,A[3]=w,A},Le.set=function(l,d,y,w,A){return l[0]=d,l[1]=y,l[2]=w,l[3]=A,l},Le.transpose=function(l,d){if(l===d){var y=d[1];l[1]=d[2],l[2]=y}else l[0]=d[0],l[1]=d[2],l[2]=d[1],l[3]=d[3];return l},Le.invert=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=y*_-A*w;return T?(l[0]=_*(T=1/T),l[1]=-w*T,l[2]=-A*T,l[3]=y*T,l):null},Le.adjoint=function(l,d){var y=d[0];return l[0]=d[3],l[1]=-d[1],l[2]=-d[2],l[3]=y,l},Le.determinant=function(l){return l[0]*l[3]-l[2]*l[1]},Le.multiply=s,Le.rotate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],C=Math.sin(y),E=Math.cos(y);return l[0]=w*E+_*C,l[1]=A*E+T*C,l[2]=w*-C+_*E,l[3]=A*-C+T*E,l},Le.scale=function(l,d,y){var w=d[1],A=d[2],_=d[3],T=y[0],C=y[1];return l[0]=d[0]*T,l[1]=w*T,l[2]=A*C,l[3]=_*C,l},Le.fromRotation=function(l,d){var y=Math.sin(d),w=Math.cos(d);return l[0]=w,l[1]=y,l[2]=-y,l[3]=w,l},Le.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l},Le.str=function(l){return"mat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},Le.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},Le.LDU=function(l,d,y,w){return l[2]=w[2]/w[0],y[0]=w[0],y[1]=w[1],y[3]=w[3]-l[2]*y[1],[l,d,y]},Le.add=function(l,d,y){return l[0]=d[0]+y[0],l[1]=d[1]+y[1],l[2]=d[2]+y[2],l[3]=d[3]+y[3],l},Le.subtract=c,Le.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]},Le.equals=function(l,d){var y=l[0],w=l[1],A=l[2],_=l[3],T=d[0],C=d[1],E=d[2],M=d[3];return Math.abs(y-T)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(T))&&Math.abs(w-C)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(C))&&Math.abs(A-E)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(E))&&Math.abs(_-M)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(M))},Le.multiplyScalar=function(l,d,y){return l[0]=d[0]*y,l[1]=d[1]*y,l[2]=d[2]*y,l[3]=d[3]*y,l},Le.multiplyScalarAndAdd=function(l,d,y,w){return l[0]=d[0]+y[0]*w,l[1]=d[1]+y[1]*w,l[2]=d[2]+y[2]*w,l[3]=d[3]+y[3]*w,l},Le.sub=Le.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||a(l)!=="object"&&typeof l!="function")return{default:l};var y=i(void 0);if(y&&y.has(l))return y.get(l);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var T=A?Object.getOwnPropertyDescriptor(l,_):null;T&&(T.get||T.set)?Object.defineProperty(w,_,T):w[_]=l[_]}return w.default=l,y&&y.set(l,w),w}(je());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,y=new WeakMap;return(i=function(w){return w?y:d})(l)}function s(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],C=y[0],E=y[1],M=y[2],z=y[3];return l[0]=w*C+_*E,l[1]=A*C+T*E,l[2]=w*M+_*z,l[3]=A*M+T*z,l}function c(l,d,y){return l[0]=d[0]-y[0],l[1]=d[1]-y[1],l[2]=d[2]-y[2],l[3]=d[3]-y[3],l}return Le.mul=s,Le.sub=c,Le}var qe,He={};function tt(){if(qe)return He;function a(l){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},a(l)}qe=1,Object.defineProperty(He,"__esModule",{value:!0}),He.create=function(){var l=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[4]=0,l[5]=0),l[0]=1,l[3]=1,l},He.clone=function(l){var d=new e.ARRAY_TYPE(6);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d},He.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l},He.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l},He.fromValues=function(l,d,y,w,A,_){var T=new e.ARRAY_TYPE(6);return T[0]=l,T[1]=d,T[2]=y,T[3]=w,T[4]=A,T[5]=_,T},He.set=function(l,d,y,w,A,_,T){return l[0]=d,l[1]=y,l[2]=w,l[3]=A,l[4]=_,l[5]=T,l},He.invert=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=d[4],C=d[5],E=y*_-w*A;return E?(l[0]=_*(E=1/E),l[1]=-w*E,l[2]=-A*E,l[3]=y*E,l[4]=(A*C-_*T)*E,l[5]=(w*T-y*C)*E,l):null},He.determinant=function(l){return l[0]*l[3]-l[1]*l[2]},He.multiply=s,He.rotate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],C=d[4],E=d[5],M=Math.sin(y),z=Math.cos(y);return l[0]=w*z+_*M,l[1]=A*z+T*M,l[2]=w*-M+_*z,l[3]=A*-M+T*z,l[4]=C,l[5]=E,l},He.scale=function(l,d,y){var w=d[1],A=d[2],_=d[3],T=d[4],C=d[5],E=y[0],M=y[1];return l[0]=d[0]*E,l[1]=w*E,l[2]=A*M,l[3]=_*M,l[4]=T,l[5]=C,l},He.translate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],C=d[4],E=d[5],M=y[0],z=y[1];return l[0]=w,l[1]=A,l[2]=_,l[3]=T,l[4]=w*M+_*z+C,l[5]=A*M+T*z+E,l},He.fromRotation=function(l,d){var y=Math.sin(d),w=Math.cos(d);return l[0]=w,l[1]=y,l[2]=-y,l[3]=w,l[4]=0,l[5]=0,l},He.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l[4]=0,l[5]=0,l},He.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=d[0],l[5]=d[1],l},He.str=function(l){return"mat2d("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+")"},He.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],1)},He.add=function(l,d,y){return l[0]=d[0]+y[0],l[1]=d[1]+y[1],l[2]=d[2]+y[2],l[3]=d[3]+y[3],l[4]=d[4]+y[4],l[5]=d[5]+y[5],l},He.subtract=c,He.multiplyScalar=function(l,d,y){return l[0]=d[0]*y,l[1]=d[1]*y,l[2]=d[2]*y,l[3]=d[3]*y,l[4]=d[4]*y,l[5]=d[5]*y,l},He.multiplyScalarAndAdd=function(l,d,y,w){return l[0]=d[0]+y[0]*w,l[1]=d[1]+y[1]*w,l[2]=d[2]+y[2]*w,l[3]=d[3]+y[3]*w,l[4]=d[4]+y[4]*w,l[5]=d[5]+y[5]*w,l},He.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]},He.equals=function(l,d){var y=l[0],w=l[1],A=l[2],_=l[3],T=l[4],C=l[5],E=d[0],M=d[1],z=d[2],N=d[3],V=d[4],Z=d[5];return Math.abs(y-E)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(E))&&Math.abs(w-M)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(M))&&Math.abs(A-z)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(z))&&Math.abs(_-N)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(T-V)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(V))&&Math.abs(C-Z)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Z))},He.sub=He.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||a(l)!=="object"&&typeof l!="function")return{default:l};var y=i(void 0);if(y&&y.has(l))return y.get(l);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var T=A?Object.getOwnPropertyDescriptor(l,_):null;T&&(T.get||T.set)?Object.defineProperty(w,_,T):w[_]=l[_]}return w.default=l,y&&y.set(l,w),w}(je());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,y=new WeakMap;return(i=function(w){return w?y:d})(l)}function s(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],C=d[4],E=d[5],M=y[0],z=y[1],N=y[2],V=y[3],Z=y[4],H=y[5];return l[0]=w*M+_*z,l[1]=A*M+T*z,l[2]=w*N+_*V,l[3]=A*N+T*V,l[4]=w*Z+_*H+C,l[5]=A*Z+T*H+E,l}function c(l,d,y){return l[0]=d[0]-y[0],l[1]=d[1]-y[1],l[2]=d[2]-y[2],l[3]=d[3]-y[3],l[4]=d[4]-y[4],l[5]=d[5]-y[5],l}return He.mul=s,He.sub=c,He}var mt,Tt={};function kt(){if(mt)return Tt;function a(l){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},a(l)}mt=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=function(){var l=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l},Tt.fromMat4=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[4],l[4]=d[5],l[5]=d[6],l[6]=d[8],l[7]=d[9],l[8]=d[10],l},Tt.clone=function(l){var d=new e.ARRAY_TYPE(9);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d[6]=l[6],d[7]=l[7],d[8]=l[8],d},Tt.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},Tt.fromValues=function(l,d,y,w,A,_,T,C,E){var M=new e.ARRAY_TYPE(9);return M[0]=l,M[1]=d,M[2]=y,M[3]=w,M[4]=A,M[5]=_,M[6]=T,M[7]=C,M[8]=E,M},Tt.set=function(l,d,y,w,A,_,T,C,E,M){return l[0]=d,l[1]=y,l[2]=w,l[3]=A,l[4]=_,l[5]=T,l[6]=C,l[7]=E,l[8]=M,l},Tt.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Tt.transpose=function(l,d){if(l===d){var y=d[1],w=d[2],A=d[5];l[1]=d[3],l[2]=d[6],l[3]=y,l[5]=d[7],l[6]=w,l[7]=A}else l[0]=d[0],l[1]=d[3],l[2]=d[6],l[3]=d[1],l[4]=d[4],l[5]=d[7],l[6]=d[2],l[7]=d[5],l[8]=d[8];return l},Tt.invert=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=d[4],C=d[5],E=d[6],M=d[7],z=d[8],N=z*T-C*M,V=-z*_+C*E,Z=M*_-T*E,H=y*N+w*V+A*Z;return H?(l[0]=N*(H=1/H),l[1]=(-z*w+A*M)*H,l[2]=(C*w-A*T)*H,l[3]=V*H,l[4]=(z*y-A*E)*H,l[5]=(-C*y+A*_)*H,l[6]=Z*H,l[7]=(-M*y+w*E)*H,l[8]=(T*y-w*_)*H,l):null},Tt.adjoint=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=d[4],C=d[5],E=d[6],M=d[7],z=d[8];return l[0]=T*z-C*M,l[1]=A*M-w*z,l[2]=w*C-A*T,l[3]=C*E-_*z,l[4]=y*z-A*E,l[5]=A*_-y*C,l[6]=_*M-T*E,l[7]=w*E-y*M,l[8]=y*T-w*_,l},Tt.determinant=function(l){var d=l[3],y=l[4],w=l[5],A=l[6],_=l[7],T=l[8];return l[0]*(T*y-w*_)+l[1]*(-T*d+w*A)+l[2]*(_*d-y*A)},Tt.multiply=s,Tt.translate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],C=d[4],E=d[5],M=d[6],z=d[7],N=d[8],V=y[0],Z=y[1];return l[0]=w,l[1]=A,l[2]=_,l[3]=T,l[4]=C,l[5]=E,l[6]=V*w+Z*T+M,l[7]=V*A+Z*C+z,l[8]=V*_+Z*E+N,l},Tt.rotate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],C=d[4],E=d[5],M=d[6],z=d[7],N=d[8],V=Math.sin(y),Z=Math.cos(y);return l[0]=Z*w+V*T,l[1]=Z*A+V*C,l[2]=Z*_+V*E,l[3]=Z*T-V*w,l[4]=Z*C-V*A,l[5]=Z*E-V*_,l[6]=M,l[7]=z,l[8]=N,l},Tt.scale=function(l,d,y){var w=y[0],A=y[1];return l[0]=w*d[0],l[1]=w*d[1],l[2]=w*d[2],l[3]=A*d[3],l[4]=A*d[4],l[5]=A*d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},Tt.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=d[0],l[7]=d[1],l[8]=1,l},Tt.fromRotation=function(l,d){var y=Math.sin(d),w=Math.cos(d);return l[0]=w,l[1]=y,l[2]=0,l[3]=-y,l[4]=w,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Tt.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=0,l[4]=d[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Tt.fromMat2d=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=0,l[3]=d[2],l[4]=d[3],l[5]=0,l[6]=d[4],l[7]=d[5],l[8]=1,l},Tt.fromQuat=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=y+y,C=w+w,E=A+A,M=y*T,z=w*T,N=w*C,V=A*T,Z=A*C,H=A*E,q=_*T,Y=_*C,K=_*E;return l[0]=1-N-H,l[3]=z-K,l[6]=V+Y,l[1]=z+K,l[4]=1-M-H,l[7]=Z-q,l[2]=V-Y,l[5]=Z+q,l[8]=1-M-N,l},Tt.normalFromMat4=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=d[4],C=d[5],E=d[6],M=d[7],z=d[8],N=d[9],V=d[10],Z=d[11],H=d[12],q=d[13],Y=d[14],K=d[15],ee=y*C-w*T,he=y*E-A*T,le=y*M-_*T,ue=w*E-A*C,Te=w*M-_*C,pe=A*M-_*E,Ee=z*q-N*H,De=z*Y-V*H,Re=z*K-Z*H,ke=N*Y-V*q,Pe=N*K-Z*q,Ze=V*K-Z*Y,Ue=ee*Ze-he*Pe+le*ke+ue*Re-Te*De+pe*Ee;return Ue?(l[0]=(C*Ze-E*Pe+M*ke)*(Ue=1/Ue),l[1]=(E*Re-T*Ze-M*De)*Ue,l[2]=(T*Pe-C*Re+M*Ee)*Ue,l[3]=(A*Pe-w*Ze-_*ke)*Ue,l[4]=(y*Ze-A*Re+_*De)*Ue,l[5]=(w*Re-y*Pe-_*Ee)*Ue,l[6]=(q*pe-Y*Te+K*ue)*Ue,l[7]=(Y*le-H*pe-K*he)*Ue,l[8]=(H*Te-q*le+K*ee)*Ue,l):null},Tt.projection=function(l,d,y){return l[0]=2/d,l[1]=0,l[2]=0,l[3]=0,l[4]=-2/y,l[5]=0,l[6]=-1,l[7]=1,l[8]=1,l},Tt.str=function(l){return"mat3("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+", "+l[8]+")"},Tt.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},Tt.add=function(l,d,y){return l[0]=d[0]+y[0],l[1]=d[1]+y[1],l[2]=d[2]+y[2],l[3]=d[3]+y[3],l[4]=d[4]+y[4],l[5]=d[5]+y[5],l[6]=d[6]+y[6],l[7]=d[7]+y[7],l[8]=d[8]+y[8],l},Tt.subtract=c,Tt.multiplyScalar=function(l,d,y){return l[0]=d[0]*y,l[1]=d[1]*y,l[2]=d[2]*y,l[3]=d[3]*y,l[4]=d[4]*y,l[5]=d[5]*y,l[6]=d[6]*y,l[7]=d[7]*y,l[8]=d[8]*y,l},Tt.multiplyScalarAndAdd=function(l,d,y,w){return l[0]=d[0]+y[0]*w,l[1]=d[1]+y[1]*w,l[2]=d[2]+y[2]*w,l[3]=d[3]+y[3]*w,l[4]=d[4]+y[4]*w,l[5]=d[5]+y[5]*w,l[6]=d[6]+y[6]*w,l[7]=d[7]+y[7]*w,l[8]=d[8]+y[8]*w,l},Tt.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]&&l[6]===d[6]&&l[7]===d[7]&&l[8]===d[8]},Tt.equals=function(l,d){var y=l[0],w=l[1],A=l[2],_=l[3],T=l[4],C=l[5],E=l[6],M=l[7],z=l[8],N=d[0],V=d[1],Z=d[2],H=d[3],q=d[4],Y=d[5],K=d[6],ee=d[7],he=d[8];return Math.abs(y-N)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(w-V)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(V))&&Math.abs(A-Z)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(Z))&&Math.abs(_-H)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(T-q)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(q))&&Math.abs(C-Y)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Y))&&Math.abs(E-K)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(M-ee)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(ee))&&Math.abs(z-he)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(he))},Tt.sub=Tt.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||a(l)!=="object"&&typeof l!="function")return{default:l};var y=i(void 0);if(y&&y.has(l))return y.get(l);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var T=A?Object.getOwnPropertyDescriptor(l,_):null;T&&(T.get||T.set)?Object.defineProperty(w,_,T):w[_]=l[_]}return w.default=l,y&&y.set(l,w),w}(je());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,y=new WeakMap;return(i=function(w){return w?y:d})(l)}function s(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],C=d[4],E=d[5],M=d[6],z=d[7],N=d[8],V=y[0],Z=y[1],H=y[2],q=y[3],Y=y[4],K=y[5],ee=y[6],he=y[7],le=y[8];return l[0]=V*w+Z*T+H*M,l[1]=V*A+Z*C+H*z,l[2]=V*_+Z*E+H*N,l[3]=q*w+Y*T+K*M,l[4]=q*A+Y*C+K*z,l[5]=q*_+Y*E+K*N,l[6]=ee*w+he*T+le*M,l[7]=ee*A+he*C+le*z,l[8]=ee*_+he*E+le*N,l}function c(l,d,y){return l[0]=d[0]-y[0],l[1]=d[1]-y[1],l[2]=d[2]-y[2],l[3]=d[3]-y[3],l[4]=d[4]-y[4],l[5]=d[5]-y[5],l[6]=d[6]-y[6],l[7]=d[7]-y[7],l[8]=d[8]-y[8],l}return Tt.mul=s,Tt.sub=c,Tt}var At,ot={};function hi(){if(At)return ot;function a(_){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},a(_)}At=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},ot.clone=function(_){var T=new e.ARRAY_TYPE(16);return T[0]=_[0],T[1]=_[1],T[2]=_[2],T[3]=_[3],T[4]=_[4],T[5]=_[5],T[6]=_[6],T[7]=_[7],T[8]=_[8],T[9]=_[9],T[10]=_[10],T[11]=_[11],T[12]=_[12],T[13]=_[13],T[14]=_[14],T[15]=_[15],T},ot.copy=function(_,T){return _[0]=T[0],_[1]=T[1],_[2]=T[2],_[3]=T[3],_[4]=T[4],_[5]=T[5],_[6]=T[6],_[7]=T[7],_[8]=T[8],_[9]=T[9],_[10]=T[10],_[11]=T[11],_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15],_},ot.fromValues=function(_,T,C,E,M,z,N,V,Z,H,q,Y,K,ee,he,le){var ue=new e.ARRAY_TYPE(16);return ue[0]=_,ue[1]=T,ue[2]=C,ue[3]=E,ue[4]=M,ue[5]=z,ue[6]=N,ue[7]=V,ue[8]=Z,ue[9]=H,ue[10]=q,ue[11]=Y,ue[12]=K,ue[13]=ee,ue[14]=he,ue[15]=le,ue},ot.set=function(_,T,C,E,M,z,N,V,Z,H,q,Y,K,ee,he,le,ue){return _[0]=T,_[1]=C,_[2]=E,_[3]=M,_[4]=z,_[5]=N,_[6]=V,_[7]=Z,_[8]=H,_[9]=q,_[10]=Y,_[11]=K,_[12]=ee,_[13]=he,_[14]=le,_[15]=ue,_},ot.identity=s,ot.transpose=function(_,T){if(_===T){var C=T[1],E=T[2],M=T[3],z=T[6],N=T[7],V=T[11];_[1]=T[4],_[2]=T[8],_[3]=T[12],_[4]=C,_[6]=T[9],_[7]=T[13],_[8]=E,_[9]=z,_[11]=T[14],_[12]=M,_[13]=N,_[14]=V}else _[0]=T[0],_[1]=T[4],_[2]=T[8],_[3]=T[12],_[4]=T[1],_[5]=T[5],_[6]=T[9],_[7]=T[13],_[8]=T[2],_[9]=T[6],_[10]=T[10],_[11]=T[14],_[12]=T[3],_[13]=T[7],_[14]=T[11],_[15]=T[15];return _},ot.invert=function(_,T){var C=T[0],E=T[1],M=T[2],z=T[3],N=T[4],V=T[5],Z=T[6],H=T[7],q=T[8],Y=T[9],K=T[10],ee=T[11],he=T[12],le=T[13],ue=T[14],Te=T[15],pe=C*V-E*N,Ee=C*Z-M*N,De=C*H-z*N,Re=E*Z-M*V,ke=E*H-z*V,Pe=M*H-z*Z,Ze=q*le-Y*he,Ue=q*ue-K*he,Xe=q*Te-ee*he,bt=Y*ue-K*le,xt=Y*Te-ee*le,ei=K*Te-ee*ue,zt=pe*ei-Ee*xt+De*bt+Re*Xe-ke*Ue+Pe*Ze;return zt?(_[0]=(V*ei-Z*xt+H*bt)*(zt=1/zt),_[1]=(M*xt-E*ei-z*bt)*zt,_[2]=(le*Pe-ue*ke+Te*Re)*zt,_[3]=(K*ke-Y*Pe-ee*Re)*zt,_[4]=(Z*Xe-N*ei-H*Ue)*zt,_[5]=(C*ei-M*Xe+z*Ue)*zt,_[6]=(ue*De-he*Pe-Te*Ee)*zt,_[7]=(q*Pe-K*De+ee*Ee)*zt,_[8]=(N*xt-V*Xe+H*Ze)*zt,_[9]=(E*Xe-C*xt-z*Ze)*zt,_[10]=(he*ke-le*De+Te*pe)*zt,_[11]=(Y*De-q*ke-ee*pe)*zt,_[12]=(V*Ue-N*bt-Z*Ze)*zt,_[13]=(C*bt-E*Ue+M*Ze)*zt,_[14]=(le*Ee-he*Re-ue*pe)*zt,_[15]=(q*Re-Y*Ee+K*pe)*zt,_):null},ot.adjoint=function(_,T){var C=T[0],E=T[1],M=T[2],z=T[3],N=T[4],V=T[5],Z=T[6],H=T[7],q=T[8],Y=T[9],K=T[10],ee=T[11],he=T[12],le=T[13],ue=T[14],Te=T[15];return _[0]=V*(K*Te-ee*ue)-Y*(Z*Te-H*ue)+le*(Z*ee-H*K),_[1]=-(E*(K*Te-ee*ue)-Y*(M*Te-z*ue)+le*(M*ee-z*K)),_[2]=E*(Z*Te-H*ue)-V*(M*Te-z*ue)+le*(M*H-z*Z),_[3]=-(E*(Z*ee-H*K)-V*(M*ee-z*K)+Y*(M*H-z*Z)),_[4]=-(N*(K*Te-ee*ue)-q*(Z*Te-H*ue)+he*(Z*ee-H*K)),_[5]=C*(K*Te-ee*ue)-q*(M*Te-z*ue)+he*(M*ee-z*K),_[6]=-(C*(Z*Te-H*ue)-N*(M*Te-z*ue)+he*(M*H-z*Z)),_[7]=C*(Z*ee-H*K)-N*(M*ee-z*K)+q*(M*H-z*Z),_[8]=N*(Y*Te-ee*le)-q*(V*Te-H*le)+he*(V*ee-H*Y),_[9]=-(C*(Y*Te-ee*le)-q*(E*Te-z*le)+he*(E*ee-z*Y)),_[10]=C*(V*Te-H*le)-N*(E*Te-z*le)+he*(E*H-z*V),_[11]=-(C*(V*ee-H*Y)-N*(E*ee-z*Y)+q*(E*H-z*V)),_[12]=-(N*(Y*ue-K*le)-q*(V*ue-Z*le)+he*(V*K-Z*Y)),_[13]=C*(Y*ue-K*le)-q*(E*ue-M*le)+he*(E*K-M*Y),_[14]=-(C*(V*ue-Z*le)-N*(E*ue-M*le)+he*(E*Z-M*V)),_[15]=C*(V*K-Z*Y)-N*(E*K-M*Y)+q*(E*Z-M*V),_},ot.determinant=function(_){var T=_[0],C=_[1],E=_[2],M=_[3],z=_[4],N=_[5],V=_[6],Z=_[7],H=_[8],q=_[9],Y=_[10],K=_[11],ee=_[12],he=_[13],le=_[14],ue=_[15];return(T*N-C*z)*(Y*ue-K*le)-(T*V-E*z)*(q*ue-K*he)+(T*Z-M*z)*(q*le-Y*he)+(C*V-E*N)*(H*ue-K*ee)-(C*Z-M*N)*(H*le-Y*ee)+(E*Z-M*V)*(H*he-q*ee)},ot.multiply=c,ot.translate=function(_,T,C){var E,M,z,N,V,Z,H,q,Y,K,ee,he,le=C[0],ue=C[1],Te=C[2];return T===_?(_[12]=T[0]*le+T[4]*ue+T[8]*Te+T[12],_[13]=T[1]*le+T[5]*ue+T[9]*Te+T[13],_[14]=T[2]*le+T[6]*ue+T[10]*Te+T[14],_[15]=T[3]*le+T[7]*ue+T[11]*Te+T[15]):(M=T[1],z=T[2],N=T[3],V=T[4],Z=T[5],H=T[6],q=T[7],Y=T[8],K=T[9],ee=T[10],he=T[11],_[0]=E=T[0],_[1]=M,_[2]=z,_[3]=N,_[4]=V,_[5]=Z,_[6]=H,_[7]=q,_[8]=Y,_[9]=K,_[10]=ee,_[11]=he,_[12]=E*le+V*ue+Y*Te+T[12],_[13]=M*le+Z*ue+K*Te+T[13],_[14]=z*le+H*ue+ee*Te+T[14],_[15]=N*le+q*ue+he*Te+T[15]),_},ot.scale=function(_,T,C){var E=C[0],M=C[1],z=C[2];return _[0]=T[0]*E,_[1]=T[1]*E,_[2]=T[2]*E,_[3]=T[3]*E,_[4]=T[4]*M,_[5]=T[5]*M,_[6]=T[6]*M,_[7]=T[7]*M,_[8]=T[8]*z,_[9]=T[9]*z,_[10]=T[10]*z,_[11]=T[11]*z,_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15],_},ot.rotate=function(_,T,C,E){var M,z,N,V,Z,H,q,Y,K,ee,he,le,ue,Te,pe,Ee,De,Re,ke,Pe,Ze,Ue,Xe,bt,xt=E[0],ei=E[1],zt=E[2],Nt=Math.hypot(xt,ei,zt);return Nt<e.EPSILON?null:(xt*=Nt=1/Nt,ei*=Nt,zt*=Nt,M=Math.sin(C),z=Math.cos(C),Z=T[1],H=T[2],q=T[3],K=T[5],ee=T[6],he=T[7],ue=T[9],Te=T[10],pe=T[11],Ee=xt*xt*(N=1-z)+z,ke=xt*ei*N-zt*M,Pe=ei*ei*N+z,Ze=zt*ei*N+xt*M,Ue=xt*zt*N+ei*M,Xe=ei*zt*N-xt*M,bt=zt*zt*N+z,_[0]=(V=T[0])*Ee+(Y=T[4])*(De=ei*xt*N+zt*M)+(le=T[8])*(Re=zt*xt*N-ei*M),_[1]=Z*Ee+K*De+ue*Re,_[2]=H*Ee+ee*De+Te*Re,_[3]=q*Ee+he*De+pe*Re,_[4]=V*ke+Y*Pe+le*Ze,_[5]=Z*ke+K*Pe+ue*Ze,_[6]=H*ke+ee*Pe+Te*Ze,_[7]=q*ke+he*Pe+pe*Ze,_[8]=V*Ue+Y*Xe+le*bt,_[9]=Z*Ue+K*Xe+ue*bt,_[10]=H*Ue+ee*Xe+Te*bt,_[11]=q*Ue+he*Xe+pe*bt,T!==_&&(_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15]),_)},ot.rotateX=function(_,T,C){var E=Math.sin(C),M=Math.cos(C),z=T[4],N=T[5],V=T[6],Z=T[7],H=T[8],q=T[9],Y=T[10],K=T[11];return T!==_&&(_[0]=T[0],_[1]=T[1],_[2]=T[2],_[3]=T[3],_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15]),_[4]=z*M+H*E,_[5]=N*M+q*E,_[6]=V*M+Y*E,_[7]=Z*M+K*E,_[8]=H*M-z*E,_[9]=q*M-N*E,_[10]=Y*M-V*E,_[11]=K*M-Z*E,_},ot.rotateY=function(_,T,C){var E=Math.sin(C),M=Math.cos(C),z=T[0],N=T[1],V=T[2],Z=T[3],H=T[8],q=T[9],Y=T[10],K=T[11];return T!==_&&(_[4]=T[4],_[5]=T[5],_[6]=T[6],_[7]=T[7],_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15]),_[0]=z*M-H*E,_[1]=N*M-q*E,_[2]=V*M-Y*E,_[3]=Z*M-K*E,_[8]=z*E+H*M,_[9]=N*E+q*M,_[10]=V*E+Y*M,_[11]=Z*E+K*M,_},ot.rotateZ=function(_,T,C){var E=Math.sin(C),M=Math.cos(C),z=T[0],N=T[1],V=T[2],Z=T[3],H=T[4],q=T[5],Y=T[6],K=T[7];return T!==_&&(_[8]=T[8],_[9]=T[9],_[10]=T[10],_[11]=T[11],_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15]),_[0]=z*M+H*E,_[1]=N*M+q*E,_[2]=V*M+Y*E,_[3]=Z*M+K*E,_[4]=H*M-z*E,_[5]=q*M-N*E,_[6]=Y*M-V*E,_[7]=K*M-Z*E,_},ot.fromTranslation=function(_,T){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=T[0],_[13]=T[1],_[14]=T[2],_[15]=1,_},ot.fromScaling=function(_,T){return _[0]=T[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=T[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=T[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},ot.fromRotation=function(_,T,C){var E,M,z,N=C[0],V=C[1],Z=C[2],H=Math.hypot(N,V,Z);return H<e.EPSILON?null:(N*=H=1/H,V*=H,Z*=H,E=Math.sin(T),M=Math.cos(T),_[0]=N*N*(z=1-M)+M,_[1]=V*N*z+Z*E,_[2]=Z*N*z-V*E,_[3]=0,_[4]=N*V*z-Z*E,_[5]=V*V*z+M,_[6]=Z*V*z+N*E,_[7]=0,_[8]=N*Z*z+V*E,_[9]=V*Z*z-N*E,_[10]=Z*Z*z+M,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},ot.fromXRotation=function(_,T){var C=Math.sin(T),E=Math.cos(T);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=E,_[6]=C,_[7]=0,_[8]=0,_[9]=-C,_[10]=E,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},ot.fromYRotation=function(_,T){var C=Math.sin(T),E=Math.cos(T);return _[0]=E,_[1]=0,_[2]=-C,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=C,_[9]=0,_[10]=E,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},ot.fromZRotation=function(_,T){var C=Math.sin(T),E=Math.cos(T);return _[0]=E,_[1]=C,_[2]=0,_[3]=0,_[4]=-C,_[5]=E,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},ot.fromRotationTranslation=l,ot.fromQuat2=function(_,T){var C=new e.ARRAY_TYPE(3),E=-T[0],M=-T[1],z=-T[2],N=T[3],V=T[4],Z=T[5],H=T[6],q=T[7],Y=E*E+M*M+z*z+N*N;return Y>0?(C[0]=2*(V*N+q*E+Z*z-H*M)/Y,C[1]=2*(Z*N+q*M+H*E-V*z)/Y,C[2]=2*(H*N+q*z+V*M-Z*E)/Y):(C[0]=2*(V*N+q*E+Z*z-H*M),C[1]=2*(Z*N+q*M+H*E-V*z),C[2]=2*(H*N+q*z+V*M-Z*E)),l(_,T,C),_},ot.getTranslation=function(_,T){return _[0]=T[12],_[1]=T[13],_[2]=T[14],_},ot.getScaling=d,ot.getRotation=function(_,T){var C=new e.ARRAY_TYPE(3);d(C,T);var E=1/C[0],M=1/C[1],z=1/C[2],N=T[0]*E,V=T[1]*M,Z=T[2]*z,H=T[4]*E,q=T[5]*M,Y=T[6]*z,K=T[8]*E,ee=T[9]*M,he=T[10]*z,le=N+q+he,ue=0;return le>0?(ue=2*Math.sqrt(le+1),_[3]=.25*ue,_[0]=(Y-ee)/ue,_[1]=(K-Z)/ue,_[2]=(V-H)/ue):N>q&&N>he?(ue=2*Math.sqrt(1+N-q-he),_[3]=(Y-ee)/ue,_[0]=.25*ue,_[1]=(V+H)/ue,_[2]=(K+Z)/ue):q>he?(ue=2*Math.sqrt(1+q-N-he),_[3]=(K-Z)/ue,_[0]=(V+H)/ue,_[1]=.25*ue,_[2]=(Y+ee)/ue):(ue=2*Math.sqrt(1+he-N-q),_[3]=(V-H)/ue,_[0]=(K+Z)/ue,_[1]=(Y+ee)/ue,_[2]=.25*ue),_},ot.fromRotationTranslationScale=function(_,T,C,E){var M=T[0],z=T[1],N=T[2],V=T[3],Z=M+M,H=z+z,q=N+N,Y=M*Z,K=M*H,ee=M*q,he=z*H,le=z*q,ue=N*q,Te=V*Z,pe=V*H,Ee=V*q,De=E[0],Re=E[1],ke=E[2];return _[0]=(1-(he+ue))*De,_[1]=(K+Ee)*De,_[2]=(ee-pe)*De,_[3]=0,_[4]=(K-Ee)*Re,_[5]=(1-(Y+ue))*Re,_[6]=(le+Te)*Re,_[7]=0,_[8]=(ee+pe)*ke,_[9]=(le-Te)*ke,_[10]=(1-(Y+he))*ke,_[11]=0,_[12]=C[0],_[13]=C[1],_[14]=C[2],_[15]=1,_},ot.fromRotationTranslationScaleOrigin=function(_,T,C,E,M){var z=T[0],N=T[1],V=T[2],Z=T[3],H=z+z,q=N+N,Y=V+V,K=z*H,ee=z*q,he=z*Y,le=N*q,ue=N*Y,Te=V*Y,pe=Z*H,Ee=Z*q,De=Z*Y,Re=E[0],ke=E[1],Pe=E[2],Ze=M[0],Ue=M[1],Xe=M[2],bt=(1-(le+Te))*Re,xt=(ee+De)*Re,ei=(he-Ee)*Re,zt=(ee-De)*ke,Nt=(1-(K+Te))*ke,St=(ue+pe)*ke,wi=(he+Ee)*Pe,Xt=(ue-pe)*Pe,ci=(1-(K+le))*Pe;return _[0]=bt,_[1]=xt,_[2]=ei,_[3]=0,_[4]=zt,_[5]=Nt,_[6]=St,_[7]=0,_[8]=wi,_[9]=Xt,_[10]=ci,_[11]=0,_[12]=C[0]+Ze-(bt*Ze+zt*Ue+wi*Xe),_[13]=C[1]+Ue-(xt*Ze+Nt*Ue+Xt*Xe),_[14]=C[2]+Xe-(ei*Ze+St*Ue+ci*Xe),_[15]=1,_},ot.fromQuat=function(_,T){var C=T[0],E=T[1],M=T[2],z=T[3],N=C+C,V=E+E,Z=M+M,H=C*N,q=E*N,Y=E*V,K=M*N,ee=M*V,he=M*Z,le=z*N,ue=z*V,Te=z*Z;return _[0]=1-Y-he,_[1]=q+Te,_[2]=K-ue,_[3]=0,_[4]=q-Te,_[5]=1-H-he,_[6]=ee+le,_[7]=0,_[8]=K+ue,_[9]=ee-le,_[10]=1-H-Y,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},ot.frustum=function(_,T,C,E,M,z,N){var V=1/(C-T),Z=1/(M-E),H=1/(z-N);return _[0]=2*z*V,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*z*Z,_[6]=0,_[7]=0,_[8]=(C+T)*V,_[9]=(M+E)*Z,_[10]=(N+z)*H,_[11]=-1,_[12]=0,_[13]=0,_[14]=N*z*2*H,_[15]=0,_},ot.perspectiveNO=y,ot.perspectiveZO=function(_,T,C,E,M){var z,N=1/Math.tan(T/2);return _[0]=N/C,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=N,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,M!=null&&M!==1/0?(_[10]=M*(z=1/(E-M)),_[14]=M*E*z):(_[10]=-1,_[14]=-E),_},ot.perspectiveFromFieldOfView=function(_,T,C,E){var M=Math.tan(T.upDegrees*Math.PI/180),z=Math.tan(T.downDegrees*Math.PI/180),N=Math.tan(T.leftDegrees*Math.PI/180),V=Math.tan(T.rightDegrees*Math.PI/180),Z=2/(N+V),H=2/(M+z);return _[0]=Z,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=H,_[6]=0,_[7]=0,_[8]=-(N-V)*Z*.5,_[9]=(M-z)*H*.5,_[10]=E/(C-E),_[11]=-1,_[12]=0,_[13]=0,_[14]=E*C/(C-E),_[15]=0,_},ot.orthoNO=w,ot.orthoZO=function(_,T,C,E,M,z,N){var V=1/(T-C),Z=1/(E-M),H=1/(z-N);return _[0]=-2*V,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*Z,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=H,_[11]=0,_[12]=(T+C)*V,_[13]=(M+E)*Z,_[14]=z*H,_[15]=1,_},ot.lookAt=function(_,T,C,E){var M,z,N,V,Z,H,q,Y,K,ee,he=T[0],le=T[1],ue=T[2],Te=E[0],pe=E[1],Ee=E[2],De=C[0],Re=C[1],ke=C[2];return Math.abs(he-De)<e.EPSILON&&Math.abs(le-Re)<e.EPSILON&&Math.abs(ue-ke)<e.EPSILON?s(_):(q=he-De,Y=le-Re,K=ue-ke,M=pe*(K*=ee=1/Math.hypot(q,Y,K))-Ee*(Y*=ee),z=Ee*(q*=ee)-Te*K,N=Te*Y-pe*q,(ee=Math.hypot(M,z,N))?(M*=ee=1/ee,z*=ee,N*=ee):(M=0,z=0,N=0),V=Y*N-K*z,Z=K*M-q*N,H=q*z-Y*M,(ee=Math.hypot(V,Z,H))?(V*=ee=1/ee,Z*=ee,H*=ee):(V=0,Z=0,H=0),_[0]=M,_[1]=V,_[2]=q,_[3]=0,_[4]=z,_[5]=Z,_[6]=Y,_[7]=0,_[8]=N,_[9]=H,_[10]=K,_[11]=0,_[12]=-(M*he+z*le+N*ue),_[13]=-(V*he+Z*le+H*ue),_[14]=-(q*he+Y*le+K*ue),_[15]=1,_)},ot.targetTo=function(_,T,C,E){var M=T[0],z=T[1],N=T[2],V=E[0],Z=E[1],H=E[2],q=M-C[0],Y=z-C[1],K=N-C[2],ee=q*q+Y*Y+K*K;ee>0&&(q*=ee=1/Math.sqrt(ee),Y*=ee,K*=ee);var he=Z*K-H*Y,le=H*q-V*K,ue=V*Y-Z*q;return(ee=he*he+le*le+ue*ue)>0&&(he*=ee=1/Math.sqrt(ee),le*=ee,ue*=ee),_[0]=he,_[1]=le,_[2]=ue,_[3]=0,_[4]=Y*ue-K*le,_[5]=K*he-q*ue,_[6]=q*le-Y*he,_[7]=0,_[8]=q,_[9]=Y,_[10]=K,_[11]=0,_[12]=M,_[13]=z,_[14]=N,_[15]=1,_},ot.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},ot.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},ot.add=function(_,T,C){return _[0]=T[0]+C[0],_[1]=T[1]+C[1],_[2]=T[2]+C[2],_[3]=T[3]+C[3],_[4]=T[4]+C[4],_[5]=T[5]+C[5],_[6]=T[6]+C[6],_[7]=T[7]+C[7],_[8]=T[8]+C[8],_[9]=T[9]+C[9],_[10]=T[10]+C[10],_[11]=T[11]+C[11],_[12]=T[12]+C[12],_[13]=T[13]+C[13],_[14]=T[14]+C[14],_[15]=T[15]+C[15],_},ot.subtract=A,ot.multiplyScalar=function(_,T,C){return _[0]=T[0]*C,_[1]=T[1]*C,_[2]=T[2]*C,_[3]=T[3]*C,_[4]=T[4]*C,_[5]=T[5]*C,_[6]=T[6]*C,_[7]=T[7]*C,_[8]=T[8]*C,_[9]=T[9]*C,_[10]=T[10]*C,_[11]=T[11]*C,_[12]=T[12]*C,_[13]=T[13]*C,_[14]=T[14]*C,_[15]=T[15]*C,_},ot.multiplyScalarAndAdd=function(_,T,C,E){return _[0]=T[0]+C[0]*E,_[1]=T[1]+C[1]*E,_[2]=T[2]+C[2]*E,_[3]=T[3]+C[3]*E,_[4]=T[4]+C[4]*E,_[5]=T[5]+C[5]*E,_[6]=T[6]+C[6]*E,_[7]=T[7]+C[7]*E,_[8]=T[8]+C[8]*E,_[9]=T[9]+C[9]*E,_[10]=T[10]+C[10]*E,_[11]=T[11]+C[11]*E,_[12]=T[12]+C[12]*E,_[13]=T[13]+C[13]*E,_[14]=T[14]+C[14]*E,_[15]=T[15]+C[15]*E,_},ot.exactEquals=function(_,T){return _[0]===T[0]&&_[1]===T[1]&&_[2]===T[2]&&_[3]===T[3]&&_[4]===T[4]&&_[5]===T[5]&&_[6]===T[6]&&_[7]===T[7]&&_[8]===T[8]&&_[9]===T[9]&&_[10]===T[10]&&_[11]===T[11]&&_[12]===T[12]&&_[13]===T[13]&&_[14]===T[14]&&_[15]===T[15]},ot.equals=function(_,T){var C=_[0],E=_[1],M=_[2],z=_[3],N=_[4],V=_[5],Z=_[6],H=_[7],q=_[8],Y=_[9],K=_[10],ee=_[11],he=_[12],le=_[13],ue=_[14],Te=_[15],pe=T[0],Ee=T[1],De=T[2],Re=T[3],ke=T[4],Pe=T[5],Ze=T[6],Ue=T[7],Xe=T[8],bt=T[9],xt=T[10],ei=T[11],zt=T[12],Nt=T[13],St=T[14],wi=T[15];return Math.abs(C-pe)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(pe))&&Math.abs(E-Ee)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ee))&&Math.abs(M-De)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(De))&&Math.abs(z-Re)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(Re))&&Math.abs(N-ke)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(ke))&&Math.abs(V-Pe)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(Pe))&&Math.abs(Z-Ze)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ze))&&Math.abs(H-Ue)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ue))&&Math.abs(q-Xe)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(Xe))&&Math.abs(Y-bt)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(bt))&&Math.abs(K-xt)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(xt))&&Math.abs(ee-ei)<=e.EPSILON*Math.max(1,Math.abs(ee),Math.abs(ei))&&Math.abs(he-zt)<=e.EPSILON*Math.max(1,Math.abs(he),Math.abs(zt))&&Math.abs(le-Nt)<=e.EPSILON*Math.max(1,Math.abs(le),Math.abs(Nt))&&Math.abs(ue-St)<=e.EPSILON*Math.max(1,Math.abs(ue),Math.abs(St))&&Math.abs(Te-wi)<=e.EPSILON*Math.max(1,Math.abs(Te),Math.abs(wi))},ot.sub=ot.mul=ot.ortho=ot.perspective=void 0;var e=function(_,T){if(_&&_.__esModule)return _;if(_===null||a(_)!=="object"&&typeof _!="function")return{default:_};var C=i(void 0);if(C&&C.has(_))return C.get(_);var E={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var z in _)if(z!=="default"&&Object.prototype.hasOwnProperty.call(_,z)){var N=M?Object.getOwnPropertyDescriptor(_,z):null;N&&(N.get||N.set)?Object.defineProperty(E,z,N):E[z]=_[z]}return E.default=_,C&&C.set(_,E),E}(je());function i(_){if(typeof WeakMap!="function")return null;var T=new WeakMap,C=new WeakMap;return(i=function(E){return E?C:T})(_)}function s(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function c(_,T,C){var E=T[0],M=T[1],z=T[2],N=T[3],V=T[4],Z=T[5],H=T[6],q=T[7],Y=T[8],K=T[9],ee=T[10],he=T[11],le=T[12],ue=T[13],Te=T[14],pe=T[15],Ee=C[0],De=C[1],Re=C[2],ke=C[3];return _[0]=Ee*E+De*V+Re*Y+ke*le,_[1]=Ee*M+De*Z+Re*K+ke*ue,_[2]=Ee*z+De*H+Re*ee+ke*Te,_[3]=Ee*N+De*q+Re*he+ke*pe,_[4]=(Ee=C[4])*E+(De=C[5])*V+(Re=C[6])*Y+(ke=C[7])*le,_[5]=Ee*M+De*Z+Re*K+ke*ue,_[6]=Ee*z+De*H+Re*ee+ke*Te,_[7]=Ee*N+De*q+Re*he+ke*pe,_[8]=(Ee=C[8])*E+(De=C[9])*V+(Re=C[10])*Y+(ke=C[11])*le,_[9]=Ee*M+De*Z+Re*K+ke*ue,_[10]=Ee*z+De*H+Re*ee+ke*Te,_[11]=Ee*N+De*q+Re*he+ke*pe,_[12]=(Ee=C[12])*E+(De=C[13])*V+(Re=C[14])*Y+(ke=C[15])*le,_[13]=Ee*M+De*Z+Re*K+ke*ue,_[14]=Ee*z+De*H+Re*ee+ke*Te,_[15]=Ee*N+De*q+Re*he+ke*pe,_}function l(_,T,C){var E=T[0],M=T[1],z=T[2],N=T[3],V=E+E,Z=M+M,H=z+z,q=E*V,Y=E*Z,K=E*H,ee=M*Z,he=M*H,le=z*H,ue=N*V,Te=N*Z,pe=N*H;return _[0]=1-(ee+le),_[1]=Y+pe,_[2]=K-Te,_[3]=0,_[4]=Y-pe,_[5]=1-(q+le),_[6]=he+ue,_[7]=0,_[8]=K+Te,_[9]=he-ue,_[10]=1-(q+ee),_[11]=0,_[12]=C[0],_[13]=C[1],_[14]=C[2],_[15]=1,_}function d(_,T){var C=T[4],E=T[5],M=T[6],z=T[8],N=T[9],V=T[10];return _[0]=Math.hypot(T[0],T[1],T[2]),_[1]=Math.hypot(C,E,M),_[2]=Math.hypot(z,N,V),_}function y(_,T,C,E,M){var z,N=1/Math.tan(T/2);return _[0]=N/C,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=N,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,M!=null&&M!==1/0?(_[10]=(M+E)*(z=1/(E-M)),_[14]=2*M*E*z):(_[10]=-1,_[14]=-2*E),_}function w(_,T,C,E,M,z,N){var V=1/(T-C),Z=1/(E-M),H=1/(z-N);return _[0]=-2*V,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*Z,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*H,_[11]=0,_[12]=(T+C)*V,_[13]=(M+E)*Z,_[14]=(N+z)*H,_[15]=1,_}function A(_,T,C){return _[0]=T[0]-C[0],_[1]=T[1]-C[1],_[2]=T[2]-C[2],_[3]=T[3]-C[3],_[4]=T[4]-C[4],_[5]=T[5]-C[5],_[6]=T[6]-C[6],_[7]=T[7]-C[7],_[8]=T[8]-C[8],_[9]=T[9]-C[9],_[10]=T[10]-C[10],_[11]=T[11]-C[11],_[12]=T[12]-C[12],_[13]=T[13]-C[13],_[14]=T[14]-C[14],_[15]=T[15]-C[15],_}return ot.perspective=y,ot.ortho=w,ot.mul=c,ot.sub=A,ot}var Mi,ti={},Rt={};function ui(){if(Mi)return Rt;function a(M){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},a(M)}Mi=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=s,Rt.clone=function(M){var z=new e.ARRAY_TYPE(3);return z[0]=M[0],z[1]=M[1],z[2]=M[2],z},Rt.length=c,Rt.fromValues=function(M,z,N){var V=new e.ARRAY_TYPE(3);return V[0]=M,V[1]=z,V[2]=N,V},Rt.copy=function(M,z){return M[0]=z[0],M[1]=z[1],M[2]=z[2],M},Rt.set=function(M,z,N,V){return M[0]=z,M[1]=N,M[2]=V,M},Rt.add=function(M,z,N){return M[0]=z[0]+N[0],M[1]=z[1]+N[1],M[2]=z[2]+N[2],M},Rt.subtract=l,Rt.multiply=d,Rt.divide=y,Rt.ceil=function(M,z){return M[0]=Math.ceil(z[0]),M[1]=Math.ceil(z[1]),M[2]=Math.ceil(z[2]),M},Rt.floor=function(M,z){return M[0]=Math.floor(z[0]),M[1]=Math.floor(z[1]),M[2]=Math.floor(z[2]),M},Rt.min=function(M,z,N){return M[0]=Math.min(z[0],N[0]),M[1]=Math.min(z[1],N[1]),M[2]=Math.min(z[2],N[2]),M},Rt.max=function(M,z,N){return M[0]=Math.max(z[0],N[0]),M[1]=Math.max(z[1],N[1]),M[2]=Math.max(z[2],N[2]),M},Rt.round=function(M,z){return M[0]=Math.round(z[0]),M[1]=Math.round(z[1]),M[2]=Math.round(z[2]),M},Rt.scale=function(M,z,N){return M[0]=z[0]*N,M[1]=z[1]*N,M[2]=z[2]*N,M},Rt.scaleAndAdd=function(M,z,N,V){return M[0]=z[0]+N[0]*V,M[1]=z[1]+N[1]*V,M[2]=z[2]+N[2]*V,M},Rt.distance=w,Rt.squaredDistance=A,Rt.squaredLength=_,Rt.negate=function(M,z){return M[0]=-z[0],M[1]=-z[1],M[2]=-z[2],M},Rt.inverse=function(M,z){return M[0]=1/z[0],M[1]=1/z[1],M[2]=1/z[2],M},Rt.normalize=function(M,z){var N=z[0],V=z[1],Z=z[2],H=N*N+V*V+Z*Z;return H>0&&(H=1/Math.sqrt(H)),M[0]=z[0]*H,M[1]=z[1]*H,M[2]=z[2]*H,M},Rt.dot=T,Rt.cross=function(M,z,N){var V=z[0],Z=z[1],H=z[2],q=N[0],Y=N[1],K=N[2];return M[0]=Z*K-H*Y,M[1]=H*q-V*K,M[2]=V*Y-Z*q,M},Rt.lerp=function(M,z,N,V){var Z=z[0],H=z[1],q=z[2];return M[0]=Z+V*(N[0]-Z),M[1]=H+V*(N[1]-H),M[2]=q+V*(N[2]-q),M},Rt.hermite=function(M,z,N,V,Z,H){var q=H*H,Y=q*(2*H-3)+1,K=q*(H-2)+H,ee=q*(H-1),he=q*(3-2*H);return M[0]=z[0]*Y+N[0]*K+V[0]*ee+Z[0]*he,M[1]=z[1]*Y+N[1]*K+V[1]*ee+Z[1]*he,M[2]=z[2]*Y+N[2]*K+V[2]*ee+Z[2]*he,M},Rt.bezier=function(M,z,N,V,Z,H){var q=1-H,Y=q*q,K=H*H,ee=Y*q,he=3*H*Y,le=3*K*q,ue=K*H;return M[0]=z[0]*ee+N[0]*he+V[0]*le+Z[0]*ue,M[1]=z[1]*ee+N[1]*he+V[1]*le+Z[1]*ue,M[2]=z[2]*ee+N[2]*he+V[2]*le+Z[2]*ue,M},Rt.random=function(M,z){z=z||1;var N=2*e.RANDOM()*Math.PI,V=2*e.RANDOM()-1,Z=Math.sqrt(1-V*V)*z;return M[0]=Math.cos(N)*Z,M[1]=Math.sin(N)*Z,M[2]=V*z,M},Rt.transformMat4=function(M,z,N){var V=z[0],Z=z[1],H=z[2],q=N[3]*V+N[7]*Z+N[11]*H+N[15];return M[0]=(N[0]*V+N[4]*Z+N[8]*H+N[12])/(q=q||1),M[1]=(N[1]*V+N[5]*Z+N[9]*H+N[13])/q,M[2]=(N[2]*V+N[6]*Z+N[10]*H+N[14])/q,M},Rt.transformMat3=function(M,z,N){var V=z[0],Z=z[1],H=z[2];return M[0]=V*N[0]+Z*N[3]+H*N[6],M[1]=V*N[1]+Z*N[4]+H*N[7],M[2]=V*N[2]+Z*N[5]+H*N[8],M},Rt.transformQuat=function(M,z,N){var V=N[0],Z=N[1],H=N[2],q=z[0],Y=z[1],K=z[2],ee=Z*K-H*Y,he=H*q-V*K,le=V*Y-Z*q,ue=Z*le-H*he,Te=H*ee-V*le,pe=V*he-Z*ee,Ee=2*N[3];return he*=Ee,le*=Ee,Te*=2,pe*=2,M[0]=q+(ee*=Ee)+(ue*=2),M[1]=Y+he+Te,M[2]=K+le+pe,M},Rt.rotateX=function(M,z,N,V){var Z=[],H=[];return Z[0]=z[0]-N[0],Z[1]=z[1]-N[1],Z[2]=z[2]-N[2],H[0]=Z[0],H[1]=Z[1]*Math.cos(V)-Z[2]*Math.sin(V),H[2]=Z[1]*Math.sin(V)+Z[2]*Math.cos(V),M[0]=H[0]+N[0],M[1]=H[1]+N[1],M[2]=H[2]+N[2],M},Rt.rotateY=function(M,z,N,V){var Z=[],H=[];return Z[0]=z[0]-N[0],Z[1]=z[1]-N[1],Z[2]=z[2]-N[2],H[0]=Z[2]*Math.sin(V)+Z[0]*Math.cos(V),H[1]=Z[1],H[2]=Z[2]*Math.cos(V)-Z[0]*Math.sin(V),M[0]=H[0]+N[0],M[1]=H[1]+N[1],M[2]=H[2]+N[2],M},Rt.rotateZ=function(M,z,N,V){var Z=[],H=[];return Z[0]=z[0]-N[0],Z[1]=z[1]-N[1],Z[2]=z[2]-N[2],H[0]=Z[0]*Math.cos(V)-Z[1]*Math.sin(V),H[1]=Z[0]*Math.sin(V)+Z[1]*Math.cos(V),H[2]=Z[2],M[0]=H[0]+N[0],M[1]=H[1]+N[1],M[2]=H[2]+N[2],M},Rt.angle=function(M,z){var N=M[0],V=M[1],Z=M[2],H=z[0],q=z[1],Y=z[2],K=Math.sqrt(N*N+V*V+Z*Z)*Math.sqrt(H*H+q*q+Y*Y),ee=K&&T(M,z)/K;return Math.acos(Math.min(Math.max(ee,-1),1))},Rt.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},Rt.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},Rt.exactEquals=function(M,z){return M[0]===z[0]&&M[1]===z[1]&&M[2]===z[2]},Rt.equals=function(M,z){var N=M[0],V=M[1],Z=M[2],H=z[0],q=z[1],Y=z[2];return Math.abs(N-H)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(H))&&Math.abs(V-q)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(q))&&Math.abs(Z-Y)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Y))},Rt.forEach=Rt.sqrLen=Rt.len=Rt.sqrDist=Rt.dist=Rt.div=Rt.mul=Rt.sub=void 0;var e=function(M,z){if(M&&M.__esModule)return M;if(M===null||a(M)!=="object"&&typeof M!="function")return{default:M};var N=i(void 0);if(N&&N.has(M))return N.get(M);var V={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in M)if(H!=="default"&&Object.prototype.hasOwnProperty.call(M,H)){var q=Z?Object.getOwnPropertyDescriptor(M,H):null;q&&(q.get||q.set)?Object.defineProperty(V,H,q):V[H]=M[H]}return V.default=M,N&&N.set(M,V),V}(je());function i(M){if(typeof WeakMap!="function")return null;var z=new WeakMap,N=new WeakMap;return(i=function(V){return V?N:z})(M)}function s(){var M=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function c(M){return Math.hypot(M[0],M[1],M[2])}function l(M,z,N){return M[0]=z[0]-N[0],M[1]=z[1]-N[1],M[2]=z[2]-N[2],M}function d(M,z,N){return M[0]=z[0]*N[0],M[1]=z[1]*N[1],M[2]=z[2]*N[2],M}function y(M,z,N){return M[0]=z[0]/N[0],M[1]=z[1]/N[1],M[2]=z[2]/N[2],M}function w(M,z){return Math.hypot(z[0]-M[0],z[1]-M[1],z[2]-M[2])}function A(M,z){var N=z[0]-M[0],V=z[1]-M[1],Z=z[2]-M[2];return N*N+V*V+Z*Z}function _(M){var z=M[0],N=M[1],V=M[2];return z*z+N*N+V*V}function T(M,z){return M[0]*z[0]+M[1]*z[1]+M[2]*z[2]}Rt.sub=l,Rt.mul=d,Rt.div=y,Rt.dist=w,Rt.sqrDist=A,Rt.len=c,Rt.sqrLen=_;var C,E=(C=s(),function(M,z,N,V,Z,H){var q,Y;for(z||(z=3),N||(N=0),Y=V?Math.min(V*z+N,M.length):M.length,q=N;q<Y;q+=z)C[0]=M[q],C[1]=M[q+1],C[2]=M[q+2],Z(C,C,H),M[q]=C[0],M[q+1]=C[1],M[q+2]=C[2];return M});return Rt.forEach=E,Rt}var Si,di,ii={};function pt(){if(Si)return ii;function a(E){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},a(E)}Si=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.create=s,ii.clone=function(E){var M=new e.ARRAY_TYPE(4);return M[0]=E[0],M[1]=E[1],M[2]=E[2],M[3]=E[3],M},ii.fromValues=function(E,M,z,N){var V=new e.ARRAY_TYPE(4);return V[0]=E,V[1]=M,V[2]=z,V[3]=N,V},ii.copy=function(E,M){return E[0]=M[0],E[1]=M[1],E[2]=M[2],E[3]=M[3],E},ii.set=function(E,M,z,N,V){return E[0]=M,E[1]=z,E[2]=N,E[3]=V,E},ii.add=function(E,M,z){return E[0]=M[0]+z[0],E[1]=M[1]+z[1],E[2]=M[2]+z[2],E[3]=M[3]+z[3],E},ii.subtract=c,ii.multiply=l,ii.divide=d,ii.ceil=function(E,M){return E[0]=Math.ceil(M[0]),E[1]=Math.ceil(M[1]),E[2]=Math.ceil(M[2]),E[3]=Math.ceil(M[3]),E},ii.floor=function(E,M){return E[0]=Math.floor(M[0]),E[1]=Math.floor(M[1]),E[2]=Math.floor(M[2]),E[3]=Math.floor(M[3]),E},ii.min=function(E,M,z){return E[0]=Math.min(M[0],z[0]),E[1]=Math.min(M[1],z[1]),E[2]=Math.min(M[2],z[2]),E[3]=Math.min(M[3],z[3]),E},ii.max=function(E,M,z){return E[0]=Math.max(M[0],z[0]),E[1]=Math.max(M[1],z[1]),E[2]=Math.max(M[2],z[2]),E[3]=Math.max(M[3],z[3]),E},ii.round=function(E,M){return E[0]=Math.round(M[0]),E[1]=Math.round(M[1]),E[2]=Math.round(M[2]),E[3]=Math.round(M[3]),E},ii.scale=function(E,M,z){return E[0]=M[0]*z,E[1]=M[1]*z,E[2]=M[2]*z,E[3]=M[3]*z,E},ii.scaleAndAdd=function(E,M,z,N){return E[0]=M[0]+z[0]*N,E[1]=M[1]+z[1]*N,E[2]=M[2]+z[2]*N,E[3]=M[3]+z[3]*N,E},ii.distance=y,ii.squaredDistance=w,ii.length=A,ii.squaredLength=_,ii.negate=function(E,M){return E[0]=-M[0],E[1]=-M[1],E[2]=-M[2],E[3]=-M[3],E},ii.inverse=function(E,M){return E[0]=1/M[0],E[1]=1/M[1],E[2]=1/M[2],E[3]=1/M[3],E},ii.normalize=function(E,M){var z=M[0],N=M[1],V=M[2],Z=M[3],H=z*z+N*N+V*V+Z*Z;return H>0&&(H=1/Math.sqrt(H)),E[0]=z*H,E[1]=N*H,E[2]=V*H,E[3]=Z*H,E},ii.dot=function(E,M){return E[0]*M[0]+E[1]*M[1]+E[2]*M[2]+E[3]*M[3]},ii.cross=function(E,M,z,N){var V=z[0]*N[1]-z[1]*N[0],Z=z[0]*N[2]-z[2]*N[0],H=z[0]*N[3]-z[3]*N[0],q=z[1]*N[2]-z[2]*N[1],Y=z[1]*N[3]-z[3]*N[1],K=z[2]*N[3]-z[3]*N[2],ee=M[0],he=M[1],le=M[2],ue=M[3];return E[0]=he*K-le*Y+ue*q,E[1]=-ee*K+le*H-ue*Z,E[2]=ee*Y-he*H+ue*V,E[3]=-ee*q+he*Z-le*V,E},ii.lerp=function(E,M,z,N){var V=M[0],Z=M[1],H=M[2],q=M[3];return E[0]=V+N*(z[0]-V),E[1]=Z+N*(z[1]-Z),E[2]=H+N*(z[2]-H),E[3]=q+N*(z[3]-q),E},ii.random=function(E,M){var z,N,V,Z,H,q;M=M||1;do H=(z=2*e.RANDOM()-1)*z+(N=2*e.RANDOM()-1)*N;while(H>=1);do q=(V=2*e.RANDOM()-1)*V+(Z=2*e.RANDOM()-1)*Z;while(q>=1);var Y=Math.sqrt((1-H)/q);return E[0]=M*z,E[1]=M*N,E[2]=M*V*Y,E[3]=M*Z*Y,E},ii.transformMat4=function(E,M,z){var N=M[0],V=M[1],Z=M[2],H=M[3];return E[0]=z[0]*N+z[4]*V+z[8]*Z+z[12]*H,E[1]=z[1]*N+z[5]*V+z[9]*Z+z[13]*H,E[2]=z[2]*N+z[6]*V+z[10]*Z+z[14]*H,E[3]=z[3]*N+z[7]*V+z[11]*Z+z[15]*H,E},ii.transformQuat=function(E,M,z){var N=M[0],V=M[1],Z=M[2],H=z[0],q=z[1],Y=z[2],K=z[3],ee=K*N+q*Z-Y*V,he=K*V+Y*N-H*Z,le=K*Z+H*V-q*N,ue=-H*N-q*V-Y*Z;return E[0]=ee*K+ue*-H+he*-Y-le*-q,E[1]=he*K+ue*-q+le*-H-ee*-Y,E[2]=le*K+ue*-Y+ee*-q-he*-H,E[3]=M[3],E},ii.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=0,E},ii.str=function(E){return"vec4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"},ii.exactEquals=function(E,M){return E[0]===M[0]&&E[1]===M[1]&&E[2]===M[2]&&E[3]===M[3]},ii.equals=function(E,M){var z=E[0],N=E[1],V=E[2],Z=E[3],H=M[0],q=M[1],Y=M[2],K=M[3];return Math.abs(z-H)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(H))&&Math.abs(N-q)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(q))&&Math.abs(V-Y)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(Y))&&Math.abs(Z-K)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(K))},ii.forEach=ii.sqrLen=ii.len=ii.sqrDist=ii.dist=ii.div=ii.mul=ii.sub=void 0;var e=function(E,M){if(E&&E.__esModule)return E;if(E===null||a(E)!=="object"&&typeof E!="function")return{default:E};var z=i(void 0);if(z&&z.has(E))return z.get(E);var N={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in E)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(E,Z)){var H=V?Object.getOwnPropertyDescriptor(E,Z):null;H&&(H.get||H.set)?Object.defineProperty(N,Z,H):N[Z]=E[Z]}return N.default=E,z&&z.set(E,N),N}(je());function i(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,z=new WeakMap;return(i=function(N){return N?z:M})(E)}function s(){var E=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[3]=0),E}function c(E,M,z){return E[0]=M[0]-z[0],E[1]=M[1]-z[1],E[2]=M[2]-z[2],E[3]=M[3]-z[3],E}function l(E,M,z){return E[0]=M[0]*z[0],E[1]=M[1]*z[1],E[2]=M[2]*z[2],E[3]=M[3]*z[3],E}function d(E,M,z){return E[0]=M[0]/z[0],E[1]=M[1]/z[1],E[2]=M[2]/z[2],E[3]=M[3]/z[3],E}function y(E,M){return Math.hypot(M[0]-E[0],M[1]-E[1],M[2]-E[2],M[3]-E[3])}function w(E,M){var z=M[0]-E[0],N=M[1]-E[1],V=M[2]-E[2],Z=M[3]-E[3];return z*z+N*N+V*V+Z*Z}function A(E){return Math.hypot(E[0],E[1],E[2],E[3])}function _(E){var M=E[0],z=E[1],N=E[2],V=E[3];return M*M+z*z+N*N+V*V}ii.sub=c,ii.mul=l,ii.div=d,ii.dist=y,ii.sqrDist=w,ii.len=A,ii.sqrLen=_;var T,C=(T=s(),function(E,M,z,N,V,Z){var H,q;for(M||(M=4),z||(z=0),q=N?Math.min(N*M+z,E.length):E.length,H=z;H<q;H+=M)T[0]=E[H],T[1]=E[H+1],T[2]=E[H+2],T[3]=E[H+3],V(T,T,Z),E[H]=T[0],E[H+1]=T[1],E[H+2]=T[2],E[H+3]=T[3];return E});return ii.forEach=C,ii}function ni(){if(di)return ti;function a(pe){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ee){return typeof Ee}:function(Ee){return Ee&&typeof Symbol=="function"&&Ee.constructor===Symbol&&Ee!==Symbol.prototype?"symbol":typeof Ee},a(pe)}di=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.create=y,ti.identity=function(pe){return pe[0]=0,pe[1]=0,pe[2]=0,pe[3]=1,pe},ti.setAxisAngle=w,ti.getAxisAngle=function(pe,Ee){var De=2*Math.acos(Ee[3]),Re=Math.sin(De/2);return Re>e.EPSILON?(pe[0]=Ee[0]/Re,pe[1]=Ee[1]/Re,pe[2]=Ee[2]/Re):(pe[0]=1,pe[1]=0,pe[2]=0),De},ti.getAngle=function(pe,Ee){var De=z(pe,Ee);return Math.acos(2*De*De-1)},ti.multiply=A,ti.rotateX=function(pe,Ee,De){De*=.5;var Re=Ee[0],ke=Ee[1],Pe=Ee[2],Ze=Ee[3],Ue=Math.sin(De),Xe=Math.cos(De);return pe[0]=Re*Xe+Ze*Ue,pe[1]=ke*Xe+Pe*Ue,pe[2]=Pe*Xe-ke*Ue,pe[3]=Ze*Xe-Re*Ue,pe},ti.rotateY=function(pe,Ee,De){De*=.5;var Re=Ee[0],ke=Ee[1],Pe=Ee[2],Ze=Ee[3],Ue=Math.sin(De),Xe=Math.cos(De);return pe[0]=Re*Xe-Pe*Ue,pe[1]=ke*Xe+Ze*Ue,pe[2]=Pe*Xe+Re*Ue,pe[3]=Ze*Xe-ke*Ue,pe},ti.rotateZ=function(pe,Ee,De){De*=.5;var Re=Ee[0],ke=Ee[1],Pe=Ee[2],Ze=Ee[3],Ue=Math.sin(De),Xe=Math.cos(De);return pe[0]=Re*Xe+ke*Ue,pe[1]=ke*Xe-Re*Ue,pe[2]=Pe*Xe+Ze*Ue,pe[3]=Ze*Xe-Pe*Ue,pe},ti.calculateW=function(pe,Ee){var De=Ee[0],Re=Ee[1],ke=Ee[2];return pe[0]=De,pe[1]=Re,pe[2]=ke,pe[3]=Math.sqrt(Math.abs(1-De*De-Re*Re-ke*ke)),pe},ti.exp=_,ti.ln=T,ti.pow=function(pe,Ee,De){return T(pe,Ee),M(pe,pe,De),_(pe,pe),pe},ti.slerp=C,ti.random=function(pe){var Ee=e.RANDOM(),De=e.RANDOM(),Re=e.RANDOM(),ke=Math.sqrt(1-Ee),Pe=Math.sqrt(Ee);return pe[0]=ke*Math.sin(2*Math.PI*De),pe[1]=ke*Math.cos(2*Math.PI*De),pe[2]=Pe*Math.sin(2*Math.PI*Re),pe[3]=Pe*Math.cos(2*Math.PI*Re),pe},ti.invert=function(pe,Ee){var De=Ee[0],Re=Ee[1],ke=Ee[2],Pe=Ee[3],Ze=De*De+Re*Re+ke*ke+Pe*Pe,Ue=Ze?1/Ze:0;return pe[0]=-De*Ue,pe[1]=-Re*Ue,pe[2]=-ke*Ue,pe[3]=Pe*Ue,pe},ti.conjugate=function(pe,Ee){return pe[0]=-Ee[0],pe[1]=-Ee[1],pe[2]=-Ee[2],pe[3]=Ee[3],pe},ti.fromMat3=E,ti.fromEuler=function(pe,Ee,De,Re){var ke=.5*Math.PI/180;Ee*=ke,De*=ke,Re*=ke;var Pe=Math.sin(Ee),Ze=Math.cos(Ee),Ue=Math.sin(De),Xe=Math.cos(De),bt=Math.sin(Re),xt=Math.cos(Re);return pe[0]=Pe*Xe*xt-Ze*Ue*bt,pe[1]=Ze*Ue*xt+Pe*Xe*bt,pe[2]=Ze*Xe*bt-Pe*Ue*xt,pe[3]=Ze*Xe*xt+Pe*Ue*bt,pe},ti.str=function(pe){return"quat("+pe[0]+", "+pe[1]+", "+pe[2]+", "+pe[3]+")"},ti.setAxes=ti.sqlerp=ti.rotationTo=ti.equals=ti.exactEquals=ti.normalize=ti.sqrLen=ti.squaredLength=ti.len=ti.length=ti.lerp=ti.dot=ti.scale=ti.mul=ti.add=ti.set=ti.copy=ti.fromValues=ti.clone=void 0;var e=d(je()),i=d(kt()),s=d(ui()),c=d(pt());function l(pe){if(typeof WeakMap!="function")return null;var Ee=new WeakMap,De=new WeakMap;return(l=function(Re){return Re?De:Ee})(pe)}function d(pe,Ee){if(pe&&pe.__esModule)return pe;if(pe===null||a(pe)!=="object"&&typeof pe!="function")return{default:pe};var De=l(Ee);if(De&&De.has(pe))return De.get(pe);var Re={},ke=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Pe in pe)if(Pe!=="default"&&Object.prototype.hasOwnProperty.call(pe,Pe)){var Ze=ke?Object.getOwnPropertyDescriptor(pe,Pe):null;Ze&&(Ze.get||Ze.set)?Object.defineProperty(Re,Pe,Ze):Re[Pe]=pe[Pe]}return Re.default=pe,De&&De.set(pe,Re),Re}function y(){var pe=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(pe[0]=0,pe[1]=0,pe[2]=0),pe[3]=1,pe}function w(pe,Ee,De){De*=.5;var Re=Math.sin(De);return pe[0]=Re*Ee[0],pe[1]=Re*Ee[1],pe[2]=Re*Ee[2],pe[3]=Math.cos(De),pe}function A(pe,Ee,De){var Re=Ee[0],ke=Ee[1],Pe=Ee[2],Ze=Ee[3],Ue=De[0],Xe=De[1],bt=De[2],xt=De[3];return pe[0]=Re*xt+Ze*Ue+ke*bt-Pe*Xe,pe[1]=ke*xt+Ze*Xe+Pe*Ue-Re*bt,pe[2]=Pe*xt+Ze*bt+Re*Xe-ke*Ue,pe[3]=Ze*xt-Re*Ue-ke*Xe-Pe*bt,pe}function _(pe,Ee){var De=Ee[0],Re=Ee[1],ke=Ee[2],Pe=Ee[3],Ze=Math.sqrt(De*De+Re*Re+ke*ke),Ue=Math.exp(Pe),Xe=Ze>0?Ue*Math.sin(Ze)/Ze:0;return pe[0]=De*Xe,pe[1]=Re*Xe,pe[2]=ke*Xe,pe[3]=Ue*Math.cos(Ze),pe}function T(pe,Ee){var De=Ee[0],Re=Ee[1],ke=Ee[2],Pe=Ee[3],Ze=Math.sqrt(De*De+Re*Re+ke*ke),Ue=Ze>0?Math.atan2(Ze,Pe)/Ze:0;return pe[0]=De*Ue,pe[1]=Re*Ue,pe[2]=ke*Ue,pe[3]=.5*Math.log(De*De+Re*Re+ke*ke+Pe*Pe),pe}function C(pe,Ee,De,Re){var ke,Pe,Ze,Ue,Xe,bt=Ee[0],xt=Ee[1],ei=Ee[2],zt=Ee[3],Nt=De[0],St=De[1],wi=De[2],Xt=De[3];return(Pe=bt*Nt+xt*St+ei*wi+zt*Xt)<0&&(Pe=-Pe,Nt=-Nt,St=-St,wi=-wi,Xt=-Xt),1-Pe>e.EPSILON?(ke=Math.acos(Pe),Ze=Math.sin(ke),Ue=Math.sin((1-Re)*ke)/Ze,Xe=Math.sin(Re*ke)/Ze):(Ue=1-Re,Xe=Re),pe[0]=Ue*bt+Xe*Nt,pe[1]=Ue*xt+Xe*St,pe[2]=Ue*ei+Xe*wi,pe[3]=Ue*zt+Xe*Xt,pe}function E(pe,Ee){var De,Re=Ee[0]+Ee[4]+Ee[8];if(Re>0)De=Math.sqrt(Re+1),pe[3]=.5*De,pe[0]=(Ee[5]-Ee[7])*(De=.5/De),pe[1]=(Ee[6]-Ee[2])*De,pe[2]=(Ee[1]-Ee[3])*De;else{var ke=0;Ee[4]>Ee[0]&&(ke=1),Ee[8]>Ee[3*ke+ke]&&(ke=2);var Pe=(ke+1)%3,Ze=(ke+2)%3;De=Math.sqrt(Ee[3*ke+ke]-Ee[3*Pe+Pe]-Ee[3*Ze+Ze]+1),pe[ke]=.5*De,pe[3]=(Ee[3*Pe+Ze]-Ee[3*Ze+Pe])*(De=.5/De),pe[Pe]=(Ee[3*Pe+ke]+Ee[3*ke+Pe])*De,pe[Ze]=(Ee[3*Ze+ke]+Ee[3*ke+Ze])*De}return pe}ti.clone=c.clone,ti.fromValues=c.fromValues,ti.copy=c.copy,ti.set=c.set,ti.add=c.add,ti.mul=A;var M=c.scale;ti.scale=M;var z=c.dot;ti.dot=z,ti.lerp=c.lerp;var N=c.length;ti.length=N,ti.len=N;var V=c.squaredLength;ti.squaredLength=V,ti.sqrLen=V;var Z=c.normalize;ti.normalize=Z,ti.exactEquals=c.exactEquals,ti.equals=c.equals;var H,q,Y,K=(H=s.create(),q=s.fromValues(1,0,0),Y=s.fromValues(0,1,0),function(pe,Ee,De){var Re=s.dot(Ee,De);return Re<-.999999?(s.cross(H,q,Ee),s.len(H)<1e-6&&s.cross(H,Y,Ee),s.normalize(H,H),w(pe,H,Math.PI),pe):Re>.999999?(pe[0]=0,pe[1]=0,pe[2]=0,pe[3]=1,pe):(s.cross(H,Ee,De),pe[0]=H[0],pe[1]=H[1],pe[2]=H[2],pe[3]=1+Re,Z(pe,pe))});ti.rotationTo=K;var ee,he,le=(ee=y(),he=y(),function(pe,Ee,De,Re,ke,Pe){return C(ee,Ee,ke,Pe),C(he,De,Re,Pe),C(pe,ee,he,2*Pe*(1-Pe)),pe});ti.sqlerp=le;var ue,Te=(ue=i.create(),function(pe,Ee,De,Re){return ue[0]=De[0],ue[3]=De[1],ue[6]=De[2],ue[1]=Re[0],ue[4]=Re[1],ue[7]=Re[2],ue[2]=-Ee[0],ue[5]=-Ee[1],ue[8]=-Ee[2],Z(pe,E(pe,ue))});return ti.setAxes=Te,ti}var pi,ai={};function We(){if(pi)return ai;function a(C){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},a(C)}pi=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=function(){var C=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[4]=0,C[5]=0,C[6]=0,C[7]=0),C[3]=1,C},ai.clone=function(C){var E=new e.ARRAY_TYPE(8);return E[0]=C[0],E[1]=C[1],E[2]=C[2],E[3]=C[3],E[4]=C[4],E[5]=C[5],E[6]=C[6],E[7]=C[7],E},ai.fromValues=function(C,E,M,z,N,V,Z,H){var q=new e.ARRAY_TYPE(8);return q[0]=C,q[1]=E,q[2]=M,q[3]=z,q[4]=N,q[5]=V,q[6]=Z,q[7]=H,q},ai.fromRotationTranslationValues=function(C,E,M,z,N,V,Z){var H=new e.ARRAY_TYPE(8);H[0]=C,H[1]=E,H[2]=M,H[3]=z;var q=.5*N,Y=.5*V,K=.5*Z;return H[4]=q*z+Y*M-K*E,H[5]=Y*z+K*C-q*M,H[6]=K*z+q*E-Y*C,H[7]=-q*C-Y*E-K*M,H},ai.fromRotationTranslation=d,ai.fromTranslation=function(C,E){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=.5*E[0],C[5]=.5*E[1],C[6]=.5*E[2],C[7]=0,C},ai.fromRotation=function(C,E){return C[0]=E[0],C[1]=E[1],C[2]=E[2],C[3]=E[3],C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},ai.fromMat4=function(C,E){var M=i.create();s.getRotation(M,E);var z=new e.ARRAY_TYPE(3);return s.getTranslation(z,E),d(C,M,z),C},ai.copy=y,ai.identity=function(C){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},ai.set=function(C,E,M,z,N,V,Z,H,q){return C[0]=E,C[1]=M,C[2]=z,C[3]=N,C[4]=V,C[5]=Z,C[6]=H,C[7]=q,C},ai.getDual=function(C,E){return C[0]=E[4],C[1]=E[5],C[2]=E[6],C[3]=E[7],C},ai.setDual=function(C,E){return C[4]=E[0],C[5]=E[1],C[6]=E[2],C[7]=E[3],C},ai.getTranslation=function(C,E){var M=E[4],z=E[5],N=E[6],V=E[7],Z=-E[0],H=-E[1],q=-E[2],Y=E[3];return C[0]=2*(M*Y+V*Z+z*q-N*H),C[1]=2*(z*Y+V*H+N*Z-M*q),C[2]=2*(N*Y+V*q+M*H-z*Z),C},ai.translate=function(C,E,M){var z=E[0],N=E[1],V=E[2],Z=E[3],H=.5*M[0],q=.5*M[1],Y=.5*M[2],K=E[4],ee=E[5],he=E[6],le=E[7];return C[0]=z,C[1]=N,C[2]=V,C[3]=Z,C[4]=Z*H+N*Y-V*q+K,C[5]=Z*q+V*H-z*Y+ee,C[6]=Z*Y+z*q-N*H+he,C[7]=-z*H-N*q-V*Y+le,C},ai.rotateX=function(C,E,M){var z=-E[0],N=-E[1],V=-E[2],Z=E[3],H=E[4],q=E[5],Y=E[6],K=E[7],ee=H*Z+K*z+q*V-Y*N,he=q*Z+K*N+Y*z-H*V,le=Y*Z+K*V+H*N-q*z,ue=K*Z-H*z-q*N-Y*V;return i.rotateX(C,E,M),C[4]=ee*(Z=C[3])+ue*(z=C[0])+he*(V=C[2])-le*(N=C[1]),C[5]=he*Z+ue*N+le*z-ee*V,C[6]=le*Z+ue*V+ee*N-he*z,C[7]=ue*Z-ee*z-he*N-le*V,C},ai.rotateY=function(C,E,M){var z=-E[0],N=-E[1],V=-E[2],Z=E[3],H=E[4],q=E[5],Y=E[6],K=E[7],ee=H*Z+K*z+q*V-Y*N,he=q*Z+K*N+Y*z-H*V,le=Y*Z+K*V+H*N-q*z,ue=K*Z-H*z-q*N-Y*V;return i.rotateY(C,E,M),C[4]=ee*(Z=C[3])+ue*(z=C[0])+he*(V=C[2])-le*(N=C[1]),C[5]=he*Z+ue*N+le*z-ee*V,C[6]=le*Z+ue*V+ee*N-he*z,C[7]=ue*Z-ee*z-he*N-le*V,C},ai.rotateZ=function(C,E,M){var z=-E[0],N=-E[1],V=-E[2],Z=E[3],H=E[4],q=E[5],Y=E[6],K=E[7],ee=H*Z+K*z+q*V-Y*N,he=q*Z+K*N+Y*z-H*V,le=Y*Z+K*V+H*N-q*z,ue=K*Z-H*z-q*N-Y*V;return i.rotateZ(C,E,M),C[4]=ee*(Z=C[3])+ue*(z=C[0])+he*(V=C[2])-le*(N=C[1]),C[5]=he*Z+ue*N+le*z-ee*V,C[6]=le*Z+ue*V+ee*N-he*z,C[7]=ue*Z-ee*z-he*N-le*V,C},ai.rotateByQuatAppend=function(C,E,M){var z=M[0],N=M[1],V=M[2],Z=M[3],H=E[0],q=E[1],Y=E[2],K=E[3];return C[0]=H*Z+K*z+q*V-Y*N,C[1]=q*Z+K*N+Y*z-H*V,C[2]=Y*Z+K*V+H*N-q*z,C[3]=K*Z-H*z-q*N-Y*V,C[4]=(H=E[4])*Z+(K=E[7])*z+(q=E[5])*V-(Y=E[6])*N,C[5]=q*Z+K*N+Y*z-H*V,C[6]=Y*Z+K*V+H*N-q*z,C[7]=K*Z-H*z-q*N-Y*V,C},ai.rotateByQuatPrepend=function(C,E,M){var z=E[0],N=E[1],V=E[2],Z=E[3],H=M[0],q=M[1],Y=M[2],K=M[3];return C[0]=z*K+Z*H+N*Y-V*q,C[1]=N*K+Z*q+V*H-z*Y,C[2]=V*K+Z*Y+z*q-N*H,C[3]=Z*K-z*H-N*q-V*Y,C[4]=z*(K=M[7])+Z*(H=M[4])+N*(Y=M[6])-V*(q=M[5]),C[5]=N*K+Z*q+V*H-z*Y,C[6]=V*K+Z*Y+z*q-N*H,C[7]=Z*K-z*H-N*q-V*Y,C},ai.rotateAroundAxis=function(C,E,M,z){if(Math.abs(z)<e.EPSILON)return y(C,E);var N=Math.hypot(M[0],M[1],M[2]);z*=.5;var V=Math.sin(z),Z=V*M[0]/N,H=V*M[1]/N,q=V*M[2]/N,Y=Math.cos(z),K=E[0],ee=E[1],he=E[2],le=E[3];C[0]=K*Y+le*Z+ee*q-he*H,C[1]=ee*Y+le*H+he*Z-K*q,C[2]=he*Y+le*q+K*H-ee*Z,C[3]=le*Y-K*Z-ee*H-he*q;var ue=E[4],Te=E[5],pe=E[6],Ee=E[7];return C[4]=ue*Y+Ee*Z+Te*q-pe*H,C[5]=Te*Y+Ee*H+pe*Z-ue*q,C[6]=pe*Y+Ee*q+ue*H-Te*Z,C[7]=Ee*Y-ue*Z-Te*H-pe*q,C},ai.add=function(C,E,M){return C[0]=E[0]+M[0],C[1]=E[1]+M[1],C[2]=E[2]+M[2],C[3]=E[3]+M[3],C[4]=E[4]+M[4],C[5]=E[5]+M[5],C[6]=E[6]+M[6],C[7]=E[7]+M[7],C},ai.multiply=w,ai.scale=function(C,E,M){return C[0]=E[0]*M,C[1]=E[1]*M,C[2]=E[2]*M,C[3]=E[3]*M,C[4]=E[4]*M,C[5]=E[5]*M,C[6]=E[6]*M,C[7]=E[7]*M,C},ai.lerp=function(C,E,M,z){var N=1-z;return A(E,M)<0&&(z=-z),C[0]=E[0]*N+M[0]*z,C[1]=E[1]*N+M[1]*z,C[2]=E[2]*N+M[2]*z,C[3]=E[3]*N+M[3]*z,C[4]=E[4]*N+M[4]*z,C[5]=E[5]*N+M[5]*z,C[6]=E[6]*N+M[6]*z,C[7]=E[7]*N+M[7]*z,C},ai.invert=function(C,E){var M=T(E);return C[0]=-E[0]/M,C[1]=-E[1]/M,C[2]=-E[2]/M,C[3]=E[3]/M,C[4]=-E[4]/M,C[5]=-E[5]/M,C[6]=-E[6]/M,C[7]=E[7]/M,C},ai.conjugate=function(C,E){return C[0]=-E[0],C[1]=-E[1],C[2]=-E[2],C[3]=E[3],C[4]=-E[4],C[5]=-E[5],C[6]=-E[6],C[7]=E[7],C},ai.normalize=function(C,E){var M=T(E);if(M>0){M=Math.sqrt(M);var z=E[0]/M,N=E[1]/M,V=E[2]/M,Z=E[3]/M,H=E[4],q=E[5],Y=E[6],K=E[7],ee=z*H+N*q+V*Y+Z*K;C[0]=z,C[1]=N,C[2]=V,C[3]=Z,C[4]=(H-z*ee)/M,C[5]=(q-N*ee)/M,C[6]=(Y-V*ee)/M,C[7]=(K-Z*ee)/M}return C},ai.str=function(C){return"quat2("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+")"},ai.exactEquals=function(C,E){return C[0]===E[0]&&C[1]===E[1]&&C[2]===E[2]&&C[3]===E[3]&&C[4]===E[4]&&C[5]===E[5]&&C[6]===E[6]&&C[7]===E[7]},ai.equals=function(C,E){var M=C[0],z=C[1],N=C[2],V=C[3],Z=C[4],H=C[5],q=C[6],Y=C[7],K=E[0],ee=E[1],he=E[2],le=E[3],ue=E[4],Te=E[5],pe=E[6],Ee=E[7];return Math.abs(M-K)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(K))&&Math.abs(z-ee)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(ee))&&Math.abs(N-he)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(he))&&Math.abs(V-le)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(le))&&Math.abs(Z-ue)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(ue))&&Math.abs(H-Te)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Te))&&Math.abs(q-pe)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(pe))&&Math.abs(Y-Ee)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Ee))},ai.sqrLen=ai.squaredLength=ai.len=ai.length=ai.dot=ai.mul=ai.setReal=ai.getReal=void 0;var e=l(je()),i=l(ni()),s=l(hi());function c(C){if(typeof WeakMap!="function")return null;var E=new WeakMap,M=new WeakMap;return(c=function(z){return z?M:E})(C)}function l(C,E){if(C&&C.__esModule)return C;if(C===null||a(C)!=="object"&&typeof C!="function")return{default:C};var M=c(E);if(M&&M.has(C))return M.get(C);var z={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in C)if(V!=="default"&&Object.prototype.hasOwnProperty.call(C,V)){var Z=N?Object.getOwnPropertyDescriptor(C,V):null;Z&&(Z.get||Z.set)?Object.defineProperty(z,V,Z):z[V]=C[V]}return z.default=C,M&&M.set(C,z),z}function d(C,E,M){var z=.5*M[0],N=.5*M[1],V=.5*M[2],Z=E[0],H=E[1],q=E[2],Y=E[3];return C[0]=Z,C[1]=H,C[2]=q,C[3]=Y,C[4]=z*Y+N*q-V*H,C[5]=N*Y+V*Z-z*q,C[6]=V*Y+z*H-N*Z,C[7]=-z*Z-N*H-V*q,C}function y(C,E){return C[0]=E[0],C[1]=E[1],C[2]=E[2],C[3]=E[3],C[4]=E[4],C[5]=E[5],C[6]=E[6],C[7]=E[7],C}function w(C,E,M){var z=E[0],N=E[1],V=E[2],Z=E[3],H=M[4],q=M[5],Y=M[6],K=M[7],ee=E[4],he=E[5],le=E[6],ue=E[7],Te=M[0],pe=M[1],Ee=M[2],De=M[3];return C[0]=z*De+Z*Te+N*Ee-V*pe,C[1]=N*De+Z*pe+V*Te-z*Ee,C[2]=V*De+Z*Ee+z*pe-N*Te,C[3]=Z*De-z*Te-N*pe-V*Ee,C[4]=z*K+Z*H+N*Y-V*q+ee*De+ue*Te+he*Ee-le*pe,C[5]=N*K+Z*q+V*H-z*Y+he*De+ue*pe+le*Te-ee*Ee,C[6]=V*K+Z*Y+z*q-N*H+le*De+ue*Ee+ee*pe-he*Te,C[7]=Z*K-z*H-N*q-V*Y+ue*De-ee*Te-he*pe-le*Ee,C}ai.getReal=i.copy,ai.setReal=i.copy,ai.mul=w;var A=i.dot;ai.dot=A;var _=i.length;ai.length=_,ai.len=_;var T=i.squaredLength;return ai.squaredLength=T,ai.sqrLen=T,ai}var Jt,Ei,Ot={};function ji(){if(Jt)return Ot;function a(E){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},a(E)}Jt=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.create=s,Ot.clone=function(E){var M=new e.ARRAY_TYPE(2);return M[0]=E[0],M[1]=E[1],M},Ot.fromValues=function(E,M){var z=new e.ARRAY_TYPE(2);return z[0]=E,z[1]=M,z},Ot.copy=function(E,M){return E[0]=M[0],E[1]=M[1],E},Ot.set=function(E,M,z){return E[0]=M,E[1]=z,E},Ot.add=function(E,M,z){return E[0]=M[0]+z[0],E[1]=M[1]+z[1],E},Ot.subtract=c,Ot.multiply=l,Ot.divide=d,Ot.ceil=function(E,M){return E[0]=Math.ceil(M[0]),E[1]=Math.ceil(M[1]),E},Ot.floor=function(E,M){return E[0]=Math.floor(M[0]),E[1]=Math.floor(M[1]),E},Ot.min=function(E,M,z){return E[0]=Math.min(M[0],z[0]),E[1]=Math.min(M[1],z[1]),E},Ot.max=function(E,M,z){return E[0]=Math.max(M[0],z[0]),E[1]=Math.max(M[1],z[1]),E},Ot.round=function(E,M){return E[0]=Math.round(M[0]),E[1]=Math.round(M[1]),E},Ot.scale=function(E,M,z){return E[0]=M[0]*z,E[1]=M[1]*z,E},Ot.scaleAndAdd=function(E,M,z,N){return E[0]=M[0]+z[0]*N,E[1]=M[1]+z[1]*N,E},Ot.distance=y,Ot.squaredDistance=w,Ot.length=A,Ot.squaredLength=_,Ot.negate=function(E,M){return E[0]=-M[0],E[1]=-M[1],E},Ot.inverse=function(E,M){return E[0]=1/M[0],E[1]=1/M[1],E},Ot.normalize=function(E,M){var z=M[0],N=M[1],V=z*z+N*N;return V>0&&(V=1/Math.sqrt(V)),E[0]=M[0]*V,E[1]=M[1]*V,E},Ot.dot=function(E,M){return E[0]*M[0]+E[1]*M[1]},Ot.cross=function(E,M,z){var N=M[0]*z[1]-M[1]*z[0];return E[0]=E[1]=0,E[2]=N,E},Ot.lerp=function(E,M,z,N){var V=M[0],Z=M[1];return E[0]=V+N*(z[0]-V),E[1]=Z+N*(z[1]-Z),E},Ot.random=function(E,M){M=M||1;var z=2*e.RANDOM()*Math.PI;return E[0]=Math.cos(z)*M,E[1]=Math.sin(z)*M,E},Ot.transformMat2=function(E,M,z){var N=M[0],V=M[1];return E[0]=z[0]*N+z[2]*V,E[1]=z[1]*N+z[3]*V,E},Ot.transformMat2d=function(E,M,z){var N=M[0],V=M[1];return E[0]=z[0]*N+z[2]*V+z[4],E[1]=z[1]*N+z[3]*V+z[5],E},Ot.transformMat3=function(E,M,z){var N=M[0],V=M[1];return E[0]=z[0]*N+z[3]*V+z[6],E[1]=z[1]*N+z[4]*V+z[7],E},Ot.transformMat4=function(E,M,z){var N=M[0],V=M[1];return E[0]=z[0]*N+z[4]*V+z[12],E[1]=z[1]*N+z[5]*V+z[13],E},Ot.rotate=function(E,M,z,N){var V=M[0]-z[0],Z=M[1]-z[1],H=Math.sin(N),q=Math.cos(N);return E[0]=V*q-Z*H+z[0],E[1]=V*H+Z*q+z[1],E},Ot.angle=function(E,M){var z=E[0],N=E[1],V=M[0],Z=M[1],H=Math.sqrt(z*z+N*N)*Math.sqrt(V*V+Z*Z);return Math.acos(Math.min(Math.max(H&&(z*V+N*Z)/H,-1),1))},Ot.zero=function(E){return E[0]=0,E[1]=0,E},Ot.str=function(E){return"vec2("+E[0]+", "+E[1]+")"},Ot.exactEquals=function(E,M){return E[0]===M[0]&&E[1]===M[1]},Ot.equals=function(E,M){var z=E[0],N=E[1],V=M[0],Z=M[1];return Math.abs(z-V)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(V))&&Math.abs(N-Z)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(Z))},Ot.forEach=Ot.sqrLen=Ot.sqrDist=Ot.dist=Ot.div=Ot.mul=Ot.sub=Ot.len=void 0;var e=function(E,M){if(E&&E.__esModule)return E;if(E===null||a(E)!=="object"&&typeof E!="function")return{default:E};var z=i(void 0);if(z&&z.has(E))return z.get(E);var N={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in E)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(E,Z)){var H=V?Object.getOwnPropertyDescriptor(E,Z):null;H&&(H.get||H.set)?Object.defineProperty(N,Z,H):N[Z]=E[Z]}return N.default=E,z&&z.set(E,N),N}(je());function i(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,z=new WeakMap;return(i=function(N){return N?z:M})(E)}function s(){var E=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0),E}function c(E,M,z){return E[0]=M[0]-z[0],E[1]=M[1]-z[1],E}function l(E,M,z){return E[0]=M[0]*z[0],E[1]=M[1]*z[1],E}function d(E,M,z){return E[0]=M[0]/z[0],E[1]=M[1]/z[1],E}function y(E,M){return Math.hypot(M[0]-E[0],M[1]-E[1])}function w(E,M){var z=M[0]-E[0],N=M[1]-E[1];return z*z+N*N}function A(E){return Math.hypot(E[0],E[1])}function _(E){var M=E[0],z=E[1];return M*M+z*z}Ot.len=A,Ot.sub=c,Ot.mul=l,Ot.div=d,Ot.dist=y,Ot.sqrDist=w,Ot.sqrLen=_;var T,C=(T=s(),function(E,M,z,N,V,Z){var H,q;for(M||(M=2),z||(z=0),q=N?Math.min(N*M+z,E.length):E.length,H=z;H<q;H+=M)T[0]=E[H],T[1]=E[H+1],V(T,T,Z),E[H]=T[0],E[H+1]=T[1];return E});return Ot.forEach=C,Ot}function An(){if(Ei)return oe;function a(E){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},a(E)}Ei=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.vec4=oe.vec3=oe.vec2=oe.quat2=oe.quat=oe.mat4=oe.mat3=oe.mat2d=oe.mat2=oe.glMatrix=void 0;var e=C(je());oe.glMatrix=e;var i=C(Fe());oe.mat2=i;var s=C(tt());oe.mat2d=s;var c=C(kt());oe.mat3=c;var l=C(hi());oe.mat4=l;var d=C(ni());oe.quat=d;var y=C(We());oe.quat2=y;var w=C(ji());oe.vec2=w;var A=C(ui());oe.vec3=A;var _=C(pt());function T(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,z=new WeakMap;return(T=function(N){return N?z:M})(E)}function C(E,M){if(E&&E.__esModule)return E;if(E===null||a(E)!=="object"&&typeof E!="function")return{default:E};var z=T(M);if(z&&z.has(E))return z.get(E);var N={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in E)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(E,Z)){var H=V?Object.getOwnPropertyDescriptor(E,Z):null;H&&(H.get||H.set)?Object.defineProperty(N,Z,H):N[Z]=E[Z]}return N.default=E,z&&z.set(E,N),N}return oe.vec4=_,oe}var Xi,nr,sr,Aa,de=An(),us=function(){if(nr)return Xi;function a(e,i,s,c){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=c}return nr=1,Xi=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,c=0;c<8;c++){var l=this.sampleCurveX(s)-e;if(Math.abs(l)<i)return s;var d=this.sampleCurveDerivativeX(s);if(Math.abs(d)<1e-6)break;s-=l/d}var y=0,w=1;for(s=e,c=0;c<20&&(l=this.sampleCurveX(s),!(Math.abs(l-e)<i));c++)e>l?y=s:w=s,s=.5*(w-y)+y;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Xi}(),Ts=re(us);function ks(){if(Aa)return sr;function a(e,i){this.x=e,this.y=i}return Aa=1,sr=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,s=e.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),s=Math.sin(e),c=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=c,this},_rotateAround:function(e,i){var s=Math.cos(e),c=Math.sin(e),l=i.y+c*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-c*(this.y-i.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(e){return e instanceof a?e:Array.isArray(e)?new a(e[0],e[1]):e},sr}var Ft=re(ks());function Ss(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let i=0;i<a.length;i++)if(!Ss(a[i],e[i]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(const i in a)if(!Ss(a[i],e[i]))return!1;return!0}return a===e}const ya=Math.PI/180,qr=180/Math.PI;function ln(a){return a*ya}function Br(a){return a*qr}const Bs=[[0,0],[1,0],[1,1],[0,1]];function Es(a){if(a<=0)return 0;if(a>=1)return 1;const e=a*a,i=e*a;return 4*(a<.5?i:3*(a-e)+i-.75)}function Qe(a,e,i,s){const c=new Ts(a,e,i,s);return function(l){return c.solve(l)}}const Mt=Qe(.25,.1,.25,1);function vt(a,e,i){return Math.min(i,Math.max(e,a))}function bi(a,e,i){return(i=vt((i-a)/(e-a),0,1))*i*(3-2*i)}function gi(a,e,i){const s=i-e,c=((a-e)%s+s)%s+e;return c===e?i:c}function ri(a,e,i){if(!a.length)return i(null,[]);let s=a.length;const c=new Array(a.length);let l=null;a.forEach((d,y)=>{e(d,(w,A)=>{w&&(l=w),c[y]=A,--s==0&&i(l,c)})})}function vi(a,...e){for(const i of e)for(const s in i)a[s]=i[s];return a}let sn=1;function or(){return sn++}function Gr(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function hc(a,e){a.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function hs(a,e,i){const s={};for(const c in a)s[c]=e.call(this,a[c],c,a);return s}function ds(a,e,i){const s={};for(const c in a)e.call(this,a[c],c,a)&&(s[c]=a[c]);return s}function Wr(a){return Array.isArray(a)?a.map(Wr):typeof a=="object"&&a?hs(a,Wr):a}const Ns={};function Kn(a){Ns[a]||(typeof console<"u"&&console.warn(a),Ns[a]=!0)}function Nn(a,e,i){return(i.y-a.y)*(e.x-a.x)>(e.y-a.y)*(i.x-a.x)}function bu(a){let e=0;for(let i,s,c=0,l=a.length,d=l-1;c<l;d=c++)i=a[c],s=a[d],e+=(s.x-i.x)*(i.y+s.y);return e}function dc([a,e,i]){const s=ln(e+90),c=ln(i);return{x:a*Math.cos(s)*Math.sin(c),y:a*Math.sin(s)*Math.sin(c),z:a*Math.cos(c),azimuthal:e,polar:i}}function Ma(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function so(a){const e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,c,l)=>{const d=c||l;return e[s]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let fh=null;function fc(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function ph(a,e,i,s){for(;e<i;){const c=e+i>>1;a[c]<s?e=c+1:i=c}return e}function wu(a,e,i,s){for(;e<i;){const c=e+i>>1;a[c]<=s?e=c+1:i=c}return e}function pc(a){return a>0?1/(1.001-a):1+a}function at(a){return a>0?1-1/(1.001-a):-a}const ie={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ie.API_URL)return null;try{const a=new URL(ie.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ae(a){return ie.API_URL_REGEX.test(a)}function ge(a){return ie.API_SPRITE_REGEX.test(a)}let Ae,Me,Oe,Je,Be,it;function lt(){return Ae==null&&(Ae=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ae}const rt={now:()=>Je!==void 0?Je:performance.now(),setNow(a){Je=a},restoreNow(){Je=void 0},frame(a){const e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){const{width:i,height:s}=a;Be||(Be=document.createElement("canvas"));const c=Be.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Be.width||s>Be.height)&&(Be.width=i,Be.height=s),c.clearRect(-e,-e,i+2*e,s+2*e),c.drawImage(a,0,0,i,s),c.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:a=>(Me||(Me=document.createElement("a")),Me.href=a,Me.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Oe==null&&(Oe=window.matchMedia("(prefers-reduced-motion: reduce)")),Oe.matches)},hasCanvasFingerprintNoise(){if(it!==void 0)return it;if(!lt())return it=!1,!1;const a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0});let i=0;for(let c=0;c<a.width;++c)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(c,0,1,1);const s=e.getImageData(0,0,a.width,a.height);i=0;for(let c=0;c<s.data.length;++c)if(c%4!=3&&i++!==s.data[c])return it=!0,!0;return it=!1,!1}};function Dt(a,e){const i=a.indexOf("?");if(i<0)return`${a}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(a.slice(i));for(const c in e)s.set(c,e[c]);return`${a.slice(0,i)}?${s.toString()}`}function Ht(a,e={persistentParams:[]}){const i=a.indexOf("?");if(i<0)return a;const s=new URLSearchParams,c=new URLSearchParams(a.slice(i));for(const d of e.persistentParams){const y=c.get(d);y&&s.set(d,y)}const l=s.toString();return`${a.slice(0,i)}${l.length>0?`?${l}`:""}`}const Yt="mapbox-tiles";let zi=500,Ai=50;const qi=["language","worldview","jobid"];let $i,Fn;function Jn(){try{return caches}catch{}}function rn(){const a=Jn();a&&$i==null&&($i=a.open(Yt))}let Rn=1/0;const Dn={supported:!1,testSupport:function(a){!Nr&&fr&&(Mr?Ca(a):kn=a)}};let kn,fr,Nr=!1,Mr=!1;const fs=typeof self<"u"?self:{};function Ca(a){const e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,fr),a.isContextLost())return;Dn.supported=!0}catch{}a.deleteTexture(e),Nr=!0}fs.document&&(fr=fs.document.createElement("img"),fr.onload=function(){kn&&Ca(kn),kn=null,Mr=!0},fr.onerror=function(){Nr=!0,kn=null},fr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Cr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Cr);class Kr extends Error{constructor(e,i,s){i===401&&ae(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const vl=Ma()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Fs=function(a,e){if(!(/^file:/.test(i=a.url)||/^file:/.test(vl())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,c){const l=new AbortController,d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:vl(),referrerPolicy:s.referrerPolicy,signal:l.signal});let y=!1,w=!1;const A=(_=d.url).indexOf("sku=")>0&&ae(_);var _;s.type==="json"&&d.headers.set("Accept","application/json");const T=(E,M,z)=>{if(w)return;if(E&&E.message!=="SecurityError"&&Kn(E.toString()),M&&z)return C(M);const N=Date.now();fetch(d).then(V=>{if(V.ok){const Z=A?V.clone():null;return C(V,Z,N)}return c(new Kr(V.statusText,V.status,s.url))}).catch(V=>{V.name!=="AbortError"&&c(new Error(`${V.message} ${s.url}`))})},C=(E,M,z)=>{(s.type==="arrayBuffer"?E.arrayBuffer():s.type==="json"?E.json():E.text()).then(N=>{w||(M&&z&&function(V,Z,H){if(rn(),$i==null)return;const q=so(Z.headers.get("Cache-Control")||"");if(q["no-store"])return;const Y={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((he,le)=>Y.headers.set(le,he)),q["max-age"]&&Y.headers.set("Expires",new Date(H+1e3*q["max-age"]).toUTCString());const K=Y.headers.get("Expires");if(!K||new Date(K).getTime()-H<42e4)return;let ee=Ht(V.url,{persistentParams:qi});if(Z.status===206){const he=V.headers.get("Range");if(!he)return;Y.status=200,ee=Dt(ee,{range:he})}(function(he,le){if(Fn===void 0)try{new Response(new ReadableStream),Fn=!0}catch{Fn=!1}Fn?le(he.body):he.blob().then(le)})(Z,he=>{const le=new Response((ue=Z.status)!==200&&ue!==404&&[101,103,204,205,304].includes(ue)?null:he,Y);var ue;rn(),$i!=null&&$i.then(Te=>Te.put(ee,le)).catch(Te=>Kn(Te.message))})}(d,M,z),y=!0,c(null,N,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(N=>{w||c(new Error(N.message))})};return A?function(E,M){if(rn(),$i==null)return M(null);$i.then(z=>{let N=Ht(E.url,{persistentParams:qi});const V=E.headers.get("Range");V&&(N=Dt(N,{range:V})),z.match(N).then(Z=>{const H=function(q){if(!q)return!1;const Y=new Date(q.headers.get("Expires")||0),K=so(q.headers.get("Cache-Control")||"");return Y>Date.now()&&!K["no-cache"]}(Z);z.delete(N),H&&z.put(N,Z.clone()),M(null,Z,H)}).catch(M)}).catch(M)}(d,T):T(null,null),{cancel:()=>{w=!0,y||l.abort()}}}(a,e);if(Ma()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var i;return function(s,c){const l=new XMLHttpRequest;l.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const d in s.headers)l.setRequestHeader(d,s.headers[d]);return s.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=s.credentials==="include",l.onerror=()=>{c(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let d=l.response;if(s.type==="json")try{d=JSON.parse(l.response)}catch(y){return c(y)}c(null,d,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else c(new Kr(l.statusText,l.status,s.url))},l.send(s.body),{cancel:()=>l.abort()}}(a,e)},Mo=function(a,e){return Fs(vi(a,{type:"arrayBuffer"}),e)};function ps(a){const e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}const mh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let _h,Zo;_h=[],Zo=0;const Ad=function(a,e){if(Dn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Zo>=ie.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return _h.push(l),l}Zo++;let i=!1;const s=()=>{if(!i)for(i=!0,Zo--;_h.length&&Zo<ie.MAX_PARALLEL_IMAGE_REQUESTS;){const l=_h.shift(),{requestParameters:d,callback:y,cancelled:w}=l;w||(l.cancel=Ad(d,y).cancel)}},c=Mo(a,(l,d,y,w)=>{s(),l?e(l):d&&(self.createImageBitmap?function(A,_){const T=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(T).then(C=>{_(null,C)}).catch(C=>{_(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(A,_)=>e(A,_,y,w)):function(A,_){const T=new Image;T.onload=()=>{_(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=mh})},T.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(A)],{type:"image/png"});T.src=A.byteLength?URL.createObjectURL(C):mh}(d,(A,_)=>e(A,_,y,w)))});return{cancel:()=>{c.cancel(),s()}}};var gh,am,ms,xl={exports:{}},_s={exports:{}},As={exports:{}},Ms=function(){if(ms)return xl.exports;ms=1;var a=(gh||(gh=1,_s.exports=function(i,s){var c,l,d,y,w,A,_,T;for(l=i.length-(c=3&i.length),d=s,w=3432918353,A=461845907,T=0;T<l;)_=255&i.charCodeAt(T)|(255&i.charCodeAt(++T))<<8|(255&i.charCodeAt(++T))<<16|(255&i.charCodeAt(++T))<<24,++T,d=27492+(65535&(y=5*(65535&(d=(d^=_=(65535&(_=(_=(65535&_)*w+(((_>>>16)*w&65535)<<16)&4294967295)<<15|_>>>17))*A+(((_>>>16)*A&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(_=0,c){case 3:_^=(255&i.charCodeAt(T+2))<<16;case 2:_^=(255&i.charCodeAt(T+1))<<8;case 1:d^=_=(65535&(_=(_=(65535&(_^=255&i.charCodeAt(T)))*w+(((_>>>16)*w&65535)<<16)&4294967295)<<15|_>>>17))*A+(((_>>>16)*A&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),_s.exports),e=(am||(am=1,As.exports=function(i,s){for(var c,l=i.length,d=s^l,y=0;l>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),l-=4,++y;switch(l){case 3:d^=(255&i.charCodeAt(y+2))<<16;case 2:d^=(255&i.charCodeAt(y+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(y)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),As.exports);return xl.exports=a,xl.exports.murmur3=a,xl.exports.murmur2=e,xl.exports}(),gs=re(Ms);class Ya{constructor(e,...i){vi(this,i[0]||{}),this.type=e}}class oo extends Ya{constructor(e,i={}){super("error",vi({error:e},i))}}function Kf(a,e,i){i[a]&&i[a].indexOf(e)!==-1||(i[a]=i[a]||[],i[a].push(e))}function yh(a,e,i){if(i&&i[a]){const s=i[a].indexOf(e);s!==-1&&i[a].splice(s,1)}}class Vs{on(e,i){return this._listeners=this._listeners||{},Kf(e,i,this._listeners),this}off(e,i){return yh(e,i,this._listeners),yh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Kf(e,i,this._oneTimeListeners),this):new Promise(s=>{this.once(e,s)})}fire(e,i){const s=typeof e=="string"?new Ya(e,i):e,c=s.type;if(this.listens(c)){s.target=this;const l=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of l)w.call(this,s);const d=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of d)yh(c,w,this._oneTimeListeners),w.call(this,s);const y=this._eventedParent;y&&(vi(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(s))}else s instanceof oo&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Ia{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Ia(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,s]=e.split("");return new Ia({name:i,iconsetId:s})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Ia.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var sm,Jf={},Wa=function(){if(sm)return Jf;sm=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(l){return(l=Math.round(l))<0?0:l>255?255:l}function i(l){return e(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function s(l){return(d=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:d>1?1:d;var d}function c(l,d,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?l+(d-l)*y*6:2*y<1?d:3*y<2?l+(d-l)*(2/3-y)*6:l}try{Jf.parseCSSColor=function(l){var d,y=l.replace(/ /g,"").toLowerCase();if(y in a)return a[y].slice();if(y[0]==="#")return y.length===4?(d=parseInt(y.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:y.length===7&&(d=parseInt(y.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var w=y.indexOf("("),A=y.indexOf(")");if(w!==-1&&A+1===y.length){var _=y.substr(0,w),T=y.substr(w+1,A-(w+1)).split(","),C=1;switch(_){case"rgba":if(T.length!==4)return null;C=s(T.pop());case"rgb":return T.length!==3?null:[i(T[0]),i(T[1]),i(T[2]),C];case"hsla":if(T.length!==4)return null;C=s(T.pop());case"hsl":if(T.length!==3)return null;var E=(parseFloat(T[0])%360+360)%360/360,M=s(T[1]),z=s(T[2]),N=z<=.5?z*(M+1):z+M-z*M,V=2*z-N;return[e(255*c(V,N,E+1/3)),e(255*c(V,N,E)),e(255*c(V,N,E-1/3)),C];default:return null}}return null}}catch{}return Jf}();class Mn{constructor(e,i,s,c=1){this.r=e,this.g=i,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof Mn)return e;if(typeof e!="string")return;const i=Wa.parseCSSColor(e);return i?new Mn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,s,c]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${c})`}toString(){const[e,i,s,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${c})`}toRenderColor(e){const{r:i,g:s,b:c,a:l}=this;return new vh(e,i,s,c,l)}clone(){return new Mn(this.r,this.g,this.b,this.a)}}class vh{constructor(e,i,s,c,l){if(e){const d=e.image.height,y=d*d;i=l===0?0:i/l*(d-1),s=l===0?0:s/l*(d-1),c=l===0?0:c/l*(d-1);const w=Math.floor(i),A=Math.floor(s),_=Math.floor(c),T=Math.ceil(i),C=Math.ceil(s),E=Math.ceil(c),M=i-w,z=s-A,N=c-_,V=e.image.data,Z=4*(w+A*y+_*d),H=4*(w+A*y+E*d),q=4*(w+C*y+_*d),Y=4*(w+C*y+E*d),K=4*(T+A*y+_*d),ee=4*(T+A*y+E*d),he=4*(T+C*y+_*d),le=4*(T+C*y+E*d);if(Z<0||le>=V.length)throw new Error("out of range");this.r=yi(yi(yi(V[Z],V[H],N),yi(V[q],V[Y],N),z),yi(yi(V[K],V[ee],N),yi(V[he],V[le],N),z),M)/255*l,this.g=yi(yi(yi(V[Z+1],V[H+1],N),yi(V[q+1],V[Y+1],N),z),yi(yi(V[K+1],V[ee+1],N),yi(V[he+1],V[le+1],N),z),M)/255*l,this.b=yi(yi(yi(V[Z+2],V[H+2],N),yi(V[q+2],V[Y+2],N),z),yi(yi(V[K+2],V[ee+2],N),yi(V[he+2],V[le+2],N),z),M)/255*l,this.a=l}else this.r=i,this.g=s,this.b=c,this.a=l}toArray(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*s/c,c]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:s,a:c}=this,l=Math.min(Math.max(e/c,0),1),d=Math.min(Math.max(i/c,0),1),y=Math.min(Math.max(s/c,0),1),w=Math.min(l,d,y),A=Math.max(l,d,y),_=(w+A)/2;if(w===A)return[0,0,100*_,c];const T=A-w,C=_>.5?T/(2-A-w):T/(A+w);let E=0;return A===l?E=(d-y)/T+(d<y?6:0):A===d?E=(y-l)/T+2:A===y&&(E=(l-d)/T+4),E*=60,[Math.min(Math.max(E,0),360),Math.min(Math.max(100*C,0),100),Math.min(Math.max(100*_,0),100),c]}toArray01(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,s/c,c]}toArray01Scaled(e){const{r:i,g:s,b:c,a:l}=this;return l===0?[0,0,0]:[i/l*e,s/l*e,c/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:c}=this;return[e,i,s,c]}toArray01Linear(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(i/c,2.2),Math.pow(s/c,2.2),c]}}function yi(a,e,i){return a*(1-i)+e*i}function mc(a,e,i){return a.map((s,c)=>yi(s,e[c],i))}function Qf(a){return a*a*a*a*a}Mn.black=new Mn(0,0,0,1),Mn.white=new Mn(1,1,1,1),Mn.transparent=new Mn(0,0,0,0),Mn.red=new Mn(1,0,0,1),Mn.blue=new Mn(0,0,1,1);var _c=Object.freeze({__proto__:null,array:mc,color:function(a,e,i){return new Mn(yi(a.r,e.r,i),yi(a.g,e.g,i),yi(a.b,e.b,i),yi(a.a,e.a,i))},easeIn:Qf,number:yi});function bn(a,...e){for(const i of e)for(const s in i)a[s]=i[s];return a}class Fa extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Us{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,c]of i)this.bindings[s]=c}concat(e){return new Us(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const bl={kind:"null"},si={kind:"number"},dn={kind:"string"},gn={kind:"boolean"},aa={kind:"color"},gc={kind:"object"},yn={kind:"value"},js={kind:"collator"},Tu={kind:"formatted"},Hr={kind:"resolvedImage"};function Lr(a,e){return{kind:"array",itemType:a,N:e}}function pr(a){if(a.kind==="array"){const e=pr(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}const Ka=[bl,si,dn,gn,aa,Tu,gc,Lr(yn),Hr];function Su(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Su(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(const i of Ka)if(!Su(i,e))return null}}return`Expected ${pr(a)} but found ${pr(e)} instead.`}function xh(a,e){return e.some(i=>i.kind===a.kind)}function wl(a,e){return e.some(i=>i==="null"?a===null:i==="array"?Array.isArray(a):i==="object"?a&&!Array.isArray(a)&&typeof a=="object":i===typeof a)}class Tl{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Sl{constructor(e,i,s,c,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=c,this.textColor=l}}class va{constructor(e){this.sections=e}static fromString(e){return new va([new Sl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof va?e:va.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const c=i.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(s)}return e}}class Co{constructor(e,i={}){if(this.id=Ia.from(e),this.options=Object.assign({},i),i.transform){const{a:s,b:c,c:l,d,e:y,f:w}=i.transform;this.options.transform=new DOMMatrix([s,c,l,d,y,w])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:s,d:c,e:l,f:d}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:s,d:c,e:l,f:d}})}static parse(e){let i,s,c,l;try{({name:i,iconsetId:s,params:c,transform:l}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:d,b:y,c:w,d:A,e:_,f:T}=l||{};return new Co({name:i,iconsetId:s},{params:c,transform:new DOMMatrix([d,y,w,A,_,T])})}scaleSelf(e){return this.options.transform.scaleSelf(e),this}}class Ra{constructor(e,i,s,c,l=!1){this.primaryId=Ia.from(e),this.primaryOptions=i,s&&(this.secondaryId=Ia.from(s)),this.secondaryOptions=c,this.available=l}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Co(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Co(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ra.build({name:e}):e}static build(e,i,s,c){return!e||typeof e=="object"&&!("name"in e)?null:new Ra(e,s,i,c)}}function bh(a,e,i,s){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[a,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[a,e,i,s]:[a,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Cs(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Mn||a instanceof Tl||a instanceof va||a instanceof Ra)return!0;if(Array.isArray(a)){for(const e of a)if(!Cs(e))return!1;return!0}if(typeof a=="object"){for(const e in a)if(!Cs(a[e]))return!1;return!0}return!1}function Fr(a){if(a===null)return bl;if(typeof a=="string")return dn;if(typeof a=="boolean")return gn;if(typeof a=="number")return si;if(a instanceof Mn)return aa;if(a instanceof Tl)return js;if(a instanceof va)return Tu;if(a instanceof Ra)return Hr;if(Array.isArray(a)){const e=a.length;let i;for(const s of a){const c=Fr(s);if(i){if(i===c)continue;i=yn;break}i=c}return Lr(i||yn,e)}return gc}function sa(a){const e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof Mn?a.toStringPremultipliedAlpha():a instanceof va||a instanceof Ra?a.toString():JSON.stringify(a)}class $o{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Cs(e[1]))return i.error("invalid value");const s=e[1];let c=Fr(s);const l=i.expectedType;return c.kind!=="array"||c.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(c=l),new $o(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof va?this.value.serialize():this.value}}class Ir{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ep={string:dn,number:si,boolean:gn,object:gc};class ys{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,c=1;const l=e[0];if(l==="array"){let y,w;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in ep)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=ep[A],c++}else y=yn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],c++}s=Lr(y,w)}else s=ep[l];const d=[];for(;c<e.length;c++){const y=i.parse(e[c],c,yn);if(!y)return null;d.push(y)}return new ys(s,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!Su(this.type,Fr(s)))return s;if(i===this.args.length-1)throw new Ir(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${pr(Fr(s))} but was expected to be of type ${pr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(s=>s.serialize()))}}class Eu{constructor(e){this.type=Tu,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const c=[];let l=!1;for(let d=1;d<=e.length-1;++d){const y=e[d];if(l&&typeof y=="object"&&!Array.isArray(y)){l=!1;let w=null;if(y["font-scale"]&&(w=i.parseObjectValue(y["font-scale"],d,"font-scale",si),!w))return null;let A=null;if(y["text-font"]&&(A=i.parseObjectValue(y["text-font"],d,"text-font",Lr(dn)),!A))return null;let _=null;if(y["text-color"]&&(_=i.parseObjectValue(y["text-color"],d,"text-color",aa),!_))return null;const T=c[c.length-1];T.scale=w,T.font=A,T.textColor=_}else{const w=i.parse(e[d],d,yn);if(!w)return null;const A=w.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,c.push({content:w,scale:null,font:null,textColor:null})}}return new Eu(c)}evaluate(e){return new va(this.sections.map(i=>{const s=i.content.evaluate(e);return Fr(s)===Hr?new Sl("",s,null,null,null):new Sl(sa(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class El{constructor(e,i,s,c){this._imageWarnHistory={},this.type=Hr,this.namePrimary=e,this.nameSecondary=i,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const c=[];function l(){if(s<e.length){const y=i.parse(e[s],s++,dn);return y?(c.push({image:y,options:{}}),!0):(i.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function d(){if(s<e.length){const w=e[s];if((y=w)===null||typeof y!="object"||Array.isArray(y))return!0;const A=w.params,_=w.iconset,T=i.concat(s);if(!A&&!_)return s++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return T.error('Image options "params" should be an object'),!1;const C={},E=T.concat(void 0,"params");for(const M in A){if(!M)return E.error("Image parameter name should be non-empty"),!1;const z=E.concat(void 0,M).parse(A[M],void 0,aa,void 0,{typeAnnotation:"coerce"});if(!z)return!1;C[M]=z}c[c.length-1].options.params=C}if(_){if(typeof _!="object"||_.constructor!==Object)return T.error('Image options "iconset" should be an object'),!1;if(!_.id)return T.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=_}return s++,!0}var y;return!0}for(let y=0;y<2;y++)if(!l()||!d())return;return new El(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const c in i)if(i[c])try{s[c]=i[c].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=Ra.build(i,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const l=c.getPrimary().id;if(c.available=e.availableImages.some(d=>Ia.isEqual(d,l)),c.available){const d=c.getSecondary()?c.getSecondary().id:null;d&&(c.available=e.availableImages.some(y=>Ia.isEqual(y,d)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const s={};if(i&&(s.iconset={id:i}),e){s.params={};for(const c in e)e[c]&&(s.params[c]=e[c].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Xo(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const F_={"to-boolean":gn,"to-color":aa,"to-number":si,"to-string":dn};class lo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],c=[];let l=bl;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=Lr(i.expectedType.itemType,d)}else{if(!(d>0&&Cs(e[1][0])))return null;l=Lr(Fr(e[1][0]),d)}for(let y=0;y<d;y++){const w=e[1][y];let A;if(Xo(w)==="array")A=i.parse(w,void 0,l.itemType);else{const _=Xo(w);if(_!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${_}.`);A=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!A)return null;c.push(A)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=F_[s];for(let d=1;d<e.length;d++){const y=i.parse(e[d],d,yn);if(!y)return null;c.push(y)}}return new lo(l,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const c of this.args){if(i=c.evaluate(e),s=null,i instanceof Mn)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:bh(i[0],i[1],i[2],i[3]),!s))return new Mn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ir(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Ir(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?va.fromString(sa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ra.build(sa(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):sa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Eu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new El(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const V_=["Unknown","Point","LineString","Polygon"];class Md{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?V_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(c*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Mn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Va{constructor(e,i,s,c,l){this.name=e,this.type=i,this._evaluate=s,this.args=c,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const i=Va.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],c=Va.definitions[s];if(!c)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(c)?c[0]:c.type,d=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=[];let w=null,A=-1;for(const[_,T]of d){if(Array.isArray(_)&&_.length!==e.length-1)continue;y.push(_),A++,w=new Ru(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const C=[];let E=!1;for(let M=1;M<e.length;M++){const z=e[M],N=Array.isArray(_)?_[M-1]:_.type,V=w.parse(z,1+C.length,N);if(!V){E=!0;break}C.push(V)}if(!E)if(Array.isArray(_)&&_.length!==C.length)w.error(`Expected ${_.length} arguments, but found ${C.length} instead.`);else{for(let M=0;M<C.length;M++){const z=Array.isArray(_)?_[M]:_.type,N=C[M];w.concat(M+1).checkSubtype(z,N.type)}if(w.errors.length===0)return new Va(s,l,T,C,A)}}if(y.length===1)i.errors.push(...w.errors);else{const _=(y.length?y:d.map(([C])=>C)).map(om).join(" | "),T=[];for(let C=1;C<e.length;C++){const E=i.parse(e[C],1+T.length);if(!E)return null;T.push(pr(E.type))}i.error(`Expected arguments of type ${_}, but found (${T.join(", ")}) instead.`)}return null}static register(e,i){Va.definitions=i;for(const s in i)e[s]=Va}}function om(a){return Array.isArray(a)?`(${a.map(pr).join(", ")})`:`(${pr(a.type)}...)`}class yc{constructor(e,i,s){this.type=js,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const c=s["case-sensitive"]===void 0?i.parse(!1,1,gn):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",gn);if(!c)return null;const l=s["diacritic-sensitive"]===void 0?i.parse(!1,1,gn):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",gn);if(!l)return null;let d=null;return s.locale&&(d=i.parseObjectValue(s.locale,1,"locale",dn),!d)?null:new yc(c,l,d)}evaluate(e){return new Tl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function lm(a,e,i=0,s=a.length-1,c=U_){for(;s>i;){if(s-i>600){const w=s-i+1,A=e-i+1,_=Math.log(w),T=.5*Math.exp(2*_/3),C=.5*Math.sqrt(_*T*(w-T)/w)*(A-w/2<0?-1:1);lm(a,e,Math.max(i,Math.floor(e-A*T/w+C)),Math.min(s,Math.floor(e+(w-A)*T/w+C)),c)}const l=a[e];let d=i,y=s;for(wh(a,i,e),c(a[s],l)>0&&wh(a,i,s);d<y;){for(wh(a,d,y),d++,y--;c(a[d],l)<0;)d++;for(;c(a[y],l)>0;)y--}c(a[i],l)===0?wh(a,i,y):(y++,wh(a,y,s)),y<=e&&(i=y+1),e<=y&&(s=y-1)}}function wh(a,e,i){const s=a[e];a[e]=a[i],a[i]=s}function U_(a,e){return a<e?-1:a>e?1:0}function j_(a){let e=0;for(let i,s,c=0,l=a.length,d=l-1;c<l;d=c++)i=a[c],s=a[d],e+=(s.x-i.x)*(i.y+s.y);return e}function Th(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function Sh(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function q_(a,e,i){const s=a[0]-e[0],c=a[1]-e[1],l=a[0]-i[0],d=a[1]-i[1];return s*d-l*c==0&&s*l<=0&&c*d<=0}function vc(a,e,i=!1){let s=!1;for(let y=0,w=e.length;y<w;y++){const A=e[y];for(let _=0,T=A.length,C=T-1;_<T;C=_++){const E=A[C],M=A[_];if(q_(a,E,M))return i;(l=E)[1]>(c=a)[1]!=(d=M)[1]>c[1]&&c[0]<(d[0]-l[0])*(c[1]-l[1])/(d[1]-l[1])+l[0]&&(s=!s)}}var c,l,d;return s}function Yo(a,e,i,s){const c=s[0]-i[0],l=s[1]-i[1],d=(a[0]-i[0])*l-c*(a[1]-i[1]),y=(e[0]-i[0])*l-c*(e[1]-i[1]);return d>0&&y<0||d<0&&y>0}function Al(a,e,i,s){return(c=[s[0]-i[0],s[1]-i[1]])[0]*(l=[e[0]-a[0],e[1]-a[1]])[1]-c[1]*l[0]!=0&&!(!Yo(a,e,i,s)||!Yo(i,s,a,e));var c,l}const Ml=8192;function Cd(a,e){const i=(180+a[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*Ml),Math.round(s*c*Ml)]}function cm(a,e){for(let i=0;i<e.length;i++)if(vc(a,e[i]))return!0;return!1}function um(a,e,i){for(const s of i)for(let c=0,l=s.length,d=l-1;c<l;d=c++)if(Al(a,e,s[d],s[c]))return!0;return!1}function tp(a,e){for(let i=0;i<a.length;++i)if(!vc(a[i],e))return!1;for(let i=0;i<a.length-1;++i)if(um(a[i],a[i+1],e))return!1;return!0}function hm(a,e){for(let i=0;i<e.length;i++)if(tp(a,e[i]))return!0;return!1}function Is(a,e,i){const s=[];for(let c=0;c<a.length;c++){const l=[];for(let d=0;d<a[c].length;d++){const y=Cd(a[c][d],i);Th(e,y),l.push(y)}s.push(l)}return s}function en(a,e,i){const s=[];for(let c=0;c<a.length;c++){const l=Is(a[c],e,i);s.push(l)}return s}function mi(a,e,i,s){if(a[0]<i[0]||a[0]>i[2]){const c=.5*s;let l=a[0]-i[0]>c?-s:i[0]-a[0]>c?s:0;l===0&&(l=a[0]-i[2]>c?-s:i[2]-a[0]>c?s:0),a[0]+=l}Th(e,a)}function Id(a,e,i,s){const c=Math.pow(2,s.z)*Ml,l=[s.x*Ml,s.y*Ml],d=[];if(!a)return d;for(const y of a)for(const w of y){const A=[w.x+l[0],w.y+l[1]];mi(A,e,i,c),d.push(A)}return d}function Ni(a,e,i,s){const c=Math.pow(2,s.z)*Ml,l=[s.x*Ml,s.y*Ml],d=[];if(!a)return d;for(const w of a){const A=[];for(const _ of w){const T=[_.x+l[0],_.y+l[1]];Th(e,T),A.push(T)}d.push(A)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const w of d)for(const A of w)mi(A,e,i,c)}var y;return d}class Io{constructor(e,i){this.type=gn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Cs(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const l=s.features[c].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Io(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Io(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Io(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const c=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const y=Is(s.coordinates,l,d),w=Id(i.geometry(),c,l,d);if(!Sh(c,l))return!1;for(const A of w)if(!vc(A,y))return!1}if(s.type==="MultiPolygon"){const y=en(s.coordinates,l,d),w=Id(i.geometry(),c,l,d);if(!Sh(c,l))return!1;for(const A of w)if(!cm(A,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const c=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const y=Is(s.coordinates,l,d),w=Ni(i.geometry(),c,l,d);if(!Sh(c,l))return!1;for(const A of w)if(!tp(A,y))return!1}if(s.type==="MultiPolygon"){const y=en(s.coordinates,l,d),w=Ni(i.geometry(),c,l,d);if(!Sh(c,l))return!1;for(const A of w)if(!hm(A,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ro={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ii=1/298.257223563,ip=Ii*(2-Ii),Do=Math.PI/180;class xc{static fromTile(e,i,s){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),l=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/Do;return new xc(l,s)}static get units(){return Ro}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Ro[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Ro).join(", ")}`);const s=6378.137*Do*(i?Ro[i]:1),c=Math.cos(e*Do),l=1/(1-ip*(1-c*c)),d=Math.sqrt(l);this.kx=s*d*c,this.ky=s*d*l*(1-ip)}distance(e,i){const s=mr(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+c*c)}bearing(e,i){const s=mr(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/Do}destination(e,i,s){const c=s*Do;return this.offset(e,Math.sin(c)*i,Math.cos(c)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const c=e[s];for(let l=0,d=c.length,y=d-1;l<d;y=l++)i+=mr(c[l][0]-c[y][0])*(c[l][1]+c[y][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let c=0;c<e.length-1;c++){const l=e[c],d=e[c+1],y=this.distance(l,d);if(s+=y,s>i)return Cl(l,d,(i-(s-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[c,l]=i,d=mr(s[0]-c)*this.kx,y=(s[1]-l)*this.ky;if(d!==0||y!==0){const w=(mr(e[0]-c)*this.kx*d+(e[1]-l)*this.ky*y)/(d*d+y*y);w>1?(c=s[0],l=s[1]):w>0&&(c+=d/this.kx*w,l+=y/this.ky*w)}return d=mr(e[0]-c)*this.kx,y=(e[1]-l)*this.ky,Math.sqrt(d*d+y*y)}pointOnLine(e,i){let s=1/0,c=e[0][0],l=e[0][1],d=0,y=0;for(let w=0;w<e.length-1;w++){let A=e[w][0],_=e[w][1],T=mr(e[w+1][0]-A)*this.kx,C=(e[w+1][1]-_)*this.ky,E=0;T===0&&C===0||(E=(mr(i[0]-A)*this.kx*T+(i[1]-_)*this.ky*C)/(T*T+C*C),E>1?(A=e[w+1][0],_=e[w+1][1]):E>0&&(A+=T/this.kx*E,_+=C/this.ky*E)),T=mr(i[0]-A)*this.kx,C=(i[1]-_)*this.ky;const M=T*T+C*C;M<s&&(s=M,c=A,l=_,d=w,y=E)}return{point:[c,l],index:d,t:Math.max(0,Math.min(1,y))}}lineSlice(e,i,s){let c=this.pointOnLine(s,e),l=this.pointOnLine(s,i);if(c.index>l.index||c.index===l.index&&c.t>l.t){const A=c;c=l,l=A}const d=[c.point],y=c.index+1,w=l.index;!Rd(s[y],d[0])&&y<=w&&d.push(s[y]);for(let A=y+1;A<=w;A++)d.push(s[A]);return Rd(s[w],l.point)||d.push(l.point),d}lineSliceAlong(e,i,s){let c=0;const l=[];for(let d=0;d<s.length-1;d++){const y=s[d],w=s[d+1],A=this.distance(y,w);if(c+=A,c>e&&l.length===0&&l.push(Cl(y,w,(e-(c-A))/A)),c>=i)return l.push(Cl(y,w,(i-(c-A))/A)),l;c>e&&l.push(w)}return l}bufferPoint(e,i){const s=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-s,e[0]+c,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-s,e[2]+c,e[3]+s]}insideBBox(e,i){return mr(e[0]-i[0])>=0&&mr(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Rd(a,e){return a[0]===e[0]&&a[1]===e[1]}function Cl(a,e,i){const s=mr(e[0]-a[0]);return[a[0]+s*i,a[1]+(e[1]-a[1])*i]}function mr(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class Au{constructor(e=[],i=(s,c)=>s<c?-1:s>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,c=i[e];for(;e>0;){const l=e-1>>1,d=i[l];if(s(c,d)>=0)break;i[e]=d,e=l}i[e]=c}_down(e){const{data:i,compare:s}=this,c=this.length>>1,l=i[e];for(;e<c;){let d=1+(e<<1);const y=d+1;if(y<this.length&&s(i[y],i[d])<0&&(d=y),s(i[d],l)>=0)break;i[e]=i[d],e=d}i[e]=l}}var Bt=8192;function Eh(a,e){return e.dist-a.dist}const Wo=100,xa=50;function dm(a){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==a[i])return!1;return!0}function Dd(a){return a[1]-a[0]+1}function Ko(a,e){const i=a[1]>=a[0]&&a[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function ba(a,e){if(a[0]>a[1])return[null,null];const i=Dd(a);if(e){if(i===2)return[a,null];const s=Math.floor(i/2);return[[a[0],a[0]+s],[a[0]+s,a[1]]]}{if(i===1)return[a,null];const s=Math.floor(i/2)-1;return[[a[0],a[0]+s],[a[0]+s+1,a[1]]]}}function qs(a,e){const i=[1/0,1/0,-1/0,-1/0];if(!Ko(e,a.length))return i;for(let s=e[0];s<=e[1];++s)Th(i,a[s]);return i}function bc(a){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<a.length;++i)for(let s=0;s<a[i].length;++s)Th(e,a[i][s]);return e}function wc(a,e,i){if(dm(a)||dm(e))return NaN;let s=0,c=0;return a[2]<e[0]&&(s=e[0]-a[2]),a[0]>e[2]&&(s=a[0]-e[2]),a[1]>e[3]&&(c=a[1]-e[3]),a[3]<e[1]&&(c=e[1]-a[3]),i.distance([0,0],[s,c])}function fm(a){return 360*a-180}function pm(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ah(a,e){const i=Math.pow(2,e.z),s=(a.y/Bt+e.y)/i;return[fm((a.x/Bt+e.x)/i),pm(s)]}function mm(a,e){const i=[];for(let s=0;s<a.length;++s)i.push(Ah(a[s],e));return i}function Tc(a,e,i){const s=i.pointOnLine(e,a).point;return i.distance(a,s)}function zd(a,e,i,s,c){const l=i.slice(s[0],s[1]+1);let d=1/0;for(let y=e[0];y<=e[1];++y)if((d=Math.min(d,Tc(a[y],l,c)))===0)return 0;return d}function Il(a,e,i,s,c){const l=Math.min(c.pointToSegmentDistance(a,i,s),c.pointToSegmentDistance(e,i,s)),d=Math.min(c.pointToSegmentDistance(i,a,e),c.pointToSegmentDistance(s,a,e));return Math.min(l,d)}function np(a,e,i,s,c){if(!Ko(e,a.length)||!Ko(s,i.length))return NaN;let l=1/0;for(let d=e[0];d<e[1];++d)for(let y=s[0];y<s[1];++y){if(Al(a[d],a[d+1],i[y],i[y+1]))return 0;l=Math.min(l,Il(a[d],a[d+1],i[y],i[y+1],c))}return l}function Rl(a,e,i,s,c){if(!Ko(e,a.length)||!Ko(s,i.length))return NaN;let l=1/0;for(let d=e[0];d<=e[1];++d)for(let y=s[0];y<=s[1];++y)if((l=Math.min(l,c.distance(a[d],i[y])))===0)return l;return l}function Sc(a,e,i){if(vc(a,e,!0))return 0;let s=1/0;for(const c of e){const l=c.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[l-1]&&(s=Math.min(s,i.pointToSegmentDistance(a,c[l-1],c[0])))===0||(s=Math.min(s,Tc(a,c,i)))===0)return s}return s}function Mu(a,e,i,s){if(!Ko(e,a.length))return NaN;for(let l=e[0];l<=e[1];++l)if(vc(a[l],i,!0))return 0;let c=1/0;for(let l=e[0];l<e[1];++l)for(const d of i)for(let y=0,w=d.length,A=w-1;y<w;A=y++){if(Al(a[l],a[l+1],d[A],d[y]))return 0;c=Math.min(c,Il(a[l],a[l+1],d[A],d[y],s))}return c}function Cu(a,e){for(const i of a)for(let s=0;s<=i.length-1;++s)if(vc(i[s],e,!0))return!0;return!1}function rp(a,e,i,s=1/0){const c=bc(a),l=bc(e);if(s!==1/0&&wc(c,l,i)>=s)return s;if(Sh(c,l)){if(Cu(a,e))return 0}else if(Cu(e,a))return 0;let d=s;for(const y of a)for(let w=0,A=y.length,_=A-1;w<A;_=w++)for(const T of e)for(let C=0,E=T.length,M=E-1;C<E;M=C++){if(Al(y[_],y[w],T[M],T[C]))return 0;d=Math.min(d,Il(y[_],y[w],T[M],T[C],i))}return d}function co(a,e,i,s,c,l,d){if(l===null||d===null)return;const y=wc(qs(s,l),qs(c,d),i);y<e&&a.push({dist:y,range1:l,range2:d})}function Gs(a,e,i,s,c=1/0){let l=Math.min(s.distance(a[0],i[0][0]),c);if(l===0)return l;const d=new Au([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Eh),y=e?xa:Wo,w=bc(i);for(;d.length;){const A=d.pop();if(A.dist>=l)continue;const _=A.range1;if(Dd(_)<=y){if(!Ko(_,a.length))return NaN;if(e){const T=Mu(a,_,i,s);if((l=Math.min(l,T))===0)return l}else for(let T=_[0];T<=_[1];++T){const C=Sc(a[T],i,s);if((l=Math.min(l,C))===0)return l}}else{const T=ba(_,e);if(T[0]!==null){const C=wc(qs(a,T[0]),w,s);C<l&&d.push({dist:C,range1:T[0],range2:[0,0]})}if(T[1]!==null){const C=wc(qs(a,T[1]),w,s);C<l&&d.push({dist:C,range1:T[1],range2:[0,0]})}}}return l}function Ld(a,e,i,s,c,l=1/0){let d=Math.min(l,c.distance(a[0],i[0]));if(d===0)return d;const y=new Au([{dist:0,range1:[0,a.length-1],range2:[0,i.length-1]}],Eh),w=e?xa:Wo,A=s?xa:Wo;for(;y.length;){const _=y.pop();if(_.dist>=d)continue;const T=_.range1,C=_.range2;if(Dd(T)<=w&&Dd(C)<=A){if(!Ko(T,a.length)||!Ko(C,i.length))return NaN;if(e&&s?d=Math.min(d,np(a,T,i,C,c)):e||s?e&&!s?d=Math.min(d,zd(i,C,a,T,c)):!e&&s&&(d=Math.min(d,zd(a,T,i,C,c))):d=Math.min(d,Rl(a,T,i,C,c)),d===0)return d}else{const E=ba(T,e),M=ba(C,s);co(y,d,c,a,i,E[0],M[0]),co(y,d,c,a,i,E[0],M[1]),co(y,d,c,a,i,E[1],M[0]),co(y,d,c,a,i,E[1],M[1])}}return d}function Mh(a,e,i,s,c=1/0){let l=c;const d=qs(a,[0,a.length-1]);for(const y of i)if(!(l!==1/0&&wc(d,qs(y,[0,y.length-1]),s)>=l)&&(l=Math.min(l,Ld(a,e,y,!0,s,l)),l===0))return l;return l}function Ch(a,e,i,s,c=1/0){let l=c;const d=qs(a,[0,a.length-1]);for(const y of i){if(l!==1/0&&wc(d,bc(y),s)>=l)continue;const w=Gs(a,e,y,s,l);if(isNaN(w))return w;if((l=Math.min(l,w))===0)return l}return l}function Od(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class Dl{constructor(e,i){this.type=si,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Cs(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let c=0;c<s.features.length;++c)if(Od(s.features[c].geometry.type))return new Dl(s,s.features[c].geometry)}else if(s.type==="Feature"){if(Od(s.geometry.type))return new Dl(s,s.geometry)}else if(Od(s.type))return new Dl(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return function(c,l,d){const y=[];for(const A of c)for(const _ of A)y.push(Ah(_,l));const w=new xc(y[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?Ld(y,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",w):d.type==="MultiLineString"?Mh(y,!1,d.coordinates,w):d.type==="Polygon"||d.type==="MultiPolygon"?Ch(y,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,w):null}(i,s,this.geometries);if(e.geometryType()==="LineString")return function(c,l,d){const y=[];for(const A of c){const _=[];for(const T of A)_.push(Ah(T,l));y.push(_)}const w=new xc(y[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Mh(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",y,w);if(d.type==="MultiLineString"){let A=1/0;for(let _=0;_<d.coordinates.length;_++){const T=Mh(d.coordinates[_],!0,y,w,A);if(isNaN(T))return T;if((A=Math.min(A,T))===0)return A}return A}if(d.type==="Polygon"||d.type==="MultiPolygon"){let A=1/0;for(let _=0;_<y.length;_++){const T=Ch(y[_],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,w,A);if(isNaN(T))return T;if((A=Math.min(A,T))===0)return A}return A}return null}(i,s,this.geometries);if(e.geometryType()==="Polygon")return function(c,l,d){const y=[];for(const A of function(_,T){const C=_.length;if(C<=1)return[_];const E=[];let M,z;for(let N=0;N<C;N++){const V=j_(_[N]);V!==0&&(_[N].area=Math.abs(V),z===void 0&&(z=V<0),z===V<0?(M&&E.push(M),M=[_[N]]):M.push(_[N]))}return M&&E.push(M),E}(c)){const _=[];for(let T=0;T<A.length;++T)_.push(mm(A[T],l));y.push(_)}const w=new xc(y[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Ch(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",y,w);if(d.type==="MultiLineString"){let A=1/0;for(let _=0;_<d.coordinates.length;_++){const T=Ch(d.coordinates[_],!0,y,w,A);if(isNaN(T))return T;if((A=Math.min(A,T))===0)return A}return A}return d.type==="Polygon"||d.type==="MultiPolygon"?function(A,_,T){let C=1/0;for(const E of A)for(const M of _){const z=rp(E,M,T,C);if(isNaN(z))return z;if((C=Math.min(C,z))===0)return C}return C}(d.type==="Polygon"?[d.coordinates]:d.coordinates,y,w):null}(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ih(a,e){switch(a){case"string":return sa(e);case"number":return+e;case"boolean":return!!e;case"color":return Mn.parse(e);case"formatted":return va.fromString(sa(e));case"resolvedImage":return Ra.build(sa(e))}return e}function Pd(a,e,i,s){return s!==void 0&&(a=s*Math.round(a/s)),e!==void 0&&a<e&&(a=e),i!==void 0&&a>i&&(a=i),a}class Jo{constructor(e,i,s){this.type=e,this.key=i,this.scope=s}static parse(e,i){let s=i.expectedType;if(s==null&&(s=yn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const c=i.parse(e[1],1);if(!(c instanceof $o))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=i.parse(e[2],2);return l instanceof $o?new Jo(s,sa(c.value),sa(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Jo(s,sa(c.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(i);if(!s)return null;const{type:c,value:l,values:d,minValue:y,maxValue:w,stepValue:A}=s,_=s.default.evaluate(e);let T=_;if(l){const C=e.scope;e.scope=(C||"").split("").slice(1).join(""),T=l.evaluate(e),e.scope=C}return c&&(T=Ih(c,T)),T===void 0||y===void 0&&w===void 0&&A===void 0||(typeof T=="number"?T=Pd(T,y,w,A):Array.isArray(T)&&(T=T.map(C=>typeof C=="number"?Pd(C,y,w,A):C))),l!==void 0&&T!==void 0&&d&&!d.includes(T)&&(T=_,c&&(T=Ih(c,T))),(c&&c!==this.type||T!==void 0&&Fr(T)!==this.type)&&(T=Ih(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Ua(a){if(a instanceof Va&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Io||a instanceof Dl)return!1;let e=!0;return a.eachChild(i=>{e&&!Ua(i)&&(e=!1)}),e}function Iu(a){if(a instanceof Va&&a.name==="feature-state")return!1;let e=!0;return a.eachChild(i=>{e&&!Iu(i)&&(e=!1)}),e}function ja(a){if(a instanceof Jo)return new Set([a.key]);let e=new Set;return a.eachChild(i=>{e=new Set([...e,...ja(i)])}),e}function oa(a,e){if(a instanceof Va&&e.indexOf(a.name)>=0)return!1;let i=!0;return a.eachChild(s=>{i&&!oa(s,e)&&(i=!1)}),i}class Hs{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new Hs(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class zl{constructor(e,i=[],s,c=new Us,l=[],d,y){this.registry=e,this.path=i,this.key=i.map(w=>typeof w=="string"?`['${w}']`:`[${w}]`).join(""),this.scope=c,this.errors=l,this.expectedType=s,this._scope=d,this.options=y}parse(e,i,s,c,l={}){return i||s?this.concat(i,null,s,c)._parse(e,l):this._parse(e,l)}parseObjectValue(e,i,s,c,l,d={}){return this.concat(i,s,c,l)._parse(e,d)}_parse(e,i){function s(c,l,d){return d==="assert"?new ys(l,[c]):d==="coerce"?new lo(l,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let l=c.parse(e,this);if(!l)return null;if(this.expectedType){const d=this.expectedType,y=l.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||y.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(d,y))return null}else l=s(l,d,i.typeAnnotation||"coerce");else l=s(l,d,i.typeAnnotation||"assert")}if(!(l instanceof $o)&&l.type.kind!=="resolvedImage"&&Ec(l)){const d=new Md(this._scope,this.options);try{l=new $o(l.type,l.evaluate(d))}catch(y){return this.error(y.message),null}}return l}return lo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,c){let l=typeof e=="number"?this.path.concat(e):this.path;l=typeof i=="string"?l.concat(i):l;const d=c?this.scope.concat(c):this.scope;return new zl(this.registry,l,s||null,d,this.errors,this._scope,this.options)}error(e,...i){const s=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Fa(s,e))}checkSubtype(e,i){const s=Su(e,i);return s&&this.error(s),s}}var Ru=zl;function Ec(a){if(a instanceof Hs)return Ec(a.boundExpression);if(a instanceof Va&&a.name==="error"||a instanceof yc||a instanceof Io||a instanceof Dl||a instanceof Jo)return!1;const e=a instanceof lo||a instanceof ys;let i=!0;return a.eachChild(s=>{i=e?i&&Ec(s):i&&s instanceof $o}),!!i&&Ua(a)&&oa(a,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ac(a,e){const i=a.length-1;let s,c,l=0,d=i,y=0;for(;l<=d;)if(y=Math.floor((l+d)/2),s=a[y],c=a[y+1],s<=e){if(y===i||e<c)return y;l=y+1}else{if(!(s>e))throw new Ir("Input is not a number.");d=y-1}return 0}class Ja{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,l]of s)this.labels.push(c),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,si);if(!s)return null;const c=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let d=1;d<e.length;d+=2){const y=d===1?-1/0:e[d],w=e[d+1],A=d,_=d+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(c.length&&c[c.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const T=i.parse(w,_,l);if(!T)return null;l=l||T.type,c.push([y,T])}return new Ja(l,s,c)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return s[0].evaluate(e);const l=i.length;return c>=i[l-1]?s[l-1].evaluate(e):s[Ac(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const cn=.95047,Rh=1.08883,Mc=4/29,Du=6/29,Qa=3*Du*Du,ap=Du*Du*Du,jn=Math.PI/180,_m=180/Math.PI;function zu(a){return a>ap?Math.pow(a,1/3):a/Qa+Mc}function Qo(a){return a>Du?a*a*a:Qa*(a-Mc)}function Dh(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function zh(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Cc(a){const e=zh(a.r),i=zh(a.g),s=zh(a.b),c=zu((.4124564*e+.3575761*i+.1804375*s)/cn),l=zu((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*l-16,a:500*(c-l),b:200*(l-zu((.0193339*e+.119192*i+.9503041*s)/Rh)),alpha:a.a}}function Ic(a){let e=(a.l+16)/116,i=isNaN(a.a)?e:e+a.a/500,s=isNaN(a.b)?e:e-a.b/200;return e=1*Qo(e),i=cn*Qo(i),s=Rh*Qo(s),new Mn(Dh(3.2404542*i-1.5371385*e-.4985314*s),Dh(-.969266*i+1.8760108*e+.041556*s),Dh(.0556434*i-.2040259*e+1.0572252*s),a.alpha)}function kd(a,e,i){const s=e-a;return a+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ll={forward:Cc,reverse:Ic,interpolate:function(a,e,i){return{l:yi(a.l,e.l,i),a:yi(a.a,e.a,i),b:yi(a.b,e.b,i),alpha:yi(a.alpha,e.alpha,i)}}},qa={forward:function(a){const{l:e,a:i,b:s}=Cc(a),c=Math.atan2(s,i)*_m;return{h:c<0?c+360:c,c:Math.sqrt(i*i+s*s),l:e,alpha:a.a}},reverse:function(a){const e=a.h*jn,i=a.c;return Ic({l:a.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:a.alpha})},interpolate:function(a,e,i){return{h:kd(a.h,e.h,i),c:yi(a.c,e.c,i),l:yi(a.l,e.l,i),alpha:yi(a.alpha,e.alpha,i)}}};var Rs=Object.freeze({__proto__:null,hcl:qa,lab:Ll});class da{constructor(e,i,s,c,l){this.type=e,this.operator=i,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[d,y]of l)this.labels.push(d),this.outputs.push(y)}static interpolationFactor(e,i,s,c){let l=0;if(e.name==="exponential")l=uo(i,e.base,s,c);else if(e.name==="linear")l=uo(i,1,s,c);else if(e.name==="cubic-bezier"){const d=e.controlPoints;l=new Ts(d[0],d[1],d[2],d[3]).solve(uo(i,1,s,c))}return l}static parse(e,i){let[s,c,l,...d]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const A=c[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:A}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const A=c.slice(1);if(A.length!==4||A.some(_=>typeof _!="number"||_<0||_>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,si),!l)return null;const y=[];let w=null;s==="interpolate-hcl"||s==="interpolate-lab"?w=aa:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let A=0;A<d.length;A+=2){const _=d[A],T=d[A+1],C=A+3,E=A+4;if(typeof _!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(y.length&&y[y.length-1][0]>=_)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const M=i.parse(T,E,w);if(!M)return null;w=w||M.type,y.push([_,M])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new da(w,s,c,l,y):i.error(`Type ${pr(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return s[0].evaluate(e);const l=i.length;if(c>=i[l-1])return s[l-1].evaluate(e);const d=Ac(i,c),y=da.interpolationFactor(this.interpolation,c,i[d],i[d+1]),w=s[d].evaluate(e),A=s[d+1].evaluate(e);return this.operator==="interpolate"?_c[this.type.kind.toLowerCase()](w,A,y):this.operator==="interpolate-hcl"?qa.reverse(qa.interpolate(qa.forward(w),qa.forward(A),y)):Ll.reverse(Ll.interpolate(Ll.forward(w),Ll.forward(A),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function uo(a,e,i,s){const c=s-i,l=a-i;return c===0?0:e===1?l/c:(Math.pow(e,l)-1)/(Math.pow(e,c)-1)}class Zs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const c=i.expectedType;c&&c.kind!=="value"&&(s=c);const l=[];for(const y of e.slice(1)){const w=i.parse(y,1+l.length,s,void 0,{typeAnnotation:"omit"});if(!w)return null;s=s||w.type,l.push(w)}const d=c&&l.some(y=>Su(c,y.type));return new Zs(d?yn:s,l)}evaluate(e){let i,s=null,c=0;for(const l of this.args){if(c++,s=l.evaluate(e),s&&s instanceof Ra&&!s.available&&(i||(i=s),s=null,c===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class zo{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let l=1;l<e.length-1;l+=2){const d=e[l];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,l);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const y=i.parse(e[l+1],l+1);if(!y)return null;s.push([d,y])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return c?new zo(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class Bd{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,si),c=i.parse(e[2],2,Lr(i.expectedType||yn));return s&&c?new Bd(c.type.itemType,s,c):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Ir(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new Ir(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new Ir(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Lh{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,si),c=i.parse(e[2],2,Lr(i.expectedType||yn));return s&&c?new Lh(c.type.itemType,s,c):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Ir(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new Ir(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const c=Math.floor(i),l=Math.ceil(i),d=s[c],y=s[l];if(typeof d!="number"||typeof y!="number")throw new Ir(`Cannot interpolate between non-number values at index ${i}.`);const w=i-c;return d*(1-w)+y*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Oh{constructor(e,i){this.type=gn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,yn),c=i.parse(e[2],2,yn);return s&&c?xh(s.type,[gn,dn,si,bl,yn])?new Oh(s,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pr(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!wl(i,["boolean","string","number","null"]))throw new Ir(`Expected first argument to be of type boolean, string, number or null, but found ${pr(Fr(i))} instead.`);if(!wl(s,["string","array"]))throw new Ir(`Expected second argument to be of type array or string, but found ${pr(Fr(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class wa{constructor(e,i,s){this.type=si,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,yn),c=i.parse(e[2],2,yn);if(!s||!c)return null;if(!xh(s.type,[gn,dn,si,bl,yn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pr(s.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,si);return l?new wa(s,c,l):null}return new wa(s,c)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!wl(i,["boolean","string","number","null"]))throw new Ir(`Expected first argument to be of type boolean, string, number or null, but found ${pr(Fr(i))} instead.`);if(!wl(s,["string","array"]))throw new Ir(`Expected second argument to be of type array or string, but found ${pr(Fr(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(i,c)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Or{constructor(e,i,s,c,l,d){this.inputType=e,this.type=i,this.input=s,this.cases=c,this.outputs=l,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const l={},d=[];for(let A=2;A<e.length-1;A+=2){let _=e[A];const T=e[A+1];Array.isArray(_)||(_=[_]);const C=i.concat(A);if(_.length===0)return C.error("Expected at least one branch label.");for(const M of _){if(typeof M!="number"&&typeof M!="string")return C.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return C.error("Numeric branch labels must be integer values.");if(s){if(C.checkSubtype(s,Fr(M)))return null}else s=Fr(M);if(l[String(M)]!==void 0)return C.error("Branch labels must be unique.");l[String(M)]=d.length}const E=i.parse(T,A,c);if(!E)return null;c=c||E.type,d.push(E)}const y=i.parse(e[1],1,yn);if(!y)return null;const w=i.parse(e[e.length-1],e.length-1,c);return w?y.type.kind!=="value"&&i.concat(1).checkSubtype(s,y.type)?null:new Or(s,c,y,l,d,w):null}evaluate(e){const i=this.input.evaluate(e);return(Fr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],c={};for(const d of i){const y=c[this.cases[d]];y===void 0?(c[this.cases[d]]=s.length,s.push([this.cases[d],[d]])):s[y][1].push(d)}const l=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,y]of s)e.push(y.length===1?l(y[0]):y.map(l)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class tr{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const c=[];for(let d=1;d<e.length-1;d+=2){const y=i.parse(e[d],d,gn);if(!y)return null;const w=i.parse(e[d+1],d+1,s);if(!w)return null;c.push([y,w]),s=s||w.type}const l=i.parse(e[e.length-1],e.length-1,s);return l?new tr(s,c,l):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Lo{constructor(e,i,s,c){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,yn),c=i.parse(e[2],2,si);if(!s||!c)return null;if(!xh(s.type,[Lr(yn),dn,yn]))return i.error(`Expected first argument to be of type array or string, but found ${pr(s.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,si);return l?new Lo(s.type,s,c,l):null}return new Lo(s.type,s,c)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!wl(i,["string","array"]))throw new Ir(`Expected first argument to be of type array or string, but found ${pr(Fr(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(s,c)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ho(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Nd(a,e,i,s){return s.compare(e,i)===0}function $s(a,e,i){const s=a!=="=="&&a!=="!=";return class LE{constructor(l,d,y){this.type=gn,this.lhs=l,this.rhs=d,this.collator=y,this.hasUntypedArgument=l.type.kind==="value"||d.type.kind==="value"}static parse(l,d){if(l.length!==3&&l.length!==4)return d.error("Expected two or three arguments.");const y=l[0];let w=d.parse(l[1],1,yn);if(!w)return null;if(!ho(y,w.type))return d.concat(1).error(`"${y}" comparisons are not supported for type '${pr(w.type)}'.`);let A=d.parse(l[2],2,yn);if(!A)return null;if(!ho(y,A.type))return d.concat(2).error(`"${y}" comparisons are not supported for type '${pr(A.type)}'.`);if(w.type.kind!==A.type.kind&&w.type.kind!=="value"&&A.type.kind!=="value")return d.error(`Cannot compare types '${pr(w.type)}' and '${pr(A.type)}'.`);s&&(w.type.kind==="value"&&A.type.kind!=="value"?w=new ys(A.type,[w]):w.type.kind!=="value"&&A.type.kind==="value"&&(A=new ys(w.type,[A])));let _=null;if(l.length===4){if(w.type.kind!=="string"&&A.type.kind!=="string"&&w.type.kind!=="value"&&A.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(_=d.parse(l[3],3,js),!_)return null}return new LE(w,A,_)}evaluate(l){const d=this.lhs.evaluate(l),y=this.rhs.evaluate(l);if(s&&this.hasUntypedArgument){const w=Fr(d),A=Fr(y);if(w.kind!==A.kind||w.kind!=="string"&&w.kind!=="number")throw new Ir(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${w.kind}, ${A.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const w=Fr(d),A=Fr(y);if(w.kind!=="string"||A.kind!=="string")return e(l,d,y)}return this.collator?i(l,d,y,this.collator.evaluate(l)):e(l,d,y)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[a];return this.eachChild(d=>{l.push(d.serialize())}),l}}}const gm=$s("==",function(a,e,i){return e===i},Nd),ym=$s("!=",function(a,e,i){return e!==i},function(a,e,i,s){return!Nd(0,e,i,s)}),Ph=$s("<",function(a,e,i){return e<i},function(a,e,i,s){return s.compare(e,i)<0}),kh=$s(">",function(a,e,i){return e>i},function(a,e,i,s){return s.compare(e,i)>0}),vm=$s("<=",function(a,e,i){return e<=i},function(a,e,i,s){return s.compare(e,i)<=0}),Bh=$s(">=",function(a,e,i){return e>=i},function(a,e,i,s){return s.compare(e,i)>=0});class Rc{constructor(e,i,s,c,l,d){this.type=dn,this.number=e,this.locale=i,this.currency=s,this.unit=c,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,si);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let l=null;if(c.locale&&(l=i.parseObjectValue(c.locale,2,"locale",dn),!l))return null;let d=null;if(c.currency&&(d=i.parseObjectValue(c.currency,2,"currency",dn),!d))return null;let y=null;if(c.unit&&(y=i.parseObjectValue(c.unit,2,"unit",dn),!y))return null;let w=null;if(c["min-fraction-digits"]&&(w=i.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",si),!w))return null;let A=null;return c["max-fraction-digits"]&&(A=i.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",si),!A)?null:new Rc(s,l,d,y,w,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class el{constructor(e){this.type=si,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${pr(s.type)} instead.`):new el(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ir(`Expected value to be of type string or array, but found ${pr(Fr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function fo(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ds={"==":gm,"!=":ym,">":kh,"<":Ph,">=":Bh,"<=":vm,array:ys,at:Bd,"at-interpolated":Lh,boolean:ys,case:tr,coalesce:Zs,collator:yc,format:Eu,image:El,in:Oh,"index-of":wa,interpolate:da,"interpolate-hcl":da,"interpolate-lab":da,length:el,let:zo,literal:$o,match:Or,number:ys,"number-format":Rc,object:ys,slice:Lo,step:Ja,string:ys,"to-boolean":lo,"to-color":lo,"to-number":lo,"to-string":lo,var:Hs,within:Io,distance:Dl,config:Jo};function Oo(a,[e,i,s,c]){e=e.evaluate(a),i=i.evaluate(a),s=s.evaluate(a);const l=c?c.evaluate(a):1,d=bh(e,i,s,l);if(d)throw new Ir(d);return new Mn(e/255*l,i/255*l,s/255*l,l)}function Fd(a,[e,i,s,c]){e=e.evaluate(a),i=i.evaluate(a),s=s.evaluate(a);const l=c?c.evaluate(a):1,d=function(A,_,T,C){return typeof A=="number"&&A>=0&&A<=360?typeof _=="number"&&_>=0&&_<=100&&typeof T=="number"&&T>=0&&T<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[A,_,T,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[A,_,T,C]:[A,_,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[A,_,T,C]:[A,_,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,s,l);if(d)throw new Ir(d);const y=`hsla(${e}, ${i}%, ${s}%, ${l})`,w=Mn.parse(y);if(!w)throw new Ir(`Failed to parse HSLA color: ${y}`);return w}function Nh(a,e){return a in e}function Ol(a,e){const i=e[a];return i===void 0?null:i}function es(a){return{type:a}}function tl(a){return{result:"success",value:a}}function Pr(a){return{result:"error",value:a}}function Lu(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function Dc(a){return a["property-type"]==="data-driven"}function Vd(a){return Lu(a.expression,"measure-light")}function xm(a){return Lu(a.expression,"zoom")}function sp(a){return!!a.expression&&a.expression.interpolated}function Zr(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Ud(a){return a}function Ou(a,e){const i=e.type==="color",s=a.stops&&typeof a.stops[0][0]=="object",c=s||!(s||a.property!==void 0),l=a.type||(sp(e)?"exponential":"interval");if(i&&((a=bn({},a)).stops&&(a.stops=a.stops.map(A=>[A[0],Mn.parse(A[1])])),a.default=Mn.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Rs[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let d,y,w;if(l==="exponential")d=Pl;else if(l==="interval")d=zc;else if(l==="categorical"){d=op,y=Object.create(null);for(const A of a.stops)y[A[0]]=A[1];w=typeof a.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);d=jd}if(s){const A={},_=[];for(let E=0;E<a.stops.length;E++){const M=a.stops[E],z=M[0].zoom;A[z]===void 0&&(A[z]={zoom:z,type:a.type,property:a.property,default:a.default,stops:[]},_.push(z)),A[z].stops.push([M[0].value,M[1]])}const T=[];for(const E of _)T.push([A[E].zoom,Ou(A[E],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:da.interpolationFactor.bind(void 0,C),zoomStops:T.map(E=>E[0]),evaluate:({zoom:E},M)=>Pl({stops:T,base:a.base},e,E).evaluate(E,M)}}if(c){const A=l==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:da.interpolationFactor.bind(void 0,A),zoomStops:a.stops.map(_=>_[0]),evaluate:({zoom:_})=>d(a,e,_,y,w)}}return{kind:"source",evaluate(A,_){const T=_&&_.properties?_.properties[a.property]:void 0;return T===void 0?il(a.default,e.default):d(a,e,T,y,w)}}}function il(a,e,i){return a!==void 0?a:e!==void 0?e:i!==void 0?i:void 0}function op(a,e,i,s,c){return il(typeof i===c?s[i]:void 0,a.default,e.default)}function zc(a,e,i){if(Xo(i)!=="number")return il(a.default,e.default);const s=a.stops.length;if(s===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[s-1][0])return a.stops[s-1][1];const c=Ac(a.stops.map(l=>l[0]),i);return a.stops[c][1]}function Pl(a,e,i){const s=a.base!==void 0?a.base:1;if(Xo(i)!=="number")return il(a.default,e.default);const c=a.stops.length;if(c===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[c-1][0])return a.stops[c-1][1];const l=Ac(a.stops.map(_=>_[0]),i),d=function(_,T,C,E){const M=E-C,z=_-C;return M===0?0:T===1?z/M:(Math.pow(T,z)-1)/(Math.pow(T,M)-1)}(i,s,a.stops[l][0],a.stops[l+1][0]),y=a.stops[l][1],w=a.stops[l+1][1];let A=_c[e.type]||Ud;if(a.colorSpace&&a.colorSpace!=="rgb"){const _=Rs[a.colorSpace];A=(T,C)=>_.reverse(_.interpolate(_.forward(T),_.forward(C),d))}return typeof y.evaluate=="function"?{evaluate(..._){const T=y.evaluate.apply(void 0,_),C=w.evaluate.apply(void 0,_);if(T!==void 0&&C!==void 0)return A(T,C,d)}}:A(y,w,d)}function jd(a,e,i){return e.type==="color"?i=Mn.parse(i):e.type==="formatted"?i=va.fromString(i.toString()):e.type==="resolvedImage"?i=Ra.build(i.toString()):Xo(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),il(i,a.default,e.default)}Va.register(Ds,{error:[{kind:"error"},[dn],(a,[e])=>{throw new Ir(e.evaluate(a))}],typeof:[dn,[yn],(a,[e])=>pr(Fr(e.evaluate(a)))],"to-rgba":[Lr(si,4),[aa],(a,[e])=>e.evaluate(a).toRenderColor(null).toArray()],"to-hsla":[Lr(si,4),[aa],(a,[e])=>e.evaluate(a).toRenderColor(null).toHslaArray()],rgb:[aa,[si,si,si],Oo],rgba:[aa,[si,si,si,si],Oo],hsl:[aa,[si,si,si],Fd],hsla:[aa,[si,si,si,si],Fd],has:{type:gn,overloads:[[[dn],(a,[e])=>Nh(e.evaluate(a),a.properties())],[[dn,gc],(a,[e,i])=>Nh(e.evaluate(a),i.evaluate(a))]]},get:{type:yn,overloads:[[[dn],(a,[e])=>Ol(e.evaluate(a),a.properties())],[[dn,gc],(a,[e,i])=>Ol(e.evaluate(a),i.evaluate(a))]]},"feature-state":[yn,[dn],(a,[e])=>Ol(e.evaluate(a),a.featureState||{})],properties:[gc,[],a=>a.properties()],"geometry-type":[dn,[],a=>a.geometryType()],id:[yn,[],a=>a.id()],zoom:[si,[],a=>a.globals.zoom],pitch:[si,[],a=>a.globals.pitch||0],"distance-from-center":[si,[],a=>a.distanceFromCenter()],"measure-light":[si,[dn],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[si,[],a=>a.globals.heatmapDensity||0],"line-progress":[si,[],a=>a.globals.lineProgress||0],"raster-value":[si,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[si,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[si,[],a=>a.globals.skyRadialProgress||0],accumulated:[yn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[si,es(si),(a,e)=>{let i=0;for(const s of e)i+=s.evaluate(a);return i}],"*":[si,es(si),(a,e)=>{let i=1;for(const s of e)i*=s.evaluate(a);return i}],"-":{type:si,overloads:[[[si,si],(a,[e,i])=>e.evaluate(a)-i.evaluate(a)],[[si],(a,[e])=>-e.evaluate(a)]]},"/":[si,[si,si],(a,[e,i])=>e.evaluate(a)/i.evaluate(a)],"%":[si,[si,si],(a,[e,i])=>e.evaluate(a)%i.evaluate(a)],ln2:[si,[],()=>Math.LN2],pi:[si,[],()=>Math.PI],e:[si,[],()=>Math.E],"^":[si,[si,si],(a,[e,i])=>Math.pow(e.evaluate(a),i.evaluate(a))],sqrt:[si,[si],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[si,[si],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[si,[si],(a,[e])=>Math.log(e.evaluate(a))],log2:[si,[si],(a,[e])=>Math.log(e.evaluate(a))/Math.LN2],sin:[si,[si],(a,[e])=>Math.sin(e.evaluate(a))],cos:[si,[si],(a,[e])=>Math.cos(e.evaluate(a))],tan:[si,[si],(a,[e])=>Math.tan(e.evaluate(a))],asin:[si,[si],(a,[e])=>Math.asin(e.evaluate(a))],acos:[si,[si],(a,[e])=>Math.acos(e.evaluate(a))],atan:[si,[si],(a,[e])=>Math.atan(e.evaluate(a))],min:[si,es(si),(a,e)=>Math.min(...e.map(i=>i.evaluate(a)))],max:[si,es(si),(a,e)=>Math.max(...e.map(i=>i.evaluate(a)))],abs:[si,[si],(a,[e])=>Math.abs(e.evaluate(a))],round:[si,[si],(a,[e])=>{const i=e.evaluate(a);return i<0?-Math.round(-i):Math.round(i)}],floor:[si,[si],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[si,[si],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[gn,[dn,yn],(a,[e,i])=>a.properties()[e.value]===i.value],"filter-id-==":[gn,[yn],(a,[e])=>a.id()===e.value],"filter-type-==":[gn,[dn],(a,[e])=>a.geometryType()===e.value],"filter-<":[gn,[dn,yn],(a,[e,i])=>{const s=a.properties()[e.value],c=i.value;return typeof s==typeof c&&s<c}],"filter-id-<":[gn,[yn],(a,[e])=>{const i=a.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[gn,[dn,yn],(a,[e,i])=>{const s=a.properties()[e.value],c=i.value;return typeof s==typeof c&&s>c}],"filter-id->":[gn,[yn],(a,[e])=>{const i=a.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[gn,[dn,yn],(a,[e,i])=>{const s=a.properties()[e.value],c=i.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[gn,[yn],(a,[e])=>{const i=a.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[gn,[dn,yn],(a,[e,i])=>{const s=a.properties()[e.value],c=i.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[gn,[yn],(a,[e])=>{const i=a.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[gn,[yn],(a,[e])=>e.value in a.properties()],"filter-has-id":[gn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[gn,[Lr(dn)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[gn,[Lr(yn)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[gn,[dn,Lr(yn)],(a,[e,i])=>i.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[gn,[dn,Lr(yn)],(a,[e,i])=>function(s,c,l,d){for(;l<=d;){const y=l+d>>1;if(c[y]===s)return!0;c[y]>s?d=y-1:l=y+1}return!1}(a.properties()[e.value],i.value,0,i.value.length-1)],all:{type:gn,overloads:[[[gn,gn],(a,[e,i])=>e.evaluate(a)&&i.evaluate(a)],[es(gn),(a,e)=>{for(const i of e)if(!i.evaluate(a))return!1;return!0}]]},any:{type:gn,overloads:[[[gn,gn],(a,[e,i])=>e.evaluate(a)||i.evaluate(a)],[es(gn),(a,e)=>{for(const i of e)if(i.evaluate(a))return!0;return!1}]]},"!":[gn,[gn],(a,[e])=>!e.evaluate(a)],"is-supported-script":[gn,[dn],(a,[e])=>{const i=a.globals&&a.globals.isSupportedScript;return!i||i(e.evaluate(a))}],upcase:[dn,[dn],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[dn,[dn],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[dn,es(yn),(a,e)=>e.map(i=>sa(i.evaluate(a))).join("")],"resolved-locale":[dn,[js],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[si,[si,si,yn],(a,e)=>{const[i,s,c]=e.map(d=>d.evaluate(a));if(i>s||i===s)return i;let l;if(typeof c=="string")l=function(d){let y=0;if(d.length===0)return y;for(let w=0;w<d.length;w++)y=(y<<5)-y+d.charCodeAt(w),y|=0;return y}(c);else{if(typeof c!="number")throw new Ir(`Invalid seed input: ${c}`);l=c}return i+fo(l)()*(s-i)}]});class qd{constructor(e,i,s,c){this.expression=e,this._warningHistory={},this._evaluator=new Md(s,c),this._defaultValue=i?function(l){return l.type==="color"&&(Zr(l.default)||Array.isArray(l.default))?new Mn(0,0,0,0):l.type==="color"?Mn.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=ja(e)}evaluateWithoutErrorHandling(e,i,s,c,l,d,y,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,c,l,d,y,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Ir(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function Gd(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ds}function Lc(a,e,i,s){const c=new Ru(Ds,[],e?function(d){const y={color:aa,string:dn,number:si,enum:dn,boolean:gn,formatted:Tu,resolvedImage:Hr};return d.type==="array"?Lr(y[d.value]||yn,d.length):y[d.type]}(e):void 0,void 0,void 0,i,s),l=c.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?tl(new qd(l,e,i,s)):Pr(c.errors)}class nl{constructor(e,i,s,c){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!Iu(i.expression),this.configDependencies=ja(i.expression)}evaluateWithoutErrorHandling(e,i,s,c,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,c,l,d)}evaluate(e,i,s,c,l,d){return this._styleExpression.evaluate(e,i,s,c,l,d)}}class kl{constructor(e,i,s,c,l,d){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Iu(i.expression),this.isLightConstant=l,this.isLineProgressConstant=d,this.configDependencies=ja(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,s,c,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,c,l,d)}evaluate(e,i,s,c,l,d){return this._styleExpression.evaluate(e,i,s,c,l,d)}interpolationFactor(e,i,s){return this.interpolationType?da.interpolationFactor(this.interpolationType,e,i,s):0}}function Pu(a,e,i,s){if((a=Lc(a,e,i,s)).result==="error")return a;const c=a.value.expression,l=Ua(c);if(!l&&!Dc(e))return Pr([new Fa("","data expressions not supported")]);const d=oa(c,["zoom","pitch","distance-from-center"]);if(!d&&!xm(e))return Pr([new Fa("","zoom expressions not supported")]);const y=oa(c,["measure-light"]);if(!y&&!Vd(e))return Pr([new Fa("","measure-light expression not supported")]);const w=oa(c,["line-progress"]);if(!w&&!function(T){return Lu(T.expression,"line-progress")}(e))return Pr([new Fa("","line-progress expression not supported")]);const A=e.expression&&e.expression.relaxZoomRestriction,_=Bl(c);return _||d||A?_ instanceof Fa?Pr([_]):_ instanceof da&&!sp(e)?Pr([new Fa("",'"interpolate" expressions cannot be used with this property')]):tl(_?new kl(l&&w?"camera":"composite",a.value,_.labels,_ instanceof da?_.interpolation:void 0,y,w):new nl(l&&w?"constant":"source",a.value,y,w)):Pr([new Fa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Fh{constructor(e,i){this._parameters=e,this._specification=i,bn(this,Ou(this._parameters,this._specification))}static deserialize(e){return new Fh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bl(a){let e=null;if(a instanceof zo)e=Bl(a.result);else if(a instanceof Zs){for(const i of a.args)if(e=Bl(i),e)break}else(a instanceof Ja||a instanceof da)&&a.input instanceof Va&&a.input.name==="zoom"&&(e=a);return e instanceof Fa||a.eachChild(i=>{const s=Bl(i);s instanceof Fa?e=s:e&&s&&e!==s&&(e=new Fa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ku,Vh,Hd=function(){if(Vh)return ku;Vh=1,ku=e;var a=3;function e(i,s,c){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var d=new Int32Array(this.arrayBuffer);i=d[0],this.d=(s=d[1])+2*(c=d[2]);for(var y=0;y<this.d*this.d;y++){var w=d[a+y],A=d[a+y+1];l.push(w===A?null:d.subarray(w,A))}var _=d[a+l.length+1];this.keys=d.subarray(d[a+l.length],_),this.bboxes=d.subarray(_),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var T=0;T<this.d*this.d;T++)l.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=c,this.scale=s/i,this.uid=0;var C=c/s*i;this.min=-C,this.max=i+C}return e.prototype.insert=function(i,s,c,l,d){this._forEachCell(s,c,l,d,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(l),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,c,l,d,y){this.cells[d].push(y)},e.prototype.query=function(i,s,c,l,d){var y=this.min,w=this.max;if(i<=y&&s<=y&&w<=c&&w<=l&&!d)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,s,c,l,this._queryCell,A,{},d),A},e.prototype._queryCell=function(i,s,c,l,d,y,w,A){var _=this.cells[d];if(_!==null)for(var T=this.keys,C=this.bboxes,E=0;E<_.length;E++){var M=_[E];if(w[M]===void 0){var z=4*M;(A?A(C[z+0],C[z+1],C[z+2],C[z+3]):i<=C[z+2]&&s<=C[z+3]&&c>=C[z+0]&&l>=C[z+1])?(w[M]=!0,y.push(T[M])):w[M]=!1}}},e.prototype._forEachCell=function(i,s,c,l,d,y,w,A){for(var _=this._convertToCellCoord(i),T=this._convertToCellCoord(s),C=this._convertToCellCoord(c),E=this._convertToCellCoord(l),M=_;M<=C;M++)for(var z=T;z<=E;z++){var N=this.d*z+M;if((!A||A(this._convertFromCellCoord(M),this._convertFromCellCoord(z),this._convertFromCellCoord(M+1),this._convertFromCellCoord(z+1)))&&d.call(this,i,s,c,l,N,y,w,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=a+this.cells.length+1+1,c=0,l=0;l<this.cells.length;l++)c+=this.cells[l].length;var d=new Int32Array(s+c+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var y=s,w=0;w<i.length;w++){var A=i[w];d[a+w]=y,d.set(A,y),y+=A.length}return d[a+i.length]=y,d.set(this.keys,y),d[a+i.length+1]=y+=this.keys.length,d.set(this.bboxes,y),y+=this.bboxes.length,d.buffer},ku}(),Oc=re(Hd);const Pc={};function Wt(a,e,i={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),Pc[e]={klass:a,omit:i.omit||[]}}Wt(Object,"Object"),Oc.serialize=function(a,e){const i=a.toArrayBuffer();return e&&e.add(i),{buffer:i}},Oc.deserialize=function(a){return new Oc(a.buffer)},Object.defineProperty(Oc,"name",{value:"Grid"}),Wt(Oc,"Grid"),typeof DOMMatrix<"u"&&Wt(DOMMatrix,"DOMMatrix"),Wt(Mn,"Color"),Wt(Error,"Error"),Wt(va,"Formatted"),Wt(Sl,"FormattedSection"),Wt(Kr,"AJAXError"),Wt(Ra,"ResolvedImage"),Wt(Fh,"StylePropertyFunction"),Wt(qd,"StyleExpression",{omit:["_evaluator"]}),Wt(Ia,"ImageId"),Wt(Co,"ImageVariant"),Wt(kl,"ZoomDependentExpression"),Wt(nl,"ZoomConstantExpression"),Wt(Va,"CompoundExpression",{omit:["_evaluate"]});for(const a in Ds)Pc[Ds[a]._classRegistryKey]||Wt(Ds[a],`Expression${a}`);function kc(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Zd(a){return self.ImageBitmap&&a instanceof ImageBitmap}function rl(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(kc(a)||Zd(a))return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){const i=[];for(const s of a)i.push(rl(s,e));return i}if(a instanceof Map){const i={$name:"Map",entries:[]};for(const[s,c]of a.entries())i.entries.push(rl(s),rl(c));return i}if(a instanceof Set){const i={$name:"Set"};let s=0;for(const c of a.values())i[++s]=rl(c);return i}if(a instanceof DOMMatrix){const i={$name:"DOMMatrix"},s=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of s)i[c]=a[c];return i}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const i=a.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const c=i.serialize?i.serialize(a,e):{};if(!i.serialize){for(const l in a)a.hasOwnProperty(l)&&(Pc[s].omit.indexOf(l)>=0||(c[l]=rl(a[l],e)));a instanceof Error&&(c.message=a.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof a)}function la(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||kc(a)||Zd(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(la);if(typeof a=="object"){const e=a.$name||"Object";if(e==="Map"){const c=a.entries||[],l=new Map;for(let d=0;d<c.length;d+=2)l.set(la(c[d]),la(c[d+1]));return l}if(e==="Set"){const c=new Set;for(const l of Object.keys(a))l!=="$name"&&c.add(la(a[l]));return c}if(e==="DOMMatrix"){let c;return c=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(a.value);const{klass:i}=Pc[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(a);const s=Object.create(i.prototype);for(const c of Object.keys(a))c!=="$name"&&(s[c]=la(a[c]));return s}throw new Error("can't deserialize object of type "+typeof a)}const _i={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Uh(a){for(const e of a)if(Fl(e.charCodeAt(0)))return!0;return!1}function Nl(a){for(const e of a)if(!al(e.charCodeAt(0)))return!1;return!0}function al(a){return!(_i.Arabic(a)||_i["Arabic Supplement"](a)||_i["Arabic Extended-A"](a)||_i["Arabic Presentation Forms-A"](a)||_i["Arabic Presentation Forms-B"](a))}function Fl(a){return!(a!==746&&a!==747&&(a<4352||!(_i["Bopomofo Extended"](a)||_i.Bopomofo(a)||_i["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||_i["CJK Compatibility Ideographs"](a)||_i["CJK Compatibility"](a)||_i["CJK Radicals Supplement"](a)||_i["CJK Strokes"](a)||!(!_i["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||_i["CJK Unified Ideographs Extension A"](a)||_i["CJK Unified Ideographs"](a)||_i["Enclosed CJK Letters and Months"](a)||_i["Hangul Compatibility Jamo"](a)||_i["Hangul Jamo Extended-A"](a)||_i["Hangul Jamo Extended-B"](a)||_i["Hangul Jamo"](a)||_i["Hangul Syllables"](a)||_i.Hiragana(a)||_i["Ideographic Description Characters"](a)||_i.Kanbun(a)||_i["Kangxi Radicals"](a)||_i["Katakana Phonetic Extensions"](a)||_i.Katakana(a)&&a!==12540||!(!_i["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!_i["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||_i["Unified Canadian Aboriginal Syllabics"](a)||_i["Unified Canadian Aboriginal Syllabics Extended"](a)||_i["Vertical Forms"](a)||_i["Yijing Hexagram Symbols"](a)||_i["Yi Syllables"](a)||_i["Yi Radicals"](a))))}function jh(a){return!(Fl(a)||function(e){return!!(_i["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||_i["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||_i["Letterlike Symbols"](e)||_i["Number Forms"](e)||_i["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||_i["Control Pictures"](e)&&e!==9251||_i["Optical Character Recognition"](e)||_i["Enclosed Alphanumerics"](e)||_i["Geometric Shapes"](e)||_i["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||_i["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||_i["CJK Symbols and Punctuation"](e)||_i.Katakana(e)||_i["Private Use Area"](e)||_i["CJK Compatibility Forms"](e)||_i["Small Form Variants"](e)||_i["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(a))}function $d(a){return _i.Arabic(a)||_i["Arabic Supplement"](a)||_i["Arabic Extended-A"](a)||_i["Arabic Presentation Forms-A"](a)||_i["Arabic Presentation Forms-B"](a)}function Vl(a){return a>=1424&&a<=2303||_i["Arabic Presentation Forms-A"](a)||_i["Arabic Presentation Forms-B"](a)}function Bc(a,e){return!(!e&&Vl(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||_i.Khmer(a))}function lp(a){for(const e of a)if(Vl(e.charCodeAt(0)))return!0;return!1}const Xd="deferred",ts="loading",Bu="loaded";let Yd=null,Da="unavailable",Po=null;const Xs=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Da="error"),Yd&&Yd(a)};function Bn(){ir.fire(new Ya("pluginStateChange",{pluginStatus:Da,pluginURL:Po}))}const ir=new Vs,Vr=function(){return Da},qh=function(){if(Da!==Xd||!Po)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Da=ts,Bn(),Po&&Mo({url:Po},a=>{a?Xs(a):(Da=Bu,Bn())})},za={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Da===Bu||za.applyArabicShaping!=null,isLoading:()=>Da===ts,setState(a){Da=a.pluginStatus,Po=a.pluginURL},isParsed:()=>za.applyArabicShaping!=null&&za.processBidirectionalText!=null&&za.processStyledBidirectionalText!=null,getPluginURL:()=>Po};class Ln{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,s){for(const c of i)if(!Bc(c.charCodeAt(0),s))return!1;return!0}(e,za.isLoaded())}}class sl{constructor(e,i,s,c){this.property=e,this.value=i,this.expression=function(l,d,y,w){if(Zr(l))return new Fh(l,d);if(Gd(l)||Array.isArray(l)&&l.length>0){const A=Pu(l,d,y,w);if(A.result==="error")throw new Error(A.value.map(_=>`${_.key}: ${_.message}`).join(", "));return A.value}{let A=l;return typeof l=="string"&&d.type==="color"&&(A=Mn.parse(l)),{kind:"constant",configDependencies:new Set,evaluate:()=>A}}}(i===void 0?e.specification.default:i,e.specification,s,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class Nc{constructor(e,i,s){this.property=e,this.value=new sl(e,void 0,i,s)}transitioned(e,i){return new Wd(this.property,this.value,i,vi({},e.transition,this.transition),e.now)}untransitioned(){return new Wd(this.property,this.value,null,{},0)}}class Ul{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return Wr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Nc(this._values[e].property,this._scope,this._options)),this._values[e].value=new sl(this._values[e].property,i===null?void 0:Wr(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const c in e){const l=e[c];if(c.endsWith("-transition")){const d=c.slice(0,-11);s[d]&&this.setTransition(d,l)}else s.hasOwnProperty(c)&&this.setValue(c,l)}}getTransition(e){return Wr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Nc(this._values[e].property)),this._values[e].transition=Wr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const s=new Rr(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,i._values[c]);return s}untransitioned(){const e=new Rr(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Wd{constructor(e,i,s,c,l){const d=c.delay||0,y=c.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+d,this.end=this.begin+y,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const c=e.now||0,l=this.value.possiblyEvaluate(e,i,s),d=this.prior;if(d){if(c>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(c<this.begin)return d.possiblyEvaluate(e,i,s);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,s),l,Es(y))}}return l}}class Rr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const c=new Fc(this._properties);for(const l of Object.keys(this._values))c._values[l]=this._values[l].possiblyEvaluate(e,i,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class jl{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return Wr(this._values[e].value)}setValue(e,i){this._values[e]=new sl(this._values[e].property,i===null?void 0:Wr(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const c=new Fc(this._properties);for(const l of Object.keys(this._values))c._values[l]=this._values[l].possiblyEvaluate(e,i,s);return c}}class ql{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,c){return this.property.evaluate(this.value,this.parameters,e,i,s,c)}}class Fc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Pt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const c=_c[this.specification.type];return c?c(e,i,s):e}}class Kt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,c){return new ql(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,c)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new ql(this,{kind:"constant",value:void 0},e.parameters);const c=_c[this.specification.type];return c?new ql(this,{kind:"constant",value:c(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,c,l,d){return e.kind==="constant"?e.value:e.evaluate(i,s,c,l,d)}}class Gl{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,c){return!!e.expression.evaluate(i,null,{},s,c)}interpolate(){return!1}}class lr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Ln(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const l=this.defaultPropertyValues[s]=new sl(c,void 0),d=this.defaultTransitionablePropertyValues[s]=new Nc(c);this.defaultTransitioningPropertyValues[s]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=l.possiblyEvaluate(i)}}}Wt(Kt,"DataDrivenProperty"),Wt(Pt,"DataConstantProperty"),Wt(Gl,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function is(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ur(a){if(Array.isArray(a))return a.map(Ur);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const e={};for(const i in a)e[i]=Ur(a[i]);return e}return is(a)}function Gh(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const e of a.slice(1))if(!Gh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Vc(a,e="",i=null,s="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gh(a)||(a=Zh(a));const c=a;let l=!0;try{l=function(_){if(!vs(_))return _;let T=Ur(_);return Kd(T),T=Hh(T),T}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let d=null,y=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){y=$e[`filter_${s}`];const _=Lc(l,y,e,i);if(_.result==="error")throw new Error(_.value.map(T=>`${T.key}: ${T.message}`).join(", "));d=(T,C,E)=>_.value.evaluate(T,C,{},E)}let w=null,A=null;if(l!==c){const _=Lc(c,y,e,i);if(_.result==="error")throw new Error(_.value.map(T=>`${T.key}: ${T.message}`).join(", "));w=(T,C,E,M,z)=>_.value.evaluate(T,C,{},E,void 0,void 0,M,z),A=!Ua(_.value.expression)}return{filter:d,dynamicFilter:w||void 0,needGeometry:Qd(l),needFeature:!!A}}function Hh(a){if(!Array.isArray(a))return a;const e=function(i){if(Jd.has(i[0])){for(let s=1;s<i.length;s++)if(vs(i[s]))return!0}return i}(a);return e===!0?e:e.map(i=>Hh(i))}function Kd(a){let e=!1;const i=[];if(a[0]==="case"){for(let s=1;s<a.length-1;s+=2)e=e||vs(a[s]),i.push(a[s+1]);i.push(a[a.length-1])}else if(a[0]==="match"){e=e||vs(a[1]);for(let s=2;s<a.length-1;s+=2)i.push(a[s+1]);i.push(a[a.length-1])}else if(a[0]==="step"){e=e||vs(a[1]);for(let s=1;s<a.length-1;s+=2)i.push(a[s+1])}e&&(a.length=0,a.push("any",...i));for(let s=1;s<a.length;s++)Kd(a[s])}function vs(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<a.length;i++)if(vs(a[i]))return!0;return!1}const Jd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function cp(a,e){return a<e?-1:a>e?1:0}function Qd(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(Qd(a[e]))return!0;return!1}function Zh(a){if(!a)return!0;const e=a[0];return a.length<=1?e!=="any":e==="=="?ol(a[1],a[2],"=="):e==="!="?Hl(ol(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ol(a[1],a[2],e):e==="any"?(i=a.slice(1),["any"].concat(i.map(Zh))):e==="all"?["all"].concat(a.slice(1).map(Zh)):e==="none"?["all"].concat(a.slice(1).map(Zh).map(Hl)):e==="in"?ef(a[1],a.slice(2)):e==="!in"?Hl(ef(a[1],a.slice(2))):e==="has"?tf(a[1]):e!=="!has"||Hl(tf(a[1]));var i}function ol(a,e,i){switch(a){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,a,e]}}function ef(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",a,["literal",e.sort(cp)]]:["filter-in-small",a,["literal",e]]}}function tf(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Hl(a){return["!",a]}const $h="";function Zl(a,e){return e?`${a}${$h}${e}`:a}const ko="-transition",bm=new Set(["fill","line","background","hillshade","raster"]);class Jr extends Vs{constructor(e,i,s,c,l){if(super(),this.id=e.id,this.fqid=Zl(this.id,s),this.type=e.type,this.scope=s,this.lut=c,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const d=Lc(this.filter,$e[`filter_${e.type}`]);d.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...d.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new jl(i.layout,this.scope,l),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Ul(i.paint,this.scope,l);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&bm.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(ko)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const s=this._transitionablePaint,c=s._properties.properties;if(e.endsWith(ko)){const T=e.slice(0,-11);return c[T]&&s.setTransition(T,i||void 0),!1}if(!c[e])return!1;const l=s._values[e],d=l.value.isDataDriven(),y=l.value;s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const w=s._values[e].value,A=w.isDataDriven(),_=e.endsWith("pattern")||e==="line-dasharray";return A||d||_||this._handleOverridablePaintPropertyUpdate(e,y,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return ds({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof ql&&Dc(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Vc(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,s,c,l,d,y,w,A){}}const wm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Nu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Hn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function wn(a,e=1){let i=0,s=0;return{members:a.map(c=>{const l=wm[c.type].BYTES_PER_ELEMENT,d=i=up(i,Math.max(e,l)),y=c.components||1;return s=Math.max(s,l),i+=l*y,{name:c.name,type:c.type,components:y,offset:d}}),size:up(i,Math.max(s,e)),alignment:e}}function up(a,e){return Math.ceil(a/e)*e}class Bo extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=s,e}}Bo.prototype.bytesPerElement=4,Wt(Bo,"StructArrayLayout2i4");class Uc extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const l=3*e;return this.int16[l+0]=i,this.int16[l+1]=s,this.int16[l+2]=c,e}}Uc.prototype.bytesPerElement=6,Wt(Uc,"StructArrayLayout3i6");class No extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,c)}emplace(e,i,s,c,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=s,this.int16[d+2]=c,this.int16[d+3]=l,e}}No.prototype.bytesPerElement=8,Wt(No,"StructArrayLayout4i8");class jc extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}jc.prototype.bytesPerElement=4,Wt(jc,"StructArrayLayout1f4");class Fu extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const l=4*e,d=2*e;return this.int16[l+0]=i,this.int16[l+1]=s,this.float32[d+1]=c,e}}Fu.prototype.bytesPerElement=8,Wt(Fu,"StructArrayLayout2i1f8");class $l extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const l=4*e;return this.int16[l+0]=i,this.int16[l+1]=s,this.int16[l+2]=c,e}}$l.prototype.bytesPerElement=8,Wt($l,"StructArrayLayout3i8");class ns extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c,l)}emplace(e,i,s,c,l,d){const y=5*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.int16[y+2]=c,this.int16[y+3]=l,this.int16[y+4]=d,e}}ns.prototype.bytesPerElement=10,Wt(ns,"StructArrayLayout5i10");class nf extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,c,l,d,y)}emplace(e,i,s,c,l,d,y,w){const A=6*e,_=12*e,T=3*e;return this.int16[A+0]=i,this.int16[A+1]=s,this.uint8[_+4]=c,this.uint8[_+5]=l,this.uint8[_+6]=d,this.uint8[_+7]=y,this.float32[T+2]=w,e}}nf.prototype.bytesPerElement=12,Wt(nf,"StructArrayLayout2i4ub1f12");class xs extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const l=3*e;return this.float32[l+0]=i,this.float32[l+1]=s,this.float32[l+2]=c,e}}xs.prototype.bytesPerElement=12,Wt(xs,"StructArrayLayout3f12");class Ys extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c,l)}emplace(e,i,s,c,l,d){const y=6*e,w=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=s,this.uint16[y+2]=c,this.uint16[y+3]=l,this.float32[w+2]=d,e}}Ys.prototype.bytesPerElement=12,Wt(Ys,"StructArrayLayout4ui1f12");class Xh extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,c)}emplace(e,i,s,c,l){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=s,this.uint16[d+2]=c,this.uint16[d+3]=l,e}}Xh.prototype.bytesPerElement=8,Wt(Xh,"StructArrayLayout4ui8");class Yh extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,c,l,d)}emplace(e,i,s,c,l,d,y){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=c,this.int16[w+3]=l,this.int16[w+4]=d,this.int16[w+5]=y,e}}Yh.prototype.bytesPerElement=12,Wt(Yh,"StructArrayLayout6i12");class rf extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y,w,A,_,T,C){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,c,l,d,y,w,A,_,T,C)}emplace(e,i,s,c,l,d,y,w,A,_,T,C,E){const M=12*e;return this.int16[M+0]=i,this.int16[M+1]=s,this.int16[M+2]=c,this.int16[M+3]=l,this.uint16[M+4]=d,this.uint16[M+5]=y,this.uint16[M+6]=w,this.uint16[M+7]=A,this.int16[M+8]=_,this.int16[M+9]=T,this.int16[M+10]=C,this.int16[M+11]=E,e}}rf.prototype.bytesPerElement=24,Wt(rf,"StructArrayLayout4i4ui4i24");class af extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,c,l,d)}emplace(e,i,s,c,l,d,y){const w=10*e,A=5*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=c,this.float32[A+2]=l,this.float32[A+3]=d,this.float32[A+4]=y,e}}af.prototype.bytesPerElement=20,Wt(af,"StructArrayLayout3i3f20");class Xl extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,c)}emplace(e,i,s,c,l){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=s,this.float32[d+2]=c,this.float32[d+3]=l,e}}Xl.prototype.bytesPerElement=16,Wt(Xl,"StructArrayLayout4f16");class sf extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}sf.prototype.bytesPerElement=4,Wt(sf,"StructArrayLayout1ul4");class Fo extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=s,e}}Fo.prototype.bytesPerElement=4,Wt(Fo,"StructArrayLayout2ui4");class of extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y,w,A,_,T,C,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,s,c,l,d,y,w,A,_,T,C,E)}emplace(e,i,s,c,l,d,y,w,A,_,T,C,E,M){const z=20*e,N=10*e;return this.int16[z+0]=i,this.int16[z+1]=s,this.int16[z+2]=c,this.int16[z+3]=l,this.int16[z+4]=d,this.float32[N+3]=y,this.float32[N+4]=w,this.float32[N+5]=A,this.float32[N+6]=_,this.int16[z+14]=T,this.uint32[N+8]=C,this.uint16[z+18]=E,this.uint16[z+19]=M,e}}of.prototype.bytesPerElement=40,Wt(of,"StructArrayLayout5i4f1i1ul2ui40");class Vu extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,c,l,d,y)}emplace(e,i,s,c,l,d,y,w){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=s,this.int16[A+2]=c,this.int16[A+4]=l,this.int16[A+5]=d,this.int16[A+6]=y,this.int16[A+7]=w,e}}Vu.prototype.bytesPerElement=16,Wt(Vu,"StructArrayLayout3i2i2i16");class Wh extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c,l)}emplace(e,i,s,c,l,d){const y=4*e,w=8*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=c,this.int16[w+6]=l,this.int16[w+7]=d,e}}Wh.prototype.bytesPerElement=16,Wt(Wh,"StructArrayLayout2f1f2i16");class lf extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,c,l,d)}emplace(e,i,s,c,l,d,y){const w=20*e,A=5*e;return this.uint8[w+0]=i,this.uint8[w+1]=s,this.float32[A+1]=c,this.float32[A+2]=l,this.float32[A+3]=d,this.float32[A+4]=y,e}}lf.prototype.bytesPerElement=20,Wt(lf,"StructArrayLayout2ub4f20");class ca extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=s,this.uint16[l+2]=c,e}}ca.prototype.bytesPerElement=6,Wt(ca,"StructArrayLayout3ui6");class cf extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V,Z,H,q,Y){const K=this.length;return this.resize(K+1),this.emplace(K,e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V,Z,H,q,Y)}emplace(e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V,Z,H,q,Y,K){const ee=30*e,he=15*e,le=60*e;return this.int16[ee+0]=i,this.int16[ee+1]=s,this.int16[ee+2]=c,this.float32[he+2]=l,this.float32[he+3]=d,this.uint16[ee+8]=y,this.uint16[ee+9]=w,this.uint32[he+5]=A,this.uint32[he+6]=_,this.uint32[he+7]=T,this.uint16[ee+16]=C,this.uint16[ee+17]=E,this.uint16[ee+18]=M,this.float32[he+10]=z,this.float32[he+11]=N,this.uint8[le+48]=V,this.uint8[le+49]=Z,this.uint8[le+50]=H,this.uint32[he+13]=q,this.int16[ee+28]=Y,this.uint8[le+58]=K,e}}cf.prototype.bytesPerElement=60,Wt(cf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Uu extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V,Z,H,q,Y,K,ee,he,le,ue,Te,pe,Ee,De,Re,ke,Pe){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V,Z,H,q,Y,K,ee,he,le,ue,Te,pe,Ee,De,Re,ke,Pe)}emplace(e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V,Z,H,q,Y,K,ee,he,le,ue,Te,pe,Ee,De,Re,ke,Pe,Ze){const Ue=20*e,Xe=40*e,bt=80*e;return this.float32[Ue+0]=i,this.float32[Ue+1]=s,this.int16[Xe+4]=c,this.int16[Xe+5]=l,this.int16[Xe+6]=d,this.int16[Xe+7]=y,this.int16[Xe+8]=w,this.int16[Xe+9]=A,this.int16[Xe+10]=_,this.int16[Xe+11]=T,this.int16[Xe+12]=C,this.uint16[Xe+13]=E,this.uint16[Xe+14]=M,this.uint16[Xe+15]=z,this.uint16[Xe+16]=N,this.uint16[Xe+17]=V,this.uint16[Xe+18]=Z,this.uint16[Xe+19]=H,this.uint16[Xe+20]=q,this.uint16[Xe+21]=Y,this.uint16[Xe+22]=K,this.uint16[Xe+23]=ee,this.uint16[Xe+24]=he,this.uint16[Xe+25]=le,this.uint16[Xe+26]=ue,this.uint16[Xe+27]=Te,this.uint32[Ue+14]=pe,this.float32[Ue+15]=Ee,this.float32[Ue+16]=De,this.float32[Ue+17]=Re,this.float32[Ue+18]=ke,this.uint8[bt+76]=Pe,this.uint16[Xe+39]=Ze,e}}Uu.prototype.bytesPerElement=80,Wt(Uu,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class rs extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,c,l)}emplace(e,i,s,c,l,d){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=c,this.float32[y+3]=l,this.float32[y+4]=d,e}}rs.prototype.bytesPerElement=20,Wt(rs,"StructArrayLayout5f20");class Kh extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,c,l,d,y)}emplace(e,i,s,c,l,d,y,w){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=s,this.float32[A+2]=c,this.float32[A+3]=l,this.float32[A+4]=d,this.float32[A+5]=y,this.float32[A+6]=w,e}}Kh.prototype.bytesPerElement=28,Wt(Kh,"StructArrayLayout7f28");class Jh extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y,w,A,_,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,s,c,l,d,y,w,A,_,T)}emplace(e,i,s,c,l,d,y,w,A,_,T,C){const E=11*e;return this.float32[E+0]=i,this.float32[E+1]=s,this.float32[E+2]=c,this.float32[E+3]=l,this.float32[E+4]=d,this.float32[E+5]=y,this.float32[E+6]=w,this.float32[E+7]=A,this.float32[E+8]=_,this.float32[E+9]=T,this.float32[E+10]=C,e}}Jh.prototype.bytesPerElement=44,Wt(Jh,"StructArrayLayout11f44");class uf extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y,w,A){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,c,l,d,y,w,A)}emplace(e,i,s,c,l,d,y,w,A,_){const T=9*e;return this.float32[T+0]=i,this.float32[T+1]=s,this.float32[T+2]=c,this.float32[T+3]=l,this.float32[T+4]=d,this.float32[T+5]=y,this.float32[T+6]=w,this.float32[T+7]=A,this.float32[T+8]=_,e}}uf.prototype.bytesPerElement=36,Wt(uf,"StructArrayLayout9f36");class qc extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=s,e}}qc.prototype.bytesPerElement=8,Wt(qc,"StructArrayLayout2f8");class Qh extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s,c)}emplace(e,i,s,c,l){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=s,this.uint16[d+3]=c,this.uint16[d+4]=l,e}}Qh.prototype.bytesPerElement=12,Wt(Qh,"StructArrayLayout1ul3ui12");class hf extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}hf.prototype.bytesPerElement=2,Wt(hf,"StructArrayLayout1ui2");class ed extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N)}emplace(e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V){const Z=16*e;return this.float32[Z+0]=i,this.float32[Z+1]=s,this.float32[Z+2]=c,this.float32[Z+3]=l,this.float32[Z+4]=d,this.float32[Z+5]=y,this.float32[Z+6]=w,this.float32[Z+7]=A,this.float32[Z+8]=_,this.float32[Z+9]=T,this.float32[Z+10]=C,this.float32[Z+11]=E,this.float32[Z+12]=M,this.float32[Z+13]=z,this.float32[Z+14]=N,this.float32[Z+15]=V,e}}ed.prototype.bytesPerElement=64,Wt(ed,"StructArrayLayout16f64");class Yl extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,l,d,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,c,l,d,y)}emplace(e,i,s,c,l,d,y,w){const A=10*e,_=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=s,this.uint16[A+2]=c,this.uint16[A+3]=l,this.float32[_+2]=d,this.float32[_+3]=y,this.float32[_+4]=w,e}}Yl.prototype.bytesPerElement=20,Wt(Yl,"StructArrayLayout4ui3f20");class ju extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}ju.prototype.bytesPerElement=2,Wt(ju,"StructArrayLayout1i2");class qu extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}qu.prototype.bytesPerElement=1,Wt(qu,"StructArrayLayout1ub1");class df extends Nu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}df.prototype.size=40;class Gu extends of{get(e){return new df(this,e)}}Wt(Gu,"CollisionBoxArray");class td extends Nu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}td.prototype.size=60;class hp extends cf{get(e){return new td(this,e)}}Wt(hp,"PlacedSymbolArray");class dp extends Nu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}dp.prototype.size=80;class Tm extends Uu{get(e){return new dp(this,e)}}Wt(Tm,"SymbolInstanceArray");class Gc extends jc{getoffsetX(e){return this.float32[1*e+0]}}Wt(Gc,"GlyphOffsetArray");class ll extends Bo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Wt(ll,"SymbolLineVertexArray");class Wl extends Nu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Wl.prototype.size=12;class Ta extends Qh{get(e){return new Wl(this,e)}}Wt(Ta,"FeatureIndexArray");class Kl extends Fo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Wt(Kl,"FillExtrusionCentroidArray");class fp extends Nu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}fp.prototype.size=6;class pp extends Uc{get(e){return new fp(this,e)}}Wt(pp,"FillExtrusionWallArray");const Hu=wn([{name:"a_pos",components:2,type:"Int16"}],4),Sm=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class On{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,c){let l=this.segments[this.segments.length-1];return e>On.MAX_VERTEX_ARRAY_LENGTH&&Kn(`Max vertices per segment is ${On.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>On.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==c)&&(l={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},c!==void 0&&(l.sortKey=c),this.segments.push(l)),l}prepareSegment(e,i,s,c){return this._prepareSegment(e,i.length,s.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,c){return new On([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function po(a,e){return 256*(a=vt(Math.floor(a),0,255))+vt(Math.floor(e),0,255)}On.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt(On,"SegmentVector");const Vo=wn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Em=wn([{name:"a_dash",components:4,type:"Uint16"}]);class Ws{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,c){this.ids.push(mo(e)),this.positions.push(i,s,c)}eachPosition(e,i){const s=mo(e);let c=0,l=this.ids.length-1;for(;c<l;){const d=c+l>>1;this.ids[d]>=s?l=d:c=d+1}for(;this.ids[c]===s;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,i){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return jr(s,c,0,s.length-1),i&&(i.add(s.buffer),i.add(c.buffer)),{ids:s,positions:c}}static deserialize(e){const i=new Ws;let s;i.ids=e.ids,i.positions=e.positions;for(const c of i.ids)c!==s&&i.uniqueIds.push(c),s=c;return i.indexed=!0,i}}function mo(a){const e=+a;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:gs(String(a))}function jr(a,e,i,s){for(;i<s;){const c=a[i+s>>1];let l=i-1,d=s+1;for(;;){do l++;while(a[l]<c);do d--;while(a[d]>c);if(l>=d)break;Hc(a,l,d),Hc(e,3*l,3*d),Hc(e,3*l+1,3*d+1),Hc(e,3*l+2,3*d+2)}d-i<s-d?(jr(a,e,i,d),i=d+1):(jr(a,e,d+1,s),s=d)}}function Hc(a,e,i){const s=a[e];a[e]=a[i],a[i]=s}Wt(Ws,"FeaturePositionMap");class Ks{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Zc extends Ks{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Tr extends Ks{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class zs extends Ks{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Js extends Ks{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Jl extends Ks{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class mp extends Ks{constructor(e){super(e),this.current=Mn.transparent.toRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const _p=new Float32Array(16);class Zu extends Ks{constructor(e){super(e),this.current=_p}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const $u=new Float32Array(9),Am=new Float32Array(4);class id extends Ks{constructor(e){super(e),this.current=Am}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function ff(a){return[po(255*a.r,255*a.g),po(255*a.b,255*a.a)]}class Xu{constructor(e,i,s,c){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=s,this.context=c}setUniform(e,i,s,c,l){const d=c.constantOr(this.value);i.set(e,l,d instanceof Mn?d.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):d)}getBinding(e,i){return this.type==="color"?new mp(e):new Tr(e)}}class $c{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,c,l){const d=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,l,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Jl(e):new Tr(e)}}class Uo{constructor(e,i,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,s,c,l,d,y){const w=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ln(0,{brightness:d}),i,{},l,c,y):this.expression.kind==="constant"&&this.expression.value,_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Ln(0,{brightness:d}),i,{},l,c,y):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(w,e,A,_?null:this.context.lut)}updatePaintArray(e,i,s,c,l,d,y){const w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y},s,c,void 0,l):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Ln(0,{brightness:y}),s,c,void 0,l):this.lutExpression.value)==="none";this._setPaintValue(e,i,w,A?null:this.context.lut)}_setPaintValue(e,i,s,c){if(this.type==="color"){const l=ff(s.toRenderColor(c));for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yr{constructor(e,i,s,c,l,d){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=c,this.context=l,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,s,c,l,d,y){const w=this.expression.evaluate(new Ln(this.context.zoom,{brightness:d}),i,{},l,c,y),A=this.expression.evaluate(new Ln(this.context.zoom+1,{brightness:d}),i,{},l,c,y),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Ln(0,{brightness:d}),i,{},l,c,y):this.lutExpression.value)==="none",T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,w,A,_?null:this.context.lut)}updatePaintArray(e,i,s,c,l,d,y){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:y},s,c,void 0,l),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y},s,c,void 0,l),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Ln(0,{brightness:y}),s,c,void 0,l):this.lutExpression.value)==="none";this._setPaintValue(e,i,w,A,_?null:this.context.lut)}_setPaintValue(e,i,s,c,l){if(this.type==="color"){const d=ff(s.toRenderColor(l)),y=ff(s.toRenderColor(l));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,d[0],d[1],y[0],y[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,c,l){const d=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=vt(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);i.set(e,l,y)}getBinding(e,i){return new Tr(e)}}class kr{constructor(e,i,s,c,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(s==="array"?Em:Vo).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new c}populatePaintArray(e,i,s,c){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,c,l,d,y){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(e,i,s,c){if(!c||!s)return;const l=c[s];if(!l)return;const{tl:d,br:y,pixelRatio:w}=l;for(let A=e;A<i;A++)this.paintVertexArray.emplace(A,d[0],d[1],y[0],y[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ql{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[],this.context=i;const c=[];for(const l in e.paint._values){const d=e.paint.get(l);if(l.endsWith("-use-theme")||!s(l)||!(d instanceof ql&&Dc(d.property.specification)))continue;const y=Cm(l,e.type),w=d.value,A=d.property.specification.type,_=!!d.property.useIntegerZoom,T=l==="line-dasharray"||l.endsWith("pattern"),C=e.paint.get(`${l}-use-theme`),E=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||C&&C.value.kind!=="constant";if(w.kind!=="constant"||E)if(w.kind==="source"||E||T){const M=pf(l,A,"source");this.binders[l]=T?new kr(w,y,A,M,e.id):new Uo(w,y,A,M),c.push(`/a_${l}`)}else{const M=pf(l,A,"composite");this.binders[l]=new yr(w,y,A,_,i,M),c.push(`/z_${l}`)}else this.binders[l]=T?new $c(w.value,y):new Xu(w.value,y,A,i),c.push(`/u_${l}`);C&&(this.binders[l].lutExpression=C.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Uo||i instanceof yr?i.maxValue:0}populatePaintArrays(e,i,s,c,l,d,y){for(const w in this.binders){const A=this.binders[w];A.context=this.context,(A instanceof Uo||A instanceof yr||A instanceof kr)&&A.populatePaintArray(e,i,s,c,l,d,y)}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof $c&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,c,l,d,y,w,A){let _=!1;const T=Object.keys(e),C=T.length!==0&&!w,E=C?T:i.uniqueIds;this.context.lut=l.lut;for(const M in this.binders){const z=this.binders[M];if(z.context=this.context,(z instanceof Uo||z instanceof yr||z instanceof kr)&&z.expression&&z.expression.kind&&z.expression.kind!=="constant"&&(z.expression.isStateDependent===!0||z.expression.isLightConstant===!1)){const N=l.paint.get(M);z.expression=N.value;for(const V of E){const Z=e[V.toString()];i.eachPosition(V,(H,q,Y)=>{const K=c.feature(H);z.updatePaintArray(q,Y,K,Z,d,y,A)})}if(!C)for(const V of s.uniqueIds){const Z=e[V.toString()];s.eachPosition(V,(H,q,Y)=>{const K=c.feature(H);z.updatePaintArray(q,Y,K,Z,d,y,A)})}_=!0}}return _}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Xu||s instanceof $c)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Uo||s instanceof yr||s instanceof kr)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Xu||s instanceof $c||s instanceof yr)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Xu||c instanceof $c||c instanceof yr)for(const l of c.uniformNames)i.push({name:l,property:s,binding:c.getBinding(e,l)})}return i}setUniforms(e,i,s,c,l){for(const{name:d,property:y,binding:w}of s)this.binders[y].setUniform(e,w,l,c.get(y),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Uo||i instanceof yr||i instanceof kr)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Uo||s instanceof yr||s instanceof kr)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Uo||i instanceof yr||i instanceof kr)&&i.destroy()}}}class cl{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Ql(c,i,s);this.needsUpload=!1,this._featureMap=new Ws,this._featureMapWithoutIds=new Ws,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,c,l,d,y,w){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,i,c,l,d,y,w);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,c,l,d,y){for(const w of s)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,w,c,l,d,y||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Mm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Cm(a,e){return Mm[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}const Im={"line-pattern":{source:Ys,composite:Ys},"fill-pattern":{source:Ys,composite:Ys},"fill-extrusion-pattern":{source:Ys,composite:Ys},"line-dasharray":{source:Xh,composite:Xh}},Xc={color:{source:qc,composite:Xl},number:{source:jc,composite:qc}};function pf(a,e,i){const s=Im[a];return s&&s[i]||Xc[e][i]}Wt(Xu,"ConstantBinder"),Wt($c,"PatternConstantBinder"),Wt(Uo,"SourceExpressionBinder"),Wt(kr,"PatternCompositeBinder"),Wt(yr,"CompositeExpressionBinder"),Wt(Ql,"ProgramConfiguration",{omit:["_buffers"]}),Wt(cl,"ProgramConfigurationSet");const La=Bt/Math.PI/2,Yc=5,gp=6,mf=16383,ec=64,Yu=[ec,32,16],bs=-La,as=La;function ul(a,e,i,s=La){return i=ln(i),[a*Math.sin(i)*s,-e*s,a*Math.cos(i)*s]}function hl(a,e,i){return ul(Math.cos(ln(a)),Math.sin(ln(a)),e,i)}const tc=63710088e-1,nd=2*Math.PI*tc;class Tn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tn(gi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,c=e.lat*i,l=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return tc*Math.acos(Math.min(l,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new Ga({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return hl(this.lat,this.lng,La+e*La/tc)}static convert(e){if(e instanceof Tn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Tn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Tn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ga{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof Tn?new Tn(e.lng,e.lat):Tn.convert(e),this}setSouthWest(e){return this._sw=e instanceof Tn?new Tn(e.lng,e.lat):Tn.convert(e),this}extend(e){const i=this._sw,s=this._ne;let c,l;if(e instanceof Tn)c=e,l=e;else{if(!(e instanceof Ga))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ga.convert(e)):this.extend(Tn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Tn.convert(e)):this;if(c=e._sw,l=e._ne,!c||!l)return this}return i||s?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),s.lng=Math.max(l.lng,s.lng),s.lat=Math.max(l.lat,s.lat)):(this._sw=new Tn(c.lng,c.lat),this._ne=new Tn(l.lng,l.lat)),this}getCenter(){return new Tn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Tn(this.getWest(),this.getNorth())}getSouthEast(){return new Tn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Tn.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){if(e)return e instanceof Ga?e:new Ga(e)}}const yp=0,G_=25.5;function rd(a){return nd*Math.cos(a*Math.PI/180)}function Sa(a){return(180+a)/360}function ss(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Qr(a,e){return a/rd(e)}function Ea(a){return 360*a-180}function Vn(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function vp(a,e){return a*rd(Vn(e))}const os=85.051129;function xp(a){return Math.cos(ln(vt(a,-85.051129,os)))}function Qs(a,e){const i=vt(e,yp,G_),s=Math.pow(2,i);return xp(a)*nd/(512*s)}function ic(a){return 1/Math.cos(a*Math.PI/180)}function h(a,e=0){const i=Math.exp(Math.PI*(1-(a.y+e/Bt)/(1<<a.z)*2));return 80150034*i/(i*i+1)/Bt/(1<<a.z)}class t{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Tn.convert(e);return new t(Sa(s.lng),ss(s.lat),Qr(i,s.lat))}toLngLat(){return new Tn(Ea(this.x),Vn(this.y))}toAltitude(){return vp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/nd*ic(Vn(this.y))}}function n(a,e,i,s,c,l,d,y,w){const A=(e+s)/2,_=(i+c)/2,T=new Ft(A,_);y(T),function(C,E,M,z,N,V){const Z=M-N,H=z-V;return Math.abs((z-E)*Z-(M-C)*H)/Math.hypot(Z,H)}(T.x,T.y,l.x,l.y,d.x,d.y)>=w?(n(a,e,i,A,_,l,T,y,w),n(a,A,_,s,c,T,d,y,w)):a.push(d)}function u(a,e,i){let s=a[0],c=s.x,l=s.y;e(s);const d=[s];for(let y=1;y<a.length;y++){const w=a[y],{x:A,y:_}=w;e(w),n(d,c,l,A,_,s,w,e,i),c=A,l=_,s=w}return d}function p(a,e,i,s){if(s(e,i)){const c=e.add(i)._mult(.5);p(a,e,c,s),p(a,c,i,s)}else a.push(i)}function g(a,e){let i=a[0];const s=[i];for(let c=1;c<a.length;c++){const l=a[c];p(s,i,l,e),i=l}return s}const b=Math.pow(2,14)-1,I=-b-1;function L(a,e){const i=Math.round(a.x*e),s=Math.round(a.y*e);return a.x=vt(i,I,b),a.y=vt(s,I,b),(i<a.x||i>a.x+1||s<a.y||s>a.y+1)&&Kn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function P(a,e,i){const s=a.loadGeometry(),c=a.extent,l=Bt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:y,x:w,y:A,projection:_}=i,T=C=>{const E=Ea((e.x+C.x/c)/d),M=Vn((e.y+C.y/c)/d),z=_.project(E,M);C.x=(z.x*y-w)*c,C.y=(z.y*y-A)*c};for(let C=0;C<s.length;C++)if(a.type!==1)s[C]=u(s[C],T,1);else{const E=[];for(const M of s[C])M.x<0||M.x>=c||M.y<0||M.y>=c||(T(M),E.push(M));s[C]=E}}for(const d of s)for(const y of d)L(y,l);return s}function k(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?P(a):[]}}function U(a,e,i,s,c){a.emplaceBack(2*e+(s+1)/2,2*i+(c+1)/2)}function j(a,e,i){a.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ${constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Bo,this.indexArray=new ca,this.segments=new On,this.programConfigurations=new cl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,s,c){const l=this.layers[0],d=[];let y=null;l.type==="circle"&&(y=l.layout.get("circle-sort-key"));for(const{feature:A,id:_,index:T,sourceLayerIndex:C}of e){const E=this.layers[0]._featureFilter.needGeometry,M=k(A,E);if(!this.layers[0]._featureFilter.filter(new Ln(this.zoom),M,s))continue;const z=y?y.evaluate(M,{},s):void 0,N={id:_,properties:A.properties,type:A.type,sourceLayerIndex:C,index:T,geometry:E?M.geometry:P(A,s,c),patterns:{},sortKey:z};d.push(N)}y&&d.sort((A,_)=>A.sortKey-_.sortKey);let w=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Yh,w=c.projection);for(const A of d){const{geometry:_,index:T,sourceLayerIndex:C}=A,E=e[T].feature;this.addFeature(A,_,T,i.availableImages,s,w,i.brightness),i.featureIndex.insert(E,_,T,C,this.index)}}update(e,i,s,c,l,d,y){this.programConfigurations.updatePaintArrays(e,i,l,s,c,d,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Sm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,c,l,d,y){for(const w of i)for(const A of w){const _=A.x,T=A.y;if(_<0||_>=Bt||T<0||T>=Bt)continue;if(d){const M=d.projectTilePoint(_,T,l),z=d.upVector(l,_,T),N=this.globeExtVertexArray;j(N,M,z),j(N,M,z),j(N,M,z),j(N,M,z)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=C.vertexLength;U(this.layoutVertexArray,_,T,-1,-1),U(this.layoutVertexArray,_,T,1,-1),U(this.layoutVertexArray,_,T,1,1),U(this.layoutVertexArray,_,T,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,l,y)}}function Q(a,e){for(let i=0;i<a.length;i++)if(ve(e,a[i]))return!0;for(let i=0;i<e.length;i++)if(ve(a,e[i]))return!0;return!!ce(a,e)}function W(a,e,i){return!!ve(a,e)||!!fe(e,a,i)}function te(a,e){if(a.length===1)return ye(e,a[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let c=0;c<s.length;c++)if(ve(a,s[c]))return!0}for(let i=0;i<a.length;i++)if(ye(e,a[i]))return!0;for(let i=0;i<e.length;i++)if(ce(a,e[i]))return!0;return!1}function ne(a,e,i){if(a.length>1){if(ce(a,e))return!0;for(let s=0;s<e.length;s++)if(fe(e[s],a,i))return!0}for(let s=0;s<a.length;s++)if(fe(a[s],e,i))return!0;return!1}function ce(a,e){if(a.length===0||e.length===0)return!1;for(let i=0;i<a.length-1;i++){const s=a[i],c=a[i+1];for(let l=0;l<e.length-1;l++)if(me(s,c,e[l],e[l+1]))return!0}return!1}function me(a,e,i,s){return Nn(a,i,s)!==Nn(e,i,s)&&Nn(a,e,i)!==Nn(a,e,s)}function fe(a,e,i){const s=i*i;if(e.length===1)return a.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(we(a,e[c-1],e[c])<s)return!0;return!1}function we(a,e,i){const s=e.distSqr(i);if(s===0)return a.distSqr(e);const c=((a.x-e.x)*(i.x-e.x)+(a.y-e.y)*(i.y-e.y))/s;return a.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function ye(a,e){let i,s,c,l=!1;for(let d=0;d<a.length;d++){i=a[d];for(let y=0,w=i.length-1;y<i.length;w=y++)s=i[y],c=i[w],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(l=!l)}return l}function ve(a,e){let i=!1;for(let s=0,c=a.length-1;s<a.length;c=s++){const l=a[s],d=a[c];l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(i=!i)}return i}function xe(a,e,i,s,c){for(const d of a)if(e<=d.x&&i<=d.y&&s>=d.x&&c>=d.y)return!0;const l=[new Ft(e,i),new Ft(e,c),new Ft(s,c),new Ft(s,i)];if(a.length>2){for(const d of l)if(ve(a,d))return!0}for(let d=0;d<a.length-1;d++)if(Se(a[d],a[d+1],l))return!0;return!1}function Se(a,e,i){const s=i[0],c=i[2];if(a.x<s.x&&e.x<s.x||a.x>c.x&&e.x>c.x||a.y<s.y&&e.y<s.y||a.y>c.y&&e.y>c.y)return!1;const l=Nn(a,e,i[0]);return l!==Nn(a,e,i[1])||l!==Nn(a,e,i[2])||l!==Nn(a,e,i[3])}function Ce(a,e,i,s,c,l){let d=e.y-a.y,y=a.x-e.x;if(l=l||0){const w=d*d+y*y;if(w===0)return!0;const A=Math.sqrt(w);d/=A,y/=A}return!((i.x-a.x)*d+(i.y-a.y)*y-l<0||(s.x-a.x)*d+(s.y-a.y)*y-l<0||(c.x-a.x)*d+(c.y-a.y)*y-l<0)}function Ke(a,e,i,s,c,l,d){return!(Ce(a,e,s,c,l,d)||Ce(e,i,s,c,l,d)||Ce(i,a,s,c,l,d)||Ce(s,c,a,e,i,d)||Ce(c,l,a,e,i,d)||Ce(l,s,a,e,i,d))}function Ge(a,e,i){const s=e.paint.get(a).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(a)}function ct(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function _t(a,e,i,s,c){if(!e[0]&&!e[1])return a;const l=Ft.convert(e)._mult(c);i==="viewport"&&l._rotate(-s);const d=[];for(let y=0;y<a.length;y++)d.push(a[y].sub(l));return d}function Ct(a,e,i,s){const c=Ft.convert(a)._mult(s);return e==="viewport"&&c._rotate(-i),c}let Ve,ut;Wt($,"CircleBucket",{omit:["layers"]});var Ne,ht={exports:{}},nt=(Ne||(Ne=1,function(a,e){(function(i){function s(l,d,y){var w=c(256*l,256*(d=Math.pow(2,y)-d-1),y),A=c(256*(l+1),256*(d+1),y);return w[0]+","+w[1]+","+A[0]+","+A[1]}function c(l,d,y){var w=2*Math.PI*6378137/256/Math.pow(2,y);return[l*w-2*Math.PI*6378137/2,d*w-2*Math.PI*6378137/2]}i.getURL=function(l,d,y,w,A,_){return _=_||{},l+"?"+["bbox="+s(y,w,A),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+d].join("&")},i.getTileBBox=s,i.getMercCoords=c,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,ht.exports)),ht.exports);class yt{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Vt(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=nt.getTileBBox(this.x,this.y,this.z),c=function(l,d,y){let w,A="";for(let _=l;_>0;_--)w=1<<_-1,A+=(d&w?1:0)+(y&w?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class et{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Vt(e,i.z,i.z,i.x,i.y)}}class gt{constructor(e,i,s,c,l){this.overscaledZ=e,this.wrap=i,this.canonical=new yt(s,+c,+l),this.key=i===0&&e===s?this.canonical.key:Vt(i,e,s,c,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new gt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gt(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Vt(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Vt(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new gt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new gt(i,this.wrap,i,s,c),new gt(i,this.wrap,i,s+1,c),new gt(i,this.wrap,i,s,c+1),new gt(i,this.wrap,i,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new gt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new gt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new et(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Vt(a,e,i,s,c){const l=1<<Math.min(i,22);let d=l*(c%l)+s%l;return a&&i<22&&(d+=l*l*((a<0?-2*a-1:2*a)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const Ut=[a=>{let e=a.canonical.x-1,i=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,i--),new gt(a.overscaledZ,i,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,i=a.wrap;return e===1<<a.canonical.z&&(e=0,i++),new gt(a.overscaledZ,i,a.canonical.z,e,a.canonical.y)},a=>new gt(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new gt(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Wt(yt,"CanonicalTileID"),Wt(gt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Gt=wn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:oi}=Gt,Di=wn([{name:"a_pos_3",components:3,type:"Int16"}]);var xi=wn([{name:"a_pos",type:"Int16",components:2}]);class Ri{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const c=de.vec2.dot(i,this.dir);if(Math.abs(c)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/c;return s[0]=this.pos[0]+this.dir[0]*l,s[1]=this.pos[1]+this.dir[1]*l,!0}}class Ci{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const c=de.vec3.dot(i,this.dir);if(Math.abs(c)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return s[0]=this.pos[0]+this.dir[0]*l,s[1]=this.pos[1]+this.dir[1]*l,s[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,s){if(de.vec3.equals(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[c,l,d]=this.dir,y=this.pos[0]-e[0],w=this.pos[1]-e[1],A=this.pos[2]-e[2],_=c*c+l*l+d*d,T=2*(y*c+w*l+A*d),C=T*T-4*_*(y*y+w*w+A*A-i*i);if(C<0){const E=Math.max(-T/2,0),M=y+c*E,z=w+l*E,N=A+d*E,V=Math.hypot(M,z,N);return s[0]=M*i/V,s[1]=z*i/V,s[2]=N*i/V,!1}{const E=(-T-Math.sqrt(C))/(2*_);if(E<0){const M=Math.hypot(y,w,A);return s[0]=y*i/M,s[1]=w*i/M,s[2]=A*i/M,!1}return s[0]=y+c*E,s[1]=w+l*E,s[2]=A+d*E,!0}}}class on{constructor(e,i,s,c,l){this.TL=e,this.TR=i,this.BR=s,this.BL=c,this.horizon=l}static fromInvProjectionMatrix(e,i,s){const c=[-1,1,1],l=[1,1,1],d=[1,-1,1],y=[-1,-1,1],w=de.vec3.transformMat4(c,c,e),A=de.vec3.transformMat4(l,l,e),_=de.vec3.transformMat4(d,d,e),T=de.vec3.transformMat4(y,y,e);return new on(w,A,_,T,i/s)}}function Sn(a,e,i){let s=1/0,c=-1/0;const l=[];for(const d of a){de.vec3.sub(l,d,e);const y=de.vec3.dot(l,i);s=Math.min(s,y),c=Math.max(c,y)}return[s,c]}function Gi(a,e){let i=!0;for(let s=0;s<a.planes.length;s++){const c=a.planes[s];let l=0;for(let d=0;d<e.length;d++)l+=de.vec3.dot(c,e[d])+c[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function Ti(a,e){for(const i of a.projections){const s=Sn(e,a.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Fi(a,e){let i=0;const s=[0,0,0,0];for(let c=0;c<a.length;c++)s[0]=a[c][0],s[1]=a[c][1],s[2]=a[c][2],s[3]=1,de.vec4.dot(s,e)>=0&&i++;return i}class li{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=jt.fromPoints(this.points),this.projections=[],this.frustumEdges=[de.vec3.sub([],this.points[2],this.points[3]),de.vec3.sub([],this.points[0],this.points[3]),de.vec3.sub([],this.points[4],this.points[0]),de.vec3.sub([],this.points[5],this.points[1]),de.vec3.sub([],this.points[6],this.points[2]),de.vec3.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const c=[0,-s[2],s[1]],l=[s[2],0,-s[0]];this.projections.push({axis:c,projection:Sn(this.points,this.points[0],c)}),this.projections.push({axis:l,projection:Sn(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,s,c){const l=Math.pow(2,s),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const _=de.vec4.transformMat4([],A,e),T=1/_[3]/i*l;return de.vec4.mul(_,_,[T,T,c?1/_[3]:T,T])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const _=de.vec3.sub([],d[A[0]],d[A[1]]),T=de.vec3.sub([],d[A[2]],d[A[1]]),C=de.vec3.normalize([],de.vec3.cross([],_,T)),E=-de.vec3.dot(C,d[A[1]]);return C.concat(E)}),w=[];for(let A=0;A<d.length;A++)w.push([d[A][0],d[A][1],d[A][2]]);return new li(w,y)}intersectsPrecise(e,i,s){for(let c=0;c<i.length;c++)if(!Fi(e,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!Fi(e,this.planes[c]))return 0;for(const c of s)for(const l of this.frustumEdges){const d=de.vec3.cross([],c,l),y=de.vec3.length(d);if(y===0)continue;de.vec3.scale(d,d,1/y);const w=Sn(this.points,this.points[0],d),A=Sn(e,this.points[0],d);if(w[0]>A[1]||A[0]>w[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(de.vec3.dot([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class jt{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const c of e)de.vec3.min(i,i,c),de.vec3.max(s,s,c);return new jt(i,s)}static fromTileIdAndHeight(e,i,s){const c=1<<e.canonical.z,l=e.canonical.x,d=e.canonical.y;return new jt([l/c,d/c,i],[(l+1)/c,(d+1)/c,s])}static applyTransform(e,i){const s=e.getCorners();for(let c=0;c<s.length;++c)de.vec3.transformMat4(s[c],s[c],i);return jt.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],c=[...s];for(let l=0;l<3;l++)for(let d=0;d<3;d++){const y=i[4*d+l],w=y*e.min[d],A=y*e.max[d];s[l]+=Math.min(w,A),c[l]+=Math.max(w,A)}return new jt(s,c)}static projectAabbCorners(e,i){const s=e.getCorners();for(let c=0;c<s.length;++c)de.vec3.transformMat4(s[c],s[c],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=de.vec3.scale([],de.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=de.vec3.clone(this.min),c=de.vec3.clone(this.max);for(let l=0;l<i.length;l++)s[l]=i[l]?this.min[l]:this.center[l],c[l]=i[l]?this.center[l]:this.max[l];return c[2]=this.max[2],new jt(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Gi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Gi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ti(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ti(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Hi(a){return a*La/tc}Wt(jt,"Aabb");const pn=[new jt([bs,bs,bs],[as,as,as]),new jt([bs,bs,bs],[0,0,as]),new jt([0,bs,bs],[as,0,as]),new jt([bs,0,bs],[0,as,as]),new jt([0,0,bs],[as,as,as])];function hn(a,e,i,s=!0){const c=de.vec3.scale([],a._camera.position,a.worldSize),l=[e,i,1,1];de.vec4.transformMat4(l,l,a.pixelMatrixInverse),de.vec4.scale(l,l,1/l[3]);const d=de.vec3.sub([],l,c),y=de.vec3.normalize([],d),w=a.globeMatrix,A=[w[12],w[13],w[14]],_=de.vec3.sub([],A,c),T=de.vec3.length(_),C=de.vec3.normalize([],_),E=a.worldSize/(2*Math.PI),M=de.vec3.dot(C,y),z=Math.asin(E/T);if(z<Math.acos(M)){if(!s)return null;const Te=[],pe=[];de.vec3.scale(Te,y,T/M),de.vec3.normalize(pe,de.vec3.sub(pe,Te,_)),de.vec3.normalize(y,de.vec3.add(y,_,de.vec3.scale(y,pe,Math.tan(z)*T)))}const N=[];new Ci(c,y).closestPointOnSphere(A,E,N);const V=de.vec3.normalize([],fc(w,0)),Z=de.vec3.normalize([],fc(w,1)),H=de.vec3.normalize([],fc(w,2)),q=de.vec3.dot(V,N),Y=de.vec3.dot(Z,N),K=de.vec3.dot(H,N),ee=Br(Math.asin(-Y/E));let he=Br(Math.atan2(q,K));he=a.center.lng+function(Te,pe){const Ee=(pe-Te+180)%360-180;return Ee<-180?Ee+360:Ee}(a.center.lng,he);const le=Sa(he),ue=vt(ss(ee),0,1);return new t(le,ue)}class hr{constructor(e,i,s){this.a=de.vec3.sub([],e,s),this.b=de.vec3.sub([],i,s),this.center=s;const c=de.vec3.normalize([],this.a),l=de.vec3.normalize([],this.b);this.angle=Math.acos(de.vec3.dot(c,l))}}function rr(a,e){if(a.angle===0)return null;let i;return i=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),i<0||i>1?null:function(s,c,l,d){const y=Math.sin(l);return s*(Math.sin((1-d)*l)/y)+c*(Math.sin(d*l)/y)}(a.a[e],a.b[e],a.angle,vt(i,0,1))+a.center[e]}function Pn(a){if(a.z<=1)return pn[a.z+2*a.y+a.x];const e=Zn(Ki(a));return jt.fromPoints(e)}function vr(a,e,i){return de.vec3.scale(a,a,1-i),de.vec3.scaleAndAdd(a,a,e,i)}function fa(a,e,i){for(const s of a)de.vec3.transformMat4(s,s,e),de.vec3.scale(s,s,i)}function pa(a,e,i,s){const c=e/a.worldSize,l=a.globeMatrix;if(i.z<=1){const le=Pn(i).getCorners();return fa(le,l,c),jt.fromPoints(le)}const d=Ki(i,s),y=Zn(d,La+Hi(a._tileCoverLift));fa(y,l,c);const w=Number.MAX_VALUE,A=[-w,-w,-w],_=[w,w,w];if(d.contains(a.center)){for(const Te of y)de.vec3.min(_,_,Te),de.vec3.max(A,A,Te);A[2]=0;const le=a.point,ue=[le.x*c,le.y*c,0];return de.vec3.min(_,_,ue),de.vec3.max(A,A,ue),new jt(_,A)}if(a._tileCoverLift>0){for(const le of y)de.vec3.min(_,_,le),de.vec3.max(A,A,le);return new jt(_,A)}const T=[l[12]*c,l[13]*c,l[14]*c],C=d.getCenter(),E=vt(a.center.lat,-85.051129,os),M=vt(C.lat,-85.051129,os),z=Sa(a.center.lng),N=ss(E);let V=z-Sa(C.lng);const Z=N-ss(M);V>.5?V-=1:V<-.5&&(V+=1);let H=0;if(Math.abs(V)>Math.abs(Z))H=V>=0?1:3;else{H=Z>=0?0:2;const le=[l[4]*c,l[5]*c,l[6]*c],ue=-Math.sin(ln(Z>=0?d.getSouth():d.getNorth()))*La;de.vec3.scaleAndAdd(T,T,le,ue)}const q=y[H],Y=y[(H+1)%4],K=new hr(q,Y,T),ee=[rr(K,0)||q[0],rr(K,1)||q[1],rr(K,2)||q[2]],he=$r(a.zoom);if(he>0){const le=function({x:Te,y:pe,z:Ee},De,Re,ke,Pe){const Ze=1/(1<<Ee);let Ue=Te*Ze,Xe=Ue+Ze,bt=pe*Ze,xt=bt+Ze,ei=0;const zt=(Ue+Xe)/2-ke;return zt>.5?ei=-1:zt<-.5&&(ei=1),Ue=((Ue+ei)*De-(ke*=De))*Re+ke,Xe=((Xe+ei)*De-ke)*Re+ke,bt=(bt*De-(Pe*=De))*Re+Pe,xt=(xt*De-Pe)*Re+Pe,[[Ue,xt,0],[Xe,xt,0],[Xe,bt,0],[Ue,bt,0]]}(i,e,a._pixelsPerMercatorPixel,z,N);for(let Te=0;Te<y.length;Te++)vr(y[Te],le[Te],he);const ue=de.vec3.add([],le[H],le[(H+1)%4]);de.vec3.scale(ue,ue,.5),vr(ee,ue,he)}for(const le of y)de.vec3.min(_,_,le),de.vec3.max(A,A,le);return _[2]=Math.min(q[2],Y[2]),de.vec3.min(_,_,ee),de.vec3.max(A,A,ee),new jt(_,A)}function Ki({x:a,y:e,z:i},s=!1){const c=1/(1<<i),l=new Tn(Ea(a*c),e===(1<<i)-1&&s?-90:Vn((e+1)*c)),d=new Tn(Ea((a+1)*c),e===0&&s?90:Vn(e*c));return new Ga(l,d)}function Zn(a,e=La){const i=ln(a.getNorth()),s=ln(a.getSouth()),c=Math.cos(i),l=Math.cos(s),d=Math.sin(i),y=Math.sin(s),w=a.getWest(),A=a.getEast();return[ul(l,y,w,e),ul(l,y,A,e),ul(c,d,A,e),ul(c,d,w,e)]}function mn(a,e,i,s){const c=1<<i.z,l=(a/Bt+i.x)/c;return hl(Vn((e/Bt+i.y)/c),Ea(l),s)}function fn({min:a,max:e}){return mf/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}const ea=new Float64Array(16);function Qn(a){const e=fn(a),i=de.mat4.fromScaling(ea,[e,e,e]);return de.mat4.translate(i,i,de.vec3.negate([],a.min))}function Dr(a){const e=de.mat4.fromTranslation(ea,a.min),i=1/fn(a);return de.mat4.scale(e,e,[i,i,i])}function Ls(a){const e=Bt/(2*Math.PI);return a/(2*Math.PI)/e}function ta(a,e){return Bt/(512*Math.pow(2,a))*fn(Pn(e))}function xr(a,e,i,s,c){const l=Ls(i),d=[a,e,-i/(2*Math.PI)],y=de.mat4.identity(new Float64Array(16));return de.mat4.translate(y,y,d),de.mat4.scale(y,y,[l,l,l]),de.mat4.rotateX(y,y,ln(-c)),de.mat4.rotateY(y,y,ln(-s)),y}function $r(a){return bi(Yc,gp,a)}function Oa(a,e){const i=hl(e.lat,e.lng),s=function(l){const d=hl(l._center.lat,l._center.lng),y=de.vec3.fromValues(0,1,0);let w=de.vec3.cross([],y,d);const A=de.mat4.fromRotation([],-l.angle,d);w=de.vec3.transformMat4(w,w,A),de.mat4.fromRotation(A,-l._pitch,w);const _=de.vec3.normalize([],d);return de.vec3.scale(_,_,Hi(l.cameraToCenterDistance/l.pixelsPerMeter)),de.vec3.transformMat4(_,_,A),de.vec3.add([],d,_)}(a),c=de.vec3.subtract([],s,i);return de.vec3.angle(c,i)}function ma(a,e){return Oa(a,e)>Math.PI/2*1.01}const _o=ln(85),eo=Math.cos(_o),jo=Math.sin(_o),Wc=de.mat4.create(),nc=a=>{const e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ha(a,e,i,s,c,l,d,y,w){if(l&&a.queryGeometry.isAboveHorizon)return!1;l&&(w*=a.pixelToTileUnitsFactor);const A=a.tileID.canonical,_=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const T of e)for(const C of T){const E=C.add(y),M=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(E.x,E.y,!0):0,z=i.projection.projectTilePoint(E.x,E.y,A);if(M>0){const H=i.projection.upVector(A,E.x,E.y);z.x+=H[0]*_*M,z.y+=H[1]*_*M,z.z+=H[2]*_*M}const N=l?E:_f(z.x,z.y,z.z,s),V=l?a.tilespaceRays.map(H=>wy(H,M)):a.queryGeometry.screenGeometry,Z=de.vec4.transformMat4([],[z.x,z.y,z.z,1],s);if(!d&&l?w*=Z[3]/i.cameraToCenterDistance:d&&!l&&(w*=i.cameraToCenterDistance/Z[3]),l){const H=Vn((C.y/Bt+A.y)/(1<<A.z));w/=i.projection.pixelsPerMeter(H,1)/Qr(1,H)}if(W(V,N,w))return!0}return!1}function _f(a,e,i,s){const c=de.vec4.transformMat4([],[a,e,i,1],s);return new Ft(c[0]/c[3],c[1]/c[3])}const to=de.vec3.fromValues(0,0,0),by=de.vec3.fromValues(0,0,1);function wy(a,e){const i=de.vec3.create();return to[2]=e,a.intersectsPlane(to,by,i),new Ft(i[0],i[1])}class Ty extends ${}let Kc,bp,Rm,ad;function H_(a,{width:e,height:i},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*s);return a.width=e,a.height=i,a.data=c,a}function Z_(a,e,i){const{width:s,height:c}=e;s===a.width&&c===a.height||(Dm(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,s),height:Math.min(a.height,c)},i,null),a.width=s,a.height=c,a.data=e.data)}function Dm(a,e,i,s,c,l,d,y){if(c.width===0||c.height===0)return e;if(c.width>a.width||c.height>a.height||i.x>a.width-c.width||i.y>a.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const w=a.data,A=e.data,_=l===4&&y;for(let T=0;T<c.height;T++){const C=((i.y+T)*a.width+i.x)*l,E=((s.y+T)*e.width+s.x)*l;if(_)for(let M=0;M<c.width;M++){const z=C+M*l+3,N=E+M*l;A[N+0]=255,A[N+1]=255,A[N+2]=255,A[N+3]=w[z]}else if(d)for(let M=0;M<c.width;M++){const z=C+M*l,N=E+M*l,V=w[z+3],Z=new Mn(w[z+0]/255*V,w[z+1]/255*V,w[z+2]/255*V,V).toRenderColor(d).toArray();A[N+0]=Z[0],A[N+1]=Z[1],A[N+2]=Z[2],A[N+3]=Z[3]}else for(let M=0;M<c.width*l;M++)A[E+M]=w[C+M]}return e}Wt(Ty,"HeatmapBucket",{omit:["layers"]});class rc{constructor(e,i){H_(this,e,1,i)}resize(e){Z_(this,new rc(e),1)}clone(){return new rc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,c,l){Dm(e,i,s,c,l,1,null)}}class ua{constructor(e,i){H_(this,e,4,i)}resize(e){Z_(this,new ua(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ua({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,c,l,d,y){Dm(e,i,s,c,l,4,d,y)}}class Sy{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function wp(a){const e={},i=a.resolution||256,s=a.clips?a.clips.length:1,c=a.image||new ua({width:i,height:s}),l=(d,y,w)=>{e[a.evaluationKey]=w;const A=a.expression.evaluate(e);A&&(c.data[d+y+0]=Math.floor(255*A.r/A.a),c.data[d+y+1]=Math.floor(255*A.g/A.a),c.data[d+y+2]=Math.floor(255*A.b/A.a),c.data[d+y+3]=Math.floor(255*A.a))};if(a.clips)for(let d=0,y=0;d<s;++d,y+=4*i)for(let w=0,A=0;w<i;w++,A+=4){const _=w/(i-1),{start:T,end:C}=a.clips[d];l(y,A,T*(1-_)+C*_)}else for(let d=0,y=0;d<i;d++,y+=4)l(0,y,d/(i-1));return c}Wt(rc,"AlphaImage"),Wt(ua,"RGBAImage");const E0=wn([{name:"a_pos",components:2,type:"Int16"}],4),Ey=wn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Ay=wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),gf=wn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Wu(a,e,i=2){const s=e&&e.length,c=s?e[0]*i:a.length;let l=$_(a,0,c,i,!0);const d=[];if(!l||l.next===l.prev)return d;let y,w,A;if(s&&(l=function(_,T,C,E){const M=[];for(let z=0,N=T.length;z<N;z++){const V=$_(_,T[z]*E,z<N-1?T[z+1]*E:_.length,E,!1);V===V.next&&(V.steiner=!0),M.push(A0(V))}M.sort(Ry);for(let z=0;z<M.length;z++)C=Dy(M[z],C);return C}(a,e,l,i)),a.length>80*i){y=1/0,w=1/0;let _=-1/0,T=-1/0;for(let C=i;C<c;C+=i){const E=a[C],M=a[C+1];E<y&&(y=E),M<w&&(w=M),E>_&&(_=E),M>T&&(T=M)}A=Math.max(_-y,T-w),A=A!==0?32767/A:0}return yf(l,d,i,y,w,A,0),d}function $_(a,e,i,s,c){let l;if(c===function(d,y,w,A){let _=0;for(let T=y,C=w-A;T<w;T+=A)_+=(d[C]-d[T])*(d[T+1]+d[C+1]),C=T;return _}(a,e,i,s)>0)for(let d=e;d<i;d+=s)l=Qu(d/s|0,a[d],a[d+1],l);else for(let d=i-s;d>=e;d-=s)l=Qu(d/s|0,a[d],a[d+1],l);return l&&Lm(l,l.next)&&(io(l),l=l.next),l}function Ku(a,e){if(!a)return a;e||(e=a);let i,s=a;do if(i=!1,s.steiner||!Lm(s,s.next)&&ia(s.prev,s,s.next)!==0)s=s.next;else{if(io(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function yf(a,e,i,s,c,l,d){if(!a)return;!d&&l&&function(w,A,_,T){let C=w;do C.z===0&&(C.z=Tp(C.x,C.y,A,_,T)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==w);C.prevZ.nextZ=null,C.prevZ=null,function(E){let M,z=1;do{let N,V=E;E=null;let Z=null;for(M=0;V;){M++;let H=V,q=0;for(let K=0;K<z&&(q++,H=H.nextZ,H);K++);let Y=z;for(;q>0||Y>0&&H;)q!==0&&(Y===0||!H||V.z<=H.z)?(N=V,V=V.nextZ,q--):(N=H,H=H.nextZ,Y--),Z?Z.nextZ=N:E=N,N.prevZ=Z,Z=N;V=H}Z.nextZ=null,z*=2}while(M>1)}(C)}(a,s,c,l);let y=a;for(;a.prev!==a.next;){const w=a.prev,A=a.next;if(l?Cy(a,s,c,l):My(a))e.push(w.i,a.i,A.i),io(a),a=A.next,y=A.next;else if((a=A)===y){d?d===1?yf(a=Iy(Ku(a),e),e,i,s,c,l,2):d===2&&zm(a,e,i,s,c,l):yf(Ku(a),e,i,s,c,l,1);break}}}function My(a){const e=a.prev,i=a,s=a.next;if(ia(e,i,s)>=0)return!1;const c=e.x,l=i.x,d=s.x,y=e.y,w=i.y,A=s.y,_=c<l?c<d?c:d:l<d?l:d,T=y<w?y<A?y:A:w<A?w:A,C=c>l?c>d?c:d:l>d?l:d,E=y>w?y>A?y:A:w>A?w:A;let M=s.next;for(;M!==e;){if(M.x>=_&&M.x<=C&&M.y>=T&&M.y<=E&&sd(c,y,l,w,d,A,M.x,M.y)&&ia(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function Cy(a,e,i,s){const c=a.prev,l=a,d=a.next;if(ia(c,l,d)>=0)return!1;const y=c.x,w=l.x,A=d.x,_=c.y,T=l.y,C=d.y,E=y<w?y<A?y:A:w<A?w:A,M=_<T?_<C?_:C:T<C?T:C,z=y>w?y>A?y:A:w>A?w:A,N=_>T?_>C?_:C:T>C?T:C,V=Tp(E,M,e,i,s),Z=Tp(z,N,e,i,s);let H=a.prevZ,q=a.nextZ;for(;H&&H.z>=V&&q&&q.z<=Z;){if(H.x>=E&&H.x<=z&&H.y>=M&&H.y<=N&&H!==c&&H!==d&&sd(y,_,w,T,A,C,H.x,H.y)&&ia(H.prev,H,H.next)>=0||(H=H.prevZ,q.x>=E&&q.x<=z&&q.y>=M&&q.y<=N&&q!==c&&q!==d&&sd(y,_,w,T,A,C,q.x,q.y)&&ia(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;H&&H.z>=V;){if(H.x>=E&&H.x<=z&&H.y>=M&&H.y<=N&&H!==c&&H!==d&&sd(y,_,w,T,A,C,H.x,H.y)&&ia(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;q&&q.z<=Z;){if(q.x>=E&&q.x<=z&&q.y>=M&&q.y<=N&&q!==c&&q!==d&&sd(y,_,w,T,A,C,q.x,q.y)&&ia(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function Iy(a,e){let i=a;do{const s=i.prev,c=i.next.next;!Lm(s,c)&&Sp(s,i,i.next,c)&&Ju(s,c)&&Ju(c,s)&&(e.push(s.i,i.i,c.i),io(i),io(i.next),i=a=c),i=i.next}while(i!==a);return Ku(i)}function zm(a,e,i,s,c,l){let d=a;do{let y=d.next.next;for(;y!==d.prev;){if(d.i!==y.i&&M0(d,y)){let w=Om(d,y);return d=Ku(d,d.next),w=Ku(w,w.next),yf(d,e,i,s,c,l,0),void yf(w,e,i,s,c,l,0)}y=y.next}d=d.next}while(d!==a)}function Ry(a,e){return a.x-e.x}function Dy(a,e){const i=function(c,l){let d=l;const y=c.x,w=c.y;let A,_=-1/0;do{if(w<=d.y&&w>=d.next.y&&d.next.y!==d.y){const z=d.x+(w-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(z<=y&&z>_&&(_=z,A=d.x<d.next.x?d:d.next,z===y))return A}d=d.next}while(d!==l);if(!A)return null;const T=A,C=A.x,E=A.y;let M=1/0;d=A;do{if(y>=d.x&&d.x>=C&&y!==d.x&&sd(w<E?y:_,w,C,E,w<E?_:y,w,d.x,d.y)){const z=Math.abs(w-d.y)/(y-d.x);Ju(d,c)&&(z<M||z===M&&(d.x>A.x||d.x===A.x&&zr(A,d)))&&(A=d,M=z)}d=d.next}while(d!==T);return A}(a,e);if(!i)return e;const s=Om(i,a);return Ku(s,s.next),Ku(i,i.next)}function zr(a,e){return ia(a.prev,a,e.prev)<0&&ia(e.next,a,a.next)<0}function Tp(a,e,i,s,c){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-i)*c|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function A0(a){let e=a,i=a;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==a);return i}function sd(a,e,i,s,c,l,d,y){return(c-d)*(e-y)>=(a-d)*(l-y)&&(a-d)*(s-y)>=(i-d)*(e-y)&&(i-d)*(l-y)>=(c-d)*(s-y)}function M0(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!function(i,s){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==s.i&&c.next.i!==s.i&&Sp(c,c.next,i,s))return!0;c=c.next}while(c!==i);return!1}(a,e)&&(Ju(a,e)&&Ju(e,a)&&function(i,s){let c=i,l=!1;const d=(i.x+s.x)/2,y=(i.y+s.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&d<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(l=!l),c=c.next;while(c!==i);return l}(a,e)&&(ia(a.prev,a,e.prev)||ia(a,e.prev,e))||Lm(a,e)&&ia(a.prev,a,a.next)>0&&ia(e.prev,e,e.next)>0)}function ia(a,e,i){return(e.y-a.y)*(i.x-e.x)-(e.x-a.x)*(i.y-e.y)}function Lm(a,e){return a.x===e.x&&a.y===e.y}function Sp(a,e,i,s){const c=vf(ia(a,e,i)),l=vf(ia(a,e,s)),d=vf(ia(i,s,a)),y=vf(ia(i,s,e));return c!==l&&d!==y||!(c!==0||!Jc(a,i,e))||!(l!==0||!Jc(a,s,e))||!(d!==0||!Jc(i,a,s))||!(y!==0||!Jc(i,e,s))}function Jc(a,e,i){return e.x<=Math.max(a.x,i.x)&&e.x>=Math.min(a.x,i.x)&&e.y<=Math.max(a.y,i.y)&&e.y>=Math.min(a.y,i.y)}function vf(a){return a>0?1:a<0?-1:0}function Ju(a,e){return ia(a.prev,a,a.next)<0?ia(a,e,a.next)>=0&&ia(a,a.prev,e)>=0:ia(a,e,a.prev)<0||ia(a,a.next,e)<0}function Om(a,e){const i=od(a.i,a.x,a.y),s=od(e.i,e.x,e.y),c=a.next,l=e.prev;return a.next=e,e.prev=a,i.next=c,c.prev=i,s.next=i,i.prev=s,l.next=s,s.prev=l,s}function Qu(a,e,i,s){const c=od(a,e,i);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function io(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function od(a,e,i){return{i:a,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Pm(a,e){const i=a.length;if(i<=1)return[a];const s=[];let c,l;for(let d=0;d<i;d++){const y=bu(a[d]);y!==0&&(a[d].area=Math.abs(y),l===void 0&&(l=y<0),l===y<0?(c&&s.push(c),c=[a[d]]):c.push(a[d]))}if(c&&s.push(c),e>1)for(let d=0;d<s.length;d++)s[d].length<=e||(lm(s[d],e,1,s[d].length-1,zy),s[d]=s[d].slice(0,e));return s}function zy(a,e){return e.area-a.area}function X_(a,e,i=1){if(!a)return null;const s=typeof a=="string"?Ra.from(a).getPrimary():a.getPrimary(),c=s.id.toString();return e.has(c)||e.set(c,[]),s.scaleSelf(i),e.get(c).push(s),s.toString()}function km(a,e,i,s){const c=s.patternDependencies;let l=!1;for(const d of e){const y=d.paint.get(`${a}-pattern`);y.isConstant()||(l=!0),X_(y.constantOr(null),c,i)&&(l=!0)}return l}function Bm(a,e,i,s,c,l){const d=l.patternDependencies;for(const y of e){const w=y.paint.get(`${a}-pattern`).value;if(w.kind!=="constant"){let A=w.evaluate({zoom:s},i,{},l.availableImages);A=A&&A.name?A.name:A;const _=X_(A,d,c);_&&(i.patterns[y.id]=_)}}return i}var Y_,Nm,Fm,W_,K_,Vm,Um,jm={};function Ly(){if(Nm)return Y_;Nm=1;var a=ks();function e(c,l,d,y,w){this.properties={},this.extent=d,this.type=0,this._pbf=c,this._geometry=-1,this._keys=y,this._values=w,c.readFields(i,this,l)}function i(c,l,d){c==1?l.id=d.readVarint():c==2?function(y,w){for(var A=y.readVarint()+y.pos;y.pos<A;){var _=w._keys[y.readVarint()],T=w._values[y.readVarint()];w.properties[_]=T}}(d,l):c==3?l.type=d.readVarint():c==4&&(l._geometry=d.pos)}function s(c){for(var l,d,y=0,w=0,A=c.length,_=A-1;w<A;_=w++)y+=((d=c[_]).x-(l=c[w]).x)*(l.y+d.y);return y}return Y_=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var l,d=c.readVarint()+c.pos,y=1,w=0,A=0,_=0,T=[];c.pos<d;){if(w<=0){var C=c.readVarint();y=7&C,w=C>>3}if(w--,y===1||y===2)A+=c.readSVarint(),_+=c.readSVarint(),y===1&&(l&&T.push(l),l=[]),l.push(new a(A,_));else{if(y!==7)throw new Error("unknown command "+y);l&&l.push(l[0].clone())}}return l&&T.push(l),T},e.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var l=c.readVarint()+c.pos,d=1,y=0,w=0,A=0,_=1/0,T=-1/0,C=1/0,E=-1/0;c.pos<l;){if(y<=0){var M=c.readVarint();d=7&M,y=M>>3}if(y--,d===1||d===2)(w+=c.readSVarint())<_&&(_=w),w>T&&(T=w),(A+=c.readSVarint())<C&&(C=A),A>E&&(E=A);else if(d!==7)throw new Error("unknown command "+d)}return[_,C,T,E]},e.prototype.toGeoJSON=function(c,l,d){var y,w,A=this.extent*Math.pow(2,d),_=this.extent*c,T=this.extent*l,C=this.loadGeometry(),E=e.types[this.type];function M(V){for(var Z=0;Z<V.length;Z++){var H=V[Z];V[Z]=[360*(H.x+_)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+T)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(y=0;y<C.length;y++)z[y]=C[y][0];M(C=z);break;case 2:for(y=0;y<C.length;y++)M(C[y]);break;case 3:for(C=function(V){var Z=V.length;if(Z<=1)return[V];for(var H,q,Y=[],K=0;K<Z;K++){var ee=s(V[K]);ee!==0&&(q===void 0&&(q=ee<0),q===ee<0?(H&&Y.push(H),H=[V[K]]):H.push(V[K]))}return H&&Y.push(H),Y}(C),y=0;y<C.length;y++)for(w=0;w<C[y].length;w++)M(C[y][w])}C.length===1?C=C[0]:E="Multi"+E;var N={type:"Feature",geometry:{type:E,coordinates:C},properties:this.properties};return"id"in this&&(N.id=this.id),N},Y_}function xf(){if(W_)return Fm;W_=1;var a=Ly();function e(s,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(i,this,c),this.length=this._features.length}function i(s,c,l){s===15?c.version=l.readVarint():s===1?c.name=l.readString():s===5?c.extent=l.readVarint():s===2?c._features.push(l.pos):s===3?c._keys.push(l.readString()):s===4&&c._values.push(function(d){for(var y=null,w=d.readVarint()+d.pos;d.pos<w;){var A=d.readVarint()>>3;y=A===1?d.readString():A===2?d.readFloat():A===3?d.readDouble():A===4?d.readVarint64():A===5?d.readVarint():A===6?d.readSVarint():A===7?d.readBoolean():null}return y}(l))}return Fm=e,e.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var c=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,c,this.extent,this._keys,this._values)},Fm}function Oy(){return Um||(Um=1,jm.VectorTile=function(){if(Vm)return K_;Vm=1;var a=xf();function e(i,s,c){if(i===3){var l=new a(c,c.readVarint()+c.pos);l.length&&(s[l.name]=l)}}return K_=function(i,s){this.layers=i.readFields(e,{},s)},K_}(),jm.VectorTileFeature=Ly(),jm.VectorTileLayer=xf()),jm}var Qc=Oy();const Un="3d_elevation_id",qm="level";class Gm{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,s){return this.get(e,!0,i,s)}optional(e,i,s){return this.get(e,!1,i,s)}success(){return this._valid}get(e,i,s,c){const l=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&l!==void 0?s(c?c(l):l):i&&(this._valid=!1),this}}class Hm{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,s){return this.featureFunc(e,i,s)}parseVertex(e,i,s){return this.vertexFunc(e,i,s)}}const Py=new Hm((a,e,i)=>a.reset(e).require(Un,s=>{i.id=s}).optional("fixed_height_relative",s=>{i.constantHeight=s},go.decodeRelativeHeight).geometry(s=>{i.bounds=s},go.computeBounds).success(),(a,e,i)=>a.reset(e).require(Un,s=>{i.id=s}).require("elevation_idx",s=>{i.idx=s}).require("extent",s=>{i.extent=s}).require("height_relative",s=>{i.height=s},go.decodeRelativeHeight).geometry(s=>{i.position=s},go.getPoint).success()),J_=new Hm((a,e,i)=>a.reset(e).require(Un,s=>{i.id=s}).optional("fixed_height",s=>{i.constantHeight=s},go.decodeMetricHeight).geometry(s=>{i.bounds=s},go.computeBounds).success(),(a,e,i)=>a.reset(e).require(Un,s=>{i.id=s}).require("elevation_idx",s=>{i.idx=s}).require("extent",s=>{i.extent=s}).require("height",s=>{i.height=s},go.decodeMetricHeight).geometry(s=>{i.position=s},go.getPoint).success());class go{static computeBounds(e){const i=new Ft(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new Ft(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of e[0])i.x>c.x&&(i.x=c.x),i.y>c.y&&(i.y=c.y),s.x<c.x&&(s.x=c.x),s.y<c.y&&(s.y=c.y);return{min:i,max:s}}static getPoint(e){return de.vec2.fromValues(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],s=[],c=e.length,l=new Gm;for(let y=0;y<c;y++){const w=e.feature(y),A=w.properties.hasOwnProperty("version")?String(w.properties.version):void 0,_=(d=A)?d==="1.0.1"?J_:void 0:Py;if(_===void 0){Kn(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const T=w.properties.hasOwnProperty("type")?w.properties.type:void 0;if(T){if(Qc.VectorTileFeature.types[w.type]==="Point"&&T==="curve_point"){const C={};_.parseVertex(l,w,C)&&i.push(C)}else if(Qc.VectorTileFeature.types[w.type]==="Polygon"&&T==="curve_meta"){const C={};_.parseFeature(l,w,C)&&s.push(C)}}}var d;return{vertices:i,features:s}}}class bf{constructor(e,i,s,c,l,d){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:s,max:s},this.safeArea=i,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=l,this.edges=this.edges.filter(y=>y.a<this.vertices.length&&y.b<this.vertices.length&&!de.vec2.exactEquals(this.vertices[y.a].position,this.vertices[y.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:de.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const w=this.vertices[y.a].position,A=this.vertices[y.b].position,_=de.vec2.subtract(de.vec2.create(),A,w),T=de.vec2.length(_),C=de.vec2.scale(de.vec2.create(),_,1/T);this.edgeProps.push({vec:_,dir:C,len:T});const E=this.vertexProps[y.a].dir,M=this.vertexProps[y.b].dir;de.vec2.add(E,E,C),de.vec2.add(M,M,C)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||de.vec2.normalize(y.dir,y.dir);this.tessellate(d)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[s,c]=i;return((l,d,y)=>(1-y)*l+y*d)(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,c)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,s=Number.POSITIVE_INFINITY,c=0;const l=de.vec2.fromValues(e.x,e.y);for(let d=0;d<this.edges.length;d++){const y=this.edges[d],w=this.edgeProps[d].dir,A=new Ri(l,this.edgeProps[d].dir),_=this.vertices[y.a].position,T=this.vertices[y.b].position,C=de.vec2.create(),E=de.vec2.create(),M=A.intersectsPlane(_,this.vertexProps[y.a].dir,C),z=A.intersectsPlane(T,this.vertexProps[y.b].dir,E);if(!M||!z)continue;const N=de.vec2.subtract(de.vec2.create(),E,C),V=de.vec2.subtract(de.vec2.create(),l,C),Z=de.vec2.dot(N,N),H=Z>0?de.vec2.dot(V,N)/Z:0,q=vt(H,0,1),Y=Math.abs((H-q)*this.edgeProps[d].len),K=de.vec2.subtract(de.vec2.create(),l,_),ee=Y+Math.abs(de.vec2.dot(K,de.vec2.fromValues(w[1],-w[0])));ee<s&&(i=d,s=ee,c=q)}return[i,c]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const s=this.edges[i].a,c=this.edges[i].b,{position:l,height:d,extent:y}=this.vertices[s],{position:w,height:A,extent:_}=this.vertices[c],T=this.vertexProps[s].dir,C=this.vertexProps[c].dir,E=de.vec3.fromValues(l[0]/e,l[1]/e,d),M=de.vec3.fromValues(w[0]/e,w[1]/e,A),z=de.vec3.fromValues(T[1],-T[0],0);de.vec3.scale(z,z,y);const N=de.vec3.fromValues(C[1],-C[0],0);if(de.vec3.scale(N,N,_),this.distSqLines(de.vec3.fromValues(E[0]+.5*z[0],E[1]+.5*z[1],E[2]+.5*z[2]),de.vec3.fromValues(M[0]-.5*N[0],M[1]-.5*N[1],M[2]-.5*N[2]),de.vec3.fromValues(E[0]-.5*z[0],E[1]-.5*z[1],E[2]-.5*z[2]),de.vec3.fromValues(M[0]+.5*N[0],M[1]+.5*N[1],M[2]+.5*N[2]))<=.05*.05)continue;const V=this.vertices.length,Z=de.vec2.add(de.vec2.create(),l,w);this.vertices.push({position:de.vec2.scale(Z,Z,.5),height:.5*(d+A),extent:.5*(y+_)});const H=de.vec2.add(de.vec2.create(),T,C);this.vertexProps.push({dir:de.vec2.normalize(H,H)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:s,b:V}),this.edges.push({a:V,b:c});const q=de.vec2.subtract(de.vec2.create(),this.vertices[V].position,l),Y=de.vec2.length(q),K={vec:q,dir:de.vec2.scale(de.vec2.create(),q,1/Y),len:Y};this.edgeProps.push(K),this.edgeProps.push(K)}}distSqLines(e,i,s,c){const l=de.vec3.subtract(de.vec3.create(),i,e),d=de.vec3.subtract(de.vec3.create(),c,s),y=de.vec3.subtract(de.vec3.create(),e,s),w=de.vec3.dot(l,l),A=de.vec3.dot(l,d),_=de.vec3.dot(l,y),T=de.vec3.dot(d,d),C=de.vec3.dot(d,y),E=w*T-A*A;if(E===0){const Z=de.vec3.dot(y,d)/de.vec3.dot(d,d),H=de.vec3.lerp(de.vec3.create(),s,c,Z);return de.vec3.squaredDistance(H,e)}const M=(A*C-_*T)/E,z=(w*C-A*_)/E,N=de.vec3.lerp(de.vec3.create(),e,i,M),V=de.vec3.lerp(de.vec3.create(),s,c,z);return de.vec3.squaredDistance(N,V)}}class wf{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Bt,this.yOffset=(e.y*this.zScale-i.y)*Bt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,s){const c=this.constantElevation(i,s);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),s))}computeBiasedHeight(e,i){return i<=0?e:e+i*bi(0,i,e>=0?e:Math.abs(.5*e))}}Wt(bf,"ElevationFeature");class Q_{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,s]of e.polygons)this.add(i,...s)}}class ld{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new ld;let i=[];for(const A of e)i.push(...A.portals);if(i.length===0)return new ld;const s=(A,_)=>A<=0&&_<=0||A>=Bt&&_>=Bt;for(const A of i){const _=A.va,T=A.vb;(s(_.x,T.x)||s(_.y,T.y))&&(A.type="border")}const c=i.filter(A=>A.type!=="unevaluated"),l=i.filter(A=>A.type==="unevaluated");if(l.length===0)return new ld;l.sort((A,_)=>A.hash===_.hash?A.isTunnel===_.isTunnel?0:A.isTunnel?-1:1:A.hash<_.hash?1:-1),i=c.concat(l);let d=c.length,y=d,w=d;do if(y++,y===i.length||i[d].hash!==i[y].hash){if(y-d==2){w<d&&(i[w]=i[d],i[d]=null);const A=i[w],_=i[y-1];A.type=A.isTunnel!==_.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:_.connection.a},w++}d=y}while(d!==i.length);return i.splice(w),i.sort((A,_)=>A.hash<_.hash?1:-1),{portals:i}}}Wt(ld,"ElevationPortalGraph"),Wt(Q_,"ElevationPolygons");class C0{constructor(e,i,s){this.outPositions=e,this.outNormals=i,this.outIndices=s,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,s){let c=e[2];s!=null&&(c*=s);const l=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),d=this.vertexLookup.get(l);if(d!=null)return d;const y=this.outPositions.length;this.vertexLookup.set(l,y);const w=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),_=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(w,A,_),y}addVertices(e,i,...s){const c=[];for(const l of s){const d=this.addVertex(l,e,i);c.push(d)}return c}addTriangles(e,i,s){if(i&&s){const c=s.length===1,l=de.vec3.fromValues(0,0,0);for(let d=0;d<e.length;d+=3){const y=i[e[d+0]],w=i[e[d+1]],A=i[e[d+2]],_=c?s[0]:s[e[d+1]],T=c?s[0]:s[e[d+2]],C=this.addVertex(de.vec3.fromValues(y.x,y.y,c?s[0]:s[e[d+0]]),l),E=this.addVertex(de.vec3.fromValues(w.x,w.y,_),l),M=this.addVertex(de.vec3.fromValues(A.x,A.y,T),l);this.outIndices.emplaceBack(C,E,M)}}else for(let c=0;c<e.length;c+=3)this.outIndices.emplaceBack(e[c+0],e[c+1],e[c+2])}addQuad(e,i){const s=this.addVertices(i,void 0,...e.map(w=>de.vec3.fromValues(w.coord.x,w.coord.y,w.height))),[c,l,d,y]=s;this.addTriangles([c,l,d,d,y,c])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class qo{constructor(e){this.unevaluatedPortals=new ld,this.portalPolygons=new Q_,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Fu,this.vertexNormals=new $l,this.indexArray=new ca,this.tileToMeters=h(e)}addVertices(e,i){const s=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(i[c]);return s}addTriangles(e,i,s){const c=s?this.unevalTunnelTriangles:this.unevalTriangles;for(const l of e)c.push(l+i)}addRenderableRing(e,i,s,c,l){const d=[new Ft(l.min.x,l.min.y),new Ft(l.max.x,l.min.y),new Ft(l.max.x,l.max.y),new Ft(l.min.x,l.max.y)];for(let y=0;y<s-1;y++){const w=i+y,A=w+1,_=this.unevalVertices[w],T=this.unevalVertices[A];if(!(_.x>=l.min.x&&_.x<=l.max.x&&_.y>=l.min.y&&_.y<=l.max.y||T.x>=l.min.x&&T.x<=l.max.x&&T.y>=l.min.y&&T.y<=l.max.y||Se(_,T,d))||this.isOnBorder(_.x,T.x)||this.isOnBorder(_.y,T.y))continue;const C=qo.computeEdgeHash(this.unevalVertices[w],this.unevalVertices[A]);let E,M=this.vertexHashLookup.get(qo.computePosHash(_));M!=null?E=M.next:(M=this.vertexHashLookup.get(qo.computePosHash(T)),E=M!=null?M.prev:C),this.unevalEdges.push({polygonIdx:e,a:w,b:A,hash:C,portalHash:E,isTunnel:c,type:"unevaluated"})}}addPortalCandidates(e,i,s,c,l){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:l});const d=i[0];this.vertexHashLookup.clear();let y=qo.computeEdgeHash(d[d.length-2],d[d.length-1]);for(let w=0;w<d.length-1;w++){const A=d[w+0],_=d[w+1],T=de.vec2.fromValues(_.x-A.x,_.y-A.y),C=de.vec2.length(T);if(C===0)continue;let E="unevaluated";const M=c.pointElevation(A),z=c.pointElevation(_);Math.abs(M)<.01&&Math.abs(z)<.01?E="entrance":(this.isOnBorder(A.x,_.x)||this.isOnBorder(A.y,_.y))&&(E="border");const N=qo.computeEdgeHash(A,_);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:A,vb:_,vab:T,length:C,hash:N,isTunnel:s,type:E});const V=qo.computePosHash(A);this.vertexHashLookup.set(V,{prev:y,next:N}),y=N}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=T=>{T.primitiveLength=this.indexArray.length-T.primitiveOffset},c=new C0(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const l=i(),d=i(),y=i(),w=(T,C)=>{T.sort((M,z)=>M.type===C&&z.type!==C?-1:M.type!==C&&z.type===C?1:0);const E=T.findIndex(M=>M.type!==C);return E>=0?E:T.length};let A=0;this.unevalEdges.length>0&&(A=w(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters));const _=i();if(this.unevalEdges.length>0){const T=this.unevalEdges.splice(A),C=w(T,"tunnel")+A;this.unevalEdges.push(...T),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:C})}s(y),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(_),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(d),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(l),this.maskSegments=On.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.depthSegments=On.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength),this.renderableSegments=On.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.shadowCasterSegments=On.simpleSegment(0,l.primitiveOffset,0,l.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Ay.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,gf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,i,s,c){const l=new Map;for(let d=s;d<c;d++){const y=i[d],w=y.a,A=y.b;l.has(w)||l.set(w,{}),l.has(A)||l.set(A,{});const _=l.get(w),T=l.get(A);e[A]>0&&(_.to=A),e[w]>0&&(T.from=w)}return l}constructBridgeStructures(e,i,s,c,l,d){const y=this.computeVertexConnections(s,c,l.min,l.max),w=1/d,A=.5*w,_=C=>de.vec3.fromValues(i[C].x,i[C].y,s[C]*w),T=C=>{const E=y.get(C),M=E.from,z=E.to;if(!M||!z)return;const N=_(M),V=_(C),Z=_(z),H=de.vec3.fromValues(0,0,0);if(!de.vec3.exactEquals(N,V)){const Y=de.vec3.sub(de.vec3.create(),V,N);de.vec3.add(H,H,de.vec3.normalize(Y,Y))}if(!de.vec3.exactEquals(Z,V)){const Y=de.vec3.sub(de.vec3.create(),Z,V);de.vec3.add(H,H,de.vec3.normalize(Y,Y))}const q=de.vec3.len(H);return q>0?de.vec3.scale(H,H,1/q):void 0};for(let C=l.min;C<l.max;C++){const E=c[C],M=this.prepareEdgePoints(i,s,E,(St,wi)=>St>=wi);if(M==null)continue;const z=M[0],N=M[1],V=de.vec3.fromValues(z.coord.x,z.coord.y,w*z.height),Z=de.vec3.fromValues(N.coord.x,N.coord.y,w*N.height);if(de.vec3.exactEquals(V,Z))continue;const H=de.vec3.sub(de.vec3.create(),Z,V);de.vec3.normalize(H,H);const q=St=>de.vec3.normalize(St,St),Y=T(E.a)||H,K=T(E.b)||H,ee=q(de.vec3.fromValues(Y[1],-Y[0],0)),he=q(de.vec3.fromValues(K[1],-K[0],0)),le=q(de.vec3.cross(de.vec3.create(),ee,Y)),ue=q(de.vec3.cross(de.vec3.create(),he,K)),Te=de.vec3.create(),pe=[de.vec3.add(de.vec3.create(),V,de.vec3.scale(Te,de.vec3.sub(Te,ee,le),A)),de.vec3.add(de.vec3.create(),V,de.vec3.scale(Te,de.vec3.add(Te,ee,le),A)),de.vec3.add(de.vec3.create(),V,de.vec3.scale(Te,le,A)),V],Ee=[de.vec3.add(de.vec3.create(),Z,de.vec3.scale(Te,de.vec3.sub(Te,he,ue),A)),de.vec3.add(de.vec3.create(),Z,de.vec3.scale(Te,de.vec3.add(Te,he,ue),A)),de.vec3.add(de.vec3.create(),Z,de.vec3.scale(Te,ue,A)),Z],[De,Re]=e.addVertices(ee,d,pe[0],pe[1]),[ke,Pe]=e.addVertices(he,d,Ee[0],Ee[1]);e.addTriangles([De,Re,ke,Re,Pe,ke]);const[Ze,Ue]=e.addVertices(le,d,pe[1],pe[2]),[Xe,bt]=e.addVertices(ue,d,Ee[1],Ee[2]);e.addTriangles([Ze,Ue,Xe,Ue,bt,Xe]);const[xt,ei]=e.addVertices(de.vec3.negate(ee,ee),d,pe[2],pe[3]),[zt,Nt]=e.addVertices(de.vec3.negate(he,he),d,Ee[2],Ee[3]);e.addTriangles([xt,ei,zt,ei,Nt,zt])}}constructTunnelStructures(e,i,s,c,l,d){const y=w=>de.vec3.normalize(w,w);for(let w=l.min;w<l.max;w++){const A=this.prepareEdgePoints(i,s,c[w],(E,M)=>E<=M);if(A==null)continue;const[_,T]=A,C=y(de.vec3.fromValues(T.coord.y-_.coord.y,-(T.coord.x-_.coord.x),0));e.addQuad([_,T,{coord:T.coord,height:c[w].isTunnel?-.1:0},{coord:_.coord,height:c[w].isTunnel?-.1:0}],C)}for(let w=d.min;w<d.max;w++){const A=c[w],_=i[A.a],T=i[A.b],C=y(de.vec3.fromValues(T.y-_.y,-(T.x-_.x),0));e.addQuad([{coord:T,height:0},{coord:_,height:0},{coord:_,height:s[A.a]+4},{coord:T,height:s[A.b]+4}],C),e.addQuad([{coord:_,height:0},{coord:T,height:0},{coord:T,height:s[A.b]+4},{coord:_,height:s[A.a]+4}],C)}}prepareEdgePoints(e,i,s,c){const l=e[s.a],d=e[s.b];let y=i[s.a],w=i[s.b];if(!(y!==0&&c(y,0)||w!==0&&c(w,0)))return;const A=l.clone(),_=d.clone();if(c(y,0)){if(!c(w,0)){const T=w/(w-y);_.x=yi(_.x,A.x,T),_.y=yi(_.y,A.y,T),w=yi(w,y,T)}}else{const T=y/(y-w);A.x=yi(A.x,_.x,T),A.y=yi(A.y,_.y,T),y=yi(y,w,T)}return[{coord:A,height:y},{coord:_,height:w}]}prepareEdges(e,i){if(i.length===0)return;i.sort((y,w)=>y.hash===w.hash?w.polygonIdx-y.polygonIdx:w.hash>y.hash?1:-1);let s=0,c=0,l=0,d=i[s].polygonIdx;do c++,(c===i.length||i[s].hash!==i[c].hash)&&((c-s==1||i[c-1].polygonIdx!==d)&&(l<s&&(i[l]=i[s],i[s]=null),i[l].type="none",l++),s=c,s!==i.length&&(d=i[s].polygonIdx));while(s!==i.length);if(i.splice(l),i.length!==0&&e.length!==0){i.sort((A,_)=>A.hash<_.hash?1:-1);let y=0,w=0;for(;y!==i.length&&w!==e.length;){const A=i[y],_=e[w];A.portalHash>_.hash?y++:_.hash>A.portalHash?w++:(A.type=_.type,y++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Bt&&i>=Bt}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(qo.computePosHash(e))<<32n|BigInt(qo.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}class Zm{constructor(e,i){this.layoutVertexArray=new Bo,this.indexArray=new ca,this.lineIndexArray=new Fo,this.triangleSegments=new On,this.lineSegments=new On,this.programConfigurations=new cl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new jc)}update(e,i,s,c,l,d,y){this.programConfigurations.updatePaintArrays(e,i,l,s,c,d,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,E0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Ey.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,s,c,l,d){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,s,c,l,d)}}class Tf{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new Zm(e,!1),this.elevationBufferData=new Zm(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,i){}populate(e,i,s,c){this.hasPattern=km("fill",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:y,id:w,index:A,sourceLayerIndex:_}of e){const T=this.layers[0]._featureFilter.needGeometry,C=k(y,T);if(!this.layers[0]._featureFilter.filter(new Ln(this.zoom),C,s))continue;const E=l?l.evaluate(C,{},s,i.availableImages):void 0,M={id:w,properties:y.properties,type:y.type,sourceLayerIndex:_,index:A,geometry:T?C.geometry:P(y,s,c),patterns:{},sortKey:E};d.push(M)}l&&d.sort((y,w)=>y.sortKey-w.sortKey);for(const y of d){const{geometry:w,index:A,sourceLayerIndex:_}=y;if(this.hasPattern){const T=Bm("fill",this.layers,y,this.zoom,this.pixelRatio,i);this.patternFeatures.push(T)}else this.addFeature(y,w,A,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,w,A,_,this.index)}}update(e,i,s,c,l,d,y){this.bufferData.update(e,i,s,c,l,d,y),this.elevationBufferData.update(e,i,s,c,l,d,y)}addFeatures(e,i,s,c,l,d){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,s,c,d,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,s,c,l,d=[],y,w){const A=Pm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,c,s,w):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,s,l,d,c,y),this.elevationBufferData.populatePaintArrays(e,s,l,d,c,y)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,i,s,c,l){const d=new Array,y=this.getElevationFeature(e,l);if(y){d.push({polygons:i,elevationFeature:y,elevationTileID:s});for(const w of d)if(w.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new qo(w.elevationTileID));const _=w.elevationFeature.isTunnel();let T=0;e.properties.hasOwnProperty(qm)&&(T=+e.properties[qm]);for(const C of w.polygons)this.elevatedStructures.addPortalCandidates(w.elevationFeature.id,C,_,w.elevationFeature,T)}const A=new wf(s,w.elevationTileID);this.addElevatedGeometry(w.polygons,A,w.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c)}}else this.addGeometry(i,this.bufferData)}addElevatedGeometry(e,i,s,c,l){const d={elevation:s,elevationSampler:i,bias:c,index:l},[y,w]=this.addGeometry(e,this.elevationBufferData,d);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:w}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,w))}addGeometry(e,i,s){let c=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,d=null;s&&(d=s.elevationSampler.constantElevation(s.elevation,s.bias),d!=null&&(c=d,l=d));const y=(w,A,_)=>{if(s!=null)if(A.push(w),d!=null)i.elevatedLayoutVertexArray.emplaceBack(d),_.push(d);else{const T=s.elevationSampler.pointElevation(w,s.elevation,s.bias);i.elevatedLayoutVertexArray.emplaceBack(T),_.push(T),c=Math.min(c,T),l=Math.max(l,T)}};for(const w of e){let A=0;for(const H of w)A+=H.length;const _=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),T=_.vertexLength,C=[],E=[],M=[],z=[],N=[],V=i.layoutVertexArray.length;for(const H of w){if(H.length===0)continue;H!==w[0]&&E.push(C.length/2);const q=i.lineSegments.prepareSegment(H.length,i.layoutVertexArray,i.lineIndexArray),Y=q.vertexLength;s&&N.push(i.layoutVertexArray.length-V),y(H[0],M,z),i.layoutVertexArray.emplaceBack(H[0].x,H[0].y),i.lineIndexArray.emplaceBack(Y+H.length-1,Y),C.push(H[0].x),C.push(H[0].y);for(let K=1;K<H.length;K++)y(H[K],M,z),i.layoutVertexArray.emplaceBack(H[K].x,H[K].y),i.lineIndexArray.emplaceBack(Y+K-1,Y+K),C.push(H[K].x),C.push(H[K].y);q.vertexLength+=H.length,q.primitiveLength+=H.length}const Z=Wu(C,E);for(let H=0;H<Z.length;H+=3)i.indexArray.emplaceBack(T+Z[H],T+Z[H+1],T+Z[H+2]);if(s&&this.elevationMode==="hd-road-base"){const H=s.elevation.isTunnel(),q=s.elevation.safeArea,Y=this.elevatedStructures.addVertices(M,z);this.elevatedStructures.addTriangles(Z,Y,H);const K=N.length;if(K>0){for(let ee=0;ee<K-1;ee++)this.elevatedStructures.addRenderableRing(s.index,N[ee]+Y,N[ee+1]-N[ee],H,q);this.elevatedStructures.addRenderableRing(s.index,N[K-1]+Y,M.length-N[K-1],H,q)}}_.vertexLength+=A,_.primitiveLength+=Z.length/3}return[c,l]}getElevationFeature(e,i){if(!i)return;const s=+e.properties[Un];return s!=null?i.find(c=>c.id===s):void 0}}let br,$m,Za,ky;Wt(Tf,"FillBucket",{omit:["layers","patternFeatures"]}),Wt(Zm,"FillBufferData"),Wt(qo,"ElevatedStructures");class Ep{constructor(e,i,s,c){if(this.triangleCount=i.length/3,this.min=new Ft(0,0),this.max=new Ft(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,d]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){const C=e[T];l.x=Math.min(l.x,C.x),l.y=Math.min(l.y,C.y),d.x=Math.max(d.x,C.x),d.y=Math.max(d.y,C.y)}if(c){const T=Math.ceil(Math.max(d.x-l.x,d.y-l.y)/c);s=Math.max(s,T)}if(s===0)return;this.min=l,this.max=d;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const w=Math.max(y.x,y.y)/s;this.cellsX=Math.max(1,Math.ceil(y.x/w)),this.cellsY=Math.max(1,Math.ceil(y.y/w)),this.xScale=1/w,this.yScale=1/w;const A=[];for(let T=0;T<this.triangleCount;T++){const C=e[i[3*T+0]].sub(this.min),E=e[i[3*T+1]].sub(this.min),M=e[i[3*T+2]].sub(this.min),z=Go(Math.floor(Math.min(C.x,E.x,M.x)),this.xScale,this.cellsX),N=Go(Math.floor(Math.max(C.x,E.x,M.x)),this.xScale,this.cellsX),V=Go(Math.floor(Math.min(C.y,E.y,M.y)),this.yScale,this.cellsY),Z=Go(Math.floor(Math.max(C.y,E.y,M.y)),this.yScale,this.cellsY),H=new Ft(0,0),q=new Ft(0,0),Y=new Ft(0,0),K=new Ft(0,0);for(let ee=V;ee<=Z;++ee){H.y=q.y=ee*w,Y.y=K.y=(ee+1)*w;for(let he=z;he<=N;++he)H.x=Y.x=he*w,q.x=K.x=(he+1)*w,(Ke(C,E,M,H,q,K)||Ke(C,E,M,H,K,Y))&&A.push({cellIdx:ee*this.cellsX+he,triIdx:T})}}if(A.length===0)return;A.sort((T,C)=>T.cellIdx-C.cellIdx||T.triIdx-C.triIdx);let _=0;for(;_<A.length;){const T=A[_].cellIdx,C={start:this.payload.length,len:0};for(;_<A.length&&A[_].cellIdx===T;)++C.len,this.payload.push(A[_++].triIdx);this.cells[T]=C}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Go(e.x-this.min.x,this.xScale,this.cellsX),c=Go(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[c*this.cellsX+s];if(l){this._lazyInitLookup();for(let d=0;d<l.len;d++){const y=this.payload[l.start+d],w=Math.floor(y/8),A=1<<y%8;if(!(this.lookup[w]&A)&&(this.lookup[w]|=A,i.push(y),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const c=Go(e.x-this.min.x,this.xScale,this.cellsX),l=Go(i.x-this.min.x,this.xScale,this.cellsX),d=Go(e.y-this.min.y,this.yScale,this.cellsY),y=Go(i.y-this.min.y,this.yScale,this.cellsY);for(let w=d;w<=y;w++)for(let A=c;A<=l;A++){const _=this.cells[w*this.cellsX+A];if(_)for(let T=0;T<_.len;T++){const C=this.payload[_.start+T],E=Math.floor(C/8),M=1<<C%8;if(!(this.lookup[E]&M)&&(this.lookup[E]|=M,s.push(C),s.length===this.triangleCount))return}}}}function Go(a,e,i){return Math.max(0,Math.min(i-1,Math.floor(a*e)))}Wt(Ep,"TriangleGridIndex");class Ap{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}populate(e,i,s,c){const l=[];for(const{feature:d,id:y,index:w,sourceLayerIndex:A}of e){const _=this.layers[0]._featureFilter.needGeometry,T=k(d,_);if(!this.layers[0]._featureFilter.filter(new Ln(this.zoom),T,s))continue;const C={id:y,properties:d.properties,type:d.type,sourceLayerIndex:A,index:w,geometry:_?T.geometry:P(d,s,c),patterns:{}};l.push(C)}for(const d of l){const{geometry:y,index:w,sourceLayerIndex:A}=d;this.addFeature(d,y,w,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,y,w,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,c,l,d,y){}destroy(){}addFeature(e,i,s,c,l,d=[],y){for(const w of Pm(i,2)){const A=[],_=[],T=[],C=new Ft(1/0,1/0),E=new Ft(-1/0,-1/0);for(const N of w)if(N.length!==0){N!==w[0]&&T.push(_.length/2);for(let V=0;V<N.length;V++)_.push(N[V].x),_.push(N[V].y),A.push(N[V]),C.x=Math.min(C.x,N[V].x),C.y=Math.min(C.y,N[V].y),E.x=Math.max(E.x,N[V].x),E.y=Math.max(E.y,N[V].y)}const M=Wu(_,T),z=new Ep(A,M,8,256);this.footprints.push({vertices:A,indices:M,grid:z,min:C,max:E})}}}Wt(Ap,"ClipBucket",{omit:["layers"]});const By=wn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ny=wn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),eg=wn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),tg=wn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),I0=wn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Fy=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:R0}=By;class eh extends Ft{constructor(e,i,s){super(e,i),this.z=s}}class Vy extends eh{constructor(e,i,s,c){super(e,i,s),this.w=c}}function Xm(a,e,i,s){const c=[],l=s===0?(d,y,w,A,_,T)=>{d.push(new Ft(T,w+(T-y)/(A-y)*(_-w)))}:(d,y,w,A,_,T)=>{d.push(new Ft(y+(T-w)/(_-w)*(A-y),T))};for(const d of a){const y=[];for(const w of d){if(w.length<=2)continue;const A=[];for(let C=0;C<w.length-1;C++){const E=w[C].x,M=w[C].y,z=w[C+1].x,N=w[C+1].y,V=s===0?E:M,Z=s===0?z:N;V<e?Z>e&&l(A,E,M,z,N,e):V>i?Z<i&&l(A,E,M,z,N,i):A.push(w[C]),Z<e&&V>=e&&l(A,E,M,z,N,e),Z>i&&V<=i&&l(A,E,M,z,N,i)}let _=w[w.length-1];const T=s===0?_.x:_.y;T>=e&&T<=i&&A.push(_),A.length&&(_=A[A.length-1],A[0].x===_.x&&A[0].y===_.y||A.push(A[0]),y.push(A))}y.length&&c.push(y)}return c}function eu(a,e,i,s){const c=i==="x"?"y":"x",l=(s-a[i])/(e[i]-a[i]);a[c]=a[c]+(e[c]-a[c])*l,a[i]=s,a.hasOwnProperty("z")&&(a.z=yi(a.z,e.z,l)),a.hasOwnProperty("w")&&(a.w=yi(a.w,e.w,l))}function ig(a,e,i,s){const c=i,l=s;for(const d of["x","y"]){let y=a,w=e;y[d]>=w[d]&&(y=e,w=a),y[d]<c&&w[d]>c&&eu(y,w,d,c),y[d]<l&&w[d]>l&&eu(w,y,d,l)}}const Sf=Number.MAX_SAFE_INTEGER;function Uy(a,e,i,s){return a.order<e||a.order===Sf||!(a.clipMask&i)||function(c,l){return l.length!==0&&l.find(d=>d===c)===void 0}(s,a.clipScope)}function Ym(a,e){return a.x-e.x||a.y-e.y}function Wm(a,e){return Ym(a.min,e.min)===0&&Ym(a.max,e.max)===0}function ng(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function yo(a,e){if(a.length!==e.length)return!1;for(let i=0;i<a.length;i++)if(a[i].sourceId!==e[i].sourceId||!Wm(a[i],e[i])||a[i].order!==e[i].order||a[i].clipMask!==e[i].clipMask||!Ss(a[i].clipScope,e[i].clipScope))return!1;return!0}function Km(a,e,i){const s=1/Bt,c=1/(1<<i.canonical.z),l=(e.x*s+i.canonical.x)*c+i.wrap,d=(e.y*s+i.canonical.y)*c;return{min:new Ft((a.x*s+i.canonical.x)*c+i.wrap,(a.y*s+i.canonical.y)*c),max:new Ft(l,d)}}function jy(a,e,i){const s=1<<i.canonical.z,c=((e.x-i.wrap)*s-i.canonical.x)*Bt,l=(e.y*s-i.canonical.y)*Bt;return{min:new Ft(((a.x-i.wrap)*s-i.canonical.x)*Bt,(a.y*s-i.canonical.y)*Bt),max:new Ft(c,l)}}function rg(a,e,i,s,c,l,d){const y=a.indices,w=a.vertices,A=[];for(let _=s;_<s+c;_+=3){const T=e[i[_+0]+l],C=e[i[_+1]+l],E=e[i[_+2]+l],M=Math.min(T.x,C.x,E.x),z=Math.max(T.x,C.x,E.x),N=Math.min(T.y,C.y,E.y),V=Math.max(T.y,C.y,E.y);A.length=0,a.grid.query(new Ft(M,N),new Ft(z,V),A);for(let Z=0;Z<A.length;Z++){const H=A[Z];if(Ke(w[y[3*H+0]],w[y[3*H+1]],w[y[3*H+2]],T,C,E,d))return!0}}return!1}function Ef(a,e,i,s){if(!a||!i)return!1;let c=a.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<a.vertices.length)return Ef(i,s,a,e);const l=e.canonical,d=s.canonical,y=Math.pow(2,d.z-l.z);c=a.vertices.map(w=>new Ft((w.x+l.x*Bt)*y-d.x*Bt,(w.y+l.y*Bt)*y-d.y*Bt))}return rg(i,c,a.indices,0,a.indices.length,0,0)}function vo(a,e,i,s){const c=Math.pow(2,s.z-i.z);return new Ft((a+i.x*Bt)*c-s.x*Bt,(e+i.y*Bt)*c-s.y*Bt)}function ag(a,e){const i=[];e.grid.queryPoint(a,i);const s=e.indices,c=e.vertices;for(let l=0;l<i.length;l++){const d=i[l];if(ve([c[s[3*d+0]],c[s[3*d+1]],c[s[3*d+2]]],a))return!0}return!1}const Af=[new Ft(0,0),new Ft(Bt,0),new Ft(Bt,Bt),new Ft(0,Bt)];function ac(a,e){const i=[];let s=[];if(!e||a.length<2)return[a];if(a.length===2)return Se(a[0],a[1],Af)?[a]:[];for(let c=0;c<a.length+2;c++){const l=a[c%a.length],d=a[(c+1)%a.length],y=Se(c===0?a[a.length-1]:a[(c-1)%a.length],l,Af),w=Se(l,d,Af),A=y||w;A&&s.push(l),A&&w||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const sg=Qc.VectorTileFeature.types,D0=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Mf=["fill-extrusion-flood-light-ground-radius"],qy=Math.pow(2,13),z0=Math.pow(2,15)-1,Gy=new Ft(0,1),th=2147483648;function Mp(a,e,i,s,c,l,d,y){a.emplaceBack((e<<1)+d,(i<<1)+l,(Math.floor(s*qy)<<1)+c,Math.round(y))}function Cp(a,e,i){a.emplaceBack(e.x*Bt,e.y*Bt,i?1:0)}function Jm(a,e,i,s,c,l){a.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+c,l)}function Ip(a,e,i){a.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class og{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cd{constructor(){this.centroidXY=new Ft(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ft(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ft(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ft(this.max.x-this.min.x,this.max.y-this.min.y)}}class Cf{constructor(){this.acc=new Ft(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<e.min.x?(e.min.x=i.x,c=!0):i.x>e.max.x&&(e.max.x=i.x,c=!0),i.y<e.min.y?(e.min.y=i.y,c=!0):i.y>e.max.y&&(e.max.y=i.y,c=!0),((i.x===0||i.x===Bt)&&i.x===s.x)!=((i.y===0||i.y===Bt)&&i.y===s.y)&&this.processBorderOverlap(i,s),c&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,yi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Bt!=e.x>Bt&&this.addBorderIntersection(1,yi(i.y,e.y,(Bt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,yi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Bt!=e.y>Bt&&this.addBorderIntersection(3,yi(i.x,e.x,(Bt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new Ft(0,0):new Ft(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function lg(a,e){const i=a.add(e)._unit(),s=vt(a.x*i.x+a.y*i.y,-1,1);var c,l,d;return d=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(d)))/4*z0*((c=a).x*(l=e).y-c.y*l.x<0?-1:1)}const L0=[a=>a.x<0,a=>a.x>Bt,a=>a.y<0,a=>a.y>Bt];function If(a,e,i,s){const c=[4];if(s===0)return c;i._mult(s);const l=a.sub(i),d=e.sub(i),y=[a,e,l,d];for(let w=0;w<4;w++)for(const A of y)if(L0[w](A)){c.push(w);break}return c}class Rf{constructor(e){this.vertexArray=new ns,this.indexArray=new ca,this.programConfigurations=new cl(e.layers,{zoom:e.zoom,lut:e.lut},i=>Mf.includes(i)),this._segments=new On,this.hiddenByLandmarkVertexArray=new qu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new On}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,c=!1){const l=e.length;if(l>2){let d=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let w;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const A=e[0],_=e[1];w=lg(A.sub(e[l-1])._perp()._unit(),_.sub(A)._perp()._unit())}for(let A=0;A<l;A++){const _=A===l-1?0:A+1,T=e[A],C=e[_],E=e[_===l-1?0:_+1],M=C.sub(T)._perp()._unit(),z=lg(M,E.sub(C)._perp()._unit()),N=w,V=z;if(Df(T,C,i)||c&&ug(T,i)&&ug(C,i)){w=z;continue}const Z=y.vertexLength;Jm(this.vertexArray,T,C,1,1,N),Jm(this.vertexArray,T,C,1,0,N),Jm(this.vertexArray,T,C,0,1,V),Jm(this.vertexArray,T,C,0,0,V),y.vertexLength+=4;const H=If(T,C,M,s);for(const q of H)this._segmentToGroundQuads[d].push({id:Z,region:q}),this._segmentToRegionTriCounts[d][q]+=2,y.primitiveLength+=2;w=z}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((c,l)=>c.region-l.region);for(let s=0;s<i;s++){const c=this._segmentToGroundQuads[s],l=e[s],d=this._segmentToRegionTriCounts[s];d.reduce((w,A)=>w+A,0);let y=0;for(let w=0;w<=4;w++){const A=d[w];if(A!==0){let _=this.regionSegments[w];_||(_=this.regionSegments[w]=new On);const T={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+y,vertexLength:l.vertexLength,primitiveLength:A};_.get().push(T)}y+=A}for(let w=0;w<c.length;w++){const A=c[w].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,c,l,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,c,l,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Ny.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,c,l,d,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,c,l,d,y)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&th?1:0;for(let c=e.groundVertexArrayOffset;c<i;++c)this.hiddenByLandmarkVertexArray.emplace(c,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,I0.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Rp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ca,this.footprintVertices=new Bo,this.footprintSegments=[],this.layoutVertexArray=new No,this.centroidVertexArray=new Kl,this.wallVertexArray=new pp,this.indexArray=new ca,this.programConfigurations=new cl(e.layers,{zoom:e.zoom,lut:e.lut},i=>D0.includes(i)),this.segments=new On,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Rf(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,s,c){this.features=[],this.hasPattern=km("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=h(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:l,id:d,index:y,sourceLayerIndex:w}of e){const A=this.layers[0]._featureFilter.needGeometry,_=k(l,A);if(!this.layers[0]._featureFilter.filter(new Ln(this.zoom),_,s))continue;const T={id:d,sourceLayerIndex:w,index:y,geometry:A?_.geometry:P(l,s,c),properties:l.properties,type:l.type,patterns:{}},C=this.layoutVertexArray.length,E=sg[T.type]==="Polygon";if(this.hasPattern)this.features.push(Bm("fill-extrusion",this.layers,T,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const M of T.geometry)for(const z of ac(M,E))this.addFeature(T,[z],y,s,{},i.availableImages,c,i.brightness);else this.addFeature(T,T.geometry,y,s,{},i.availableImages,c,i.brightness);i.featureIndex.insert(l,T.geometry,y,w,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,c,l,d){for(const y of this.features){const w=sg[y.type]==="Polygon",{geometry:A}=y;if(this.wallMode)for(const _ of A)for(const T of ac(_,w))this.addFeature(y,[T],y.index,i,s,c,l,d);else this.addFeature(y,A,y.index,i,s,c,l,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,c,l,d,y){this.programConfigurations.updatePaintArrays(e,i,l,s,c,d,y),this.groundEffect.update(e,i,l,s,c,d,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,tg.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Fy.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,eg.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,c,l,d,y,w){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new Ft(0,0),new Ft(Bt,Bt)],T=y.projection,C=T.name==="globe",E=this.wallMode||sg[e.type]==="Polygon",M=new Cf;M.centroidDataIndex=this.centroidData.length;const z=new cd,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);let Z;if(z.height=V,z.vertexArrayOffset=this.layoutVertexArray.length,z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Yh),this.wallMode){if(C)return void Kn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;Z=function(ue){const Te=ue[0].x===ue[ue.length-1].x&&ue[0].y===ue[ue.length-1].y;(function(Nt){let St=0;const wi=Nt.length;for(let Xt=0;Xt<wi;Xt++)St+=(Nt[(Xt+1)%wi].x-Nt[Xt].x)*(Nt[(Xt+1)%wi].y+Nt[Xt].y);return St>=0})(ue)||(ue=ue.reverse());const Ee={geometry:[],joinNormals:[],indices:[]},De=[],Re=[],ke=[];let Pe=ue.length;for(;Pe>=2&&ue[Pe-1].equals(ue[Pe-2]);)Pe--;if(Pe<(Te?3:2))return Ee;let Ze,Ue,Xe,bt,xt,ei=0;for(;ei<Pe-1&&ue[ei].equals(ue[ei+1]);)ei++;Te&&(Ze=ue[Pe-2],xt=ue[ei].sub(Ze)._unit()._perp());for(let Nt=ei;Nt<Pe;Nt++){if(Xe=Nt===Pe-1?Te?ue[ei+1]:void 0:ue[Nt+1],Xe&&ue[Nt].equals(Xe))continue;xt&&(bt=xt),Ze&&(Ue=Ze),Ze=ue[Nt],xt=Xe?Xe.sub(Ze)._unit()._perp():bt,bt=bt||xt;let St=bt.add(xt);St.x===0&&St.y===0||St._unit();const wi=St.x*xt.x+St.y*xt.y,Xt=wi!==0?1/wi:1/0,ci=bt.x*xt.y-bt.y*xt.x>0;let Li="miter";const Wi=2;Li==="miter"&&Xt>Wi&&(Li="bevel"),Li==="bevel"&&(Xt>100&&(Li="flipbevel"),Xt<Wi&&(Li="miter"));const ki=(an,Yi,un,Cn)=>{const er=new Ft(an.x,an.y),Oi=new Ft(an.x,an.y);er.x+=Yi.x*Cn,er.y+=Yi.y*Cn,Oi.x-=Yi.x*Math.max(un,1),Oi.y-=Yi.y*Math.max(un,1),ke.push(Yi),De.push(er),Re.push(Oi)};if(Li==="miter")St._mult(Xt),ki(Ze,St,0,0);else if(Li==="flipbevel")St=xt.mult(-1),ki(Ze,St,0,0),ki(Ze,St.mult(-1),0,0);else{const an=-Math.sqrt(Xt*Xt-1),Yi=ci?an:0,un=ci?0:an;Ue&&ki(Ze,bt,Yi,un),Xe&&ki(Ze,xt,Yi,un)}}Ee.geometry=[...De,...Re.reverse(),De[0]],Ee.joinNormals=[...ke,...ke.reverse(),ke[ke.length-1]];const zt=Ee.geometry.length-1;for(let Nt=0;Nt<zt/2;Nt++)if(Nt+1<zt/2){let St=Nt,wi=Nt+1,Xt=zt-1-Nt,ci=zt-2-Nt;St=St===0?zt-1:St-1,wi=wi===0?zt-1:wi-1,Xt=Xt===0?zt-1:Xt-1,ci=ci===0?zt-1:ci-1,Ee.indices.push(Xt),Ee.indices.push(wi),Ee.indices.push(St),Ee.indices.push(Xt),Ee.indices.push(ci),Ee.indices.push(wi)}return Ee}(i[0]),i=[Z.geometry]}const H=(ue,Te)=>ue<(Te.length-1)/2||ue===Te.length-1,q=this.wallMode?[i]:Pm(i,500);for(let ue=q.length-1;ue>=0;ue--){const Te=q[ue];(Te.length===0||(Y=Te[0]).every(pe=>pe.x<=0)||Y.every(pe=>pe.x>=Bt)||Y.every(pe=>pe.y<=0)||Y.every(pe=>pe.y>=Bt))&&q.splice(ue,1)}var Y;let K;if(C)K=zf(q,_,c);else{K=[];for(const ue of q)K.push({polygon:ue,bounds:_})}const ee=E?this.edgeRadius:0,he=ee>0&&this.zoom<17,le=(ue,Te)=>{if(ue.length===0)return!1;const pe=ue[ue.length-1];return Te.x===pe.x&&Te.y===pe.y};for(const{polygon:ue,bounds:Te}of K){let pe=0,Ee=0;for(const Pe of ue)E&&!Pe[0].equals(Pe[Pe.length-1])&&Pe.push(Pe[0]),Ee+=E?Pe.length-1:Pe.length;const De=this.segments.prepareSegment((E?5:4)*Ee,this.layoutVertexArray,this.indexArray);z.footprintSegIdx<0&&(z.footprintSegIdx=this.footprintSegments.length),z.polygonSegIdx<0&&(z.polygonSegIdx=this.polygonSegments.length);const Re={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ke=new og;if(ke.vertexOffset=this.footprintVertices.length,ke.indexOffset=3*this.footprintIndices.length,ke.ringIndices=[],E){const Pe=[],Ze=[];pe=De.vertexLength;for(let Xe=0;Xe<ue.length;Xe++){const bt=ue[Xe];bt.length&&Xe!==0&&Ze.push(Pe.length/2);const xt=[];let ei,zt;ei=bt[1].sub(bt[0])._perp()._unit(),ke.ringIndices.push(bt.length-1);for(let Nt=1;Nt<bt.length;Nt++){const St=bt[Nt],wi=bt[Nt===bt.length-1?1:Nt+1],Xt=St.clone();if(ee){zt=wi.sub(St)._perp()._unit();const ci=ei.add(zt)._unit(),Li=ee*Math.min(4,1/(ei.x*ci.x+ei.y*ci.y));Xt.x+=Li*ci.x,Xt.y+=Li*ci.y,Xt.x=Math.round(Xt.x),Xt.y=Math.round(Xt.y),ei=zt}if(!N||ee!==0&&!he||le(xt,Xt)||xt.push(Xt),Mp(this.layoutVertexArray,Xt.x,Xt.y,0,0,1,1,0),this.wallMode){const ci=H(Nt,bt);Cp(this.wallVertexArray,Z.joinNormals[Nt],!ci)}De.vertexLength++,this.footprintVertices.emplaceBack(St.x,St.y),Pe.push(St.x,St.y),C&&Ip(this.layoutVertexExtArray,T.projectTilePoint(Xt.x,Xt.y,c),T.upVector(c,Xt.x,Xt.y))}N&&(ee===0||he)&&(xt.length!==0&&le(xt,xt[0])&&xt.pop(),this.groundEffect.addData(xt,Te,A))}const Ue=this.wallMode?Z.indices:Wu(Pe,Ze);for(let Xe=0;Xe<Ue.length;Xe+=3)this.footprintIndices.emplaceBack(ke.vertexOffset+Ue[Xe+0],ke.vertexOffset+Ue[Xe+1],ke.vertexOffset+Ue[Xe+2]),this.indexArray.emplaceBack(pe+Ue[Xe],pe+Ue[Xe+2],pe+Ue[Xe+1]),De.primitiveLength++;ke.indexCount+=Ue.length,ke.vertexCount+=this.footprintVertices.length-ke.vertexOffset}for(let Pe=0;Pe<ue.length;Pe++){const Ze=ue[Pe];M.startRing(z,Ze[0]);let Ue=Ze.length>4&&hg(Ze[Ze.length-2],Ze[0],Ze[1]),Xe=ee?cg(Ze[Ze.length-2],Ze[0],Ze[1],ee):0;const bt=[];let xt,ei,zt;ei=Ze[1].sub(Ze[0])._perp()._unit();let Nt=!0;for(let St=1,wi=0;St<Ze.length;St++){let Xt=Ze[St-1],ci=Ze[St];const Li=Ze[St===Ze.length-1?1:St+1];if(M.appendEdge(z,ci,Xt),Df(ci,Xt,Te)){ee&&(ei=Li.sub(ci)._perp()._unit(),Nt=!Nt);continue}const Wi=ci.sub(Xt)._perp(),ki=Wi.x/(Math.abs(Wi.x)+Math.abs(Wi.y)),an=Wi.y>0?1:0,Yi=Xt.dist(ci);if(wi+Yi>32768&&(wi=0),ee){zt=Li.sub(ci)._perp()._unit();let Oi=Qm(Xt,ci,Li,Dp(ei,zt),ee);isNaN(Oi)&&(Oi=0);const _n=ci.sub(Xt)._unit();Xt=Xt.add(_n.mult(Xe))._round(),ci=ci.add(_n.mult(-Oi))._round(),Xe=Oi,ei=zt,N&&this.zoom>=17&&(le(bt,Xt)||bt.push(Xt),le(bt,ci)||bt.push(ci))}const un=De.vertexLength,Cn=Ze.length>4&&hg(Xt,ci,Li);let er=Hy(wi,Ue,Nt);if(Mp(this.layoutVertexArray,Xt.x,Xt.y,ki,an,0,0,er),Mp(this.layoutVertexArray,Xt.x,Xt.y,ki,an,0,1,er),this.wallMode){const Oi=H(St-1,Ze),_n=Z.joinNormals[St-1];Cp(this.wallVertexArray,_n,Oi),Cp(this.wallVertexArray,_n,Oi)}if(wi+=Yi,er=Hy(wi,Cn,!Nt),Ue=Cn,Mp(this.layoutVertexArray,ci.x,ci.y,ki,an,0,0,er),Mp(this.layoutVertexArray,ci.x,ci.y,ki,an,0,1,er),this.wallMode){const Oi=H(St,Ze),_n=Z.joinNormals[St];Cp(this.wallVertexArray,_n,Oi),Cp(this.wallVertexArray,_n,Oi)}if(De.vertexLength+=4,this.indexArray.emplaceBack(un+0,un+1,un+2),this.indexArray.emplaceBack(un+1,un+3,un+2),De.primitiveLength+=2,ee){const Oi=pe+(St===1?Ze.length-2:St-2),_n=St===1?pe:Oi+1;if(this.indexArray.emplaceBack(un+1,Oi,un+3),this.indexArray.emplaceBack(Oi,_n,un+3),De.primitiveLength+=2,xt===void 0&&(xt=un),!Df(Li,Ze[St],Te)){const ur=St===Ze.length-1?xt:De.vertexLength;this.indexArray.emplaceBack(un+2,un+3,ur),this.indexArray.emplaceBack(un+3,ur+1,ur),this.indexArray.emplaceBack(un+3,_n,ur+1),De.primitiveLength+=3}Nt=!Nt}if(C){const Oi=this.layoutVertexExtArray,_n=T.projectTilePoint(Xt.x,Xt.y,c),ur=T.projectTilePoint(ci.x,ci.y,c),_r=T.upVector(c,Xt.x,Xt.y),wr=T.upVector(c,ci.x,ci.y);Ip(Oi,_n,_r),Ip(Oi,_n,_r),Ip(Oi,ur,wr),Ip(Oi,ur,wr)}}E&&(pe+=Ze.length-1),N&&ee&&this.zoom>=17&&(bt.length!==0&&le(bt,bt[0])&&bt.pop(),this.groundEffect.addData(bt,Te,A,ee>0))}this.footprintSegments.push(ke),Re.triangleCount=this.indexArray.length-Re.triangleArrayOffset,this.polygonSegments.push(Re),++z.footprintSegLen,++z.polygonSegLen}if(z.vertexCount=this.layoutVertexArray.length-z.vertexArrayOffset,z.groundVertexCount=this.groundEffect.vertexArray.length-z.groundVertexArrayOffset,z.vertexCount!==0){if(z.centroidXY=M.borders?Gy:this.encodeCentroid(M,z),this.centroidData.push(z),M.borders){this.featuresOnBorder.push(M);const ue=this.featuresOnBorder.length-1;for(let Te=0;Te<M.borders.length;Te++)M.borders[Te][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Te].push(ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,d,c,w),this.groundEffect.addPaintPropertiesData(e,s,l,d,c,w),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const w=this.centroidData[y],A=+(w.min.y+w.max.y>Bt),_=2*A+(+(w.min.x+w.max.x>Bt)^A);for(let T=0;T<w.polygonSegLen;T++){const C=w.polygonSegIdx+T;e.push({centroidIdx:y,subtile:_,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const i=new ca;e.sort((y,w)=>y.triangleSegmentIdx===w.triangleSegmentIdx?y.subtile-w.subtile:y.triangleSegmentIdx-w.triangleSegmentIdx);let s=0,c=0,l=0;for(const y of e){if(y.triangleSegmentIdx!==s)break;l++}const d=e.length;for(;c!==e.length;){s=e[c].triangleSegmentIdx;let y=0,w=c,A=c;for(let _=w;_<l&&e[_].subtile===y;_++)A++;for(;w!==l;){const _=e[w];y=_.subtile;const T=this.centroidData[_.centroidIdx].min.clone(),C=this.centroidData[_.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=w;M<A;M++){const z=e[M],N=this.polygonSegments[z.polygonSegmentIdx],V=this.centroidData[z.centroidIdx].min,Z=this.centroidData[z.centroidIdx].max,H=this.indexArray.uint16;for(let q=N.triangleArrayOffset;q<N.triangleArrayOffset+N.triangleCount;q++)i.emplaceBack(H[3*q],H[3*q+1],H[3*q+2]);E.primitiveLength+=N.triangleCount,T.x=Math.min(T.x,V.x),T.y=Math.min(T.y,V.y),C.x=Math.max(C.x,Z.x),C.y=Math.max(C.y,Z.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:T,max:C}),w=A;for(let M=w;M<l&&e[M].subtile===e[w].subtile;M++)A++}c=l;for(let _=c;_<d&&e[_].triangleSegmentIdx===e[c].triangleSegmentIdx;_++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const c=new On;if(this.wallMode){for(const z of this.triangleSubSegments)c.segments.push(z.segment);return c}let l=0,d=0;const y=1<<e.canonical.z;if(i){const z=i.getMinMaxForTile(e);z&&(l=z.min,d=z.max)}d+=this.maxHeight;const w=e.toUnwrapped();let A;const _=[w.canonical.x/y+w.wrap,w.canonical.y/y],T=[(w.canonical.x+1)/y+w.wrap,(w.canonical.y+1)/y],C=(z,N,V)=>[z[0]*(1-V[0])+N[0]*V[0],z[1]*(1-V[1])+N[1]*V[1]],E=[],M=[];for(const z of this.triangleSubSegments){E[0]=z.min.x/Bt,E[1]=z.min.y/Bt,M[0]=z.max.x/Bt,M[1]=z.max.y/Bt;const N=C(_,T,E),V=C(_,T,M);if(new jt([N[0],N[1],l],[V[0],V[1],d]).intersectsPrecise(s)===0){A&&(c.segments.push(A),A=void 0);continue}const Z=z.segment;A&&A.vertexOffset!==Z.vertexOffset&&(c.segments.push(A),A=void 0),A?(A.vertexLength+=Z.vertexLength,A.primitiveLength+=Z.primitiveLength):A={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&c.segments.push(A),c}encodeCentroid(e,i){const s=e.centroid(),c=i.span(),l=Math.min(7,Math.round(c.x*this.tileToMeter/10)),d=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Ft(vt(s.x,1,Bt-1)<<3|l,vt(s.y,1,Bt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Ft(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const c=i[0][0]!==s?0:1;return new Ft(6|(i[0][0]!==s?0:65528),(i[c][0]+i[c][1])/2<<3|6)}{const c=i[2][0]!==s?2:3;return new Ft((i[c][0]+i[c][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=th,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,c=e.flags&th?Gy:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||l!==c.x){for(let d=i;d<s;++d)this.centroidVertexArray.emplace(d,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(yo(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const l=[];for(const d of this.activeReplacements){if(d.order<s)continue;const y=Math.max(1,Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z));for(const w of this.centroidData)if(!(w.flags&th||d.min.x>w.max.x||w.min.x>d.max.x||d.min.y>w.max.y||w.min.y>d.max.y))for(let A=0;A<w.footprintSegLen;A++){const _=this.footprintSegments[w.footprintSegIdx+A];if(l.length=0,O0(this.footprintVertices,_.vertexOffset,_.vertexCount,d.footprintTileId.canonical,e.canonical,l),rg(d.footprint,l,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-y)){w.flags|=th;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let c=!1;for(let l=0;l<s.footprintSegLen;l++){const d=this.footprintSegments[s.footprintSegIdx+l];let y=0;for(const w of d.ringIndices){for(let A=y,_=w+y-1;A<w+y;_=A++){const T=this.footprintVertices.int16[2*(A+d.vertexOffset)+0],C=this.footprintVertices.int16[2*(A+d.vertexOffset)+1],E=this.footprintVertices.int16[2*(_+d.vertexOffset)+1];C>i!=E>i&&e<(this.footprintVertices.int16[2*(_+d.vertexOffset)+0]-T)*(i-C)/(E-C)+T&&(c=!c)}y=w}}return c}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,c=!0;const l=4*(e+Bt)*Bt+(i+Bt);if(this.partLookup.hasOwnProperty(l)){const d=this.partLookup[l];return d?{height:d.height,hidden:!!(d.flags&th)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>s&&(s=d.height,this.partLookup[l]=d,c=!!(d.flags&th));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:c};this.partLookup[l]=void 0}}function Dp(a,e){const i=a.add(e)._unit();return a.x*i.x+a.y*i.y}function cg(a,e,i,s){const c=e.sub(a)._perp()._unit(),l=i.sub(e)._perp()._unit();return Qm(a,e,i,Dp(c,l),s)}function Qm(a,e,i,s,c){const l=Math.sqrt(1-s*s);return Math.min(a.dist(e)/3,e.dist(i)/3,c*l/s)}function Df(a,e,i){return a.x<i[0].x&&e.x<i[0].x||a.x>i[1].x&&e.x>i[1].x||a.y<i[0].y&&e.y<i[0].y||a.y>i[1].y&&e.y>i[1].y}function ug(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function hg(a,e,i){if(a.x<0||a.x>=Bt||e.x<0||e.x>=Bt||i.x<0||i.x>=Bt)return!1;const s=i.sub(e),c=s.perp(),l=a.sub(e);return(s.x*l.x+s.y*l.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(l.x*l.x+l.y*l.y))>-.866&&c.x*l.x+c.y*l.y<0}function Hy(a,e,i){const s=e?2|a:-3&a;return i?1|s:-2&s}function dg(){const a=Math.PI/32,e=Math.tan(a),i=tc;return i*Math.sqrt(1+2*e*e)-i}function zf(a,e,i){const s=1<<i.z,c=Ea(i.x/s),l=Ea((i.x+1)/s),d=Vn(i.y/s),y=Vn((i.y+1)/s);return function(w,A,_,T,C=0,E){const M=[];if(!w.length||!_||!T)return M;const z=(K,ee)=>{for(const he of K)M.push({polygon:he,bounds:ee})},N=Math.ceil(Math.log2(_)),V=Math.ceil(Math.log2(T)),Z=N-V,H=[];for(let K=0;K<Math.abs(Z);K++)H.push(Z>0?0:1);for(let K=0;K<Math.min(N,V);K++)H.push(0),H.push(1);let q=w;if(q=Xm(q,A[0].y-C,A[1].y+C,1),q=Xm(q,A[0].x-C,A[1].x+C,0),!q.length)return M;const Y=[];for(H.length?Y.push({polygons:q,bounds:A,depth:0}):z(q,A);Y.length;){const K=Y.pop(),ee=K.depth,he=H[ee],le=K.bounds[0],ue=K.bounds[1],Te=he===0?le.x:le.y,pe=he===0?ue.x:ue.y,Ee=E?E(he,Te,pe):.5*(Te+pe),De=Xm(K.polygons,Te-C,Ee+C,he),Re=Xm(K.polygons,Ee-C,pe+C,he);if(De.length){const ke=[le,new Ft(he===0?Ee:ue.x,he===1?Ee:ue.y)];H.length>ee+1?Y.push({polygons:De,bounds:ke,depth:ee+1}):z(De,ke)}if(Re.length){const ke=[new Ft(he===0?Ee:le.x,he===1?Ee:le.y),ue];H.length>ee+1?Y.push({polygons:Re,bounds:ke,depth:ee+1}):z(Re,ke)}}return M}(a,e,Math.ceil((l-c)/11.25),Math.ceil((d-y)/11.25),1,(w,A,_)=>{if(w===0)return .5*(A+_);{const T=Vn((i.y+A/Bt)/s);return(ss(.5*(Vn((i.y+_/Bt)/s)+T))*s-i.y)*Bt}})}function O0(a,e,i,s,c,l){const d=Math.pow(2,s.z-c.z);for(let y=0;y<i;y++){let w=a.int16[2*(y+e)+0],A=a.int16[2*(y+e)+1];w=(w+c.x*Bt)*d-s.x*Bt,A=(A+c.y*Bt)*d-s.y*Bt,l.push(new Ft(w,A))}}let Zy,$y;function ih(a,e){return a.x*e.x+a.y*e.y}function zp(a,e){if(a.length===1){let i=0;const s=e[i++];let c;for(;!c||s.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const l=e[i],d=a[0],y=c.sub(s),w=l.sub(s),A=d.sub(s),_=ih(y,y),T=ih(y,w),C=ih(w,w),E=ih(A,y),M=ih(A,w),z=_*C-T*T,N=(C*E-T*M)/z,V=(_*M-T*E)/z,Z=s.z*(1-N-V)+c.z*N+l.z*V;if(isFinite(Z))return Z}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function e_(a,e,i,s,c,l,d,y){const w=d*c.getElevationAt(a,e,!0,!0),A=l[0]!==0,_=A?l[1]===0?d*(l[0]/7-450):d*function(T,C,E){const M=Math.floor(C[0]/8),z=Math.floor(C[1]/8),N=10*(C[0]-8*M),V=10*(C[1]-8*z),Z=T.getElevationAt(M,z,!0,!0),H=T.getMeterToDEM(E),q=Math.floor(.5*(N*H-1)),Y=Math.floor(.5*(V*H-1)),K=T.tileCoordToPixel(M,z),ee=2*q+1,he=2*Y+1,le=function(Re,ke,Pe,Ze,Ue){return[Re.getElevationAtPixel(ke,Pe,!0),Re.getElevationAtPixel(ke+Ue,Pe,!0),Re.getElevationAtPixel(ke,Pe+Ue,!0),Re.getElevationAtPixel(ke+Ze,Pe+Ue,!0)]}(T,K.x-q,K.y-Y,ee,he),ue=Math.abs(le[0]-le[1]),Te=Math.abs(le[2]-le[3]),pe=Math.abs(le[0]-le[2])+Math.abs(le[1]-le[3]),Ee=Math.min(.25,.5*H*(ue+Te)/ee),De=Math.min(.25,.5*H*pe/he);return Z+Math.max(Ee*N,De*V)}(c,l,y):w;return{base:w+(i===0?-1:i),top:A?Math.max(_+s,w+i+2):w+s}}Wt(Rp,"FillExtrusionBucket",{omit:["layers","features"]}),Wt(cd,"PartData"),Wt(og,"FootprintSegment"),Wt(Cf,"BorderCentroidData"),Wt(Rf,"GroundEffect");const P0=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Lp=wn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:k0}=P0,Xy=wn([{name:"a_packed",components:3,type:"Float32"}]),{members:Yy}=Xy,Wy=wn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Ky}=Wy;class t_{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new rc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=Gr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const c=[];let l=e.length%2==1?-e[e.length-1]*s:0,d=e[0]*s,y=!0;c.push({left:l,right:d,isDash:y,zeroLength:e[0]===0});let w=e[0];for(let A=1;A<e.length;A++){y=!y;const _=e[A];l=w*s,w+=_,d=w*s,c.push({left:l,right:d,isDash:y,zeroLength:_===0})}return c}addRoundDash(e,i,s){const c=i/2;for(let l=-s;l<=s;l++){const d=this.width*(this.nextRow+s+l);let y=0,w=e[y];for(let A=0;A<this.width;A++){A/w.right>1&&(w=e[++y]);const _=Math.abs(A-w.left),T=Math.abs(A-w.right),C=Math.min(_,T);let E;const M=l/s*(c+1);if(w.isDash){const z=c-Math.abs(M);E=Math.sqrt(C*C+z*z)}else E=c-Math.sqrt(C*C+M*M);this.image.data[d+A]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const A=e[w],_=e[w+1];A.zeroLength?e.splice(w,1):_&&_.isDash===A.isDash&&(_.left=A.left,e.splice(w,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const l=this.width*this.nextRow;let d=0,y=e[d];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++d]);const A=Math.abs(w-y.left),_=Math.abs(w-y.right),T=Math.min(A,_);this.image.data[l+w]=Math.max(0,Math.min(255,(y.isDash?T:-T)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const c=i==="round",l=c?7:0,d=2*l+1;if(this.nextRow+d>this.height)return Kn("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let _=0;_<e.length;_++)e[_]<0&&(Kn("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),y+=e[_];if(y!==0){const _=this.width/y,T=this.getDashRanges(e,this.width,_);c?this.addRoundDash(T,_,l):this.addRegularDash(T,i==="square"?.5*_:0)}const w=this.nextRow+l;this.nextRow+=d;const A={tl:[w,l],br:[y,0]};return this.positions[s]=A,A}}Wt(t_,"LineAtlas");const Jy=Qc.VectorTileFeature.types,i_=Math.cos(Math.PI/180*37.5),B0=Math.cos(Math.PI/180*5);class fg{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new nf,this.layoutVertexArray2=new xs,this.patternVertexArray=new xs,this.indexArray=new ca,this.programConfigurations=new cl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new On,this.maxLineLength=0,this.zOffsetVertexArray=new xs,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Bt/64}updateFootprints(e,i){}populate(e,i,s,c){this.hasPattern=km("line",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("line-sort-key");this.tileToMeter=h(s);const d=this.layers[0].layout.get("line-z-offset"),y=d.isConstant()&&!d.constantOr(0),w=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=w==="sea"||w==="ground"||!y&&w==="none",this.hasZOffset&&w==="none"&&Kn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const A=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&A!==void 0;const _=[];for(const{feature:M,id:z,index:N,sourceLayerIndex:V}of e){const Z=this.layers[0]._featureFilter.needGeometry,H=k(M,Z);if(!this.layers[0]._featureFilter.filter(new Ln(this.zoom),H,s))continue;const q=l?l.evaluate(H,{},s):void 0,Y={id:z,properties:M.properties,type:M.type,sourceLayerIndex:V,index:N,geometry:Z?H.geometry:P(M,s,c),patterns:{},sortKey:q};_.push(Y)}l&&_.sort((M,z)=>M.sortKey-z.sortKey);const{lineAtlas:T,featureIndex:C}=i,E=this.addConstantDashes(T);for(const M of _){const{geometry:z,index:N,sourceLayerIndex:V}=M;if(E&&this.addFeatureDashes(M,T),this.hasPattern){const Z=Bm("line",this.layers,M,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Z)}else this.addFeature(M,z,N,s,T.positions,i.availableImages,i.brightness);C.insert(e[N].feature,z,N,V,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,l=s.layout.get("line-cap").value;if(c.kind!=="constant"||l.kind!=="constant")i=!0;else{const d=l.value,y=c.value;if(!y)continue;e.addDash(y,d)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const c of this.layers){const l=c.paint.get("line-dasharray").value,d=c.layout.get("line-cap").value;if(l.kind==="constant"&&d.kind==="constant")continue;let y,w;if(l.kind==="constant"){if(y=l.value,!y)continue}else y=l.evaluate({zoom:s},e);w=d.kind==="constant"?d.value:d.evaluate({zoom:s},e),i.addDash(y,w),e.patterns[c.id]=i.getKey(y,w)}}update(e,i,s,c,l,d,y){this.programConfigurations.updatePaintArrays(e,i,l,s,c,d,y)}addFeatures(e,i,s,c,l,d){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,s,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Yy)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Ky)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Lp.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,k0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,c,l,d,y){const w=this.layers[0].layout,A=w.get("line-join").evaluate(e,{}),_=w.get("line-cap").evaluate(e,{}),T=w.get("line-miter-limit"),C=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=w.get("line-z-offset").value;const E=this.layers[0].paint.get("line-width").value;E.kind!=="constant"&&E.isLineProgressConstant===!1&&(this.variableWidthValue=E);for(const M of i)this.addLine(M,e,c,A,_,T,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,l,d,c,y)}addLine(e,i,s,c,l,d,y){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const w=c==="none";if(this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<e.length-1;H++)this.totalDistance+=e[H].dist(e[H+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=Jy[i.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let T=0;for(;T<_-1&&e[T].equals(e[T+1]);)T++;if(_<(A?3:2))return;c==="bevel"&&(d=1.05);const C=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let E,M,z,N,V,Z;this.e1=this.e2=-1,A&&(E=e[_-2],V=e[T].sub(E)._unit()._perp());for(let H=T;H<_;H++){if(z=H===_-1?A?e[T+1]:void 0:e[H+1],z&&e[H].equals(z))continue;V&&(N=V),E&&(M=E),E=e[H],Z=this.evaluateLineProgressFeatures(M?M.dist(E):0),V=z?z.sub(E)._unit()._perp():N,N=N||V;const q=M&&z;let Y=q?c:A||w?"butt":l;const K=N.x*V.x+N.y*V.y;if(w){const De=function(Re){if(Re.patternJoinNone){const ke=Re.segmentPoints.length/2,Pe=Re.lineSoFar-Re.segmentStart;for(let Ze=0;Ze<ke;++Ze){const Ue=Re.segmentPoints[2*Ze+1],Xe=Math.round(Re.segmentPoints[2*Ze])+.5+.25*Ue;Re.patternVertexArray.emplaceBack(Xe,Pe,Re.segmentStart),Re.patternVertexArray.emplaceBack(Xe,Pe,Re.segmentStart)}Re.segmentPoints.length=0}Re.e1=Re.e2=-1};if(q&&K<B0){this.updateDistance(M,E),this.addCurrentVertex(E,N,1,1,C,Z),De(this),this.addCurrentVertex(E,V,-1,-1,C,Z);continue}if(M){if(!z){this.updateDistance(M,E),this.addCurrentVertex(E,N,1,1,C,Z),De(this);continue}Y="miter"}}let ee=N.add(V);ee.x===0&&ee.y===0||ee._unit();const he=ee.x*V.x+ee.y*V.y,le=he!==0?1/he:1/0,ue=2*Math.sqrt(2-2*he),Te=he<i_&&M&&z,pe=N.x*V.y-N.y*V.x>0,Ee=this.overscaling<=16?15*Bt/(512*this.overscaling):0;if(q&&Y==="round"){if(le<y)Y="miter";else if(le<=2){const De=Op(E,-10,Bt+10);Y=this.hasZOffset&&(De||this.hasCrossSlope)?"miter":"fakeround"}}if(Y==="miter"&&le>d&&(Y="bevel"),Y==="bevel"&&(le>2&&(Y="flipbevel"),le<d&&(Y="miter")),M&&!(Y==="miter"&&Te)&&this.updateDistance(M,E),Y==="miter")if(Te){const De=E.dist(M);if(De>2*Ee){const ke=E.sub(E.sub(M)._mult(Ee/De)._round());this.updateDistance(M,ke),this.addCurrentVertex(ke,N,0,0,C,Z),M=ke}this.updateDistance(M,E),ee._mult(le),this.addCurrentVertex(E,ee,0,0,C,Z);const Re=E.dist(z);if(Re>2*Ee){const ke=E.add(z.sub(E)._mult(Ee/Re)._round());this.updateDistance(E,ke),this.addCurrentVertex(ke,V,0,0,C,Z),E=ke}}else ee._mult(le),this.addCurrentVertex(E,ee,0,0,C,Z);else if(Y==="flipbevel"){if(le>100)ee=V.mult(-1);else{const De=le*N.add(V).mag()/N.sub(V).mag();ee._perp()._mult(De*(pe?-1:1))}this.addCurrentVertex(E,ee,0,0,C,Z),this.addCurrentVertex(E,ee.mult(-1),0,0,C,Z)}else if(Y==="bevel"||Y==="fakeround"){Z!=null&&M&&this.addCurrentVertex(E,N,-1,-1,C,Z);const De=E.dist(M)<=2*Ee&&Y!=="bevel",Re=ee.mult(pe?1:-1);Re._mult(le);const ke=V.mult(pe?-1:1),Pe=N.mult(pe?-1:1),Ze=this.evaluateLineProgressFeatures(this.distance);if(Z==null&&(this.addHalfVertex(E,Re.x,Re.y,!1,!pe,0,C,Ze),De||this.addHalfVertex(E,Re.x+2*Pe.x,Re.y+2*Pe.y,!1,pe,0,C,Ze)),Y==="fakeround"){const Ue=Math.round(180*ue/Math.PI/20);this.addHalfVertex(E,Pe.x,Pe.y,!1,pe,0,C,Ze);for(let Xe=0;Xe<Ue;Xe++){let bt=Xe/Ue;if(bt!==.5){const ei=bt-.5;bt+=bt*ei*(bt-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*ei*ei+(.848013+K*(.215638*K-1.06021)))}const xt=ke.sub(Pe)._mult(bt)._add(Pe)._unit();this.addHalfVertex(E,xt.x,xt.y,!1,pe,0,C,Ze)}this.addHalfVertex(E,ke.x,ke.y,!1,pe,0,C,Ze)}De||Z!=null||this.addHalfVertex(E,Re.x+2*ke.x,Re.y+2*ke.y,!1,pe,0,C,Ze),Z!=null&&z&&this.addCurrentVertex(E,V,1,1,C,Z)}else Y==="butt"?this.addCurrentVertex(E,ee,0,0,C,Z):Y==="square"?(M||this.addCurrentVertex(E,ee,-1,-1,C,Z),this.addCurrentVertex(E,ee,0,0,C,Z),M&&this.addCurrentVertex(E,ee,1,1,C,Z)):Y==="round"&&(M&&(this.addCurrentVertex(E,N,0,0,C,Z),this.addCurrentVertex(E,N,1,1,C,Z,!0)),z&&(this.addCurrentVertex(E,V,-1,-1,C,Z,!0),this.addCurrentVertex(E,V,0,0,C,Z)))}}addVerticesTo(e,i,s,c,l,d,y,w,A,_){const T=(i.w-e.w)/this.tessellationStep|0;let C=0;const E=this.scaledDistance;if(T>1){this.lineSoFar=e.w;const z=(i.x-e.x)/T,N=(i.y-e.y)/T,V=(i.z-e.z)/T,Z=(i.w-e.w)/T;for(let H=1;H<T;++H){e.x+=z,e.y+=N,e.z+=V,this.lineSoFar+=Z,C+=Z;const q=this.evaluateLineProgressFeatures(this.prevDistance+C);this.scaledDistance=(this.prevDistance+C)/this.totalDistance,this.addHalfVertex(e,s,c,_,!1,y,A,q),this.addHalfVertex(e,l,d,_,!0,-w,A,q)}}this.lineSoFar=i.w,this.scaledDistance=E;const M=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,c,_,!1,y,A,M),this.addHalfVertex(i,l,d,_,!0,-w,A,M)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Kn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}:{zOffset:0,variableWidth:i}}addCurrentVertex(e,i,s,c,l,d,y=!1){const w=i.x+i.y*s,A=i.y-i.x*s,_=i.y*c-i.x,T=-i.y-i.x*c;if(d!=null){const C=this.hasZOffset,E=-10,M=Bt+10,z=d.zOffset,N=new Vy(e.x,e.y,z,this.lineSoFar),V=!!C&&Op(e,E,M),Z=this.lineSoFar,H=this.distance;if(this.currentVertex)if(V){const q=this.currentVertexIsOutside,Y=this.currentVertex,K=new Vy(e.x,e.y,z,this.lineSoFar);if(ig(Y,K,E,M),!Op(K,E,M)){if(q){this.e1=this.e2=-1,this.distance-=Y.dist(N),this.lineSoFar=Y.w;const ee=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,w,A,y,!1,s,l,ee),this.addHalfVertex(Y,_,T,y,!0,-c,l,ee),this.prevDistance=this.distance}this.distance=this.prevDistance+Y.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Y,K,w,A,_,T,s,c,l,y),this.distance=H,this.scaledDistance=this.distance/this.totalDistance}}else{const q=this.currentVertex;if(this.currentVertexIsOutside){ig(q,N,E,M),this.e1=this.e2=-1,this.distance-=q.dist(N),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=q.w;const Y=this.evaluateLineProgressFeatures(q.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(q,w,A,y,!1,s,l,Y),this.addHalfVertex(q,_,T,y,!0,-c,l,Y),this.prevDistance=this.distance,this.distance=H,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(q,N,w,A,_,T,s,c,l,y)}else V||(this.addHalfVertex(e,w,A,y,!1,s,l,d),this.addHalfVertex(e,_,T,y,!0,-c,l,d));this.currentVertex=N,this.currentVertexIsOutside=V,this.lineSoFar=Z}else this.addHalfVertex(e,w,A,y,!1,s,l,d),this.addHalfVertex(e,_,T,y,!0,-c,l,d)}addHalfVertex({x:e,y:i},s,c,l,d,y,w,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const T=yi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,T)}const _=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),w.primitiveLength++),d?this.e2=_:this.e1=_,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Op(a,e,i){return a.x<e||a.x>i||a.y<e||a.y>i}let n_,Pp;function r_(a,e,i){return e*(Bt/(a.tileSize*Math.pow(2,i-a.tileID.overscaledZ)))}Wt(fg,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const pg=(a,e,i)=>(1-i)*a+i*e;function a_(a,e){return 1/r_(a,1,e.tileZoom)}function tu(a,e,i,s){return a.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const iu=a=>{const e=[];nu(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=a.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=a.layout.get("line-join").constantOr("miter")==="none",c=!!a.paint.get("line-pattern").constantOr(1);return s&&c&&e.push("LINE_JOIN_NONE"),e};function nu(a){const e=a.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let ud;const Lf=()=>ud||(ud={layout:n_||(n_=new lr({"line-cap":new Kt($e.layout_line["line-cap"]),"line-join":new Kt($e.layout_line["line-join"]),"line-miter-limit":new Pt($e.layout_line["line-miter-limit"]),"line-round-limit":new Pt($e.layout_line["line-round-limit"]),"line-sort-key":new Kt($e.layout_line["line-sort-key"]),"line-z-offset":new Kt($e.layout_line["line-z-offset"]),"line-elevation-reference":new Pt($e.layout_line["line-elevation-reference"]),"line-cross-slope":new Pt($e.layout_line["line-cross-slope"]),visibility:new Pt($e.layout_line.visibility),"line-width-unit":new Pt($e.layout_line["line-width-unit"])})),paint:Pp||(Pp=new lr({"line-opacity":new Kt($e.paint_line["line-opacity"]),"line-color":new Kt($e.paint_line["line-color"]),"line-translate":new Pt($e.paint_line["line-translate"]),"line-translate-anchor":new Pt($e.paint_line["line-translate-anchor"]),"line-width":new Kt($e.paint_line["line-width"]),"line-gap-width":new Kt($e.paint_line["line-gap-width"]),"line-offset":new Kt($e.paint_line["line-offset"]),"line-blur":new Kt($e.paint_line["line-blur"]),"line-dasharray":new Kt($e.paint_line["line-dasharray"]),"line-pattern":new Kt($e.paint_line["line-pattern"]),"line-gradient":new Gl($e.paint_line["line-gradient"]),"line-trim-offset":new Pt($e.paint_line["line-trim-offset"]),"line-trim-fade-range":new Pt($e.paint_line["line-trim-fade-range"]),"line-trim-color":new Pt($e.paint_line["line-trim-color"]),"line-emissive-strength":new Pt($e.paint_line["line-emissive-strength"]),"line-border-width":new Kt($e.paint_line["line-border-width"]),"line-border-color":new Kt($e.paint_line["line-border-color"]),"line-occlusion-opacity":new Pt($e.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},ud);class nh extends Kt{possiblyEvaluate(e,i){return i=new Ln(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,c){return i=vi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,c)}}let kp;function mg(a,e){return e>0?e+2*a:a}const Bp=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N0=wn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Qy=wn([{name:"a_projected_pos",components:4,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const s_=wn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),ev=wn([{name:"a_texb",components:2,type:"Uint16"}]),F0=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),o_=wn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Np=wn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tv=wn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),wn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Xr=24;const xo=128;function Fp(a,e,i,s,c){if(a.kind==="camera")return a.maxSize;if(a.kind==="composite"){const l=e.possiblyEvaluate(new Ln(a.maxZoom),i).evaluate(c,{},i),d=e.possiblyEvaluate(new Ln(a.minZoom),i).evaluate(c,{},i);return Math.max(l,d)}return e.possiblyEvaluate(new Ln(s)).evaluate(c,{},i)}function l_(a,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Ln(a+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=i;let l=0;for(;l<s.length&&s[l]<=a;)l++;l=Math.max(0,l-1);let d=l;for(;d<s.length&&s[d]<a+1;)d++;d=Math.min(s.length-1,d);const y=s[l],w=s[d];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:w,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:w,minSize:i.evaluate(new Ln(y)),maxSize:i.evaluate(new Ln(w)),interpolationType:c}}}function c_(a,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:c}){return a.kind==="source"?s/xo:a.kind==="composite"?yi(s/xo,c/xo,i):e}function ru(a,e,i=1){let s=0,c=0;if(a.kind==="constant")c=a.layoutSize*i;else if(a.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:y}=a,w=l?vt(da.interpolationFactor(l,e,d,y),0,1):0;a.kind==="camera"?c=yi(a.minSize,a.maxSize,w)*i:s=w*i}return{uSizeT:s,uSize:c}}var o=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:xo,evaluateSizeForFeature:c_,evaluateSizeForZoom:ru,getRasterizedIconSize:Fp,getSizeData:l_});function f(a,e,i){return a.sections.forEach(s=>{s.text=function(c,l,d){const y=l.layout.get("text-transform").evaluate(d,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),za.applyArabicShaping&&(c=za.applyArabicShaping(c)),c}(s.text,e,i)}),a}const x={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function R(a){return a==="︶"||a==="﹈"||a==="︸"||a==="﹄"||a==="﹂"||a==="︾"||a==="︼"||a==="︺"||a==="︘"||a==="﹀"||a==="︐"||a==="︓"||a==="︔"||a==="｀"||a==="￣"||a==="︑"||a==="︒"}function B(a){return a==="︵"||a==="﹇"||a==="︷"||a==="﹃"||a==="﹁"||a==="︽"||a==="︻"||a==="︹"||a==="︗"||a==="︿"}var G,se,be,Ye={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Et(){return G||(G=1,Ye.read=function(a,e,i,s,c){var l,d,y=8*c-s-1,w=(1<<y)-1,A=w>>1,_=-7,T=i?c-1:0,C=i?-1:1,E=a[e+T];for(T+=C,l=E&(1<<-_)-1,E>>=-_,_+=y;_>0;l=256*l+a[e+T],T+=C,_-=8);for(d=l&(1<<-_)-1,l>>=-_,_+=s;_>0;d=256*d+a[e+T],T+=C,_-=8);if(l===0)l=1-A;else{if(l===w)return d?NaN:1/0*(E?-1:1);d+=Math.pow(2,s),l-=A}return(E?-1:1)*d*Math.pow(2,l-s)},Ye.write=function(a,e,i,s,c,l){var d,y,w,A=8*l-c-1,_=(1<<A)-1,T=_>>1,C=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=s?0:l-1,M=s?1:-1,z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,d=_):(d=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-d))<1&&(d--,w*=2),(e+=d+T>=1?C/w:C*Math.pow(2,1-T))*w>=2&&(d++,w/=2),d+T>=_?(y=0,d=_):d+T>=1?(y=(e*w-1)*Math.pow(2,c),d+=T):(y=e*Math.pow(2,T-1)*Math.pow(2,c),d=0));c>=8;a[i+E]=255&y,E+=M,y/=256,c-=8);for(d=d<<c|y,A+=c;A>0;a[i+E]=255&d,E+=M,d/=256,A-=8);a[i+E-M]|=128*z}),Ye}function Zt(){if(be)return se;be=1,se=e;var a=Et();function e(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,s=1/i,c=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function l(q){return q.type===e.Bytes?q.readVarint()+q.pos:q.pos+1}function d(q,Y,K){return K?4294967296*Y+(q>>>0):4294967296*(Y>>>0)+(q>>>0)}function y(q,Y,K){var ee=Y<=16383?1:Y<=2097151?2:Y<=268435455?3:Math.floor(Math.log(Y)/(7*Math.LN2));K.realloc(ee);for(var he=K.pos-1;he>=q;he--)K.buf[he+ee]=K.buf[he]}function w(q,Y){for(var K=0;K<q.length;K++)Y.writeVarint(q[K])}function A(q,Y){for(var K=0;K<q.length;K++)Y.writeSVarint(q[K])}function _(q,Y){for(var K=0;K<q.length;K++)Y.writeFloat(q[K])}function T(q,Y){for(var K=0;K<q.length;K++)Y.writeDouble(q[K])}function C(q,Y){for(var K=0;K<q.length;K++)Y.writeBoolean(q[K])}function E(q,Y){for(var K=0;K<q.length;K++)Y.writeFixed32(q[K])}function M(q,Y){for(var K=0;K<q.length;K++)Y.writeSFixed32(q[K])}function z(q,Y){for(var K=0;K<q.length;K++)Y.writeFixed64(q[K])}function N(q,Y){for(var K=0;K<q.length;K++)Y.writeSFixed64(q[K])}function V(q,Y){return(q[Y]|q[Y+1]<<8|q[Y+2]<<16)+16777216*q[Y+3]}function Z(q,Y,K){q[K]=Y,q[K+1]=Y>>>8,q[K+2]=Y>>>16,q[K+3]=Y>>>24}function H(q,Y){return(q[Y]|q[Y+1]<<8|q[Y+2]<<16)+(q[Y+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(q,Y,K){for(K=K||this.length;this.pos<K;){var ee=this.readVarint(),he=ee>>3,le=this.pos;this.type=7&ee,q(he,Y,this),this.pos===le&&this.skip(ee)}return Y},readMessage:function(q,Y){return this.readFields(q,Y,this.readVarint()+this.pos)},readFixed32:function(){var q=V(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=H(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=V(this.buf,this.pos)+V(this.buf,this.pos+4)*i;return this.pos+=8,q},readSFixed64:function(){var q=V(this.buf,this.pos)+H(this.buf,this.pos+4)*i;return this.pos+=8,q},readFloat:function(){var q=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var Y,K,ee=this.buf;return Y=127&(K=ee[this.pos++]),K<128?Y:(Y|=(127&(K=ee[this.pos++]))<<7,K<128?Y:(Y|=(127&(K=ee[this.pos++]))<<14,K<128?Y:(Y|=(127&(K=ee[this.pos++]))<<21,K<128?Y:function(he,le,ue){var Te,pe,Ee=ue.buf;if(Te=(112&(pe=Ee[ue.pos++]))>>4,pe<128||(Te|=(127&(pe=Ee[ue.pos++]))<<3,pe<128)||(Te|=(127&(pe=Ee[ue.pos++]))<<10,pe<128)||(Te|=(127&(pe=Ee[ue.pos++]))<<17,pe<128)||(Te|=(127&(pe=Ee[ue.pos++]))<<24,pe<128)||(Te|=(1&(pe=Ee[ue.pos++]))<<31,pe<128))return d(he,Te,le);throw new Error("Expected varint not more than 10 bytes")}(Y|=(15&(K=ee[this.pos]))<<28,q,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var q=this.readVarint()+this.pos,Y=this.pos;return this.pos=q,q-Y>=12&&c?function(K,ee,he){return c.decode(K.subarray(ee,he))}(this.buf,Y,q):function(K,ee,he){for(var le="",ue=ee;ue<he;){var Te,pe,Ee,De=K[ue],Re=null,ke=De>239?4:De>223?3:De>191?2:1;if(ue+ke>he)break;ke===1?De<128&&(Re=De):ke===2?(192&(Te=K[ue+1]))==128&&(Re=(31&De)<<6|63&Te)<=127&&(Re=null):ke===3?(pe=K[ue+2],(192&(Te=K[ue+1]))==128&&(192&pe)==128&&((Re=(15&De)<<12|(63&Te)<<6|63&pe)<=2047||Re>=55296&&Re<=57343)&&(Re=null)):ke===4&&(pe=K[ue+2],Ee=K[ue+3],(192&(Te=K[ue+1]))==128&&(192&pe)==128&&(192&Ee)==128&&((Re=(15&De)<<18|(63&Te)<<12|(63&pe)<<6|63&Ee)<=65535||Re>=1114112)&&(Re=null)),Re===null?(Re=65533,ke=1):Re>65535&&(Re-=65536,le+=String.fromCharCode(Re>>>10&1023|55296),Re=56320|1023&Re),le+=String.fromCharCode(Re),ue+=ke}return le}(this.buf,Y,q)},readBytes:function(){var q=this.readVarint()+this.pos,Y=this.buf.subarray(this.pos,q);return this.pos=q,Y},readPackedVarint:function(q,Y){if(this.type!==e.Bytes)return q.push(this.readVarint(Y));var K=l(this);for(q=q||[];this.pos<K;)q.push(this.readVarint(Y));return q},readPackedSVarint:function(q){if(this.type!==e.Bytes)return q.push(this.readSVarint());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==e.Bytes)return q.push(this.readBoolean());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==e.Bytes)return q.push(this.readFloat());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==e.Bytes)return q.push(this.readDouble());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed32());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed32());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed64());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed64());var Y=l(this);for(q=q||[];this.pos<Y;)q.push(this.readSFixed64());return q},skip:function(q){var Y=7&q;if(Y===e.Varint)for(;this.buf[this.pos++]>127;);else if(Y===e.Bytes)this.pos=this.readVarint()+this.pos;else if(Y===e.Fixed32)this.pos+=4;else{if(Y!==e.Fixed64)throw new Error("Unimplemented type: "+Y);this.pos+=8}},writeTag:function(q,Y){this.writeVarint(q<<3|Y)},realloc:function(q){for(var Y=this.length||16;Y<this.pos+q;)Y*=2;if(Y!==this.length){var K=new Uint8Array(Y);K.set(this.buf),this.buf=K,this.length=Y}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),Z(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),Z(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),Z(this.buf,-1&q,this.pos),Z(this.buf,Math.floor(q*s),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),Z(this.buf,-1&q,this.pos),Z(this.buf,Math.floor(q*s),this.pos+4),this.pos+=8},writeVarint:function(q){(q=+q||0)>268435455||q<0?function(Y,K){var ee,he;if(Y>=0?(ee=Y%4294967296|0,he=Y/4294967296|0):(he=~(-Y/4294967296),4294967295^(ee=~(-Y%4294967296))?ee=ee+1|0:(ee=0,he=he+1|0)),Y>=18446744073709552e3||Y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");K.realloc(10),function(le,ue,Te){Te.buf[Te.pos++]=127&le|128,le>>>=7,Te.buf[Te.pos++]=127&le|128,le>>>=7,Te.buf[Te.pos++]=127&le|128,le>>>=7,Te.buf[Te.pos++]=127&le|128,Te.buf[Te.pos]=127&(le>>>=7)}(ee,0,K),function(le,ue){var Te=(7&le)<<4;ue.buf[ue.pos++]|=Te|((le>>>=3)?128:0),le&&(ue.buf[ue.pos++]=127&le|((le>>>=7)?128:0),le&&(ue.buf[ue.pos++]=127&le|((le>>>=7)?128:0),le&&(ue.buf[ue.pos++]=127&le|((le>>>=7)?128:0),le&&(ue.buf[ue.pos++]=127&le|((le>>>=7)?128:0),le&&(ue.buf[ue.pos++]=127&le)))))}(he,K)}(q,this):(this.realloc(4),this.buf[this.pos++]=127&q|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=q>>>7&127))))},writeSVarint:function(q){this.writeVarint(q<0?2*-q-1:2*q)},writeBoolean:function(q){this.writeVarint(!!q)},writeString:function(q){q=String(q),this.realloc(4*q.length),this.pos++;var Y=this.pos;this.pos=function(ee,he,le){for(var ue,Te,pe=0;pe<he.length;pe++){if((ue=he.charCodeAt(pe))>55295&&ue<57344){if(!Te){ue>56319||pe+1===he.length?(ee[le++]=239,ee[le++]=191,ee[le++]=189):Te=ue;continue}if(ue<56320){ee[le++]=239,ee[le++]=191,ee[le++]=189,Te=ue;continue}ue=Te-55296<<10|ue-56320|65536,Te=null}else Te&&(ee[le++]=239,ee[le++]=191,ee[le++]=189,Te=null);ue<128?ee[le++]=ue:(ue<2048?ee[le++]=ue>>6|192:(ue<65536?ee[le++]=ue>>12|224:(ee[le++]=ue>>18|240,ee[le++]=ue>>12&63|128),ee[le++]=ue>>6&63|128),ee[le++]=63&ue|128)}return le}(this.buf,q,this.pos);var K=this.pos-Y;K>=128&&y(Y,K,this),this.pos=Y-1,this.writeVarint(K),this.pos+=K},writeFloat:function(q){this.realloc(4),a.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),a.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var Y=q.length;this.writeVarint(Y),this.realloc(Y);for(var K=0;K<Y;K++)this.buf[this.pos++]=q[K]},writeRawMessage:function(q,Y){this.pos++;var K=this.pos;q(Y,this);var ee=this.pos-K;ee>=128&&y(K,ee,this),this.pos=K-1,this.writeVarint(ee),this.pos+=ee},writeMessage:function(q,Y,K){this.writeTag(q,e.Bytes),this.writeRawMessage(Y,K)},writePackedVarint:function(q,Y){Y.length&&this.writeMessage(q,w,Y)},writePackedSVarint:function(q,Y){Y.length&&this.writeMessage(q,A,Y)},writePackedBoolean:function(q,Y){Y.length&&this.writeMessage(q,C,Y)},writePackedFloat:function(q,Y){Y.length&&this.writeMessage(q,_,Y)},writePackedDouble:function(q,Y){Y.length&&this.writeMessage(q,T,Y)},writePackedFixed32:function(q,Y){Y.length&&this.writeMessage(q,E,Y)},writePackedSFixed32:function(q,Y){Y.length&&this.writeMessage(q,M,Y)},writePackedFixed64:function(q,Y){Y.length&&this.writeMessage(q,z,Y)},writePackedSFixed64:function(q,Y){Y.length&&this.writeMessage(q,N,Y)},writeBytesField:function(q,Y){this.writeTag(q,e.Bytes),this.writeBytes(Y)},writeFixed32Field:function(q,Y){this.writeTag(q,e.Fixed32),this.writeFixed32(Y)},writeSFixed32Field:function(q,Y){this.writeTag(q,e.Fixed32),this.writeSFixed32(Y)},writeFixed64Field:function(q,Y){this.writeTag(q,e.Fixed64),this.writeFixed64(Y)},writeSFixed64Field:function(q,Y){this.writeTag(q,e.Fixed64),this.writeSFixed64(Y)},writeVarintField:function(q,Y){this.writeTag(q,e.Varint),this.writeVarint(Y)},writeSVarintField:function(q,Y){this.writeTag(q,e.Varint),this.writeSVarint(Y)},writeStringField:function(q,Y){this.writeTag(q,e.Bytes),this.writeString(Y)},writeFloatField:function(q,Y){this.writeTag(q,e.Fixed32),this.writeFloat(Y)},writeDoubleField:function(q,Y){this.writeTag(q,e.Fixed64),this.writeDouble(Y)},writeBooleanField:function(q,Y){this.writeVarintField(q,!!Y)}},se}var Qt=re(Zt());const It=3;function Lt(a,e,i){e.glyphs=[],a===1&&i.readMessage(En,e)}function En(a,e,i){if(a===3){const{id:s,bitmap:c,width:l,height:d,left:y,top:w,advance:A}=i.readMessage(vn,{});e.glyphs.push({id:s,bitmap:new rc({width:l+2*It,height:d+2*It},c),metrics:{width:l,height:d,left:y,top:w,advance:A}})}else a===4?e.ascender=i.readSVarint():a===5&&(e.descender=i.readSVarint())}function vn(a,e,i){a===1?e.id=i.readVarint():a===2?e.bitmap=i.readBytes():a===3?e.width=i.readVarint():a===4?e.height=i.readVarint():a===5?e.left=i.readSVarint():a===6?e.top=i.readSVarint():a===7&&(e.advance=i.readVarint())}const Sr=It,dt={horizontal:1,vertical:2,horizontalOnly:3};class st{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new st;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new st;return i.image=e,i}}class wt{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,s){const c=new wt;for(let l=0;l<e.sections.length;l++){const d=e.sections[l];d.image?c.addImageSection(d,s):c.addTextSection(d,i)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,s){let c="";for(let l=0;l<i.length;l++){const d=i.charCodeAt(l+1)||null,y=i.charCodeAt(l-1)||null;c+=!s&&(d&&jh(d)&&!x[i[l+1]]||y&&jh(y)&&!x[i[l-1]])||!x[i[l]]?i[l]:x[i[l]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Vi[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Vi[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new wt;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(st.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e,i){const s=e.image?e.image.getPrimary():null;if(!s)return void Kn("Can't add FormattedSection with an empty image.");s.scaleSelf(i);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(st.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Kn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $t(a,e,i,s,c,l,d,y,w,A,_,T,C,E,M,z=1){const N=wt.fromFeature(a,c,z);T===dt.vertical&&N.verticalizePunctuation(C);let V=[];const Z=function(ee,he,le,ue,Te,pe){if(!ee)return[];const Ee=[],De=function(Ze,Ue,Xe,bt,xt,ei){let zt=0;for(let Nt=0;Nt<Ze.length();Nt++){const St=Ze.getSection(Nt);zt+=tn(Ze.getCodePoint(Nt),St,bt,xt,Ue,ei)}return zt/Math.max(1,Math.ceil(zt/Xe))}(ee,he,le,ue,Te,pe),Re=ee.text.indexOf("​")>=0;let ke=0;for(let Ze=0;Ze<ee.length();Ze++){const Ue=ee.getSection(Ze),Xe=ee.getCodePoint(Ze);if(Vi[Xe]||(ke+=tn(Xe,Ue,ue,Te,he,pe)),Ze<ee.length()-1){const bt=!((Pe=Xe)<11904||!(_i["Bopomofo Extended"](Pe)||_i.Bopomofo(Pe)||_i["CJK Compatibility Forms"](Pe)||_i["CJK Compatibility Ideographs"](Pe)||_i["CJK Compatibility"](Pe)||_i["CJK Radicals Supplement"](Pe)||_i["CJK Strokes"](Pe)||_i["CJK Symbols and Punctuation"](Pe)||_i["CJK Unified Ideographs Extension A"](Pe)||_i["CJK Unified Ideographs"](Pe)||_i["Enclosed CJK Letters and Months"](Pe)||_i["Halfwidth and Fullwidth Forms"](Pe)||_i.Hiragana(Pe)||_i["Ideographic Description Characters"](Pe)||_i["Kangxi Radicals"](Pe)||_i["Katakana Phonetic Extensions"](Pe)||_i.Katakana(Pe)||_i["Vertical Forms"](Pe)||_i["Yi Radicals"](Pe)||_i["Yi Syllables"](Pe)));(Xn[Xe]||bt||Ue.image)&&Ee.push(cr(Ze+1,ke,De,Ee,$a(Xe,ee.getCodePoint(Ze+1),bt&&Re),!1))}}var Pe;return au(cr(ee.length(),ke,De,Ee,0,!0))}(N,A,l,e,s,E),{processBidirectionalText:H,processStyledBidirectionalText:q}=za;if(H&&N.sections.length===1){const ee=H(N.toString(),Z);for(const he of ee){const le=new wt;le.text=he,le.sections=N.sections;for(let ue=0;ue<he.length;ue++)le.sectionIndex.push(0);V.push(le)}}else if(q){const ee=q(N.text,N.sectionIndex,Z);for(const he of ee){const le=new wt;le.text=he[0],le.sectionIndex=he[1],le.sections=N.sections,V.push(le)}}else V=function(ee,he){const le=[],ue=ee.text;let Te=0;for(const pe of he)le.push(ee.substring(Te,pe)),Te=pe;return Te<ue.length&&le.push(ee.substring(Te,ue.length)),le}(N,Z);const Y=[],K={positionedLines:Y,text:N.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ee,he,le,ue,Te,pe,Ee,De,Re,ke,Pe,Ze){let Ue=0,Xe=0,bt=0;const xt=De==="right"?1:De==="left"?0:.5;let ei=!1;for(const ci of Te){const Li=ci.getSections();for(const Wi of Li){if(Wi.image)continue;const ki=he[Wi.fontStack];if(ki&&(ei=ki.ascender!==void 0&&ki.descender!==void 0,!ei))break}if(!ei)break}let zt=0;for(const ci of Te){ci.trim();const Li=ci.getMaxScale(),Wi=(Li-1)*Xr,ki={positionedGlyphs:[],lineOffset:0};ee.positionedLines[zt]=ki;const an=ki.positionedGlyphs;let Yi=0;if(!ci.length()){Xe+=pe,++zt;continue}let un=0,Cn=0;for(let Oi=0;Oi<ci.length();Oi++){const _n=ci.getSection(Oi),ur=ci.getSectionIndex(Oi),_r=ci.getCodePoint(Oi);let wr=_n.scale,Er=null,Yn=null,_a=null,Os=Xr,Yr=0;Re===dt.vertical&&((Nt=_r)===12312||Nt===12313||Nt===12316||Nt===12540||Nt===12448)&&(Re=dt.horizontal);const ra=!(Re===dt.horizontal||!Pe&&!Fl(_r)||Pe&&(Vi[_r]||$d(_r)));if(_n.image){const ls=ue.get(_n.image.toString());if(!ls)continue;_a=_n.image,ee.iconsInText=ee.iconsInText||!0,Yn=ls.paddedRect;const Pa=ls.displaySize;wr=wr*Xr/Ze,Er={width:Pa[0],height:Pa[1],left:0,top:-3,advance:ra?Pa[1]:Pa[0],localGlyph:!1},Yr=ei?-Er.height*wr:Li*Xr-17-Pa[1]*wr,Os=Er.advance;const fl=(ra?Pa[0]:Pa[1])*wr-Xr*Li;fl>0&&fl>Yi&&(Yi=fl)}else{const ls=le[_n.fontStack];if(!ls)continue;ls[_r]&&(Yn=ls[_r]);const Pa=he[_n.fontStack];if(!Pa)continue;const fl=Pa.glyphs[_r];if(!fl)continue;if(Er=fl.metrics,Os=_r!==8203?Xr:0,ei){const Nf=Pa.ascender!==void 0?Math.abs(Pa.ascender):0,oc=Pa.descender!==void 0?Math.abs(Pa.descender):0,uu=(Nf+oc)*wr;un<uu&&(un=uu,Cn=(Nf-oc)/2*wr),Yr=-Nf*wr}else Yr=(Li-wr)*Xr-17}ra?(ee.verticalizable=!0,an.push({glyph:_r,image:_a,x:Ue,y:Xe+Yr,vertical:ra,scale:wr,localGlyph:Er.localGlyph,fontStack:_n.fontStack,sectionIndex:ur,metrics:Er,rect:Yn}),Ue+=Os*wr+ke):(an.push({glyph:_r,image:_a,x:Ue,y:Xe+Yr,vertical:ra,scale:wr,localGlyph:Er.localGlyph,fontStack:_n.fontStack,sectionIndex:ur,metrics:Er,rect:Yn}),Ue+=Er.advance*wr+ke)}an.length!==0&&(bt=Math.max(Ue-ke,bt),ei?eb(an,xt,Yi,Cn,pe*Li/2):eb(an,xt,Yi,0,pe/2)),Ue=0;const er=pe*Li+Yi;ki.lineOffset=Math.max(Yi,Wi),Xe+=er,++zt}var Nt;const St=Xe,{horizontalAlign:wi,verticalAlign:Xt}=_g(Ee);(function(ci,Li,Wi,ki,an,Yi){const un=(Li-Wi)*an,Cn=-Yi*ki;for(const er of ci)for(const Oi of er.positionedGlyphs)Oi.x+=un,Oi.y+=Cn})(ee.positionedLines,xt,wi,Xt,bt,St),ee.top+=-Xt*St,ee.bottom=ee.top+St,ee.left+=-wi*bt,ee.right=ee.left+bt,ee.hasBaseline=ei}(K,e,i,s,V,d,y,w,T,A,C,M),!function(ee){for(const he of ee)if(he.positionedGlyphs.length!==0)return!1;return!0}(Y))return K}const Vi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Xn={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function tn(a,e,i,s,c,l){if(e.image){const d=s.get(e.image.toString());return d?d.displaySize[0]*e.scale*Xr/l+c:0}{const d=i[e.fontStack],y=d&&d.glyphs[a];return y?y.metrics.advance*e.scale+c:0}}function xn(a,e,i,s){const c=Math.pow(a-e,2);return s?a<e?c/2:2*c:c+Math.abs(i)*i}function $a(a,e,i){let s=0;return a===10&&(s-=1e4),i&&(s+=150),a!==40&&a!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function cr(a,e,i,s,c,l){let d=null,y=xn(e,i,c,l);for(const w of s){const A=xn(e-w.x,i,c,l)+w.badness;A<=y&&(d=w,y=A)}return{index:a,x:e,priorBreak:d,badness:y}}function au(a){return a?au(a.priorBreak).concat(a.index):[]}function _g(a){let e=.5,i=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function eb(a,e,i,s,c){if(!(e||i||s||c))return;const l=a.length-1,d=a[l],y=(d.x+d.metrics.advance*d.scale)*e;for(let w=0;w<=l;w++)a[w].x-=y,a[w].y+=i+s+c}function OE(a,e,i,s){const{horizontalAlign:c,verticalAlign:l}=_g(s),d=i[0]-a.displaySize[0]*c,y=i[1]-a.displaySize[1]*l;return{imagePrimary:a,imageSecondary:e,top:y,bottom:y+a.displaySize[1],left:d,right:d+a.displaySize[0]}}function tb(a,e,i,s,c,l){const d=a.imagePrimary;let y;if(d.content){const N=d.content,V=d.pixelRatio||1;y=[N[0]/V,N[1]/V,d.displaySize[0]-N[2]/V,d.displaySize[1]-N[3]/V]}const w=e.left*l,A=e.right*l;let _,T,C,E;i==="width"||i==="both"?(E=c[0]+w-s[3],T=c[0]+A+s[1]):(E=c[0]+(w+A-d.displaySize[0])/2,T=E+d.displaySize[0]);const M=e.top*l,z=e.bottom*l;return i==="height"||i==="both"?(_=c[1]+M-s[0],C=c[1]+z+s[2]):(_=c[1]+(M+z-d.displaySize[1])/2,C=_+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:_,right:T,bottom:C,left:E,collisionPadding:y}}class hd extends Ft{constructor(e,i,s,c,l){super(e,i),this.angle=c,this.z=s,l!==void 0&&(this.segment=l)}clone(){return new hd(this.x,this.y,this.z,this.angle,this.segment)}}function ib(a,e,i,s,c){if(e.segment===void 0)return!0;let l=e,d=e.segment+1,y=0;for(;y>-i/2;){if(d--,d<0)return!1;y-=a[d].dist(l),l=a[d]}y+=a[d].dist(a[d+1]),d++;const w=[];let A=0;for(;y<i/2;){const _=a[d],T=a[d+1];if(!T)return!1;let C=a[d-1].angleTo(_)-_.angleTo(T);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:y,angleDelta:C}),A+=C;y-w[0].distance>s;)A-=w.shift().angleDelta;if(A>c)return!1;d++,y+=_.dist(T)}return!0}function nb(a){let e=0;for(let i=0;i<a.length-1;i++)e+=a[i].dist(a[i+1]);return e}function rb(a,e,i){return a?.6*e*i:0}function ab(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function PE(a,e,i,s,c,l){const d=rb(i,c,l),y=ab(i,s)*l;let w=0;const A=nb(a)/2;for(let _=0;_<a.length-1;_++){const T=a[_],C=a[_+1],E=T.dist(C);if(w+E>A){const M=(A-w)/E,z=yi(T.x,C.x,M),N=yi(T.y,C.y,M),V=new hd(z,N,0,C.angleTo(T),_);return!d||ib(a,V,y,d,e)?V:void 0}w+=E}}function kE(a,e,i,s,c,l,d,y,w){const A=rb(s,l,d),_=ab(s,c),T=_*d,C=a[0].x===0||a[0].x===w||a[0].y===0||a[0].y===w;return e-T<e/4&&(e=T+e/4),sb(a,C?e/2*y%e:(_/2+2*l)*d*y%e,e,A,i,T,C,!1,w)}function sb(a,e,i,s,c,l,d,y,w){const A=l/2,_=nb(a);let T=0,C=e-i,E=[];for(let M=0;M<a.length-1;M++){const z=a[M],N=a[M+1],V=z.dist(N),Z=N.angleTo(z);for(;C+i<T+V;){C+=i;const H=(C-T)/V,q=yi(z.x,N.x,H),Y=yi(z.y,N.y,H);if(q>=0&&q<w&&Y>=0&&Y<w&&C-A>=0&&C+A<=_){const K=new hd(q,Y,0,Z,M);s&&!ib(a,K,l,s,c)||E.push(K)}}T+=V}return y||E.length||d||(E=sb(a,T/2,i,s,c,l,d,!0,w)),E}function ob(a,e,i,s,c){const l=[];for(let d=0;d<a.length;d++){const y=a[d];let w;for(let A=0;A<y.length-1;A++){let _=y[A],T=y[A+1];_.x<e&&T.x<e||(_.x<e?_=new Ft(e,_.y+(e-_.x)/(T.x-_.x)*(T.y-_.y))._round():T.x<e&&(T=new Ft(e,_.y+(e-_.x)/(T.x-_.x)*(T.y-_.y))._round()),_.y<i&&T.y<i||(_.y<i?_=new Ft(_.x+(i-_.y)/(T.y-_.y)*(T.x-_.x),i)._round():T.y<i&&(T=new Ft(_.x+(i-_.y)/(T.y-_.y)*(T.x-_.x),i)._round()),_.x>=s&&T.x>=s||(_.x>=s?_=new Ft(s,_.y+(s-_.x)/(T.x-_.x)*(T.y-_.y))._round():T.x>=s&&(T=new Ft(s,_.y+(s-_.x)/(T.x-_.x)*(T.y-_.y))._round()),_.y>=c&&T.y>=c||(_.y>=c?_=new Ft(_.x+(c-_.y)/(T.y-_.y)*(T.x-_.x),c)._round():T.y>=c&&(T=new Ft(_.x+(c-_.y)/(T.y-_.y)*(T.x-_.x),c)._round()),w&&_.equals(w[w.length-1])||(w=[_],l.push(w)),w.push(T)))))}}return l}function lb(a){let e=0,i=0;for(const d of a)e+=d.w*d.h,i=Math.max(i,d.w);a.sort((d,y)=>y.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,l=0;for(const d of a)for(let y=s.length-1;y>=0;y--){const w=s[y];if(!(d.w>w.w||d.h>w.h)){if(d.x=w.x,d.y=w.y,l=Math.max(l,d.y+d.h),c=Math.max(c,d.x+d.w),d.w===w.w&&d.h===w.h){const A=s.pop();y<s.length&&(s[y]=A)}else d.h===w.h?(w.x+=d.w,w.w-=d.w):d.w===w.w?(w.y+=d.h,w.h-=d.h):(s.push({x:w.x+d.w,y:w.y,w:w.w-d.w,h:d.h}),w.y+=d.h,w.h-=d.h);break}}return{w:c,h:l,fill:e/(c*l)||0}}Wt(hd,"Anchor");const u_=1;class gg{static getImagePositionScale(e,i,s){if(i&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:s,y:s}}constructor(e,i,s,c){this.paddedRect=e;const{pixelRatio:l,version:d,stretchX:y,stretchY:w,content:A,sdf:_,usvg:T}=i;this.pixelRatio=l,this.stretchX=y,this.stretchY=w,this.content=A,this.version=d,this.padding=s,this.sdf=_,this.scale=gg.getImagePositionScale(c,T,l)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function cb(a,e,i){const s=Co.parse(a),c=function(l,d,y=[1,1]){return{x:0,y:0,w:(l.data?l.data.width:l.width*y[0])+2*d,h:(l.data?l.data.height:l.height*y[1])+2*d}}(e,i,[s.options.transform.a,s.options.transform.d]);return{bin:c,imagePosition:new gg(c,e,i,s),imageVariant:s}}class ub{constructor(e,i,s){const c=new Map,l=new Map;this.haveRenderCallbacks=[];const d=[];this.addImages(e,c,u_,d),this.addImages(i,l,2,d);const{w:y,h:w}=lb(d),A=new ua({width:y||1,height:w||1});for(const[_,T]of e.entries()){const C=c.get(_).paddedRect;ua.copy(T.data,A,{x:0,y:0},{x:C.x+u_,y:C.y+u_},T.data,s,T.sdf)}for(const[_,T]of i.entries()){const C=l.get(_),E=C.paddedRect;let M=C.padding;const z=E.x+M,N=E.y+M,V=T.data.width,Z=T.data.height;M=M>1?M-1:M,ua.copy(T.data,A,{x:0,y:0},{x:z,y:N},T.data,s),ua.copy(T.data,A,{x:0,y:Z-M},{x:z,y:N-M},{width:V,height:M},s),ua.copy(T.data,A,{x:0,y:0},{x:z,y:N+Z},{width:V,height:M},s),ua.copy(T.data,A,{x:V-M,y:0},{x:z-M,y:N},{width:M,height:Z},s),ua.copy(T.data,A,{x:0,y:0},{x:z+V,y:N},{width:M,height:Z},s),ua.copy(T.data,A,{x:V-M,y:Z-M},{x:z-M,y:N-M},{width:M,height:M},s),ua.copy(T.data,A,{x:0,y:Z-M},{x:z+V,y:N-M},{width:M,height:M},s),ua.copy(T.data,A,{x:0,y:0},{x:z+V,y:N+Z},{width:M,height:M},s),ua.copy(T.data,A,{x:V-M,y:0},{x:z-M,y:N+Z},{width:M,height:M},s)}this.lut=s,this.image=A,this.iconPositions=c,this.patternPositions=l}addImages(e,i,s,c){for(const[l,d]of e.entries()){const{bin:y,imagePosition:w,imageVariant:A}=cb(l,d,s);i.set(l,w),c.push(y),d.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const c of e.getUpdatedImages(s)){for(const l of this.iconPositions.keys()){const d=Co.parse(l);if(Ia.isEqual(d.id,c)){const y=e.getImage(c,s);this.patchUpdatedImage(this.iconPositions.get(l),y,i)}}for(const l of this.patternPositions.keys()){const d=Co.parse(l);if(Ia.isEqual(d.id,c)){const y=e.getImage(c,s);this.patchUpdatedImage(this.patternPositions.get(l),y,i)}}}}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,l]=e.tl,d=e.sdf;if(this.lut||d){const y={width:i.data.width,height:i.data.height},w=new ua(y);ua.copy(i.data,w,{x:0,y:0},{x:0,y:0},y,this.lut,d),s.update(w,{position:{x:c,y:l}})}else s.update(i.data,{position:{x:c,y:l}})}}Wt(gg,"ImagePosition"),Wt(ub,"ImageAtlas");const iv=1e20;function hb(a,e,i,s,c,l,d,y,w){for(let A=e;A<e+s;A++)db(a,i*l+A,l,c,d,y,w);for(let A=i;A<i+c;A++)db(a,A*l+e,1,s,d,y,w)}function db(a,e,i,s,c,l,d){l[0]=0,d[0]=-1e20,d[1]=iv,c[0]=a[e];for(let y=1,w=0,A=0;y<s;y++){c[y]=a[e+y*i];const _=y*y;do{const T=l[w];A=(c[y]-c[T]+_-T*T)/(y-T)/2}while(A<=d[w]&&--w>-1);w++,l[w]=y,d[w]=A,d[w+1]=iv}for(let y=0,w=0;y<s;y++){for(;d[w+1]<y;)w++;const A=l[w],_=y-A;a[e+y*i]=c[A]+_*_}}const su=2,V0={none:0,ideographs:1,all:2};class h_{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,s){const c=[],l=this.urls[i]||ie.GLYPHS_URL;for(const d in e)for(const y of e[d])c.push({stack:d,id:y});ri(c,({stack:d,id:y},w)=>{let A=this.entries[d];A||(A=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=A.glyphs[y];if(_!==void 0)return void w(null,{stack:d,id:y,glyph:_});if(_=this._tinySDF(A,d,y),_)return A.glyphs[y]=_,void w(null,{stack:d,id:y,glyph:_});const T=Math.floor(y/256);if(256*T>65535)return Kn("glyphs > 65535 not supported"),void w(null,{stack:d,id:y,glyph:_});if(A.ranges[T])return void w(null,{stack:d,id:y,glyph:_});let C=A.requests[T];C||(C=A.requests[T]=[],h_.loadGlyphRange(d,T,l,this.requestManager,(E,M)=>{if(M){A.ascender=M.ascender,A.descender=M.descender;for(const z in M.glyphs)this._doesCharSupportLocalGlyph(+z)||(A.glyphs[+z]=M.glyphs[+z]);A.ranges[T]=!0}for(const z of C)z(E,M);delete A.requests[T]})),C.push((E,M)=>{E?w(E):M&&w(null,{stack:d,id:y,glyph:M.glyphs[y]||null})})},(d,y)=>{if(d)s(d);else if(y){const w={};for(const{stack:A,id:_,glyph:T}of y)w[A]===void 0&&(w[A]={}),w[A].glyphs===void 0&&(w[A].glyphs={}),w[A].glyphs[_]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},w[A].ascender=this.entries[A].ascender,w[A].descender=this.entries[A].descender;s(null,w)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==V0.none&&(this.localGlyphMode===V0.all?!!this.localFontFamily:!!this.localFontFamily&&(_i["CJK Unified Ideographs"](e)||_i["Hangul Syllables"](e)||_i.Hiragana(e)||_i.Katakana(e)||_i["CJK Symbols and Punctuation"](e)||_i["CJK Unified Ideographs Extension A"](e)||_i["CJK Unified Ideographs Extension B"](e)||_i.Osage(e)))}_tinySDF(e,i,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let l=e.tinySDF;if(!l){let z="400";/bold/i.test(i)?z="900":/medium/i.test(i)?z="500":/light/i.test(i)&&(z="200"),l=e.tinySDF=new h_.TinySDF({fontFamily:c,fontWeight:z,fontSize:24*su,buffer:3*su,radius:8*su}),l.fontWeight=z}if(this.localGlyphs[l.fontWeight][s])return this.localGlyphs[l.fontWeight][s];const d=String.fromCodePoint(s),{data:y,width:w,height:A,glyphWidth:_,glyphHeight:T,glyphLeft:C,glyphTop:E,glyphAdvance:M}=l.draw(d);return this.localGlyphs[l.fontWeight][s]={id:s,bitmap:new rc({width:w,height:A},y),metrics:{width:_/su,height:T/su,left:C/su,top:E/su-27,advance:M/su,localGlyph:!0}}}}h_.loadGlyphRange=function(a,e,i,s,c){const l=256*e,d=l+255,y=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",a).replace("{range}",`${l}-${d}`),Cr.Glyphs);Mo(y,(w,A)=>{if(w)c(w);else if(A){const _={},T=function(C){return new Qt(C).readFields(Lt,{})}(A);for(const C of T.glyphs)_[C.id]=C;c(null,{glyphs:_,ascender:T.ascender,descender:T.descender})}})},h_.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:l="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const y=this.size=a+4*e,w=this._createCanvas(y),A=this.ctx=w.getContext("2d",{willReadFrequently:!0});A.font=`${d} ${l} ${a}px ${c}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(a){const e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:l}=this.ctx.measureText(a),d=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-c))),w=Math.min(this.size-this.buffer,d+Math.ceil(s)),A=y+2*this.buffer,_=w+2*this.buffer,T=Math.max(A*_,0),C=new Uint8ClampedArray(T),E={data:C,width:A,height:_,glyphWidth:y,glyphHeight:w,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(y===0||w===0)return E;const{ctx:M,buffer:z,gridInner:N,gridOuter:V}=this;M.clearRect(z,z,y,w),M.fillText(a,z,z+d);const Z=M.getImageData(z,z,y,w);V.fill(iv,0,T),N.fill(0,0,T);for(let H=0;H<w;H++)for(let q=0;q<y;q++){const Y=Z.data[4*(H*y+q)+3]/255;if(Y===0)continue;const K=(H+z)*A+q+z;if(Y===1)V[K]=0,N[K]=iv;else{const ee=.5-Y;V[K]=ee>0?ee*ee:0,N[K]=ee<0?ee*ee:0}}hb(V,0,0,A,_,A,this.f,this.v,this.z),hb(N,z,z,y,w,A,this.f,this.v,this.z);for(let H=0;H<T;H++){const q=Math.sqrt(V[H])-Math.sqrt(N[H]);C[H]=Math.round(255-255*(q/this.radius+this.cutoff))}return E}};const Vp=u_;function fb(a,e){return a+e[1]-e[0]}function pb(a,e,i,s,c=1){const l=[],d=a.imagePrimary,y=d.pixelRatio,w=d.paddedRect.w-2*Vp,A=d.paddedRect.h-2*Vp,_=(a.right-a.left)*c,T=(a.bottom-a.top)*c,C=d.stretchX||[[0,w]],E=d.stretchY||[[0,A]],M=C.reduce(fb,0),z=E.reduce(fb,0),N=w-M,V=A-z;let Z=0,H=M,q=0,Y=z,K=0,ee=N,he=0,le=V;if(d.content&&s){const Te=d.content;Z=nv(C,0,Te[0]),q=nv(E,0,Te[1]),H=nv(C,Te[0],Te[2]),Y=nv(E,Te[1],Te[3]),K=Te[0]-Z,he=Te[1]-q,ee=Te[2]-Te[0]-H,le=Te[3]-Te[1]-Y}const ue=(Te,pe,Ee,De)=>{const Re=rv(Te.stretch-Z,H,_,a.left*c),ke=av(Te.fixed-K,ee,Te.stretch,M),Pe=rv(pe.stretch-q,Y,T,a.top*c),Ze=av(pe.fixed-he,le,pe.stretch,z),Ue=rv(Ee.stretch-Z,H,_,a.left*c),Xe=av(Ee.fixed-K,ee,Ee.stretch,M),bt=rv(De.stretch-q,Y,T,a.top*c),xt=av(De.fixed-he,le,De.stretch,z),ei=new Ft(Re,Pe),zt=new Ft(Ue,Pe),Nt=new Ft(Ue,bt),St=new Ft(Re,bt),wi=new Ft(ke/y,Ze/y),Xt=new Ft(Xe/y,xt/y),ci=e*Math.PI/180;if(ci){const un=Math.sin(ci),Cn=Math.cos(ci),er=[Cn,-un,un,Cn];ei._matMult(er),zt._matMult(er),St._matMult(er),Nt._matMult(er)}const Li=Te.stretch+Te.fixed,Wi=Ee.stretch+Ee.fixed,ki=pe.stretch+pe.fixed,an=De.stretch+De.fixed,Yi=a.imageSecondary;return{tl:ei,tr:zt,bl:St,br:Nt,texPrimary:{x:d.paddedRect.x+Vp+Li,y:d.paddedRect.y+Vp+ki,w:Wi-Li,h:an-ki},texSecondary:Yi?{x:Yi.paddedRect.x+Vp+Li,y:Yi.paddedRect.y+Vp+ki,w:Wi-Li,h:an-ki}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wi,pixelOffsetBR:Xt,minFontScaleX:ee/y/_,minFontScaleY:le/y/T,isSDF:i}};if(s&&(d.stretchX||d.stretchY)){const Te=mb(C,N,M),pe=mb(E,V,z);for(let Ee=0;Ee<Te.length-1;Ee++){const De=Te[Ee],Re=Te[Ee+1];for(let ke=0;ke<pe.length-1;ke++)l.push(ue(De,pe[ke],Re,pe[ke+1]))}}else l.push(ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:A+1}));return l}function nv(a,e,i){let s=0;for(const c of a)s+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return s}function mb(a,e,i){const s=[{fixed:-1,stretch:0}];for(const[c,l]of a){const d=s[s.length-1];s.push({fixed:c-d.stretch,stretch:d.stretch}),s.push({fixed:c-d.stretch,stretch:d.stretch+(l-c)})}return s.push({fixed:e+Vp,stretch:i}),s}function rv(a,e,i,s){return a/e*i+s}function av(a,e,i,s){return a-e*i/s}function BE(a,e,i,s){const c=e+a.positionedLines[s].lineOffset;return s===0?i+c/2:i+(c+(e+a.positionedLines[s-1].lineOffset))/2}function NE(a,e=1,i=!1){let s=1/0,c=1/0,l=-1/0,d=-1/0;const y=a[0];for(let E=0;E<y.length;E++){const M=y[E];(!E||M.x<s)&&(s=M.x),(!E||M.y<c)&&(c=M.y),(!E||M.x>l)&&(l=M.x),(!E||M.y>d)&&(d=M.y)}const w=Math.min(l-s,d-c);let A=w/2;const _=new Au([],FE);if(w===0)return new Ft(s,c);for(let E=s;E<l;E+=w)for(let M=c;M<d;M+=w)_.push(new d_(E+A,M+A,A,a));let T=function(E){let M=0,z=0,N=0;const V=E[0];for(let Z=0,H=V.length,q=H-1;Z<H;q=Z++){const Y=V[Z],K=V[q],ee=Y.x*K.y-K.x*Y.y;z+=(Y.x+K.x)*ee,N+=(Y.y+K.y)*ee,M+=3*ee}return new d_(z/M,N/M,0,E)}(a),C=_.length;for(;_.length;){const E=_.pop();(E.d>T.d||!T.d)&&(T=E,i&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,C)),E.max-T.d<=e||(A=E.h/2,_.push(new d_(E.p.x-A,E.p.y-A,A,a)),_.push(new d_(E.p.x+A,E.p.y-A,A,a)),_.push(new d_(E.p.x-A,E.p.y+A,A,a)),_.push(new d_(E.p.x+A,E.p.y+A,A,a)),C+=4)}return i&&(console.log(`num probes: ${C}`),console.log(`best distance: ${T.d}`)),T.p}function FE(a,e){return e.max-a.max}class d_{constructor(e,i,s,c){this.p=new Ft(e,i),this.h=s,this.d=function(l,d){let y=!1,w=1/0;for(let A=0;A<d.length;A++){const _=d[A];for(let T=0,C=_.length,E=C-1;T<C;E=T++){const M=_[T],z=_[E];M.y>l.y!=z.y>l.y&&l.x<(z.x-M.x)*(l.y-M.y)/(z.y-M.y)+M.x&&(y=!y),w=Math.min(w,we(l,M,z))}}return(y?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const U0=Number.POSITIVE_INFINITY,VE=Math.sqrt(2);function _b(a,[e,i]){let s=0,c=0;if(i===U0){e<0&&(e=0);const l=e/VE;switch(a){case"top-right":case"top-left":c=l-7;break;case"bottom-right":case"bottom-left":c=7-l;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(a){case"top-right":case"bottom-right":s=-l;break;case"top-left":case"bottom-left":s=l;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),a){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(a){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,c]}function gb(a,e,i,s,c,l,d,y){if(!a)return;const w=Fp(e,i,s,c,l);return a.scaleSelf(w*y*d)}function yb(a,e,i,s,c,l,d,y){return{iconPrimary:gb(a.getPrimary(),e,i,s,c,l,d,y),iconSecondary:gb(a.getSecondary(),e,i,s,c,l,d,y)}}function vb(a,e,i,s){if(!a)return;const c=e.get(i.toString());if(a.imagePrimary=c,s){const l=e.get(s.toString());a.imageSecondary=l}}function UE(a,e){for(const i in a.horizontal)xb(a.horizontal[i],e);xb(a.vertical,e)}function xb(a,e){if(a){for(const i of a.positionedLines)for(const s of i.positionedGlyphs)if(s.image!==null){const c=s.image.toString();s.rect=e.get(c).paddedRect}}}function j0(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jE(a,e,i,s,c,l,d,y,w){const A=q0(l.horizontal)||l.vertical,_=i.get("icon-text-fit-padding").evaluate(s,{},c);let T,C=e;return e&&w!=="none"&&(a.allowVerticalPlacement&&l.vertical&&(T=tb(e,l.vertical,w,_,y,d)),A&&(C=tb(e,A,w,_,y,d))),{defaultShapedIcon:C,verticallyShapedIcon:T}}function qE(a,e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V,Z,H){let q=d.textMaxSize.evaluate(e,{},C);q===void 0?q=y*d.textScaleFactor:q*=d.textScaleFactor;const Y=a.layers[0].layout,K=q0(i.horizontal)||i.vertical,ee=E.name==="globe",he=Xr,le=a.tilePixelRatio*q/he,ue=(ke=a.overscaling,a.zoom>18&&ke>2&&(ke>>=1),Math.max(Bt/(512*ke),1)*Y.get("symbol-spacing")),Te=Y.get("text-padding")*a.tilePixelRatio,pe=Y.get("icon-padding")*a.tilePixelRatio,Ee=ln(Y.get("text-max-angle")),De=Y.get("icon-rotation-alignment")==="map"&&H!=="point",Re=ue/2;var ke;a.hasAnyIconTextFit===!1&&N!=="none"&&(a.hasAnyIconTextFit=!0);const Pe=e.properties?+e.properties[Un]:null,Ze=Pe&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(Pe):65535,Ue=(Xe,bt,xt)=>{if(bt.x<0||bt.x>=Bt||bt.y<0||bt.y>=Bt)return;let ei=null;if(ee){const{x:zt,y:Nt,z:St}=E.projectTilePoint(bt.x,bt.y,xt);ei={anchor:new hd(zt,Nt,St,0,void 0),up:E.upVector(xt,bt.x,bt.y)}}(function(zt,Nt,St,wi,Xt,ci,Li,Wi,ki,an,Yi,un,Cn,er,Oi,_n,ur,_r,wr,Er,Yn,_a,Os,Yr,ra,ls,Pa,fl,Nf){const oc=zt.addToLineVertexArray(Nt,wi);let uu,Ff,Vf,Hp,i2,n2,r2,a2=0,s2=0,o2=0,l2=0,wx=-1,Tx=-1;const rh={};let c2=gs("");const Zp=St?St.anchor:Nt,Sx=fl!=="none";let Ex=0,Ax=0;if(ki._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ex,Ax]=ki.layout.get("text-offset").evaluate(Yn,{},ra).map(pl=>pl*Xr):(Ex=ki.layout.get("text-radial-offset").evaluate(Yn,{},ra)*Xr,Ax=U0),zt.allowVerticalPlacement&&Xt.vertical){const pl=Xt.vertical;if(Oi)n2=G0(pl),Wi&&(r2=G0(Wi));else{const bo=ki.layout.get("text-rotate").evaluate(Yn,{},ra)+90;Vf=sv(an,Zp,Nt,Yi,un,Cn,pl,er,bo,_n),Wi&&(Hp=sv(an,Zp,Nt,Yi,un,Cn,Wi,_r,bo))}}if(ci){const pl=zt.iconSizeData,bo=ki.layout.get("icon-rotate").evaluate(Yn,{},ra),kg=pb(ci,bo,Os,Sx,_a.iconScaleFactor),Cx=Wi?pb(Wi,bo,Os,Sx,_a.iconScaleFactor):void 0;Ff=sv(an,Zp,Nt,Yi,un,Cn,ci,_r,bo,null),a2=4*kg.length;let $p=null;pl.kind==="source"?($p=[xo*ki.layout.get("icon-size").evaluate(Yn,{},ra)*_a.iconScaleFactor],$p[0]>Of&&Kn(`${zt.layerIds[0]}: Value for "icon-size" is >= ${yg}. Reduce your "icon-size".`)):pl.kind==="composite"&&($p=[xo*_a.compositeIconSizes[0].evaluate(Yn,{},ra)*_a.iconScaleFactor,xo*_a.compositeIconSizes[1].evaluate(Yn,{},ra)*_a.iconScaleFactor],($p[0]>Of||$p[1]>Of)&&Kn(`${zt.layerIds[0]}: Value for "icon-size" is >= ${yg}. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,kg,$p,Er,wr,Yn,!1,St,Nt,oc.lineStartIndex,oc.lineLength,-1,Yr,ra,ls,Pa),wx=zt.icon.placedSymbolArray.length-1,Cx&&(s2=4*Cx.length,zt.addSymbols(zt.icon,Cx,$p,Er,wr,Yn,dt.vertical,St,Nt,oc.lineStartIndex,oc.lineLength,-1,Yr,ra,ls,Pa),Tx=zt.icon.placedSymbolArray.length-1)}for(const pl in Xt.horizontal){const bo=Xt.horizontal[pl];uu||(c2=gs(bo.text),Oi?i2=G0(bo):uu=sv(an,Zp,Nt,Yi,un,Cn,bo,er,ki.layout.get("text-rotate").evaluate(Yn,{},ra),_n));const kg=bo.positionedLines.length===1;if(o2+=bb(zt,St,Nt,bo,Li,ki,Oi,Yn,_n,oc,Xt.vertical?dt.horizontal:dt.horizontalOnly,kg?Object.keys(Xt.horizontal):[pl],rh,wx,_a,Yr,ra,ls),kg)break}Xt.vertical&&(l2+=bb(zt,St,Nt,Xt.vertical,Li,ki,Oi,Yn,_n,oc,dt.vertical,["vertical"],rh,Tx,_a,Yr,ra,ls));let Uf=-1;const Mx=(pl,bo)=>pl?Math.max(pl,bo):bo;Uf=Mx(i2,Uf),Uf=Mx(n2,Uf),Uf=Mx(r2,Uf);const bM=Uf>-1?1:0;zt.glyphOffsetArray.length>=65535&&Kn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yn.sortKey!==void 0&&zt.addToSortKeyRanges(zt.symbolInstances.length,Yn.sortKey),zt.symbolInstances.emplaceBack(Nt.x,Nt.y,Zp.x,Zp.y,Zp.z,rh.right>=0?rh.right:-1,rh.center>=0?rh.center:-1,rh.left>=0?rh.left:-1,rh.vertical>=0?rh.vertical:-1,wx,Tx,c2,uu!==void 0?uu:zt.collisionBoxArray.length,uu!==void 0?uu+1:zt.collisionBoxArray.length,Vf!==void 0?Vf:zt.collisionBoxArray.length,Vf!==void 0?Vf+1:zt.collisionBoxArray.length,Ff!==void 0?Ff:zt.collisionBoxArray.length,Ff!==void 0?Ff+1:zt.collisionBoxArray.length,Hp||zt.collisionBoxArray.length,Hp?Hp+1:zt.collisionBoxArray.length,Yi,o2,l2,a2,s2,bM,0,Ex,Ax,Uf,0,Sx?1:0,Nf)})(a,bt,ei,Xe,i,s,l,c,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,Te,Z,A,0,pe,De,V,e,d,_,T,C,M,z,N,Ze)};if(H==="line")for(const Xe of ob(e.geometry,0,0,Bt,Bt)){const bt=kE(Xe,ue,Ee,i.vertical||K,s,he,le,a.overscaling,Bt);for(const xt of bt)K&&GE(a,K.text,Re,xt)||Ue(Xe,xt,C)}else if(H==="line-center"){for(const Xe of e.geometry)if(Xe.length>1){const bt=PE(Xe,Ee,i.vertical||K,s,he,le);bt&&Ue(Xe,bt,C)}}else if(e.type==="Polygon")for(const Xe of Pm(e.geometry,0)){const bt=NE(Xe,16);Ue(Xe[0],new hd(bt.x,bt.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Xe of e.geometry)Ue(Xe,new hd(Xe[0].x,Xe[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Xe of e.geometry)for(const bt of Xe)Ue([bt],new hd(bt.x,bt.y,0,0,void 0),C)}const yg=255,Of=yg*xo;function bb(a,e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N,V){const Z=function(Y,K,ee,he,le,ue,Te,pe){const Ee=[];if(K.positionedLines.length===0)return Ee;const De=he.layout.get("text-rotate").evaluate(ue,{})*Math.PI/180,Re=function(Xe){const bt=Xe[0],xt=Xe[1],ei=bt*xt;return ei>0?[bt,-xt]:ei<0?[-bt,xt]:bt===0?[xt,bt]:[xt,-bt]}(ee);let ke=Math.abs(K.top-K.bottom);for(const Xe of K.positionedLines)ke-=Xe.lineOffset;const Pe=K.positionedLines.length,Ze=ke/Pe;let Ue=K.top-ee[1];for(let Xe=0;Xe<Pe;++Xe){const bt=K.positionedLines[Xe];Ue=BE(K,Ze,Ue,Xe);for(const xt of bt.positionedGlyphs){if(!xt.rect)continue;const ei=xt.rect||{};let zt=Sr+1,Nt=!0,St=1,wi=0;if(xt.image){const Yn=Te.get(xt.image.toString());if(!Yn)continue;if(Yn.sdf){Kn("SDF images are not supported in formatted text and will be ignored.");continue}Nt=!1,St=Yn.pixelRatio,zt=u_/St}const Xt=(le||pe)&&xt.vertical,ci=xt.metrics.advance*xt.scale/2,Li=xt.metrics,Wi=xt.rect;if(Wi===null)continue;pe&&K.verticalizable&&(wi=xt.image?ci-xt.metrics.width*xt.scale/2:0);const ki=le?[xt.x+ci,xt.y]:[0,0];let an=[0,0],Yi=[0,0],un=!1;le||(Xt?(Yi=[xt.x+ci+Re[0],xt.y+Re[1]-wi],un=!0):an=[xt.x+ci+ee[0],xt.y+ee[1]-wi]);const Cn=Wi.w*xt.scale/(St*(xt.localGlyph?su:1)),er=Wi.h*xt.scale/(St*(xt.localGlyph?su:1));let Oi,_n,ur,_r;if(Xt){const Yn=xt.y-Ue,_a=new Ft(-ci,ci-Yn),Os=-Math.PI/2,Yr=new Ft(...Yi);Oi=new Ft(-ci+an[0],an[1]),Oi._rotateAround(Os,_a)._add(Yr),Oi.x+=-Yn+ci,Oi.y-=(Li.left-zt)*xt.scale;const ra=xt.image?Li.advance*xt.scale:Xr*xt.scale,ls=String.fromCodePoint(xt.glyph);R(ls)?Oi.x+=(1-zt)*xt.scale:B(ls)?Oi.x+=ra-Li.height*xt.scale+(-zt-1)*xt.scale:Oi.x+=xt.image||Li.width+2*zt===Wi.w&&Li.height+2*zt===Wi.h?(ra-er)/2:(ra-(Li.height+2*zt)*xt.scale)/2,_n=new Ft(Oi.x,Oi.y-Cn),ur=new Ft(Oi.x+er,Oi.y),_r=new Ft(Oi.x+er,Oi.y-Cn)}else{const Yn=(Li.left-zt)*xt.scale-ci+an[0],_a=(-Li.top-zt)*xt.scale+an[1],Os=Yn+Cn,Yr=_a+er;Oi=new Ft(Yn,_a),_n=new Ft(Os,_a),ur=new Ft(Yn,Yr),_r=new Ft(Os,Yr)}if(De){let Yn;Yn=le?new Ft(0,0):un?new Ft(Re[0],Re[1]):new Ft(ee[0],ee[1]),Oi._rotateAround(De,Yn),_n._rotateAround(De,Yn),ur._rotateAround(De,Yn),_r._rotateAround(De,Yn)}const wr=new Ft(0,0),Er=new Ft(0,0);Ee.push({tl:Oi,tr:_n,bl:ur,br:_r,texPrimary:ei,texSecondary:void 0,writingMode:K.writingMode,glyphOffset:ki,sectionIndex:xt.sectionIndex,isSDF:Nt,pixelOffsetTL:wr,pixelOffsetBR:Er,minFontScaleX:0,minFontScaleY:0})}}return Ee}(0,s,w,l,d,y,c,a.allowVerticalPlacement),H=a.textSizeData;let q=null;H.kind==="source"?(q=[xo*l.layout.get("text-size").evaluate(y,{},N)*M.textScaleFactor],q[0]>Of&&Kn(`${a.layerIds[0]}: Value for "text-size" is >= ${yg}. Reduce your "text-size".`)):H.kind==="composite"&&(q=[xo*M.compositeTextSizes[0].evaluate(y,{},N)*M.textScaleFactor,xo*M.compositeTextSizes[1].evaluate(y,{},N)*M.textScaleFactor],(q[0]>Of||q[1]>Of)&&Kn(`${a.layerIds[0]}: Value for "text-size" is >= ${yg}. Reduce your "text-size".`)),a.addSymbols(a.text,Z,q,w,d,y,_,e,i,A.lineStartIndex,A.lineLength,E,z,N,V,!1);for(const Y of T)C[Y]=a.text.placedSymbolArray.length-1;return 4*Z.length}function q0(a){for(const e in a)return a[e];return null}function sv(a,e,i,s,c,l,d,y,w,A){let _=d.top,T=d.bottom,C=d.left,E=d.right;const M=d.collisionPadding;if(M&&(C-=M[0],_-=M[1],E+=M[2],T+=M[3]),w){const z=new Ft(C,_),N=new Ft(E,_),V=new Ft(C,T),Z=new Ft(E,T),H=ln(w);let q=new Ft(0,0);A&&(q=new Ft(A[0],A[1])),z._rotateAround(H,q),N._rotateAround(H,q),V._rotateAround(H,q),Z._rotateAround(H,q),C=Math.min(z.x,N.x,V.x,Z.x),E=Math.max(z.x,N.x,V.x,Z.x),_=Math.min(z.y,N.y,V.y,Z.y),T=Math.max(z.y,N.y,V.y,Z.y)}return a.emplaceBack(e.x,e.y,e.z,i.x,i.y,C,_,E,T,y,s,c,l),a.length-1}function G0(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const e=a.bottom-a.top;return e>0?Math.max(10,e):null}function GE(a,e,i,s){const c=a.compareText;if(e in c){const l=c[e];for(let d=l.length-1;d>=0;d--)if(s.dist(l[d])<i)return!0}else c[e]=[];return c[e].push(s),!1}function wb(a,e){const i=a.fovAboveCenter,s=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,c=(a._camera.position[2]*a.worldSize-s)/Math.cos(a._pitch),l=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-a._pitch-i,.01));let d=Math.sin(a._pitch)*l+c;const y=c*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let w=Math.max(a.zoom-17,0);a.isOrthographic&&(w/=10),d*=1+w}return Math.min(1.01*d,y)}function vg(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};const i=Math.pow(2,-a.z),s=a.x*i,c=(a.x+1)*i,l=a.y*i,d=(a.y+1)*i,y=Ea(s),w=Ea(c),A=Vn(l),_=Vn(d),T=e.project(y,A),C=e.project(w,A),E=e.project(w,_),M=e.project(y,_);let z=Math.min(T.x,C.x,E.x,M.x),N=Math.min(T.y,C.y,E.y,M.y),V=Math.max(T.x,C.x,E.x,M.x),Z=Math.max(T.y,C.y,E.y,M.y);const H=i/16;function q(K,ee,he,le,ue,Te){const pe=(he+ue)/2,Ee=(le+Te)/2,De=e.project(Ea(pe),Vn(Ee)),Re=Math.max(0,z-De.x,N-De.y,De.x-V,De.y-Z);z=Math.min(z,De.x),V=Math.max(V,De.x),N=Math.min(N,De.y),Z=Math.max(Z,De.y),Re>H&&(q(K,De,he,le,pe,Ee),q(De,ee,pe,Ee,ue,Te))}q(T,C,s,l,c,l),q(C,E,c,l,c,d),q(E,M,c,d,s,d),q(M,T,s,d,s,l),z-=H,N-=H,V+=H,Z+=H;const Y=1/Math.max(V-z,Z-N);return{scale:Y,x:z*Y,y:N*Y,x2:V*Y,y2:Z*Y,projection:e}}function Tb(a,{x:e,y:i},s=0){return new Ft(((e-s)*a.scale-a.x)*Bt,(i*a.scale-a.y)*Bt)}const HE=de.mat4.identity(new Float32Array(16));class Pf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Tn(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s,c=!0){return e._coordinatePoint(e.locationCoordinate(i,s),c)}pixelsPerMeter(e,i){return Qr(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return wb(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,c){const l=e.horizonLineFromTop(!1),d=new Ft(i,Math.max(l,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,c))}pointCoordinate3D(e,i,s){const c=new Ft(i,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const l=this.pointCoordinate(e,c.x,c.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return HE}createTileMatrix(e,i,s){let c,l,d;const y=s.canonical,w=de.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=vg(y,this);c=1,l=A.x+s.wrap*A.scale,d=A.y,de.mat4.scale(w,w,[c/A.scale,c/A.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(y.z),l=(y.x+Math.pow(2,y.z)*s.wrap)*c,d=y.y*c;return de.mat4.translate(w,w,[l,d,0]),de.mat4.scale(w,w,[c/Bt,c/Bt,1]),w}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class ZE extends Pf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(ln(i));this.n=(c+Math.sin(ln(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c,r0:l}=this,d=ln(e-this.center[0]),y=ln(i),w=Math.sqrt(c-2*s*Math.sin(y))/s;return{x:w*Math.sin(d*s),y:w*Math.cos(d*s)-l,z:0}}unproject(e,i){const{n:s,c,r0:l}=this,d=l+i;let y=Math.atan2(e,Math.abs(d))*Math.sign(d);d*s<0&&(y-=Math.PI*Math.sign(e)*Math.sign(d));const w=ln(this.center[0])*s;y=gi(y,-Math.PI-w,Math.PI-w);const A=vt(Br(y/s)+this.center[0],-180,180),_=Math.asin(vt((c-(e*e+d*d)*s*s)/(2*s),-1,1)),T=vt(Br(_),-85.051129,os);return new Tn(A,T)}}const xg=1.340264,bg=-.081106,wg=893e-6,Tg=.003796,ov=Math.sqrt(3)/2;class $E extends Pf{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(ov*Math.sin(i)),c=s*s,l=c*c*c;return{x:.5*(e*Math.cos(s)/(ov*(xg+3*bg*c+l*(7*wg+9*Tg*c)))/Math.PI+.5),y:1-.5*(s*(xg+bg*c+l*(wg+Tg*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=s*s,l=c*c*c;for(let _,T,C,E=0;E<12&&(T=s*(xg+bg*c+l*(wg+Tg*c))-i,C=xg+3*bg*c+l*(7*wg+9*Tg*c),_=T/C,s=vt(s-_,-Math.PI/3,Math.PI/3),c=s*s,l=c*c*c,!(Math.abs(_)<1e-12));++E);const d=ov*e*(xg+3*bg*c+l*(7*wg+9*Tg*c))/Math.cos(s),y=Math.asin(Math.sin(s)/ov),w=vt(180*d/Math.PI,-180,180),A=vt(180*y/Math.PI,-85.051129,os);return new Tn(w,A)}}class XE extends Pf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),c=vt(360*(.5-i),-85.051129,os);return new Tn(s,c)}}const f_=Math.PI/2;function lv(a){return Math.tan((f_+a)/2)}class YE extends Pf{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let c=ln(i),l=ln(s);this.southernCenter=c+l<0,this.southernCenter&&(c=-c,l=-l);const d=Math.cos(c),y=lv(c);this.n=c===l?Math.sin(c):Math.log(d/Math.cos(l))/Math.log(lv(l)/y),this.f=d*Math.pow(lv(c),this.n)/this.n}project(e,i){i=ln(i),this.southernCenter&&(i=-i),e=ln(e-this.center[0]);const s=1e-6,{n:c,f:l}=this;l>0?i<-f_+s&&(i=-f_+s):i>f_-s&&(i=f_-s);const d=l/Math.pow(lv(i),c);let y=d*Math.sin(c*e),w=l-d*Math.cos(c*e);return y=.5*(y/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:y,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:c}=this,l=c-i,d=Math.sign(l),y=Math.sign(s)*Math.sqrt(e*e+l*l);let w=Math.atan2(e,Math.abs(l))*d;l*s<0&&(w-=Math.PI*Math.sign(e)*d);const A=vt(Br(w/s)+this.center[0],-180,180),_=vt(Br(2*Math.atan(Math.pow(c/y,1/s))-f_),-85.051129,os);return new Tn(A,this.southernCenter?-_:_)}}class Sb extends Pf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Sa(e),y:ss(i),z:0}}unproject(e,i){const s=Ea(e),c=Vn(i);return new Tn(s,c)}}const Eb=ln(os);class WE extends Pf{project(e,i){const s=(i=ln(i))*i,c=s*s;return{x:.5*((e=ln(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=25,l=0,d=s*s;do{d=s*s;const A=d*d;l=(s*(1.007226+d*(.015085+A*(.028874*d-.044475-.005916*A)))-i)/(1.007226+d*(.045255+A*(.259866*d-.311325-.005916*11*A))),s=vt(s-l,-Eb,Eb)}while(Math.abs(l)>1e-6&&--c>0);d=s*s;const y=vt(Br(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),w=Br(s);return new Tn(y,w)}}const Ab=ln(os);class KE extends Pf{project(e,i){i=ln(i),e=ln(e);const s=Math.cos(i),c=2/Math.PI,l=Math.acos(s*Math.cos(e/2)),d=Math.sin(l)/l,y=.5*(e*c+2*s*Math.sin(e/2)/d)||0,w=.5*(i+Math.sin(i)/d)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,l=25;const d=1e-6;let y=0,w=0;do{const A=Math.cos(c),_=Math.sin(c),T=2*_*A,C=_*_,E=A*A,M=Math.cos(s/2),z=Math.sin(s/2),N=2*M*z,V=z*z,Z=1-E*M*M,H=Z?1/Z:0,q=Z?Math.acos(A*M)*Math.sqrt(1/Z):0,Y=.5*(2*q*A*z+2*s/Math.PI)-e,K=.5*(q*_+c)-i,ee=.5*H*(E*V+q*A*M*C)+1/Math.PI,he=H*(N*T/4-q*_*z),le=.125*H*(T*z-q*_*E*N),ue=.5*H*(C*M+q*V*A)+.5,Te=he*le-ue*ee;y=(K*he-Y*ue)/Te,w=(Y*le-K*ee)/Te,s=vt(s-y,-Math.PI,Math.PI),c=vt(c-w,-Ab,Ab)}while((Math.abs(y)>d||Math.abs(w)>d)&&--l>0);return new Tn(Br(s),Br(c))}}class Mb extends Pf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ln(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:c}=this;return{x:ln(e)*c*s+.5,y:-Math.sin(ln(i))/c*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:c}=this,l=-(i-.5)/s,d=vt(Br((e-.5)/s)/c,-180,180),y=Math.asin(vt(l*c,-1,1)),w=vt(Br(y),-85.051129,os);return new Tn(d,w)}}class JE extends Sb{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const c=mn(e,i,s),l=Qn(Pn(s));return de.vec3.transformMat4(c,c,l),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i,s){const c=hl(i.lat,i.lng),l=de.vec3.normalize([],c),d=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,y=Qr(1,0)*Bt*d;de.vec3.scaleAndAdd(c,c,l,y);const w=de.mat4.identity(new Float64Array(16));return de.mat4.multiply(w,e.pixelMatrix,e.globeMatrix),de.vec3.transformMat4(c,c,w),new Ft(c[0],c[1])}pixelsPerMeter(e,i){return Qr(1,0)*i}pixelSpaceConversion(e,i,s){const c=Qr(1,e)*i,l=yi(Qr(1,45)*i,c,s);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,s){const c=Dr(Pn(s.canonical));return de.mat4.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:s}=e,c=Qn(Pn(i));return de.mat4.rotateY(c,c,ln(s.lng)),de.mat4.rotateX(c,c,ln(s.lat)),de.mat4.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,s,c){return hn(e,i,s,!0)||new t(0,0)}pointCoordinate3D(e,i,s){const c=this.pointCoordinate(e,i,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!hn(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,l){const d=c.cameraToCenterDistance,y=c._centerAltitude*l,w=c._camera,A=c._camera.forward(),_=de.vec3.add([],de.vec3.scale([],A,-d),[0,0,y]),T=c.worldSize/(2*Math.PI),C=[0,0,-T],E=c.width/c.height,M=Math.tan(c.fovAboveCenter),z=de.vec3.scale([],w.up(),M),N=de.vec3.scale([],w.right(),M*E),V=de.vec3.normalize([],de.vec3.add([],de.vec3.add([],A,z),N)),Z=[];let H;if(new Ci(_,V).closestPointOnSphere(C,T,Z)){const q=de.vec3.add([],Z,C),Y=de.vec3.sub([],q,_);H=Math.cos(c.fovAboveCenter)*de.vec3.length(Y)}else{const q=de.vec3.sub([],_,C),Y=de.vec3.sub([],C,_);de.vec3.normalize(Y,Y);const K=de.vec3.length(q)-T;H=Math.sqrt(K*(K+2*T));const ee=Math.acos(H/(T+K))-Math.acos(de.vec3.dot(A,Y));H*=Math.cos(ee)}return 1.01*H}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=$r(e.zoom);if(s>0){const c=wb(e,Qr(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return yi(i,c+l*(1-Math.cos(d)),Math.pow(s,10))}return i}upVector(e,i,s){return mn(i,s,e,1)}upVectorScale(e){return{metersToTile:Hi(fn(Pn(e)))}}}function Cb(a){const e=a.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new Sb(a);case"equirectangular":return new XE(a);case"naturalEarth":return new WE(a);case"equalEarth":return new $E(a);case"winkelTripel":return new KE(a);case"albers":return i?new Mb(a):new ZE(a);case"lambertConformalConic":return i?new Mb(a):new YE(a);case"globe":return new JE(a)}throw new Error(`Invalid projection name: ${a.name}`)}const QE=Qc.VectorTileFeature.types,eA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cv(a,e,i,s,c,l,d,y,w,A,_,T,C){const E=y?Math.min(Of,Math.round(y[0])):0,M=y?Math.min(Of,Math.round(y[1])):0;a.emplaceBack(e,i,Math.round(32*s),Math.round(32*c),l,d,(E<<1)+(w?1:0),M,16*A,16*_,256*T,256*C)}function uv(a,e,i){a.emplaceBack(e,i)}function hv(a,e,i,s,c,l,d){a.emplaceBack(e,i,s,c,l,d)}function dv(a,e,i,s,c){a.emplaceBack(e,i,s,c),a.emplaceBack(e,i,s,c),a.emplaceBack(e,i,s,c),a.emplaceBack(e,i,s,c)}function tA(a){for(const e of a.sections)if(lp(e.text))return!0;return!1}class H0{constructor(e){this.layoutVertexArray=new rf,this.indexArray=new ca,this.programConfigurations=e,this.segments=new On,this.dynamicLayoutVertexArray=new Xl,this.opacityVertexArray=new sf,this.placedSymbolArray=new hp,this.iconTransitioningVertexArray=new Fo,this.globeExtVertexArray=new af,this.zOffsetVertexArray=new jc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,s,c,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Qy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,eA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,ev.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,N0.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,s_.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Wt(H0,"SymbolBuffers");class Z0{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new On,this.collisionVertexArray=new lf,this.collisionVertexArrayExt=new Xl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,F0.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,o_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wt(Z0,"CollisionBuffers");class fv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=de.mat4.identity([]),this.placementViewportMatrix=de.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=l_(this.zoom,i["text-size"]),this.iconSizeData=l_(this.zoom,i["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),l=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(d=>dt[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new H0(new cl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new H0(new cl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Gc,this.lineVertexArray=new ll,this.symbolInstances=new Tm}calculateGlyphDependencies(e,i,s,c,l){for(const d of e){const y=d.codePointAt(0);if(y===void 0)break;if(i[y]=!0,c&&l&&y<=65535){const w=x[d];w&&(i[w.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!yo(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,i,s,c){const l=this.layers[0],d=l.layout,y=this.projection.name==="globe",w=d.get("text-font"),A=d.get("text-field"),_=d.get("icon-image"),[T,C]=d.get("icon-size-scale-range"),E=vt(i.scaleFactor||1,T,C),M=(A.value.kind!=="constant"||A.value.value instanceof va&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),z=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,N=d.get("symbol-sort-key");if(this.features=[],!M&&!z)return;const V=i.iconDependencies,Z=i.glyphDependencies,H=i.availableImages,q=new Ln(this.zoom);for(const{feature:Y,id:K,index:ee,sourceLayerIndex:he}of e){const le=l._featureFilter.needGeometry,ue=k(Y,le);if(!l._featureFilter.filter(q,ue,s))continue;if(le||(ue.geometry=P(Y,s,c)),y&&Y.type!==1&&s.z<=5){const Re=ue.geometry,ke=.98078528056,Pe=(Ze,Ue)=>{const Xe=mn(Ze.x,Ze.y,s,1),bt=mn(Ue.x,Ue.y,s,1);return de.vec3.dot(Xe,bt)<ke};for(let Ze=0;Ze<Re.length;Ze++)Re[Ze]=g(Re[Ze],Pe)}let Te,pe;if(M){const Re=l.getValueAndResolveTokens("text-field",ue,s,H),ke=va.factory(Re);tA(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||Vr()==="unavailable"||this.hasRTLText&&za.isParsed())&&(Te=f(ke,l,ue))}if(z){const Re=l.getValueAndResolveTokens("icon-image",ue,s,H);pe=Re instanceof Ra?Re:Ra.build(Re)}if(!Te&&!pe)continue;const Ee=this.sortFeaturesByKey?N.evaluate(ue,{},s):void 0,De={id:K,text:Te,icon:pe,index:ee,sourceLayerIndex:he,geometry:ue.geometry,properties:Y.properties,type:QE[Y.type],sortKey:Ee};if(this.features.push(De),pe){const Re=this.layers[0]._unevaluatedLayout._values,{iconPrimary:ke,iconSecondary:Pe}=yb(pe,this.iconSizeData,Re["icon-size"],s,this.zoom,De,this.pixelRatio,E),Ze=ke.id.toString();if(V.has(Ze)?V.get(Ze).push(ke):V.set(Ze,[ke]),Pe){const Ue=Pe.id.toString();V.has(Ue)?V.get(Ue).push(Pe):V.set(Ue,[Pe])}}if(Te){const Re=w.evaluate(ue,{},s).join(","),ke=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(dt.vertical)>=0;for(const Pe of Te.sections)if(Pe.image){const Ze=Pe.image.getPrimary().scaleSelf(this.pixelRatio),Ue=Ze.id.toString(),Xe=V.get(Ue)||[];Xe.push(Ze),V.set(Ue,Xe)}else{const Ze=Uh(Te.toString()),Ue=Pe.fontStack||Re,Xe=Z[Ue]=Z[Ue]||{};this.calculateGlyphDependencies(Pe.text,Xe,ke,this.allowVerticalPlacement,Ze)}}}if(d.get("symbol-placement")==="line"&&(this.features=function(Y){const K={},ee={},he=[];let le=0;function ue(De){he.push(Y[De]),le++}function Te(De,Re,ke){const Pe=ee[De];return delete ee[De],ee[Re]=Pe,he[Pe].geometry[0].pop(),he[Pe].geometry[0]=he[Pe].geometry[0].concat(ke[0]),Pe}function pe(De,Re,ke){const Pe=K[Re];return delete K[Re],K[De]=Pe,he[Pe].geometry[0].shift(),he[Pe].geometry[0]=ke[0].concat(he[Pe].geometry[0]),Pe}function Ee(De,Re,ke){const Pe=ke?Re[0][Re[0].length-1]:Re[0][0];return`${De}:${Pe.x}:${Pe.y}`}for(let De=0;De<Y.length;De++){const Re=Y[De],ke=Re.geometry,Pe=Re.text?Re.text.toString():null;if(!Pe){ue(De);continue}const Ze=Ee(Pe,ke),Ue=Ee(Pe,ke,!0);if(Ze in ee&&Ue in K&&ee[Ze]!==K[Ue]){const Xe=pe(Ze,Ue,ke),bt=Te(Ze,Ue,he[Xe].geometry);delete K[Ze],delete ee[Ue],ee[Ee(Pe,he[bt].geometry,!0)]=bt,he[Xe].geometry=null}else Ze in ee?Te(Ze,Ue,ke):Ue in K?pe(Ze,Ue,ke):(ue(De),K[Ze]=le-1,ee[Ue]=le-1)}return he.filter(De=>De.geometry)}(this.features)),d.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Y of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Y.id,this.elevationFeatures.length),this.elevationFeatures.push(Y)}}else d.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Y,K)=>Y.sortKey-K.sortKey)}update(e,i,s,c,l,d,y){this.text.programConfigurations.updatePaintArrays(e,i,l,s,c,d,y),this.icon.programConfigurations.updatePaintArrays(e,i,l,s,c,d,y)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);if(s.elevationFeatureIndex===65535)continue;const c=this.elevationFeatures[s.elevationFeatureIndex];if(c){const l=.05+c.pointElevation(new Ft(s.tileAnchorX,s.tileAnchorY));s.zOffset!==l&&(e=!0,s.zOffset=l)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(l,d,y)=>{s+=d,s>l.length&&l.resize(s);for(let w=-d;w<0;w++)l.emplace(w+s,y)},i=(l,d,y)=>{c+=d,c>l.length&&l.resize(c);for(let w=-d;w<0;w++)l.emplace(w+c,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,c=0;for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:w,numIconVertices:A}=d,_=d.zOffset,T=A>0;if((y>0||w>0)&&(e(this.text.zOffsetVertexArray,y,_),e(this.text.zOffsetVertexArray,w,_)),T){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:E}=d;C>=0&&i(this.icon.zOffsetVertexArray,A,_),E>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Cb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:l}of i)this.lineVertexArray.emplaceBack(c,l);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,c,l,d,y,w,A,_,T,C,E,M,z,N){const V=e.indexArray,Z=e.layoutVertexArray,H=e.globeExtVertexArray,q=e.segments.prepareSegment(4*i.length,Z,V,this.canOverlap?d.sortKey:void 0),Y=this.glyphOffsetArray.length,K=q.vertexLength,ee=this.allowVerticalPlacement&&y===dt.vertical?Math.PI/2:0,he=d.text&&d.text.sections;for(let ue=0;ue<i.length;ue++){const{tl:Te,tr:pe,bl:Ee,br:De,texPrimary:Re,texSecondary:ke,pixelOffsetTL:Pe,pixelOffsetBR:Ze,minFontScaleX:Ue,minFontScaleY:Xe,glyphOffset:bt,isSDF:xt,sectionIndex:ei}=i[ue],zt=q.vertexLength,Nt=bt[1];if(cv(Z,A.x,A.y,Te.x,Nt+Te.y,Re.x,Re.y,s,xt,Pe.x,Pe.y,Ue,Xe),cv(Z,A.x,A.y,pe.x,Nt+pe.y,Re.x+Re.w,Re.y,s,xt,Ze.x,Pe.y,Ue,Xe),cv(Z,A.x,A.y,Ee.x,Nt+Ee.y,Re.x,Re.y+Re.h,s,xt,Pe.x,Ze.y,Ue,Xe),cv(Z,A.x,A.y,De.x,Nt+De.y,Re.x+Re.w,Re.y+Re.h,s,xt,Ze.x,Ze.y,Ue,Xe),w){const{x:St,y:wi,z:Xt}=w.anchor,[ci,Li,Wi]=w.up;hv(H,St,wi,Xt,ci,Li,Wi),hv(H,St,wi,Xt,ci,Li,Wi),hv(H,St,wi,Xt,ci,Li,Wi),hv(H,St,wi,Xt,ci,Li,Wi),dv(e.dynamicLayoutVertexArray,St,wi,Xt,ee)}else dv(e.dynamicLayoutVertexArray,A.x,A.y,A.z,ee);if(N){const St=ke||Re;uv(e.iconTransitioningVertexArray,St.x,St.y),uv(e.iconTransitioningVertexArray,St.x+St.w,St.y),uv(e.iconTransitioningVertexArray,St.x,St.y+St.h),uv(e.iconTransitioningVertexArray,St.x+St.w,St.y+St.h)}V.emplaceBack(zt,zt+1,zt+2),V.emplaceBack(zt+1,zt+2,zt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bt[0]),ue!==i.length-1&&ei===i[ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,d,d.index,{},E,M,z,he&&he[ei])}const le=w?w.anchor:A;e.placedSymbolArray.emplaceBack(le.x,le.y,le.z,A.x,A.y,Y,this.glyphOffsetArray.length-Y,K,_,T,A.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],y,0,!1,0,C,0)}_commitLayoutVertex(e,i,s,c,l,d,y){e.emplaceBack(i,s,c,l,d,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,s,c,l,d,y){const w=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),A=w.vertexLength,_=y.tileAnchorX,T=y.tileAnchorY;for(let E=0;E<4;E++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,y.zOffset),this._commitLayoutVertex(s.layoutVertexArray,c,l,d,_,T,new Ft(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,l,d,_,T,new Ft(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,l,d,_,T,new Ft(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,l,d,_,T,new Ft(e.x1,e.y2)),w.vertexLength+=4;const C=s.indexArray;C.emplaceBack(A,A+1),C.emplaceBack(A+1,A+2),C.emplaceBack(A+2,A+3),C.emplaceBack(A+3,A),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,c,l,d){for(let y=c;y<l;y++){const w=s.get(y),A=this.getSymbolInstanceTextSize(e,d,i,y);this._addCollisionDebugVertices(w,A,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,s,c,l,d){for(let y=c;y<l;y++){const w=s.get(y),A=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(w,A,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Z0(Vu,Np.members,Fo),this.iconCollisionBox=new Z0(Vu,Np.members,Fo);const c=ru(this.iconSizeData,e),l=ru(this.textSizeData,e,s);for(let d=0;d<this.symbolInstances.length;d++){const y=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(l,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(l,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,i,s,c){const l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),d=c_(this.textSizeData,e,l)/Xr;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,s){const c=this.icon.placedSymbolArray.get(s),l=c_(this.iconSizeData,e,c);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,s,c){e.emplaceBack(i,-s,-s,c),e.emplaceBack(i,s,-s,c),e.emplaceBack(i,s,s,c),e.emplaceBack(i,-s,s,c)}_updateTextDebugCollisionBoxes(e,i,s,c,l,d,y){for(let w=c;w<l;w++){const A=s.get(w),_=this.getSymbolInstanceTextSize(e,d,i,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,A.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,c,l,d,y){for(let w=c;w<l;w++){const A=s.get(w),_=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,A.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i,s,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=ru(this.iconSizeData,e,c),d=ru(this.textSizeData,e,s);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(d,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w,s),this._updateTextDebugCollisionBoxes(d,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,s),this._updateIconDebugCollisionBoxes(l,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w,c),this._updateIconDebugCollisionBoxes(l,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,c,l,d,y,w,A){const _={};if(i<s){const{x1:T,y1:C,x2:E,y2:M,padding:z,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:H,tileAnchorY:q,featureIndex:Y}=e.get(i);_.textBox={x1:T,y1:C,x2:E,y2:M,padding:z,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:H,tileAnchorY:q},_.textFeatureIndex=Y}if(c<l){const{x1:T,y1:C,x2:E,y2:M,padding:z,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:H,tileAnchorY:q,featureIndex:Y}=e.get(c);_.verticalTextBox={x1:T,y1:C,x2:E,y2:M,padding:z,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:H,tileAnchorY:q},_.verticalTextFeatureIndex=Y}if(d<y){const{x1:T,y1:C,x2:E,y2:M,padding:z,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:H,tileAnchorY:q,featureIndex:Y}=e.get(d);_.iconBox={x1:T,y1:C,x2:E,y2:M,padding:z,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:H,tileAnchorY:q},_.iconFeatureIndex=Y}if(w<A){const{x1:T,y1:C,x2:E,y2:M,padding:z,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:H,tileAnchorY:q,featureIndex:Y}=e.get(w);_.verticalIconBox={x1:T,y1:C,x2:E,y2:M,padding:z,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Z,tileAnchorX:H,tileAnchorY:q},_.verticalIconFeatureIndex=Y}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),c=s.vertexStartIndex+4*s.numGlyphs;for(let l=s.vertexStartIndex;l<c;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),c=[],l=[],d=[];for(let y=0;y<this.symbolInstances.length;++y){d.push(y);const w=this.symbolInstances.get(y);c.push(0|Math.round(i*w.tileAnchorX+s*w.tileAnchorY)),l.push(w.featureIndex)}return d.sort((y,w)=>c[y]-c[w]||l[w]-l[y]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:A}=s;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),l>=0&&l!==c&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ib,Rb,$0;Wt(fv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fv.addDynamicAttributes=dv;class Db{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:bl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt(Db,"FormatSectionOverride",{omit:["defaultValue"]});const X0=()=>$0||($0={layout:Ib||(Ib=new lr({"symbol-placement":new Pt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Pt($e.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Pt($e.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Pt($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt($e.layout_symbol["icon-size"]),"icon-size-scale-range":new Pt($e.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Kt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt($e.layout_symbol["icon-image"]),"icon-rotate":new Kt($e.layout_symbol["icon-rotate"]),"icon-padding":new Pt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt($e.layout_symbol["icon-offset"]),"icon-anchor":new Kt($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt($e.layout_symbol["text-rotation-alignment"]),"text-field":new Kt($e.layout_symbol["text-field"]),"text-font":new Kt($e.layout_symbol["text-font"]),"text-size":new Kt($e.layout_symbol["text-size"]),"text-size-scale-range":new Pt($e.layout_symbol["text-size-scale-range"]),"text-max-width":new Kt($e.layout_symbol["text-max-width"]),"text-line-height":new Kt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt($e.layout_symbol["text-letter-spacing"]),"text-justify":new Kt($e.layout_symbol["text-justify"]),"text-radial-offset":new Kt($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt($e.layout_symbol["text-variable-anchor"]),"text-anchor":new Kt($e.layout_symbol["text-anchor"]),"text-max-angle":new Pt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt($e.layout_symbol["text-writing-mode"]),"text-rotate":new Kt($e.layout_symbol["text-rotate"]),"text-padding":new Pt($e.layout_symbol["text-padding"]),"text-keep-upright":new Pt($e.layout_symbol["text-keep-upright"]),"text-transform":new Kt($e.layout_symbol["text-transform"]),"text-offset":new Kt($e.layout_symbol["text-offset"]),"text-allow-overlap":new Pt($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Pt($e.layout_symbol["text-optional"]),visibility:new Pt($e.layout_symbol.visibility)})),paint:Rb||(Rb=new lr({"icon-opacity":new Kt($e.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Kt($e.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Kt($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Kt($e.paint_symbol["text-emissive-strength"]),"icon-color":new Kt($e.paint_symbol["icon-color"]),"icon-halo-color":new Kt($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Kt($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Kt($e.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Kt($e.paint_symbol["text-occlusion-opacity"]),"text-color":new Kt($e.paint_symbol["text-color"],{runtimeType:aa,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Kt($e.paint_symbol["text-halo-color"]),"text-halo-width":new Kt($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt($e.paint_symbol["text-halo-blur"]),"text-translate":new Pt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Pt($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Pt($e.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Pt($e.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Pt($e.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Pt($e.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Kt($e.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},$0);class pv extends Jr{constructor(e,i,s,c){super(e,X0(),i,s,c),this._colorAdjustmentMatrix=de.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const l of s)c.indexOf(l)<0&&c.push(l);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,c){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(l,d,y,w){l=at(l),d=pc(d);const A=de.mat4.create(),_=l/3,T=1-2*_,C=[T,_,_,0,_,T,_,0,_,_,T,0,0,0,0,1],E=.5-.5*d,M=w-y;return de.mat4.multiply(A,[M,0,0,0,0,M,0,0,0,0,M,0,y,y,y,1],[d,0,0,0,0,d,0,0,0,0,d,0,E,E,E,1]),de.mat4.multiply(A,A,C),A}(e,i,s,c),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,c){const l=this.layout.get(e).evaluate(i,{},s,c),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Gd(d.value)||!l?l:function(y,w){return w.replace(/{([^{}]+)}/g,(A,_)=>_ in y?String(y[_]):"")}(i.properties,l)}createBucket(e){return new fv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of X0().paint.overridableProperties){if(!pv.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new Db(i),c=new qd(s,i.property.specification,this.scope,this.options);let l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new nl("source",c):new kl("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new ql(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&pv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),c=X0().paint.properties[i];let l=!1;const d=y=>{for(const w of y)if(c.overrides&&c.overrides.hasOverride(w))return void(l=!0)};if(s.value.kind==="constant"&&s.value.value instanceof va)d(s.value.value.sections);else if(s.value.kind==="source"){const y=A=>{l||(A instanceof $o&&Fr(A.value)===Tu?d(A.value.sections):A instanceof Eu?d(A.sections):A.eachChild(y))},w=s.value;w._styleExpression&&y(w._styleExpression.expression)}return l}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new Ql(this,{zoom:i,lut:s}),overrideFog:!1}}}let zb,Lb,Ob,Pb;var Y0=wn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function W0(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function K0(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class J0{constructor(e,i,s,c){this.context=e,this.format=s,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:c&&c.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:l}=this,{gl:d}=l,{x:y,y:w}=i&&i.position?i.position:{x:0,y:0},A=y+s,_=w+c;!this.size||this.size[0]===A&&this.size[1]===_||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!i||i.premultiply!==!1));const T=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&_>0){const C=this.useMipmap?Math.floor(Math.log2(Math.max(A,_)))+1:1;d.texStorage2D(d.TEXTURE_2D,C,this.format,A,_),this.size=[A,_]}if(this.size)if(T)d.texSubImage2D(d.TEXTURE_2D,0,y,w,W0(this.format),K0(this.format),e);else{const C=e.data;C&&d.texSubImage2D(d.TEXTURE_2D,0,y,w,s,c,W0(this.format),K0(this.format),C)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i,s=!1){const{context:c}=this,{gl:l}=c;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,c){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),this.wrapS=s),c!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class mv{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}function _v(a,e,i,s,c,l,d,y){const w=[a,e,1,i,s,1,c,l,1],A=[d,y,1],_=de.mat3.adjoint([],w),[T,C,E]=de.vec3.transformMat3(A,A,_);return de.mat3.multiply(w,w,[T,0,0,0,C,0,0,0,E])}function kb(a,e,i,s,c,l,d,y){const w=function(A,_,T,C,E,M,z,N){const V=_v(0,0,1,0,1,1,0,1),Z=_v(A,_,T,C,E,M,z,N),H=de.mat3.adjoint([],V);return de.mat3.multiply(Z,Z,H)}(a,e,i,s,c,l,d,y);return[w[2]/w[8]/Bt,w[5]/w[8]/Bt]}function gv(a){return[a[0],Math.min(Math.max(a[1],-85.051129),os)]}class Bb extends Vs{constructor(e,i,s,c){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Ya("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ad(this.map._requestManager.transformRequest(this.url,Cr.Image),(s,c)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new oo(s)):c&&(this.image=c instanceof HTMLImageElement?rt.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new mv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ya("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof mv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const l of e)l[1]>s&&(s=l[1]),l[1]<i&&(i=l[1]);const c=(s+i)/2;if(c>os?this.onNorthPole=!0:c<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(t.fromLngLat);this.tileID=function(d){let y=1/0,w=1/0,A=-1/0,_=-1/0;for(const z of d)y=Math.min(y,z.x),w=Math.min(w,z.y),A=Math.max(A,z.x),_=Math.max(_,z.y);const T=Math.max(A-y,_-w),C=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),E=Math.pow(2,C);let M=Math.floor((y+A)/2*E);return M>1&&(M-=1),new yt(C,M,Math.floor((w+_)/2*E))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ya("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const V in this.tiles){const Z=this.tiles[V];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=vg(new yt(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const Z=V[1].x-V[0].x,H=V[1].y-V[0].y,q=V[2].x-V[1].x,Y=V[2].y-V[1].y,K=V[3].x-V[2].x,ee=V[3].y-V[2].y,he=V[0].x-V[3].x,le=V[0].y-V[3].y,ue=Z*Y-q*H,Te=q*ee-K*Y,pe=K*le-he*ee,Ee=he*H-Z*le;return ue>0&&Te>0&&pe>0&&Ee>0||ue<0&&Te<0&&pe<0&&Ee<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=vg(this.tileID,this.map.transform.projection),[l,d,y,w]=this.coordinates.map(V=>{const Z=c.projection.project(V[0],V[1]);return Tb(c,Z)._round()});this.perspectiveTransform=kb(l.x,l.y,d.x,d.y,y.x,y.y,w.x,w.y);const A=this._boundsArray=new No;A.emplaceBack(l.x,l.y,0,0),A.emplaceBack(d.x,d.y,Bt,0),A.emplaceBack(w.x,w.y,0,Bt),A.emplaceBack(y.x,y.y,Bt,Bt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,Y0.members),this.boundsSegments=On.simpleSegment(0,0,4,2);const _=[],T=[gv((C=this.coordinates)[0]),gv(C[1]),gv(C[2]),gv(C[3])];var C;const[E,M,z,N]=function(V){let Z=V[0][0],H=Z,q=V[0][1],Y=q;for(let K=1;K<V.length;K++)V[K][0]<Z?Z=V[K][0]:V[K][0]>H&&(H=V[K][0]),V[K][1]<q?q=V[K][1]:V[K][1]>Y&&(Y=V[K][1]);return[Z,q,H-Z,Y-q]}(T);{const V=new No,[Z,H,q,Y]=function(Pe){let Ze=Pe[0].x,Ue=Ze,Xe=Pe[0].y,bt=Xe;for(let xt=1;xt<Pe.length;xt++)Pe[xt].x<Ze?Ze=Pe[xt].x:Pe[xt].x>Ue&&(Ue=Pe[xt].x),Pe[xt].y<Xe?Xe=Pe[xt].y:Pe[xt].y>bt&&(bt=Pe[xt].y);return[Ze,Xe,Ue-Ze,bt-Xe]}(s),K=Pe=>[(Pe.x-Z)/q,(Pe.y-H)/Y],[ee,he,le,ue]=s.map(K),Te=function(Pe,Ze,Ue,Xe,bt,xt,ei,zt){const Nt=_v(0,0,1,0,1,1,0,1),St=_v(Pe,Ze,Ue,Xe,bt,xt,ei,zt),wi=de.mat3.adjoint([],St);return de.mat3.multiply(Nt,Nt,wi)}(ee[0],ee[1],he[0],he[1],le[0],le[1],ue[0],ue[1]);this.elevatedGlobePerspectiveTransform=kb(ee[0],ee[1],he[0],he[1],le[0],le[1],ue[0],ue[1]);const pe=(Pe,Ze)=>{_.push(Pe.lng);const Ue=Math.round((Pe.lng-E)/z*Bt),Xe=Math.round((Pe.lat-M)/N*Bt),bt=K(Ze),xt=de.vec3.transformMat3([],[bt[0],bt[1],1],Te),ei=Math.round(xt[0]/xt[2]*Bt),zt=Math.round(xt[1]/xt[2]*Bt);V.emplaceBack(Ue,Xe,ei,zt)},Ee=s[3].x-s[0].x,De=s[3].y-s[0].y,Re=s[2].x-s[1].x,ke=s[2].y-s[1].y;for(let Pe=0;Pe<65;Pe++){const Ze=Pe/64,Ue=[s[0].x+Ze*Ee,s[0].y+Ze*De],Xe=[s[1].x+Ze*Re,s[1].y+Ze*ke],bt=Xe[0]-Ue[0],xt=Xe[1]-Ue[1];for(let ei=0;ei<65;ei++){const zt=ei/64,Nt={x:Ue[0]+bt*zt,y:Ue[1]+xt*zt};pe(i.projection.unproject(Nt.x,Nt.y),Nt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(V,Y0.members)}{this.maxLongitudeTriangleSize=0;let V=[],Z=new ca;const H=(q,Y,K)=>{Z.emplaceBack(q,Y,K);const ee=_[q],he=_[Y],le=_[K],ue=Math.min(Math.min(ee,he),le),Te=Math.max(Math.max(ee,he),le)-ue;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),V.push(ue+Te/2)};for(let q=0;q<64;q++)for(let Y=0;Y<64;Y++){const K=65*q+Y,ee=K+1,he=K+65,le=he+1;H(K,he,ee),H(ee,he,le)}[V,Z]=function(q,Y){const K=Array.from({length:q.length},(le,ue)=>ue);K.sort((le,ue)=>q[le]-q[ue]);const ee=[],he=new ca;for(let le=0;le<K.length;le++){const ue=K[le];ee.push(q[ue]);const Te=3*ue,pe=Te+1;he.emplaceBack(Y.uint16[Te],Y.uint16[pe],Y.uint16[pe+1])}return[ee,he]}(V,Z),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Z)}this.elevatedGlobeSegments=On.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/Bt,0,N/Bt,0,0,M,E,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof mv||(this.texture?this.texture.update(this.image):(this.texture=new J0(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let c=(l=e+180)+360*Math.round((s[0]-l)/360);var l;const d=new On,y=(T,C)=>{d.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:i.segments[0].vertexLength,primitiveLength:C,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-c)<=w){const T=wu(s,0,s.length,c+w);return T===s.length||y(T,ph(s,T+1,s.length,c+360-w)-T),d}c<s[0]&&(c+=360);const A=ph(s,0,s.length,c-w);if(A===s.length)return y(0,s.length),d;y(0,A-0);const _=wu(s,A+1,s.length,c+w);return _!==s.length&&y(_,s.length-_),d}}const iA=(Math.pow(256,2)-1)/16907520;class Nb extends Jr{constructor(e,i,s,c){super(e,{layout:Ob||(Ob=new lr({visibility:new Pt($e.layout_raster.visibility)})),paint:Pb||(Pb=new lr({"raster-opacity":new Pt($e.paint_raster["raster-opacity"]),"raster-color":new Gl($e.paint_raster["raster-color"]),"raster-color-mix":new Pt($e.paint_raster["raster-color-mix"]),"raster-color-range":new Pt($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new Pt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt($e.paint_raster["raster-saturation"]),"raster-contrast":new Pt($e.paint_raster["raster-contrast"]),"raster-resampling":new Pt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Pt($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new Pt($e.paint_raster["raster-array-band"]),"raster-elevation":new Pt($e.paint_raster["raster-elevation"]),"raster-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,s,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Bb&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(c)||s===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=wp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,c])}}let Fb,Vb,Ub,jb,qb;class Gb extends Jr{constructor(e,i,s,c){super(e,{layout:Fb||(Fb=new lr({visibility:new Pt($e["layout_raster-particle"].visibility)})),paint:Vb||(Vb=new lr({"raster-particle-array-band":new Pt($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Pt($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Gl($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Pt($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Pt($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Pt($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Pt($e["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Pt($e["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,s,c),this._updateColorRamp(),this.lastInvalidatedAt=rt.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=wp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=rt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class nA extends Jr{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Q0(a,e,i){const s=[0,0,1],c=de.quat.identity([]);return de.quat.rotateY(c,c,i?-ln(a)+Math.PI:ln(a)),de.quat.rotateX(c,c,-ln(e)),de.vec3.transformQuat(s,s,c),de.vec3.normalize(s,s)}function Hb(a,e){const i=yv(a.projection,a.zoom,a.width,a.height),s=function(l,d,y,w,A){const _=new Tn(y.lng-180*kf,y.lat),T=new Tn(y.lng+180*kf,y.lat),C=l.project(_.lng,_.lat),E=l.project(T.lng,T.lat),M=-Math.atan2(E.y-C.y,E.x-C.x),z=t.fromLngLat(y);z.y=vt(z.y,-1+kf,1-kf);const N=z.toLngLat(),V=l.project(N.lng,N.lat),Z=t.fromLngLat(N);Z.x+=kf;const H=Z.toLngLat(),q=l.project(H.lng,H.lat),Y=$b(q.x-V.x,q.y-V.y,M),K=t.fromLngLat(N);K.y+=kf;const ee=K.toLngLat(),he=l.project(ee.lng,ee.lat),le=$b(he.x-V.x,he.y-V.y,M),ue=Math.abs(Y.x)/Math.abs(le.y),Te=de.mat4.identity([]);de.mat4.rotateZ(Te,Te,-M*(1-(A?0:w)));const pe=de.mat4.identity([]);return de.mat4.scale(pe,pe,[1,1-(1-ue)*w,1]),pe[4]=-le.x/le.y*w,de.mat4.rotateZ(pe,pe,M),de.mat4.multiply(pe,Te,pe),pe}(a.projection,0,a.center,i,e),c=Zb(a);return de.mat4.scale(s,s,[c,c,1]),s}function Zb(a){const e=a.projection,i=yv(a.projection,a.zoom,a.width,a.height),s=ex(e,a.center),c=ex(e,Tn.convert(e.center));return Math.pow(2,s*i+(1-i)*c)}function yv(a,e,i,s,c=1/0){const l=a.range;if(!l)return 0;const d=Math.min(c,Math.max(i,s)),y=Math.log(d/1024)/Math.LN2;return bi(l[0]+y,l[1]+y,e)}const kf=1/4e4;function ex(a,e){const i=vt(e.lat,-85.051129,os),s=new Tn(e.lng-180*kf,i),c=new Tn(e.lng+180*kf,i),l=a.project(s.lng,i),d=a.project(c.lng,i),y=t.fromLngLat(s),w=t.fromLngLat(c),A=d.x-l.x,_=d.y-l.y,T=w.x-y.x,C=w.y-y.y,E=Math.sqrt((T*T+C*C)/(A*A+_*_));return Math.log(E)/Math.LN2}function $b(a,e,i){const s=Math.cos(i),c=Math.sin(i);return{x:a*s-e*c,y:a*c+e*s}}function Xb(a,e,i){de.mat4.identity(a),de.mat4.rotateZ(a,a,ln(e[2])),de.mat4.rotateX(a,a,ln(e[0])),de.mat4.rotateY(a,a,ln(e[1])),de.mat4.scale(a,a,i),de.mat4.multiply(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function vv(a,e,i,s,c,l,d,y){const w=[i[0]-e[0],i[1]-e[1],0],A=[s[0]-e[0],s[1]-e[1],0];if(de.vec3.length(w)<1e-12||de.vec3.length(A)<1e-12)return de.quat.identity(a);const _=de.vec3.cross([],w,A);de.vec3.normalize(_,_),de.vec3.subtract(A,s,e),w[2]=(l-c)*y,A[2]=(d-c)*y;const T=w;return de.vec3.cross(T,w,A),de.vec3.normalize(T,T),de.quat.rotationTo(a,_,T)}function tx(a,e,i=!1){const s=$r(e.zoom),c=function(l,d,y){const w=d.worldSize,A=[l[12],l[13],l[14]],_=Vn(A[1]/w),T=Ea(A[0]/w),C=de.mat4.identity([]),E=Qr(1,_)*w,M=Qr(1,0)*w*Qs(_,d.zoom),z=1/Ls(w);let N=M*z;if(y){const q=yv(d.projection,d.zoom,d.width,d.height,1024);N=z*d.projection.pixelSpaceConversion(d.center.lat,w,q)}const V=hl(_,T);de.vec3.add(V,V,de.vec3.scale([],de.vec3.normalize([],V),E*N*A[2]));const Z=function(q){const Y=[q[0],q[1],q[2]];let K=[0,1,0];const ee=de.vec3.cross([],K,Y);return de.vec3.cross(K,Y,ee),de.vec3.squaredLength(K)===0&&(K=[0,1,0],de.vec3.cross(ee,Y,K)),de.vec3.normalize(ee,ee),de.vec3.normalize(K,K),de.vec3.normalize(Y,Y),[ee[0],ee[1],ee[2],0,K[0],K[1],K[2],0,Y[0],Y[1],Y[2],0,q[0],q[1],q[2],1]}(V);de.mat4.scale(C,C,[N,N,N*E]),de.mat4.translate(C,C,[-A[0],-A[1],-A[2]]);const H=de.mat4.multiply([],d.globeMatrix,Z);return de.mat4.multiply(H,H,C),de.mat4.multiply(H,H,l),H}(a,e,i);if(s>0){const l=function(d,y){const w=y.worldSize,A=Qr(1,0)*w*Qs(y.center.lat,y.zoom)/Ls(w),_=Qr(1,y.center.lat)*w,T=de.mat4.identity([]);return de.mat4.rotateY(T,T,ln(y.center.lng)),de.mat4.rotateX(T,T,ln(y.center.lat)),de.mat4.translate(T,T,[0,0,La]),de.mat4.scale(T,T,[A,A,A*_]),de.mat4.translate(T,T,[y.point.x-.5*w,y.point.y-.5*w,0]),de.mat4.multiply(T,T,d),de.mat4.multiply(T,y.globeMatrix,T)}(a,e);return function(d,y,w){const A=(M,z,N)=>{const V=de.vec3.length(M),Z=de.vec3.length(z),H=vr(M,z,N);return de.vec3.scale(H,H,1/de.vec3.length(H)*yi(V,Z,N))},_=A([d[0],d[1],d[2]],[y[0],y[1],y[2]],w),T=A([d[4],d[5],d[6]],[y[4],y[5],y[6]],w),C=A([d[8],d[9],d[10]],[y[8],y[9],y[10]],w),E=vr([d[12],d[13],d[14]],[y[12],y[13],y[14]],w);return[_[0],_[1],_[2],0,T[0],T[1],T[2],0,C[0],C[1],C[2],0,E[0],E[1],E[2],1]}(c,l,s)}return c}function Yb(a,e,i,s){const c=jt.projectAabbCorners(s,i);let l=Number.MAX_VALUE,d=-1;for(let A=0;A<c.length;++A){const _=c[A];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<l&&(d=A,l=_[2])}const y=A=>new Ft(c[A][0],c[A][1]);let w;switch(d){case 0:case 6:w=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:w=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:w=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:w=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(Q(a,w))return l}const rA=wn([{name:"a_pos_3f",components:3,type:"Float32"}]),aA=wn([{name:"a_color_3f",components:3,type:"Float32"}]),sA=wn([{name:"a_color_4f",components:4,type:"Float32"}]),oA=wn([{name:"a_uv_2f",components:2,type:"Float32"}]),lA=wn([{name:"a_normal_3f",components:3,type:"Float32"}]),cA=wn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),uA=wn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Wb={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class xv{constructor(e,i,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function Kb(a,e){const i=a.indexOf("://")===-1;try{return new URL(a,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Jb{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Qb{constructor(){this.instancedDataArray=new ed,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ix{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,s,c){this.tileToMeter=h(s);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:y,index:w,sourceLayerIndex:A}of e){const _=y??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),T=k(d,l);if(!this.layers[0]._featureFilter.filter(new Ln(this.zoom),T,s))continue;const C={id:_,sourceLayerIndex:A,index:w,geometry:l?T.geometry:P(d,s,c),properties:d.properties,type:d.type,patterns:{}},E=this.addFeature(C,C.geometry,T);E&&i.featureIndex.insert(d,C.geometry,w,A,this.index,this.instancesPerModel[E].instancedDataArray.length,Bt/32)}this.lookup=null}update(e,i,s,c){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];for(const y in e)d.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(d.features[d.idToFeaturesIndex[y]],e[y],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const c of s.features){const l=this.layers[0],d=c.feature,y=this.canonical,w=l.paint.get("model-rotation").evaluate(d,{},y),A=l.paint.get("model-scale").evaluate(d,{},y),_=l.paint.get("model-translation").evaluate(d,{},y);de.vec3.exactEquals(c.rotation,w)&&de.vec3.exactEquals(c.scale,A)&&de.vec3.exactEquals(c.translation,_)||(this.evaluate(c,c.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,c){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(yo(this.activeReplacements,l))return!1;this.activeReplacements=l;let d=!1;for(const y in this.instancesPerModel){const w=this.instancesPerModel[y],A=w.instancedDataArray;for(const _ of w.features){const T=_.instancedDataOffset,C=_.instancedDataCount;for(let E=0;E<C;E++){const M=16*(E+T);let z=A.float32[M+0];const N=z>Bt;z=N?z-Bt:z;const V=Math.floor(z),Z=A.float32[M+1];let H=!1;for(const q of this.activeReplacements)if(!Uy(q,s,Wb.Model,c)&&!(q.min.x>V||V>q.max.x||q.min.y>Z||Z>q.max.y)&&(H=ag(vo(V,Z,e.canonical,q.footprintTileId.canonical),q.footprint),H))break;A.float32[M]=H?z+Bt:z,d=d||H!==N}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,cA.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,s){const c=this.layers[0],l=c.layout.get("model-id").evaluate(s,{},this.canonical);if(!l)return Kn(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),l;Kb(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new Qb);const d=this.instancesPerModel[l],y=d.instancedDataArray,w=new Jb(s,y.length);for(const A of i)for(const _ of A){if(_.x<0||_.x>=Bt||_.y<0||_.y>=Bt)continue;const T=(this.lookupDim-1)/Bt,C=this.lookupDim*(_.y*T|0)+_.x*T|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const E=y.length;y.resize(E+1),d.instancesEvaluatedElevation.push(0),y.float32[16*E]=_.x,y.float32[16*E+1]=_.y}return w.instancedDataCount=d.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(w),this.evaluate(w,{},d,!1)),l}getModelUris(){return this.modelUris}evaluate(e,i,s,c){const l=this.layers[0],d=e.feature,y=this.canonical,w=e.rotation=l.paint.get("model-rotation").evaluate(d,i,y),A=e.scale=l.paint.get("model-scale").evaluate(d,i,y),_=e.translation=l.paint.get("model-translation").evaluate(d,i,y),T=l.paint.get("model-color").evaluate(d,i,y);T.a=l.paint.get("model-color-mix-intensity").evaluate(d,i,y);const C=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),Xb(C,w,A);const E=Math.round(100*T.a)+T.b/1.05;for(let M=0;M<e.instancedDataCount;++M){const z=e.instancedDataOffset+M,N=16*z,V=s.instancedDataArray.float32;let Z=0;c&&(Z=V[N+6]-s.instancesEvaluatedElevation[z]);const H=0|V[N+1];V[N]=(0|V[N])+T.r/1.05,V[N+1]=H+T.g/1.05,V[N+2]=E,V[N+3]=1/(y.z>10?this.tileToMeter:h(y,H)),V[N+4]=_[0],V[N+5]=_[1],V[N+6]=_[2]+Z,V[N+7]=C[0],V[N+8]=C[1],V[N+9]=C[2],V[N+10]=C[4],V[N+11]=C[5],V[N+12]=C[6],V[N+13]=C[8],V[N+14]=C[9],V[N+15]=C[10],s.instancesEvaluatedElevation[z]=_[2]}}}let ew,tw;Wt(ix,"ModelBucket",{omit:["layers"]}),Wt(Qb,"PerModelAttributes"),Wt(Jb,"ModelFeature");const Up=64,p_={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function iw(a,e,i,s,c,l,d,y,w,A=!1){const _=i.zoom,T=i.project(s),C=Qs(s.lat,_),E=1/C;de.mat4.identity(a),de.mat4.translate(a,a,[T.x+d[0]*E,T.y+d[1]*E,d[2]]);let M=1,z=1;const N=i.worldSize;if(A){if(i.projection.name==="mercator"){let q=0;i.elevation&&(q=i.elevation.getAtPointOrZero(new t(T.x/N,T.y/N),0));const Y=de.vec4.transformMat4([],[T.x,T.y,q,1],i.projMatrix)[3]/i.cameraToCenterDistance;M=Y,z=Y*Qs(i.center.lat,_)}else if(i.projection.name==="globe"){const q=tx(a,i),Y=de.mat4.multiply([],i.projMatrix,q),K=[0,0,0,1];de.vec4.transformMat4(K,K,Y);const ee=K[3]/i.cameraToCenterDistance,he=$r(_),le=i.projection.pixelsPerMeter(s.lat,N)*Qs(s.lat,_),ue=i.projection.pixelsPerMeter(i.center.lat,N)*Qs(i.center.lat,_);M=ee/yi(le,xp(i.center.lat),he),z=ee*C/le,M*=ue,z*=ue}}else M=E;de.mat4.scale(a,a,[M,M,z]);const V=[...a],Z=e.orientation,H=[];if(Xb(H,[Z[0]+c[0],Z[1]+c[1],Z[2]+c[2]],l),de.mat4.multiply(a,V,H),y&&i.elevation){let q=0;const Y=[];if(w&&i.elevation){q=function(he,le,ue,Te,pe){const Ee=le.elevation;if(!Ee)return 0;const De=jt.projectAabbCorners(ue,Te),Re=Qr(1,pe.lat)*le.worldSize,ke=function(wi,Xt){const ci=[0,0,1],Li=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Wi of Li){const ki=wi[Wi.corners[0]],an=wi[Wi.corners[1]],Yi=wi[Wi.corners[2]],un=[an[0]-ki[0],an[1]-ki[1],Xt*(an[2]-ki[2])],Cn=de.vec3.cross(un,un,[Yi[0]-ki[0],Yi[1]-ki[1],Xt*(Yi[2]-ki[2])]);de.vec3.normalize(Cn,Cn),Wi.dotProductWithUp=de.vec3.dot(Cn,ci)}return Li.sort((Wi,ki)=>Wi.dotProductWithUp-ki.dotProductWithUp),Li[0].corners}(De,Re),Pe=De[ke[0]],Ze=De[ke[1]],Ue=De[ke[2]],Xe=De[ke[3]],bt=Ee.getAtPointOrZero(new t(Pe[0]/le.worldSize,Pe[1]/le.worldSize),0),xt=Ee.getAtPointOrZero(new t(Ze[0]/le.worldSize,Ze[1]/le.worldSize),0),ei=Ee.getAtPointOrZero(new t(Ue[0]/le.worldSize,Ue[1]/le.worldSize),0),zt=Ee.getAtPointOrZero(new t(Xe[0]/le.worldSize,Xe[1]/le.worldSize),0),Nt=(bt+zt)/2,St=(xt+ei)/2;return Nt>St?xt<ei?vv(he,Ze,Xe,Pe,xt,zt,bt,Re):vv(he,Ue,Pe,Xe,ei,bt,zt,Re):bt<zt?vv(he,Pe,Ze,Ue,bt,xt,ei,Re):vv(he,Xe,Ue,Ze,zt,ei,xt,Re),Math.max(Nt,St)}(Y,i,e.aabb,a,s);const K=de.mat4.fromQuat([],Y),ee=de.mat4.multiply([],K,H);de.mat4.multiply(a,V,ee)}else q=i.elevation.getAtPointOrZero(new t(T.x/N,T.y/N),0);q!==0&&(a[14]+=q)}}function Sg(a,e,i=!1){a.uploaded||(a.gfxTexture=new J0(e,a.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function hA(a,e,i){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,rA.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,lA.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,oA.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?aA:sA).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,uA.members,!0)),a.segments=On.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const s=a.material;s.pbrMetallicRoughness.baseColorTexture&&Sg(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Sg(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Sg(s.normalTexture,e),s.occlusionTexture&&Sg(s.occlusionTexture,e,i),s.emissionTexture&&Sg(s.emissionTexture,e)}function nx(a,e,i){if(a.meshes)for(const s of a.meshes)hA(s,e,i);if(a.children)for(const s of a.children)nx(s,e,i)}function bv(a){if(a.meshes)for(const e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(const e of a.children)bv(e)}function rx(a){if(a.meshes)for(const i of a.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(const i of a.children)rx(i)}class m_{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const c=s||e.findDEMTileFor(i);if(!c||!c.dem)return;const l=c.dem,d=c.tileID,y=1<<i.canonical.z-d.canonical.z;return new m_(c,l.dim/Bt/y,[(i.canonical.x/y-d.canonical.x)*l.dim,(i.canonical.y/y-d.canonical.y)*l.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(s);return new Ft(c,l)}getElevationAt(e,i,s,c){const l=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],y=Math.floor(l),w=Math.floor(d),A=this._dem;return c=!!c,s?yi(yi(A.get(y,w,c),A.get(y,w+1,c),d-w),yi(A.get(y+1,w,c),A.get(y+1,w+1,c),d-w),l-y):A.get(y,w,c)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Qr(1,e)*this._dem.stride}}const ax=new Float32Array(262144),jp=new Uint8Array(262144);function nw(a){let e=0;if(a.meshes)for(const i of a.meshes)e=Math.max(e,i.aabb.max[2]);if(a.children)for(const i of a.children)e=Math.max(e,nw(i));return e}function rw(a,e,i){if(a.meshes)for(const s of a.meshes){if(s.aabb.min[0]===1/0)continue;const c=jt.applyTransform(s.aabb,a.matrix);i.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(a.children)for(const s of a.children)rw(s,e,i)}const aw=["","wall","door","roof","window","lamp","logo"];class sw{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:nw(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=jt.applyTransformFast(s.aabb,this.node.matrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class wv{constructor(e,i,s,c,l,d,y){this.id=s,this.layers=e,this.layerIds=this.layers.map(w=>w.fqid),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.modelTraits|=p_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=p_.HasMapboxMeshFeatures),l&&(this.modelTraits|=p_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const w of i)this.nodesInfo.push(new sw(w)),rw(w,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const s of this.getNodesInfo()){const c=s.node;c.footprint&&i.push({footprint:c.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!Ss(e,this.states))for(const c of s)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const c=s.node;this.uploaded?this.updatePbrBuffer(c):nx(c,e,!0)}for(const s of i)bv(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const c=e.transform.projectionOptions,l=e.style.getBrightness(),d=this.brightness!==l;if(!this.uploaded||this.dirty||c.name!==this.projection.name||Eg(s.paint.get("model-color").value,d)||Eg(s.paint.get("model-color-mix-intensity").value,d)||Eg(s.paint.get("model-roughness").value,d)||Eg(s.paint.get("model-emissive-strength").value,d)||Eg(s.paint.get("model-height-based-emissive-strength-multiplier").value,d)){this.projection=c,this.brightness=l;const y=this.getNodesInfo();for(const w of y)w.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),c=this.id.canonical;for(const l of s){const d=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},c)}}evaluate(e,i){const s=this.getNodesInfo();for(const c of s){if(!c.node.meshes)continue;const l=c.feature,d=i&&i[l.id];if(Ss(d,c.state))continue;c.state=structuredClone(d);const y=c.node.meshes&&c.node.meshes[0].featureData,w=c.evaluatedColor[2],A=c.evaluatedRMEA[2],_=this.id.canonical;if(c.hasTranslucentParts=!1,y){for(let T=0;T<aw.length;T++){const C=aw[T];C.length&&(l.properties.part=C);const E=e.paint.get("model-color").evaluate(l,d,_).toRenderColor(null),M=e.paint.get("model-color-mix-intensity").evaluate(l,d,_);c.evaluatedColor[T]=[E.r,E.g,E.b,M],c.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(l,d,_),c.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(l,d,_),c.evaluatedRMEA[T][3]=E.a,c.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,d,_),!c.hasTranslucentParts&&E.a<1&&(c.hasTranslucentParts=!0)}delete l.properties.part,fA(c,w!==c.evaluatedColor[2]||A!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,d,_);c.evaluatedScale=e.paint.get("model-scale").evaluate(l,d,_),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,c){const l=e.findDEMTileFor(s);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const d=m_.create(e,s,l);if(!d)return;this.modelTraits&p_.HasMapboxMeshFeatures&&this.updateDEM(e,d,s,c);for(const y of this.getNodesInfo()){const w=y.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const A=w.footprint.vertices;let _=d.getElevationAt(A[0].x,A[0].y,!0,!0);for(let T=1;T<A.length;T++)_=Math.min(_,d.getElevationAt(A[T].x,A[T].y,!0,!0));w.elevation=_}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,c){let l=i._dem._modifiedForSources[c];if(l===void 0&&(i._dem._modifiedForSources[c]=[],l=i._dem._modifiedForSources[c]),l.includes(s.canonical))return;const d=i._dem.dim;l.push(s.canonical);let y=!1;for(const w of this.getNodesInfo()){const A=w.node;if(!A.footprint||!A.footprint.grid)continue;const _=A.footprint.grid,T=i.tileCoordToPixel(_.min.x,_.min.y),C=i.tileCoordToPixel(_.max.x,_.max.y),E=Math.min(Math.min(d-C.y,T.x),Math.min(T.y,d-C.x));if(E<0)continue;const M=vt(E,2,5);let z=Math.max(0,T.x-M),N=Math.max(0,T.y-M),V=Math.min(C.x+M,d-1),Z=Math.min(C.y+M,d-1);for(let K=N;K<=Z;++K)for(let ee=z;ee<=V;++ee)jp[K*d+ee]=255;let H=0,q=0;for(let K=0;K<_.cellsY;++K)for(let ee=0;ee<_.cellsX;++ee){if(!_.cells[K*_.cellsX+ee])continue;const he=i.tileCoordToPixel(_.min.x+ee/_.xScale,_.min.y+K/_.yScale),le=i.tileCoordToPixel(_.min.x+(ee+1)/_.xScale,_.min.y+(K+1)/_.yScale);for(let ue=he.y;ue<=Math.min(le.y+1,d-1);++ue)for(let Te=he.x;Te<=Math.min(le.x+1,d-1);++Te)jp[ue*d+Te]===255&&(jp[ue*d+Te]=0,H+=i.getElevationAtPixel(Te,ue),q++)}const Y=H/q;z=Math.max(1,T.x-M),N=Math.max(1,T.y-M),V=Math.min(C.x+M,d-2),Z=Math.min(C.y+M,d-2),y=!0;for(let K=N;K<=Z;++K)for(let ee=z;ee<=V;++ee)jp[K*d+ee]===0&&(ax[K*d+ee]=i._dem.set(ee,K,Y));for(let K=1;K<M;++K){z=Math.max(1,T.x-K),N=Math.max(1,T.y-K),V=Math.min(C.x+K,d-2),Z=Math.min(C.y+K,d-2);for(let ee=N;ee<=Z;++ee)for(let he=z;he<=V;++he){const le=ee*d+he;if(jp[le]===255){let ue=0,Te=0,pe=-1,Ee=-1;for(let De=-1;De<=1;++De)for(let Re=-1;Re<=1;++Re){const ke=(ee+De)*d+he+Re;if(jp[ke]>=K)continue;const Pe=ax[ke],Ze=Math.abs(Pe);Ze>Te&&(ue=Pe,Te=Ze,pe=Re,Ee=De)}if(Te>.1){const De=1-(K+.5*Math.abs(pe*Ee))/M;let Re=i._dem.get(he,ee)+ue*De;const ke=i._dem.get(he+pe,ee+Ee),Pe=i._dem.get(he-pe,ee-Ee,!0);(Re-ke)*(Re-Pe)>0&&(Re=(ke+Pe)/2),ax[le]=i._dem.set(he,ee,Re),jp[le]=K}}}}}y&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=rt.now())}setFilter(e){this.filter=e?Vc(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Ln(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)bv(i.node),rx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const d=c[l].node;c[l].hiddenByReplacement=!!d.footprint&&!s.find(y=>y.footprint===d.footprint)}}getHeightAtTileCoord(e,i){const s=this.getNodesInfo(),c=[],l=[0,0,0],d=de.mat4.identity([]);for(let y=0;y<this.nodesInfo.length;y++){const w=s[y],A=w.node.meshes[0],_=A.transformedAabb;if(e<_.min[0]||i<_.min[1]||e>_.max[0]||i>_.max[1])continue;if(w.node.hidden===!0)return{height:1/0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};de.mat4.invert(d,w.node.matrix),l[0]=e,l[1]=i,de.vec3.transformMat4(l,l,d);const T=(l[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*Up|0,C=Math.min(63,(l[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*Up|0)*Up+Math.min(63,T),E=A.heightmap[C];if(!(E<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:E,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new Ft(e,i),new Ft(e,i),c),c.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function Eg(a,e){return!a.isLightConstant&&e}function dA(a,e,i,s,c,l,d,y){let w=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;i[3]>0&&(w=yi(w,255*i[0],i[3]),A=yi(A,255*i[1],i[3]),_=yi(_,255*i[2],i[3]));const T=w<<8|A,C=_<<8|Math.floor(255*s[3]),E=function(K){const ee=vt(K,0,2);return Math.min(Math.round(.5*ee*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],M=vt(c[0],0,1),z=vt(c[1],0,1),N=vt(c[2],0,1),V=vt(c[3],0,1);let Z,H,q,Y;if(M!==z&&d!==l&&z!==M){const K=d-l;H=1/(K*(z-M)),q=-(l+K*M)/(K*(z-M));const ee=vt(c[4],-1,1);Y=Math.pow(10,ee),Z=255*N<<8|255*V}else Z=65535,H=0,q=1,Y=1;if(a.emplaceBack(T,C,E,Z,H,q,Y),y){const K=y.length;y.clear();for(let ee=0;ee<K;ee++)y.emplaceBack(T,C,E,Z,H,q,Y)}}function fA(a,e,i){const s=a.node;let c=0;const l=i&p_.HasMeshoptCompression;for(const d of s.meshes){if(s.lights&&s.lightMeshIndex===c||!d.featureData)continue;d.featureArray=new Yl,d.featureArray.reserve(d.featureData.length);let y=e;for(const w of d.featureData){const A=l?65535&w:w>>16&65535,_=l?w>>16&65535:65535&w,T=(15&_)<8?15&_:0,C=a.evaluatedRMEA[T],E=a.evaluatedColor[T],M=a.emissionHeightBasedParams[T];let z;if(y&&T===2&&s.lights&&(z=new Yl,z.resize(10*s.lights.length)),dA(d.featureArray,A,E,C,M,d.aabb.min[2],d.aabb.max[2],z),z&&y){y=!1;const N=s.meshes[s.lightMeshIndex];N.featureArray=z,N.featureArray._trim()}}d.featureArray._trim(),c++}}function ow(a,e,i,s){const c=1<<a.z;e.lat=Vn((s/Bt+a.y)/c),e.lng=Ea((i/Bt+a.x)/c)}Wt(wv,"Tiled3dModelBucket",{omit:["layers"]}),Wt(sw,"Tiled3dModelFeature");const pA={circle:class extends Jr{constructor(a,e,i,s){super(a,{layout:Ve||(Ve=new lr({"circle-sort-key":new Kt($e.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Pt($e.layout_circle["circle-elevation-reference"]),visibility:new Pt($e.layout_circle.visibility)})),paint:ut||(ut=new lr({"circle-radius":new Kt($e.paint_circle["circle-radius"]),"circle-color":new Kt($e.paint_circle["circle-color"]),"circle-blur":new Kt($e.paint_circle["circle-blur"]),"circle-opacity":new Kt($e.paint_circle["circle-opacity"]),"circle-translate":new Pt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Pt($e.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(a){return new $(a)}queryRadius(a){const e=a;return Ge("circle-radius",this,e)+Ge("circle-stroke-width",this,e)+ct(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,i,s,c,l,d,y){const w=Ct(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,a.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ha(a,s,l,d,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,i){const s=nc(this);return{config:new Ql(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}},heatmap:class extends Jr{createBucket(a){return new Ty(a)}constructor(a,e,i,s){super(a,{layout:Kc||(Kc=new lr({visibility:new Pt($e.layout_heatmap.visibility)})),paint:bp||(bp=new lr({"heatmap-radius":new Kt($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gl($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt($e.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Ge("heatmap-radius",this,a)}queryIntersectsFeature(a,e,i,s,c,l,d,y){const w=this.paint.get("heatmap-radius").evaluate(e,i);return Ha(a,s,l,d,y,!0,!0,new Ft(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,i){return a==="heatmap"?{config:new Ql(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Jr{constructor(a,e,i,s){super(a,{layout:Rm||(Rm=new lr({visibility:new Pt($e.layout_hillshade.visibility)})),paint:ad||(ad=new lr({"hillshade-illumination-direction":new Pt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Pt($e.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,i){return{overrideFog:!1}}},fill:class extends Jr{constructor(a,e,i,s){super(a,{layout:br||(br=new lr({"fill-sort-key":new Kt($e.layout_fill["fill-sort-key"]),visibility:new Pt($e.layout_fill.visibility),"fill-elevation-reference":new Pt($e.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Kt($e.layout_fill["fill-construct-bridge-guard-rail"])})),paint:$m||($m=new lr({"fill-antialias":new Pt($e.paint_fill["fill-antialias"]),"fill-opacity":new Kt($e.paint_fill["fill-opacity"]),"fill-color":new Kt($e.paint_fill["fill-color"]),"fill-outline-color":new Kt($e.paint_fill["fill-outline-color"]),"fill-translate":new Pt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kt($e.paint_fill["fill-pattern"]),"fill-emissive-strength":new Pt($e.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Kt($e.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Kt($e.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Kt($e.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(a,e,i){return{config:new Ql(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Tf(a)}queryRadius(){return ct(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,i,s,c,l){return!a.queryGeometry.isAboveHorizon&&te(_t(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,a.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?e&&!a:e}},"fill-extrusion":class extends Jr{constructor(a,e,i,s){super(a,{layout:Zy||(Zy=new lr({visibility:new Pt($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Pt($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:$y||($y=new lr({"fill-extrusion-opacity":new Pt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kt($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Pt($e["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Pt($e["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Pt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Pt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Pt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Pt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Pt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Pt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Pt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Pt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Kt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Kt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Pt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Pt($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Pt($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Pt($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Kt($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Kt($e["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Pt($e["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Rp(a)}queryRadius(){return ct(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,i,s,c,l,d,y,w){const A=Ct(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,a.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,i),T=this.paint.get("fill-extrusion-base").evaluate(e,i),C=[0,0],E=y&&l.elevation,M=l.elevation?l.elevation.exaggeration():1,z=a.tile.getBucket(this);if(E&&z instanceof Rp){const q=z.centroidVertexArray,Y=w+1;Y<q.length&&(C[0]=q.geta_centroid_pos0(Y),C[1]=q.geta_centroid_pos1(Y))}if(C[0]===0&&C[1]===1)return!1;l.projection.name==="globe"&&(s=zf([s],[new Ft(0,0),new Ft(Bt,Bt)],a.tileID.canonical).map(q=>q.polygon).flat());const N=E?y:null,[V,Z]=function(q,Y,K,ee,he,le,ue,Te,pe,Ee,De){return q.projection.name==="globe"?function(Re,ke,Pe,Ze,Ue,Xe,bt,xt,ei,zt,Nt){const St=[],wi=[],Xt=Re.projection.upVectorScale(Nt,Re.center.lat,Re.worldSize).metersToTile,ci=[0,0,0,1],Li=[0,0,0,1],Wi=(an,Yi,un,Cn)=>{an[0]=Yi,an[1]=un,an[2]=Cn,an[3]=1},ki=dg();Pe>0&&(Pe+=ki),Ze+=ki;for(const an of ke){const Yi=[],un=[];for(const Cn of an){const er=Cn.x+Ue.x,Oi=Cn.y+Ue.y,_n=Re.projection.projectTilePoint(er,Oi,Nt),ur=Re.projection.upVector(Nt,Cn.x,Cn.y);let _r=Pe,wr=Ze;if(bt){const Er=e_(er,Oi,Pe,Ze,bt,xt,ei,zt);_r+=Er.base,wr+=Er.top}Pe!==0?Wi(ci,_n.x+ur[0]*Xt*_r,_n.y+ur[1]*Xt*_r,_n.z+ur[2]*Xt*_r):Wi(ci,_n.x,_n.y,_n.z),Wi(Li,_n.x+ur[0]*Xt*wr,_n.y+ur[1]*Xt*wr,_n.z+ur[2]*Xt*wr),de.vec3.transformMat4(ci,ci,Xe),de.vec3.transformMat4(Li,Li,Xe),Yi.push(new eh(ci[0],ci[1],ci[2])),un.push(new eh(Li[0],Li[1],Li[2]))}St.push(Yi),wi.push(un)}return[St,wi]}(q,Y,K,ee,he,le,ue,Te,pe,Ee,De):ue?function(Re,ke,Pe,Ze,Ue,Xe,bt,xt,ei){const zt=[],Nt=[],St=[0,0,0,1];for(const wi of Re){const Xt=[],ci=[];for(const Li of wi){const Wi=Li.x+Ze.x,ki=Li.y+Ze.y,an=e_(Wi,ki,ke,Pe,Xe,bt,xt,ei);St[0]=Wi,St[1]=ki,St[2]=an.base,St[3]=1,de.vec4.transformMat4(St,St,Ue),St[3]=Math.max(St[3],1e-5);const Yi=new eh(St[0]/St[3],St[1]/St[3],St[2]/St[3]);St[0]=Wi,St[1]=ki,St[2]=an.top,St[3]=1,de.vec4.transformMat4(St,St,Ue),St[3]=Math.max(St[3],1e-5);const un=new eh(St[0]/St[3],St[1]/St[3],St[2]/St[3]);Xt.push(Yi),ci.push(un)}zt.push(Xt),Nt.push(ci)}return[zt,Nt]}(Y,K,ee,he,le,ue,Te,pe,Ee):function(Re,ke,Pe,Ze,Ue){const Xe=[],bt=[],xt=Ue[8]*ke,ei=Ue[9]*ke,zt=Ue[10]*ke,Nt=Ue[11]*ke,St=Ue[8]*Pe,wi=Ue[9]*Pe,Xt=Ue[10]*Pe,ci=Ue[11]*Pe;for(const Li of Re){const Wi=[],ki=[];for(const an of Li){const Yi=an.x+Ze.x,un=an.y+Ze.y,Cn=Ue[0]*Yi+Ue[4]*un+Ue[12],er=Ue[1]*Yi+Ue[5]*un+Ue[13],Oi=Ue[2]*Yi+Ue[6]*un+Ue[14],_n=Ue[3]*Yi+Ue[7]*un+Ue[15],ur=Cn+xt,_r=er+ei,wr=Oi+zt,Er=Math.max(_n+Nt,1e-5),Yn=Cn+St,_a=er+wi,Os=Oi+Xt,Yr=Math.max(_n+ci,1e-5);Wi.push(new eh(ur/Er,_r/Er,wr/Er)),ki.push(new eh(Yn/Yr,_a/Yr,Os/Yr))}Xe.push(Wi),bt.push(ki)}return[Xe,bt]}(Y,K,ee,he,le)}(l,s,T,_,A,d,N,C,M,l.center.lat,a.tileID.canonical),H=a.queryGeometry;return function(q,Y,K){let ee=1/0;te(K,Y)&&(ee=zp(K,Y[0]));for(let he=0;he<Y.length;he++){const le=Y[he],ue=q[he];for(let Te=0;Te<le.length-1;Te++){const pe=le[Te],Ee=[pe,le[Te+1],ue[Te+1],ue[Te],pe];Q(K,Ee)&&(ee=Math.min(ee,zp(K,Ee)))}}return ee!==1/0&&ee}(V,Z,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends Jr{constructor(a,e,i,s){const c=Lf();super(a,c,e,i,s),c.layout&&(this.layout=new Fc(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ja,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(kp)return kp;const i=Lf();return kp=new nh(i.paint.properties["line-width"].specification),kp.useIntegerZoom=!0,kp})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new fg(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,i){const s=iu(this);return{config:new Ql(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(a){const e=a,i=mg(Ge("line-width",this,e),Ge("line-gap-width",this,e)),s=Ge("line-offset",this,e);return i/2+Math.abs(s)+ct(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,i,s,c,l){if(a.queryGeometry.isAboveHorizon)return!1;const d=_t(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,a.pixelToTileUnitsFactor),y=a.pixelToTileUnitsFactor/2*mg(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(s=function(A,_){const T=[],C=new Ft(0,0);for(let E=0;E<A.length;E++){const M=A[E],z=[];for(let N=0;N<M.length;N++){const V=M[N],Z=M[N+1],H=N===0?C:V.sub(M[N-1])._unit()._perp(),q=N===M.length-1?C:Z.sub(V)._unit()._perp(),Y=H._add(q)._unit();Y._mult(1/(Y.x*q.x+Y.y*q.y)),z.push(Y._mult(_)._add(V))}T.push(z)}return T}(s,w*a.pixelToTileUnitsFactor)),function(A,_,T){for(let C=0;C<_.length;C++){const E=_[C];if(A.length>=3){for(let M=0;M<E.length;M++)if(ve(A,E[M]))return!0}if(ne(A,E,T))return!0}return!1}(d,s,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets}},symbol:pv,background:class extends Jr{constructor(a,e,i,s){super(a,{layout:zb||(zb=new lr({visibility:new Pt($e.layout_background.visibility)})),paint:Lb||(Lb=new lr({"background-pitch-alignment":new Pt($e.paint_background["background-pitch-alignment"]),"background-color":new Pt($e.paint_background["background-color"]),"background-pattern":new Pt($e.paint_background["background-pattern"]),"background-opacity":new Pt($e.paint_background["background-opacity"]),"background-emissive-strength":new Pt($e.paint_background["background-emissive-strength"]),"background-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,i){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Nb,"raster-particle":Gb,sky:class extends Jr{constructor(a,e,i,s){super(a,{layout:Ub||(Ub=new lr({visibility:new Pt($e.layout_sky.visibility)})),paint:jb||(jb=new lr({"sky-type":new Pt($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new Pt($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Pt($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Pt($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Pt($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new Gl($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Pt($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Pt($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Pt($e.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),c=!s,l=a.style.light,d=l.properties.get("position");return c&&l.properties.get("anchor")==="viewport"&&Kn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?Q0(d.azimuthal,90-d.polar,e):Q0(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return Q0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Jr{constructor(a,e,i,s){super(a,{paint:qb||(qb=new lr({}))},e,null)}},model:class extends Jr{constructor(a,e,i,s){super(a,{layout:ew||(ew=new lr({visibility:new Pt($e.layout_model.visibility),"model-id":new Kt($e.layout_model["model-id"])})),paint:tw||(tw=new lr({"model-opacity":new Kt($e.paint_model["model-opacity"]),"model-rotation":new Kt($e.paint_model["model-rotation"]),"model-scale":new Kt($e.paint_model["model-scale"]),"model-translation":new Kt($e.paint_model["model-translation"]),"model-color":new Kt($e.paint_model["model-color"]),"model-color-mix-intensity":new Kt($e.paint_model["model-color-mix-intensity"]),"model-type":new Pt($e.paint_model["model-type"]),"model-cast-shadows":new Pt($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new Pt($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Pt($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Kt($e.paint_model["model-emissive-strength"]),"model-roughness":new Kt($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Kt($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Pt($e.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Pt($e.paint_model["model-front-cutoff"]),"model-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new ix(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof wv?Bt-1:0}queryIntersectsFeature(a,e,i,s,c,l){if(!this.modelManager)return!1;const d=this.modelManager,y=a.tile.getBucket(this);if(!(y&&y instanceof ix))return!1;for(const w in y.instancesPerModel){const A=y.instancesPerModel[w],_=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(_)){const T=A.features[A.idToFeaturesIndex[_]],C=d.getModel(w,this.scope);if(!C)return!1;let E=de.mat4.create();const M=new Tn(0,0),z=y.canonical;let N=Number.MAX_VALUE;for(let V=0;V<T.instancedDataCount;++V){const Z=16*(T.instancedDataOffset+V),H=A.instancedDataArray.float32,q=[H[Z+4],H[Z+5],H[Z+6]];ow(z,M,H[Z],0|H[Z+1]),iw(E,C,l,M,T.rotation,T.scale,q,!1,!1,!1),l.projection.name==="globe"&&(E=tx(E,l));const Y=de.mat4.multiply([],l.projMatrix,E),K=a.queryGeometry,ee=Yb(K.isPointQuery()?K.screenBounds:K.screenGeometry,l,Y,C.aabb);ee!=null&&(N=Math.min(ee,N))}return N!==Number.MAX_VALUE&&N}}return!1}_handleOverridablePaintPropertyUpdate(a,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof kl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Jr{constructor(a,e,i,s){super(a,{layout:Za||(Za=new lr({"clip-layer-types":new Pt($e.layout_clip["clip-layer-types"]),"clip-layer-scope":new Pt($e.layout_clip["clip-layer-scope"])})),paint:ky||(ky=new lr({}))},e,i,s)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new Ap(a)}is3D(a){return!0}}};class mA{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class _A{constructor(){this.tasks={},this.taskQueue=[],hc(["process"],this),this.invoker=new mA(this.process),this.nextId=0}add(e,i){const s=this.nextId++,c=function({type:l,isSymbolTile:d,zoom:y}){return y=y||0,l==="message"?0:l!=="maybePrepare"||d?l!=="parseTile"||d?l==="parseTile"&&d?300-y:l==="maybePrepare"&&d?400-y:500:200-y:100-y}(i);if(c===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const l=this.tasks[this.taskQueue[c]];l.priority<i&&(i=l.priority,e=c)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class lw{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},hc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new _A}send(e,i,s,c,l=!1,d){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=d,this.callbacks[y]=s);const w=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!s,targetMapId:c,mustQueue:l,sourceMapId:this.mapId,data:rl(i,w)},w),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(i.mustQueue||Ma()){const c=this.callbacks[s],l=this.scheduler.add(()=>this.processTask(s,i),c&&c.metadata||{type:"message"});l&&(this.cancelCallbacks[s]=l)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(la(i.error)):s(null,la(i.data)))}else{const s=new Set,c=i.hasCallback?(d,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?rl(d):null,data:rl(y,s)},s)}:()=>{},l=la(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,c);else if(this.parent.getWorkerSource){const d=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,d[0],l.source,l.scope)[d[1]](l,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Ag={workerUrl:"",workerClass:null,workerParams:void 0};const sx="mapboxgl_preloaded_worker_pool";class qp{constructor(){this.active={}}acquire(e,i=qp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Ag.workerClass!=null?new Ag.workerClass:new self.Worker(Ag.workerUrl,Ag.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[sx]}numActive(){return Object.keys(this.active).length}}qp.workerCount=2;class __{constructor(e,i,s="Worker",c=qp.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=or();const l=this.workerPool.acquire(this.id,c);for(let d=0;d<l.length;d++){const y=new __.Actor(l[d],i,this.id);y.name=`${s} ${d}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){ri(this.actors,(c,l)=>{c.send(e,i,l)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Mg,ox;function Tv(){return Mg||(Mg=new qp),Mg}__.Actor=lw;const lx=new Mn(0,0,0);var cx=(a=>(a[a.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",a[a.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",a[a.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",a))(cx||{}),Sv=(a=>(a[a.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",a[a.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",a[a.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",a[a.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",a))(Sv||{}),Cg=(a=>(a[a.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",a[a.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",a[a.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",a[a.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",a[a.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",a))(Cg||{}),cw=(a=>(a[a.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",a[a.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",a[a.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",a))(cw||{}),g_=(a=>(a[a.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",a[a.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",a[a.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",a[a.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",a[a.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",a[a.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",a))(g_||{}),uw=(a=>(a[a.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",a[a.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",a[a.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",a))(uw||{});function gA(a,e,i){a===1&&e.icons.push(function(s,c){return function(l){if(l.usvg_tree.height||(l.usvg_tree.height=l.usvg_tree.width),!l.metadata)return l;const{metadata:d}=l;if(d.content_area){const{content_area:y}=d;y.top==null&&(y.top=y.left),y.width==null&&(y.width=l.usvg_tree.width),y.height==null&&(y.height=y.width)}return d.stretch_x&&d.stretch_x.length&&hw(d,"x"),d.stretch_y&&d.stretch_y.length&&hw(d,"y"),l}(s.readFields(yA,{name:void 0},c))}(i,i.readVarint()+i.pos))}function hw(a,e){const i=[],s=a[`stretch_${e}`];let c=null;for(let l=0;l<s.length;l++)c===null?c=i.length===0?s[0]:i[i.length-1][1]+s[l]:(i.push([c,c+s[l]]),c=null);a[`stretch_${e}_areas`]=i}function yA(a,e,i){a===1?e.name=i.readString():a===2?e.metadata=function(s,c){return s.readFields(vA,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(i,i.readVarint()+i.pos):a===3&&(e.usvg_tree=function(s,c){return s.readFields(wA,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function vA(a,e,i){a===1?e.stretch_x=i.readPackedVarint():a===2?e.stretch_y=i.readPackedVarint():a===3?e.content_area=function(s,c){return s.readFields(xA,{left:0},c)}(i,i.readVarint()+i.pos):a===4&&e.variables.push(function(s,c){return s.readFields(bA,{name:void 0},c)}(i,i.readVarint()+i.pos))}function xA(a,e,i){a===1?e.left=i.readVarint():a===2?e.width=i.readVarint():a===3?e.top=i.readVarint():a===4&&(e.height=i.readVarint())}function bA(a,e,i){a===1?e.name=i.readString():a===2&&(e.rgb_color=Mv(i.readVarint()),e.value="rgb_color")}function wA(a,e,i){a===1?e.width=e.height=i.readVarint():a===2?e.height=i.readVarint():a===3?e.children.push(Ev(i,i.readVarint()+i.pos)):a===4?e.linear_gradients.push(function(s,c){return s.readFields(IA,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(i,i.readVarint()+i.pos)):a===5?e.radial_gradients.push(function(s,c){return s.readFields(DA,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(i,i.readVarint()+i.pos)):a===7?e.clip_paths.push(function(s,c){return s.readFields(zA,{children:[]},c)}(i,i.readVarint()+i.pos)):a===8&&e.masks.push(function(s,c){const l=s.readFields(LA,{left:0,width:20,mask_type:1,children:[]},c);return l.height==null&&(l.height=l.width),l.top==null&&(l.top=l.left),l}(i,i.readVarint()+i.pos))}function Ev(a,e){return a.readFields(TA,{},e)}function TA(a,e,i){a===1?(e.group=function(s,c){return s.readFields(SA,{opacity:255,children:[]},c)}(i,i.readVarint()+i.pos),e.node="group"):a===2&&(e.path=function(s,c){return s.readFields(AA,{paint_order:1,commands:[],step:1,diffs:[],rule:1},c)}(i,i.readVarint()+i.pos),e.node="path")}function SA(a,e,i){a===1?e.transform=Av(i,i.readVarint()+i.pos):a===2?e.opacity=i.readVarint():a===5?e.clip_path_idx=i.readVarint():a===6?e.mask_idx=i.readVarint():a===7&&e.children.push(Ev(i,i.readVarint()+i.pos))}function Av(a,e){return a.readFields(EA,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function EA(a,e,i){a===1?e.sx=i.readFloat():a===2?e.ky=i.readFloat():a===3?e.kx=i.readFloat():a===4?e.sy=i.readFloat():a===5?e.tx=i.readFloat():a===6&&(e.ty=i.readFloat())}function AA(a,e,i){a===1?e.fill=function(s,c){return s.readFields(MA,{rgb_color:lx,paint:"rgb_color",opacity:255},c)}(i,i.readVarint()+i.pos):a===2?e.stroke=function(s,c){return s.readFields(CA,{rgb_color:lx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(i,i.readVarint()+i.pos):a===3?e.paint_order=i.readVarint():a===5?i.readPackedVarint(e.commands):a===6?e.step=i.readFloat():a===7?i.readPackedSVarint(e.diffs):a===8&&(e.rule=i.readVarint())}function MA(a,e,i){a===1?(e.rgb_color=Mv(i.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=i.readVarint())}function Mv(a){return new Mn((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function CA(a,e,i){a===1?(e.rgb_color=Mv(i.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):a===5?i.readPackedFloat(e.dasharray):a===6?e.dashoffset=i.readFloat():a===7?e.miterlimit=i.readFloat():a===8?e.opacity=i.readVarint():a===9?e.width=i.readFloat():a===10?e.linecap=i.readVarint():a===11&&(e.linejoin=i.readVarint())}function IA(a,e,i){a===1?e.transform=Av(i,i.readVarint()+i.pos):a===2?e.spread_method=i.readVarint():a===3?e.stops.push(dw(i,i.readVarint()+i.pos)):a===4?e.x1=i.readFloat():a===5?e.y1=i.readFloat():a===6?e.x2=i.readFloat():a===7&&(e.y2=i.readFloat())}function dw(a,e){return a.readFields(RA,{offset:0,opacity:255,rgb_color:lx},e)}function RA(a,e,i){a===1?e.offset=i.readFloat():a===2?e.opacity=i.readVarint():a===3&&(e.rgb_color=Mv(i.readVarint()))}function DA(a,e,i){a===1?e.transform=Av(i,i.readVarint()+i.pos):a===2?e.spread_method=i.readVarint():a===3?e.stops.push(dw(i,i.readVarint()+i.pos)):a===4?e.cx=i.readFloat():a===5?e.cy=i.readFloat():a===6?e.r=i.readFloat():a===7?e.fx=i.readFloat():a===8?e.fy=i.readFloat():a===9&&(e.fr=i.readFloat())}function zA(a,e,i){a===1?e.transform=Av(i,i.readVarint()+i.pos):a===2?e.clip_path_idx=i.readVarint():a===3&&e.children.push(Ev(i,i.readVarint()+i.pos))}function LA(a,e,i){a===1?e.left=e.top=i.readFloat():a===2?e.width=e.height=i.readFloat():a===3?e.top=i.readFloat():a===4?e.height=i.readFloat():a===5?e.mask_type=i.readVarint():a===6?e.mask_idx=i.readVarint():a===7&&e.children.push(Ev(i,i.readVarint()+i.pos))}class OA{static calculate(e={},i=[]){const s=new Map,c=new Map;if(Object.keys(e).length===0)return s;i.forEach(l=>{c.set(l.name,l.rgb_color||new Mn(0,0,0))});for(const[l,d]of Object.entries(e))c.has(l)?s.set(c.get(l).toStringPremultipliedAlpha(),d):console.warn(`Ignoring unknown image variable "${l}"`);return s}}function y_(a,e=255,i){const s=e/255,c=a.toStringPremultipliedAlpha(),l=i.has(c)?i.get(c).clone():a.clone();return l.a*=s,l.toString()}function Ig(a,e){if(!lt()){const i=document.createElement("canvas");return i.width=a,i.height=e,i}return new OffscreenCanvas(a,e)}function PA(a,e){const i=OA.calculate(e.params,a.metadata?a.metadata.variables:[]),s=a.usvg_tree,c=s.width,l=s.height,d=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(c*d.a)),w=Math.max(1,Math.round(l*d.d)),A=new DOMMatrix([y/c,0,0,w/l,0,0]),_=Ig(y,w).getContext("2d");return ux(_,A,s,s,i),_.getImageData(0,0,y,w)}function ux(a,e,i,s,c){for(const l of s.children)fw(a,e,i,l,c)}function fw(a,e,i,s,c){s.group?(a.save(),function(l,d,y,w,A){const _=w.mask_idx!=null?y.masks[w.mask_idx]:null,T=w.clip_path_idx!=null?y.clip_paths[w.clip_path_idx]:null;if(w.transform&&(d=Cv(w.transform).preMultiplySelf(d)),!function(M,z,N){return M.opacity!==255||z||N}(w,T!=null,_!=null))return void ux(l,d,y,w,A);const C=Ig(l.canvas.width,l.canvas.height),E=C.getContext("2d");ux(E,d,y,w,A),T&&xw(E,d,y,T),_&&bw(E,d,y,_,A),l.globalAlpha=w.opacity/255,l.drawImage(C,0,0)}(a,e,i,s.group,c),a.restore()):s.path&&(a.save(),function(l,d,y,w,A){const _=ww(w);l.setTransform(d),w.paint_order===cw.PAINT_ORDER_FILL_AND_STROKE?(pw(l,y,w,_,A),_w(l,y,w,_,A)):(_w(l,y,w,_,A),pw(l,y,w,_,A))}(a,e,i,s.path,c),a.restore())}function pw(a,e,i,s,c){const l=i.fill;if(!l)return;const d=l.opacity/255;switch(l.paint){case"rgb_color":a.fillStyle=y_(l.rgb_color,l.opacity,c);break;case"linear_gradient_idx":a.fillStyle=gw(a,e.linear_gradients[l.linear_gradient_idx],d,c);break;case"radial_gradient_idx":a.fillStyle=yw(a,e.radial_gradients[l.radial_gradient_idx],d,c)}a.fill(s,mw(i))}function mw(a){return a.rule===cx.PATH_RULE_NON_ZERO?"nonzero":a.rule===cx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function _w(a,e,i,s,c){const l=i.stroke;if(!l)return;a.lineWidth=l.width,a.miterLimit=l.miterlimit,a.setLineDash(l.dasharray),a.lineDashOffset=l.dashoffset;const d=l.opacity/255;switch(l.paint){case"rgb_color":a.strokeStyle=y_(l.rgb_color,l.opacity,c);break;case"linear_gradient_idx":a.strokeStyle=gw(a,e.linear_gradients[l.linear_gradient_idx],d,c);break;case"radial_gradient_idx":a.strokeStyle=yw(a,e.radial_gradients[l.radial_gradient_idx],d,c)}switch(l.linejoin){case Cg.LINE_JOIN_MITER_CLIP:case Cg.LINE_JOIN_MITER:a.lineJoin="miter";break;case Cg.LINE_JOIN_ROUND:a.lineJoin="round";break;case Cg.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(l.linecap){case Sv.LINE_CAP_BUTT:a.lineCap="butt";break;case Sv.LINE_CAP_ROUND:a.lineCap="round";break;case Sv.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(s)}function gw(a,e,i,s){if(e.stops.length===1){const C=e.stops[0];return y_(C.rgb_color,C.opacity*i,s)}const c=Cv(e.transform),{x1:l,y1:d,x2:y,y2:w}=e,A=c.transformPoint(new DOMPoint(l,d)),_=c.transformPoint(new DOMPoint(y,w)),T=a.createLinearGradient(A.x,A.y,_.x,_.y);for(const C of e.stops)T.addColorStop(C.offset,y_(C.rgb_color,C.opacity*i,s));return T}function yw(a,e,i,s){if(e.stops.length===1){const C=e.stops[0];return y_(C.rgb_color,C.opacity*i,s)}const c=Cv(e.transform),{fx:l,fy:d,cx:y,cy:w}=e,A=c.transformPoint(new DOMPoint(l,d)),_=c.transformPoint(new DOMPoint(y,w)),T=a.createRadialGradient(A.x,A.y,0,_.x,_.y,e.r*((c.a+c.d)/2));for(const C of e.stops)T.addColorStop(C.offset,y_(C.rgb_color,C.opacity*i,s));return T}function vw(a,e,i,s){const c=s.transform?Cv(s.transform).preMultiplySelf(e):e,l=Ig(a.canvas.width,a.canvas.height),d=l.getContext("2d");for(const w of s.children)if(w.group)vw(d,c,i,w.group);else if(w.path){const A=w.path,_=new Path2D;_.addPath(ww(A),c),d.fill(_,mw(A))}const y=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;y&&xw(d,c,i,y),a.globalCompositeOperation="source-over",a.drawImage(l,0,0)}function xw(a,e,i,s){const c=Ig(a.canvas.width,a.canvas.height);vw(c.getContext("2d"),e,i,s),a.globalCompositeOperation="destination-in",a.drawImage(c,0,0)}function bw(a,e,i,s,c){if(s.children.length===0)return;const l=s.mask_idx!=null?i.masks[s.mask_idx]:null;l&&bw(a,e,i,l,c);const d=a.canvas.width,y=a.canvas.height,w=Ig(d,y),A=w.getContext("2d"),_=s.width,T=s.height,C=s.left,E=s.top,M=new Path2D,z=new Path2D;z.rect(C,E,_,T),M.addPath(z,e),A.clip(M);for(const Z of s.children)fw(A,e,i,Z,c);const N=A.getImageData(0,0,d,y),V=N.data;if(s.mask_type===uw.MASK_TYPE_LUMINANCE)for(let Z=0;Z<V.length;Z+=4)V[Z+3]=V[Z+3]/255*(.2126*V[Z]+.7152*V[Z+1]+.0722*V[Z+2]);A.putImageData(N,0,0),a.globalCompositeOperation="destination-in",a.drawImage(w,0,0)}function Cv(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function ww(a){const e=new Path2D,i=a.step;let s=a.diffs[0]*i,c=a.diffs[1]*i;e.moveTo(s,c);for(let l=0,d=2;l<a.commands.length;l++)switch(a.commands[l]){case g_.PATH_COMMAND_MOVE:s+=a.diffs[d++]*i,c+=a.diffs[d++]*i,e.moveTo(s,c);break;case g_.PATH_COMMAND_LINE:s+=a.diffs[d++]*i,c+=a.diffs[d++]*i,e.lineTo(s,c);break;case g_.PATH_COMMAND_QUAD:{const y=s+a.diffs[d++]*i,w=c+a.diffs[d++]*i;s=y+a.diffs[d++]*i,c=w+a.diffs[d++]*i,e.quadraticCurveTo(y,w,s,c);break}case g_.PATH_COMMAND_CUBIC:{const y=s+a.diffs[d++]*i,w=c+a.diffs[d++]*i,A=y+a.diffs[d++]*i,_=w+a.diffs[d++]*i;s=A+a.diffs[d++]*i,c=_+a.diffs[d++]*i,e.bezierCurveTo(y,w,A,_,s,c);break}case g_.PATH_COMMAND_CLOSE:e.closePath()}return e}class Iv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Wt(Iv,"LRUCache");class hx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ua(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new Iv(150)),this.cacheMap.get(s).get(Zl(e.toString(),i))}setInCache(e,i,s,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new Iv(150));const l=this.cacheDependenciesMap.get(c),d=Zl(e.id.toString(),s);l.get(d)||l.set(d,new Set);const y=this.cacheMap.get(c),w=e.toString();l.get(d).add(w),y.put(Zl(e.toString(),s),i)}removeImagesFromCacheByIds(e,i,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const c=this.cacheMap.get(s),l=this.cacheDependenciesMap.get(s);for(const d of e){const y=Zl(d.toString(),i);if(l.has(y)){for(const w of l.get(y))c.delete(w);l.delete(y)}}}rasterize(e,i,s,c,l=PA){const d=this.getFromCache(e,s,c);if(d)return d.clone();const y=l(i.icon,e.options),w=hx._getImage(y);return this.setInCache(e,w,s,c),w.clone()}}class Tw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Sw(a,e,i,s){let c=0,l=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(s[d])<1e-15){if(i[d]<a[d]||i[d]>e[d])return null}else{const y=1/s[d];let w=(a[d]-i[d])*y,A=(e[d]-i[d])*y;if(w>A){const _=w;w=A,A=_}if(w>c&&(c=w),A<l&&(l=A),c>l)return null}return c}function Ew(a,e,i,s,c,l,d,y,w,A,_){const T=s-a,C=c-e,E=l-i,M=d-a,z=y-e,N=w-i,V=_[1]*N-_[2]*z,Z=_[2]*M-_[0]*N,H=_[0]*z-_[1]*M,q=T*V+C*Z+E*H;if(Math.abs(q)<1e-15)return null;const Y=1/q,K=A[0]-a,ee=A[1]-e,he=A[2]-i,le=(K*V+ee*Z+he*H)*Y;if(le<0||le>1)return null;const ue=ee*E-he*C,Te=he*T-K*E,pe=K*C-ee*T,Ee=(_[0]*ue+_[1]*Te+_[2]*pe)*Y;return Ee<0||le+Ee>1?null:(M*ue+z*Te+N*pe)*Y}function Aw(a,e,i){return(a-e)/(i-e)}function Mw(a,e,i,s,c,l,d,y,w){const A=1<<i,_=l-s,T=d-c,C=(a+1)/A*_+s,E=(e+0)/A*T+c,M=(e+1)/A*T+c;y[0]=(a+0)/A*_+s,y[1]=E,w[0]=C,w[1]=M}class Cw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(l){const d=Math.ceil(Math.log2(l.dim/8)),y=[];let w=Math.ceil(Math.pow(2,d));const A=1/w,_=(E,M,z,N,V)=>{const Z=N?1:0,H=(E+1)*z-Z,q=M*z,Y=(M+1)*z-Z;V[0]=E*z,V[1]=q,V[2]=H,V[3]=Y};let T=new Tw(w);const C=[];for(let E=0;E<w*w;E++){_(E%w,Math.floor(E/w),A,!1,C);const M=Bf(C[0],C[1],l),z=Bf(C[2],C[1],l),N=Bf(C[2],C[3],l),V=Bf(C[0],C[3],l);T.minimums.push(Math.min(M,z,N,V)),T.maximums.push(Math.max(M,z,N,V)),T.leaves.push(1)}for(y.push(T),w/=2;w>=1;w/=2){const E=y[y.length-1];T=new Tw(w);for(let M=0;M<w*w;M++){_(M%w,Math.floor(M/w),2,!0,C);const z=E.getElevation(C[0],C[1]),N=E.getElevation(C[2],C[1]),V=E.getElevation(C[2],C[3]),Z=E.getElevation(C[0],C[3]),H=E.isLeaf(C[0],C[1]),q=E.isLeaf(C[2],C[1]),Y=E.isLeaf(C[2],C[3]),K=E.isLeaf(C[0],C[3]),ee=Math.min(z.min,N.min,V.min,Z.min),he=Math.max(z.max,N.max,V.max,Z.max),le=H&&q&&Y&&K;T.maximums.push(he),T.minimums.push(ee),T.leaves.push(he-ee<=5&&le?1:0)}y.push(T)}return y}(this.dem),s=i.length-1,c=i[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,c,l,d,y=1){return Sw([e,i,-100],[s,c,this.maximums[0]*y],l,d)}raycast(e,i,s,c,l,d,y=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,s,c,l,d,y);if(w==null)return null;const A=[],_=[],T=[],C=[],E=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:M,t:z,nodex:N,nodey:V,depth:Z}=E.pop();if(this.leaves[M]){Mw(N,V,Z,e,i,s,c,T,C);const q=1<<Z,Y=(N+0)/q,K=(N+1)/q,ee=(V+0)/q,he=(V+1)/q,le=Bf(Y,ee,this.dem)*y,ue=Bf(K,ee,this.dem)*y,Te=Bf(K,he,this.dem)*y,pe=Bf(Y,he,this.dem)*y,Ee=Ew(T[0],T[1],le,C[0],T[1],ue,C[0],C[1],Te,l,d),De=Ew(C[0],C[1],Te,T[0],C[1],pe,T[0],T[1],le,l,d),Re=Math.min(Ee!==null?Ee:Number.MAX_VALUE,De!==null?De:Number.MAX_VALUE);if(Re!==Number.MAX_VALUE)return Re;{const ke=de.vec3.scaleAndAdd([],l,d,z);if(Iw(le,ue,pe,Te,Aw(ke[0],T[0],C[0]),Aw(ke[1],T[1],C[1]))>=ke[2])return z}continue}let H=0;for(let q=0;q<this._siblingOffset.length;q++){Mw((N<<1)+this._siblingOffset[q][0],(V<<1)+this._siblingOffset[q][1],Z+1,e,i,s,c,T,C),T[2]=-100,C[2]=this.maximums[this.childOffsets[M]+q]*y;const Y=Sw(T,C,l,d);if(Y!=null){const K=Y;A[q]=K;let ee=!1;for(let he=0;he<H&&!ee;he++)K>=A[_[he]]&&(_.splice(he,0,q),ee=!0);ee||(_[H]=q),H++}}for(let q=0;q<H;q++){const Y=_[q];E.push({idx:this.childOffsets[M]+Y,t:A[Y],nodex:(N<<1)+this._siblingOffset[Y][0],nodey:(V<<1)+this._siblingOffset[Y][1],depth:Z+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,c,l){if(e[c].isLeaf(i,s)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const d=c-1,y=e[d];let w=0,A=0;for(let _=0;_<this._siblingOffset.length;_++){const T=2*i+this._siblingOffset[_][0],C=2*s+this._siblingOffset[_][1],E=y.getElevation(T,C),M=y.isLeaf(T,C),z=this._addNode(E.min,E.max,M);M&&(w|=1<<_),A||(A=z)}for(let _=0;_<this._siblingOffset.length;_++)w&1<<_||this._construct(e,2*i+this._siblingOffset[_][0],2*s+this._siblingOffset[_][1],d,A+_)}}function Iw(a,e,i,s,c,l){return yi(yi(a,i,l),yi(e,s,l),c)}function Bf(a,e,i){const s=i.dim,c=vt(a*s-.5,0,s-1),l=vt(e*s-.5,0,s-1),d=Math.floor(c),y=Math.floor(l),w=Math.min(d+1,s-1),A=Math.min(y+1,s-1);return Iw(i.get(d,y),i.get(w,y),i.get(d,A),i.get(w,A),c-d,l-y)}const kA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function BA(a,e,i){return(256*a*256+256*e+i)/10-1e4}function NA(a,e,i){return 256*a+e+i/256-32768}class Rv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Kn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const l=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let w=0;w<l;w++)d[this._idx(-1,w)]=d[this._idx(0,w)],d[this._idx(l,w)]=d[this._idx(l-1,w)],d[this._idx(w,-1)]=d[this._idx(w,0)],d[this._idx(w,l)]=d[this._idx(w,l-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(l,-1)]=d[this._idx(l-1,0)],d[this._idx(-1,l)]=d[this._idx(0,l-1)],d[this._idx(l,l)]=d[this._idx(l-1,l-1)]}const y=s==="terrarium"?NA:BA;for(let w=0;w<d.length;++w){const A=4*w;this.floatView[w]=y(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=rt.now()}_buildQuadTree(){this._tree=new Cw(this)}get(e,i,s=!1){s&&(e=vt(e,-1,this.dim),i=vt(i,-1,this.dim));const c=this._idx(e,i);return this.floatView[c]}set(e,i,s){const c=this._idx(e,i),l=this.floatView[c];return this.floatView[c]=s,s-l}static getUnpackVector(e){return kA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],c=Rv.getUnpackVector(i);let l=Math.floor((e+c[3])/c[2]);return s[2]=l%256,l=Math.floor(l/256),s[1]=l%256,l=Math.floor(l/256),s[0]=l,s}getPixels(){return new Sy({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,l=i*this.dim+this.dim,d=s*this.dim,y=s*this.dim+this.dim;switch(i){case-1:c=l-1;break;case 1:l=c+1}switch(s){case-1:d=y-1;break;case 1:y=d+1}const w=-i*this.dim,A=-s*this.dim;for(let _=d;_<y;_++)for(let T=c;T<l;T++){const C=4*this._idx(T,_),E=4*this._idx(T+w,_+A);this.pixels[C+0]=e.pixels[E+0],this.pixels[C+1]=e.pixels[E+1],this.pixels[C+2]=e.pixels[E+2],this.pixels[C+3]=e.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function FA(a,e,i){a===1?e.headerLength=i.readFixed32():a===2?e.x=i.readVarint():a===3?e.y=i.readVarint():a===4?e.z=i.readVarint():a===5&&e.layers.push(function(s,c){return s.readFields(GA,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(i,i.readVarint()+i.pos))}function VA(a,e,i){a===1?(e.delta_filter=function(s,c){return s.readFields(UA,{blockSize:0},c)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):a===2?(i.readVarint(),e.filter="zigzag_filter"):a===3?(i.readVarint(),e.filter="bitshuffle_filter"):a===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function UA(a,e,i){a===1&&(e.blockSize=i.readVarint())}function jA(a,e,i){a===1?(i.readVarint(),e.codec="gzip_data"):a===2?(i.readVarint(),e.codec="jpeg_image"):a===3?(i.readVarint(),e.codec="webp_image"):a===4&&(i.readVarint(),e.codec="png_image")}function qA(a,e,i){let s=0,c=0;a===1?e.firstByte=i.readFixed64():a===2?e.lastByte=i.readFixed64():a===3?e.filters.push(function(l,d){return l.readFields(VA,{},d)}(i,i.readVarint()+i.pos)):a===4?e.codec=function(l,d){return l.readFields(jA,{},d)}(i,i.readVarint()+i.pos):a===5?c=i.readFloat():a===6?s=i.readFloat():a===7?e.bands.push(i.readString()):a===8?e.offset=i.readDouble():a===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=s)}function GA(a,e,i){a===1?e.version=i.readVarint():a===2?e.name=i.readString():a===3?e.units=i.readString():a===4?e.tileSize=i.readVarint():a===5?e.buffer=i.readVarint():a===6?e.pixelFormat=i.readVarint():a===7&&e.dataIndex.push(function(s,c){return s.readFields(qA,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(i,i.readVarint()+i.pos))}function HA(a,e,i){if(a===2)(function(s,c,l){s.readFields(ZA,l,c)})(i,i.readVarint()+i.pos,e);else if(a===3)throw new Error("Not implemented")}function ZA(a,e,i){if(a===1){let s=0;const c=i.readVarint()+i.pos;for(;i.pos<c;)e[s++]=i.readVarint()}}function $A(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const c=s===1?1:0,l=s===2?1:0;for(let d=0;d<e[0];d++){const y=e[1]*d;for(let w=c;w<e[1];w++){const A=e[2]*(w+y);for(let _=l;_<e[2];_++){const T=e[3]*(_+A);for(let C=0;C<e[3];C++){const E=T+C;a[E]+=a[E-i]}}}}i*=e[s]}return a}function XA(a){for(let e=0,i=a.length;e<i;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function YA(a,e){switch(e){case"uint32":return a;case"uint16":for(let i=0;i<a.length;i+=2){const s=a[i],c=a[i+1];a[i]=(240&s)>>4|(61440&s)>>8|(240&c)<<4|61440&c,a[i+1]=15&s|(3840&s)>>4|(15&c)<<8|(3840&c)<<4}return a;case"uint8":for(let i=0;i<a.length;i+=4){const s=a[i],c=a[i+1],l=a[i+2],d=a[i+3];a[i+0]=(192&s)>>6|(192&c)>>4|(192&l)>>2|192&d,a[i+1]=(48&s)>>4|(48&c)>>2|48&l|(48&d)<<2,a[i+2]=(12&s)>>2|12&c|(12&l)<<2|(12&d)<<4,a[i+3]=3&s|(3&c)<<2|(3&l)<<4|(3&d)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}Wt(Rv,"DEMData"),Wt(Cw,"DemMinMaxQuadTree",{omit:["dem"]});var dl=Uint8Array,Rg=Uint16Array,WA=Int32Array,Rw=new dl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dw=new dl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),KA=new dl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zw=function(a,e){for(var i=new Rg(31),s=0;s<31;++s)i[s]=e+=1<<a[s-1];var c=new WA(i[30]);for(s=1;s<30;++s)for(var l=i[s];l<i[s+1];++l)c[l]=l-i[s]<<5|s;return{b:i,r:c}},Lw=zw(Rw,2),Ow=Lw.b,JA=Lw.r;Ow[28]=258,JA[258]=28;for(var QA=zw(Dw,0).b,Pw=new Rg(32768),na=0;na<32768;++na){var v_=(43690&na)>>1|(21845&na)<<1;Pw[na]=((65280&(v_=(61680&(v_=(52428&v_)>>2|(13107&v_)<<2))>>4|(3855&v_)<<4))>>8|(255&v_)<<8)>>1}var Dg=function(a,e,i){for(var s=a.length,c=0,l=new Rg(e);c<s;++c)a[c]&&++l[a[c]-1];var d,y=new Rg(e);for(c=1;c<e;++c)y[c]=y[c-1]+l[c-1]<<1;d=new Rg(1<<e);var w=15-e;for(c=0;c<s;++c)if(a[c])for(var A=c<<4|a[c],_=e-a[c],T=y[a[c]-1]++<<_,C=T|(1<<_)-1;T<=C;++T)d[Pw[T]>>w]=A;return d},zg=new dl(288);for(na=0;na<144;++na)zg[na]=8;for(na=144;na<256;++na)zg[na]=9;for(na=256;na<280;++na)zg[na]=7;for(na=280;na<288;++na)zg[na]=8;var kw=new dl(32);for(na=0;na<32;++na)kw[na]=5;var eM=Dg(zg,9),tM=Dg(kw,5),dx=function(a){for(var e=a[0],i=1;i<a.length;++i)a[i]>e&&(e=a[i]);return e},ou=function(a,e,i){var s=e/8|0;return(a[s]|a[s+1]<<8)>>(7&e)&i},fx=function(a,e){var i=e/8|0;return(a[i]|a[i+1]<<8|a[i+2]<<16)>>(7&e)},iM=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],lu=function(a,e,i){var s=new Error(e||iM[a]);if(s.code=a,Error.captureStackTrace&&Error.captureStackTrace(s,lu),!i)throw s;return s},nM=new dl(0),rM=typeof TextDecoder<"u"&&new TextDecoder;try{rM.decode(nM,{stream:!0})}catch{}const aM={gzip_data:"gzip"};class sc extends Error{constructor(e){super(e),this.name="MRTError"}}const sM={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Bw={uint32:1,uint16:2,uint8:4},oM={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let px;class Dv{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new sc(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new sc("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new sc(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const c=function(l,d){return l.readFields(FA,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new px(i.subarray(0,s)));if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new sc(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const l of c.layers)this.layers[l.name]=new Nw(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let c of e.blockIndices){const l=s.dataIndex[c],d=l.firstByte-e.firstByte,y=l.lastByte-e.firstByte;if(s._blocksInProgress.has(c))continue;const w={layerName:s.name,firstByte:d,lastByte:y,pixelFormat:s.pixelFormat,blockIndex:c,blockShape:[l.bands.length].concat(s.bandShape),buffer:s.buffer,codec:l.codec.codec,filters:l.filters.map(A=>A.filter)};s._blocksInProgress.add(c),i.push(w)}return new Fw(i,()=>{i.forEach(c=>s._blocksInProgress.delete(c.blockIndex))},(c,l)=>{if(i.forEach(d=>s._blocksInProgress.delete(d.blockIndex)),c)throw c;l.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class Nw{constructor({version:e,name:i,units:s,tileSize:c,pixelFormat:l,buffer:d,dataIndex:y},w){if(this.version=e,this.version!==1)throw new sc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=c,this.buffer=d,this.pixelFormat=sM[l],this.dataIndex=y,this.bandShape=[c+2*d,c+2*d,Bw[this.pixelFormat]],this._decodedBlocks=new Iv(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Bw[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,c]of this.dataIndex.entries()){for(const[l,d]of c.bands.entries())if(d===e)return{bandIndex:i+l,blockIndex:s,blockBandIndex:l};i+=c.bands.length}break;case"number":for(const[s,c]of this.dataIndex.entries()){if(e>=i&&e<i+c.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=c.bands.length}break;default:throw new sc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new sc(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,s=-1/0;const c=[],l=new Set;for(const d of e){const{blockIndex:y}=this.getBlockForBand(d);if(y<0)throw new sc(`Invalid band: ${JSON.stringify(d)}`);const w=this.dataIndex[y];c.includes(y)||c.push(y),l.add(y),i=Math.min(i,w.firstByte),s=Math.max(s,w.lastByte)}if(l.size>this.cacheSize)throw new sc(`Number of blocks to decode (${l.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:c}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e),c=this._decodedBlocks.get(i.toString());if(!c)throw new sc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[i],d=this.bandShape.reduce((A,_)=>A*_,1),y=s*d,w=c.subarray(y,y+d);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:l.offset,scale:l.scale}}}Dv.setPbf=function(a){px=a};class Fw{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Dv.performDecoding=function(a,e){const i=new Uint8Array(a);return Promise.all(e.tasks.map(s=>{const{layerName:c,firstByte:l,lastByte:d,pixelFormat:y,blockShape:w,blockIndex:A,filters:_,codec:T}=s,C=i.subarray(l,d+1),E=new Uint32Array(w[0]*w[1]*w[2]);let M;if(T!=="gzip_data")throw new sc(`Unhandled codec: ${T}`);return M=function(z,N){if(!globalThis.DecompressionStream&&N==="gzip_data")return Promise.resolve(((q=function(ee){ee[0]==31&&ee[1]==139&&ee[2]==8||lu(6,"invalid gzip data");var he=ee[3],le=10;4&he&&(le+=2+(ee[10]|ee[11]<<8));for(var ue=(he>>3&1)+(he>>4&1);ue>0;ue-=!ee[le++]);return le+(2&he)}(H=z))+8>H.length&&lu(6,"invalid gzip data"),function(ee,he,le,ue){var Te=ee.length;if(!Te||he.f&&!he.l)return le||new dl(0);var pe=!le,Ee=pe||he.i!=2,De=he.i;pe&&(le=new dl(3*Te));var Re,ke,Pe=function(Ff){var Vf=le.length;if(Ff>Vf){var Hp=new dl(Math.max(2*Vf,Ff));Hp.set(le),le=Hp}},Ze=he.f||0,Ue=he.p||0,Xe=he.b||0,bt=he.l,xt=he.d,ei=he.m,zt=he.n,Nt=8*Te;do{if(!bt){Ze=ou(ee,Ue,1);var St=ou(ee,Ue+1,3);if(Ue+=3,!St){var wi=ee[(Oi=4+((Ue+7)/8|0))-4]|ee[Oi-3]<<8,Xt=Oi+wi;if(Xt>Te){De&&lu(0);break}Ee&&Pe(Xe+wi),le.set(ee.subarray(Oi,Xt),Xe),he.b=Xe+=wi,he.p=Ue=8*Xt,he.f=Ze;continue}if(St==1)bt=eM,xt=tM,ei=9,zt=5;else if(St==2){var ci=ou(ee,Ue,31)+257,Li=ou(ee,Ue+10,15)+4,Wi=ci+ou(ee,Ue+5,31)+1;Ue+=14;for(var ki=new dl(Wi),an=new dl(19),Yi=0;Yi<Li;++Yi)an[KA[Yi]]=ou(ee,Ue+3*Yi,7);Ue+=3*Li;var un=dx(an),Cn=(1<<un)-1,er=Dg(an,un);for(Yi=0;Yi<Wi;){var Oi,_n=er[ou(ee,Ue,Cn)];if(Ue+=15&_n,(Oi=_n>>4)<16)ki[Yi++]=Oi;else{var ur=0,_r=0;for(Oi==16?(_r=3+ou(ee,Ue,3),Ue+=2,ur=ki[Yi-1]):Oi==17?(_r=3+ou(ee,Ue,7),Ue+=3):Oi==18&&(_r=11+ou(ee,Ue,127),Ue+=7);_r--;)ki[Yi++]=ur}}var wr=ki.subarray(0,ci),Er=ki.subarray(ci);ei=dx(wr),zt=dx(Er),bt=Dg(wr,ei),xt=Dg(Er,zt)}else lu(1);if(Ue>Nt){De&&lu(0);break}}Ee&&Pe(Xe+131072);for(var Yn=(1<<ei)-1,_a=(1<<zt)-1,Os=Ue;;Os=Ue){var Yr=(ur=bt[fx(ee,Ue)&Yn])>>4;if((Ue+=15&ur)>Nt){De&&lu(0);break}if(ur||lu(2),Yr<256)le[Xe++]=Yr;else{if(Yr==256){Os=Ue,bt=null;break}var ra=Yr-254;Yr>264&&(ra=ou(ee,Ue,(1<<(fl=Rw[Yi=Yr-257]))-1)+Ow[Yi],Ue+=fl);var ls=xt[fx(ee,Ue)&_a],Pa=ls>>4;if(ls||lu(3),Ue+=15&ls,Er=QA[Pa],Pa>3){var fl=Dw[Pa];Er+=fx(ee,Ue)&(1<<fl)-1,Ue+=fl}if(Ue>Nt){De&&lu(0);break}Ee&&Pe(Xe+131072);var Nf=Xe+ra;if(Xe<Er){var oc=0-Er,uu=Math.min(Er,Nf);for(oc+Xe<0&&lu(3);Xe<uu;++Xe)le[Xe]=(void 0)[oc+Xe]}for(;Xe<Nf;++Xe)le[Xe]=le[Xe-Er]}}he.l=bt,he.p=Os,he.b=Xe,he.f=Ze,bt&&(Ze=1,he.m=ei,he.d=xt,he.n=zt)}while(!Ze);return Xe!=le.length&&pe?(Re=le,((ke=Xe)==null||ke>Re.length)&&(ke=Re.length),new dl(Re.subarray(0,ke))):le.subarray(0,Xe)}(H.subarray(q,-8),{i:2},new dl(((V=H)[(Z=V.length)-4]|V[Z-3]<<8|V[Z-2]<<16|V[Z-1]<<24)>>>0))));var V,Z,H,q;const Y=aM[N];if(!Y)throw new Error(`Unhandled codec: ${N}`);const K=new globalThis.DecompressionStream(Y);return new Response(new Blob([z]).stream().pipeThrough(K)).arrayBuffer().then(ee=>new Uint8Array(ee))}(C,T).then(z=>(function(N,V){N.readFields(HA,V)}(new px(z),E),new oM[y](E.buffer))),M.then(z=>{for(let N=_.length-1;N>=0;N--)switch(_[N]){case"delta_filter":$A(z,w);break;case"zigzag_filter":XA(z);break;case"bitshuffle_filter":YA(z,y);break;default:throw new sc(`Unhandled filter "${_[N]}"`)}return{layerName:c,blockIndex:A,data:z}}).catch(z=>{throw z})}))},Wt(Fw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Wt(Dv,"MapboxRasterTile"),Wt(Nw,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Lg,mx,cu,x_,_x,b_=null;function Vw(){return Ma()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:mx||ie.DRACO_URL}function Uw(){if(Ma()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(x_)return x_;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return x_=WebAssembly.validate(a)?ie.MESHOPT_SIMD_URL:ie.MESHOPT_URL,x_}const zv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lM={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Og={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function jw(a,e,i){const s=i.json.bufferViews.length,c=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:c,byteLength:a.byteLength},i.buffers[c]=a}const gx="KHR_draco_mesh_compression";function cM(a,e){const i=a.extensions&&a.extensions[gx];if(!i)return;const s=new cu.Decoder,c=Zw(e,i.bufferView),l=new cu.Mesh;if(!s.DecodeArrayToMesh(c,c.byteLength,l))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[a.indices],y=zv[d.componentType],w=d.count*y.BYTES_PER_ELEMENT,A=cu._malloc(w);y===Uint16Array?s.GetTrianglesUInt16Array(l,w,A):s.GetTrianglesUInt32Array(l,w,A),jw(cu.memory.buffer.slice(A,A+w),d,e),cu._free(A);for(const _ of Object.keys(i.attributes)){const T=s.GetAttributeByUniqueId(l,i.attributes[_]),C=e.json.accessors[a.attributes[_]],E=lM[C.componentType],M=C.count*Og[C.type]*zv[C.componentType].BYTES_PER_ELEMENT,z=cu._malloc(M);s.GetAttributeDataArrayForAllPoints(l,T,cu[E],M,z),jw(cu.memory.buffer.slice(z,z+M),C,e),cu._free(z)}s.destroy(),l.destroy(),delete a.extensions[gx]}const Lv="EXT_meshopt_compression";function uM(a,e){if(!a.extensions||!a.extensions[Lv])return;const i=a.extensions[Lv],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),c=new Uint8Array(i.count*i.byteStride);_x.decodeGltfBuffer(c,i.count,i.byteStride,s,i.mode,i.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=c.buffer,delete a.extensions[Lv]}const qw=1179937895,Gw=new TextDecoder("utf8");function Hw(a,e){return new URL(a,e).href}function hM(a,e,i,s){return fetch(Hw(a.uri,s)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[i]=c})}function Zw(a,e){const i=a.json.bufferViews[e];return new Uint8Array(a.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function dM(a,e,i,s){if(a.uri){const c=Hw(a.uri,s);return fetch(c).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(a.bufferView!==void 0){const c=Zw(e,a.bufferView),l=new Blob([c],{type:a.mimeType});return createImageBitmap(l).then(d=>{e.images[i]=d})}}function $w(a,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===qw){const _=new Uint32Array(a,e);let T=2;const C=(_[T++]>>2)-3,E=_[T++]>>2;if(T++,s.json=JSON.parse(Gw.decode(_.subarray(T,T+E))),T+=E,T<C){const M=_[T++];T++;const z=e+(T<<2);s.buffers[0]=a.slice(z,z+M)}}else s.json=JSON.parse(Gw.decode(new Uint8Array(a,e)));const{buffers:c,images:l,meshes:d,extensionsUsed:y,bufferViews:w}=s.json;let A=Promise.resolve();if(c){const _=[];for(let T=0;T<c.length;T++){const C=c[T];C.uri?_.push(hM(C,s,T,i)):s.buffers[T]||(s.buffers[T]=null)}A=Promise.all(_)}return A.then(()=>{const _=[],T=y&&y.includes(gx),C=y&&y.includes(Lv);if(T&&_.push(function(){if(!cu)return Lg??(Lg=function(E){let M,z=null;function N(){M=new Uint8Array(z.buffer)}function V(){throw new Error("Unexpected Draco error.")}const Z={a:{a:V,d:function(H,q,Y){return M.copyWithin(H,q,q+Y)},c:function(H){const q=M.length,Y=Math.max(H>>>0,Math.ceil(1.2*q)),K=Math.ceil((Y-q)/65536);try{return z.grow(K),N(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,Z):E.then(H=>H.arrayBuffer()).then(H=>WebAssembly.instantiate(H,Z))).then(H=>{const{Rb:q,Qb:Y,P:K,T:ee,X:he,Ja:le,La:ue,Qa:Te,Va:pe,Wa:Ee,eb:De,jb:Re,f:ke,e:Pe,yb:Ze,zb:Ue,Ab:Xe,Bb:bt,Db:xt,Gb:ei}=H.instance.exports;z=Pe;const zt=(()=>{let Nt=0,St=0,wi=0,Xt=0;return ci=>{wi&&(q(Xt),q(Nt),St+=wi,wi=Nt=0),Nt||(St+=128,Nt=Y(St));const Li=ci.length+7&-8;let Wi=Nt;Li>=St&&(wi=Li,Wi=Xt=Y(Li));for(let ki=0;ki<ci.length;ki++)M[Wi+ki]=ci[ki];return Wi}})();return N(),ke(),{memory:Pe,_free:q,_malloc:Y,Mesh:class{constructor(){this.ptr=K()}destroy(){ee(this.ptr)}},Decoder:class{constructor(){this.ptr=le()}destroy(){Re(this.ptr)}DecodeArrayToMesh(Nt,St,wi){const Xt=zt(Nt),ci=ue(this.ptr,Xt,St,wi.ptr);return!!he(ci)}GetAttributeByUniqueId(Nt,St){return{ptr:Te(this.ptr,Nt.ptr,St)}}GetTrianglesUInt16Array(Nt,St,wi){pe(this.ptr,Nt.ptr,St,wi)}GetTrianglesUInt32Array(Nt,St,wi){Ee(this.ptr,Nt.ptr,St,wi)}GetAttributeDataArrayForAllPoints(Nt,St,wi,Xt,ci){De(this.ptr,Nt.ptr,St.ptr,wi,Xt,ci)}},DT_INT8:Ze(),DT_UINT8:Ue(),DT_INT16:Xe(),DT_UINT16:bt(),DT_UINT32:xt(),DT_FLOAT32:ei()}})}(fetch(Vw())),Lg.then(E=>{cu=E,Lg=void 0}))}()),C&&_.push(function(){if(_x)return;const E=function(M){let z;const N=WebAssembly.instantiateStreaming(M,{}).then(H=>{z=H.instance,z.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(H,q,Y,K,ee,he){(function(le,ue,Te,pe,Ee,De,Re){const ke=le.exports.sbrk,Pe=pe+3&-4,Ze=ke(Pe*Ee),Ue=ke(De.length),Xe=new Uint8Array(le.exports.memory.buffer);Xe.set(De,Ue);const bt=ue(Ze,pe,Ee,Ue,De.length);if(bt===0&&Re&&Re(Ze,Pe,Ee),Te.set(Xe.subarray(Ze,Ze+pe*Ee)),ke(Ze-ke(0)),bt!==0)throw new Error(`Malformed buffer data: ${bt}`)})(z,z.exports[Z[ee]],H,q,Y,K,z.exports[V[he]])}}}(fetch(Uw()));return E.ready.then(()=>{_x=E})}()),l)for(let E=0;E<l.length;E++)_.push(dM(l[E],s,E,i));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(T&&d)for(const{primitives:E}of d)for(const M of E)cM(M,s);if(C&&d&&w)for(const E of w)uM(E,s);return s})})}function Gp(a,e){const i=a.json.bufferViews[e.bufferView],s=zv[e.componentType];return new s(a.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Og[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:Og[e.type]))}function yx(a,e,i,s){const c=zv[e.componentType],l=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),d=a.json.bufferViews[e.bufferView],y=d.byteStride?d.byteStride/c.BYTES_PER_ELEMENT:Og[e.type],w=i.float32,A=w.length/i.capacity;for(let _=0,T=0;_<e.count*y;_+=y,T+=A)for(let C=0;C<A;C++)w[T+C]=s[_+C]*l;i._trim()}function fM(a,e,i){const s=a.indices,c=a.attributes,l={};l.indexArray=new ca;const d=e.json.accessors[s],y=d.count/3;l.indexArray.reserve(y);const w=Gp(e,d);for(let C=0;C<y;C++)l.indexArray.emplaceBack(w[3*C],w[3*C+1],w[3*C+2]);l.indexArray._trim(),l.vertexArray=new xs;const A=e.json.accessors[c.POSITION];l.vertexArray.reserve(A.count);const _=Gp(e,A);for(let C=0;C<A.count;C++)l.vertexArray.emplaceBack(_[3*C],_[3*C+1],_[3*C+2]);if(l.vertexArray._trim(),l.aabb=new jt(A.min,A.max),l.centroid=function(C,E){const M=[0,0,0],z=C.length;if(z>0){for(let N=0;N<z;N++){const V=3*C[N];M[0]+=E[V],M[1]+=E[V+1],M[2]+=E[V+2]}M[0]/=z,M[1]/=z,M[2]/=z}return M}(w,_),c.COLOR_0!==void 0){const C=e.json.accessors[c.COLOR_0],E=Og[C.type],M=Gp(e,C);l.colorArray=E===3?new xs:new Xl,l.colorArray.resize(C.count),yx(e,C,l.colorArray,M)}if(c.NORMAL!==void 0){l.normalArray=new xs;const C=e.json.accessors[c.NORMAL];l.normalArray.resize(C.count);const E=Gp(e,C);yx(e,C,l.normalArray,E)}if(c.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new qc;const C=e.json.accessors[c.TEXCOORD_0];l.texcoordArray.resize(C.count);const E=Gp(e,C);yx(e,C,l.texcoordArray,E)}if(c._FEATURE_ID_RGBA4444!==void 0){const C=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=Gp(e,C))}c._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(Gp(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const T=a.material;return l.material=function(C,E){const{emissiveFactor:M=[0,0,0],alphaMode:z="OPAQUE",alphaCutoff:N=.5,normalTexture:V,occlusionTexture:Z,emissiveTexture:H,doubleSided:q}=C,{baseColorFactor:Y=[1,1,1,1],metallicFactor:K=1,roughnessFactor:ee=1,baseColorTexture:he,metallicRoughnessTexture:le}=C.pbrMetallicRoughness||{},ue=Z?E[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&ue){const Te=Z.extensions.KHR_texture_transform;ue.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Mn(...Y),metallicFactor:K,roughnessFactor:ee,baseColorTexture:he?E[he.index]:void 0,metallicRoughnessTexture:le?E[le.index]:void 0},doubleSided:q,emissiveFactor:M,alphaMode:z,alphaCutoff:N,normalTexture:V?E[V.index]:void 0,occlusionTexture:ue,emissionTexture:H?E[H.index]:void 0,defined:C.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},i),l}function Xw(a,e,i){const{matrix:s,rotation:c,translation:l,scale:d,mesh:y,extras:w,children:A}=a,_={};if(_.matrix=s||de.mat4.fromRotationTranslationScale([],c||[0,0,0,1],l||[0,0,0],d||[1,1,1]),y!==void 0){_.meshes=i[y];const T=_.anchor=[0,0];for(const C of _.meshes){const{min:E,max:M}=C.aabb;T[0]+=E[0]+M[0],T[1]+=E[1]+M[1]}T[0]=Math.floor(T[0]/_.meshes.length/2),T[1]=Math.floor(T[1]/_.meshes.length/2)}if(w&&(w.id&&(_.id=w.id),w.lights&&(_.lights=function(T){if(!T.length)return[];const C=function(V){const Z=atob(V),H=new Uint8Array(Z.length);for(let q=0;q<Z.length;q++)H[q]=Z.codePointAt(q);return H}(T),E=[],M=C.length/24,z=new Uint16Array(C.buffer),N=new Float32Array(C.buffer);for(let V=0;V<M;V++){const Z=z[2*V*6]/30,H=z[2*V*6+1]/30,q=z[2*V*6+10]/100,Y=N[6*V+1],K=N[6*V+2],ee=N[6*V+3],he=N[6*V+4],le=ee-Y,ue=he-K,Te=Math.hypot(le,ue);E.push({pos:[Y+.5*le,K+.5*ue,H],normal:[ue/Te,-le/Te,0],width:Te,height:Z,depth:q,points:[Y,K,ee,he]})}return E}(w.lights))),A){const T=[];for(const C of A)T.push(Xw(e.json.nodes[C],e,i));_.children=T}return _}function pM(a){if(a.vertices.length===0||a.indices.length===0)return null;const e=new Ep(a.vertices,a.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:i,max:s}}function mM(a){if(!a.extras||!a.extras.ground)return null;const e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const y=d[0],w=d[1];typeof y=="number"&&typeof w=="number"&&s.push(new Ft(y,w))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let c=0;for(let d=0;d<s.length;d++){const y=s[d],w=s[(d+1)%s.length],A=s[(d+2)%s.length];c+=(y.x-w.x)*(A.y-w.y)-(A.x-w.x)*(y.y-w.y)}c>0&&s.reverse();const l=Wu(s.flatMap(d=>[d.x,d.y]),[]);return l.length===0?null:{vertices:s,indices:l}}function _M(a,e){const i=[],s=[];let c=0;const l=[];for(const d of a){c=i.length;const y=d.vertexArray.float32,w=d.indexArray.uint16;for(let A=0;A<d.vertexArray.length;A++)l[0]=y[3*A+0],l[1]=y[3*A+1],l[2]=y[3*A+2],de.vec3.transformMat4(l,l,e),i.push(new Ft(l[0],l[1]));for(let A=0;A<3*d.indexArray.length;A++)s.push(w[A]+c)}if(s.length%3!=0)return null;for(let d=0;d<s.length;d+=3){const y=i[s[d+0]],w=i[s[d+1]],A=i[s[d+2]];(y.x-w.x)*(A.y-w.y)-(A.x-w.x)*(y.y-w.y)>0&&([s[d+1],s[d+2]]=[s[d+2],s[d+1]])}return{vertices:i,indices:s}}function Yw(a){const e=function(w,A){const _=[],T=WebGL2RenderingContext;if(w.json.textures)for(const C of w.json.textures){const E={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};C.sampler!==void 0&&Object.assign(E,w.json.samplers[C.sampler]),_.push({image:A[C.source],sampler:E,uploaded:!1})}return _}(a,a.images),i=function(w,A){const _=[];for(const T of w.json.meshes){const C=[];for(const E of T.primitives)C.push(fM(E,w,A));_.push(C)}return _}(a,e),{scenes:s,scene:c,nodes:l}=a.json,d=s?s[c||0].nodes:l,y=[];for(const w of d)y.push(Xw(l[w],a,i));return function(w,A,_){const T={},C=new Set;for(let E=0;E<w.length;E++){const M=_[A[E]];if(!M.extras)continue;const z=M.extras["mapbox:footprint:version"],N=M.extras["mapbox:footprint:id"];(z||N)&&C.add(E),z==="1.0.0"&&N&&(T[N]=E)}for(let E=0;E<w.length;E++){if(C.has(E))continue;const M=w[E],z=_[A[E]];if(!z.extras)continue;let N=null;M.id in T&&(N=_M(w[T[M.id]].meshes,M.matrix)),N||(N=mM(z)),N&&(M.footprint=pM(N))}if(C.size>0){const E=Array.from(C.values()).sort((M,z)=>M-z);for(let M=E.length-1;M>=0;M--)w.splice(E[M],1)}}(y,d,a.json.nodes),y}function gM(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const e=a.vertexArray.float32,i=a.aabb.min[0]-1,s=a.aabb.min[1]-1,c=Up/(a.aabb.max[0]-i+2),l=Up/(a.aabb.max[1]-s+2);for(let d=0;d<e.length;d+=3){const y=e[d+2],w=(e[d+0]-i)*c|0,A=(e[d+1]-s)*l|0;y>a.heightmap[A*Up+w]&&(a.heightmap[A*Up+w]=y)}}function yM(a,e){const i={};i.indexArray=new ca,i.indexArray.reserve(4*a.length),i.vertexArray=new xs,i.vertexArray.reserve(10*a.length),i.colorArray=new Xl,i.vertexArray.reserve(10*a.length);let s=0;for(const d of a){const y=Math.min(10,Math.max(4,1.3*d.height))*e,w=[-d.normal[1],d.normal[0],0],A=Math.min(.29,.1*d.width/d.depth),_=d.width-2*d.depth*e*(A+.01),T=de.vec3.scaleAndAdd([],d.pos,w,_/2),C=de.vec3.scaleAndAdd([],d.pos,w,-_/2),E=[T[0],T[1],T[2]+d.height],M=[C[0],C[1],C[2]+d.height],z=de.vec3.scaleAndAdd([],d.normal,w,A);de.vec3.scale(z,z,y);const N=de.vec3.scaleAndAdd([],d.normal,w,-A);de.vec3.scale(N,N,y),de.vec3.add(z,T,z),de.vec3.add(N,C,N),T[2]+=.1,C[2]+=.1,i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(N[0],N[1],N[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(N[0],N[1],N[2]);const V=_/y/2;i.colorArray.emplaceBack(-V-A,-1,V,.8),i.colorArray.emplaceBack(V+A,-1,V,.8),i.colorArray.emplaceBack(-V,0,V,1.3),i.colorArray.emplaceBack(V,0,V,1.3),i.colorArray.emplaceBack(V+A,-.8,V,.7),i.colorArray.emplaceBack(V+A,-.8,V,.7),i.colorArray.emplaceBack(0,0,V,1.3),i.colorArray.emplaceBack(0,0,V,1.3),i.colorArray.emplaceBack(V+A,-1.2,V,.8),i.colorArray.emplaceBack(V+A,-1.2,V,.8),i.indexArray.emplaceBack(6+s,4+s,8+s),i.indexArray.emplaceBack(7+s,9+s,5+s),i.indexArray.emplaceBack(0+s,1+s,2+s),i.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const c={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=Mn.white,c.pbrMetallicRoughness=l,i.material=c,i.aabb=new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class Ww{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const vM=["id","tile","layer","source","sourceLayer","state"];class w_{constructor(e,i,s,c,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=c,this.properties=e.properties,this.id=l}clone(){const e=new w_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of vM)this[i]!==void 0&&(e[i]=this[i]);return e}}class Kw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Oc(Bt,16,0),this.featureIndexArray=new Ta,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,c,l,d=0,y=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,l,d);const A=this.grid;for(let _=0;_<i.length;_++){const T=i[_],C=[1/0,1/0,-1/0,-1/0];for(let E=0;E<T.length;E++){const M=T[E];C[0]=Math.min(C[0],M.x),C[1]=Math.min(C[1],M.y),C[2]=Math.max(C[2],M.x),C[3]=Math.max(C[3],M.y)}y!==0&&(C[0]-=y,C[1]-=y,C[2]+=y,C[3]+=y),C[0]<Bt&&C[1]<Bt&&C[2]>=0&&C[3]>=0&&A.insert(w,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Qc.VectorTile(new Qt(this.rawTileData)).layers,this.sourceLayerCoder=new Ww(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:c,tileTransform:l,pixelPosMatrix:d,availableImages:y}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const w=s.bufferedTilespaceBounds,A=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(E,M,z,N)=>xe(s.bufferedTilespaceGeometry,E,M,z,N));A.sort(xM);let _=null;c.elevation&&A.length>0&&(_=m_.create(c.elevation,this.tileID));const T={};let C;for(let E=0;E<A.length;E++){const M=A[E];if(M===C)continue;C=M;const z=this.featureIndexArray.get(M);let N=null;this.is3DTile?this.loadMatchingModelFeature(T,z,e,s,c):this.loadMatchingFeature(T,z,e,y,(V,Z,H,q=0)=>(N||(N=P(V,this.tileID.canonical,l)),Z.queryIntersectsFeature(s,V,H,N,this.z,c,d,_,q)))}return T}loadMatchingFeature(e,i,s,c,l){const{featureIndex:d,bucketIndex:y,sourceLayerIndex:w,layoutVertexArrayOffset:A}=i,_=this.bucketLayerIDs[y],T=s.layers,C=Object.keys(T);if(C.length&&!function(V,Z){for(let H=0;H<V.length;H++)if(Z.indexOf(V[H])>=0)return!0;return!1}(C,_))return;const E=s.sourceCache,M=this.sourceLayerCoder.decode(w),z=this.vtLayers[M].feature(d),N=this.getId(z,M);for(let V=0;V<_.length;V++){const Z=_[V];if(!T[Z])continue;const{styleLayer:H,targets:q}=T[Z];let Y={};N!==void 0&&(Y=E.getFeatureState(H.sourceLayer,N));const K=!l||l(z,H,Y,A);if(!K)continue;const ee=new w_(z,this.z,this.x,this.y,N);ee.tile=this.tileID.canonical,ee.state=Y;let he=this.serializedLayersCache.get(Z);he||(he=H.serialize(),he.id=Z,this.serializedLayersCache.set(Z,he)),ee.source=he.source,ee.sourceLayer=he["source-layer"],ee.layer=vi({},he),ee.layer.paint=Jw(he.paint,H.paint,z,Y,c),ee.layer.layout=Jw(he.layout,H.layout,z,Y,c);let le=!1;for(const ue of q){this.updateFeatureProperties(ee,ue);const{filter:Te}=ue;if(Te){if(z.properties=ee.properties,Te.needGeometry){const pe=k(z,!0);if(!Te.filter(new Ln(this.tileID.overscaledZ),pe,this.tileID.canonical))continue}else if(!Te.filter(new Ln(this.tileID.overscaledZ),z))continue}le=!0,ue.targetId&&this.addFeatureVariant(ee,ue)}le&&this.appendToResult(e,Z,d,ee,K)}}loadMatchingModelFeature(e,i,s,c,l){const d=this.bucketLayerIDs[0][0],y=s.layers;if(!y[d])return;const{styleLayer:w,targets:A}=y[d];if(w.type!=="model")return;const _=c.tile,T=i.featureIndex,C=_.getBucket(w);if(!(C&&C instanceof wv))return;const E=function(he,le,ue,Te){const pe=he.getNodesInfo()[le];if(pe.hiddenByReplacement||!pe.node.meshes)return;let Ee=Number.MAX_VALUE;const De=pe.node,Re=ue.tile,ke=Te.calculatePosMatrix(Re.tileID.toUnwrapped(),Te.worldSize),Pe=pe.evaluatedScale;let Ze=0;Te.elevation&&De.elevation&&(Ze=De.elevation*Te.elevation.exaggeration()),de.mat4.translate(ke,ke,[(De.anchor?De.anchor[0]:0)*(Pe[0]-1),(De.anchor?De.anchor[1]:0)*(Pe[1]-1),Ze]),de.mat4.scale(ke,ke,Pe);const Ue=ue.queryGeometry,Xe=Ue.isPointQuery()?Ue.screenBounds:Ue.screenGeometry,bt=function(ei){const zt=de.mat4.multiply([],ke,ei.matrix);de.mat4.multiply(zt,Te.expandedFarZProjMatrix,zt);for(let Nt=0;Nt<ei.meshes.length;++Nt){const St=ei.meshes[Nt];if(Nt===ei.lightMeshIndex)continue;const wi=Yb(Xe,Te,zt,St.aabb);wi!=null&&(Ee=Math.min(wi,Ee))}if(ei.children)for(const Nt of ei.children)bt(Nt)};if(bt(De),Ee===Number.MAX_VALUE)return;const xt=new Tn(0,0);return ow(Re.tileID.canonical,xt,pe.node.anchor[0],pe.node.anchor[1]),{intersectionZ:Ee,position:xt,feature:pe.feature}}(C,T,c,l);if(!E)return;const{z:M,x:z,y:N}=_.tileID.canonical,{feature:V,intersectionZ:Z,position:H}=E;let q={};V.id!==void 0&&(q=s.sourceCache.getFeatureState(w.sourceLayer,V.id));const Y=new w_({},M,z,N,V.id);Y.tile=this.tileID.canonical,Y.state=q,Y.properties=V.properties,Y.geometry={type:"Point",coordinates:[H.lng,H.lat]};let K=this.serializedLayersCache.get(d);K||(K=w.serialize(),K.id=d,this.serializedLayersCache.set(d,K)),Y.source=K.source,Y.sourceLayer=K["source-layer"],Y.layer=vi({},K);let ee=!1;for(const he of A){this.updateFeatureProperties(Y,he);const{filter:le}=he;if(le){if(V.properties=Y.properties,le.needGeometry){if(!le.filter(new Ln(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!le.filter(new Ln(this.tileID.overscaledZ),V))continue}ee=!0,he.targetId&&this.addFeatureVariant(Y,he)}ee&&this.appendToResult(e,d,T,Y,Z)}updateFeatureProperties(e,i,s){if(i.properties){const c={};for(const l in i.properties){const d=i.properties[l].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);d!=null&&(c[l]=d)}e.properties=c}}addFeatureVariant(e,i,s){const c={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(c)}appendToResult(e,i,s,c,l){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:s,feature:c,intersectionZ:l})}lookupSymbolFeatures(e,i,s,c,l){const d={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(d,{bucketIndex:i,sourceLayerIndex:s,featureIndex:y,layoutVertexArrayOffset:0},c,l);return d}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),l=this.vtFeatures[c];if(l[i])return l[i];const d=this.vtLayers[c].feature(i);return l[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const l=Lc(c);if(l.result!=="success"){const d=l.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void Kn(`Failed to create expression for promoteId: ${d}`)}this.promoteIdExpression=l.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Md),s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[c];typeof s=="boolean"&&(s=Number(s))}return s}}function Jw(a,e,i,s,c){return hs(a,(l,d)=>{const y=e instanceof Fc?e.get(d):null;return y&&y.evaluate?y.evaluate(i,s,c):y})}function xM(a,e){return e-a}Wt(Kw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Qw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const l=Qw[15&s];if(!l)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new vx(y,d,l,e)}constructor(e,i=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=Qw.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-y%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+y+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return xx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:y}=this,w=[0,l.length-1,0],A=[];for(;w.length;){const _=w.pop()||0,T=w.pop()||0,C=w.pop()||0;if(T-C<=y){for(let N=C;N<=T;N++){const V=d[2*N],Z=d[2*N+1];V>=e&&V<=s&&Z>=i&&Z<=c&&A.push(l[N])}continue}const E=C+T>>1,M=d[2*E],z=d[2*E+1];M>=e&&M<=s&&z>=i&&z<=c&&A.push(l[E]),(_===0?e<=M:i<=z)&&(w.push(C),w.push(E-1),w.push(1-_)),(_===0?s>=M:c>=z)&&(w.push(E+1),w.push(T),w.push(1-_))}return A}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:l,nodeSize:d}=this,y=[0,c.length-1,0],w=[],A=s*s;for(;y.length;){const _=y.pop()||0,T=y.pop()||0,C=y.pop()||0;if(T-C<=d){for(let N=C;N<=T;N++)t2(l[2*N],l[2*N+1],e,i)<=A&&w.push(c[N]);continue}const E=C+T>>1,M=l[2*E],z=l[2*E+1];t2(M,z,e,i)<=A&&w.push(c[E]),(_===0?e-s<=M:i-s<=z)&&(y.push(C),y.push(E-1),y.push(1-_)),(_===0?e+s>=M:i+s>=z)&&(y.push(E+1),y.push(T),y.push(1-_))}return w}}function xx(a,e,i,s,c,l){if(c-s<=i)return;const d=s+c>>1;e2(a,e,d,s,c,l),xx(a,e,i,s,d-1,1-l),xx(a,e,i,d+1,c,1-l)}function e2(a,e,i,s,c,l){for(;c>s;){if(c-s>600){const A=c-s+1,_=i-s+1,T=Math.log(A),C=.5*Math.exp(2*T/3),E=.5*Math.sqrt(T*C*(A-C)/A)*(_-A/2<0?-1:1);e2(a,e,i,Math.max(s,Math.floor(i-_*C/A+E)),Math.min(c,Math.floor(i+(A-_)*C/A+E)),l)}const d=e[2*i+l];let y=s,w=c;for(Pg(a,e,s,i),e[2*c+l]>d&&Pg(a,e,s,c);y<w;){for(Pg(a,e,y,w),y++,w--;e[2*y+l]<d;)y++;for(;e[2*w+l]>d;)w--}e[2*s+l]===d?Pg(a,e,s,w):(w++,Pg(a,e,w,c)),w<=i&&(s=w+1),i<=w&&(c=w-1)}}function Pg(a,e,i,s){bx(a,i,s),bx(e,2*i,2*s),bx(e,2*i+1,2*s+1)}function bx(a,e,i){const s=a[e];a[e]=a[i],a[i]=s}function t2(a,e,i,s){const c=a-i,l=e-s;return c*c+l*l}r.$=Va,r.A=Ya,r.B=Co,r.C=Zl,r.D=__,r.E=Vs,r.F=2,r.G=gg,r.H=lb,r.I=Ia,r.J=class extends xv{},r.K=Xo,r.L=bn,r.M=is,r.N=sp,r.O=Dc,r.P=Ft,r.Q=xm,r.R=Cr,r.S=Gd,r.T=J0,r.U=Ur,r.V=xv,r.W=Pu,r.X=Lc,r.Y=Iu,r.Z=oa,r._=Ua,r.a=function(a){return ie.API_CDN_URL_REGEX.test(a)},r.a$=k,r.a0=Wa,r.a1=Gh,r.a2=Zr,r.a3=Vd,r.a4=function(a){const e=a.value;let i=[];if(!e)return i;const s=Xo(e);return s!=="string"?(i=i.concat([new xv(a.key,e,`string expected, "${s}" found`)]),i):(Kb(e,!0)||(i=i.concat([new xv(a.key,e,`invalid url "${e}"`)])),i)},r.a5=$e,r.a6=Ul,r.a7=lr,r.a8=Pt,r.a9=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return dc(a.expression.evaluate(e))}interpolate(a,e,i){return{x:yi(a.x,e.x,i),y:yi(a.y,e.y,i),z:yi(a.z,e.z,i),azimuthal:yi(a.azimuthal,e.azimuthal,i),polar:yi(a.polar,e.polar,i)}}},r.aA=function(a,e){const i={};for(let s=0;s<e.length;s++){const c=e[s];c in a&&(i[c]=a[c])}return i},r.aB=Ga,r.aC=ss,r.aD=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,i,s){const c=this.entries[a]=this.entries[a]||{callbacks:[]};if(c.result){const[l,d]=c.result;return this.scheduler?this.scheduler.add(()=>{s(l,d)},e):s(l,d),()=>{}}return c.callbacks.push(s),c.cancel||(c.cancel=i((l,d)=>{c.result=[l,d];for(const y of c.callbacks)this.scheduler?this.scheduler.add(()=>{y(l,d)},e):y(l,d);setTimeout(()=>delete this.entries[a],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(l=>l!==s),c.callbacks.length||(c.cancel(),delete this.entries[a]))}}},r.aE=function(a,e,i){const s=JSON.stringify(a.request);return a.data&&(this.deduped.entries[s]={result:[null,a.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},c=>{const l=Mo(a.request,(d,y,w,A)=>{d?c(d):y&&c(null,{vectorTile:i?void 0:new Qc.VectorTile(new Qt(y)),rawData:y,cacheControl:w,expires:A})});return()=>{l.cancel(),c()}},e)},r.aF=function(a){Rn++,Rn>Ai&&(a.getActor().send("enforceCacheSizeLimit",zi),Rn=0)},r.aG=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},r.aH=gt,r.aI=Nb,r.aJ=Gb,r.aK=Bb,r.aL=function(a,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<a.length;s++){const c=document.createElement("source");ps(a[s])||(i.crossOrigin="Anonymous"),c.src=a[s],i.appendChild(c)}return{cancel:()=>{}}},r.aM=mv,r.aN=function(a){return fetch(a).then(e=>e.arrayBuffer()).then(e=>$w(e,0,a))},r.aO=Yw,r.aP=class{constructor(a,e,i,s){this.id=a,this.position=e!=null?new Tn(e[0],e[1]):new Tn(0,0),this.orientation=i??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new jt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,e){if(de.mat4.multiply(a.matrix,e,a.matrix),a.meshes)for(const i of a.meshes){const s=jt.applyTransformFast(i.aabb,a.matrix);this.aabb.encapsulate(s)}if(a.children)for(const i of a.children)this._applyTransformations(i,a.matrix)}computeBoundsAndApplyParent(){const a=de.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,a)}computeModelMatrix(a,e,i,s,c,l,d=!1){iw(this.matrix,this,a.transform,this.position,e,i,s,c,l,d)}upload(a){if(!this.uploaded){for(const e of this.nodes)nx(e,a);for(const e of this.nodes)bv(e);this.uploaded=!0}}destroy(){for(const a of this.nodes)rx(a)}},r.aQ=hc,r.aR=vg,r.aS=Ea,r.aT=Vn,r.aU=No,r.aV=ca,r.aW=or,r.aX=Gu,r.aY=fv,r.aZ=function(){za.isLoading()||za.isLoaded()||Vr()!=="deferred"||qh()},r.a_=Vc,r.aa=Ln,r.ab=kl,r.ac=t,r.ad=de,r.ae=bi,r.af=Fc,r.ag=$r,r.ah=yi,r.ai=Bt,r.aj=mc,r.ak=ln,r.al=Mn,r.am=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return function([i,s]){const c=dc([1,i,s]);return{x:c.x,y:c.y,z:c.z}}(a.expression.evaluate(e))}interpolate(a,e,i){return{x:yi(a.x,e.x,i),y:yi(a.y,e.y,i),z:yi(a.z,e.z,i)}}},r.an=function(a,e,i=0,s=!0){const c=new Ft(i,i),l=a.sub(c),d=e.add(c),y=[l,new Ft(d.x,l.y),d,new Ft(l.x,d.y)];return s&&y.push(l.clone()),y},r.ao=function(a,e){const i=[];for(let s=0;s<a.length;s++){const c=gi(s-1,-1,a.length-1),l=gi(s+1,-1,a.length-1),d=a[s],y=a[l],w=a[c].sub(d).unit(),A=y.sub(d).unit(),_=A.angleWithSep(w.x,w.y),T=w.add(A).unit().mult(-1*e/Math.sin(_/2));i.push(d.add(T))}return i},r.ap=Tb,r.aq=xe,r.ar=function(a,e,i=0){return de.vec3.fromValues(((e.x-i)*a.scale-a.x)*Bt,(e.y*a.scale-a.y)*Bt,vp(e.z,e.y))},r.as=Ci,r.at=r_,r.au=function(a){let e=1/0,i=1/0,s=-1/0,c=-1/0;for(const l of a)e=Math.min(e,l.x),i=Math.min(i,l.y),s=Math.max(s,l.x),c=Math.max(c,l.y);return{min:new Ft(e,i),max:new Ft(s,c)}},r.av=Sa,r.aw=ve,r.ax=u,r.ay=vt,r.az=La,r.b=function(a){return ie.API_FONTS_REGEX.test(a)},r.b$=yv,r.b0=w_,r.b1=so,r.b2=fg,r.b3=Tf,r.b4=P,r.b5=Bo,r.b6=hf,r.b7=xi,r.b8=On,r.b9=Wu,r.bA=ag,r.bB=j0,r.bC=_b,r.bD=_g,r.bE=vx,r.bF=gi,r.bG=fc,r.bH=Qr,r.bI=function(a,e,i){a[4*e+0]=i[0],a[4*e+1]=i[1],a[4*e+2]=i[2],a[4*e+3]=i[3]},r.bJ=Zu,r.bK=zs,r.bL=Js,r.bM=Tr,r.bN=Zc,r.bO=Tn,r.bP=Cb,r.bQ=et,r.bR=li,r.bS=Zb,r.bT=yt,r.bU=pa,r.bV=function(a,e,i,s,c,l,d,y,w){if(w.name==="globe")return pa(a,e,new yt(i,s,c),!1);const A=vg({z:i,x:s,y:c},w);return new jt([(l+A.x/A.scale)*e,e*(A.y/A.scale),d],[(l+A.x2/A.scale)*e,e*(A.y2/A.scale),y])},r.bW=function(a,e,i){let s=0;for(let c=0;c<2;++c)a[c]>0&&(s+=(a[c]-0)*(a[c]-0)),e[c]<0&&(s+=(0-e[c])*(0-e[c]));return s},r.bX=os,r.bY=gp,r.bZ=function(a){const e=de.mat4.identity(new Float64Array(16));de.mat4.multiply(e,a.pixelMatrix,a.globeMatrix);const i=[0,bs,0],s=[0,as,0];return de.vec3.transformMat4(i,i,e),de.vec3.transformMat4(s,s,e),[i[0]>0&&i[0]<=a.width&&i[1]>0&&i[1]<=a.height&&!ma(a,new Tn(a.center.lat,90)),s[0]>0&&s[0]<=a.width&&s[1]>0&&s[1]<=a.height&&!ma(a,new Tn(a.center.lat,-90))]},r.b_=function(a,e){const{scale:i}=a.tileTransform,s=i*Bt/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return de.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},r.ba=Y0,r.bb=function(a,e){const i=$r(e.zoom);if(i===0)return Pn(a);const s=Ki(a),c=Zn(s),l=Sa(s.getWest())*e.worldSize,d=Sa(s.getEast())*e.worldSize,y=ss(s.getNorth())*e.worldSize,w=ss(s.getSouth())*e.worldSize,A=[l,y,0],_=[d,y,0],T=[l,w,0],C=[d,w,0],E=de.mat4.invert([],e.globeMatrix);return de.vec3.transformMat4(A,A,E),de.vec3.transformMat4(_,_,E),de.vec3.transformMat4(T,T,E),de.vec3.transformMat4(C,C,E),c[0]=vr(c[0],T,i),c[1]=vr(c[1],C,i),c[2]=vr(c[2],_,i),c[3]=vr(c[3],A,i),jt.fromPoints(c)},r.bc=Qn,r.bd=mn,r.be=vr,r.bf=Uc,r.bg=Di,r.bh=Dv,r.bi=Qt,r.bj=Mo,r.bk=function(a,e){const i=[];for(const s in a)s in e||i.push(s);return i},r.bl=ri,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=Ss,r.bo=function(a,e){const{x:i,y:s}=a.point,c=xr(i,s,a.worldSize/a._pixelsPerMercatorPixel,0,0);return de.mat4.multiply(c,c,Dr(Pn(e)))},r.bp=ru,r.bq=dt,r.br=c_,r.bs=function(a,e,i,s,c){const l=5*e+2;a.float32[l+0]=i,a.float32[l+1]=s,a.float32[l+2]=c},r.bt=dv,r.bu=ob,r.bv=Q,r.bw=Xr,r.bx=Uy,r.by=Wb,r.bz=vo,r.c=ge,r.c$=iu,r.c0=Hb,r.c1=function(a){const e=Hb(a,!0);return de.mat2.invert([],[e[0],e[1],e[4],e[5]])},r.c2=on,r.c3=function(a){const{x:e,y:i}=a.point,{lng:s,lat:c}=a._center;return xr(e,i,a.worldSize,s,c)},r.c4=Br,r.c5=Vt,r.c6=Yc,r.c7=function(a){const e=Math.round((a+45+360)%360/90)%4;return Bs[e]},r.c8=45,r.c9=Qf,r.cA=mp,r.cB=class extends Ks{constructor(a){super(a),this.current=$u}set(a,e,i){if(this.fetchUniformLocation(a,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.cC=Es,r.cD=function(a,e,i){const s=$r(i.zoom),c=a.style.map._antialias,l=a.terrain&&a.terrain.exaggeration()>0;return s===0&&!c&&!l},r.cE=function(a){const e=a.pixelsPerMeter,i=e/Qr(1,a.center.lat),s=de.mat4.identity(new Float64Array(16));return de.mat4.translate(s,s,[a.point.x,a.point.y,0]),de.mat4.scale(s,s,[i,i,e]),Float32Array.from(s)},r.cF=Ki,r.cG=function(a){const e=os-5;a=vt(a,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(ln(a))),3);return Math.round(i*(Yu.length-1))},r.cH=function(a,e,i,s){const c=e.getNorth(),l=e.getSouth(),d=e.getWest(),y=e.getEast(),w=1<<a.z,A=y-d,_=c-l,T=A/ec,C=-_/Yu[i],E=[0,T,0,C,0,0,c,d,0];if(a.z>0){const M=180/s;de.mat3.multiply(E,E,[M/A+1,0,0,0,M/_+1,0,-.5*M/T,.5*M/C,1])}return E[2]=w,E[5]=a.x,E[8]=a.y,E},r.cI=Pn,r.cJ=function(a,e,i){const s=de.mat4.identity(new Float64Array(16)),c=(e/(1<<a)-.5)*Math.PI*2;return de.mat4.rotateY(s,i.globeMatrix,c),Float32Array.from(s)},r.cK=class{isDataAvailableAtPoint(a){const e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,c=Math.floor(a.x),l=Math.floor((a.x-c)*s),d=Math.floor(a.y*s),y=this.findDEMTileFor(new gt(i,c,i,l,d));return!(!y||!y.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||a.y<0||a.y>1)return e;const c=s.getSource().maxzoom,l=1<<c,d=Math.floor(a.x),y=a.x-d,w=new gt(c,d,c,Math.floor(y*l),Math.floor(a.y*l)),A=this.findDEMTileFor(w);if(!A||!A.dem)return e;const _=A.dem,T=1<<A.tileID.canonical.z,C=(y*T-A.tileID.canonical.x)*_.dim,E=(a.y*T-A.tileID.canonical.y)*_.dim,M=Math.floor(C),z=Math.floor(E);return(i?this.exaggeration():1)*yi(yi(_.get(M,z),_.get(M,z+1),E-z),yi(_.get(M+1,z),_.get(M+1,z+1),E-z),C-M)}getAtTileOffset(a,e,i){const s=1<<a.canonical.z;return this.getAtPointOrZero(new t(a.wrap+(a.canonical.x+e/Bt)/s,(a.canonical.y+i/Bt)/s))}getAtTileOffsetFunc(a,e,i,s){return c=>{const l=this.getAtTileOffset(a,c.x,c.y),d=s.upVector(a.canonical,c.x,c.y),y=s.upVectorScale(a.canonical,e,i).metersToTile;return de.vec3.scale(d,d,l*y),d}}getForTilePoints(a,e,i,s){if(this.isUsingMockSource())return!1;const c=m_.create(this,a,s);return!!c&&(e.forEach(l=>{l[2]=this.exaggeration()*c.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(a);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,c=1<<a.canonical.z-s.canonical.z;let l=a.canonical.x/c-s.canonical.x,d=a.canonical.y/c-s.canonical.y,y=0;for(let w=0;w<a.canonical.z-s.canonical.z&&!i.leaves[y];w++){l*=2,d*=2;const A=2*Math.floor(d)+Math.floor(l);y=i.childOffsets[y]+A,l%=1,d%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const c of a){const l=this.getMinMaxForTile(c.tileID);l&&(i=Math.min(i,l.min),s=Math.max(s,l.max),e=!0)}return e?{min:i,max:s}:null}},r.cL=Sy,r.cM=Hi,r.cN=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},r.cO=ta,r.cP=at,r.cQ=pc,r.cR=256,r.cS=function(a,e){const i=[0,0,0],s=Qn(Pn(e.canonical));return de.vec3.transformMat4(i,i,s),de.vec3.transformMat4(i,i,a),i},r.cT=a=>({u_camera_to_center_distance:new Tr(a),u_extrude_scale:new id(a),u_device_pixel_ratio:new Tr(a),u_matrix:new Zu(a),u_inv_rot_matrix:new Zu(a),u_merc_center:new zs(a),u_tile_id:new Js(a),u_zoom_transition:new Tr(a),u_up_dir:new Js(a),u_emissive_strength:new Tr(a)}),r.cU=a=>({u_matrix:new Zu(a),u_pixels_to_tile_units:new id(a),u_device_pixel_ratio:new Tr(a),u_width_scale:new Tr(a),u_floor_width_scale:new Tr(a),u_units_to_pixels:new zs(a),u_dash_image:new Zc(a),u_gradient_image:new Zc(a),u_image_height:new Tr(a),u_texsize:new zs(a),u_tile_units_to_pixels:new Tr(a),u_alpha_discard_threshold:new Tr(a),u_trim_offset:new zs(a),u_trim_fade_range:new zs(a),u_trim_color:new Jl(a),u_emissive_strength:new Tr(a),u_zbias_factor:new Tr(a),u_tile_to_meter:new Tr(a)}),r.cV=a=>({u_matrix:new Zu(a),u_texsize:new zs(a),u_pixels_to_tile_units:new id(a),u_device_pixel_ratio:new Tr(a),u_width_scale:new Tr(a),u_floor_width_scale:new Tr(a),u_image:new Zc(a),u_units_to_pixels:new zs(a),u_tile_units_to_pixels:new Tr(a),u_alpha_discard_threshold:new Tr(a),u_trim_offset:new zs(a),u_trim_fade_range:new zs(a),u_trim_color:new Jl(a),u_emissive_strength:new Tr(a),u_zbias_factor:new Tr(a),u_tile_to_meter:new Tr(a)}),r.cW=Wh,r.cX=tv,r.cY=o,r.cZ=nc,r.c_=(a,e,i,s,c,l)=>{const d=a.transform,y=d.projection.name==="globe";let w;if(l.paint.get("circle-pitch-alignment")==="map")if(y){const _=ta(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;w=Float32Array.from([_,0,0,_])}else w=d.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(d.projection),u_matrix:a.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:rt.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:Wc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(y){A.u_inv_rot_matrix=s,A.u_merc_center=c,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=$r(d.zoom);const _=c[0]*Bt,T=c[1]*Bt;A.u_up_dir=d.projection.upVector(new yt(0,0,0),_,T)}return A},r.ca=rd,r.cb=Jl,r.cc=function(a,e,i){const s=Math.sqrt(a*a+e*e+i*i),c=s>0?Math.acos(i/s)*qr:0;let l=a!==0||e!==0?Math.atan2(-e,-a)*qr+90:0;return l<0&&(l+=360),[s,l,c]},r.cd=h,r.ce=jt,r.cf=dc,r.cg=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},r.ch=function(a,e){return a.readFields(gA,{icons:[]},e)},r.ci=function(a){return a({pluginStatus:Da,pluginURL:Po}),ir.on("pluginStateChange",a),a},r.cj=Tv,r.ck=h_,r.cl=V0,r.cm=vl,r.cn=Xs,r.co=Ht,r.cp=gs,r.cq=Wr,r.cr=function(a){const e=a.indexOf($h);return e>=0?a.slice(0,e):a},r.cs=function(a){return a.indexOf($h)>=0},r.ct=function(a){const e=a.indexOf($h);return e>=0?a.slice(e+1):""},r.cu=function(a){const e=[],i=a.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cv=function(a,e,i,s){return a.type==="custom"?new nA(a,e):new pA[a.type](a,e,i,s)},r.cw=ds,r.cx=class extends w_{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},r.cy=ir,r.cz=Fs,r.d=function(a){return ie.API_TILEJSON_REGEX.test(a)},r.d$=Ww,r.d0=Ra,r.d1=(a,e,i,s,c,l,d,y)=>{const w=a.transform,A=w.pitch<15?pg(.07,.7,vt((14-w.zoom)/5,0,1)):.07,_=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:tu(a,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:l,u_floor_width_scale:d,u_image:0,u_tile_units_to_pixels:a_(e,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(_?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:h(e.tileID.canonical,0)}},r.d2=(a,e,i,s,c,l,d,y,w)=>{const A=a.transform,_=A.calculatePixelsToTileUnitsMatrix(e),T=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",C=A.pitch<15?pg(.07,.7,vt((14-A.zoom)/5,0,1)):.07;return{u_matrix:tu(a,e,i,s),u_pixels_to_tile_units:_,u_device_pixel_ratio:l,u_width_scale:d,u_floor_width_scale:y,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:nu(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:a_(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(T?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:C,u_tile_to_meter:h(e.tileID.canonical,0)}},r.d3=Gr,r.d4=wp,r.d5=vp,r.d6=dg,r.d7=Ut,r.d8=Rp,r.d9=th,r.dA=Sf,r.dB=Qe,r.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.dD=Mt,r.dE=ic,r.dF=hl,r.dG=function([a,e,i]){const s=Math.hypot(a,e,i),c=Math.atan2(a,i),l=.5*Math.PI-Math.acos(-e/s);return new Tn(Br(c),Br(l))},r.dH=ex,r.dI=function(a){const e=a.navigator?a.navigator.userAgent:null;return!!function(i){if(fh==null){const s=i.navigator?i.navigator.userAgent:null;fh=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return fh}(a)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dJ=function(a,e){zi=a,Ai=e},r.dK=ma,r.dL=Oa,r.dM=function(a){const e=[0,0,0],i=de.mat4.identity(new Float64Array(16));return de.mat4.multiply(i,a.pixelMatrix,a.globeMatrix),de.vec3.transformMat4(e,e,i),new Ft(e[0],e[1])},r.dN=function(a,e,i=!1){if(Da===Xd||Da===ts||Da===Bu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Po=rt.resolveURL(a),Da=Xd,Yd=e,Bn(),i||qh()},r.dO=Vr,r.dP=function(){Tv().acquire(sx)},r.dQ=function(){const a=Mg;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(sx),Mg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dR=qp,r.dS=function(a){const e=Jn();if(!e)return;const i=e.delete(Yt);a&&i.catch(a).then(()=>a())},r.dT=Ag,r.dU=Vw,r.dV=function(a){mx=rt.resolveURL(a),b_||(b_=new __(Tv(),new Vs)),b_.broadcast("setDracoUrl",mx)},r.dW=Uw,r.dX=function(a){x_=rt.resolveURL(a),b_||(b_=new __(Tv(),new Vs)),b_.broadcast("setMeshoptUrl",x_)},r.dY=Wt,r.dZ=rc,r.d_=su,r.da=450,r.db=7,r.dc=iA,r.dd=wn,r.de=ju,r.df=256,r.dg=Dr,r.dh=xs,r.di=rs,r.dj=Kh,r.dk=function(a,e,i,s,c){return vt((a-e)/(i-e)*(c-s)+s,s,c)},r.dl=fo,r.dm=Qs,r.dn=class{constructor(a,e,i,s){this.context=a,this.format=s,this.size=i,this.texture=a.gl.createTexture();const[c,l,d]=this.size,{gl:y}=a;y.bindTexture(y.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),y.texImage3D(y.TEXTURE_3D,0,this.format,c,l,d,0,W0(this.format),K0(this.format),e.data)}bind(a,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),a!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,a),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},r.dp=tx,r.dq=[1,1,1],r.dr=m_,r.ds=p_,r.dt=Fo,r.du=qc,r.dv=tc,r.dw=uf,r.dx=Jh,r.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ft(1/0,1/0),max:new Ft(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){const i=Km(new Ft(0,0),new Ft(Bt,Bt),a),s=[];if(e&&!ng(i,this._globalClipBounds))return s;for(const c of this._activeRegions){if(c.hiddenByOverlap||!ng(i,c))continue;const l=jy(c.min,c.max,a);s.push({min:l.min,max:l.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return s}setSources(a){this._setSources(a.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(s).buckets[e.layer];c&&c.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(a){const e=a.getFootprints();if(e.length===0)return;const i=a.getOrder(),s=a.getClipMask(),c=a.getClipScope();for(const l of e){if(!l.footprint)continue;const d=Km(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:i,clipMask:s,clipScope:c})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Ym(e.min,i.min)||Ym(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(s,c){const l=(d,y)=>d+y;return s.length-c.length||s.reduce(l,"").localeCompare(c.reduce(l,""))}(e.clipScope,i.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];a=i.priority!==s.priority||!Wm(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!Ss(i.clipScope,s.clipScope),++e}}if(a){++this._updateTime;for(const i of this._activeRegions)i.order!==Sf&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const c=s[i].priority;for(;i<s.length&&s[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let c=i;const l=i;for(;c!==s;){const d=this._activeRegions[c];d.hiddenByOverlap=!1;for(let y=0;y<l;y++){const w=this._activeRegions[y];if(!w.hiddenByOverlap&&d.order===Sf&&ng(d,w)&&(d.hiddenByOverlap=Ef(d.footprint,d.tileId,w.footprint,w.tileId),d.hiddenByOverlap))break}++c}i=s,s=e(i)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},r.dz=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){const i=new Bo,s=new ca,c=[],l=a+1+2,d=e[0]+1,y=e[0]+1+(1+e.length),w=(A,_,T)=>{let C=A===l-1?A-2:A===0?A:A-1;return C+=T?24575:0,[C,_]};for(let A=0;A<l;++A)i.emplaceBack(...w(A,0,!0));for(let A=0;A<d;++A)for(let _=0;_<l;++_)i.emplaceBack(...w(_,A,(_===0||_===l-1)&&!0));for(let A=0;A<e.length;++A){const _=e[A];for(let T=0;T<l;++T)i.emplaceBack(...w(T,_,!0))}for(let A=0;A<e.length;++A){const _=s.length,T=e[A]+1+2,C=new ca;for(let z=0;z<T-1;z++){const N=z===T-2,V=N?l*(y-e.length+A-z):l;for(let Z=0;Z<l-1;Z++){const H=z*l+Z;z===0||N||Z===0||Z===l-2?(C.emplaceBack(H+1,H,H+V),C.emplaceBack(H+V,H+V+1,H+1)):(s.emplaceBack(H+1,H,H+V),s.emplaceBack(H+V,H+V+1,H+1))}}const E=On.simpleSegment(0,_,i.length,s.length-_);for(let z=0;z<C.uint16.length;z+=3)s.emplaceBack(C.uint16[z],C.uint16[z+1],C.uint16[z+2]);const M=On.simpleSegment(0,_,i.length,s.length-_);c.push({withoutSkirts:E,withSkirts:M})}return{vertices:i,indices:s,segments:c}}_createGrid(a){const e=this._fillGridMeshWithLods(ec,Yu);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,xi.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){const e=new ca;for(let d=0;d<=ec;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);const i=new rs,s=new rs,c=new rs,l=new rs;this._poleSegments=[];for(let d=0,y=0;d<Yc;d++){const w=360/(1<<d);i.emplaceBack(0,-La,0,.5,0),s.emplaceBack(0,-La,0,.5,1),c.emplaceBack(0,-La,0,.5,.5),l.emplaceBack(0,-La,0,.5,.5);for(let A=0;A<=ec;A++){let _=A/ec,T=0;const C=yi(0,w,_),[E,M,z]=ul(eo,jo,C,La);i.emplaceBack(E,M,z,_,T),s.emplaceBack(E,M,z,_,1-T);const N=ln(C);_=.5+.5*Math.sin(N),T=.5+.5*Math.cos(N),c.emplaceBack(E,M,z,_,T),l.emplaceBack(E,M,z,_,1-T)}this._poleSegments.push(On.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(i,oi,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(s,oi,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(c,oi,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(l,oi,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},r.e=ie,r.e0=Kw,r.e1=t_,r.e2=Un,r.e3="hd_road_elevation",r.e4=class{static parseFrom(a,e){const i=go.parse(a);if(!i)return[];let{vertices:s,features:c}=i;const l=1/h(e);c.sort((A,_)=>A.id-_.id),s.sort((A,_)=>A.id-_.id||A.idx-_.idx),s=s.filter((A,_,T)=>_===T.findIndex(C=>C.id===A.id&&C.idx===A.idx));const d=new Array;let y=0;const w=s.length;for(const A of c){if(A.constantHeight){d.push(new bf(A.id,A.bounds,A.constantHeight));continue}for(;y!==w&&s[y].id<A.id;)y++;if(y===w||s[y].id!==A.id)continue;const _=new Array,T=new Array,C=y;for(;y!==w&&s[y].id===A.id;){const E=s[y];if(_.push({position:E.position,height:E.height,extent:E.extent}),y!==C&&s[y-1].idx===E.idx-1){const M=y-C;T.push({a:M-1,b:M})}y++}d.push(new bf(A.id,A.bounds,void 0,_,T,l))}return d}},r.e5=hs,r.e6=ld,r.e7=cb,r.e8=u_,r.e9=function(a,e,i,s,c,l,d,y=1,w){a.createArrays(),a.tilePixelRatio=Bt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const A=a.layers[0].layout,_=a.layers[0]._unevaluatedLayout._values,T={};T.scaleFactor=y,T.textSizeScaleRange=A.get("text-size-scale-range"),T.iconSizeScaleRange=A.get("icon-size-scale-range");const[C,E]=T.textSizeScaleRange,[M,z]=T.iconSizeScaleRange;T.textScaleFactor=vt(T.scaleFactor,C,E),T.iconScaleFactor=vt(T.scaleFactor,M,z);const N=_["text-size"],V=_["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:ee,maxZoom:he}=a.textSizeData;T.compositeTextSizes=[N.possiblyEvaluate(new Ln(ee),l),N.possiblyEvaluate(new Ln(he),l)]}if(a.iconSizeData.kind==="composite"){const{minZoom:ee,maxZoom:he}=a.iconSizeData;T.compositeIconSizes=[V.possiblyEvaluate(new Ln(ee),l),V.possiblyEvaluate(new Ln(he),l)]}T.layoutTextSize=N.possiblyEvaluate(new Ln(d+1),l),T.layoutIconSize=V.possiblyEvaluate(new Ln(d+1),l),T.textMaxSize=N.possiblyEvaluate(new Ln(18),l);const Z=A.get("symbol-placement"),H=A.get("text-rotation-alignment")==="map"&&Z!=="point",q=A.get("text-size");let Y=!1;const K=[];for(const ee of a.features){const he=A.get("text-font").evaluate(ee,{},l).join(","),le=q.evaluate(ee,{},l)*T.textScaleFactor,ue=T.layoutTextSize.evaluate(ee,{},l)*T.textScaleFactor,Te=T.layoutIconSize.evaluate(ee,{},l)*T.iconScaleFactor,pe={horizontal:{},vertical:void 0},Ee=ee.text;let De,Re=[0,0];if(Ee){const St=Ee.toString(),wi=A.get("text-letter-spacing").evaluate(ee,{},l)*Xr,Xt=A.get("text-line-height").evaluate(ee,{},l)*Xr,ci=Nl(St)?wi:0,Li=A.get("text-anchor").evaluate(ee,{},l),Wi=A.get("text-variable-anchor");if(!Wi){const Cn=A.get("text-radial-offset").evaluate(ee,{},l);Re=Cn?_b(Li,[Cn*Xr,U0]):A.get("text-offset").evaluate(ee,{},l).map(er=>er*Xr)}let ki=H?"center":A.get("text-justify").evaluate(ee,{},l);const an=Z==="point",Yi=an?A.get("text-max-width").evaluate(ee,{},l)*Xr:1/0,un=Cn=>{a.allowVerticalPlacement&&Uh(St)&&(pe.vertical=$t(Ee,e,i,c,he,Yi,Xt,Li,Cn,ci,Re,dt.vertical,!0,ue,le,w))};if(!H&&Wi){const Cn=ki==="auto"?Wi.map(Oi=>j0(Oi)):[ki];let er=!1;for(let Oi=0;Oi<Cn.length;Oi++){const _n=Cn[Oi];if(!pe.horizontal[_n])if(er)pe.horizontal[_n]=pe.horizontal[0];else{const ur=$t(Ee,e,i,c,he,Yi,Xt,"center",_n,ci,Re,dt.horizontal,!1,ue,le,w);ur&&(pe.horizontal[_n]=ur,er=ur.positionedLines.length===1)}}un("left")}else{if(ki==="auto"&&(ki=j0(Li)),an||A.get("text-writing-mode").indexOf("horizontal")>=0||!Uh(St)){const Cn=$t(Ee,e,i,c,he,Yi,Xt,Li,ki,ci,Re,dt.horizontal,!1,ue,le,w);Cn&&(pe.horizontal[ki]=Cn)}un(an?"left":ki)}}let ke,Pe,Ze,Ue,Xe,bt=!1;if(ee.icon&&ee.icon.hasPrimary()){const St=yb(ee.icon,a.iconSizeData,_["icon-size"],l,a.zoom,ee,w,T.iconScaleFactor);ke=St.iconPrimary,Pe=St.iconSecondary;const wi=ke.toString(),Xt=s.get(wi);Xt&&(Ze=A.get("icon-offset").evaluate(ee,{},l),Ue=A.get("icon-anchor").evaluate(ee,{},l),Xe=A.get("icon-text-fit").evaluate(ee,{},l),De=OE(c.get(wi),Pe?c.get(Pe.toString()):void 0,Ze,Ue),bt=Xt.sdf,a.sdfIcons===void 0?a.sdfIcons=Xt.sdf:a.sdfIcons!==Xt.sdf&&Kn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xt.pixelRatio!==a.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}Y=Y||!(!ee.icon||!ee.icon.hasSecondary());const xt=q0(pe.horizontal)||pe.vertical;a.iconsInText||(a.iconsInText=!!xt&&xt.iconsInText);const ei=ue*T.textScaleFactor/Xr,{defaultShapedIcon:zt,verticallyShapedIcon:Nt}=jE(a,De,A,ee,l,pe,ei,Ze,Xe);De=zt,K.push({feature:ee,shapedTextOrientations:pe,shapedText:xt,shapedIcon:De,iconPrimary:ke,iconSecondary:Pe,iconOffset:Ze,iconAnchor:Ue,verticallyShapedIcon:Nt,layoutTextSize:ue,layoutIconSize:Te,textOffset:Re,isSDFIcon:bt,iconTextFit:Xe})}return{featureData:K,sizes:T,hasAnySecondaryIcon:Y,textAlongLine:H,symbolPlacement:Z}},r.ea=ub,r.eb=function(a,e,i,s,c,l,d,y,w,A){const{featureData:_,hasAnySecondaryIcon:T,sizes:C,textAlongLine:E,symbolPlacement:M}=e;for(const z of _){const{shapedIcon:N,verticallyShapedIcon:V,feature:Z,shapedTextOrientations:H,shapedText:q,layoutTextSize:Y,textOffset:K,isSDFIcon:ee,iconPrimary:he,iconSecondary:le,iconTextFit:ue,iconOffset:Te}=z;vb(N,A.iconPositions,he,le),vb(V,A.iconPositions,he,le),UE(H,A.iconPositions),(q||N)&&qE(a,Z,H,N,V,w,C,Y,0,K,ee,s,c,d,y,T,ue,Te,E,M)}i&&a.generateCollisionDebugBuffers(l,a.collisionBoxArray,C.textScaleFactor)},r.ec=Qc,r.ed=Rv,r.ee=ks,r.ef=Oy,r.eg=Zt,r.eh=re,r.ei=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==qw){const i=new Uint32Array(a,0,7),[,,s,c,l,d]=i;e=i.byteLength+c+l+d+l,(s!==a.byteLength||e>=a.byteLength)&&Kn("Invalid b3dm header information.")}return $w(a,e)},r.ej=function(a,e){const i=Yw(a);for(const s of i){for(const c of s.meshes)gM(c);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(yM(s.lights,e)))}return i},r.ek=wv,r.el=lw,r.em=za,r.en=function(a){rn(),$i!=null&&$i.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-a;s++)e.delete(i[s])})})},r.f=function(a){return a.indexOf("mapbox:")===0},r.g=function(a,e){return Fs(vi(a,{method:"GET"}),e)},r.h=ae,r.i=function(a){return ie.API_STYLE_REGEX.test(a)&&!ge(a)},r.j=function(a){return decodeURIComponent(atob(a).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.l=vi,r.m=Dn,r.n=function(a,e){return Fs(vi(a,{type:"json"}),e)},r.o=Ad,r.p=function(a,e){return Fs(vi(a,{method:"POST"}),e)},r.q=rt,r.r=ua,r.s=function(a){try{const e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=lt,r.u=function(){return function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},r.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},r.w=Kn,r.x=function(){return ox||(ox=new qp),ox},r.y=hx,r.z=oo}),F(["./shared"],function(r){function re(at){const ie=at?at.url.toString():void 0;return ie?performance.getEntriesByName(ie):[]}function J(at){if(typeof at=="number"||typeof at=="boolean"||typeof at=="string"||at==null)return JSON.stringify(at);if(Array.isArray(at)){let ae="[";for(const ge of at)ae+=`${J(ge)},`;return`${ae}]`}let ie="{";for(const ae of Object.keys(at).sort())ie+=`${ae}:${J(at[ae])},`;return`${ie}}`}function oe(at){let ie="";for(const ae of r.bm)(at.type!=="model"||ae!=="minzoom"&&ae!=="maxzoom")&&(ie+=`/${J(at[ae])}`);return ie}class ze{constructor(ie){this.keyCache={},this._layers={},this._layerConfigs={},ie&&this.replace(ie)}replace(ie,ae){this._layerConfigs={},this._layers={},this.update(ie,[],ae)}update(ie,ae,ge){this._options=ge;for(const Me of ie)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=r.cv(Me,this.scope,null,this._options)).compileFilter(ge),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of ae)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const Ae=function(Me,Oe){const Je={};for(let it=0;it<Me.length;it++){const lt=Me[it];let rt=Oe&&Oe[lt.id];!rt&&(rt=oe(lt),lt.type==="line"&&lt.paint)&&function Ht(Yt){return typeof Yt=="string"&&Yt==="line-progress"||(Array.isArray(Yt)?Yt.some(Ht):!(!Yt||typeof Yt!="object")&&Object.values(Yt).some(Ht))}(lt.paint["line-width"])&&(rt+=`/${J(lt.paint["line-width"])}`),Oe&&(Oe[lt.id]=rt);let Dt=Je[rt];Dt||(Dt=Je[rt]=[]),Dt.push(lt)}const Be=[];for(const it in Je)Be.push(Je[it]);return Be}(Object.values(this._layerConfigs),this.keyCache);for(const Me of Ae){const Oe=Me.map(Dt=>this._layers[Dt.id]),Je=Oe[0];if(Je.visibility==="none")continue;const Be=Je.source||"";let it=this.familiesBySource[Be];it||(it=this.familiesBySource[Be]={});const lt=Je.sourceLayer||"_geojsonTileLayer";let rt=it[lt];rt||(rt=it[lt]=[]),rt.push(Oe)}}}const je=1*r.d_;class ft{constructor(ie){const ae={},ge=[];for(const Je in ie){const Be=ie[Je],it=ae[Je]={};for(const lt in Be.glyphs){const rt=Be.glyphs[+lt];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Dt=rt.metrics.localGlyph?je:1,Ht={x:0,y:0,w:rt.bitmap.width+2*Dt,h:rt.bitmap.height+2*Dt};ge.push(Ht),it[lt]=Ht}}const{w:Ae,h:Me}=r.H(ge),Oe=new r.dZ({width:Ae||1,height:Me||1});for(const Je in ie){const Be=ie[Je];for(const it in Be.glyphs){const lt=Be.glyphs[+it];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const rt=ae[Je][it],Dt=lt.metrics.localGlyph?je:1;r.dZ.copy(lt.bitmap,Oe,{x:0,y:0},{x:rt.x+Dt,y:rt.y+Dt},lt.bitmap)}}this.image=Oe,this.positions=ae}}r.dY(ft,"GlyphAtlas");class Le{constructor(ie){this.tileID=new r.aH(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.lut=ie.lut,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.scope=ie.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.request&&ie.request.collectResourceTiming,this.promoteId=ie.promoteId,this.isSymbolTile=ie.isSymbolTile,this.tileTransform=r.aR(ie.tileID.canonical,ie.projection),this.projection=ie.projection,this.worldview=ie.worldview,this.localizableLayerIds=ie.localizableLayerIds,this.brightness=ie.brightness,this.extraShadowCaster=!!ie.extraShadowCaster,this.tessellationStep=ie.tessellationStep,this.scaleFactor=ie.scaleFactor}parse(ie,ae,ge,Ae,Me){this.status="parsing",this.data=ie,this.collisionBoxArray=new r.aX;const Oe=new r.d$(Object.keys(ie.layers).sort()),Je=new r.e0(this.tileID,this.promoteId);Je.bucketLayerIDs=[];const Be={},it=new r.e1(256,256),lt={featureIndex:Je,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:it,availableImages:ge,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},rt=ae.familiesBySource[this.source];for(const rn in rt){const Rn=ie.layers[rn];if(!Rn)continue;let Dn=!1,kn=!1,fr=!1;for(const Ca of rt[rn])Ca[0].type==="symbol"?Dn=!0:kn=!0,Ca[0].is3D()&&Ca[0].type!=="model"&&(fr=!0);if(this.extraShadowCaster&&!fr||this.isSymbolTile===!0&&!Dn||this.isSymbolTile===!1&&!kn)continue;Rn.version===1&&r.w(`Vector tile source "${this.source}" layer "${rn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Nr=Oe.encode(rn),Mr=[];let fs=!1;for(let Ca=0,Cr=0;Ca<Rn.length;Ca++){const Kr=Rn.feature(Ca),vl=Je.getId(Kr,rn);if(this.localizableLayerIds&&this.localizableLayerIds.has(rn)){const Fs=Kr.properties?Kr.properties.worldview:null;if(this.worldview&&typeof Fs=="string")if(Fs==="all")Kr.properties.$localized=!0;else{if(!Fs.split(",").includes(this.worldview))continue;Kr.properties.$localized=!0,Kr.properties.worldview=this.worldview}}!fs&&Kr.properties&&Kr.properties.hasOwnProperty(r.e2)&&(fs=!0),Mr.push({feature:Kr,id:vl,index:Cr,sourceLayerIndex:Nr}),Cr++}fs&&!lt.elevationFeatures&&ie.layers.hasOwnProperty(r.e3)&&(lt.elevationFeatures=r.e4.parseFrom(ie.layers[r.e3],this.canonical));for(const Ca of rt[rn]){const Cr=Ca[0];(!this.extraShadowCaster||Cr.is3D()&&Cr.type!=="model")&&(this.isSymbolTile!==void 0&&Cr.type==="symbol"!==this.isSymbolTile||Cr.minzoom&&this.zoom<Math.floor(Cr.minzoom)||Cr.maxzoom&&this.zoom>=Cr.maxzoom||Cr.visibility!=="none"&&(Fe(Ca,this.zoom,lt.brightness,ge),(Be[Cr.id]=Cr.createBucket({index:Je.bucketLayerIDs.length,layers:Ca,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Nr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Mr,lt,this.tileID.canonical,this.tileTransform),Je.bucketLayerIDs.push(Ca.map(Kr=>r.C(Kr.id,Kr.scope)))))}}let Dt,Ht,Yt,zi,Ai,qi;it.trim();const $i={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Fn=()=>{if(Dt)return this.status="done",Me(Dt);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:Object.values(Be).filter(rn=>!rn.isEmpty()),featureIndex:Je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:lt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ht&&Yt&&zi){const rn=new ft(Ht),Rn=new Map;for(const[fr,Nr]of Yt.entries()){const{imagePosition:Mr}=r.e7(fr,Nr,r.e8);Rn.set(fr,Mr)}const Dn={};for(const fr in Be){const Nr=Be[fr];Nr instanceof r.aY&&(Fe(Nr.layers,this.zoom,lt.brightness,ge),Dn[fr]=r.e9(Nr,Ht,rn.positions,Yt,Rn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const kn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ae,Yt,Ai,()=>{kn.iconsPending=!1,Jn(Dn,rn,kn)}),this.rasterizeIfNeeded(Ae,zi,qi,()=>{kn.patternsPending=!1,Jn(Dn,rn,kn)})}},Jn=(rn,Rn,Dn,kn)=>{if(Dn.iconsPending||Dn.patternsPending)return;const fr=new r.ea(Yt,zi,this.lut);for(const Nr in Be){const Mr=Be[Nr];if(Nr in rn)r.eb(Mr,rn[Nr],this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Yt,fr);else if(Mr.hasPattern&&(Mr instanceof r.b2||Mr instanceof r.b3||Mr instanceof r.d8)){Fe(Mr.layers,this.zoom,lt.brightness,ge);const fs=Object.fromEntries(fr.patternPositions);Mr.addFeatures(lt,this.tileID.canonical,fs,ge,this.tileTransform,this.brightness)}}this.status="done",Me(null,{buckets:Object.values(Be).filter(Nr=>!Nr.isEmpty()),featureIndex:Je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rn.image,lineAtlas:it,imageAtlas:fr,brightness:lt.brightness})};if(!this.extraShadowCaster){const rn=r.e5(lt.glyphDependencies,kn=>Object.keys(kn).map(Number));Object.keys(rn).length?Ae.send("getGlyphs",{uid:this.uid,stacks:rn,scope:this.scope},(kn,fr)=>{Dt||(Dt=kn,Ht=fr,Fn())},void 0,!1,$i):Ht={};const Rn=Array.from(lt.iconDependencies.keys()).map(kn=>r.I.parse(kn));Rn.length?Ae.send("getImages",{images:Rn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(kn,fr)=>{Dt||(Dt=kn,Yt=new Map,Ai=this.updateImageMapAndGetImageTaskQueue(Yt,fr,lt.iconDependencies),Fn())},void 0,!1,$i):(Yt=new Map,Ai=new Map);const Dn=Array.from(lt.patternDependencies.keys()).map(kn=>r.I.parse(kn));Dn.length?Ae.send("getImages",{images:Dn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(kn,fr)=>{Dt||(Dt=kn,zi=new Map,qi=this.updateImageMapAndGetImageTaskQueue(zi,fr,lt.patternDependencies),Fn())},void 0,!1,$i):(zi=new Map,qi=new Map)}if(lt.elevationFeatures&&lt.elevationFeatures.length>0){const rn=[];for(const Dn of Object.values(Be))if(Dn instanceof r.b3){const kn=Dn.getUnevaluatedPortalGraph();kn&&rn.push(kn)}const Rn=r.e6.evaluate(rn);for(const Dn of Object.values(Be))Dn instanceof r.b3&&Dn.setEvaluatedPortalGraph(Rn)}Fn()}rasterizeIfNeeded(ie,ae,ge,Ae){Array.from(ae.values()).some(Me=>Me.usvg)?this.rasterize(ie,ae,ge,Ae):Ae()}updateImageMapAndGetImageTaskQueue(ie,ae,ge){const Ae=new Map;for(const Me of ae.keys()){const Oe=ge.get(Me)||[];for(const Je of Oe){const Be=Je.toString(),it=ae.get(Je.id.toString());it.usvg?Ae.has(Be)||(Ae.set(Be,Je),ie.set(Be,Object.assign({},it))):ie.set(Be,it)}}return Ae}rasterize(ie,ae,ge,Ae){this.rasterizeTask=ie.send("rasterizeImages",{scope:this.scope,tasks:ge},(Me,Oe)=>{if(!Me)for(const[Je,Be]of Oe.entries()){const it=Object.assign(ae.get(Je),{data:Be});ae.set(Je,it)}Ae()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Fe(at,ie,ae,ge){const Ae=new r.aa(ie,{brightness:ae});for(const Me of at)Me.recalculate(Ae,ge)}class qe extends r.E{constructor(ie,ae,ge,Ae,Me,Oe){super(),this.actor=ie,this.layerIndex=ae,this.availableImages=ge,this.loadVectorData=Me||r.aE,this.loading={},this.loaded={},this.deduped=new r.aD(ie.scheduler),this.isSpriteLoaded=Ae,this.scheduler=ie.scheduler,this.brightness=Oe}loadTile(ie,ae){const ge=ie.uid,Ae=ie&&ie.request,Me=Ae&&Ae.collectResourceTiming,Oe=this.loading[ge]=new Le(ie);Oe.abort=this.loadVectorData(ie,(Je,Be)=>{const it=!this.loading[ge];if(delete this.loading[ge],Oe.cancelRasterize(),it||Je||!Be)return Oe.status="done",it||(this.loaded[ge]=Oe),ae(Je);const lt=Be.rawData,rt={};Be.expires&&(rt.expires=Be.expires),Be.cacheControl&&(rt.cacheControl=Be.cacheControl),Oe.vectorTile=Be.vectorTile||new r.ec.VectorTile(new r.bi(lt));const Dt=()=>{Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ht,Yt)=>{if(Ht||!Yt)return ae(Ht);const zi={};if(Me){const Ai=re(Ae);Ai.length>0&&(zi.resourceTiming=JSON.parse(JSON.stringify(Ai)))}ae(null,r.l({rawTileData:lt.slice(0)},Yt,rt,zi))})};this.isSpriteLoaded?Dt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Dt,{type:"parseTile",isSymbolTile:ie.isSymbolTile,zoom:ie.tileZoom}):Dt()}),this.loaded=this.loaded||{},this.loaded[ge]=Oe})}reloadTile(ie,ae){const ge=this.loaded,Ae=ie.uid;if(ge&&ge[Ae]){const Me=ge[Ae];Me.scaleFactor=ie.scaleFactor,Me.showCollisionBoxes=ie.showCollisionBoxes,Me.projection=ie.projection,Me.brightness=ie.brightness,Me.tileTransform=r.aR(ie.tileID.canonical,ie.projection),Me.extraShadowCaster=ie.extraShadowCaster,Me.lut=ie.lut;const Oe=(Je,Be)=>{const it=Me.reloadCallback;it&&(delete Me.reloadCallback,Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,it)),ae(Je,Be)};Me.status==="parsing"?Me.reloadCallback=Oe:Me.status==="done"&&(Me.vectorTile?Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,Oe):Oe())}else ae(null,void 0)}abortTile(ie,ae){const ge=ie.uid,Ae=this.loading[ge];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[ge]),ae()}removeTile(ie,ae){const ge=this.loaded,Ae=ie.uid;ge&&ge[Ae]&&delete ge[Ae],ae()}}class He{loadTile(ie,ae){const{uid:ge,encoding:Ae,rawImageData:Me,padding:Oe}=ie,Je=ImageBitmap&&Me instanceof ImageBitmap?this.getImageData(Me,Oe):Me;ae(null,new r.ed(ge,Je,Ae,Oe<1))}reloadTile(ie,ae){ae(null,null)}abortTile(ie,ae){ae()}removeTile(ie,ae){ae()}getImageData(ie,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ie.width,ie.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ie.width,this.offscreenCanvas.height=ie.height,this.offscreenCanvasContext.drawImage(ie,0,0,ie.width,ie.height);const ge=this.offscreenCanvasContext.getImageData(-ae,-ae,ie.width+2*ae,ie.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}r.bh.setPbf(r.bi);class tt{constructor(ie){this._mrt=new r.bh(ie.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ie.uid,this.tileID=ie.tileID,this.source=ie.source}parse(ie,ae){const ge=this._mrt;this.status="parsing",this._entireBuffer=ie;try{ge.parseHeader(ie),this._isHeaderLoaded=!0;const Ae=[];for(const Me in ge.layers){const Oe=ge.getLayer(Me),Je=Oe.getDataRange(Oe.getBandList()),Be=ge.createDecodingTask(Je),it=ie.slice(Je.firstByte,Je.lastByte+1),lt=r.bh.performDecoding(it,Be).then(rt=>Be.complete(null,rt)).catch(rt=>Be.complete(rt,null));Ae.push(lt)}Promise.allSettled(Ae).then(()=>ae(null,ge))}catch(Ae){ae(Ae)}}}class mt{constructor(ie){this.actor=ie,this.loading={},this.loaded={}}loadTile(ie,ae){const ge=ie.uid,Ae=ie.request,Me=this.loading[ge]=new tt(ie),{cancel:Oe}=r.bj(Ae,(Je,Be,it,lt)=>{const rt=!this.loading[ge];if(delete this.loading[ge],rt||Je||!Be)return Me.status="done",rt||(this.loaded[ge]=Me),ae(Je);Me.parse(Be,(Dt,Ht)=>{if(Dt||!Ht)return ae(Dt);ae(null,Ht,it,lt)}),this.loaded[ge]=Me});Me.abort=Oe}reloadTile(ie,ae){ae(null,void 0)}abortTile(ie,ae){const ge=ie.uid,Ae=this.loading[ge];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[ge]),ae()}removeTile(ie,ae){const ge=ie.uid;this.loaded[ge]&&delete this.loaded[ge],ae()}decodeRasterArray({task:ie,buffer:ae},ge){r.bh.performDecoding(ae,ie).then(Ae=>ge(null,Ae)).catch(Ae=>ge(Ae))}}const Tt=r.ec.VectorTileFeature.prototype.toGeoJSON;class kt{constructor(ie){this._feature=ie,this.extent=r.ai,this.type=ie.type,this.properties=ie.tags,"id"in ie&&!isNaN(ie.id)&&(this.id=parseInt(ie.id,10))}loadGeometry(){if(this._feature.type===1){const ie=[];for(const ae of this._feature.geometry)ie.push([new r.P(ae[0],ae[1])]);return ie}{const ie=[];for(const ae of this._feature.geometry){const ge=[];for(const Ae of ae)ge.push(new r.P(Ae[0],Ae[1]));ie.push(ge)}return ie}}toGeoJSON(ie,ae,ge){return Tt.call(this,ie,ae,ge)}}class At{constructor(ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ai,this.length=ie.length,this._features=ie}feature(ie){return new kt(this._features[ie])}}const ot=64/4096,hi=128;class Mi{constructor(){this.features=new Map}clear(){this.features.clear()}load(ie=[],ae){for(const ge of ie){const Ae=ge.id;if(Ae==null)continue;let Me=this.features.get(Ae);Me&&this.updateCache(Me,ae),ge.geometry?(Me=Rt(ge),this.updateCache(Me,ae),this.features.set(Ae,Me)):this.features.delete(Ae),this.updateCache(Me,ae)}}updateCache(ie,ae){for(const{canonical:ge,uid:Ae}of Object.values(ae)){const{z:Me,x:Oe,y:Je}=ge;ti(ie,Math.pow(2,Me),Oe,Je)&&delete ae[Ae]}}getTile(ie,ae,ge){const Ae=Math.pow(2,ie),Me=[];for(const Oe of this.features.values())ti(Oe,Ae,ae,ge)&&Me.push(ii(Oe,Ae,ae,ge));return{features:Me}}getFeatures(){return[...this.features.values()]}}function ti({minX:at,minY:ie,maxX:ae,maxY:ge},Ae,Me,Oe){return at<(Me+1+ot)/Ae&&ie<(Oe+1+ot)/Ae&&ae>(Me-ot)/Ae&&ge>(Oe-ot)/Ae}function Rt(at){const{id:ie,geometry:ae,properties:ge}=at;if(!ae)return;if(ae.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ae,coordinates:Me}=ae,Oe={id:ie,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Je=Oe.geometry;if(Ae==="Point")ui(Me,Je,Oe);else if(Ae==="MultiPoint")for(const Be of Me)ui(Be,Je,Oe);else if(Ae==="LineString")Oe.type=2,Si(Me,Je,Oe);else if(Ae==="MultiLineString")Oe.type=2,di(Me,Je,Oe);else if(Ae==="Polygon")Oe.type=3,di(Me,Je,Oe,!0);else{if(Ae!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Oe.type=3;for(const Be of Me)di(Be,Je,Oe,!0)}return Oe}function ui([at,ie],ae,ge){const Ae=r.av(at);let Me=r.aC(ie);Me=Me<0?0:Me>1?1:Me,ae.push(Ae,Me),ge.minX=Math.min(ge.minX,Ae),ge.minY=Math.min(ge.minY,Me),ge.maxX=Math.max(ge.maxX,Ae),ge.maxY=Math.max(ge.maxY,Me)}function Si(at,ie,ae,ge=!1,Ae=!1){const Me=[];for(const Oe of at)ui(Oe,Me,ae);ie.push(Me),ge&&function(Oe,Je){let Be=0;for(let it=0,lt=Oe.length,rt=lt-2;it<lt;rt=it,it+=2)Be+=(Oe[it]-Oe[rt])*(Oe[it+1]+Oe[rt+1]);if(Be>0===Je)for(let it=0,lt=Oe.length;it<lt/2;it+=2){const rt=Oe[it],Dt=Oe[it+1];Oe[it]=Oe[lt-2-it],Oe[it+1]=Oe[lt-1-it],Oe[lt-2-it]=rt,Oe[lt-1-it]=Dt}}(Me,Ae)}function di(at,ie,ae,ge=!1){for(let Ae=0;Ae<at.length;Ae++)Si(at[Ae],ie,ae,ge,Ae===0)}function ii(at,ie,ae,ge){const{id:Ae,type:Me,geometry:Oe,tags:Je}=at,Be=[];if(Me===1)(function(it,lt,rt,Dt,Ht){for(let Yt=0;Yt<it.length;Yt+=2){const zi=Math.round(r.ai*(it[Yt+0]*lt-rt)),Ai=Math.round(r.ai*(it[Yt+1]*lt-Dt));Ht.push([zi,Ai])}})(Oe,ie,ae,ge,Be);else for(const it of Oe)pt(it,ie,ae,ge,Be);return{id:Ae,type:Me,geometry:Be,tags:Je}}function pt(at,ie,ae,ge,Ae){const Oe=r.ai+hi;let Je;for(let Be=0;Be<at.length-2;Be+=2){let it=Math.round(r.ai*(at[Be+0]*ie-ae)),lt=Math.round(r.ai*(at[Be+1]*ie-ge)),rt=Math.round(r.ai*(at[Be+2]*ie-ae)),Dt=Math.round(r.ai*(at[Be+3]*ie-ge));const Ht=rt-it,Yt=Dt-lt;it<-128&&rt<-128||(it<-128?(lt+=Math.round(Yt*((-128-it)/Ht)),it=-128):rt<-128&&(Dt=lt+Math.round(Yt*((-128-it)/Ht)),rt=-128),lt<-128&&Dt<-128||(lt<-128?(it+=Math.round(Ht*((-128-lt)/Yt)),lt=-128):Dt<-128&&(rt=it+Math.round(Ht*((-128-lt)/Yt)),Dt=-128),it>=Oe&&rt>=Oe||(it>=Oe?(lt+=Math.round(Yt*((Oe-it)/Ht)),it=Oe):rt>=Oe&&(Dt=lt+Math.round(Yt*((Oe-it)/Ht)),rt=Oe),lt>=Oe&&Dt>=Oe||(lt>=Oe?(it+=Math.round(Ht*((Oe-lt)/Yt)),lt=Oe):Dt>=Oe&&(rt=it+Math.round(Ht*((Oe-lt)/Yt)),Dt=Oe),Je&&it===Je[Je.length-1][0]&&lt===Je[Je.length-1][1]||(Je=[[it,lt]],Ae.push(Je)),Je.push([rt,Dt])))))}}var ni,pi,ai,We={exports:{}},Jt=function(){if(ai)return We.exports;ai=1;var at=r.eg(),ie=function(){if(pi)return ni;pi=1;var lt=r.ee(),rt=r.ef().VectorTileFeature;function Dt(Yt,zi){this.options=zi||{},this.features=Yt,this.length=Yt.length}function Ht(Yt,zi){this.id=typeof Yt.id=="number"?Yt.id:void 0,this.type=Yt.type,this.rawGeometry=Yt.type===1?[Yt.geometry]:Yt.geometry,this.properties=Yt.tags,this.extent=zi||4096}return ni=Dt,Dt.prototype.feature=function(Yt){return new Ht(this.features[Yt],this.options.extent)},Ht.prototype.loadGeometry=function(){var Yt=this.rawGeometry;this.geometry=[];for(var zi=0;zi<Yt.length;zi++){for(var Ai=Yt[zi],qi=[],$i=0;$i<Ai.length;$i++)qi.push(new lt(Ai[$i][0],Ai[$i][1]));this.geometry.push(qi)}return this.geometry},Ht.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Yt=this.geometry,zi=1/0,Ai=-1/0,qi=1/0,$i=-1/0,Fn=0;Fn<Yt.length;Fn++)for(var Jn=Yt[Fn],rn=0;rn<Jn.length;rn++){var Rn=Jn[rn];zi=Math.min(zi,Rn.x),Ai=Math.max(Ai,Rn.x),qi=Math.min(qi,Rn.y),$i=Math.max($i,Rn.y)}return[zi,qi,Ai,$i]},Ht.prototype.toGeoJSON=rt.prototype.toGeoJSON,ni}();function ae(lt){var rt=new at;return function(Dt,Ht){for(var Yt in Dt.layers)Ht.writeMessage(3,ge,Dt.layers[Yt])}(lt,rt),rt.finish()}function ge(lt,rt){var Dt;rt.writeVarintField(15,lt.version||1),rt.writeStringField(1,lt.name||""),rt.writeVarintField(5,lt.extent||4096);var Ht={keys:[],values:[],keycache:{},valuecache:{}};for(Dt=0;Dt<lt.length;Dt++)Ht.feature=lt.feature(Dt),rt.writeMessage(2,Ae,Ht);var Yt=Ht.keys;for(Dt=0;Dt<Yt.length;Dt++)rt.writeStringField(3,Yt[Dt]);var zi=Ht.values;for(Dt=0;Dt<zi.length;Dt++)rt.writeMessage(4,it,zi[Dt])}function Ae(lt,rt){var Dt=lt.feature;Dt.id!==void 0&&rt.writeVarintField(1,Dt.id),rt.writeMessage(2,Me,lt),rt.writeVarintField(3,Dt.type),rt.writeMessage(4,Be,Dt)}function Me(lt,rt){var Dt=lt.feature,Ht=lt.keys,Yt=lt.values,zi=lt.keycache,Ai=lt.valuecache;for(var qi in Dt.properties){var $i=Dt.properties[qi],Fn=zi[qi];if($i!==null){Fn===void 0&&(Ht.push(qi),zi[qi]=Fn=Ht.length-1),rt.writeVarint(Fn);var Jn=typeof $i;Jn!=="string"&&Jn!=="boolean"&&Jn!=="number"&&($i=JSON.stringify($i));var rn=Jn+":"+$i,Rn=Ai[rn];Rn===void 0&&(Yt.push($i),Ai[rn]=Rn=Yt.length-1),rt.writeVarint(Rn)}}}function Oe(lt,rt){return(rt<<3)+(7&lt)}function Je(lt){return lt<<1^lt>>31}function Be(lt,rt){for(var Dt=lt.loadGeometry(),Ht=lt.type,Yt=0,zi=0,Ai=Dt.length,qi=0;qi<Ai;qi++){var $i=Dt[qi],Fn=1;Ht===1&&(Fn=$i.length),rt.writeVarint(Oe(1,Fn));for(var Jn=Ht===3?$i.length-1:$i.length,rn=0;rn<Jn;rn++){rn===1&&Ht!==1&&rt.writeVarint(Oe(2,Jn-1));var Rn=$i[rn].x-Yt,Dn=$i[rn].y-zi;rt.writeVarint(Je(Rn)),rt.writeVarint(Je(Dn)),Yt+=Rn,zi+=Dn}Ht===3&&rt.writeVarint(Oe(7,1))}}function it(lt,rt){var Dt=typeof lt;Dt==="string"?rt.writeStringField(1,lt):Dt==="boolean"?rt.writeBooleanField(7,lt):Dt==="number"&&(lt%1!=0?rt.writeDoubleField(3,lt):lt<0?rt.writeSVarintField(6,lt):rt.writeVarintField(5,lt))}return We.exports=ae,We.exports.fromVectorTileJs=ae,We.exports.fromGeojsonVt=function(lt,rt){rt=rt||{};var Dt={};for(var Ht in lt)Dt[Ht]=new ie(lt[Ht].features,rt),Dt[Ht].name=Ht,Dt[Ht].version=rt.version,Dt[Ht].extent=rt.extent;return ae({layers:Dt})},We.exports.GeoJSONWrapper=ie,We.exports}(),Ei=r.eh(Jt);const Ot={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:at=>at},ji=Math.fround||(An=new Float32Array(1),at=>(An[0]=+at,An[0]));var An;const Xi=3,nr=5,sr=6;class Aa{constructor(ie){this.options=Object.assign(Object.create(Ot),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:ae,minZoom:ge,maxZoom:Ae}=this.options;ae&&console.time("total time");const Me=`prepare ${ie.length} points`;ae&&console.time(Me),this.points=ie;const Oe=[];for(let Be=0;Be<ie.length;Be++){const it=ie[Be];if(!it.geometry)continue;const[lt,rt]=it.geometry.coordinates,Dt=ji(Ts(lt)),Ht=ji(ks(rt));Oe.push(Dt,Ht,1/0,Be,-1,1),this.options.reduce&&Oe.push(0)}let Je=this.trees[Ae+1]=this._createTree(Oe);ae&&console.timeEnd(Me);for(let Be=Ae;Be>=ge;Be--){const it=+Date.now();Je=this.trees[Be]=this._createTree(this._cluster(Je,Be)),ae&&console.log("z%d: %d clusters in %dms",Be,Je.numItems,+Date.now()-it)}return ae&&console.timeEnd("total time"),this}getClusters(ie,ae){let ge=((ie[0]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,ie[1]));let Me=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)ge=-180,Me=180;else if(ge>Me){const rt=this.getClusters([ge,Ae,180,Oe],ae),Dt=this.getClusters([-180,Ae,Me,Oe],ae);return rt.concat(Dt)}const Je=this.trees[this._limitZoom(ae)],Be=Je.range(Ts(ge),ks(Oe),Ts(Me),ks(Ae)),it=Je.data,lt=[];for(const rt of Be){const Dt=this.stride*rt;lt.push(it[Dt+nr]>1?de(it,Dt,this.clusterProps):this.points[it[Dt+Xi]])}return lt}getChildren(ie){const ae=this._getOriginId(ie),ge=this._getOriginZoom(ie),Ae="No cluster with the specified id.",Me=this.trees[ge];if(!Me)throw new Error(Ae);const Oe=Me.data;if(ae*this.stride>=Oe.length)throw new Error(Ae);const Je=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Be=Me.within(Oe[ae*this.stride],Oe[ae*this.stride+1],Je),it=[];for(const lt of Be){const rt=lt*this.stride;Oe[rt+4]===ie&&it.push(Oe[rt+nr]>1?de(Oe,rt,this.clusterProps):this.points[Oe[rt+Xi]])}if(it.length===0)throw new Error(Ae);return it}getLeaves(ie,ae,ge){const Ae=[];return this._appendLeaves(Ae,ie,ae=ae||10,ge=ge||0,0),Ae}getTile(ie,ae,ge){const Ae=this.trees[this._limitZoom(ie)],Me=Math.pow(2,ie),{extent:Oe,radius:Je}=this.options,Be=Je/Oe,it=(ge-Be)/Me,lt=(ge+1+Be)/Me,rt={features:[]};return this._addTileFeatures(Ae.range((ae-Be)/Me,it,(ae+1+Be)/Me,lt),Ae.data,ae,ge,Me,rt),ae===0&&this._addTileFeatures(Ae.range(1-Be/Me,it,1,lt),Ae.data,Me,ge,Me,rt),ae===Me-1&&this._addTileFeatures(Ae.range(0,it,Be/Me,lt),Ae.data,-1,ge,Me,rt),rt.features.length?rt:null}getClusterExpansionZoom(ie){let ae=this._getOriginZoom(ie)-1;for(;ae<=this.options.maxZoom;){const ge=this.getChildren(ie);if(ae++,ge.length!==1)break;ie=ge[0].properties.cluster_id}return ae}_appendLeaves(ie,ae,ge,Ae,Me){const Oe=this.getChildren(ae);for(const Je of Oe){const Be=Je.properties;if(Be&&Be.cluster?Me+Be.point_count<=Ae?Me+=Be.point_count:Me=this._appendLeaves(ie,Be.cluster_id,ge,Ae,Me):Me<Ae?Me++:ie.push(Je),ie.length===ge)break}return Me}_createTree(ie){const ae=new r.bE(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ie.length;ge+=this.stride)ae.add(ie[ge],ie[ge+1]);return ae.finish(),ae.data=ie,ae}_addTileFeatures(ie,ae,ge,Ae,Me,Oe){for(const Je of ie){const Be=Je*this.stride,it=ae[Be+nr]>1;let lt,rt,Dt;if(it)lt=us(ae,Be,this.clusterProps),rt=ae[Be],Dt=ae[Be+1];else{const zi=this.points[ae[Be+Xi]];lt=zi.properties;const[Ai,qi]=zi.geometry.coordinates;rt=Ts(Ai),Dt=ks(qi)}const Ht={type:1,geometry:[[Math.round(this.options.extent*(rt*Me-ge)),Math.round(this.options.extent*(Dt*Me-Ae))]],tags:lt};let Yt;Yt=it||this.options.generateId?ae[Be+Xi]:this.points[ae[Be+Xi]].id,Yt!==void 0&&(Ht.id=Yt),Oe.features.push(Ht)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,ae){const{radius:ge,extent:Ae,reduce:Me,minPoints:Oe}=this.options,Je=ge/(Ae*Math.pow(2,ae)),Be=ie.data,it=[],lt=this.stride;for(let rt=0;rt<Be.length;rt+=lt){if(Be[rt+2]<=ae)continue;Be[rt+2]=ae;const Dt=Be[rt],Ht=Be[rt+1],Yt=ie.within(Be[rt],Be[rt+1],Je),zi=Be[rt+nr];let Ai=zi;for(const qi of Yt){const $i=qi*lt;Be[$i+2]>ae&&(Ai+=Be[$i+nr])}if(Ai>zi&&Ai>=Oe){let qi,$i=Dt*zi,Fn=Ht*zi,Jn=-1;const rn=(rt/lt<<5)+(ae+1)+this.points.length;for(const Rn of Yt){const Dn=Rn*lt;if(Be[Dn+2]<=ae)continue;Be[Dn+2]=ae;const kn=Be[Dn+nr];$i+=Be[Dn]*kn,Fn+=Be[Dn+1]*kn,Be[Dn+4]=rn,Me&&(qi||(qi=this._map(Be,rt,!0),Jn=this.clusterProps.length,this.clusterProps.push(qi)),Me(qi,this._map(Be,Dn)))}Be[rt+4]=rn,it.push($i/Ai,Fn/Ai,1/0,rn,-1,Ai),Me&&it.push(Jn)}else{for(let qi=0;qi<lt;qi++)it.push(Be[rt+qi]);if(Ai>1)for(const qi of Yt){const $i=qi*lt;if(!(Be[$i+2]<=ae)){Be[$i+2]=ae;for(let Fn=0;Fn<lt;Fn++)it.push(Be[$i+Fn])}}}}return it}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,ae,ge){if(ie[ae+nr]>1){const Oe=this.clusterProps[ie[ae+sr]];return ge?Object.assign({},Oe):Oe}const Ae=this.points[ie[ae+Xi]].properties,Me=this.options.map(Ae);return ge&&Me===Ae?Object.assign({},Me):Me}}function de(at,ie,ae){return{type:"Feature",id:at[ie+Xi],properties:us(at,ie,ae),geometry:{type:"Point",coordinates:[(ge=at[ie],360*(ge-.5)),Ft(at[ie+1])]}};var ge}function us(at,ie,ae){const ge=at[ie+nr],Ae=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Me=at[ie+sr],Oe=Me===-1?{}:Object.assign({},ae[Me]);return Object.assign(Oe,{cluster:!0,cluster_id:at[ie+Xi],point_count:ge,point_count_abbreviated:Ae})}function Ts(at){return at/360+.5}function ks(at){const ie=Math.sin(at*Math.PI/180),ae=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ae<0?0:ae>1?1:ae}function Ft(at){const ie=(180-360*at)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function Ss(at,ie,ae,ge){let Ae=ge;const Me=ie+(ae-ie>>1);let Oe,Je=ae-ie;const Be=at[ie],it=at[ie+1],lt=at[ae],rt=at[ae+1];for(let Dt=ie+3;Dt<ae;Dt+=3){const Ht=ya(at[Dt],at[Dt+1],Be,it,lt,rt);if(Ht>Ae)Oe=Dt,Ae=Ht;else if(Ht===Ae){const Yt=Math.abs(Dt-Me);Yt<Je&&(Oe=Dt,Je=Yt)}}Ae>ge&&(Oe-ie>3&&Ss(at,ie,Oe,ge),at[Oe+2]=Ae,ae-Oe>3&&Ss(at,Oe,ae,ge))}function ya(at,ie,ae,ge,Ae,Me){let Oe=Ae-ae,Je=Me-ge;if(Oe!==0||Je!==0){const Be=((at-ae)*Oe+(ie-ge)*Je)/(Oe*Oe+Je*Je);Be>1?(ae=Ae,ge=Me):Be>0&&(ae+=Oe*Be,ge+=Je*Be)}return Oe=at-ae,Je=ie-ge,Oe*Oe+Je*Je}function qr(at,ie,ae,ge){const Ae={id:at??null,type:ie,geometry:ae,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")ln(Ae,ae);else if(ie==="Polygon")ln(Ae,ae[0]);else if(ie==="MultiLineString")for(const Me of ae)ln(Ae,Me);else if(ie==="MultiPolygon")for(const Me of ae)ln(Ae,Me[0]);return Ae}function ln(at,ie){for(let ae=0;ae<ie.length;ae+=3)at.minX=Math.min(at.minX,ie[ae]),at.minY=Math.min(at.minY,ie[ae+1]),at.maxX=Math.max(at.maxX,ie[ae]),at.maxY=Math.max(at.maxY,ie[ae+1])}function Br(at,ie,ae,ge){if(!ie.geometry)return;const Ae=ie.geometry.coordinates;if(Ae&&Ae.length===0)return;const Me=ie.geometry.type,Oe=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let Je=[],Be=ie.id;if(ae.promoteId?Be=ie.properties[ae.promoteId]:ae.generateId&&(Be=ge||0),Me==="Point")Bs(Ae,Je);else if(Me==="MultiPoint")for(const it of Ae)Bs(it,Je);else if(Me==="LineString")Es(Ae,Je,Oe,!1);else if(Me==="MultiLineString"){if(ae.lineMetrics){for(const it of Ae)Je=[],Es(it,Je,Oe,!1),at.push(qr(Be,"LineString",Je,ie.properties));return}Qe(Ae,Je,Oe,!1)}else if(Me==="Polygon")Qe(Ae,Je,Oe,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const it of ie.geometry.geometries)Br(at,{id:Be,geometry:it,properties:ie.properties},ae,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const it of Ae){const lt=[];Qe(it,lt,Oe,!0),Je.push(lt)}}at.push(qr(Be,Me,Je,ie.properties))}function Bs(at,ie){ie.push(Mt(at[0]),vt(at[1]),0)}function Es(at,ie,ae,ge){let Ae,Me,Oe=0;for(let Be=0;Be<at.length;Be++){const it=Mt(at[Be][0]),lt=vt(at[Be][1]);ie.push(it,lt,0),Be>0&&(Oe+=ge?(Ae*lt-it*Me)/2:Math.sqrt(Math.pow(it-Ae,2)+Math.pow(lt-Me,2))),Ae=it,Me=lt}const Je=ie.length-3;ie[2]=1,Ss(ie,0,Je,ae),ie[Je+2]=1,ie.size=Math.abs(Oe),ie.start=0,ie.end=ie.size}function Qe(at,ie,ae,ge){for(let Ae=0;Ae<at.length;Ae++){const Me=[];Es(at[Ae],Me,ae,ge),ie.push(Me)}}function Mt(at){return at/360+.5}function vt(at){const ie=Math.sin(at*Math.PI/180),ae=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ae<0?0:ae>1?1:ae}function bi(at,ie,ae,ge,Ae,Me,Oe,Je){if(ge/=ie,Me>=(ae/=ie)&&Oe<ge)return at;if(Oe<ae||Me>=ge)return null;const Be=[];for(const it of at){const lt=it.geometry;let rt=it.type;const Dt=Ae===0?it.minX:it.minY,Ht=Ae===0?it.maxX:it.maxY;if(Dt>=ae&&Ht<ge){Be.push(it);continue}if(Ht<ae||Dt>=ge)continue;let Yt=[];if(rt==="Point"||rt==="MultiPoint")gi(lt,Yt,ae,ge,Ae);else if(rt==="LineString")ri(lt,Yt,ae,ge,Ae,!1,Je.lineMetrics);else if(rt==="MultiLineString")sn(lt,Yt,ae,ge,Ae,!1);else if(rt==="Polygon")sn(lt,Yt,ae,ge,Ae,!0);else if(rt==="MultiPolygon")for(const zi of lt){const Ai=[];sn(zi,Ai,ae,ge,Ae,!0),Ai.length&&Yt.push(Ai)}if(Yt.length){if(Je.lineMetrics&&rt==="LineString"){for(const zi of Yt)Be.push(qr(it.id,rt,zi,it.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(Yt.length===1?(rt="LineString",Yt=Yt[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=Yt.length===3?"Point":"MultiPoint"),Be.push(qr(it.id,rt,Yt,it.tags))}}return Be.length?Be:null}function gi(at,ie,ae,ge,Ae){for(let Me=0;Me<at.length;Me+=3){const Oe=at[Me+Ae];Oe>=ae&&Oe<=ge&&or(ie,at[Me],at[Me+1],at[Me+2])}}function ri(at,ie,ae,ge,Ae,Me,Oe){let Je=vi(at);const Be=Ae===0?Gr:hc;let it,lt,rt=at.start;for(let Ai=0;Ai<at.length-3;Ai+=3){const qi=at[Ai],$i=at[Ai+1],Fn=at[Ai+2],Jn=at[Ai+3],rn=at[Ai+4],Rn=Ae===0?qi:$i,Dn=Ae===0?Jn:rn;let kn=!1;Oe&&(it=Math.sqrt(Math.pow(qi-Jn,2)+Math.pow($i-rn,2))),Rn<ae?Dn>ae&&(lt=Be(Je,qi,$i,Jn,rn,ae),Oe&&(Je.start=rt+it*lt)):Rn>ge?Dn<ge&&(lt=Be(Je,qi,$i,Jn,rn,ge),Oe&&(Je.start=rt+it*lt)):or(Je,qi,$i,Fn),Dn<ae&&Rn>=ae&&(lt=Be(Je,qi,$i,Jn,rn,ae),kn=!0),Dn>ge&&Rn<=ge&&(lt=Be(Je,qi,$i,Jn,rn,ge),kn=!0),!Me&&kn&&(Oe&&(Je.end=rt+it*lt),ie.push(Je),Je=vi(at)),Oe&&(rt+=it)}let Dt=at.length-3;const Ht=at[Dt],Yt=at[Dt+1],zi=Ae===0?Ht:Yt;zi>=ae&&zi<=ge&&or(Je,Ht,Yt,at[Dt+2]),Dt=Je.length-3,Me&&Dt>=3&&(Je[Dt]!==Je[0]||Je[Dt+1]!==Je[1])&&or(Je,Je[0],Je[1],Je[2]),Je.length&&ie.push(Je)}function vi(at){const ie=[];return ie.size=at.size,ie.start=at.start,ie.end=at.end,ie}function sn(at,ie,ae,ge,Ae,Me){for(const Oe of at)ri(Oe,ie,ae,ge,Ae,Me,!1)}function or(at,ie,ae,ge){at.push(ie,ae,ge)}function Gr(at,ie,ae,ge,Ae,Me){const Oe=(Me-ie)/(ge-ie);return or(at,Me,ae+(Ae-ae)*Oe,1),Oe}function hc(at,ie,ae,ge,Ae,Me){const Oe=(Me-ae)/(Ae-ae);return or(at,ie+(ge-ie)*Oe,Me,1),Oe}function hs(at,ie){const ae=[];for(let ge=0;ge<at.length;ge++){const Ae=at[ge],Me=Ae.type;let Oe;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")Oe=ds(Ae.geometry,ie);else if(Me==="MultiLineString"||Me==="Polygon"){Oe=[];for(const Je of Ae.geometry)Oe.push(ds(Je,ie))}else if(Me==="MultiPolygon"){Oe=[];for(const Je of Ae.geometry){const Be=[];for(const it of Je)Be.push(ds(it,ie));Oe.push(Be)}}ae.push(qr(Ae.id,Me,Oe,Ae.tags))}return ae}function ds(at,ie){const ae=[];ae.size=at.size,at.start!==void 0&&(ae.start=at.start,ae.end=at.end);for(let ge=0;ge<at.length;ge+=3)ae.push(at[ge]+ie,at[ge+1],at[ge+2]);return ae}function Wr(at,ie){if(at.transformed)return at;const ae=1<<at.z,ge=at.x,Ae=at.y;for(const Me of at.features){const Oe=Me.geometry,Je=Me.type;if(Me.geometry=[],Je===1)for(let Be=0;Be<Oe.length;Be+=2)Me.geometry.push(Ns(Oe[Be],Oe[Be+1],ie,ae,ge,Ae));else for(let Be=0;Be<Oe.length;Be++){const it=[];for(let lt=0;lt<Oe[Be].length;lt+=2)it.push(Ns(Oe[Be][lt],Oe[Be][lt+1],ie,ae,ge,Ae));Me.geometry.push(it)}}return at.transformed=!0,at}function Ns(at,ie,ae,ge,Ae,Me){return[Math.round(ae*(at*ge-Ae)),Math.round(ae*(ie*ge-Me))]}function Kn(at,ie,ae,ge,Ae){const Me=ie===Ae.maxZoom?0:Ae.tolerance/((1<<ie)*Ae.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:at.length,source:null,x:ae,y:ge,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Je of at)Nn(Oe,Je,Me,Ae);return Oe}function Nn(at,ie,ae,ge){const Ae=ie.geometry,Me=ie.type,Oe=[];if(at.minX=Math.min(at.minX,ie.minX),at.minY=Math.min(at.minY,ie.minY),at.maxX=Math.max(at.maxX,ie.maxX),at.maxY=Math.max(at.maxY,ie.maxY),Me==="Point"||Me==="MultiPoint")for(let Je=0;Je<Ae.length;Je+=3)Oe.push(Ae[Je],Ae[Je+1]),at.numPoints++,at.numSimplified++;else if(Me==="LineString")bu(Oe,Ae,at,ae,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let Je=0;Je<Ae.length;Je++)bu(Oe,Ae[Je],at,ae,Me==="Polygon",Je===0);else if(Me==="MultiPolygon")for(let Je=0;Je<Ae.length;Je++){const Be=Ae[Je];for(let it=0;it<Be.length;it++)bu(Oe,Be[it],at,ae,!0,it===0)}if(Oe.length){let Je=ie.tags||null;if(Me==="LineString"&&ge.lineMetrics){Je={};for(const it in ie.tags)Je[it]=ie.tags[it];Je.mapbox_clip_start=Ae.start/Ae.size,Je.mapbox_clip_end=Ae.end/Ae.size}const Be={geometry:Oe,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Je};ie.id!==null&&(Be.id=ie.id),at.features.push(Be)}}function bu(at,ie,ae,ge,Ae,Me){const Oe=ge*ge;if(ge>0&&ie.size<(Ae?Oe:ge))return void(ae.numPoints+=ie.length/3);const Je=[];for(let Be=0;Be<ie.length;Be+=3)(ge===0||ie[Be+2]>Oe)&&(ae.numSimplified++,Je.push(ie[Be],ie[Be+1])),ae.numPoints++;Ae&&function(Be,it){let lt=0;for(let rt=0,Dt=Be.length,Ht=Dt-2;rt<Dt;Ht=rt,rt+=2)lt+=(Be[rt]-Be[Ht])*(Be[rt+1]+Be[Ht+1]);if(lt>0===it)for(let rt=0,Dt=Be.length;rt<Dt/2;rt+=2){const Ht=Be[rt],Yt=Be[rt+1];Be[rt]=Be[Dt-2-rt],Be[rt+1]=Be[Dt-1-rt],Be[Dt-2-rt]=Ht,Be[Dt-1-rt]=Yt}}(Je,Me),at.push(Je)}const dc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ma{constructor(ie,ae){const ge=(ae=this.options=function(Me,Oe){for(const Je in Oe)Me[Je]=Oe[Je];return Me}(Object.create(dc),ae)).debug;if(ge&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ae=function(Me,Oe){const Je=[];if(Me.type==="FeatureCollection")for(let Be=0;Be<Me.features.length;Be++)Br(Je,Me.features[Be],Oe,Be);else Br(Je,Me.type==="Feature"?Me:{geometry:Me},Oe);return Je}(ie,ae);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ae=function(Me,Oe){const Je=Oe.buffer/Oe.extent;let Be=Me;const it=bi(Me,1,-1-Je,Je,0,-1,2,Oe),lt=bi(Me,1,1-Je,2+Je,0,-1,2,Oe);return(it||lt)&&(Be=bi(Me,1,-Je,1+Je,0,-1,2,Oe)||[],it&&(Be=hs(it,1).concat(Be)),lt&&(Be=Be.concat(hs(lt,-1)))),Be}(Ae,ae),Ae.length&&this.splitTile(Ae,0,0,0),ge&&(Ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ie,ae,ge,Ae,Me,Oe,Je){const Be=[ie,ae,ge,Ae],it=this.options,lt=it.debug;for(;Be.length;){Ae=Be.pop(),ge=Be.pop(),ae=Be.pop(),ie=Be.pop();const rt=1<<ae,Dt=so(ae,ge,Ae);let Ht=this.tiles[Dt];if(!Ht&&(lt>1&&console.time("creation"),Ht=this.tiles[Dt]=Kn(ie,ae,ge,Ae,it),this.tileCoords.push({z:ae,x:ge,y:Ae}),lt)){lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,ge,Ae,Ht.numFeatures,Ht.numPoints,Ht.numSimplified),console.timeEnd("creation"));const kn=`z${ae}`;this.stats[kn]=(this.stats[kn]||0)+1,this.total++}if(Ht.source=ie,Me==null){if(ae===it.indexMaxZoom||Ht.numPoints<=it.indexMaxPoints)continue}else{if(ae===it.maxZoom||ae===Me)continue;if(Me!=null){const kn=Me-ae;if(ge!==Oe>>kn||Ae!==Je>>kn)continue}}if(Ht.source=null,ie.length===0)continue;lt>1&&console.time("clipping");const Yt=.5*it.buffer/it.extent,zi=.5-Yt,Ai=.5+Yt,qi=1+Yt;let $i=null,Fn=null,Jn=null,rn=null,Rn=bi(ie,rt,ge-Yt,ge+Ai,0,Ht.minX,Ht.maxX,it),Dn=bi(ie,rt,ge+zi,ge+qi,0,Ht.minX,Ht.maxX,it);ie=null,Rn&&($i=bi(Rn,rt,Ae-Yt,Ae+Ai,1,Ht.minY,Ht.maxY,it),Fn=bi(Rn,rt,Ae+zi,Ae+qi,1,Ht.minY,Ht.maxY,it),Rn=null),Dn&&(Jn=bi(Dn,rt,Ae-Yt,Ae+Ai,1,Ht.minY,Ht.maxY,it),rn=bi(Dn,rt,Ae+zi,Ae+qi,1,Ht.minY,Ht.maxY,it),Dn=null),lt>1&&console.timeEnd("clipping"),Be.push($i||[],ae+1,2*ge,2*Ae),Be.push(Fn||[],ae+1,2*ge,2*Ae+1),Be.push(Jn||[],ae+1,2*ge+1,2*Ae),Be.push(rn||[],ae+1,2*ge+1,2*Ae+1)}}getTile(ie,ae,ge){ie=+ie,ae=+ae,ge=+ge;const Ae=this.options,{extent:Me,debug:Oe}=Ae;if(ie<0||ie>24)return null;const Je=1<<ie,Be=so(ie,ae=ae+Je&Je-1,ge);if(this.tiles[Be])return Wr(this.tiles[Be],Me);Oe>1&&console.log("drilling down to z%d-%d-%d",ie,ae,ge);let it,lt=ie,rt=ae,Dt=ge;for(;!it&&lt>0;)lt--,rt>>=1,Dt>>=1,it=this.tiles[so(lt,rt,Dt)];return it&&it.source?(Oe>1&&(console.log("found parent tile z%d-%d-%d",lt,rt,Dt),console.time("drilling down")),this.splitTile(it.source,lt,rt,Dt,ie,ae,ge),Oe>1&&console.timeEnd("drilling down"),this.tiles[Be]?Wr(this.tiles[Be],Me):null):null}}function so(at,ie,ae){return 32*((1<<at)*ae+ie)+at}function fh(at,ie){const ae=at.tileID.canonical;if(!this._geoJSONIndex)return void ie(null,null);const ge=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!ge)return void ie(null,null);const Ae=new At(ge.features);let Me=Ei(Ae);Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),ie(null,{vectorTile:Ae,rawData:Me.buffer})}class fc extends qe{constructor(ie,ae,ge,Ae,Me,Oe){super(ie,ae,ge,Ae,fh,Oe),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new Mi}loadData(ie,ae){const ge=ie&&ie.request,Ae=ge&&ge.collectResourceTiming;this.loadGeoJSON(ie,(Me,Oe)=>{if(Me||!Oe)return ae(Me);if(typeof Oe!="object")return ae(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{try{if(ie.filter){const Be=r.X(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(it=>`${it.key}: ${it.message}`).join(", "));Oe.features=Oe.features.filter(it=>Be.value.evaluate({zoom:0},it))}ie.dynamic?(Oe.type==="Feature"&&(Oe={type:"FeatureCollection",features:[Oe]}),ie.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Oe.features,this.loaded),ie.cluster&&(Oe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ie.cluster?new Aa(function({superclusterOptions:Be,clusterProperties:it}){if(!it||!Be)return Be;const lt={},rt={},Dt={accumulated:null,zoom:0},Ht={properties:null},Yt=Object.keys(it);for(const zi of Yt){const[Ai,qi]=it[zi],$i=r.X(qi),Fn=r.X(typeof Ai=="string"?[Ai,["accumulated"],["get",zi]]:Ai);lt[zi]=$i.value,rt[zi]=Fn.value}return Be.map=zi=>{Ht.properties=zi;const Ai={};for(const qi of Yt)Ai[qi]=lt[qi].evaluate(Dt,Ht);return Ai},Be.reduce=(zi,Ai)=>{Ht.properties=Ai;for(const qi of Yt)Dt.accumulated=zi[qi],zi[qi]=rt[qi].evaluate(Dt,Ht)},Be}(ie)).load(Oe.features):ie.dynamic?this._dynamicIndex:function(Be,it){return new Ma(Be,it)}(Oe,ie.geojsonVtOptions)}catch(Be){return ae(Be)}const Je={};if(Ae){const Be=re(ge);Be&&(Je.resourceTiming={},Je.resourceTiming[ie.source]=JSON.parse(JSON.stringify(Be)))}ae(null,Je)}})}reloadTile(ie,ae){const ge=this.loaded;return ge&&ge[ie.uid]?ie.partial?ae(null,void 0):super.reloadTile(ie,ae):this.loadTile(ie,ae)}loadGeoJSON(ie,ae){if(ie.request)r.n(ie.request,ae);else{if(typeof ie.data!="string")return ae(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(ie.data))}catch{return ae(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ie,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(ge){ae(ge)}}getClusterChildren(ie,ae){try{ae(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(ge){ae(ge)}}getClusterLeaves(ie,ae){try{ae(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(ge){ae(ge)}}}class ph{constructor(ie,ae){this.tileID=new r.aH(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ie.projection,this.brightness=ae}parse(ie,ae,ge,Ae){this.status="parsing";const Me=new r.aH(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),Oe=[],Je=ae.familiesBySource[ge.source],Be=new r.e0(Me,ge.promoteId);return Be.bucketLayerIDs=[],Be.is3DTile=!0,r.ei(ie).then(it=>{if(!it)return Ae(new Error("Could not parse tile"));const lt=r.ej(it,1/r.cd(ge.tileID.canonical)),rt=it.json.extensionsUsed&&it.json.extensionsUsed.includes("MAPBOX_mesh_features")||it.json.asset.extras&&it.json.asset.extras.MAPBOX_mesh_features,Dt=it.json.extensionsUsed&&it.json.extensionsUsed.includes("EXT_meshopt_compression"),Ht=new r.aa(this.zoom,{brightness:this.brightness});for(const Yt in Je)for(const zi of Je[Yt]){const Ai=zi[0];Be.bucketLayerIDs.push(zi.map($i=>r.C($i.id,$i.scope))),Ai.recalculate(Ht,[]);const qi=new r.ek(zi,lt,Me,rt,Dt,this.brightness,Be);rt||(qi.needsUpload=!0),Oe.push(qi),qi.evaluate(Ai)}this.status="done",Ae(null,{buckets:Oe,featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(it=>Ae(new Error(it.message)))}}class wu{constructor(ie,ae,ge,Ae,Me,Oe){this.actor=ie,this.layerIndex=ae,this.availableImages=ge,this.brightness=Oe,this.loading={},this.loaded={}}loadTile(ie,ae){const ge=ie.uid,Ae=this.loading[ge]=new ph(ie,this.brightness);r.bj(ie.request,(Me,Oe)=>{const Je=!this.loading[ge];return delete this.loading[ge],Je||Me?(Ae.status="done",Je||(this.loaded[ge]=Ae),ae(Me)):Oe&&Oe.byteLength!==0?void Ae.parse(Oe,this.layerIndex,ie,(Be,it)=>{Ae.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Ae,Be||!it?ae(Be):ae(null,it)}):(Ae.status="done",this.loaded[ge]=Ae,ae())})}reloadTile(ie,ae){const ge=this.loaded,Ae=ie.uid;if(ge&&ge[Ae]){const Me=ge[Ae];Me.projection=ie.projection,Me.brightness=ie.brightness;const Oe=(Je,Be)=>{Me.reloadCallback&&(delete Me.reloadCallback,this.loadTile(ie,ae)),ae(Je,Be)};Me.status==="parsing"?Me.reloadCallback=Oe:Me.status==="done"&&this.loadTile(ie,ae)}}abortTile(ie,ae){const ge=ie.uid;this.loading[ge]&&delete this.loading[ge],ae()}removeTile(ie,ae){const ge=this.loaded,Ae=ie.uid;ge&&ge[Ae]&&delete ge[Ae],ae()}}class pc{constructor(ie){this.self=ie,this.actor=new r.el(ie,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.y,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:qe,geojson:fc,"raster-dem":He,"raster-array":mt,"batched-model":wu},this.workerSources={},this.self.registerWorkerSource=(ae,ge)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=ge},this.self.registerRTLTextPlugin=ae=>{if(r.em.isParsed())throw new Error("RTL text plugin already registered.");r.em.applyArabicShaping=ae.applyArabicShaping,r.em.processBidirectionalText=ae.processBidirectionalText,r.em.processStyledBidirectionalText=ae.processStyledBidirectionalText}}clearCaches(ie,ae,ge){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],ge()}checkIfReady(ie,ae,ge){ge()}setReferrer(ie,ae){this.referrer=ae}spriteLoaded(ie,{scope:ae,isLoaded:ge}){if(this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),this.isSpriteLoaded[ie][ae]=ge,this.workerSources[ie]&&this.workerSources[ie][ae])for(const Ae in this.workerSources[ie][ae]){const Me=this.workerSources[ie][ae][Ae];for(const Oe in Me){const Je=Me[Oe];Je instanceof qe&&(Je.isSpriteLoaded=ge,Je.fire(new r.A("isSpriteLoaded")))}}}setImages(ie,{scope:ae,images:ge},Ae){if(this.availableImages[ie]||(this.availableImages[ie]={}),this.availableImages[ie][ae]=ge,this.workerSources[ie]&&this.workerSources[ie][ae]){for(const Me in this.workerSources[ie][ae]){const Oe=this.workerSources[ie][ae][Me];for(const Je in Oe)Oe[Je].availableImages=ge}Ae()}else Ae()}setProjection(ie,ae){this.projections[ie]=r.bP(ae)}setBrightness(ie,ae,ge){this.brightness=ae,ge()}setLayers(ie,ae,ge){this.getLayerIndex(ie,ae.scope).replace(ae.layers,ae.options),ge()}updateLayers(ie,ae,ge){this.getLayerIndex(ie,ae.scope).update(ae.layers,ae.removedIds,ae.options),ge()}loadTile(ie,ae,ge){ae.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,ae.type,ae.source,ae.scope).loadTile(ae,ge)}decodeRasterArray(ie,ae,ge){this.getWorkerSource(ie,ae.type,ae.source,ae.scope).decodeRasterArray(ae,ge)}reloadTile(ie,ae,ge){ae.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,ae.type,ae.source,ae.scope).reloadTile(ae,ge)}abortTile(ie,ae,ge){this.getWorkerSource(ie,ae.type,ae.source,ae.scope).abortTile(ae,ge)}removeTile(ie,ae,ge){this.getWorkerSource(ie,ae.type,ae.source,ae.scope).removeTile(ae,ge)}removeSource(ie,ae,ge){if(!(this.workerSources[ie]&&this.workerSources[ie][ae.scope]&&this.workerSources[ie][ae.scope][ae.type]&&this.workerSources[ie][ae.scope][ae.type][ae.source]))return;const Ae=this.workerSources[ie][ae.scope][ae.type][ae.source];delete this.workerSources[ie][ae.scope][ae.type][ae.source],Ae.removeSource!==void 0?Ae.removeSource(ae,ge):ge()}loadWorkerSource(ie,ae,ge){try{this.self.importScripts(ae.url),ge()}catch(Ae){ge(Ae.toString())}}syncRTLPluginState(ie,ae,ge){try{r.em.setState(ae);const Ae=r.em.getPluginURL();if(r.em.isLoaded()&&!r.em.isParsed()&&Ae!=null){this.self.importScripts(Ae);const Me=r.em.isParsed();ge(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ae}`),Me)}}catch(Ae){ge(Ae.toString())}}setDracoUrl(ie,ae){this.dracoUrl=ae}getAvailableImages(ie,ae){this.availableImages[ie]||(this.availableImages[ie]={});let ge=this.availableImages[ie][ae];return ge||(ge=[]),ge}getLayerIndex(ie,ae){this.layerIndexes[ie]||(this.layerIndexes[ie]={});let ge=this.layerIndexes[ie][ae];return ge||(ge=this.layerIndexes[ie][ae]=new ze,ge.scope=ae),ge}getWorkerSource(ie,ae,ge,Ae){const Me=this.workerSources;return Me[ie]||(Me[ie]={}),Me[ie][Ae]||(Me[ie][Ae]={}),Me[ie][Ae][ae]||(Me[ie][Ae][ae]={}),this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),Me[ie][Ae][ae][ge]||(Me[ie][Ae][ae][ge]=new this.workerSourceTypes[ae]({send:(Oe,Je,Be,it,lt,rt)=>{this.actor.send(Oe,Je,Be,ie,lt,rt)},scheduler:this.actor.scheduler},this.getLayerIndex(ie,Ae),this.getAvailableImages(ie,Ae),this.isSpriteLoaded[ie][Ae],void 0,this.brightness)),Me[ie][Ae][ae][ge]}rasterizeImages(ie,ae,ge){const Ae=new Map;for(const[Me,{image:Oe,imageVariant:Je}]of ae.tasks.entries()){const Be=this.imageRasterizer.rasterize(Je,Oe,ae.scope,ie);Ae.set(Me,Be)}ge(void 0,Ae)}removeRasterizedImages(ie,ae,ge){this.imageRasterizer.removeImagesFromCacheByIds(ae.imageIds,ae.scope,ie),ge()}enforceCacheSizeLimit(ie,ae){r.en(ae)}getWorkerPerformanceMetrics(ie,ae,ge){ge(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new pc(self)),pc}),F(["./shared"],function(r){var re="3.11.0";const J={create:"create",load:"load",fullLoad:"fullLoad"},oe={mark(h){performance.mark(h)},measure(h,t,n){performance.measure(h,t,n)}};function ze(h){const t=h.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var je,ft={},Le=function(){if(je)return ft;function h(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,b,I=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(I);try{b=new Worker(L),g=!0}catch{g=!1}return b&&b.terminate(),URL.revokeObjectURL(L),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var b=g.getContext("2d");if(!b)return!1;var I=b.getImageData(0,0,1,1);return I&&I.width===g.width}()?(n[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(n[p]=function(g){var b,I=function(L){var P=document.createElement("canvas"),k=Object.create(h.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=L,P.getContext("webgl2",k)}(g);if(!I)return!1;try{b=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!b||I.isContextLost())&&(I.shaderSource(b,"void main() {}"),I.compileShader(b),I.getShaderParameter(b,I.COMPILE_STATUS)===!0)}(p)),n[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}je=1,ft.supported=h,ft.notSupportedReason=t;var n={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ft}();function Fe(h,t,n){const u=document.createElement(h);return t!=null&&(u.className=t),n&&n.appendChild(u),u}function qe(h,t,n){const u=document.createElementNS("http://www.w3.org/2000/svg",h);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return n&&n.appendChild(u),u}const He=typeof document<"u"?document.documentElement&&document.documentElement.style:null,tt=He&&He.userSelect!==void 0?"userSelect":"WebkitUserSelect";let mt;function Tt(){He&&tt&&(mt=He[tt],He[tt]="none")}function kt(){He&&tt&&(He[tt]=mt)}function At(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",At,!0)}function ot(){window.addEventListener("click",At,!0),window.setTimeout(()=>{window.removeEventListener("click",At,!0)},0)}function hi(h,t){const n=h.getBoundingClientRect();return Rt(h,n,t)}function Mi(h,t){const n=h.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(Rt(h,n,t[p]));return u}function ti(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function Rt(h,t,n){const u=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new r.P((n.clientX-t.left)*u,(n.clientY-t.top)*u)}const ui="01",Si="NO_ACCESS_TOKEN";class di{constructor(t,n,u){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let u=0;u<10;u++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ui,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!r.f(t))return t;const u=pt(t);return u.params.push(`sdk=js-${re}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!r.f(t))return t;const u=pt(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeModelURL(t,n){if(!r.f(t))return t;const u=pt(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeSourceURL(t,n,u,p){if(!r.f(t))return t;const g=pt(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),u&&g.params.push(`language=${u}`),p&&g.params.push(`worldview=${p}`),this._makeAPIURL(g,this._customAccessToken||n)}normalizeIconsetURL(t,n){const u=pt(t);return r.f(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||n)):ni(u)}normalizeSpriteURL(t,n,u,p){const g=pt(t);return r.f(t)?(g.path=`/styles/v1${g.path}/sprite${n}${u}`,this._makeAPIURL(g,this._customAccessToken||p)):(g.path+=`${n}${u}`,ni(g))}normalizeTileURL(t,n,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.f(t))return t;const p=pt(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||u&&p.authority!=="raster"&&u===512?"@2x":""}${r.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${r.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${r.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${r.e.TILE_URL_VERSION}${p.path}`);const g=this._customAccessToken||function(b){for(const I of b){const L=I.match(/^access_token=(.*)$/);if(L)return L[1]}return null}(p.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,g)}canonicalizeTileURL(t,n){const u=pt(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let g=u.params;return n&&(g=g.filter(b=>!b.match(/^access_token=/))),g.length&&(p+=`?${g.join("&")}`),p}canonicalizeTileset(t,n){const u=!!n&&r.f(n),p=[];for(const g of t.tiles||[])r.h(g)?p.push(this.canonicalizeTileURL(g,u)):p.push(g);return p}_makeAPIURL(t,n){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=pt(r.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return ni(t);if(n=n||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(g=>g.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),ni(t)}}const ii=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function pt(h){const t=h.match(ii);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ni(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const pi="mapbox.eventData";function ai(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.j(t[1]))}catch{return null}}class We{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=ai(r.e.ACCESS_TOKEN);let u="";return u=n&&n.u?r.k(n.u):r.e.ACCESS_TOKEN||"",t?`${pi}.${t}:${u}`:`${pi}:${u}`}fetchEventData(){const t=r.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(n);p&&(this.eventData=JSON.parse(p));const g=localStorage.getItem(u);g&&(this.anonId=g)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,u,p){if(!r.e.EVENTS_URL)return;const g=pt(r.e.EVENTS_URL);g.params.push(`access_token=${p||r.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(t).toISOString()},I=n?r.l(b,n):b,L={url:ni(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=r.p(L,P=>{this.pendingRequest=null,u(P),this.saveEventData(),this.processRequests(p)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Jt=new class extends We{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(n=>r.f(n)||r.h(n))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ai(r.e.ACCESS_TOKEN),n=t?t.u:r.e.ACCESS_TOKEN;let u=n!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),b=new Date(p),I=(p-this.eventData.lastSuccess)/864e5;u=u||I>=1||I<-1||g.getDate()!==b.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:re,skuId:ui,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=n)},h):this.processRequests()}},Ei=Jt.postTurnstileEvent.bind(Jt),Ot=new class extends We{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,n,u){this.skuToken=t,this.errorCb=u,r.e.EVENTS_URL&&(n||r.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},n):this.errorCb(new Error(Si)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:re,skuId:ui,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},ji=Ot.postMapLoadEvent.bind(Ot),An=new class extends We{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=r.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:n,style:u,importedStyles:p}=t;if(!r.e.EVENTS_URL||!h&&!r.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(n),b={mapInstanceId:g,eventId:this.getEventId(g),style:u};p.length&&(b.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:b},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},h)}},Xi=An.postStyleLoadEvent.bind(An),nr=new class extends We{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){r.e.EVENTS_URL&&(h||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),u=function(p){const g=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),I=function($){const Q={};if($){for(const W in $)if(W!=="other")for(const te of $[W]){const ne=`${W}ResolveRangeMin`,ce=`${W}ResolveRangeMax`,me=`${W}RequestCount`,fe=`${W}RequestCachedCount`;Q[ne]=Math.min(Q[ne]||1/0,te.startTime),Q[ce]=Math.max(Q[ce]||-1/0,te.responseEnd);const we=ye=>{Q[ye]===void 0&&(Q[ye]=0),++Q[ye]};te.transferSize!==void 0&&te.transferSize===0&&we(fe),we(me)}}return Q}(function($,Q){const W={};if($)for(const te of $){const ne=Q(te);W[ne]===void 0&&(W[ne]=[]),W[ne].push(te)}return W}(g,ze)),L=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=P?P.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},j=($,Q,W)=>{W!=null&&$.push({name:Q,value:W.toString()})};for(const $ in I)j(U.counters,$,I[$]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(j(U.counters,"interactionRangeMin",p.interactionRange[0]),j(U.counters,"interactionRangeMax",p.interactionRange[1])),b)for(const $ of Object.keys(J)){const Q=J[$],W=b.find(te=>te.name===Q);W&&j(U.counters,Q,W.startTime)}return j(U.counters,"visibilityHidden",p.visibilityHidden),j(U.attributes,"style",function($){if($)for(const Q of $){const W=Q.name.split("?")[0];if(r.i(W)){const te=W.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}}(g)),j(U.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),j(U.attributes,"fogEnabled",p.fogEnabled?"true":"false"),j(U.attributes,"projection",p.projection),j(U.attributes,"zoom",p.zoom),j(U.metadata,"devicePixelRatio",L),j(U.metadata,"connectionEffectiveType",k),j(U.metadata,"navigatorUserAgent",navigator.userAgent),j(U.metadata,"screenWidth",window.screen.width),j(U.metadata,"screenHeight",window.screen.height),j(U.metadata,"windowWidth",window.innerWidth),j(U.metadata,"windowHeight",window.innerHeight),j(U.metadata,"mapWidth",p.width/L),j(U.metadata,"mapHeight",p.height/L),j(U.metadata,"webglRenderer",p.renderer),j(U.metadata,"webglVendor",p.vendor),j(U.metadata,"sdkVersion",re),j(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(n);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},h)}},sr=nr.postPerformanceEvent.bind(nr),Aa=new class extends We{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,n,u){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const p=pt(r.e.API_URL+r.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||r.e.ACCESS_TOKEN||""}`);const g={url:ni(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(g,b=>{this.pendingRequest=null,n(b),this.saveEventData(),this.processRequests(u)})}getSessionAPI(h,t,n,u){this.skuToken=t,this.errorCb=u,r.e.SESSION_PATH&&r.e.API_URL&&(n||r.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},n):this.errorCb(new Error(Si)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},de=Aa.getSessionAPI.bind(Aa),us=new Set;function Ts(h,t){t?us.add(h):us.delete(h)}class ks{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ft(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ss extends r.E{constructor(t){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.y),this._imageRasterizer}createScope(t){this._images[t]={},this._iconsets[t]={},this.loaded[t]=!1,this.updatedImages[t]=new Set,this.patterns[t]={},this.callbackDispatchedThisFrame[t]=new Set,this.atlasImage[t]=new r.r({width:1,height:1})}createIconset(t,n){this._iconsets[t][n]={}}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,n,p);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return(t.iconsetId?this._iconsets[n][t.iconsetId]:this._images[n])[t.name]}addImage(t,n,u){const p=t.iconsetId?this._iconsets[n][t.iconsetId]:this._images[n];this._validate(t,u)&&(p[t.name]=u)}_validate(t,n){let u=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(n.content,n)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,n){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||n<p[1])return!1;u=p[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,u){const p=t.iconsetId?this._iconsets[n][t.iconsetId]:this._images[n];u.version=p[t.name].version+1,p[t.name]=u,this.updatedImages[n].add(t),this.removeFromImageRasterizerCache(t,n)}clearUpdatedImages(t){this.updatedImages[t].clear()}removeFromImageRasterizerCache(t,n){if(this.spriteFormat!=="raster")if(r.t()){const u={imageIds:[t],scope:n};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",u)}else this.imageRasterizer.removeImagesFromCacheByIds([t],n)}removeImage(t,n){const u=t.iconsetId?this._iconsets[n][t.iconsetId]:this._images[n],p=u[t.name];delete u[t.name],delete this.patterns[n][t.name],this.removeFromImageRasterizerCache(t,n),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(t){const n=[];for(const u of Object.keys(this._images[t]))n.push(new r.I(u));for(const u in this._iconsets[t])for(const p of Object.keys(this._iconsets[t][u]))n.push(new r.I({name:p,iconsetId:u}));return n}getImages(t,n,u){let p=!0;const g=!!this.loaded[n];if(!g)for(const b of t)(b.iconsetId?this._iconsets[n][b.iconsetId]:this._images[n])[b.name]||(p=!1);g||p?this._notify(t,n,u):this.requestors.push({ids:t,scope:n,callback:u})}rasterizeImages({scope:t,tasks:n},u){const p=new Map;for(const[g,b]of n.entries()){const I=this.getImage(b.id,t);I&&p.set(g,{image:I,imageVariant:b})}this._rasterizeImages(t,p,u)}_rasterizeImages(t,n,u){if(r.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:n,scope:t},u);else{const p=new Map;for(const[g,{image:b,imageVariant:I}]of n.entries())p.set(g,this.imageRasterizer.rasterize(I,b,t,0));u(void 0,p)}}getUpdatedImages(t){return this.updatedImages[t]||new Set}_notify(t,n,u){const p=new Map;for(const g of t){g.iconsetId&&(this._iconsets[n][g.iconsetId]=this._iconsets[n][g.iconsetId]||{});const b=(g.iconsetId?this._iconsets[n][g.iconsetId]:this._images[n])[g.name];if(!b){if(g.iconsetId)continue;r.w(`Image "${g.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new r.A("styleimagemissing",{id:g.name}));continue}const I={data:b.usvg?null:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,usvg:b.usvg,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)};b.usvg&&Object.assign(I,{width:b.icon.usvg_tree.width,height:b.icon.usvg_tree.height}),p.set(r.I.toString(g),I)}u(null,p)}getPixelSize(t){const{width:n,height:u}=this.atlasImage[t];return{width:n,height:u}}getPattern(t,n,u){const p=this.patterns[n][t.name],g=this.getImage(t,n);if(!g)return null;if(p){if(p.position.version===g.version)return p.position;p.position.version=g.version}else{if(g.usvg&&!g.data){const b=this.getPatternInFlightId(t.toString(),n);if(this.patternsInFlight.has(b))return null;this.patternsInFlight.add(b);const I=new r.B(t).scaleSelf(r.q.devicePixelRatio),L=new Map([[I.toString(),{image:g,imageVariant:I}]]);return this._rasterizeImages(n,L,(P,k)=>this.storePatternImage(I,n,g,u,k)),null}this.storePattern(t,n,g)}return this._updatePatternAtlas(n,u),this.patterns[n][t.name].position}getPatternInFlightId(t,n){return r.C(t,n)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,n,u,p,g){const b=t.toString(),I=g?g.get(b):void 0;I&&(u.data=I,this.storePattern(t.id,n,u),this._updatePatternAtlas(n,p),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),n)))}storePattern(t,n,u){const p={w:u.data.width+2*r.F,h:u.data.height+2*r.F,x:0,y:0},g=new r.G(p,u,r.F);this.patterns[n][t.name]={bin:p,position:g}}bind(t,n){const u=t.gl;let p=this.atlasTexture[n];p?this.dirty&&(p.update(this.atlasImage[n]),this.dirty=!1):(p=new r.T(t,this.atlasImage[n],u.RGBA8),this.atlasTexture[n]=p),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const u=[];for(const I in this.patterns[t])u.push(this.patterns[t][I].bin);const{w:p,h:g}=r.H(u),b=this.atlasImage[t];b.resize({width:p||1,height:g||1});for(const I in this.patterns[t]){const{bin:L,position:P}=this.patterns[t][I];let k=P.padding;const U=L.x+k,j=L.y+k,$=this._images[t][I].data,Q=$.width,W=$.height;k=k>1?k-1:k,r.r.copy($,b,{x:0,y:0},{x:U,y:j},{width:Q,height:W},n),r.r.copy($,b,{x:0,y:W-k},{x:U,y:j-k},{width:Q,height:k},n),r.r.copy($,b,{x:0,y:0},{x:U,y:j+W},{width:Q,height:k},n),r.r.copy($,b,{x:Q-k,y:0},{x:U-k,y:j},{width:k,height:W},n),r.r.copy($,b,{x:0,y:0},{x:U+Q,y:j},{width:k,height:W},n),r.r.copy($,b,{x:Q-k,y:W-k},{x:U-k,y:j-k},{width:k,height:k},n),r.r.copy($,b,{x:0,y:W-k},{x:U+Q,y:j-k},{width:k,height:k},n),r.r.copy($,b,{x:0,y:0},{x:U+Q,y:j+W},{width:k,height:k},n),r.r.copy($,b,{x:Q-k,y:0},{x:U-k,y:j+W},{width:k,height:k},n)}this.dirty=!0}beginFrame(){for(const t in this._images)this.callbackDispatchedThisFrame[t]=new Set}dispatchRenderCallbacks(t,n){for(const u of t){if(this.callbackDispatchedThisFrame[n].has(u.toString()))continue;this.callbackDispatchedThisFrame[n].add(u.toString());const p=(u.iconsetId?this._iconsets[n][u.iconsetId]:this._images[n])[u.name];Ft(p)&&this.updateImage(u,n,p)}}}function ya(h){const t=h.key,n=h.value,u=h.valueSpec||{},p=h.objectElementValidators||{},g=h.style,b=h.styleSpec;let I=[];const L=r.K(n);if(L!=="object")return[new r.V(t,n,`object expected, ${L} found`)];for(const P in n){const k=P.split(".")[0];let U;p[k]?U=p[k]:u[k]?U=Nn:p["*"]?U=p["*"]:u["*"]&&(U=Nn),U?I=I.concat(U({key:(t&&`${t}.`)+P,value:n[P],valueSpec:u[k]||u["*"],style:g,styleSpec:b,object:n,objectKey:P},n)):I.push(new r.J(t,n[P],`unknown property "${P}"`))}for(const P in u)p[P]||u[P].required&&u[P].default===void 0&&n[P]===void 0&&I.push(new r.V(t,n,`missing required property "${P}"`));return I}function qr(h){const t=h.value,n=h.valueSpec,u=h.style,p=h.styleSpec,g=h.key,b=h.arrayElementValidator||Nn;if(r.K(t)!=="array")return[new r.V(g,t,`array expected, ${r.K(t)} found`)];if(n.length&&t.length!==n.length)return[new r.V(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new r.V(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let I={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};p.$version<7&&(I.function=n.function),r.K(n.value)==="object"&&(I=n.value);let L=[];for(let P=0;P<t.length;P++)L=L.concat(b({array:t,arrayIndex:P,value:t[P],valueSpec:I,style:u,styleSpec:p,key:`${g}[${P}]`},!0));return L}function ln(h){const t=h.key,n=h.value,u=h.valueSpec;let p=r.K(n);if(p==="number"&&n!=n&&(p="NaN"),p!=="number")return[new r.V(t,n,`number expected, ${p} found`)];if("minimum"in u){let g=u.minimum;if(r.K(u.minimum)==="array"&&(g=u.minimum[h.arrayIndex]),n<g)return[new r.V(t,n,`${n} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if(r.K(u.maximum)==="array"&&(g=u.maximum[h.arrayIndex]),n>g)return[new r.V(t,n,`${n} is greater than the maximum value ${g}`)]}return[]}function Br(h){const t=h.valueSpec,n=r.M(h.value.type);let u,p,g,b={};const I=n!=="categorical"&&h.value.property===void 0,L=!I,P=r.K(h.value.stops)==="array"&&r.K(h.value.stops[0])==="array"&&r.K(h.value.stops[0][0])==="object",k=ya({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function($){if(n==="identity")return[new r.V($.key,$.value,'identity function may not have a "stops" property')];let Q=[];const W=$.value;return Q=Q.concat(qr({key:$.key,value:W,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:U})),r.K(W)==="array"&&W.length===0&&Q.push(new r.V($.key,W,"array must have at least one stop")),Q},default:function($){return Nn({key:$.key,value:$.value,valueSpec:t,style:$.style,styleSpec:$.styleSpec})}}});return n==="identity"&&I&&k.push(new r.V(h.key,h.value,'missing required property "property"')),n==="identity"||h.value.stops||k.push(new r.V(h.key,h.value,'missing required property "stops"')),n==="exponential"&&h.valueSpec.expression&&!r.N(h.valueSpec)&&k.push(new r.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(L&&!r.O(h.valueSpec)?k.push(new r.V(h.key,h.value,"property functions not supported")):I&&!r.Q(h.valueSpec)&&k.push(new r.V(h.key,h.value,"zoom functions not supported"))),n!=="categorical"&&!P||h.value.property!==void 0||k.push(new r.V(h.key,h.value,'"property" property is required')),k;function U($){let Q=[];const W=$.value,te=$.key;if(r.K(W)!=="array")return[new r.V(te,W,`array expected, ${r.K(W)} found`)];if(W.length!==2)return[new r.V(te,W,`array length 2 expected, length ${W.length} found`)];if(P){if(r.K(W[0])!=="object")return[new r.V(te,W,`object expected, ${r.K(W[0])} found`)];if(W[0].zoom===void 0)return[new r.V(te,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new r.V(te,W,"object stop key must have value")];const ne=r.M(W[0].zoom);if(typeof ne!="number")return[new r.V(te,W[0].zoom,"stop zoom values must be numbers")];if(g&&g>ne)return[new r.V(te,W[0].zoom,"stop zoom values must appear in ascending order")];ne!==g&&(g=ne,p=void 0,b={}),Q=Q.concat(ya({key:`${te}[0]`,value:W[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:ln,value:j}}))}else Q=Q.concat(j({key:`${te}[0]`,value:W[0],style:$.style,styleSpec:$.styleSpec},W));return r.S(r.U(W[1]))?Q.concat([new r.V(`${te}[1]`,W[1],"expressions are not allowed in function stops.")]):Q.concat(Nn({key:`${te}[1]`,value:W[1],valueSpec:t,style:$.style,styleSpec:$.styleSpec}))}function j($,Q){const W=r.K($.value),te=r.M($.value),ne=$.value!==null?$.value:Q;if(u){if(W!==u)return[new r.V($.key,ne,`${W} stop domain type must match previous stop domain type ${u}`)]}else u=W;if(W!=="number"&&W!=="string"&&W!=="boolean"&&typeof te!="number"&&typeof te!="string"&&typeof te!="boolean")return[new r.V($.key,ne,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&n!=="categorical"){let ce=`number expected, ${W} found`;return r.O(t)&&n===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V($.key,ne,ce)]}return n!=="categorical"||W!=="number"||typeof te=="number"&&isFinite(te)&&Math.floor(te)===te?n!=="categorical"&&W==="number"&&typeof te=="number"&&typeof p=="number"&&p!==void 0&&te<p?[new r.V($.key,ne,"stop domain values must appear in ascending order")]:(p=te,n==="categorical"&&te in b?[new r.V($.key,ne,"stop domain values must be unique")]:(b[te]=!0,[])):[new r.V($.key,ne,`integer expected, found ${String(te)}`)]}}function Bs(h){const t=(h.expressionContext==="property"?r.W:r.X)(r.U(h.value),h.valueSpec);if(t.result==="error")return t.value.map(u=>new r.V(`${h.key}${u.key}`,h.value,u.message));const n=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!n.outputDefined())return[new r.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!r.Y(n))return[new r.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Es(n,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!r.Z(n,["zoom","feature-state"]))return[new r.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!r._(n))return[new r.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Es(h,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)n.delete(p);if(n.size===0)return[];const u=[];return h instanceof r.$&&n.has(h.name)?[new r.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(p=>{u.push(...Es(p,t))}),u)}function Qe(h){const t=h.key,n=h.value,u=h.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(r.M(n))===-1&&p.push(new r.V(t,n,`expected one of [${u.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(u.values).indexOf(r.M(n))===-1&&p.push(new r.V(t,n,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function Mt(h){return r.a1(r.U(h.value))?Bs(r.L({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):vt(h)}function vt(h){const t=h.value,n=h.key;if(r.K(t)!=="array")return[new r.V(n,t,`array expected, ${r.K(t)} found`)];const u=h.styleSpec;let p,g=[];if(t.length<1)return[new r.V(n,t,"filter array must have at least 1 element")];switch(g=g.concat(Qe({key:`${n}[0]`,value:t[0],valueSpec:u.filter_operator,style:h.style,styleSpec:h.styleSpec})),r.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.M(t[1])==="$type"&&g.push(new r.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new r.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=r.K(t[1]),p!=="string"&&g.push(new r.V(`${n}[1]`,t[1],`string expected, ${p} found`)));for(let b=2;b<t.length;b++)p=r.K(t[b]),r.M(t[1])==="$type"?g=g.concat(Qe({key:`${n}[${b}]`,value:t[b],valueSpec:u.geometry_type,style:h.style,styleSpec:h.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new r.V(`${n}[${b}]`,t[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)g=g.concat(vt({key:`${n}[${b}]`,value:t[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":p=r.K(t[1]),t.length!==2?g.push(new r.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new r.V(`${n}[1]`,t[1],`string expected, ${p} found`))}return g}function bi(h,t){const n=h.key,u=h.style,p=h.layer,g=h.styleSpec,b=h.value,I=h.objectKey,L=g[`${t}_${h.layerType}`];if(!L)return[];const P=I.match(/^(.*)-use-theme$/);if(t==="paint"&&P&&L[P[1]])return r.S(b)?[].concat(Nn({key:h.key,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:I})):Nn({key:n,value:b,valueSpec:{type:"string"},style:u,styleSpec:g});const k=I.match(/^(.*)-transition$/);if(t==="paint"&&k&&L[k[1]]&&L[k[1]].transition)return Nn({key:n,value:b,valueSpec:g.transition,style:u,styleSpec:g});const U=h.valueSpec||L[I];if(!U)return[new r.J(n,b,`unknown property "${I}"`)];let j;if(r.K(b)==="string"&&r.O(U)&&!U.tokens&&(j=/^{([^}]+)}$/.exec(b))){const Q=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new r.V(n,b,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${Q}.`)]}const $=[];if(h.layerType==="symbol")I!=="text-field"||!u||u.glyphs||u.imports||$.push(new r.V(n,b,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&r.a2(r.U(b))&&r.M(b.type)==="identity"&&$.push(new r.V(n,b,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&r.O(U)&&(r.a3(U)||r.Q(U))){const Q=r.W(r.U(b),U),W=Q.value.expression||Q.value._styleExpression.expression;W&&!r.Z(W,["measure-light"])&&(I==="model-emissive-strength"&&r._(W)&&r.Y(W)||$.push(new r.V(n,b,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return $.concat(Nn({key:h.key,value:b,valueSpec:U,style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:I}))}function gi(h){return bi(h,"paint")}function ri(h){return bi(h,"layout")}function vi(h){let t=[];const n=h.value,u=h.key,p=h.style,g=h.styleSpec;n.type||n.ref||t.push(new r.V(u,n,'either "type" or "ref" is required'));let b=r.M(n.type);const I=r.M(n.ref);if(n.id){const L=r.M(n.id);for(let P=0;P<h.arrayIndex;P++){const k=p.layers[P];r.M(k.id)===L&&t.push(new r.V(u,n.id,`duplicate layer id "${n.id}", previously used at line ${k.id.__line__}`))}}if("ref"in n){let L;["type","source","source-layer","filter","layout"].forEach(P=>{P in n&&t.push(new r.V(u,n[P],`"${P}" is prohibited for ref layers`))}),p.layers.forEach(P=>{r.M(P.id)===I&&(L=P)}),L?L.ref?t.push(new r.V(u,n.ref,"ref cannot reference another ref layer")):b=r.M(L.type):typeof I=="string"&&t.push(new r.V(u,n.ref,`ref layer "${I}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(n.source){const L=p.sources&&p.sources[n.source],P=L&&r.M(L.type);L?P==="vector"&&b==="raster"?t.push(new r.V(u,n.source,`layer "${n.id}" requires a raster source`)):P==="raster"&&b!=="raster"?t.push(new r.V(u,n.source,`layer "${n.id}" requires a vector source`)):P!=="vector"||n["source-layer"]?P==="raster-dem"&&b!=="hillshade"?t.push(new r.V(u,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||P==="geojson"&&L.lineMetrics?b==="raster-particle"&&P!=="raster-array"&&t.push(new r.V(u,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new r.V(u,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new r.V(u,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(u,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new r.V(u,n.source,`source "${n.source}" not found`))}else t.push(new r.V(u,n,'missing required property "source"'));return t=t.concat(ya({key:u,value:n,valueSpec:g.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Nn({key:`${u}.type`,value:n.type,valueSpec:g.layer.type,style:h.style,styleSpec:h.styleSpec,object:n,objectKey:"type"}),filter:L=>Mt(r.L({layerType:b},L)),layout:L=>ya({layer:n,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":P=>ri(r.L({layerType:b},P))}}),paint:L=>ya({layer:n,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":P=>gi(r.L({layerType:b,layer:n},P))}})}})),t}function sn(h){const t=h.value,n=h.key,u=r.K(t);return u!=="string"?[new r.V(n,t,`string expected, ${u} found`)]:[]}const or={promoteId:function h({key:t,value:n}){if(r.K(n)==="string")return sn({key:t,value:n});if(Array.isArray(n)){const u=[],p=r.U(n),g=r.X(p);return g.result==="error"&&g.value.forEach(b=>{u.push(new r.V(`${t}${b.key}`,null,`${b.message}`))}),r.Z(g.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in n)u.push(...h({key:`${t}.${p}`,value:n[p]}));return u}}};function Gr(h){const t=h.value,n=h.key,u=h.styleSpec,p=h.style;if(!t.type)return[new r.V(n,t,'"type" is required')];const g=r.M(t.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(t.url||t.tiles||b.push(new r.J(n,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(ya({key:n,value:t,valueSpec:u[`source_${g.replace("-","_")}`],style:h.style,styleSpec:u,objectElementValidators:or})),b;case"geojson":if(b=ya({key:n,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:or}),t.cluster)for(const I in t.clusterProperties){const[L,P]=t.clusterProperties[I],k=typeof L=="string"?[L,["accumulated"],["get",I]]:L;b.push(...Bs({key:`${n}.${I}.map`,value:P,expressionContext:"cluster-map"})),b.push(...Bs({key:`${n}.${I}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return b;case"video":return ya({key:n,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return ya({key:n,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new r.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qe({key:`${n}.type`,value:t.type,valueSpec:{values:hc(u)}})}}function hc(h){return h.source.reduce((t,n)=>{const u=h[n];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function hs(h){const t=h.value,n=h.styleSpec,u=n.light,p=h.style;let g=[];const b=r.K(t);if(t===void 0)return g;if(b!=="object")return g=g.concat([new r.V("light",t,`object expected, ${b} found`)]),g;for(const I in t){const L=I.match(/^(.*)-transition$/),P=I.match(/^(.*)-use-theme$/);g=g.concat(P&&u[P[1]]?Nn({key:I,value:t[I],valueSpec:{type:"string"},style:p,styleSpec:n}):L&&u[L[1]]&&u[L[1]].transition?Nn({key:I,value:t[I],valueSpec:n.transition,style:p,styleSpec:n}):u[I]?Nn({key:I,value:t[I],valueSpec:u[I],style:p,styleSpec:n}):[new r.V(I,t[I],`unknown property "${I}"`)])}return g}function ds(h){const t=h.value;let n=[];if(!t)return n;const u=r.K(t);if(u!=="object")return n=n.concat([new r.V("light-3d",t,`object expected, ${u} found`)]),n;const p=h.styleSpec,g=p["light-3d"],b=h.key,I=h.style,L=h.style.lights;for(const U of["type","id"])if(!(U in t))return n=n.concat([new r.V("light-3d",t,`missing property ${U} on light`)]),n;if(t.type&&L)for(let U=0;U<h.arrayIndex;U++){const j=r.M(t.type),$=L[U];r.M($.type)===j&&n.push(new r.V(b,t.id,`duplicate light type "${t.type}", previously defined at line ${$.id.__line__}`))}const P=`properties_light_${t.type}`;if(!(P in p))return n=n.concat([new r.V("light-3d",t,`Invalid light type ${t.type}`)]),n;const k=p[P];for(const U in t)if(U==="properties"){const j=t[U],$=r.K(j);if($!=="object")return n=n.concat([new r.V("properties",j,`object expected, ${$} found`)]),n;for(const Q in j)n=n.concat(k[Q]?Nn({key:Q,value:j[Q],valueSpec:k[Q],style:I,styleSpec:p}):[new r.J(h.key,j[Q],`unknown property "${Q}"`)])}else{const j=U.match(/^(.*)-transition$/),$=U.match(/^(.*)-use-theme$/);n=n.concat($&&g[$[1]]?Nn({key:U,value:t[U],valueSpec:{type:"string"},style:I,styleSpec:p}):j&&g[j[1]]&&g[j[1]].transition?Nn({key:U,value:t[U],valueSpec:p.transition,style:I,styleSpec:p}):g[U]?Nn({key:U,value:t[U],valueSpec:g[U],style:I,styleSpec:p}):[new r.J(U,t[U],`unknown property "${U}"`)])}return n}function Wr(h){const t=h.value,n=h.key,u=h.style,p=h.styleSpec,g=p.terrain;let b=[];const I=r.K(t);if(t===void 0||I==="null")return b;if(I!=="object")return b=b.concat([new r.V("terrain",t,`object expected, ${I} found`)]),b;for(const L in t){const P=L.match(/^(.*)-transition$/),k=L.match(/^(.*)-use-theme$/);b=b.concat(k&&g[k[1]]?Nn({key:L,value:t[L],valueSpec:{type:"string"},style:u,styleSpec:p}):P&&g[P[1]]&&g[P[1]].transition?Nn({key:L,value:t[L],valueSpec:p.transition,style:u,styleSpec:p}):g[L]?Nn({key:L,value:t[L],valueSpec:g[L],style:u,styleSpec:p}):[new r.J(L,t[L],`unknown property "${L}"`)])}if(t.source){const L=u.sources&&u.sources[t.source],P=L&&r.M(L.type);L?P!=="raster-dem"&&b.push(new r.V(n,t.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):b.push(new r.V(n,t.source,`source "${t.source}" not found`))}else b.push(new r.V(n,t,'terrain is missing required property "source"'));return b}function Ns(h){const t=h.value,n=h.style,u=h.styleSpec,p=u.fog;let g=[];const b=r.K(t);if(t===void 0)return g;if(b!=="object")return g=g.concat([new r.V("fog",t,`object expected, ${b} found`)]),g;for(const I in t){const L=I.match(/^(.*)-transition$/),P=I.match(/^(.*)-use-theme$/);g=g.concat(P&&p[P[1]]?Nn({key:I,value:t[I],valueSpec:{type:"string"},style:n,styleSpec:u}):L&&p[L[1]]&&p[L[1]].transition?Nn({key:I,value:t[I],valueSpec:u.transition,style:n,styleSpec:u}):p[I]?Nn({key:I,value:t[I],valueSpec:p[I],style:n,styleSpec:u}):[new r.J(I,t[I],`unknown property "${I}"`)])}return g}const Kn={"*":()=>[],array:qr,boolean:function(h){const t=h.value,n=h.key,u=r.K(t);return u!=="boolean"?[new r.V(n,t,`boolean expected, ${u} found`)]:[]},number:ln,color:function(h){const t=h.key,n=h.value,u=r.K(n);return u!=="string"?[new r.V(t,n,`color expected, ${u} found`)]:r.a0.parseCSSColor(n)===null?[new r.V(t,n,`color expected, "${n}" found`)]:[]},enum:Qe,filter:Mt,function:Br,layer:vi,object:ya,source:Gr,model:r.a4,light:hs,"light-3d":ds,terrain:Wr,fog:Ns,string:sn,formatted:function(h){return sn(h).length===0?[]:Bs(h)},resolvedImage:function(h){return sn(h).length===0?[]:Bs(h)},projection:function(h){const t=h.value,n=h.styleSpec,u=n.projection,p=h.style;let g=[];const b=r.K(t);if(b==="object")for(const I in t)g=g.concat(Nn({key:I,value:t[I],valueSpec:u[I],style:p,styleSpec:n}));else b!=="string"&&(g=g.concat([new r.V("projection",t,`object or string expected, ${b} found`)]));return g},import:function(h){const{value:t,styleSpec:n}=h,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let g=ya(r.L({},h,{value:p,valueSpec:n.import}));return r.M(p.id)===""&&g.push(new r.V(`${h.key}.id`,p,"import id can't be an empty string")),u&&(g=g.concat(dc(u,n,{key:`${h.key}.data`}))),g},iconset:function(h){const t=h.value,n=h.key,u=h.styleSpec,p=h.style;if(!t.type)return[new r.V(n,t,'"type" is required')];const g=r.M(t.type);let b=[];if(b=b.concat(ya({key:n,value:t,valueSpec:u[`iconset_${g}`],style:p,styleSpec:u})),g==="source"&&t.source){const I=p.sources&&p.sources[t.source],L=I&&r.M(I.type);I?L!=="raster-array"&&b.push(new r.V(n,t.source,`iconset cannot be used with a source of type ${String(L)}, it only be used with a "raster-array" source type`)):b.push(new r.V(n,t.source,`source "${t.source}" not found`))}return b}};function Nn(h,t=!1){const n=h.value,u=h.valueSpec,p=h.styleSpec;if(u.expression&&r.a2(r.M(n)))return Br(h);if(u.expression&&r.S(r.U(n)))return Bs(h);if(u.type&&Kn[u.type]){const g=Kn[u.type](h);return t===!0&&g.length>0&&r.K(h.value)==="array"?Bs(h):g}return ya(r.L({},h,{valueSpec:u.type?p[u.type]:u}))}function bu(h){const t=h.value,n=h.key,u=sn(h);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new r.V(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new r.V(n,t,'"glyphs" url must include a "{range}" token'))),u}function dc(h,t=r.a5,n={}){return Nn({key:n.key||"",value:h,valueSpec:t.$root,styleSpec:t,style:h,objectElementValidators:{glyphs:bu,"*":()=>[]}})}function Ma(h,t=r.a5){return Oe(dc(h,t))}const so=h=>Oe(Gr(h)),fh=h=>Oe(hs(h)),fc=h=>Oe(ds(h)),ph=h=>Oe(Wr(h)),wu=h=>Oe(Ns(h)),pc=h=>Oe(function(t){const n=t.value,u=t.style,p=t.styleSpec,g=p.snow;let b=[];const I=r.K(n);if(n===void 0)return b;if(I!=="object")return b=b.concat([new r.V("snow",n,`object expected, ${I} found`)]),b;for(const L in n){const P=L.match(/^(.*)-transition$/);b=b.concat(P&&g[P[1]]&&g[P[1]].transition?Nn({key:L,value:n[L],valueSpec:p.transition,style:u,styleSpec:p}):g[L]?Nn({key:L,value:n[L],valueSpec:g[L],style:u,styleSpec:p}):[new r.J(L,n[L],`unknown property "${L}"`)])}return b}(h)),at=h=>Oe(function(t){const n=t.value,u=t.style,p=t.styleSpec,g=p.rain;let b=[];const I=r.K(n);if(n===void 0)return b;if(I!=="object")return b=b.concat([new r.V("rain",n,`object expected, ${I} found`)]),b;for(const L in n){const P=L.match(/^(.*)-transition$/);b=b.concat(P&&g[P[1]]&&g[P[1]].transition?Nn({key:L,value:n[L],valueSpec:p.transition,style:u,styleSpec:p}):g[L]?Nn({key:L,value:n[L],valueSpec:g[L],style:u,styleSpec:p}):[new r.J(L,n[L],`unknown property "${L}"`)])}return b}(h)),ie=h=>Oe(vi(h)),ae=h=>Oe(Mt(h)),ge=h=>Oe(gi(h)),Ae=h=>Oe(ri(h)),Me=h=>Oe(r.a4(h));function Oe(h){return h.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function Je(h,t){let n=!1;if(t&&t.length)for(const u of t)u instanceof r.J?r.w(u.message):(h.fire(new r.z(new Error(u.message))),n=!0);return n}let Be;class it extends r.E{constructor(t,n="flat"){super(),this._transitionable=new r.a6(Be||(Be=new r.a7({anchor:new r.a8(r.a5.light.anchor),position:new r.a9(r.a5.light.position),color:new r.a8(r.a5.light.color),intensity:new r.a8(r.a5.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,u={}){this._validate(fh,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&Je(this,t.call(Ma,r.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let lt=class extends r.E{constructor(h,t,n,u){super(),this.scope=n,this._transitionable=new r.a6(new r.a7({source:new r.a8(r.a5.terrain.source),exaggeration:new r.a8(r.a5.terrain.exaggeration)}),n,u),this._transitionable.setTransitionOrValue(h,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new r.aa(h)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let n=-1,u=-1,p=1;for(const g of t.zoomStops)p=t.evaluate(new r.aa(g)),p>.01?(n=g,u=-1):u=g;return p<.01&&n>0&&u>n?[n,u]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof r.ab}};const rt=45,Dt=65,Ht=.05;function Yt(h,t,n,u){const p=r.ae(rt,Dt,n),[g,b]=zi(h,u);let I=1-Math.min(1,Math.exp((t-g)/(b-g)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*p*h.alpha}function zi(h,t){const n=.5/Math.tan(.5*t);return[h.range[0]+n,h.range[1]+n]}function Ai(h,t,n,u,p){const g=r.ad.vec3.transformMat4([],[t,n,u],p.mercatorFogMatrix);return Yt(h,r.ad.vec3.length(g),p.pitch,p._fov)}function qi(h,t,n,u,p,g,b){const I=[[n,u,0],[p,u,0],[p,g,0],[n,g,0]];let L=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const k of I){const U=r.ad.vec3.transformMat4([],k,t),j=r.ad.vec3.length(U);L=Math.min(L,j),P=Math.max(P,j)}return[Yt(h,L,b.pitch,b._fov),Yt(h,P,b.pitch,b._fov)]}class $i extends r.E{constructor(t,n,u,p){super();const g=new r.a7({range:new r.a8(r.a5.fog.range),color:new r.a8(r.a5.fog.color),"color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a8(r.a5.fog["high-color"]),"high-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a8(r.a5.fog["space-color"]),"space-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a8(r.a5.fog["horizon-blend"]),"star-intensity":new r.a8(r.a5.fog["star-intensity"]),"vertical-range":new r.a8(r.a5.fog["vertical-range"])});this._transitionable=new r.a6(g,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new r.af(g),this.scope=u}get state(){const t=this._transform,n=t.projection.name==="globe",u=r.ag(t.zoom),p=this.properties.get("range"),g=[.5,3];return{range:n?[r.ah(g[0],p[0],u),r.ah(g[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,u={}){if(this._validate(wu,t,u))return;const p=r.l({},t);for(const g of Object.keys(r.a5.fog))p[g]===void 0&&(p[g]=r.a5.fog[g].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ae(rt,Dt,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(u,p,g){const b=r.ac.fromLngLat(p),I=g.elevation?g.elevation.getAtPointOrZero(b):0;return Ai(u,b.x,b.y,I,g)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return qi(this.state,n,0,0,r.ai,r.ai,this._transform)}getOpacityForBounds(t,n,u,p,g){return this._transform.projection.supportsFog?qi(this.state,t,n,u,p,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?zi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const u of n){const p=t.points[u];let g;if(p[2]>=0)g=p;else{const b=t.points[u-4];g=r.aj(b,p,b[2]/(b[2]-p[2]))}if(Ai(this.state,g[0],g[1],0,this._transform)>=Ht)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&Je(this,t.call(Ma,r.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let Fn,Jn,rn,Rn,Dn=class extends r.E{constructor(h,t,n,u){super();const p=Fn||(Fn=new r.a7({density:new r.a8(r.a5.snow.density),intensity:new r.a8(r.a5.snow.intensity),color:new r.a8(r.a5.snow.color),opacity:new r.a8(r.a5.snow.opacity),vignette:new r.a8(r.a5.snow.vignette),"vignette-color":new r.a8(r.a5.snow["vignette-color"]),"center-thinning":new r.a8(r.a5.snow["center-thinning"]),direction:new r.a8(r.a5.snow.direction),"flake-size":new r.a8(r.a5.snow["flake-size"])}));this._transitionable=new r.a6(p,n,new Map(u)),this.set(h,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.af(p),this.scope=n}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=r.ak(n[0]),p=-Math.max(r.ak(n[1]),.01),g=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],b=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.al(t.r,t.g,t.b,t.a*h),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(h,t,n={}){if(this._validate(pc,h,n))return;const u=r.l({},h);for(const p of Object.keys(r.a5.snow))u[p]===void 0&&(u[p]=r.a5.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,n){return(!n||n.validate!==!1)&&Je(this,h.call(Ma,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}},kn=class extends r.E{constructor(h,t,n,u){super();const p=Jn||(Jn=new r.a7({density:new r.a8(r.a5.rain.density),intensity:new r.a8(r.a5.rain.intensity),color:new r.a8(r.a5.rain.color),opacity:new r.a8(r.a5.rain.opacity),vignette:new r.a8(r.a5.rain.vignette),"vignette-color":new r.a8(r.a5.rain["vignette-color"]),"center-thinning":new r.a8(r.a5.rain["center-thinning"]),direction:new r.a8(r.a5.rain.direction),"droplet-size":new r.a8(r.a5.rain["droplet-size"]),"distortion-strength":new r.a8(r.a5.rain["distortion-strength"])}));this._transitionable=new r.a6(p,n,new Map(u)),this.set(h,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.af(p),this.scope=n}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=r.ak(n[0]),p=-Math.max(r.ak(n[1]),.01),g=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.al(t.r,t.g,t.b,t.a*h),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(h,t,n={}){if(this._validate(at,h,n))return;const u=r.l({},h);for(const p of Object.keys(r.a5.rain))u[p]===void 0&&(u[p]=r.a5.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,n){return(!n||n.validate!==!1)&&Je(this,h.call(Ma,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}};class fr extends r.E{constructor(t,n,u,p){super(),this.scope=u,this._options=t,this.properties=new r.af(n),this._transitionable=new r.a6(n,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Nr{constructor(t,n,u,p){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,n){let u,p;if(t instanceof r.P||typeof t[0]=="number"){const g=r.P.convert(t);u=[g],p=n.isPointAboveHorizon(g)}else{const g=r.P.convert(t[0]),b=r.P.convert(t[1]);u=[g,b],p=r.an(g,b).every(I=>n.isPointAboveHorizon(I))}return new Nr(u,n.getCameraPoint(),p,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],p=r.an(n,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(p[3]=this.cameraPoint)),r.ao(p,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],p=r.an(n,u,t),g=this.cameraPoint.clone();switch(3*((g.y>n.y)+(g.y>u.y))+((g.x>n.x)+(g.x>u.x))){case 0:p[0]=g,p[4]=g.clone();break;case 1:p.splice(1,0,g);break;case 2:p[1]=g;break;case 3:p.splice(4,0,g);break;case 5:p.splice(2,0,g);break;case 6:p[3]=g;break;case 7:p.splice(3,0,g);break;case 8:p[2]=g}return p}containsTile(t,n,u,p=0){const g=t.queryPadding/n._pixelsPerMercatorPixel+1,b=u?this._bufferedCameraMercator(g,n):this._bufferedScreenMercator(g,n);let I=t.tileID.wrap+(b.unwrapped?p:0);const L=b.polygon.map(te=>r.ap(t.tileTransform,te,I));if(!r.aq(L,0,0,r.ai,r.ai))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const P=this.screenGeometryMercator.polygon.map(te=>r.ar(t.tileTransform,te,I)),k=P.map(te=>new r.P(te[0],te[1])),U=n.getFreeCameraOptions().position||new r.ac(0,0,0),j=r.ar(t.tileTransform,U,I),$=P.map(te=>{const ne=r.ad.vec3.sub(te,te,j);return r.ad.vec3.normalize(ne,ne),new r.as(j,ne)}),Q=r.at(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:$,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(W=r.au(L),W.min.x=r.ay(W.min.x,0,r.ai),W.min.y=r.ay(W.min.y,0,r.ai),W.max.x=r.ay(W.max.x,0,r.ai),W.max.y=r.ay(W.max.y,0,r.ai),W),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Q};var W}_bufferedScreenMercator(t,n){const u=Ca(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(g=>n.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,n){const u=Ca(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(g=>n.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,n){const u=function(g,b){const I=r.ad.mat4.multiply([],b.pixelMatrix,b.globeMatrix),L=[0,-r.az,0,1],P=[0,r.az,0,1],k=[0,0,0,1];r.ad.vec4.transformMat4(L,L,I),r.ad.vec4.transformMat4(P,P,I),r.ad.vec4.transformMat4(k,k,I);const U=new r.P(L[0]/L[3],L[1]/L[3]),j=new r.P(P[0]/P[3],P[1]/P[3]),$=r.aw(g,U)&&L[3]<k[3],Q=r.aw(g,j)&&P[3]<k[3];if(!$&&!Q)return null;const W=function(ve,xe,Se){for(let Ce=1;Ce<ve.length;Ce++){const Ke=fs(xe.pointCoordinate3D(ve[Ce-1]).x),Ge=fs(xe.pointCoordinate3D(ve[Ce]).x);if(Se<0){if(Ke<Ge)return{idx:Ce,t:-Ke/(Ge-1-Ke)}}else if(Ge<Ke)return{idx:Ce,t:(1-Ke)/(Ge+1-Ke)}}return null}(g,b,$?-1:1);if(!W)return null;const{idx:te,t:ne}=W;let ce=te>1?Mr(g.slice(0,te),b):[],me=te<g.length?Mr(g.slice(te),b):[];ce=ce.map(ve=>new r.P(fs(ve.x),ve.y)),me=me.map(ve=>new r.P(fs(ve.x),ve.y));const fe=[...ce];fe.length===0&&fe.push(me[me.length-1]);const we=r.ah(fe[fe.length-1].y,(me.length===0?ce[0]:me[0]).y,ne);let ye;return ye=$?[new r.P(0,we),new r.P(0,0),new r.P(1,0),new r.P(1,we)]:[new r.P(1,we),new r.P(1,1),new r.P(0,1),new r.P(0,we)],fe.push(...ye),me.length===0?fe.push(ce[0]):fe.push(...me),{polygon:fe.map(ve=>new r.ac(ve.x,ve.y)),unwrapped:!1}}(t,n);if(u)return u;const p=function(g,b){let I=!1,L=-1/0,P=0;for(let U=0;U<g.length-1;U++)g[U].x>L&&(L=g[U].x,P=U);for(let U=0;U<g.length-1;U++){const j=(P+U)%(g.length-1),$=g[j],Q=g[j+1];Math.abs($.x-Q.x)>.5&&($.x<Q.x?($.x+=1,j===0&&(g[g.length-1].x+=1)):(Q.x+=1,j+1===g.length-1&&(g[0].x+=1)),I=!0)}const k=r.av(b.center.lng);return I&&k<Math.abs(k-1)&&g.forEach(U=>{U.x-=1}),{polygon:g,unwrapped:I}}(Mr(t,n).map(g=>new r.P(fs(g.x),g.y)),n);return{polygon:p.polygon.map(g=>new r.ac(g.x,g.y)),unwrapped:p.unwrapped}}}function Mr(h,t){return r.ax(h,n=>{const u=t.pointCoordinate3D(n);n.x=u.x,n.y=u.y},1/256)}function fs(h){return h<0?1+h%1:h%1}function Ca(h){return 100*h|0}function Cr(h,t,n,u,p){const g=function(I,L){if(I)return p(I);if(L){if(h.url&&L.tiles&&h.tiles&&delete h.tiles,L.variants){if(!Array.isArray(L.variants))return p(new Error("variants must be an array"));for(const k of L.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return p(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){L=r.l(L,k);break}}}const P=r.aA(r.l({},L,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);P.tiles=t.canonicalizeTileset(P,h.url),p(null,P)}},b=function(I,L,P){if(!I)return null;if(!L&&!P)return I;P=P||I.worldview_default;const k=Object.values(I.language||{});if(k.length===0)return null;const U=Object.values(I.worldview||{});if(U.length===0)return null;const j=k.every(Q=>Q===L),$=U.every(Q=>Q===P);return j&&$?I:L in(I.language_options||{})||P in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(h.data,n,u);return b?r.q.frame(()=>g(null,b)):h.url?r.n(t.transformRequest(t.normalizeSourceURL(h.url,null,n,u),r.R.Source),g):r.q.frame(()=>{const{data:I,...L}=h;g(null,L)})}class Kr{constructor(t,n,u){this.bounds=r.aB.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),u=Math.floor(r.av(this.bounds.getWest())*n),p=Math.floor(r.aC(this.bounds.getNorth())*n),g=Math.ceil(r.av(this.bounds.getEast())*n),b=Math.ceil(r.aC(this.bounds.getSouth())*n);return t.x>=u&&t.x<g&&t.y>=p&&t.y<b}}class vl extends r.E{constructor(t,n,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.aA(n,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new r.aD}load(t){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Cr(this._options,this.map._requestManager,n,u,(p,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.z(p));else if(g){if(r.l(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of g.vector_layers)this.vectorLayerIds.push(b.id),g.worldview&&g.worldview[b.source]&&this.localizableLayerIds.add(b.id)}g.bounds&&(this.tileBounds=new Kr(g.bounds,this.minzoom,this.maxzoom)),Ei(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(t,n){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),g=this.map._requestManager.transformRequest(p,r.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,I=b?{image:b.image.clone()}:null,L={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(u)&&(L.worldview=this.map.getWorldview()||this.worldviewDefault,L.localizableLayerIds=this.localizableLayerIds),L.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",L,P.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",L,P.bind(this),void 0,!0);else{const k=r.aE.call({deduped:this._deduped},L,(U,j)=>{U||!j?P.call(this,U):(L.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},t.actor&&t.actor.send("loadTile",L,P.bind(this),void 0,!0))},!0);t.request={cancel:k}}function P(k,U){return delete t.request,t.aborted?n(null):k&&k.status!==404?n(k):(U&&U.resourceTiming&&(t.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&t.setExpiryData(U),t.loadVectorData(U,this.map.painter),r.aF(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Fs extends r.E{constructor(t,n,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},n),r.l(this,r.aA(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Cr(this._options,this.map._requestManager,null,null,(n,u)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new r.z(n)):u&&(r.l(this,u),u.raster_layers&&(this.rasterLayers=u.raster_layers,this.rasterLayerIds=this.rasterLayers.map(p=>p.id)),u.bounds&&(this.tileBounds=new Kr(u.bounds,this.minzoom,this.maxzoom)),Ei(u.tiles),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const u=r.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=r.o(this.map._requestManager.transformRequest(p,r.R.Tile),(g,b,I,L)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):g?(t.state="errored",n(g)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:L}),t.setTexture(b,this.map.painter),t.state="loaded",r.aF(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Mo extends Fs{constructor(t,n,u,p){super(t,n,u,p),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=r.l({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);n&&n.enabled&&u&&n._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,r.R.Tile),g={request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor());const b=(I,L,P,k)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(I)return I.name==="AbortError"?void 0:(t.state="errored",n(I));if(this.map._refreshExpiredTiles&&L&&t.setExpiryData({cacheControl:P,expires:k}),this.partial)t.state="empty";else{if(!L)return n(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=L;const U=new Map;for(const j in t._mrt.layers){const $=t.getLayer(j);if($)for(const Q of $.getBandList()){const{bytes:W,tileSize:te,buffer:ne}=$.getBandView(Q),ce=te+2*ne,me={data:new r.r({width:ce,height:ce},W),pixelRatio:2,sdf:!1,usvg:!1,version:0};U.set(`${j}/${Q}`,me)}}for(const j in this.iconsets)this.iconsets[j].addIcons(U)}n(null)};t.request=this.partial?t.fetchHeader(void 0,b.bind(this)):t.actor.send("loadTile",g,b.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){const u=t.texture;u&&u instanceof r.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,n,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(n,u,(p,g)=>{if(p)return t.state="errored",this.fire(new r.z(p)),void this.triggerRepaint(t);g&&(t._isHeaderLoaded=!0,t.setTexture(g,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:g})=>g===t),u=n&&n.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,n,u){if(!t)return;const p=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let g=null;n instanceof r.aI?g=n.paint.get("raster-array-band"):n instanceof r.aJ&&(g=n.paint.get("raster-particle-array-band"));const b=g||this.getInitialBand(p);if(b!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,b)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,b)}addIconset(t,n){this.iconsets[t]=n,this.partial=!1}}const ps={vector:vl,raster:Fs,"raster-dem":class extends Fs{constructor(h,t,n,u){super(h,t,n,u),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const n=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,g){p&&(h.state="errored",t(p)),g&&(h.dem=g,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=r.o(this.map._requestManager.transformRequest(n,r.R.Tile),(function(p,g,b,I){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(p)h.state="errored",t(p);else if(g){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:I});const L=ImageBitmap&&g instanceof ImageBitmap&&r.t(),P=1-(g.width-r.aG(g.width))/2;P<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const k=L?g:r.q.getImageData(g,P),U={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:P};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",U,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,n=Math.pow(2,t.z),u=(t.x-1+n)%n,p=t.x===0?h.wrap-1:h.wrap,g=(t.x+1+n)%n,b=t.x+1===n?h.wrap+1:h.wrap,I={};return I[new r.aH(h.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},I[new r.aH(h.overscaledZ,b,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(I[new r.aH(h.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},I[new r.aH(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new r.aH(h.overscaledZ,b,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<n&&(I[new r.aH(h.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},I[new r.aH(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new r.aH(h.overscaledZ,b,t.z,g,t.y+1).key]={backfilled:!1}),I}},"raster-array":Mo,geojson:class extends r.E{constructor(h,t,n,u){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(u),this._data=t.data,this._options=r.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=r.ai/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:r.ai,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.ai,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new r.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new r.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of h.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,n,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:n},u),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=r.l({append:h},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(r.q.resolveURL(n),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new r.z(u));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g.resourceTiming=p.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new r.A("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const h=r.C(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const n=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,g=this._partialReload,b={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:g};h.request=this.actor.send(n,b,(I,L)=>g&&!L?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):I?t(I):(h.loadVectorData(L,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aK{constructor(h,t,n,u){super(h,t,n,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aL(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new r.z(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new r.z(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aK,model:class extends r.E{constructor(h,t,n,u){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const h=[];for(const t in this._options.models){const n=this._options.models[t],u=r.aN(this.map._requestManager.transformRequest(n.uri,r.R.Model).url).then(p=>{if(!p)return;const g=r.aO(p),b=new r.aP(t,n.position,n.orientation,g);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(p=>{this.fire(new r.z(new Error(`Could not load model ${t} from ${n.uri}: ${p.message}`)))});h.push(u)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new r.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,t){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(h,t,n,u){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=Cr(this._options,this.map._requestManager,t,n,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new r.z(u))):p&&(r.l(this,p),p.bounds&&(this.tileBounds=new Kr(p.bounds,this.minzoom,this.maxzoom)),Ei(p.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),h&&h(u)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const n=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(n,r.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.q.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const g=Object.values(h.buckets);for(const b of g)b.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",u,p.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(g,b){return h.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&b&&h.setExpiryData(b),h.loadModelData(b,this.map.painter),h.state="loaded",void t(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aK{constructor(h,t,n,u){super(h,t,n,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(g=>typeof g!="number"))||this.fire(new r.z(new r.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.z(new r.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.z(new r.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.z(new r.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.z(new r.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof r.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends r.E{constructor(h,t,n,u){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Kr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.aA(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:n,z:u}=h.canonical;return this._implementation.hasTile({x:t,y:n,z:u})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:n,y:u,z:p}=h.tileID.canonical,g=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:n,y:u,z:p},{signal:g.signal})).then((function(b){return delete h.request,h.aborted?(h.state="unloaded",t(null)):b===void 0?(h.state="errored",t(null)):b===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(b)?(this.loadTileData(h,b),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.name!=="AbortError"&&(h.state="errored",t(b))}),h.request.cancel=()=>g.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof r.T?(h.destroy(!0),h.texture&&h.texture instanceof r.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:n,y:u,z:p}=h.tileID.canonical;this._implementation.unloadTile({x:n,y:u,z:p})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=r.C(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}}},mh=function(h,t,n,u){const p=new ps[t.type](h,t,n,u);if(p.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${p.id}`);return r.aQ(["load","abort","unload","serialize","prepare"],p),p};function _h(h,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:g}=u;return`featureset:${p}${g?`:import:${g}`:""}`}}(h.target)}`}function Zo(h,t,n,u=""){if(h.uniqueFeatureID){const p=_h(h,t,u);if(n.has(p))return!0;n.add(p)}return!1}function Ad(h,t,n,u,p=!1){const g=t.sourceCache.transform,b=t.sourceCache.tilesIn(h,t.has3DLayers,p);b.sort(ms);const I=[];for(const L of b){const P=L.tile.queryRenderedFeatures(t,L,n,u,g,p);Object.keys(P).length&&I.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:P})}return I.length===0?{}:function(L){const P={},k={};for(const U of L){const j=U.queryResults,$=U.wrappedTileID,Q=k[$]=k[$]||{};for(const W in j){const te=j[W],ne=Q[W]=Q[W]||{},ce=P[W]=P[W]||[];for(const me of te)ne[me.featureIndex]||(ne[me.featureIndex]=!0,ce.push(me))}}return P}(I)}function gh(h,t,n,u,p){const g={},b=u.queryRenderedSymbols(h),I=[];for(const L of Object.keys(b).map(Number))I.push(p[L]);I.sort(ms);for(const L of I){const P=L.featureIndex.lookupSymbolFeatures(b[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,t,n);for(const k in P){const U=g[k]=g[k]||[],j=P[k];j.sort(($,Q)=>{const W=L.featureSortOrder;if(W){const te=W.indexOf($.featureIndex);return W.indexOf(Q.featureIndex)-te}return Q.featureIndex-$.featureIndex});for(const $ of j)U.push($)}}return g}function am(h,t){const n=h.getRenderableIds().map(g=>h.getTileByID(g)),u=[],p={};for(let g=0;g<n.length;g++){const b=n[g],I=b.tileID.canonical.key;p[I]||(p[I]=!0,b.querySourceFeatures(u,t))}return u}function ms(h,t){const n=h.tileID,u=t.tileID;return n.overscaledZ-u.overscaledZ||n.canonical.y-u.canonical.y||n.wrap-u.wrap||n.canonical.x-u.canonical.x}function xl(h,t){const n={};if(!t)return n;for(const u of h){const p=u.layerIds.map(g=>t.getLayer(g)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(g=>p.filter(b=>b.id===g)[0]));for(const g of p)n[g.fqid]=u}}return n}const _s=32,As=33,Ms=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,n=0,u=0,p=0,g=0,b=0,I=0;for(1&t?p=g=b=_s:n=u=I=_s;(t>>=1)>1;){const P=n+p>>1,k=u+g>>1;1&t?(p=n,g=u,n=b,u=I):(n=p,u=g,p=b,g=I),b=P,I=k}const L=4*h;Ms[L+0]=n,Ms[L+1]=u,Ms[L+2]=p,Ms[L+3]=g}const gs=new Uint16Array(2178),Ya=new Uint8Array(1089),oo=new Uint16Array(1089);function Kf(h){return h===0?-.03125:h===32?.03125:0}const yh={type:2,extent:r.ai,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ai+1,0),new r.P(r.ai+1,r.ai+1),new r.P(0,r.ai+1),new r.P(0,0)]]};class Vs{constructor(t,n,u,p,g){this.tileID=t,this.uid=r.aW(),this.uses=0,this.tileSize=n,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<r.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=xl(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof r.aY){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof r.aY&&g.hasRTLText){this.hasRTLText=!0,r.aZ();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p],b=n.style.getOwnLayer(p);if(!b)continue;const I=b.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.aX}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,xl(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(t)}const n=t.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new r.T(t,u.image,n.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=n.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,n,u,p,g,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(L,P){const k=r.ad.mat4.fromScaling([],[.5*L.width,.5*-L.height,1]);return r.ad.mat4.translate(k,k,[1,-1,0]),r.ad.mat4.multiply(k,k,L.calculateProjMatrix(P.toUnwrapped())),Float32Array.from(k)}(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:I,transform:p,availableImages:u,tileTransform:this.tileTransform})}querySourceFeatures(t,n){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),g=n?n.sourceLayer:"",b=p._geojsonTileLayer||p[g];if(!b)return;const I=r.a_(n&&n.filter),{z:L,x:P,y:k}=this.tileID.canonical,U={z:L,x:P,y:k};for(let j=0;j<b.length;j++){const $=b.feature(j);if(I.needGeometry){const te=r.a$($,!0);if(!I.filter(new r.aa(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!I.filter(new r.aa(this.tileID.overscaledZ),$))continue;const Q=u.getId($,g),W=new r.b0($,L,P,k,Q);W.tile=U,t.push(W)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const u=r.b1(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(n)if(this.expirationTime<n)p=!0;else{const g=this.expirationTime-n;g?this.expirationTime=u+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),g=t.style.getBrightness();for(const b in this.buckets){if(!t.style.hasLayer(b))continue;const I=this.buckets[b],L=I.layers[0],P=L.sourceLayer||"_geojsonTileLayer",k=u[P],U=t.style.getLayerSourceCache(L);let j={};U&&(j=U._state.getState(P,void 0));const $=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Q=Object.keys(j).length>0&&!n;Q&&!I.stateDependentLayers.length&&!n||I.update(j,k,p,$,Q?I.stateDependentLayers:I.layers,n,g),(I instanceof r.b2||I instanceof r.b3)&&t._terrain&&t._terrain.enabled&&U&&I.uploadPending()&&t._terrain._clearRenderCacheForTile(U.id,this.tileID);const W=t&&t.style&&t.style.getOwnLayer(b);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.q.now()+t}setTexture(t,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,n){const u={};for(const p of n)u[p]=!0;this.dependencies[t]=u}hasDependency(t,n){for(const u of t){const p=this.dependencies[u];if(p){for(const g of n)if(p[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const u=r.b4(yh,this.tileID.canonical,this.tileTransform)[0],p=new r.b5,g=new r.b6;for(let b=0;b<u.length;b++){const{x:I,y:L}=u[b];p.emplaceBack(I,L),g.emplaceBack(b)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(p,r.b7.members),this._tileDebugSegments=r.b8.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const u=r.b4(yh,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const b=function(I,L){const P=r.aR(I,L),k=Math.pow(2,I.z);for(let te=0;te<As;te++)for(let ne=0;ne<As;ne++){const ce=r.aS((I.x+(ne+Kf(ne))/_s)/k),me=r.aT((I.y+(te+Kf(te))/_s)/k),fe=L.project(ce,me),we=te*As+ne;gs[2*we+0]=Math.round((fe.x*P.scale-P.x)*r.ai),gs[2*we+1]=Math.round((fe.y*P.scale-P.y)*r.ai)}Ya.fill(0),oo.fill(0);for(let te=2045;te>=0;te--){const ne=4*te,ce=Ms[ne+0],me=Ms[ne+1],fe=Ms[ne+2],we=Ms[ne+3],ye=ce+fe>>1,ve=me+we>>1,xe=ye+ve-me,Se=ve+ce-ye,Ce=me*As+ce,Ke=we*As+fe,Ge=ve*As+ye,ct=Math.hypot((gs[2*Ce+0]+gs[2*Ke+0])/2-gs[2*Ge+0],(gs[2*Ce+1]+gs[2*Ke+1])/2-gs[2*Ge+1])>=16;Ya[Ge]=Ya[Ge]||(ct?1:0),te<1022&&(Ya[Ge]=Ya[Ge]||Ya[(me+Se>>1)*As+(ce+xe>>1)]||Ya[(we+Se>>1)*As+(fe+xe>>1)])}const U=new r.aU,j=new r.aV;let $=0;function Q(te,ne){const ce=ne*As+te;return oo[ce]===0&&(U.emplaceBack(gs[2*ce+0],gs[2*ce+1],te*r.ai/_s,ne*r.ai/_s),oo[ce]=++$),oo[ce]-1}function W(te,ne,ce,me,fe,we){const ye=te+ce>>1,ve=ne+me>>1;if(Math.abs(te-fe)+Math.abs(ne-we)>1&&Ya[ve*As+ye])W(fe,we,te,ne,ye,ve),W(ce,me,fe,we,ye,ve);else{const xe=Q(te,ne),Se=Q(ce,me),Ce=Q(fe,we);j.emplaceBack(xe,Se,Ce)}}return W(0,0,_s,_s,_s,0),W(_s,_s,0,0,0,_s),{vertices:U,indices:j}}(this.tileID.canonical,n);p=b.vertices,g=b.indices}else{p=new r.aU,g=new r.aV;for(const{x:I,y:L}of u)p.emplaceBack(I,L,0,0);const b=r.b9(p.int16,void 0,4);for(let I=0;I<b.length;I+=3)g.emplaceBack(b[I],b[I+1],b[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,r.ba.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=r.b8.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(t,n){const u=n.projection;if(!u||u.name!=="globe"||n.freezeTileCoverage)return;const p=this.tileID.canonical,g=r.bb(p,n),b=r.bc(g),I=r.ag(n.zoom);let L;I>0&&(L=r.ad.mat4.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,n,b,L,I),this._makeGlobeTileDebugTextBuffer(t,p,n,b,L,I)}_globePoint(t,n,u,p,g,b,I){let L=r.bd(t,n,u);if(b){const P=1<<u.z,k=r.av(p.center.lng),U=r.aC(p.center.lat),j=(u.x+.5)/P-k;let $=0;j>.5?$=-1:j<-.5&&($=1);let Q=(t/r.ai+u.x)/P+$,W=(n/r.ai+u.y)/P;Q=(Q-k)*p._pixelsPerMercatorPixel+k,W=(W-U)*p._pixelsPerMercatorPixel+U;const te=[Q*p.worldSize,W*p.worldSize,0];r.ad.vec3.transformMat4(te,te,b),L=r.be(L,te,I)}return r.ad.vec3.transformMat4(L,L,g)}_makeGlobeTileDebugBorderBuffer(t,n,u,p,g,b){const I=new r.b5,L=new r.b6,P=new r.bf,k=(j,$,Q,W,te)=>{const ne=(Q-j)/(te-1),ce=(W-$)/(te-1),me=I.length;for(let fe=0;fe<te;fe++){const we=j+fe*ne,ye=$+fe*ce;I.emplaceBack(we,ye);const ve=this._globePoint(we,ye,n,u,p,g,b);P.emplaceBack(ve[0],ve[1],ve[2]),L.emplaceBack(me+fe)}},U=r.ai;k(0,0,U,0,16),k(U,0,U,U,16),k(U,U,0,U,16),k(0,U,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(L),this._tileDebugBuffer=t.createVertexBuffer(I,r.b7.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,r.bg.members),this._tileDebugSegments=r.b8.simpleSegment(0,0,I.length,L.length)}_makeGlobeTileDebugTextBuffer(t,n,u,p,g,b){const I=r.ai/4,L=new r.b5,P=new r.aV,k=new r.bf,U=25;P.reserve(32),L.reserve(U),k.reserve(U);const j=($,Q)=>U*$+Q;for(let $=0;$<U;$++){const Q=$*I;for(let W=0;W<U;W++){const te=W*I;L.emplaceBack(te,Q);const ne=this._globePoint(te,Q,n,u,p,g,b);k.emplaceBack(ne[0],ne[1],ne[2])}}for(let $=0;$<4;$++)for(let Q=0;Q<4;Q++){const W=j($,Q),te=j($,Q+1),ne=j($+1,Q),ce=j($+1,Q+1);P.emplaceBack(W,te,ne),P.emplaceBack(ne,te,ce)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(L,r.b7.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(k,r.bg.members),this._tileDebugTextSegments=r.b8.simpleSegment(0,0,U,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bh.setPbf(r.bi);class Ia extends Vs{constructor(t,n,u,p,g){super(t,n,u,p,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t,{premultiply:!1}):this.texture=new r.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,n){const u=this._mrt=new r.bh(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bj(p,(g,b,I,L)=>{if(g)n(g);else try{const P=u.getHeaderLength(b);if(P>t)return void(this.request=this.fetchHeader(P,n));u.parseHeader(b),this._isHeaderLoaded=!0;let k=0;for(const U of Object.values(u.layers))k=Math.max(k,U.dataIndex[U.dataIndex.length-1].lastByte);b.byteLength>=k&&(this.entireBuffer=b),n(null,this.entireBuffer||b,I,L)}catch(P){n(P)}}),this.request}fetchBand(t,n,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void u(new Error("Can't fetch tile band without an actor"));let b;const I=(U,j)=>{b.complete(U,j),U?u(U):(this.updateTextureDescriptor(t,n),u(null,this.textureDescriptor&&this.textureDescriptor.img))},L=(U,j)=>{if(U)return u(U);const $=g.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:j,task:b},I,void 0,!0);this._workQueue.push(()=>{$&&$.cancel(),b.cancel()})},P=p.getLayer(t);if(!P)return void u(new Error(`Unknown sourceLayer "${t}"`));if(P.hasDataForBand(n))return this.updateTextureDescriptor(t,n),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const k=P.getDataRange([n]);if(b=p.createDecodingTask(k),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)L(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),j=r.bj(U,L);this._fetchQueue.push(()=>{j.cancel(),b.cancel()})}else u(null)}updateNeeded(t,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,n){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(n)||!u.hasDataForBand(n))return;const{bytes:p,tileSize:g,buffer:b,offset:I,scale:L}=u.getBandView(n),P=g+2*b,k=new r.r({width:P,height:P},p),U=this.texture;U&&U instanceof r.T&&U.update(k,{premultiply:!1}),this.textureDescriptor={layer:t,band:n,img:k,buffer:b,offset:I,tileSize:g,format:u.pixelFormat,mix:[L,256*L,65536*L,16777216*L]}}}class sm{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:n,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},u)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const u=t.wrapped().key,p=n===void 0?0:this.data[u].indexOf(n),g=this.data[u][p];return this.data[u].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||n.push(p);for(const u of n)this.remove(u.value.tileID,u)}}class Jf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,u){const p=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},r.l(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])u[g]||(this.deletedStates[t][p][g]=null)}else for(const g in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,n,u){if(this.deletedStates[t]===null)return;const p=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&n!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,n){const u=this.state[t]||{},p=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(n!==void 0){const I=String(n),L=r.l({},u[I],p[I]);if(g){const P=g[n];if(P===null)return{};for(const k in P)delete L[k]}return L}const b=r.l({},u,p);if(g)for(const I in g)delete b[I];return b}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),r.l(this.state[p][b],this.stateChanges[p][b]),g[b]=this.state[p][b];u[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const b in this.state[p])g[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(this.deletedStates[p][b]===null)this.state[p][b]={};else if(this.state[p][b])for(const I of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][I];g[b]=this.state[p][b]}u[p]=u[p]||{},r.l(u[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(n)}}class Wa extends r.E{constructor(t,n,u){super(),this.id=t,this._onlySymbols=u,n.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new sm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Jf,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const u=this._tiles[n];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Mn).map(t=>t.key)}getRenderableIds(t,n){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,n)&&u.push(this._tiles[p]);return t?u.sort((p,g)=>{const b=p.tileID,I=g.tileID,L=new r.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),P=new r.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-I.overscaledZ||P.y-L.y||P.x-L.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(Mn).map(p=>p.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=n),this._loadTile(u,this._tileLoaded.bind(this,u,t,n)))}_tileLoaded(t,n,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new r.z(p,{tile:t}));else{if(this._source.fire(new r.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let p=0;p<n.length;p++){const g=n[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const b=this.getTileByID(g);u(t,b),u(b,t)}}function u(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let b=g.tileID.canonical.x-p.tileID.canonical.x;const I=g.tileID.canonical.y-p.tileID.canonical.y,L=Math.pow(2,p.tileID.canonical.z),P=g.tileID.key;b===0&&I===0||Math.abs(I)>1||(Math.abs(b)>1&&(Math.abs(b+L)===1?b+=L:Math.abs(b-L)===1&&(b-=L)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,b,I),p.neighboringTiles&&p.neighboringTiles[P]&&(p.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,u,p){for(const g in this._tiles){let b=this._tiles[g];if(p[g]||!b.hasData()||b.tileID.overscaledZ<=n||b.tileID.overscaledZ>u)continue;let I=b.tileID;for(;b&&b.tileID.overscaledZ>n+1;){const P=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[P.key],b&&b.hasData()&&(I=P)}let L=I;for(;L.overscaledZ>n;)if(L=L.scaledTo(L.overscaledZ-1),t[L.key]){p[I.key]=I;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=n?u:null}for(let u=t.overscaledZ-1;u>=n;u--){const p=t.scaledTo(u),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const u=Math.ceil(t.width/n)+1,p=Math.ceil(t.height/n)+1,g=Math.floor(u*p*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(I)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const u={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),u[g.tileID.key]=g}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,n,u,p){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const g=this._source.type==="batched-model";let b,I=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const U=L.attenuationRange()[0],j=Math.floor(U)-Math.log2(L.getDemUpscale());I>j&&(I=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new r.aH(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(this.tileCoverLift!==0){const U=t.clone();U.tileCoverLift=this.tileCoverLift,b=U.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new r.aH(1,0,1,0,0)),b.push(new r.aH(1,0,1,1,0)),b.push(new r.aH(1,0,1,0,1)),b.push(new r.aH(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);b=b.filter(j=>U(j))}}else b=[];if(b.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!vh(this._source.type)){const U=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),j=Math.min(U,this._source.maxzoom);if(g){const $=t.extendTileCover(b,j);for(const Q of $)b.push(Q)}else{const $=t.extendTileCover(b,j,p);for(const Q of $)this._shadowCasterTiles[Q.key]=!0,b.push(Q)}}const P=this._updateRetainedTiles(b);if(vh(this._source.type)&&b.length!==0){const U={},j={},$=Object.keys(P);for(const W of $){const te=P[W],ne=this._tiles[W];if(!ne||ne.fadeEndTime&&ne.fadeEndTime<=r.q.now())continue;const ce=this.findLoadedParent(te,Math.max(te.overscaledZ-Wa.maxOverzooming,this._source.minzoom));ce&&(this._addTile(ce.tileID),U[ce.tileID.key]=ce.tileID),j[W]=te}const Q=b[b.length-1].overscaledZ;for(const W in this._tiles){const te=this._tiles[W];if(P[W]||!te.hasData())continue;let ne=te.tileID;for(;ne.overscaledZ>Q;){ne=ne.scaledTo(ne.overscaledZ-1);const ce=this._tiles[ne.key];if(ce&&ce.hasData()&&j[ne.key]){P[W]=te.tileID;break}}}for(const W in U)P[W]||(this._coveredTiles[W]=!0,P[W]=U[W])}for(const U in P)this._tiles[U].clearFadeHold();const k=r.bk(this._tiles,P);for(const U of k){const j=this._tiles[U];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const u={},p=t.reduce((P,k)=>Math.min(P,k.overscaledZ),1/0),g=t[0].overscaledZ,b=Math.max(g-Wa.maxOverzooming,this._source.minzoom),I=Math.max(g+Wa.maxUnderzooming,this._source.minzoom),L={};for(const P of t){const k=this._addTile(P);n[P.key]=P,k.hasData()||p<this._source.maxzoom&&(L[P.key]=P)}this._retainLoadedChildren(L,p,I,n);for(const P of t){let k=this._tiles[P.key];if(k.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const j=P.children(this._source.maxzoom)[0],$=this.getTile(j);if($&&$.hasData()){n[j.key]=j;continue}}else{const j=P.children(this._source.maxzoom);if(n[j[0].key]&&n[j[1].key]&&n[j[2].key]&&n[j[3].key])continue}let U=k.wasRequested();for(let j=P.overscaledZ-1;j>=b;--j){const $=P.scaledTo(j);if(u[$.key]||(u[$.key]=!0,k=this.getTile($),!k&&U&&(k=this._addTile($)),k&&(n[$.key]=$,U=k.wasRequested(),k.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}n.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;p=g}for(const g of n)this._loadedParentTiles[g]=u}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const u=!!n;if(!u){const p=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new Ia(t,g,this.transform.tileZoom,p,this._isRaster):new Vs(t,g,this.transform.tileZoom,p,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,u||this._source.fire(new r.A("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=n.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,u){const p=[],g=this.transform;if(!g)return p;const b=g.projection.name==="globe",I=r.av(g.center.lng);for(const L in this._tiles){const P=this._tiles[L];if(u&&P.clearQueryDebugViz(),P.holdingForFade())continue;let k;if(b){const U=P.tileID.canonical;if(U.z===0){const j=[Math.abs(r.ay(I,...yi(U,-1))-I),Math.abs(r.ay(I,...yi(U,1))-I)];k=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(r.ay(I,...yi(U,-1))-I),Math.abs(r.ay(I,...yi(U,0))-I),Math.abs(r.ay(I,...yi(U,1))-I)];k=[j.indexOf(Math.min(...j))-1]}}else k=[0];for(const U of k){const j=t.containsTile(P,g,n,U);j&&p.push(j)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const u=this.getRenderableIds(t,n).map(g=>this._tiles[g].tileID),p=this.transform.projection.name==="globe";for(const g of u)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=p?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return u}sortCoordinatesByDistance(t){const n=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),g={};for(const b of n){const I=1/(1<<b.canonical.z);g[b.key]=((b.canonical.x+.5)*I+b.wrap-u[0])*p[0]+((b.canonical.y+.5)*I-u[1])*p[1]-u[2]*p[2]}return n.sort((b,I)=>g[b.key]-g[I.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(vh(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(t,n,u){this._state.updateState(t=t||"_geojsonTileLayer",n,u)}removeFeatureState(t,n,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,u)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,u){const p=this._tiles[t];p&&p.setDependencies(n,u)}reloadTilesForDependencies(t,n){for(const u in this._tiles)this._tiles[u].hasDependency(t,n)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const L=()=>{this._sourceLoaded&&(this._source.off("data",L),this._preloadTiles(t,n))};return void this._source.on("data",L)}const u=new Map,p=Array.isArray(t)?t:[t],g=this.map.painter.terrain,b=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const L of p){const P=L.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of P)u.set(k.key,k);this.usedForTerrain&&L.updateElevation(!1)}const I=Array.from(u.values());r.bl(I,(L,P)=>{const k=new Vs(L,this._source.tileSize*L.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,U=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),P(U,k)})},n)}}function Mn(h,t){const n=Math.abs(2*h.wrap)-+(h.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||u-n||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function vh(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function yi(h,t){const n=1<<h.z;return[h.x/n+t,(h.x+1)/n+t]}Wa.maxOverzooming=10,Wa.maxUnderzooming=3;class mc{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:n});else if(p.type==="model"){const g=this.style.getLayerSource(p);g&&g.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const u=n.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&n.visible,n.visible=p}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const p of this.layers){const g=p.layer,b=this.style.getLayerSourceCache(g);let I=1;g.type==="fill-extrusion"&&(I=p.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let L=b?b.getTile(n):null;if(!L&&b&&n.canonical.z>b.getSource().minzoom){let P=n.scaledTo(Math.min(b.getSource().maxzoom,n.overscaledZ-1));for(;P.overscaledZ>=b.getSource().minzoom&&(L=b.getTile(P),!L&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:L?L.getBucket(g):null,tileID:L?L.tileID:n,verticalScale:I})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const g=t.symbolInstances.get(p),b=g.zOffset,I=this._getHeightAtTileOffset(n,g.tileAnchorX,g.tileAnchorY);g.zOffset=I!==Number.NEGATIVE_INFINITY?I:b,u||b===g.zOffset||(u=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,u,p){let g=n,b=u;if(t.canonical.z!==p.canonical.z){const I=p.canonical,L=1/(1<<t.canonical.z-I.z);g=(n+t.canonical.x*r.ai)*L-I.x*r.ai|0,b=(u+t.canonical.y*r.ai)*L-I.y*r.ai|0}return{tileX:g,tileY:b}}_getHeightAtTileOffset(t,n,u){let p,g;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;const{bucket:I,tileID:L,verticalScale:P}=this.currentBuildingBuckets[b];if(!I)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(t,n,u,L),j=I.getHeightAtTileCoord(k,U);j&&j.height!==void 0&&(j.hidden?p=j.height:g=Math.max(j.height*P,g||0))}if(g!==void 0)return g;for(let b=0;b<this.layers.length;++b){const I=this.layers[b];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:L,tileID:P}=this.currentBuildingBuckets[b];if(!L)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(t,n,u,P),j=L.getHeightAtTileCoord(k,U);if(j&&!j.hidden)return j.height===void 0&&p!==void 0?Math.min(j.maxHeight,p)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Qf(h,t){const n={};for(const u in h)u!=="ref"&&(n[u]=h[u]);return r.bm.forEach(u=>{u in t&&(n[u]=t[u])}),n}function _c(h){h=h.slice();const t=Object.create(null);for(let n=0;n<h.length;n++)t[h[n].id]=h[n];for(let n=0;n<h.length;n++)"ref"in h[n]&&(h[n]=Qf(h[n],t[h[n].ref]));return h}const bn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Fa(h,t,n){n.push({command:bn.addSource,args:[h,t[h]]})}function Us(h,t,n){t.push({command:bn.removeSource,args:[h]}),n[h]=!0}function bl(h,t,n,u){Us(h,n,u),Fa(h,t,n)}function si(h,t,n){let u;for(u in h[n])if(h[n].hasOwnProperty(u)&&u!=="data"&&!r.bn(h[n][u],t[n][u]))return!1;for(u in t[n])if(t[n].hasOwnProperty(u)&&u!=="data"&&!r.bn(h[n][u],t[n][u]))return!1;return!0}function dn(h,t,n,u,p,g){let b;for(b in t=t||{},h=h||{})h.hasOwnProperty(b)&&(r.bn(h[b],t[b])||n.push({command:g,args:[u,b,t[b],p]}));for(b in t)t.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(r.bn(h[b],t[b])||n.push({command:g,args:[u,b,t[b],p]}))}function gn(h){return h.id}function aa(h,t){return h[t.id]=t,h}class gc{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.ay(t,0,1);let n=1,u=this._distances[n];const p=t*this.paddedLength+this.padding;for(;u<p&&n<this._distances.length;)u=this._distances[++n];const g=n-1,b=this._distances[g],I=u-b,L=I>0?(p-b)/I:0;return this.points[g].mult(1-L).add(this.points[n].mult(L))}}class yn{constructor(t,n,u){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(n/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,u,p,g){this._forEachCell(n,u,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,n,u,p){this._forEachCell(n-p,u-p,n+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,n,u,p,g,b){this.boxCells[g].push(b)}_insertCircleCell(t,n,u,p,g,b){this.circleCells[g].push(b)}_query(t,n,u,p,g,b){if(u<0||t>this.width||p<0||n>this.height)return!g&&[];const I=[];if(t<=0&&n<=0&&this.width<=u&&this.height<=p){if(g)return!0;for(let L=0;L<this.boxKeys.length;L++)I.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const P=this.circles[3*L],k=this.circles[3*L+1],U=this.circles[3*L+2];I.push({key:this.circleKeys[L],x1:P-U,y1:k-U,x2:P+U,y2:k+U})}return b?I.filter(b):I}return this._forEachCell(t,n,u,p,this._queryCell,I,{hitTest:g,seenUids:{box:{},circle:{}}},b),g?I.length>0:I}_queryCircle(t,n,u,p,g){const b=t-u,I=t+u,L=n-u,P=n+u;if(I<0||b>this.width||P<0||L>this.height)return!p&&[];const k=[];return this._forEachCell(b,L,I,P,this._queryCellCircle,k,{hitTest:p,circle:{x:t,y:n,radius:u},seenUids:{box:{},circle:{}}},g),p?k.length>0:k}query(t,n,u,p,g){return this._query(t,n,u,p,!1,g)}hitTest(t,n,u,p,g){return this._query(t,n,u,p,!0,g)}hitTestCircle(t,n,u,p){return this._queryCircle(t,n,u,!0,p)}_queryCell(t,n,u,p,g,b,I,L){const P=I.seenUids,k=this.boxCells[g];if(k!==null){const j=this.bboxes;for(const $ of k)if(!P.box[$]){P.box[$]=!0;const Q=4*$;if(t<=j[Q+2]&&n<=j[Q+3]&&u>=j[Q+0]&&p>=j[Q+1]&&(!L||L(this.boxKeys[$]))){if(I.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[$],x1:j[Q],y1:j[Q+1],x2:j[Q+2],y2:j[Q+3]})}}}const U=this.circleCells[g];if(U!==null){const j=this.circles;for(const $ of U)if(!P.circle[$]){P.circle[$]=!0;const Q=3*$;if(this._circleAndRectCollide(j[Q],j[Q+1],j[Q+2],t,n,u,p)&&(!L||L(this.circleKeys[$]))){if(I.hitTest)return b.push(!0),!0;{const W=j[Q],te=j[Q+1],ne=j[Q+2];b.push({key:this.circleKeys[$],x1:W-ne,y1:te-ne,x2:W+ne,y2:te+ne})}}}}}_queryCellCircle(t,n,u,p,g,b,I,L){const P=I.circle,k=I.seenUids,U=this.boxCells[g];if(U!==null){const $=this.bboxes;for(const Q of U)if(!k.box[Q]){k.box[Q]=!0;const W=4*Q;if(this._circleAndRectCollide(P.x,P.y,P.radius,$[W+0],$[W+1],$[W+2],$[W+3])&&(!L||L(this.boxKeys[Q])))return b.push(!0),!0}}const j=this.circleCells[g];if(j!==null){const $=this.circles;for(const Q of j)if(!k.circle[Q]){k.circle[Q]=!0;const W=3*Q;if(this._circlesCollide($[W],$[W+1],$[W+2],P.x,P.y,P.radius)&&(!L||L(this.circleKeys[Q])))return b.push(!0),!0}}}_forEachCell(t,n,u,p,g,b,I,L){const P=this._convertToXCellCoord(t),k=this._convertToYCellCoord(n),U=this._convertToXCellCoord(u),j=this._convertToYCellCoord(p);for(let $=P;$<=U;$++)for(let Q=k;Q<=j;Q++)if(g.call(this,t,n,u,p,this.xCellCount*Q+$,b,I,L))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,u,p,g,b){const I=p-t,L=g-n,P=u+b;return P*P>I*I+L*L}_circleAndRectCollide(t,n,u,p,g,b,I){const L=(b-p)/2,P=Math.abs(t-(p+L));if(P>L+u)return!1;const k=(I-g)/2,U=Math.abs(n-(g+k));if(U>k+u)return!1;if(P<=L||U<=k)return!0;const j=P-L,$=U-k;return j*j+$*$<=u*u}}const js={unknown:0,flipRequired:1,flipNotRequired:2},Tu=Math.tan(85*Math.PI/180);function Hr(h,t,n,u,p,g,b){const I=r.ad.mat4.create();if(n)if(g.name==="globe"){const L=r.bo(p,t);r.ad.mat4.multiply(I,I,L)}else{const L=r.ad.mat2.invert([],b);I[0]=L[0],I[1]=L[1],I[4]=L[2],I[5]=L[3],u||r.ad.mat4.rotateZ(I,I,p.angle)}else r.ad.mat4.multiply(I,p.labelPlaneMatrix,h);return I}function Lr(h,t,n,u,p,g,b){const I=Hr(h,t,n,u,p,g,b);return g.name==="globe"&&n||(I[2]=I[6]=I[10]=I[14]=0),I}function pr(h,t,n,u,p,g,b){if(n){if(g.name==="globe"){const I=Hr(h,t,n,u,p,g,b);return r.ad.mat4.invert(I,I),r.ad.mat4.multiply(I,h,I),I}{const I=r.ad.mat4.clone(h),L=r.ad.mat4.identity([]);return L[0]=b[0],L[1]=b[1],L[4]=b[2],L[5]=b[3],r.ad.mat4.multiply(I,I,L),u||r.ad.mat4.rotateZ(I,I,-p.angle),I}}return p.glCoordMatrix}function Ka(h,t,n,u){const p=[h,t,n,1];n?r.ad.vec4.transformMat4(p,p,u):Fr(p,p,u);const g=p[3];return p[0]/=g,p[1]/=g,p[2]/=g,p}function Su(h,t){return Math.min(.5+h/t*.5,1.5)}function xh(h,t){const n=h[0]/h[3],u=h[1]/h[3];return n>=-t[0]&&n<=t[0]&&u>=-t[1]&&u<=t[1]}function wl(h,t,n,u,p,g,b,I,L,P){const k=n.transform,U=u?h.textSizeData:h.iconSizeData,j=r.bp(U,n.transform.zoom),$=k.projection.name==="globe",Q=[256/n.width*2+1,256/n.height*2+1],W=u?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;W.clear();let te=null;$&&(te=u?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const ne=h.lineVertexArray,ce=u?h.text.placedSymbolArray:h.icon.placedSymbolArray,me=n.transform.width/n.transform.height;let fe,we=!1;for(let ye=0;ye<ce.length;ye++){const ve=ce.get(ye),{numGlyphs:xe,writingMode:Se}=ve;if(Se!==r.bq.vertical||we||fe===r.bq.horizontal||(we=!0),fe=Se,(ve.hidden||Se===r.bq.vertical)&&!we){Cs(xe,W);continue}we=!1;const Ce=new r.P(ve.tileAnchorX,ve.tileAnchorY);let{x:Ke,y:Ge,z:ct}=k.projection.projectTilePoint(Ce.x,Ce.y,P.canonical);if(L){const[Ut,Gt,oi]=L(Ce);Ke+=Ut,Ge+=Gt,ct+=oi}const _t=[Ke,Ge,ct,1];if(r.ad.vec4.transformMat4(_t,_t,t),!xh(_t,Q)){Cs(xe,W);continue}const Ct=_t[3],Ve=Su(n.transform.getCameraToCenterDistance(k.projection),Ct),ut=r.br(U,j,ve),Ne=b?ut/Ve:ut*Ve,ht=Ka(Ke,Ge,ct,p);if(ht[3]<=0){Cs(xe,W);continue}let nt={};const yt=r.ak(h.layers[0].layout.get("text-max-angle")),et=Math.cos(yt),gt=b?null:L,Vt=va(ve,Ne,!1,I,t,p,g,h.glyphOffsetArray,ne,W,te,ht,Ce,nt,me,gt,k.projection,P,b,et);we=Vt.useVertical,gt&&Vt.needsFlipping&&(nt={}),(Vt.notEnoughRoom||we||Vt.needsFlipping&&va(ve,Ne,!0,I,t,p,g,h.glyphOffsetArray,ne,W,te,ht,Ce,nt,me,gt,k.projection,P,b,et).notEnoughRoom)&&Cs(xe,W)}u?(h.text.dynamicLayoutVertexBuffer.updateData(W),te&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(te)):(h.icon.dynamicLayoutVertexBuffer.updateData(W),te&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(te))}function Tl(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te){const{lineStartIndex:ne,glyphStartIndex:ce,segment:me}=I,fe=ce+I.numGlyphs,we=ne+I.lineLength,ye=t.getoffsetX(ce),ve=t.getoffsetX(fe-1),xe=bh(h*ye,n,u,p,g,b,me,ne,we,L,P,k,U,j,!0,$,Q,W,te);if(!xe)return null;const Se=bh(h*ve,n,u,p,g,b,me,ne,we,L,P,k,U,j,!0,$,Q,W,te);return Se?{first:xe,last:Se}:null}function Sl(h,t,n,u){return h===r.bq.horizontal&&Math.abs(u)>Math.abs(n)?{useVertical:!0}:h===r.bq.vertical?u>0?{needsFlipping:!0}:null:t!==js.unknown&&function(p,g){return p===0||Math.abs(g/p)>Tu}(n,u)?t===js.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function va(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te,ne,ce,me){const fe=t/24,we=h.lineOffsetX*fe,ye=h.lineOffsetY*fe,{lineStartIndex:ve,glyphStartIndex:xe,numGlyphs:Se,segment:Ce,writingMode:Ke,flipState:Ge}=h,ct=ve+h.lineLength,_t=Ct=>{if(k){const[ht,nt,yt]=Ct.up,et=P.length;r.bs(k,et+0,ht,nt,yt),r.bs(k,et+1,ht,nt,yt),r.bs(k,et+2,ht,nt,yt),r.bs(k,et+3,ht,nt,yt)}const[Ve,ut,Ne]=Ct.point;r.bt(P,Ve,ut,Ne,Ct.angle)};if(Se>1){const Ct=Tl(fe,I,we,ye,n,U,j,h,L,g,$,W,!1,te,ne,ce,me);if(!Ct)return{notEnoughRoom:!0};if(u&&!n){let[Ve,ut,Ne]=Ct.first.point,[ht,nt,yt]=Ct.last.point;[Ve,ut]=Ka(Ve,ut,Ne,b),[ht,nt]=Ka(ht,nt,yt,b);const et=Sl(Ke,Ge,(ht-Ve)*Q,nt-ut);if(h.flipState=et&&et.needsFlipping?js.flipRequired:js.flipNotRequired,et)return et}_t(Ct.first);for(let Ve=xe+1;Ve<xe+Se-1;Ve++){const ut=bh(fe*I.getoffsetX(Ve),we,ye,n,U,j,Ce,ve,ct,L,g,$,W,!1,!1,te,ne,ce,me);if(!ut)return P.length-=4*(Ve-xe),{notEnoughRoom:!0};_t(ut)}_t(Ct.last)}else{if(u&&!n){const Ve=Ka(j.x,j.y,0,p),ut=ve+Ce+1,Ne=new r.P(L.getx(ut),L.gety(ut)),ht=Ka(Ne.x,Ne.y,0,p),nt=ht[3]>0?ht:Ra(j,Ne,Ve,1,p,void 0,te,ne.canonical),yt=Sl(Ke,Ge,(nt[0]-Ve[0])*Q,nt[1]-Ve[1]);if(h.flipState=yt&&yt.needsFlipping?js.flipRequired:js.flipNotRequired,yt)return yt}const Ct=bh(fe*I.getoffsetX(xe),we,ye,n,U,j,Ce,ve,ct,L,g,$,W,!1,!1,te,ne,ce,me);if(!Ct)return{notEnoughRoom:!0};_t(Ct)}return{}}function Co(h,t,n,u,p){const{x:g,y:b,z:I}=u.projectTilePoint(h.x,h.y,t);if(!p)return Ka(g,b,I,n);const[L,P,k]=p(h);return Ka(g+L,b+P,I+k,n)}function Ra(h,t,n,u,p,g,b,I){const L=Co(h.sub(t)._unit()._add(h),I,p,b,g);return r.ad.vec3.sub(L,n,L),r.ad.vec3.normalize(L,L),r.ad.vec3.scaleAndAdd(L,n,L,u)}function bh(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te,ne,ce){const me=u?h-t:h+t;let fe=me>0?1:-1,we=0;u&&(fe*=-1,we=Math.PI),fe<0&&(we+=Math.PI);let ye=I+b+(fe>0?0:1)|0,ve=p,xe=p,Se=0,Ce=0;const Ke=Math.abs(me),Ge=[],ct=[];let _t=g,Ct=_t,Ve=r.ad.vec3.zero([]);const ut=()=>Ra(Ct,_t,xe,Ke-Se+1,k,j,W,te.canonical);for(;Se+Ce<=Ke;){if(ye+=fe,ye<I||ye>=L)return null;if(xe=ve,Ct=_t,Ge.push(xe),$&&ct.push(Ct),_t=new r.P(P.getx(ye),P.gety(ye)),ve=U[ye],!ve){const oi=Co(_t,te.canonical,k,W,j);ve=oi[3]>0?U[ye]=oi:ut()}Se+=Ce;const Ut=r.ad.vec3.sub([],ve,xe),Gt=r.ad.vec3.distance(xe,ve);if(n&&Gt>0&&Ce>0&&r.ad.vec3.dot(Ve,Ut)/(Ce*Gt)<ce)return null;Ce=Gt,Ve=Ut}Q&&j&&(U[ye]&&(ve=ut(),Ce=r.ad.vec3.distance(xe,ve),Ve=r.ad.vec3.sub([],ve,xe)),U[ye]=ve);const Ne=(Ke-Se)/Ce,ht=_t.sub(Ct)._mult(Ne)._add(Ct),nt=r.ad.vec3.scaleAndAdd([],xe,Ve,Ne);let yt=[0,0,1],et=Ve[0],gt=Ve[1];if(ne&&(yt=W.upVector(te.canonical,ht.x,ht.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){const Ut=[yt[2],0,-yt[0]],Gt=r.ad.vec3.cross([],yt,Ut);r.ad.vec3.normalize(Ut,Ut),r.ad.vec3.normalize(Gt,Gt),et=r.ad.vec3.dot(Ve,Ut),gt=r.ad.vec3.dot(Ve,Gt)}if(n){const Ut=r.ad.vec3.cross([],yt,Ve);r.ad.vec3.normalize(Ut,Ut),r.ad.vec3.scaleAndAdd(nt,nt,Ut,n*fe)}const Vt=we+Math.atan2(gt,et);return Ge.push(nt),$&&ct.push(ht),{point:nt,angle:Vt,path:Ge,tilePath:ct,up:yt}}function Cs(h,t){const n=t.length,u=n+4*h;t.resize(u),t.float32.fill(-1/0,4*n,4*u)}function Fr(h,t,n){const u=t[0],p=t[1];return h[0]=n[0]*u+n[4]*p+n[12],h[1]=n[1]*u+n[5]*p+n[13],h[3]=n[3]*u+n[7]*p+n[15],h}const sa=100;class $o{constructor(t,n,u=new yn(t.width+200,t.height+200,25),p=new yn(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+sa,this.screenBottomBoundary=t.height+sa,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,u,p,g,b,I,L){let P=u.projectedAnchorX,k=u.projectedAnchorY,U=u.projectedAnchorZ;const j=u.elevation,$=u.tileID,Q=t.getProjection();if(j&&$){const[ye,ve,xe]=Q.upVector($.canonical,u.tileAnchorX,u.tileAnchorY),Se=Q.upVectorScale($.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ye*j*Se,k+=ve*j*Se,U+=xe*j*Se}const W=this.projectAndGetPerspectiveRatio(I,P,k,U,u.tileID,Q.name==="globe"||!!j||this.transform.pitch>0,Q),te=b*W.perspectiveRatio,ne=(u.x1*n+p.x-u.padding)*te+W.point.x,ce=(u.y1*n+p.y-u.padding)*te+W.point.y,me=(u.x2*n+p.x+u.padding)*te+W.point.x,fe=(u.y2*n+p.y+u.padding)*te+W.point.y,we=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(ne,ce,me,fe)||!g&&this.grid.hitTest(ne,ce,me,fe,L)||we?{box:[],offscreen:!1,occluded:W.occluded}:{box:[ne,ce,me,fe],offscreen:this.isOffscreen(ne,ce,me,fe),occluded:!1}}placeCollisionCircles(t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W){const te=[],ne=this.transform.elevation,ce=t.getProjection(),me=ne?ne.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,ce):null,fe=new r.P(u.tileAnchorX,u.tileAnchorY);let{x:we,y:ye,z:ve}=ce.projectTilePoint(fe.x,fe.y,W.canonical);if(me){const[yt,et,gt]=me(fe);we+=yt,ye+=et,ve+=gt}const xe=ce.name==="globe",Se=this.projectAndGetPerspectiveRatio(I,we,ye,ve,W,xe||!!ne||this.transform.pitch>0,ce),{perspectiveRatio:Ce}=Se,Ke=(U?b/Ce:b*Ce)/r.bw,Ge=Ka(we,ye,ve,L),ct=u.lineOffsetX*Ke,_t=u.lineOffsetY*Ke,Ct=r.ak(t.layers[0].layout.get("text-max-angle")),Ve=Math.cos(Ct),ut=Se.signedDistanceFromCamera>0?Tl(Ke,g,ct,_t,!1,Ge,fe,u,p,L,{},ne&&!U?me:null,U&&!!ne,ce,W,U,Ve):null;let Ne=!1,ht=!1,nt=!0;if(ut&&!Se.occluded){const yt=.5*$*Ce+Q,et=new r.P(-100,-100),gt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Vt=new gc,{first:Ut,last:Gt}=ut,oi=Ut.path.length;let Di=[];for(let Ci=oi-1;Ci>=1;Ci--)Di.push(Ut.path[Ci]);for(let Ci=1;Ci<Gt.path.length;Ci++)Di.push(Gt.path[Ci]);const xi=2.5*yt;P&&(Di=Di.map(([Ci,on,Sn],Gi)=>(me&&!xe&&(Sn=me(Gi<oi-1?Ut.tilePath[oi-1-Gi]:Gt.tilePath[Gi-oi+2])[2]),Ka(Ci,on,Sn,P))),Di.some(Ci=>Ci[3]<=0)&&(Di=[]));let Ri=[];if(Di.length>0){let Ci=1/0,on=-1/0,Sn=1/0,Gi=-1/0;for(const Ti of Di)Ci=Math.min(Ci,Ti[0]),Sn=Math.min(Sn,Ti[1]),on=Math.max(on,Ti[0]),Gi=Math.max(Gi,Ti[1]);on>=et.x&&Ci<=gt.x&&Gi>=et.y&&Sn<=gt.y&&(Ri=[Di.map(Ti=>new r.P(Ti[0],Ti[1]))],(Ci<et.x||on>gt.x||Sn<et.y||Gi>gt.y)&&(Ri=r.bu(Ri,et.x,et.y,gt.x,gt.y)))}for(const Ci of Ri){Vt.reset(Ci,.25*yt);let on=0;on=Vt.length<=.5*yt?1:Math.ceil(Vt.paddedLength/xi)+1;for(let Sn=0;Sn<on;Sn++){const Gi=Sn/Math.max(on-1,1),Ti=Vt.lerp(Gi),Fi=Ti.x+sa,li=Ti.y+sa;te.push(Fi,li,yt,0);const jt=Fi-yt,Hi=li-yt,pn=Fi+yt,hn=li+yt;if(nt=nt&&this.isOffscreen(jt,Hi,pn,hn),ht=ht||this.isInsideGrid(jt,Hi,pn,hn),!n&&this.grid.hitTestCircle(Fi,li,yt,j)&&(Ne=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ne,occluded:!1}}}}return{circles:!k&&Ne||!ht?[]:te,offscreen:nt,collisionDetected:Ne,occluded:Se.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let u=1/0,p=1/0,g=-1/0,b=-1/0;for(const k of t){const U=new r.P(k.x+sa,k.y+sa);u=Math.min(u,U.x),p=Math.min(p,U.y),g=Math.max(g,U.x),b=Math.max(b,U.y),n.push(U)}const I=this.grid.query(u,p,g,b).concat(this.ignoredGrid.query(u,p,g,b)),L={},P={};for(const k of I){const U=k.key;if(L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]={}),L[U.bucketInstanceId][U.featureIndex])continue;const j=[new r.P(k.x1,k.y1),new r.P(k.x2,k.y1),new r.P(k.x2,k.y2),new r.P(k.x1,k.y2)];r.bv(n,j)&&(L[U.bucketInstanceId][U.featureIndex]=!0,P[U.bucketInstanceId]===void 0&&(P[U.bucketInstanceId]=[]),P[U.bucketInstanceId].push(U.featureIndex))}return P}insertCollisionBox(t,n,u,p,g){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,u,p,g){const b=n?this.ignoredGrid:this.grid,I={bucketInstanceId:u,featureIndex:p,collisionGroupID:g};for(let L=0;L<t.length;L+=4)b.insertCircle(I,t[L],t[L+1],t[L+2])}projectAndGetPerspectiveRatio(t,n,u,p,g,b,I){const L=[n,u,p,1];let P=!1;p||this.transform.pitch>0?(r.ad.vec4.transformMat4(L,L,t),this.fogState&&g&&I.name!=="globe"&&(P=function(j,$,Q,W,te,ne){const ce=ne.calculateFogTileMatrix(te),me=[$,Q,W];return r.ad.vec3.transformMat4(me,me,ce),Yt(j,r.ad.vec3.length(me),ne.pitch,ne._fov)}(this.fogState,n,u,p,g.toUnwrapped(),this.transform)>.9)):Fr(L,L,t);const k=L[3];return{point:new r.P((L[0]/k+1)/2*this.transform.width+sa,(-L[1]/k+1)/2*this.transform.height+sa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/k*.5,1.5),signedDistanceFromCamera:k,occluded:b&&L[2]>k||P}}isOffscreen(t,n,u,p){return u<sa||t>=this.screenRightBoundary||p<sa||n>this.screenBottomBoundary}isInsideGrid(t,n,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=r.ad.mat4.identity([]);return r.ad.mat4.translate(t,t,[-100,-100,0]),t}}function Ir(h,t,n){const u=t.createTileMatrix(h,h.worldSize,n.toUnwrapped());return r.ad.mat4.multiply(new Float32Array(16),h.projMatrix,u)}function ep(h,t,n){if(t.projection.name===n.projection.name)return h.projMatrix;const u=n.clone();return u.setProjection(t.projection),Ir(u,t.getProjection(),h)}function ys(h,t,n){return t.name===n.projection.name?h.projMatrix:Ir(n,t,h)}class Eu{constructor(t,n,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class El{constructor(t,n,u,p,g,b=!1){this.text=new Eu(t?t.text:null,n,u,g),this.icon=new Eu(t?t.icon:null,n,p,g),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xo{constructor(t,n,u,p=!1){this.text=t,this.icon=n,this.skipFade=u,this.clipped=p}}class F_{constructor(){this.invProjMatrix=r.ad.mat4.create(),this.viewportMatrix=r.ad.mat4.create(),this.circles=[]}}class lo{constructor(t,n,u,p,g){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=g}}class V_{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:u=>u.collisionGroupID===n}}return this.collisionGroups[t]}}function Md(h,t,n,u,p){const{horizontalAlign:g,verticalAlign:b}=r.bD(h),I=-(g-.5)*t,L=-(b-.5)*n,P=r.bC(h,u);return new r.P(I+P[0]*p,L+P[1]*p)}function Va(h,t,n,u,p){const g=new r.P(h,t);return n&&g._rotate(u?p:-p),g}class om{constructor(t,n,u,p,g,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new $o(this.transform,g),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new V_(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,u,p,g=1){const b=u.getBucket(n),I=u.latestFeatureIndex;if(!b||!I||n.fqid!==b.layerIds[0])return;const L=b.layers[0].layout,P=b.layers[0].paint,k=u.collisionBoxArray,U=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),j=u.tileSize/r.ai,$=u.tileID.toUnwrapped();this.transform.setProjection(b.projection);const Q=(W=u.tileID,te=b.getProjection(),ne=this.transform,te.name===this.projection?ne.calculateProjMatrix(W.toUnwrapped()):Ir(ne,te,W));var W,te,ne;const ce=L.get("text-pitch-alignment")==="map",me=L.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const fe=n.dynamicFilter(),we=n.dynamicFilterNeedsFeature(),ye=this.transform.calculatePixelsToTileUnitsMatrix(u),ve=Lr(Q,u.tileID.canonical,ce,me,this.transform,b.getProjection(),ye);let xe=null;if(ce){const ut=pr(Q,u.tileID.canonical,ce,me,this.transform,b.getProjection(),ye);xe=r.ad.mat4.multiply([],this.transform.labelPlaneMatrix,ut)}let Se=null;fe&&u.latestFeatureIndex&&(Se={unwrappedTileID:$,dynamicFilter:fe,dynamicFilterNeedsFeature:we}),this.retainedQueryData[b.bucketInstanceId]=new lo(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,u.tileID);const[Ce,Ke]=b.layers[0].layout.get("text-size-scale-range"),Ge=r.ay(g,Ce,Ke),[ct,_t]=L.get("icon-size-scale-range"),Ct=r.ay(g,ct,_t),Ve={bucket:b,layout:L,paint:P,posMatrix:Q,textLabelPlaneMatrix:ve,labelToScreenMatrix:xe,clippingData:Se,scale:U,textPixelRatio:j,holdingForFade:u.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:r.bp(b.textSizeData,this.transform.zoom,Ge),partiallyEvaluatedIconSize:r.bp(b.iconSizeData,this.transform.zoom,Ct),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const ut of b.sortKeyRanges){const{sortKey:Ne,symbolInstanceStart:ht,symbolInstanceEnd:nt}=ut;t.push({sortKey:Ne,symbolInstanceStart:ht,symbolInstanceEnd:nt,parameters:Ve})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te,ne,ce){const{textOffset0:me,textOffset1:fe,crossTileID:we}=j,ye=[me,fe],ve=Md(t,u,p,ye,g),xe=this.collisionIndex.placeCollisionBox(Q,g,n,Va(ve.x,ve.y,b,I,this.transform.angle),U,L,P,k.predicate);if(te){const Se=Q.getSymbolInstanceIconSize(ce,this.transform.zoom,j.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,Se,te,Va(ve.x,ve.y,b,I,this.transform.angle),U,L,P,k.predicate).box.length===0)return}if(xe.box.length>0){let Se;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(Se=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:ye,width:u,height:p,anchor:t,textScale:g,prevAnchor:Se},this.markUsedJustification(Q,t,j,W),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,W,j),this.placedOrientations[we]=W),{shift:ve,placedGlyphBoxes:xe}}}placeLayerBucketPart(t,n,u,p,g=1){const{bucket:b,layout:I,paint:L,posMatrix:P,textLabelPlaneMatrix:k,labelToScreenMatrix:U,clippingData:j,textPixelRatio:$,holdingForFade:Q,collisionBoxArray:W,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:ne,collisionGroup:ce,latestFeatureIndex:me}=t.parameters,fe=I.get("text-optional"),we=I.get("icon-optional"),ye=I.get("text-allow-overlap"),ve=I.get("icon-allow-overlap"),xe=I.get("text-rotation-alignment")==="map",Se=I.get("text-pitch-alignment")==="map",Ce=L.get("symbol-z-offset"),Ke=I.get("symbol-elevation-reference")==="sea",[Ge,ct]=I.get("text-size-scale-range"),[_t,Ct]=I.get("icon-size-scale-range"),Ve=r.ay(g,Ge,ct),ut=r.ay(g,_t,Ct);this.transform.setProjection(b.projection);let Ne=ye&&(ve||!b.hasIconData()||we),ht=ve&&(ye||!b.hasTextData()||fe);const nt=!Ce.isConstant();!b.collisionArrays&&W&&b.deserializeCollisionBoxes(W),u&&p&&b.updateCollisionDebugBuffers(this.transform.zoom,W,Ve,ut);const yt=(et,gt,Vt)=>{const{crossTileID:Ut,numVerticalGlyphVertices:Gt}=et;let oi=null;if(j&&j.dynamicFilterNeedsFeature||nt){const Ki=this.retainedQueryData[b.bucketInstanceId];oi=me.loadFeature({featureIndex:et.featureIndex,bucketIndex:Ki.bucketIndex,sourceLayerIndex:Ki.sourceLayerIndex,layoutVertexArrayOffset:0})}if(j&&!(0,j.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},oi,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.P(et.tileAnchorX,et.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[Ut]=new Xo(!1,!1,!1,!0),void n.add(Ut);const Di=Ce.evaluate(oi,{});if(n.has(Ut))return;if(Q)return void(this.placements[Ut]=new Xo(!1,!1,!1));let xi=!1,Ri=!1,Ci=!0,on=!1,Sn=!1,Gi=null,Ti={box:null,offscreen:null,occluded:null},Fi={box:null},li=null,jt=null,Hi=null,pn=0,hn=0,hr=0;Vt.textFeatureIndex?pn=Vt.textFeatureIndex:et.useRuntimeCollisionCircles&&(pn=et.featureIndex),Vt.verticalTextFeatureIndex&&(hn=Vt.verticalTextFeatureIndex);const rr=Ki=>{Ki.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Zn=this.transform.elevation;Ki.elevation=Ke?Di:Di+(Zn?Zn.getAtTileOffset(Ki.tileID,Ki.tileAnchorX,Ki.tileAnchorY):0),Ki.elevation+=et.zOffset},Pn=Vt.textBox;if(Pn){rr(Pn);const Ki=mn=>{let fn=r.bq.horizontal;if(b.allowVerticalPlacement&&!mn&&this.prevPlacement){const ea=this.prevPlacement.placedOrientations[Ut];ea&&(this.placedOrientations[Ut]=ea,fn=ea,this.markUsedOrientation(b,fn,et))}return fn},Zn=(mn,fn)=>{if(b.allowVerticalPlacement&&Gt>0&&Vt.verticalTextBox){for(const ea of b.writingModes)if(ea===r.bq.vertical?(Ti=fn(),Fi=Ti):Ti=mn(),Ti&&Ti.box&&Ti.box.length)break}else Ti=mn()};if(I.get("text-variable-anchor")){let mn=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ut]){const Qn=this.prevPlacement.variableOffsets[Ut];mn.indexOf(Qn.anchor)>0&&(mn=mn.filter(Dr=>Dr!==Qn.anchor),mn.unshift(Qn.anchor))}const fn=(Qn,Dr,Ls)=>{const ta=b.getSymbolInstanceTextSize(te,et,this.transform.zoom,gt),xr=(Qn.x2-Qn.x1)*ta+2*Qn.padding,$r=(Qn.y2-Qn.y1)*ta+2*Qn.padding,Oa=et.hasIconTextFit&&!ve?Dr:null;Oa&&rr(Oa);let ma={box:[],offscreen:!1,occluded:!1};const _o=ye?2*mn.length:mn.length;for(let eo=0;eo<_o;++eo){const jo=this.attemptAnchorPlacement(mn[eo%mn.length],Qn,xr,$r,ta,xe,Se,$,P,ce,eo>=mn.length,et,gt,b,Ls,Oa,te,ne);if(jo&&(ma=jo.placedGlyphBoxes,ma&&ma.box&&ma.box.length)){xi=!0,Gi=jo.shift;break}}return ma};Zn(()=>fn(Pn,Vt.iconBox,r.bq.horizontal),()=>{const Qn=Vt.verticalTextBox;return Qn&&rr(Qn),b.allowVerticalPlacement&&!(Ti&&Ti.box&&Ti.box.length)&&Gt>0&&Qn?fn(Qn,Vt.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),Ti&&(xi=Ti.box,Ci=Ti.offscreen,on=Ti.occluded);const ea=Ki(!(!Ti||!Ti.box));if(!xi&&this.prevPlacement){const Qn=this.prevPlacement.variableOffsets[Ut];Qn&&(this.variableOffsets[Ut]=Qn,this.markUsedJustification(b,Qn.anchor,et,ea))}}else{const mn=(fn,ea)=>{const Qn=b.getSymbolInstanceTextSize(te,et,this.transform.zoom,gt,g),Dr=this.collisionIndex.placeCollisionBox(b,Qn,fn,new r.P(0,0),ye,$,P,ce.predicate);return Dr&&Dr.box&&Dr.box.length&&(this.markUsedOrientation(b,ea,et),this.placedOrientations[Ut]=ea),Dr};Zn(()=>mn(Pn,r.bq.horizontal),()=>{const fn=Vt.verticalTextBox;return b.allowVerticalPlacement&&Gt>0&&fn?(rr(fn),mn(fn,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Ki(!!(Ti&&Ti.box&&Ti.box.length))}}if(li=Ti,xi=li&&li.box&&li.box.length>0,Ci=li&&li.offscreen,on=li&&li.occluded,et.useRuntimeCollisionCircles){const Ki=b.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex>=0?et.centerJustifiedTextSymbolIndex:et.verticalPlacedTextSymbolIndex),Zn=r.br(b.textSizeData,te,Ki),mn=I.get("text-padding");jt=this.collisionIndex.placeCollisionCircles(b,ye,Ki,b.lineVertexArray,b.glyphOffsetArray,Zn,P,k,U,u,Se,ce.predicate,et.collisionCircleDiameter*Zn/r.bw,mn,this.retainedQueryData[b.bucketInstanceId].tileID),xi=ye||jt.circles.length>0&&!jt.collisionDetected,Ci=Ci&&jt.offscreen,on=jt.occluded}if(Vt.iconFeatureIndex&&(hr=Vt.iconFeatureIndex),Vt.iconBox){const Ki=Zn=>{rr(Zn);const mn=et.hasIconTextFit&&Gi?Va(Gi.x,Gi.y,xe,Se,this.transform.angle):new r.P(0,0),fn=b.getSymbolInstanceIconSize(ne,this.transform.zoom,et.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,fn,Zn,mn,ve,$,P,ce.predicate)};Fi&&Fi.box&&Fi.box.length&&Vt.verticalIconBox?(Hi=Ki(Vt.verticalIconBox),Ri=Hi.box.length>0):(Hi=Ki(Vt.iconBox),Ri=Hi.box.length>0),Ci=Ci&&Hi.offscreen,Sn=Hi.occluded}const vr=fe||et.numHorizontalGlyphVertices===0&&Gt===0,fa=we||et.numIconVertices===0;if(vr||fa?fa?vr||(Ri=Ri&&xi):xi=Ri&&xi:Ri=xi=Ri&&xi,xi&&li&&li.box&&this.collisionIndex.insertCollisionBox(li.box,I.get("text-ignore-placement"),b.bucketInstanceId,Fi&&Fi.box&&hn?hn:pn,ce.ID),Ri&&Hi&&this.collisionIndex.insertCollisionBox(Hi.box,I.get("icon-ignore-placement"),b.bucketInstanceId,hr,ce.ID),jt&&(xi&&this.collisionIndex.insertCollisionCircles(jt.circles,I.get("text-ignore-placement"),b.bucketInstanceId,pn,ce.ID),u)){const Ki=b.bucketInstanceId;let Zn=this.collisionCircleArrays[Ki];Zn===void 0&&(Zn=this.collisionCircleArrays[Ki]=new F_);for(let mn=0;mn<jt.circles.length;mn+=4)Zn.circles.push(jt.circles[mn+0]),Zn.circles.push(jt.circles[mn+1]),Zn.circles.push(jt.circles[mn+2]),Zn.circles.push(jt.collisionDetected?1:0)}const pa=b.projection.name!=="globe";Ne=Ne&&(pa||!on),ht=ht&&(pa||!Sn),this.placements[Ut]=new Xo(xi||Ne,Ri||ht,Ci||b.justReloaded),n.add(Ut)};if(b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,this.retainedQueryData[b.bucketInstanceId].tileID),b.elevationType==="road"&&b.updateRoadElevation(),b.updateZOffset(),b.sortFeaturesByY){const et=b.getSortedSymbolIndexes(this.transform.angle);for(let gt=et.length-1;gt>=0;--gt){const Vt=et[gt];yt(b.symbolInstances.get(Vt),Vt,b.collisionArrays[Vt])}b.hasAnyZOffset&&r.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const et=b.getSortedIndexesByZOffset();for(let gt=0;gt<et.length;++gt){const Vt=et[gt];yt(b.symbolInstances.get(Vt),Vt,b.collisionArrays[Vt])}}else for(let et=t.symbolInstanceStart;et<t.symbolInstanceEnd;et++)yt(b.symbolInstances.get(et),et,b.collisionArrays[et]);if(u&&b.bucketInstanceId in this.collisionCircleArrays){const et=this.collisionCircleArrays[b.bucketInstanceId];r.ad.mat4.invert(et.invProjMatrix,P),et.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,n,u,p){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:L,crossTileID:P}=u,k=r.bB(n),U=p===r.bq.vertical?L:k==="left"?g:k==="center"?b:k==="right"?I:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=U>=0&&g!==U?0:P),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:P),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=U>=0&&I!==U?0:P),L>=0&&(t.text.placedSymbolArray.get(L).crossTileID=U>=0&&L!==U?0:P)}markUsedOrientation(t,n,u){const p=n===r.bq.horizontal||n===r.bq.horizontalOnly?n:0,g=n===r.bq.vertical?n:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:P}=u,k=t.text.placedSymbolArray;b>=0&&(k.get(b).placedOrientation=p),I>=0&&(k.get(I).placedOrientation=p),L>=0&&(k.get(L).placedOrientation=p),P>=0&&(k.get(P).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let u=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const p=n?n.symbolFadeChange(t):1,g=n?n.opacities:{},b=n?n.variableOffsets:{},I=n?n.placedOrientations:{};for(const L in this.placements){const P=this.placements[L],k=g[L];k?(this.opacities[L]=new El(k,p,P.text,P.icon,null,P.clipped),u=u||P.text!==k.text.placed||P.icon!==k.icon.placed):(this.opacities[L]=new El(null,p,P.text,P.icon,P.skipFade,P.clipped),u=u||P.text||P.icon)}for(const L in g){const P=g[L];if(!this.opacities[L]){const k=new El(P,p,!1,!1);k.isHidden()||(this.opacities[L]=k,u=u||P.text.placed||P.icon.placed)}}for(const L in b)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=b[L]);for(const L in I)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=I[L]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,u,p){const g=new Set;for(const b of n){const I=b.getBucket(t);I&&b.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,g,b,b.collisionBoxArray,u,p,b.tileID,t.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,b.tileID),I.elevationType==="road"&&I.updateRoadElevation(),I.updateZOffset())}}updateBucketOpacities(t,n,u,p,g,b,I,L){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const P=t.layers[0].layout,k=t.layers[0].paint,U=!!t.layers[0].dynamicFilter(),j=new El(null,0,!1,!1,!0),$=P.get("text-allow-overlap"),Q=P.get("icon-allow-overlap"),W=P.get("text-variable-anchor"),te=P.get("text-rotation-alignment")==="map",ne=P.get("text-pitch-alignment")==="map",ce=k.get("symbol-z-offset"),me=P.get("symbol-elevation-reference")==="sea",fe=!ce.isConstant(),we=new El(null,0,$&&(Q||!t.hasIconData()||P.get("icon-optional")),Q&&($||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const ye=(xe,Se,Ce)=>{for(let Ke=0;Ke<Se/4;Ke++)xe.opacityVertexArray.emplaceBack(Ce)};let ve=0;b&&t.updateReplacement(I,b);for(let xe=0;xe<t.symbolInstances.length;xe++){const Se=t.symbolInstances.get(xe),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:Ke,crossTileID:Ge,numIconVertices:ct,tileAnchorX:_t,tileAnchorY:Ct}=Se;let Ve=null;const ut=this.retainedQueryData[t.bucketInstanceId];fe&&Se&&ut&&(Ve=u.latestFeatureIndex.loadFeature({featureIndex:Se.featureIndex,bucketIndex:ut.bucketIndex,sourceLayerIndex:ut.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ne=ce.evaluate(Ve,{}),ht=n.has(Ge);let nt=this.opacities[Ge];ht?nt=j:nt||(nt=we,this.opacities[Ge]=nt),n.add(Ge);const yt=Ce>0||Ke>0,et=ct>0,gt=this.placedOrientations[Ge],Vt=gt===r.bq.vertical,Ut=gt===r.bq.horizontal||gt===r.bq.horizontalOnly;!yt&&!et||nt.isHidden()||ve++;let Gt=!1;if((yt||et)&&b)for(const oi of t.activeReplacements){if(r.bx(oi,g,r.by.Symbol,L)||oi.min.x>_t||_t>oi.max.x||oi.min.y>Ct||Ct>oi.max.y)continue;const Di=r.bz(_t,Ct,I.canonical,oi.footprintTileId.canonical);if(Gt=r.bA(Di,oi.footprint),Gt)break}if(yt){const oi=Gt?Yo:vc(nt.text);ye(t.text,Ce,Vt?Yo:oi),ye(t.text,Ke,Ut?Yo:oi);const Di=nt.text.isHidden(),{leftJustifiedTextSymbolIndex:xi,centerJustifiedTextSymbolIndex:Ri,rightJustifiedTextSymbolIndex:Ci,verticalPlacedTextSymbolIndex:on}=Se,Sn=t.text.placedSymbolArray,Gi=Di||Vt?1:0;xi>=0&&(Sn.get(xi).hidden=Gi),Ri>=0&&(Sn.get(Ri).hidden=Gi),Ci>=0&&(Sn.get(Ci).hidden=Gi),on>=0&&(Sn.get(on).hidden=Di||Ut?1:0);const Ti=this.variableOffsets[Ge];Ti&&this.markUsedJustification(t,Ti.anchor,Se,gt);const Fi=this.placedOrientations[Ge];Fi&&(this.markUsedJustification(t,"left",Se,Fi),this.markUsedOrientation(t,Fi,Se))}if(et){const oi=Gt?Yo:vc(nt.icon),{placedIconSymbolIndex:Di,verticalPlacedIconSymbolIndex:xi}=Se,Ri=t.icon.placedSymbolArray,Ci=nt.icon.isHidden()?1:0;Di>=0&&(ye(t.icon,ct,Vt?Yo:oi),Ri.get(Di).hidden=Ci),xi>=0&&(ye(t.icon,Se.numVerticalIconVertices,Ut?Yo:oi),Ri.get(xi).hidden=Ci)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const oi=t.collisionArrays[xe];if(oi){let Di=new r.P(0,0),xi=!0;if(oi.textBox||oi.verticalTextBox){if(W){const Ci=this.variableOffsets[Ge];Ci?(Di=Md(Ci.anchor,Ci.width,Ci.height,Ci.textOffset,Ci.textScale),te&&Di._rotate(ne?this.transform.angle:-this.transform.angle)):xi=!1}U&&(xi=!nt.clipped),oi.textBox&&yc(t.textCollisionBox.collisionVertexArray,nt.text.placed,!xi||Vt,Ne,me,Di.x,Di.y),oi.verticalTextBox&&yc(t.textCollisionBox.collisionVertexArray,nt.text.placed,!xi||Ut,Ne,me,Di.x,Di.y)}const Ri=xi&&!!(!Ut&&oi.verticalIconBox);oi.iconBox&&yc(t.iconCollisionBox.collisionVertexArray,nt.icon.placed,Ri,Ne,me,Se.hasIconTextFit?Di.x:0,Se.hasIconTextFit?Di.y:0),oi.verticalIconBox&&yc(t.iconCollisionBox.collisionVertexArray,nt.icon.placed,!Ri,Ne,me,Se.hasIconTextFit?Di.x:0,Se.hasIconTextFit?Di.y:0)}}}if(t.fullyClipped=ve===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=xe.invProjMatrix,t.placementViewportMatrix=xe.viewportMatrix,t.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const u=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function yc(h,t,n,u,p,g,b){h.emplaceBack(t?1:0,n?1:0,g||0,b||0,u,p?1:0),h.emplaceBack(t?1:0,n?1:0,g||0,b||0,u,p?1:0),h.emplaceBack(t?1:0,n?1:0,g||0,b||0,u,p?1:0),h.emplaceBack(t?1:0,n?1:0,g||0,b||0,u,p?1:0)}const lm=Math.pow(2,25),wh=Math.pow(2,24),U_=Math.pow(2,17),j_=Math.pow(2,16),Th=Math.pow(2,9),Sh=Math.pow(2,8),q_=Math.pow(2,1);function vc(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,n=Math.floor(127*h.opacity);return n*lm+t*wh+n*U_+t*j_+n*Th+t*Sh+n*q_+t}const Yo=0;class Al{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,u,p,g,b){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(I,p,t[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((L,P)=>L.sortKey-P.sortKey));this._currentPartIndex<I.length;){const L=I[this._currentPartIndex];if(n.placeLayerBucketPart(L,this._seenCrossTileIDs,u,L.symbolInstanceStart===0,b),this._currentPartIndex++,g())return!0}return!1}}class Ml{constructor(t,n,u,p,g,b,I,L,P){this.placement=new om(t,g,b,I,L,P),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,n,u,p,g){const b=r.q.now(),I=()=>{const L=r.q.now()-b;return!this._forceFullPlacement&&L>2};for(;this._currentPlacementIndex>=0;){const L=n[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(L.type==="symbol"&&(!L.minzoom||L.minzoom<=P)&&(!L.maxzoom||L.maxzoom>P)){const k=L,U=k.layout.get("symbol-z-elevate"),j=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,$=k.layout.get("symbol-z-order"),Q=$==="viewport-y"||$==="auto"&&!($!=="viewport-y"&&j),W=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),te=Q&&W,ne=this._inProgressLayer=this._inProgressLayer||new Al(k),ce=r.C(L.source,L.scope);if(ne.continuePlacement(U||te?p[ce]:u[ce],this.placement,this._showCollisionBoxes,L,I,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Cd=512/r.ai/2;class cm{constructor(t,n,u){this.tileID=t,this.bucketInstanceId=u,this.index=new r.bE(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*r.ai,g=t.canonical.y*r.ai;for(let b=0;b<n.length;b++){const{key:I,crossTileID:L,tileAnchorX:P,tileAnchorY:k}=n.get(b),U=Math.floor((p+P)*Cd),j=Math.floor((g+k)*Cd);this.index.add(U,j),this.keys.push(I),this.crossTileIDs.push(L)}this.index.finish()}findMatches(t,n,u){const p=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),g=Cd/Math.pow(2,n.canonical.z-this.tileID.canonical.z),b=n.canonical.x*r.ai,I=n.canonical.y*r.ai;for(let L=0;L<t.length;L++){const P=t.get(L);if(P.crossTileID)continue;const{key:k,tileAnchorX:U,tileAnchorY:j}=P,$=Math.floor((b+U)*g),Q=Math.floor((I+j)*g),W=this.index.range($-p,Q-p,$+p,Q+p);for(const te of W){const ne=this.crossTileIDs[te];if(this.keys[te]===k&&!u.has(ne)){u.add(ne),P.crossTileID=ne;break}}}}}class um{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class tp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const u in this.indexes){const p=this.indexes[u],g={};for(const b in p){const I=p[b];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+n),g[I.tileID.key]=I}this.indexes[u]=g}this.lng=t}addBucket(t,n,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<n.symbolInstances.length;g++)n.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const b=this.indexes[g];if(Number(g)>t.overscaledZ)for(const I in b){const L=b[I];L.tileID.isChildOf(t)&&L.findMatches(n.symbolInstances,t,p)}else{const I=b[t.scaledTo(Number(g)).key];I&&I.findMatches(n.symbolInstances,t,p)}}for(let g=0;g<n.symbolInstances.length;g++){const b=n.symbolInstances.get(g);b.crossTileID||(b.crossTileID=u.generate(),p.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new cm(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const u of n.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let n=!1;for(const u in this.indexes){const p=this.indexes[u];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[g]),delete p[g],n=!0)}return n}}class hm{constructor(){this.layerIndexes={},this.crossTileIDs=new um,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,u,p){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new tp);let b=!1;const I={};p.name!=="globe"&&g.handleWrapJump(u);for(const L of n){const P=L.getBucket(t);P&&t.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(L.tileID,P,this.crossTileIDs)&&(b=!0),I[P.bucketInstanceId]=!0)}return g.removeStaleBuckets(I)&&(b=!0),b}pruneUnusedLayers(t){const n={};t.forEach(u=>{n[u]=!0});for(const u in this.layerIndexes)n[u]||delete this.layerIndexes[u]}}const Is=771;class en{constructor(t,n,u,p){this.blendFunction=t,this.blendColor=n,this.mask=u,this.blendEquation=p}}en.Replace=[1,0,1,0],en.disabled=new en(en.Replace,r.al.transparent,[!1,!1,!1,!1]),en.unblended=new en(en.Replace,r.al.transparent,[!0,!0,!0,!0]),en.alphaBlended=new en([1,Is,1,Is],r.al.transparent,[!0,!0,!0,!0]),en.alphaBlendedNonPremultiplied=new en([770,Is,770,Is],r.al.transparent,[!0,!0,!0,!0]),en.multiply=new en([774,0,774,0],r.al.transparent,[!0,!0,!0,!0]);class mi{constructor(t,n,u){this.func=t,this.mask=n,this.range=u}}mi.ReadOnly=!1,mi.ReadWrite=!0,mi.disabled=new mi(519,mi.ReadOnly,[0,1]);const Id=7680;class Ni{constructor(t,n,u,p,g,b){this.test=t,this.ref=n,this.mask=u,this.fail=p,this.depthFail=g,this.pass=b}}Ni.disabled=new Ni({func:519,mask:0},0,0,Id,Id,Id);const Io=1029,Ro=2305;class Ii{constructor(t,n,u){this.enable=t,this.mode=n,this.frontFace=u}}function ip(h,t){const n=r.bG(h,3);r.ad.mat4.fromQuat(h,t),r.bI(h,3,n)}function Do(h,t){const n=r.ad.quat.identity([]);return r.ad.quat.rotateZ(n,n,-t),r.ad.quat.rotateX(n,n,-h),n}function xc(h,t){const n=[h[0],h[1],0],u=[t[0],t[1],0];if(r.ad.vec3.length(n)>=1e-15){const b=r.ad.vec3.normalize([],n);r.ad.vec3.scale(u,b,r.ad.vec3.dot(u,b)),t[0]=u[0],t[1]=u[1]}const p=r.ad.vec3.cross([],t,h);if(r.ad.vec3.len(p)<1e-15)return null;const g=Math.atan2(-p[1],p[0]);return Do(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),g)}Ii.disabled=new Ii(!1,Io,Ro),Ii.backCCW=new Ii(!0,Io,Ro),Ii.backCW=new Ii(!0,Io,2304),Ii.frontCW=new Ii(!0,1028,2304),Ii.frontCCW=new Ii(!0,1028,Ro);class Rd{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof r.ac?t:new r.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=r.bF(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(r.ac.fromLngLat(t)):0,g=r.ac.fromLngLat(t,p),b=[g.x-u.x,g.y-u.y,g.z-u.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=xc(b,n)}setPitchBearing(t,n){this.orientation=Do(r.ak(t),r.ak(-n))}}class Cl{constructor(t,n){this._transform=r.ad.mat4.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new r.ac(t[0],t[1],t[2])}get position(){const t=r.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&r.bI(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.ad.quat.identity([]),t&&ip(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=Do(t,n),ip(this._transform,this._orientation)}forward(){const t=r.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const u=new Float64Array(16);return r.ad.mat4.invert(u,this.getWorldToCamera(t,n)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,u){const p=this.position;r.ad.vec3.scale(p,p,-t);const g=new Float64Array(16);return r.ad.mat4.fromScaling(g,[u,u,u]),r.ad.mat4.translate(g,g,p),g[10]*=n,g}getWorldToCamera(t,n){const u=new Float64Array(16),p=new Float64Array(4),g=this.position;return r.ad.quat.conjugate(p,this._orientation),r.ad.vec3.scale(g,g,-t),r.ad.mat4.fromQuat(u,p),r.ad.mat4.translate(u,u,g),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=n,u[9]*=n,u[10]*=n,u[11]*=n,u}getCameraToClipPerspective(t,n,u,p){const g=new Float64Array(16);return r.ad.mat4.perspective(g,t,n,u,p),g}getCameraToClipOrthographic(t,n,u,p,g,b){const I=new Float64Array(16);return r.ad.mat4.ortho(I,t,n,u,p,g,b),I}getDistanceToElevation(t,n=!1){const u=t===0?0:r.bH(t,n?r.aT(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new Cl([...this.position],[...this.orientation])}}const mr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Au{constructor(t=0,n=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=u,this.right=p}interpolate(t,n,u){return n.top!=null&&t.top!=null&&(this.top=r.ah(t.top,n.top,u)),n.bottom!=null&&t.bottom!=null&&(this.bottom=r.ah(t.bottom,n.bottom,u)),n.left!=null&&t.left!=null&&(this.left=r.ah(t.left,n.left,u)),n.right!=null&&t.right!=null&&(this.right=r.ah(t.right,n.right,u)),this}getCenter(t,n){const u=r.ay((this.left+t-this.right)/2,0,t),p=r.ay((this.top+n-this.bottom)/2,0,n);return new r.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Au(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Bt=15;class Eh{constructor(t,n,u,p,g,b,I){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(b),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Au,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Cl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Eh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Bt}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return r.aA(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);const u=this.getProjection(),p=!r.bn(n,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=r.ad.mat2.create(),r.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=r.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.ak(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,g=0;for(let b=0;b<n.length;b++){const I=new r.P(n[b][0]*this.width,u+n[b][1]*(this.height-u)),L=t.pointCoordinate(I);if(!L)continue;const P=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);p+=L[3]*P,g+=P}return g===0?NaN:p/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*n,p=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),b=Math.max(p-u,g);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const p=r.ad.vec3.length(r.ad.vec3.sub([],this._camera.position,u));return r.ay(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!r.ad.quat.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];r.ad.vec3.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new Rd;return n.position=new r.ac(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!r.ad.quat.length(t))return!1;r.ad.quat.normalize(t,t);const n=r.ad.vec3.transformQuat([],[0,0,-1],t),u=r.ad.vec3.transformQuat([],[0,-1,0],t);if(u[2]<0)return!1;const p=xc(n,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=r.ay(t[2],p/u,p/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,u){this._unmodified=!1,this._edgeInsets.interpolate(t,n,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new r.bQ(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new r.P(0,0)),p=this.pointCoordinate(new r.P(this.width,0)),g=this.pointCoordinate(new r.P(this.width,this.height)),b=this.pointCoordinate(new r.P(0,this.height)),I=Math.floor(Math.min(u.x,p.x,g.x,b.x)),L=Math.floor(Math.max(u.x,p.x,g.x,b.x)),P=1;for(let k=I-P;k<=L+P;k++)k!==0&&n.push(new r.bQ(k,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,u){let p=[];const g=u!==void 0,b=!g;if(b&&this.zoom<n||g&&u[0]===0&&u[1]===0)return p;const I=new Set,L=(k,U,j,$,Q)=>{const W=r.c5(U,k,j,$,Q);I.has(W)||(p.push(new r.aH(k,U,j,$,Q)),I.add(W))};for(let k=0;k<t.length;k++){const U=t[k];if(b&&U.canonical.z!==n)continue;const j=U.canonical,$=U.overscaledZ,Q=U.wrap,W=1<<j.z,te=j.x+1<W,ne=j.x>0,ce=j.y+1<W,me=j.y>0,fe=U.wrap-(ne?0:1),we=U.wrap+(te?0:1),ye=ne?j.x-1:W-1,ve=te?j.x+1:0;if(g)u[0]<0?(L($,we,j.z,ve,j.y),u[1]<0&&ce&&(L($,Q,j.z,j.x,j.y+1),L($,we,j.z,ve,j.y+1)),u[1]>0&&me&&(L($,Q,j.z,j.x,j.y-1),L($,we,j.z,ve,j.y-1))):u[0]>0?(L($,fe,j.z,ye,j.y),u[1]<0&&ce&&(L($,Q,j.z,j.x,j.y+1),L($,fe,j.z,ye,j.y+1)),u[1]>0&&me&&(L($,Q,j.z,j.x,j.y-1),L($,fe,j.z,ye,j.y-1))):u[1]<0&&ce?L($,Q,j.z,j.x,j.y+1):me&&L($,Q,j.z,j.x,j.y-1);else{const xe=U.visibleQuadrants;1&xe&&(L($,fe,j.z,ye,j.y),me&&(L($,Q,j.z,j.x,j.y-1),L($,fe,j.z,ye,j.y-1))),2&xe&&(L($,we,j.z,ve,j.y),me&&(L($,Q,j.z,j.x,j.y-1),L($,we,j.z,ve,j.y-1))),4&xe&&(L($,fe,j.z,ye,j.y),ce&&(L($,Q,j.z,j.x,j.y+1),L($,fe,j.z,ye,j.y+1))),8&xe&&(L($,we,j.z,ve,j.y),ce&&(L($,Q,j.z,j.x,j.y+1),L($,we,j.z,ve,j.y+1)))}}const P=[];for(const k of p)p.some(U=>k.isChildOf(U))||P.push(k);if(p=P.filter(k=>!t.some(U=>!!(k.overscaledZ<n&&U.isChildOf(k))||k.equals(U)||k.isChildOf(U))),b){const k=1<<n,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=[k*U.x,k*U.y],$=4,Q=$*$;p=p.filter(W=>{const te=W.canonical.x+.5-j[0],ne=W.canonical.y+.5-j[1];return te*te+ne*ne<Q})}return p}coveringTiles(t){let n=this.coveringZoomLevel(t);const u=n,p=this.elevation&&this.elevation.exaggeration(),g=p&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const I=this.locationCoordinate(this.center),L=this.center.lat,P=1<<n,k=[P*I.x,P*I.y,0],U=this.projection.name==="globe",j=!U,$=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,j),Q=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=P*r.bH(1,this.center.lat),te=this._camera.position[2]/r.bH(1,this.center.lat),ne=[P*Q.x,P*Q.y,te*(j?1:W)],ce=U||p,me=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),fe=this.isLODDisabled(!0)?n:0;let we;if(this._elevation&&t.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Ne=this._elevation.getMinMaxForVisibleTiles();we=Ne?Ne.max:this._centerAltitude}else we=this._centerAltitude;const ye=t.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?r.bS(this):1,xe=Ne=>{const nt=new r.ac(Ne.x+25e-6,Ne.y,Ne.z),yt=new r.ac(Ne.x,Ne.y+25e-6,Ne.z),et=Ne.toLngLat(),gt=nt.toLngLat(),Vt=yt.toLngLat(),Ut=this.locationCoordinate(et),Gt=this.locationCoordinate(gt),oi=this.locationCoordinate(Vt),Di=Math.hypot(Gt.x-Ut.x,Gt.y-Ut.y),xi=Math.hypot(oi.x-Ut.x,oi.y-Ut.y);return Math.sqrt(Di*xi)*ve/25e-6},Se=Ne=>{const ht=we,nt=ye;return{aabb:r.bV(this,P,0,0,0,Ne,nt,ht,this.projection),zoom:0,x:0,y:0,minZ:nt,maxZ:ht,wrap:Ne,fullyVisible:!1}},Ce=[];let Ke=[];const Ge=n,ct=t.reparseOverscaled?u:n,_t=(te-this._centerAltitude)*W,Ct=Ne=>{if(!this._elevation||!Ne.tileID||!b)return;const ht=this._elevation.getMinMaxForTile(Ne.tileID),nt=Ne.aabb;ht?(nt.min[2]=ht.min,nt.max[2]=ht.max,nt.center[2]=(nt.min[2]+nt.max[2])/2):(Ne.shouldSplit=ut(Ne),Ne.shouldSplit||(nt.min[2]=nt.max[2]=nt.center[2]=this._centerAltitude))},Ve=(Ne,ht)=>{if(.707*ht<Ne)return 1;const nt=ht/Ne;return nt/(1.4144271570014144+(Math.pow(1.1,nt-1.4144271570014144+1)-1)/(1.1-1)-1)},ut=Ne=>{if(Ne.zoom<fe)return!0;if(Ne.zoom===Ge)return!1;if(Ne.shouldSplit!=null)return Ne.shouldSplit;const ht=Ne.aabb.distanceX(ne),nt=Ne.aabb.distanceY(ne);let yt=_t,et=1;if(U){yt=Ne.aabb.distanceZ(ne);const xi=Math.pow(2,Ne.zoom),Ri=r.aT((Ne.y+1)/xi),Ci=r.aT(Ne.y/xi),on=Math.min(Math.max(L,Ri),Ci),Sn=r.ca(on)/r.ca(L);if(et=on===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Sn/this._mercatorScaleRatio),this.zoom<=r.c6&&Ne.zoom===Ge-1&&Sn>=.9)return!0}else if(g&&(yt=Ne.aabb.distanceZ(ne)*W),this.projection.isReprojectedInTileSpace&&u<=5){const xi=Math.pow(2,Ne.zoom),Ri=xe(new r.ac((Ne.x+.5)/xi,(Ne.y+.5)/xi));et=Ri>.85?1:Ri}if(!b){const xi=Math.sqrt(ht*ht+nt*nt+yt*yt);let Ri=(1<<Ge-Ne.zoom)*me*et;return Ri*=Ve(Math.max(yt,_t),xi),xi<Ri}let gt=Number.MAX_VALUE,Vt=0;const Ut=Ne.aabb.getCorners(),Gt=[];for(const xi of Ut){r.ad.vec3.sub(Gt,xi,ne),U||(g?Gt[2]*=W:Gt[2]=_t);const Ri=r.ad.vec3.dot(Gt,this._camera.forward());Ri<gt&&(gt=Ri,Vt=Math.abs(Gt[2]))}let oi=(1<<Ge-Ne.zoom)*me*et;if(oi*=Ve(Math.max(Vt,_t),gt),gt<oi)return!0;const Di=Ne.aabb.closestPoint(k);return Di[0]===k[0]&&Di[1]===k[1]};if(this.renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)Ce.push(Se(-Ne)),Ce.push(Se(Ne));for(Ce.push(Se(0));Ce.length>0;){const Ne=Ce.pop(),ht=Ne.x,nt=Ne.y;let yt=Ne.fullyVisible;const et=()=>this.projection.name==="globe"&&(Ne.y===0||Ne.y===(1<<Ne.zoom)-1);if(!yt){let gt=ce?Ne.aabb.intersects($):Ne.aabb.intersectsFlat($);if(gt===0&&et()){const Vt=new r.bT(Ne.zoom,ht,nt);gt=r.bU(this,P,Vt,!0).intersects($)}if(gt===0)continue;yt=gt===2}if(Ne.zoom!==Ge&&ut(Ne))for(let gt=0;gt<4;gt++){const Vt=(ht<<1)+gt%2,Ut=(nt<<1)+(gt>>1),Gt={aabb:b?Ne.aabb.quadrant(gt):r.bV(this,P,Ne.zoom+1,Vt,Ut,Ne.wrap,Ne.minZ,Ne.maxZ,this.projection),zoom:Ne.zoom+1,x:Vt,y:Ut,wrap:Ne.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Ne.minZ,maxZ:Ne.maxZ};g&&!U&&(Gt.tileID=new r.aH(Ne.zoom+1===Ge?ct:Ne.zoom+1,Ne.wrap,Ne.zoom+1,Vt,Ut),Ct(Gt)),Ce.push(Gt)}else{const gt=Ne.zoom===Ge?ct:Ne.zoom;if(t.minzoom&&t.minzoom>gt)continue;let Vt=0;if(!yt){let Di=ce?Ne.aabb.intersectsPrecise($):Ne.aabb.intersectsPreciseFlat($);if(Di===0&&et()){const xi=new r.bT(Ne.zoom,ht,nt);Di=r.bU(this,P,xi,!0).intersectsPrecise($)}if(Di===0)continue;if(t.calculateQuadrantVisibility)if($.containsPoint(Ne.aabb.center))Vt=15;else for(let xi=0;xi<4;xi++)Ne.aabb.quadrant(xi).intersects($)!==0&&(Vt|=1<<xi)}const Ut=k[0]-(.5+ht+(Ne.wrap<<Ne.zoom))*(1<<n-Ne.zoom),Gt=k[1]-.5-nt,oi=Ne.tileID?Ne.tileID:new r.aH(gt,Ne.wrap,Ne.zoom,ht,nt);t.calculateQuadrantVisibility&&(oi.visibleQuadrants=Vt),Ke.push({tileID:oi,distanceSq:Ut*Ut+Gt*Gt})}}if(this.fogCullDistSq){const Ne=this.fogCullDistSq,ht=this.horizonLineFromTop();Ke=Ke.filter(nt=>{const yt=[0,0,0,1],et=[r.ai,r.ai,0,1],gt=this.calculateFogTileMatrix(nt.tileID.toUnwrapped());r.ad.vec4.transformMat4(yt,yt,gt),r.ad.vec4.transformMat4(et,et,gt);const Vt=r.ad.vec4.min([],yt,et),Ut=r.ad.vec4.max([],yt,et),Gt=r.bW(Vt,Ut);if(Gt===0)return!0;let oi=!1;const Di=this._elevation;if(Di&&Gt>Ne&&ht!==0){const xi=this.calculateProjMatrix(nt.tileID.toUnwrapped());let Ri;t.isTerrainDEM||(Ri=Di.getMinMaxForTile(nt.tileID)),Ri||(Ri={min:ye,max:we});const Ci=r.c7(this.rotation),on=[Ci[0]*r.ai,Ci[1]*r.ai,Ri.max];r.ad.vec3.transformMat4(on,on,xi),oi=(1-on[1])*this.height*.5<ht}return Gt<Ne||oi})}return Ke.sort((Ne,ht)=>Ne.distanceSq-ht.distanceSq).map(Ne=>Ne.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=r.ay(t.lat,-r.bX,r.bX),u=this.projection.project(t.lng,n);return new r.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let u,p;const g=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;u=(n.x-g.x)/I,p=(n.y-g.y)/I}else{const I=this.pointCoordinate(n),L=this.pointCoordinate(g);u=I.x-L.x,p=I.y-L.y}const b=this.locationCoordinate(t);this.setLocation(new r.ac(b.x-u,b.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,n){return this.projection.locationPoint(this,t,n)}locationPoint3D(t,n){return this.projection.locationPoint(this,t,n,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,n){return this.coordinateLocation(this.pointCoordinate3D(t,n))}locationCoordinate(t,n){const u=n?r.bH(n,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new r.ac(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const u=n??this._centerAltitude,p=[t.x,t.y,0,1],g=[t.x,t.y,1,1];r.ad.vec4.transformMat4(p,p,this.pixelMatrixInverse),r.ad.vec4.transformMat4(g,g,this.pixelMatrixInverse);const b=g[3];r.ad.vec4.scale(p,p,1/p[3]),r.ad.vec4.scale(g,g,1/b);const I=p[2],L=g[2];return{p0:p,p1:g,t:I===L?0:(u-I)/(L-I)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return r.ad.vec4.transformMat4(n,n,this.pixelMatrixInverse),r.ad.vec4.transformMat4(u,u,this.pixelMatrixInverse),r.ad.vec4.scale(n,n,1/n[3]),r.ad.vec4.scale(u,u,1/u[3]),n[2]=r.bH(n[2],this._center.lat)*this.worldSize,u[2]=r.bH(u[2],this._center.lat)*this.worldSize,r.ad.vec4.scale(n,n,1/this.worldSize),r.ad.vec4.scale(u,u,1/this.worldSize),new r.as([n[0],n[1],n[2]],r.ad.vec3.normalize([],r.ad.vec3.sub([],u,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:u,t:p}=t,g=r.bH(n[2],this._center.lat),b=r.bH(u[2],this._center.lat);return new r.ac(r.ah(n[0],u[0],p)/this.worldSize,r.ah(n[1],u[1],p)/this.worldSize,r.ah(g,b,p))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t,n){if(!this.elevation)return this.pointCoordinate(t,n);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new r.ac(u[0],u[1],u[2]);let p=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,n);const b=.02*g,I=t.clone();for(let L=0;L<10&&g-p>b;L++){I.y=r.ah(p,g,.66);const P=this.projection.pointCoordinate3D(this,I.x,I.y);P?(g=I.y,u=P):p=I.y}return u?new r.ac(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const u=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return r.ad.vec4.transformMat4(p,p,this.pixelMatrix),p[3]>0?new r.P(p[0]/p[3],p[1]/p[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,g=this.pointLocation3D(new r.P(n,t)),b=this.pointLocation3D(new r.P(p,t)),I=this.pointLocation3D(new r.P(p,u)),L=this.pointLocation3D(new r.P(n,u));let P=Math.min(g.lng,b.lng,I.lng,L.lng),k=Math.max(g.lng,b.lng,I.lng,L.lng),U=Math.min(g.lat,b.lat,I.lat,L.lat),j=Math.max(g.lat,b.lat,I.lat,L.lat);const $=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,W=(te,ne,ce,me,fe)=>{const we=(te+ce)/2,ye=(ne+me)/2,ve=new r.P(we,ye),{lng:xe,lat:Se}=this.pointLocation3D(ve),Ce=Math.max(0,P-xe,U-Se,xe-k,Se-j);P=Math.min(P,xe),k=Math.max(k,xe),U=Math.min(U,Se),j=Math.max(j,Se),(fe<Q||Ce>$)&&(W(te,ne,we,ye,fe+1),W(we,ye,ce,me,fe+1))};if(W(n,t,p,t,1),W(p,t,p,u,1),W(p,u,n,u,1),W(n,u,n,t,1),this.projection.name==="globe"){const[te,ne]=r.bZ(this);te?(j=90,k=180,P=-180):ne&&(U=-90,k=180,P=-180)}return new r.aB(new r.bO(P,U),new r.bO(k,j))}_getBoundsRectangular(t,n){const{top:u,left:p}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,I=new r.P(p,u),L=new r.P(b,u),P=new r.P(b,g),k=new r.P(p,g);let U=this.pointCoordinate(I,t),j=this.pointCoordinate(L,t);const $=this.pointCoordinate(P,n),Q=this.pointCoordinate(k,n),W=(te,ne)=>(ne.y-te.y)/(ne.x-te.x);return U.y>1&&j.y>=0?U=new r.ac((1-Q.y)/W(Q,U)+Q.x,1):U.y<0&&j.y<=1&&(U=new r.ac(-Q.y/W(Q,U)+Q.x,0)),j.y>1&&U.y>=0?j=new r.ac((1-$.y)/W($,j)+$.x,1):j.y<0&&U.y<=1&&(j=new r.ac(-$.y/W($,j)+$.x,0)),new r.aB().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation($))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const g=p.dem.tree;u.min=Math.min(u.min,g.minimums[0]),u.max=Math.max(u.max,g.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.av(this.minLng)*this.tileSize,this.worldMaxX=r.av(this.maxLng)*this.tileSize,this.worldMinY=r.aC(this.maxLat)*this.tileSize,this.worldMaxY=r.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,u=this._distanceTileDataCache;if(u[n])return u[n];const p=t.canonical,g=1/this.height,b=this.cameraWorldSize,I=b/this.zoomScale(p.z),L=(p.x+Math.pow(2,p.z)*t.wrap)*I,P=p.y*I,k=this.point;k.x*=b/this.worldSize,k.y*=b/this.worldSize;const U=this.angle,j=Math.sin(-U),$=-Math.cos(-U);return u[n]={bearing:[j,$],center:[(k.x-L)*g,(k.y-P)*g],scale:I/r.ai*g},u[n]}calculateFogTileMatrix(t){const n=t.key,u=this._fogTileMatrixCache;if(u[n])return u[n];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.ad.mat4.multiply(p,this.worldToFogMatrix,p),u[n]=new Float32Array(p),u[n]}calculateProjMatrix(t,n=!1,u=!1){const p=t.key;let g;if(g=u?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,g[p])return g[p];const b=this.calculatePosMatrix(t,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,r.ad.mat4.multiply(b,I,b),g[p]=new Float32Array(b),g[p]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[n])return u[n];const p=r.b_(t,this);return u[n]=p,u[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=r.ad.mat4.fromScaling([],[t,t,t]);return r.ad.mat4.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=r.bH(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(n),p=this._camera.forward(),g=r.bH(1,this._center.lat);u[2]/=g,p[2]/=g,r.ad.vec3.normalize(p,p);const b=t.raycast(u,p,t.exaggeration());if(b){const I=r.ad.vec3.scaleAndAdd([],u,p,b),L=new r.ac(I[0],I[1],r.bH(I[2],r.aT(I[1]))),P=(L.z+r.ad.vec3.length([L.x-u[0],L.y-u[1],L.z-u[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,u=r.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),g=n.getAtPointOrZero(new r.ac(...p)),b=this.pixelsPerMeter/this.worldSize*g,I=this._minimumHeightOverTerrain(),L=p[2]-b;if(L<=I)if(L<0||t){const P=this.locationCoordinate(this._center,this._centerAltitude),k=[p[0],p[1],P.z-p[2]],U=r.ad.vec3.length(k);k[2]-=(I-L)/this._pixelsPerMercatorPixel;const j=r.ad.vec3.length(k);if(j===0)return;r.ad.vec3.scale(k,k,U/j*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],P.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const j=this.center;return j.lat=r.ay(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(j.lng=r.ay(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const n=this._unmodified,{x:u,y:p}=this.point;let g=0,b=u,I=p;const L=this.width/2,P=this.height/2,k=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(p-P<k&&(I=k+P),p+P>U&&(I=U-P),U-k<this.height&&(g=Math.max(g,this.height/(U-k)),I=(U+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,Q=this.worldSize/2-(j+$)/2;b=(u+Q+this.worldSize)%this.worldSize-Q,b-L<j&&(b=j+L),b+L>$&&(b=$-L),$-j<this.width&&(g=Math.max(g,this.width/($-j)),b=($+j)/2)}b===u&&I===p||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(b,I))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));const p=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?u:1,b=this._camera.getWorldToCamera(this.worldSize,g);let I;const L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(L[8]=2*-t.x/this.width,L[9]=2*t.y/this.height,this.isOrthographic){let Se=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=Se*this.aspect,Ke=-Ce,Ge=-Se;Ce-=t.x,Ke-=t.x,Se+=t.y,Ge+=t.y,I=this._camera.getCameraToClipOrthographic(Ke,Ce,Ge,Se,this._nearZ,this._farZ),((ct,_t,Ct,Ve)=>{for(let ut=0;ut<16;ut++)ct[ut]=r.ah(_t[ut],Ct[ut],Ve)})(I,I,L,r.c9(this.pitch>=Bt?1:this.pitch/Bt))}else I=L;const P=r.ad.mat4.mul([],L,b);let k=r.ad.mat4.mul([],I,b);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Ce=r.ad.mat4.identity([]);r.ad.mat4.translate(Ce,Ce,[Se.x*this.worldSize,Se.y*this.worldSize,0]),r.ad.mat4.multiply(Ce,Ce,r.c0(this)),r.ad.mat4.translate(Ce,Ce,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),r.ad.mat4.multiply(k,k,Ce),r.ad.mat4.multiply(P,P,Ce),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ad.mat4.scale([],k,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=k,this.invProjMatrix=r.ad.mat4.invert(new Float64Array(16),this.projMatrix),n){const Se=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Se[8]=2*-t.x/this.width,Se[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.ad.mat4.mul([],Se,b)}else this.expandedFarZProjMatrix=this.projMatrix;const U=r.ad.mat4.invert([],I);this.frustumCorners=r.c2.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const j=new Float32Array(16);r.ad.mat4.identity(j),r.ad.mat4.scale(j,j,[1,-1,1]),r.ad.mat4.rotateX(j,j,this._pitch),r.ad.mat4.rotateZ(j,j,this.angle);const $=r.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ad.mat4.clone($);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-t.x/this.width,$[9]=2*(t.y+Q)/this.height,this.skyboxMatrix=r.ad.mat4.multiply(j,$,j);const W=this.point,te=W.x,ne=W.y,ce=this.width%2/2,me=this.height%2/2,fe=Math.cos(this.angle),we=Math.sin(this.angle),ye=te-Math.round(te)+fe*ce+we*me,ve=ne-Math.round(ne)+fe*me+we*ce,xe=new Float64Array(k);if(r.ad.mat4.translate(xe,xe,[ye>.5?ye-1:ye,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=xe,k=r.ad.mat4.create(),r.ad.mat4.scale(k,k,[this.width/2,-this.height/2,1]),r.ad.mat4.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=r.ad.mat4.create(),r.ad.mat4.scale(k,k,[1,-1,1]),r.ad.mat4.translate(k,k,[-1,-1,0]),r.ad.mat4.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=r.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},k=r.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ad.vec3.transformMat4(Se,Se,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,n];r.ad.vec3.scale(g,g,p),r.ad.vec3.scale(u,u,-1),r.ad.vec3.multiply(u,u,g);const b=r.ad.mat4.create();r.ad.mat4.translate(b,b,u),r.ad.mat4.scale(b,b,g),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,p)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*g,p.y/this.worldSize-u[1]*g,t/this.worldSize*this._centerAltitude-u[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(g=Math.min((n-u)/p,1)),this._camera.position=r.ad.vec3.scaleAndAdd([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),g=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ak(this._maxPitch)),I=Math.max((t[2]-g)/Math.cos(u),b),L=this._zoomFromMercatorZ(I);r.ad.vec3.scaleAndAdd(t,t,n,I),this._pitch=r.ay(u,r.ak(this.minPitch),r.ak(this.maxPitch)),this.angle=r.bF(p,-Math.PI,Math.PI),this._setZoom(r.ay(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,u=r.bY,p=0,g=1/0;for(;u-n>1e-6&&u>n;){const b=n+.5*(u-n),I=this.tileSize*Math.pow(2,b),L=this.getCameraToCenterDistance(this.projection,b,I),P=this.scaleZoom(L/(t*this.tileSize)),k=Math.abs(b-P);k<g&&(g=k,p=b),b<P?n=b:u=b}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const u=Math.min(t.x,n.x),p=Math.max(t.x,n.x),g=Math.min(t.y,n.y),b=Math.max(t.y,n.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new r.P(u,g),new r.P(p,b),new r.P(u,b),new r.P(p,g)],L=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const k of I){const U=this.pointRayIntersection(k);if(U.t<0)return!0;const j=this.rayIntersectionCoordinate(U);if(j.x<L||j.y<0||j.x>P||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,n){const u=r.ad.vec3.length(r.ad.vec3.sub([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+n;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,u,p],g){const b=[n,u,p,1];r.ad.vec4.transformMat4(b,b,g);const I=b[3]=Math.max(b[3],1e-6);return b[0]/=I,b[1]/=I,b[2]/=I,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,u=this.worldSize){const p=r.b$(t,n,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,u,p);let b=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(b=r.ah(1,b,r.c9(this.pitch>=Bt?1:this.pitch/Bt))),b}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ad.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Wo=(h,t)=>{if(t>0&&h.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=h.transform,u=Math.max(Math.abs(n._zoom-(h.minCutoffZoom-1)),1),p=n.isLODDisabled(!1)?r.ae(60,45,n.pitch):r.ae(30,15,n.pitch),g=n._farZ-n._nearZ,b=t*n.height,I=((1-(L=p))*n.cameraToCenterDistance+L*(n._farZ+b))*u;var L;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(I-n._nearZ)/g,(I-b-n._nearZ)/g]}}},xa={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class dm{constructor(t,n){this.aabb=t,this.lastCascade=n}}class Dd{add(t,n){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],n.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],n.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],n.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],n.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],n.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],n.max[2])):this.receivers[t.key]=new dm(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,u){const p=r.ce.fromPoints(t.points);let g=0;for(const b in this.receivers){const I=this.receivers[b];if(!I||!p.intersectsAabb(I.aabb))continue;I.aabb.min=p.closestPoint(I.aabb.min),I.aabb.max=p.closestPoint(I.aabb.max);const L=I.aabb.getCorners();for(let P=0;P<u.length;P++){let k=!0;for(const U of L){const j=[U[0]*n,U[1]*n,U[2]];if(r.ad.vec3.transformMat4(j,j,u[P].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){k=!1;break}}if(I.lastCascade=P,g=Math.max(g,P),k)break}}return g+1}}class Ko{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Dd,this._depthMode=new mi(t.context.gl.LEQUAL,mi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(xa,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(xa,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(xa,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const p=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((Q,W)=>{const te=u.style._mergedLayers[W];return Q+(te.hasShadowPass()&&!te.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=u.context,b=xa.shadowMapResolution,I=xa.shadowMapResolution;if(this._cascades.length===0||xa.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<xa.cascadeCount;++Q){const W=u._shadowMapDebug,te=g.gl,ne=g.createFramebuffer(b,I,W,"texture"),ce=new r.T(g,{width:b,height:I,data:null},te.DEPTH_COMPONENT16);if(ne.depthAttachment.set(ce.texture),W){const me=new r.T(g,{width:b,height:I,data:null},te.RGBA8);ne.colorAttachment.set(me.texture)}this._cascades.push({framebuffer:ne,texture:ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=qs(n);let L=0;if(t.elevation){const Q=t.elevation,W=[1e4,-1e4];Q.visibleDemTiles.filter(te=>te.dem).forEach(te=>{const ne=te.dem.tree;W[0]=Math.min(W[0],ne.minimums[0]),W[1]=Math.max(W[1],ne.maximums[0])}),W[0]!==1e4&&(L=(W[1]-W[0])*Q.exaggeration())}const P=1.5*t.cameraToCenterDistance,k=3*P,U=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const W=this._cascades[Q];let te=t.height/50,ne=1;xa.cascadeCount===1?ne=k:Q===0?ne=P:(te=P,ne=k);const[ce,me]=wc(t,this.shadowDirection,te,ne,xa.shadowMapResolution,L);W.scale=t.scale,W.matrix=ce,W.boundingSphereRadius=me,r.ad.mat4.invert(U,W.matrix),W.frustum=r.bR.fromInvProjectionMatrix(U,1,0,!0),W.far=ne}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/xa.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=xa.shadowMapResolution,this._uniformValues.u_shadowmap_0=mr.ShadowMap0,this._uniformValues.u_shadowmap_1=mr.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const $=u.transform.elevation;for(const Q of this._groundShadowTiles){let W={min:0,max:0};if($){const te=$.getMinMaxForTile(Q);te&&(W=te)}this.addShadowReceiver(Q.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,xa.shadowMapResolution,xa.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){u.currentShadowCascade=g,p.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),p.clear({color:r.al.white,depth:1});for(const b of t.order){const I=t._mergedLayers[b];if(!I.hasShadowPass()||I.isHidden(u.transform.zoom))continue;const L=t.getLayerSourceCache(I),P=L?n[L.id]:void 0;(I.type==="model"||P&&P.length)&&u.renderLayer(u,L,I,P)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,u=t.context,p=n.directionalLight,g=n.ambientLight;if(!p||!g)return;const b=[],I=Wo(t,t.longestCutoffRange);I.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&b.push("NORMAL_OFFSET");const L=bc(n,p,g),P=new mi(u.gl.LEQUAL,mi.ReadOnly,t.depthRangeFor3D);for(const k of this._groundShadowTiles){const U=k.toUnwrapped(),j=t.isTileAffectedByFog(k),$=t.getOrCreateProgram("groundShadow",{defines:b,overrideFog:j});this.setupShadows(U,$),t.uploadCommonUniforms(u,$,U,null,I);const Q={u_matrix:t.transform.calculateProjMatrix(U),u_ground_shadow_factor:L};$.draw(t,u.gl.TRIANGLES,P,Ni.disabled,en.multiply,Ii.disabled,Q,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?en.unblended:en.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,u=n.calculatePosMatrix(t,n.worldSize);return r.ad.mat4.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return r.ad.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,u,p=0){if(!this.enabled)return;const g=this.painter.transform,b=this.painter.context,I=b.gl,L=this._uniformValues,P=new Float64Array(16),k=g.calculatePosMatrix(t,g.worldSize);for(let U=0;U<this._cascades.length;U++)r.ad.mat4.multiply(P,this._cascades[U].matrix,k),L[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),b.activeTexture.set(I.TEXTURE0+mr.ShadowMap0+U),this._cascades[U].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const U=r.cd(t.canonical),j=2/g.tileSize*r.ai/xa.shadowMapResolution,$=j*this._cascades[0].boundingSphereRadius,Q=j*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-g.zoom+Math.floor(g.zoom)));L.u_shadow_normal_offset=[U,$*W,Q*W],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(b,L)}setupShadowsFromMatrix(t,n,u=!1){if(!this.enabled)return;const p=this.painter.context,g=p.gl,b=this._uniformValues,I=new Float64Array(16);for(let L=0;L<xa.cascadeCount;L++)r.ad.mat4.multiply(I,this._cascades[L].matrix,t),b[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),p.activeTexture.set(g.TEXTURE0+mr.ShadowMap0+L),this._cascades[L].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const L=xa.normalOffset;b.u_shadow_normal_offset=[1,L,L],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(p,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,u,p){if(p[2]>=0)return{};const g=function(L,P,k){const U=k/(1<<L.canonical.z);return new r.ce([L.canonical.x*U+L.wrap*k,L.canonical.y*U+L.wrap*k,0],[(L.canonical.x+1)*U+L.wrap*k,(L.canonical.y+1)*U+L.wrap*k,P])}(t,n,u).getCorners(),b=n/-p[2];p[0]<0?(r.ad.vec3.add(g[0],g[0],[p[0]*b,0,0]),r.ad.vec3.add(g[3],g[3],[p[0]*b,0,0])):p[0]>0&&(r.ad.vec3.add(g[1],g[1],[p[0]*b,0,0]),r.ad.vec3.add(g[2],g[2],[p[0]*b,0,0])),p[1]<0?(r.ad.vec3.add(g[0],g[0],[0,p[1]*b,0]),r.ad.vec3.add(g[1],g[1],[0,p[1]*b,0])):p[1]>0&&(r.ad.vec3.add(g[2],g[2],[0,p[1]*b,0]),r.ad.vec3.add(g[3],g[3],[0,p[1]*b,0]));const I={};return I.vertices=g,I.planes=[ba(g[1],g[0],g[4]),ba(g[2],g[1],g[5]),ba(g[3],g[2],g[6]),ba(g[0],g[3],g[7])],I}addShadowReceiver(t,n,u){this._receivers.add(t,r.ce.fromTileIdAndHeight(t,n,u))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function ba(h,t,n){const u=r.ad.vec3.sub([],n,t),p=r.ad.vec3.sub([],h,t),g=r.ad.vec3.cross([],u,p),b=r.ad.vec3.length(g);return b===0?[0,0,1,0]:(r.ad.vec3.scale(g,g,1/b),[g[0],g[1],g[2],-r.ad.vec3.dot(g,t)])}function qs(h){const t=h.properties.get("direction"),n=r.cc(t.x,t.y,t.z);n[2]=r.ay(n[2],0,75);const u=r.cf([n[0],n[1],n[2]]);return r.ad.vec3.fromValues(u.x,u.y,u.z)}function bc(h,t,n){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),g=t.properties.get("intensity"),b=t.properties.get("direction"),I=[b.x,b.y,b.z],L=n.properties.get("color-use-theme")==="none",P=n.properties.get("color"),k=n.properties.get("intensity"),U=Math.max(r.ad.vec3.dot([0,0,1],I),0),j=[0,0,0];r.ad.vec3.scale(j,P.toRenderColor(L?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),k);const $=[0,0,0];return r.ad.vec3.scale($,p.toRenderColor(u?null:h.getLut(n.scope)).toArray01Linear().slice(0,3),U*g),r.cg([j[0]>0?j[0]/(j[0]+$[0]):0,j[1]>0?j[1]/(j[1]+$[1]):0,j[2]>0?j[2]/(j[2]+$[2]):0])}function wc(h,t,n,u,p,g){const b=h.zoom,I=h.scale,L=h.worldSize,P=1/L,k=h.aspect,U=Math.sqrt(1+k*k)*Math.tan(.5*h.fovX),j=U*U,$=u-n,Q=u+n;let W,te;j>$/Q?(W=u,te=u*U):(W=.5*Q*(1+j),te=.5*Math.sqrt($*$+2*(u*u+n*n)*j+Q*Q*j*j));const ne=h.projection.pixelsPerMeter(h.center.lat,L),ce=h._camera.getCameraToWorldMercator(),me=[0,0,-W*P];r.ad.vec3.transformMat4(me,me,ce);let fe=te*P;const we=h._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){const yt=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?ne:1),et=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,n,u);et[8]=2*-h.centerOffset.x/h.width,et[9]=2*h.centerOffset.y/h.height;const gt=new Float64Array(16);r.ad.mat4.mul(gt,et,yt);const Vt=new Float64Array(16);r.ad.mat4.invert(Vt,gt);const Ut=r.bR.fromInvProjectionMatrix(Vt,L,b,!0);for(const Gt of Ut.points){const oi=((ye=Gt)[0]/=I,ye[1]/=I,ye[2]=r.bH(ye[2],h._center.lat),ye);fe=Math.max(fe,r.ad.vec3.len(r.ad.vec3.subtract([],me,oi)))}}var ye;fe*=p/(p-1);const ve=Math.acos(t[2]),xe=Math.atan2(-t[0],-t[1]),Se=new Cl;Se.position=me,Se.setPitchBearing(ve,xe);const Ce=Se.getWorldToCamera(L,ne),Ke=fe*L,Ge=Math.min(h._mercatorZfromZoom(17)*L*-2,-2*Ke),ct=Se.getCameraToClipOrthographic(-Ke,Ke,-Ke,Ke,Ge,(Ke+g*ne)/t[2]),_t=new Float64Array(16);r.ad.mat4.multiply(_t,ct,Ce);const Ct=r.ad.vec3.fromValues(Math.floor(1e6*me[0])/1e6*L,Math.floor(1e6*me[1])/1e6*L,0),Ve=.5*p,ut=[0,0,0];r.ad.vec3.transformMat4(ut,Ct,_t),r.ad.vec3.scale(ut,ut,Ve);const Ne=[Math.floor(ut[0]),Math.floor(ut[1]),Math.floor(ut[2])],ht=[0,0,0];r.ad.vec3.sub(ht,ut,Ne),r.ad.vec3.scale(ht,ht,-1/Ve);const nt=new Float64Array(16);return r.ad.mat4.identity(nt),r.ad.mat4.translate(nt,nt,ht),r.ad.mat4.multiply(_t,nt,_t),[_t,Ke]}class fm extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,n){return r.aN(this.requestManager.transformRequest(n,r.R.Model).url).then(u=>{if(!u)return;const p=r.aO(u),g=new r.aP(t,void 0,void 0,p);return g.computeBoundsAndApplyParent(),g}).catch(u=>{if(u&&u.status===404)return null;this.fire(new r.z(new Error(`Could not load model ${t} from ${n}: ${u.message}`)))})}load(t,n,u={keepNumReferences:!1}){this.models[n]||(this.models[n]={});const p=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+p.length;const g=[];for(const b of p)g.push(this.loadModel(b,t[b]));Promise.allSettled(g).then(b=>{for(let I=0;I<b.length;I++){const{status:L,value:P}=b[I];if(L==="fulfilled"&&P){const k=this.models[n][p[I]];this.models[n][p[I]]={model:P,numReferences:u.keepNumReferences&&k?k.numReferences:1}}}this.numModelsLoading[n]-=p.length,this.fire(new r.A("data",{dataType:"style"}))}).catch(b=>{this.fire(new r.z(new Error(`Could not load models: ${b.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}addModel(t,n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={}),this.hasModel(t,u)&&this.models[u][t].numReferences++,this.modelUris[u][t]=this.requestManager.normalizeModelURL(n),this.load({[t]:this.modelUris[u][t]},u)}addModels(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u=this.modelUris[n];for(const p in t)this.models[n][p]={},u[p]=this.requestManager.normalizeModelURL(t[p]);this.load(u,n,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u={};for(const p of t)this.hasModel(p,n)?this.models[n][p].numReferences++:(this.modelUris[n][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[n][p]);this.load(u,n)}removeModel(t,n){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0)){const u=this.models[n][t].model;delete this.models[n][t],delete this.modelUris[n][t],u.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const u in this.models[n])this.models[n][u].model&&this.models[n][u].model.upload(t.context)}}const pm=new r.a7({data:new r.a8(r.a5.colorTheme.data)}),Ah={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function mm(h){return h=h||{},Object.assign(h,Ah)}class Tc extends r.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(b,I){const[L,P]=b,{center:k,radius:U}=I,[j,$]=k,Q=Math.abs(L-j);return Math.sqrt((Q>180?360-Q:Q)**2+(P-$)**2)<=U}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.A("floorplangone")));const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=new r.P(this._map.transform.width/2,this._map.transform.height/2),p=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(t?p:u,n);g.length>0&&(this._selectedFloorplan&&g[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=g[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(g){const[[b,I],[L,P]]=g,k=(L-b+360)%360,U=k>180?360-k:k;return{center:[(b+U/2+360)%360,(I+P)/2],radius:Math.sqrt(U**2+(P-I)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const n=this._floorplanStates[this._indoorData.id].selectedBuilding,u=this._floorplanStates[this._indoorData.id].selectedLevel;let p;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const g of this._indoorData.levels)g.id===this._selectedLevel.id&&(p=g.id);if(this.fire(new r.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:p})),n){const g=this._indoorData.buildings.find(b=>b.id===n);this._buildingSelected(g,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(u){const g=this._indoorData.levels.find(b=>b.id===u);this._updateLevels(g,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,n){n&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new r.A("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const n=this._indoorData.levels.find(u=>u.id===t);this._updateLevels(n,!0)}this.fire(new r.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,n){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(n&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function u(P){const k=P.indexOf("/floor/");if(k===-1)return P;const U=k+7,j=P.indexOf("/",U);return j===-1?P.slice(U):P.slice(U,j)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const p=[],g={},b={},I={},L={};for(const P of this._indoorData.levels)if(p.push(P.id),g[P.id]=P.height,b[P.id]=P.base,t){if(this.mergeFloors){const k=u(t.id),U=u(P.id);I[P.id]=U===k?"true":"false"}else I[P.id]=P.id===t.id?"true":"false";L[P.id]=P.base<t.base?"true":"false"}else L[P.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",I]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",L]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),n&&t.extent)){const P=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),k=this._map.getZoom(),U=P.zoom?Math.abs(k-P.zoom):0;this._map.fitBounds(t.extent,U>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:k})}}selectFloorplan(t){const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,n);if(p.length>0){for(const g of p)if(JSON.parse(g.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=g,this._floorplanSelected(!0);break}}}selectBuilding(t){const n=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(n,!0)}selectLevel(t){this._levelSelected(t)}}function zd(h){if(!h.metadata||!h.metadata.content_area)return;const t=r.q.devicePixelRatio,{left:n,top:u,width:p,height:g}=h.metadata.content_area,b=n*t,I=u*t;return[b,I,b+p*t,I+g*t]}function Il(h){if(h)return h.map(([t,n])=>[t*r.q.devicePixelRatio,n*r.q.devicePixelRatio])}class np{constructor(t,n){this.id=t,this.style=n}addIcons(t){const n=new Map;for(const[u,p]of t.entries()){const g=r.I.from({name:u,iconsetId:this.id});n.set(g,p)}this.style.addImages(n)}}const Rl=(h,t)=>Je(h,t&&t.filter(n=>n.identifier!=="source.canvas")),Sc=r.aA(bn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Mu=r.aA(bn,["setCenter","setZoom","setBearing","setPitch"]),Cu=new Set(["background","sky","slot","custom"]),rp={version:8,layers:[],sources:{}},co={duration:300,delay:0};class Gs extends r.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=r.l({},co),this._buildingIndex=new mc(this),this.crossTileSymbolIndex=new hm,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new ks,this.dispatcher=n.dispatcher?n.dispatcher:new r.D(r.cj(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new Ss(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new r.ck(t._requestManager,n.localFontFamily?r.cl.all:n.localIdeographFontFamily?r.cl.ideographs:r.cl.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new fm(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",r.cm());const u=this;this._rtlTextPluginCallback=Gs.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,b)=>{if(r.cn(g),b&&b.every(I=>I))for(const I in u._sourceCaches){const L=u._sourceCaches[I],P=L.getSource().type;P!=="vector"&&P!=="geojson"||L.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.getOwnSource(p.sourceId);if(g&&g.vectorLayerIds)for(const b in this._layers){const I=this._layers[b];I.source===g.id&&this._validateLayer(I)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.f(t))return t;const n=r.co(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${r.cp(JSON.stringify(t))}`}_diffStyle(t,n,u){this.globalId=this._getGlobalId(t);const p=(g,b)=>{try{b(null,this.setState(g,u))}catch(I){b(I,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(g,r.R.Style);r.n(b,(I,L)=>{I?this.fire(new r.z(I)):L&&p(L,n)})}else typeof t=="object"&&p(t,n)}loadURL(t,n={}){this.fire(new r.A("dataloading",{dataType:"style"}));const u=typeof n.validate=="boolean"?n.validate:!r.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const g=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.n(g,(b,I)=>{if(this._request=null,b)this.fire(new r.z(b));else if(I)return this.importsCache.set(t,I),this._load(I,u)})}loadJSON(t,n={}){this.fire(new r.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.q.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new r.A("dataloading",{dataType:"style"})),this._load(rp,!1)}_loadImports(t,n,u){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const g of t){const b=this._createFragmentStyle(g),I=new Promise(k=>{b.once("style.import.load",k),b.once("error",k)}).then(()=>this.mergeAll());if(p.push(I),this.resolvedImports.has(g.url)){b.loadEmpty();continue}const L=g.data||this.importsCache.get(g.url);L?(b.loadJSON(L,{validate:n}),this._isInternalStyle(L)&&(b.globalId=null)):g.url?b.loadURL(g.url,{validate:n}):b.loadEmpty();const P={style:b,id:g.id,config:g.config};if(u){const k=this.fragments.findIndex(({id:U})=>U===u);this.fragments=this.fragments.slice(0,k).concat(P).concat(this.fragments.slice(k))}else this.fragments.push(P)}return Promise.allSettled(p)}getImportGlobalIds(t=this,n=new Set){for(const u of t.fragments)u.style.globalId&&n.add(u.style.globalId),this.getImportGlobalIds(u.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?r.C(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[n];(t.config||p)&&(u=r.l({},t.config,p));const g=new Gs(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){const u=t.indoor?mm(t.schema):t.schema;if(this._isInternalStyle(t)){const b=r.l({},rp,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(b,n)}if(this.updateConfig(this._config,u),n&&Rl(this,Ma(t)))return;this._loaded=!0,this.stylesheet=r.cq(t);const p=()=>{for(const P in t.sources)this.addSource(P,t.sources[P],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const P in t.iconsets)this.addIconset(P,t.iconsets[P]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const b=_c(this.stylesheet.layers);if(this._order=b.map(P=>P.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const P=this.stylesheet.lights[0];this.light=new it(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new it(this.stylesheet.light)),this._layers={};for(const P of b){const k=r.cv(P,this.scope,this._styleColorTheme.lut,this.options);k.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const U=this.getOwnLayerSourceCache(k),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&k.canCastShadows()&&j&&(U.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.A("data",{dataType:"style"}));const L=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new r.A(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.A(L?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const b=this._evaluateColorThemeData(g);this._loadColorTheme(b).then(()=>{p()}).catch(I=>{r.w(`Couldn't load color theme from the stylesheet: ${I}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,u,p,g,b,I,L,P,k;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(j.light!=null&&(t=j.light),j.stylesheet.lights)for(const $ of j.stylesheet.lights)$.type==="ambient"&&j.ambientLight!=null&&(n=j.ambientLight),$.type==="directional"&&j.directionalLight!=null&&(u=j.directionalLight);p=this._prioritizeTerrain(p,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(g=j.fog),j.stylesheet.snow&&j.snow!=null&&(b=j.snow),j.stylesheet.rain&&j.rain!=null&&(I=j.rain),j.stylesheet.camera!=null&&(k=j.stylesheet.camera),j.stylesheet.projection!=null&&(L=j.stylesheet.projection),j.stylesheet.transition!=null&&(P=j.stylesheet.transition),U[j.scope]=j._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=u,this.fog=g,this.snow=b,this.rain=I,this._styleColorThemeForScope=U,p===null?delete this.terrain:this.terrain=p,this.camera=k||{"camera-projection":"perspective"},this.projection=L||{name:"mercator"},this.transition=r.l({},co,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=u=>{for(const p of u.fragments)n(p.style);t(u)};n(this)}_prioritizeTerrain(t,n,u){const p=t&&t.drapeRenderMode===0;return u===null?n&&n.drapeRenderMode===0?n:p?t:null:n!=null&&(!t||p||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},u={};this.forEachFragmentStyle(p=>{for(const g in p._sourceCaches){const b=r.C(g,p.scope);t[b]=p._sourceCaches[g]}for(const g in p._otherSourceCaches){const b=r.C(g,p.scope);n[b]=p._otherSourceCaches[g]}for(const g in p._symbolSourceCaches){const b=r.C(g,p.scope);u[b]=p._symbolSourceCaches[g]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},n=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const b of g._order){const I=g._layers[b];if(I.type==="slot"){const L=r.cr(b);if(t[L])continue;t[L]=[]}I.slot&&t[I.slot]?t[I.slot].push(I):n.push(I)}}),this._mergedOrder=[];const p=(g=[])=>{for(const b of g)if(b.type==="slot"){const I=r.cr(b.id);t[I]&&p(t[I]),this._mergedSlots.push(I)}else{const I=r.C(b.id,b.scope);this._mergedOrder.push(I),u[I]=b,b.is3D(!!this.terrain)&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};p(n),this._mergedOrder.sort((g,b)=>{const I=u[g],L=u[b];return I.hasInitialOcclusionOpacityProperties?L.is3D(!!this.terrain)?1:0:I.is3D(!!this.terrain)&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=r.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,u,p){const g=r.l({},u);for(const I of Object.keys(r.a5.colorTheme))g[I]===void 0&&(g[I]=r.a5.colorTheme[I].default);const b=new r.a6(pm,n,new Map(p));return b.setTransitionOrValue(g,p),b.untransitioned().possiblyEvaluate(new r.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let b=t;b.startsWith(g)||(b=g+b);const I=r.I.from("mapbox-reserved-lut"),L=new Image;L.src=b,L.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},L.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void u();this._styleColorTheme.lutLoading=!1;const{width:P,height:k,data:U}=r.q.getImageData(L);if(k>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==k*k)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new r.r({width:P,height:k},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const j=this.imageManager.getImage(I,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,u,p){let g,b,I;const L=r.q.devicePixelRatio>1?"@2x":"";let P=r.n(u.transformRequest(u.normalizeSpriteURL(n,L,".json"),r.R.SpriteJSON),(j,$)=>{P=null,I||(I=j,g=$,U())}),k=r.o(u.transformRequest(u.normalizeSpriteURL(n,L,".png"),r.R.SpriteImage),(j,$)=>{k=null,I||(I=j,b=$,U())});function U(){if(I)p(I);else if(g&&b){const j=r.q.getImageData(b),$={};for(const Q in g){const{width:W,height:te,x:ne,y:ce,sdf:me,pixelRatio:fe,stretchX:we,stretchY:ye,content:ve}=g[Q],xe=new r.r({width:W,height:te});r.r.copy(j,xe,{x:ne,y:ce},{x:0,y:0},{width:W,height:te},null),$[Q]={data:xe,pixelRatio:fe,sdf:me,stretchX:we,stretchY:ye,content:ve,usvg:!1}}p(null,$)}}return{cancel(){P&&(P.cancel(),P=null),k&&(k.cancel(),k=null)}}}(t,this.map._requestManager,(n,u)=>{if(this._spriteRequest=null,n)this.fire(new r.z(n));else if(u){const p=new Map;for(const g in u)p.set(r.I.from(g),u[g]);this.addImages(p)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))})}addIconset(t,n){if(n.type==="sprite")return void this._loadSprite(n.url);const u=this.getOwnSource(n.source);if(!u)return void this.fire(new r.z(new Error(`Source "${n.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));if(u.type!=="raster-array")return void this.fire(new r.z(new Error(`Source "${n.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,t);const p=new np(t,this);u.addIconset(t,p)}_loadIconset(t){if(!r.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(g,b)=>{if(this._spriteRequest=null,g)n?this._loadSprite(t):this.fire(new r.z(g));else if(b){const I=new Map;for(const L in b)I.set(r.I.from(L),b[L]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))},r.bj((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),r.R.Iconset),(g,b)=>{if(g)return void p(g);const I={},L=r.ch(new r.bi(b));for(const P of L.icons){const k={version:1,pixelRatio:r.q.devicePixelRatio,content:zd(P),stretchX:P.metadata?Il(P.metadata.stretch_x_areas):void 0,stretchY:P.metadata?Il(P.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:P};I[P.name]=k}p(null,I)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const u=t.sourceLayer;u&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(u)===-1)&&this.fire(new r.z(new Error(`Source layer "${u}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const u=this.fragments[n];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const u=this._sourceCaches[n].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const n=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&n.push(p.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new r.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new r.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const g=t.getProgramIds();if(g)for(const b of g){const I=t.getDefaultProgramParams(b,n.zoom,this._styleColorTheme.lut);I&&(u.style=this,this.fog&&(u._fogVisible=!0,I.overrideFog=!0,u.getOrCreateProgram(b,I)),u._fogVisible=!1,I.overrideFog=!1,u.getOrCreateProgram(b,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,u.getOrCreateProgram(b,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const b=this._changes.getLayerUpdatesByScope();for(const I in b){const{updatedIds:L,removedIds:P}=b[I];(L||P)&&(this._updateWorkerLayers(I,L,P),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const b in this._mergedSourceCaches){const I=this._mergedSourceCaches[b];g[b]=I.used,I.used=!1,I.tileCoverLift=0}for(const b of this._mergedOrder){const I=this._mergedLayers[b];if(I.recalculate(t,this._availableImages),!I.isHidden(t.zoom)){const L=this.getLayerSourceCache(I);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,t)}):this.precompilePrograms(I,t))}for(const b in this._mergedSourceCaches){const I=this._mergedSourceCaches[b];if(!I)continue;const L=I._source;L.type==="raster-array"&&L.iconsets&&(I.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();for(const b in g){const I=this._mergedSourceCaches[b];g[b]!==I.used&&I.getSource().fire(new r.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new r.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,n,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:n?p._serializeLayers(n):[],scope:t,removedIds:u||[],options:p.options})}setState(t,n){if(this._checkLoaded(),Rl(this,Ma(t)))return!1;(t=r.cq(t)).layers=_c(t.layers);const u=function(b,I){if(!b)return[{command:bn.setStyle,args:[I]}];let L=[];try{if(!r.bn(b.version,I.version))return[{command:bn.setStyle,args:[I]}];if(r.bn(b.center,I.center)||L.push({command:bn.setCenter,args:[I.center]}),r.bn(b.zoom,I.zoom)||L.push({command:bn.setZoom,args:[I.zoom]}),r.bn(b.bearing,I.bearing)||L.push({command:bn.setBearing,args:[I.bearing]}),r.bn(b.pitch,I.pitch)||L.push({command:bn.setPitch,args:[I.pitch]}),r.bn(b.sprite,I.sprite)||L.push({command:bn.setSprite,args:[I.sprite]}),r.bn(b.glyphs,I.glyphs)||L.push({command:bn.setGlyphs,args:[I.glyphs]}),r.bn(b.imports,I.imports)||function($=[],Q=[],W){Q=Q||[];const te=($=$||[]).map(gn),ne=Q.map(gn),ce=$.reduce(aa,{}),me=Q.reduce(aa,{}),fe=te.slice();let we,ye,ve,xe;for(we=0,ye=0;we<te.length;we++)ve=te[we],me.hasOwnProperty(ve)?ye++:(W.push({command:bn.removeImport,args:[ve]}),fe.splice(fe.indexOf(ve,ye),1));for(we=0,ye=0;we<ne.length;we++)ve=ne[ne.length-1-we],fe[fe.length-1-we]!==ve&&(ce.hasOwnProperty(ve)?(W.push({command:bn.removeImport,args:[ve]}),fe.splice(fe.lastIndexOf(ve,fe.length-ye),1)):ye++,xe=fe[fe.length-we],W.push({command:bn.addImport,args:[me[ve],xe]}),fe.splice(fe.length-we,0,ve));for(const Se of Q){const Ce=ce[Se.id];Ce&&!r.bn(Ce,Se)&&W.push({command:bn.updateImport,args:[Se.id,Se]})}}(b.imports,I.imports,L),r.bn(b.transition,I.transition)||L.push({command:bn.setTransition,args:[I.transition]}),r.bn(b.light,I.light)||L.push({command:bn.setLight,args:[I.light]}),r.bn(b.fog,I.fog)||L.push({command:bn.setFog,args:[I.fog]}),r.bn(b.snow,I.snow)||L.push({command:bn.setSnow,args:[I.snow]}),r.bn(b.rain,I.rain)||L.push({command:bn.setRain,args:[I.rain]}),r.bn(b.projection,I.projection)||L.push({command:bn.setProjection,args:[I.projection]}),r.bn(b.lights,I.lights)||L.push({command:bn.setLights,args:[I.lights]}),r.bn(b.camera,I.camera)||L.push({command:bn.setCamera,args:[I.camera]}),!r.bn(b["color-theme"],I["color-theme"]))return[{command:bn.setStyle,args:[I]}];const P={},k=[];(function($,Q,W,te){let ne;for(ne in Q=Q||{},$=$||{})$.hasOwnProperty(ne)&&(Q.hasOwnProperty(ne)||Us(ne,W,te));for(ne in Q){if(!Q.hasOwnProperty(ne))continue;const ce=Q[ne];$.hasOwnProperty(ne)?r.bn($[ne],ce)||($[ne].type==="geojson"&&ce.type==="geojson"&&si($,Q,ne)?W.push({command:bn.setGeoJSONSourceData,args:[ne,ce.data]}):bl(ne,Q,W,te)):Fa(ne,Q,W)}})(b.sources,I.sources,k,P);const U=[];b.layers&&b.layers.forEach($=>{$.source&&P[$.source]?L.push({command:bn.removeLayer,args:[$.id]}):U.push($)});let j=b.terrain;j&&P[j.source]&&(L.push({command:bn.setTerrain,args:[void 0]}),j=void 0),L=L.concat(k),r.bn(j,I.terrain)||L.push({command:bn.setTerrain,args:[I.terrain]}),function($,Q,W){Q=Q||[];const te=($=$||[]).map(gn),ne=Q.map(gn),ce=$.reduce(aa,{}),me=Q.reduce(aa,{}),fe=te.slice(),we=Object.create(null);let ye,ve,xe,Se,Ce,Ke,Ge;for(ye=0,ve=0;ye<te.length;ye++)xe=te[ye],me.hasOwnProperty(xe)?ve++:(W.push({command:bn.removeLayer,args:[xe]}),fe.splice(fe.indexOf(xe,ve),1));for(ye=0,ve=0;ye<ne.length;ye++)xe=ne[ne.length-1-ye],fe[fe.length-1-ye]!==xe&&(ce.hasOwnProperty(xe)?(W.push({command:bn.removeLayer,args:[xe]}),fe.splice(fe.lastIndexOf(xe,fe.length-ve),1)):ve++,Ke=fe[fe.length-ye],W.push({command:bn.addLayer,args:[me[xe],Ke]}),fe.splice(fe.length-ye,0,xe),we[xe]=!0);for(ye=0;ye<ne.length;ye++)if(xe=ne[ye],Se=ce[xe],Ce=me[xe],!we[xe]&&!r.bn(Se,Ce))if(r.bn(Se.source,Ce.source)&&r.bn(Se["source-layer"],Ce["source-layer"])&&r.bn(Se.type,Ce.type)){for(Ge in dn(Se.layout,Ce.layout,W,xe,null,bn.setLayoutProperty),dn(Se.paint,Ce.paint,W,xe,null,bn.setPaintProperty),r.bn(Se.slot,Ce.slot)||W.push({command:bn.setSlot,args:[xe,Ce.slot]}),r.bn(Se.filter,Ce.filter)||W.push({command:bn.setFilter,args:[xe,Ce.filter]}),r.bn(Se.minzoom,Ce.minzoom)&&r.bn(Se.maxzoom,Ce.maxzoom)||W.push({command:bn.setLayerZoomRange,args:[xe,Ce.minzoom,Ce.maxzoom]}),Se)Se.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?dn(Se[Ge],Ce[Ge],W,xe,Ge.slice(6),bn.setPaintProperty):r.bn(Se[Ge],Ce[Ge])||W.push({command:bn.setLayerProperty,args:[xe,Ge,Ce[Ge]]}));for(Ge in Ce)Ce.hasOwnProperty(Ge)&&!Se.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?dn(Se[Ge],Ce[Ge],W,xe,Ge.slice(6),bn.setPaintProperty):r.bn(Se[Ge],Ce[Ge])||W.push({command:bn.setLayerProperty,args:[xe,Ge,Ce[Ge]]}))}else W.push({command:bn.removeLayer,args:[xe]}),Ke=fe[fe.lastIndexOf(xe)+1],W.push({command:bn.addLayer,args:[Ce,Ke]})}(U,I.layers,L)}catch(P){console.warn("Unable to compute style diff:",P),L=[{command:bn.setStyle,args:[I]}]}return L}(this.serialize(),t).filter(b=>!(b.command in Mu));if(u.length===0)return!1;const p=u.filter(b=>!(b.command in Sc));if(p.length>0)throw new Error(`Unimplemented: ${p.map(b=>b.command).join(", ")}.`);const g=[];return u.forEach(b=>{g.push(this[b.command].apply(this,b.args))}),n&&Promise.all(g).then(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(t){for(const[n,u]of t.entries()){if(this.getImage(n)&&!n.iconsetId)return this.fire(new r.z(new Error(`An image with the name "${n.name}" already exists.`)));this.imageManager.addImage(n,this.scope,u),this._changes.updateImage(n)}return this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this}addImage(t,n){return this.getImage(t)&&!t.iconsetId?this.fire(new r.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,n),this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this)}updateImage(t,n,u=!1){this.imageManager.updateImage(t,this.scope,n),u&&(this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,u={}){return this._checkLoaded(),this._validate(Me,`models.${t}`,n,null,u)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new r.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(so,`sources.${t}`,n,null,u))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const p=mh(t,n,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const g=b=>{const I=(b?"symbol:":"other:")+p.id,L=r.C(I,this.scope),P=this._sourceCaches[I]=new Wa(L,p,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=P,P.onAdd(this.map)};g(!1),n.type!=="vector"&&n.type!=="geojson"||g(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const u=this.getOwnSourceCaches(t);for(const p of u){const g=r.cr(p.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(p.id),p.fire(new r.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const u=this.getOwnSourceCache(n);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const u=t[n]._tiles;for(const p in u){const g=u[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const p of t){if(this._validate(fc,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(p),g.updateTransitions(n)}else this.ambientLight=new fr(p,rn||(rn=new r.a7({color:new r.a8(r.a5.properties_light_ambient.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(p),g.updateTransitions(n)}else this.directionalLight=new fr(p,Rn||(Rn=new r.a7({direction:new r.am(r.a5.properties_light_directional.direction),color:new r.a8(r.a5.properties_light_directional.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_directional.intensity),"cast-shadows":new r.a8(r.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a8(r.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a8(r.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new r.aa(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const u=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),g=t.properties.get("intensity"),b=t.properties.get("direction"),I=1-r.cc(b.x,b.y,b.z)[2]/90,L=u(p)*g*I,P=n.properties.get("color").toRenderColor(null).toArray01(),k=n.properties.get("intensity"),U=u(P)*k;return Number(((L+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(r.cs(t)){const n=r.ct(t),u=this.fragments.find(({id:g})=>g===n);if(!u)throw new Error(`Style import '${t}' not found`);const p=r.cr(t);return u.style.getFragmentStyle(p)}{const n=this.fragments.find(({id:u})=>u===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},u=(p,g="")=>`${p}::${g}`;this._featuresetSelectors={};for(const p in t){const g=this._featuresetSelectors[p]=[];for(const b of t[p].selectors){if(b.featureNamespace){const L=this.getOwnLayer(b.layer);if(!L){r.w(`Layer is undefined for selector: ${b.layer}`);continue}const P=u(L.source,L.sourceLayer);if(P in n&&n[P]!==b.featureNamespace){r.w(`"featureNamespace ${b.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}n[P]=b.featureNamespace}let I;if(b.properties)for(const L in b.properties){const P=r.X(b.properties[L]);P.result==="success"&&(I=I||{},I[L]=P.value)}g.push({layerId:b.layer,namespace:b.featureNamespace,properties:I,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const u=[];for(const p in n.stylesheet.featuresets)u.push({featuresetId:p,importId:n.scope?n.scope:void 0});return u}getFeaturesetLayers(t,n){const u=this.getFragmentStyle(n),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new r.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const b of p[t].selectors){const I=u.getOwnLayer(b.layer);I&&g.push(I)}return g}getConfigProperty(t,n){const u=this.getFragmentStyle(t);if(!u)return null;const p=r.C(n,u.scope),g=u.options.get(p),b=g?g.value||g.default:null;return b?b.serialize():null}setConfigProperty(t,n,u){const p=this.getFragmentStyle(t);if(!p)return;const g=p.stylesheet.indoor?mm(p.stylesheet.schema):p.stylesheet.schema;if(!g||!g[n])return;const b=r.X(u);if(b.result!=="success")return void Rl(this,b.value);const I=b.value.expression,L=r.C(n,p.scope),P=p.options.get(L);if(!P)return;let k;const{minValue:U,maxValue:j,stepValue:$,type:Q,values:W}=g[n],te=r.X(g[n].default);te.result==="success"&&(k=te.value.expression),k?(this.options.set(L,Object.assign({},P,{value:I,default:k,minValue:U,maxValue:j,stepValue:$,type:Q,values:W})),this.updateConfigDependencies(n)):this.fire(new r.z(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const u=n.stylesheet.schema;if(!u)return null;const p={};for(const g in u){const b=r.C(g,n.scope),I=n.options.get(b),L=I?I.value||I.default:null;p[g]=L?L.serialize():null}return p}setConfig(t,n){const u=this.getFragmentStyle(t);u&&(u.updateConfig(n,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=n,u.updateConfig(u._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const u in n){let p,g;const b=r.X(n[u].default);if(b.result==="success"&&(p=b.value.expression),t&&t[u]!==void 0){const j=r.X(t[u]);j.result==="success"&&(g=j.value.expression)}const{minValue:I,maxValue:L,stepValue:P,type:k,values:U}=n[u];if(p){const j=r.C(u,this.scope);this.options.set(j,{default:p,value:g,minValue:I,maxValue:L,stepValue:P,type:k,values:U})}else this.fire(new r.z(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new r.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const u=this.getLayer(n);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const u=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(u){const p=n._evaluateColorThemeData(u);(!n._styleColorTheme.lut&&p!==""||n._styleColorTheme.lut&&p!==n._styleColorTheme.lut.data)&&n.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,n,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new r.z(new Error(`Layer with id "${p}" already exists on this map`)));let g;if(t.type==="custom"){if(Rl(this,r.cu(t)))return;g=r.cv(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=r.cq(t),t=r.l(t,{source:p})),this._validate(ie,`layers.${p}`,t,{arrayIndex:-1},u))return;g=r.cv(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let b=this._order.length;if(n){const k=this._order.indexOf(n);if(k===-1)return void this.fire(new r.z(new Error(`Layer with id "${n}" does not exist on this map.`)));g.slot===this._layers[n].slot?b=k:r.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,p),this._layerOrderChanged=!0,this._layers[p]=g;const I=this.getOwnLayerSourceCache(g),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&g.canCastShadows()&&L&&(I.castsShadows=!0);const P=this._changes.getRemovedLayer(g);if(P&&g.source&&I&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const k=r.C(g.source,g.scope);P.type!==g.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),I.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===n)return;const p=this._order.indexOf(t);this._order.splice(p,1);let g=this._order.length;if(n){const b=this._order.indexOf(n);if(b===-1)return void this.fire(new r.z(new Error(`Layer with id "${n}" does not exist on this map.`)));u.slot===this._layers[n].slot?g=b:r.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const p=this.getOwnLayerSourceCache(n);if(p&&p.castsShadows){let g=!1;for(const b in this._layers)if(this._layers[b].source===n.source&&this._layers[b].canCastShadows()){g=!0;break}p.castsShadows=g}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===n&&p.maxzoom===u||(n!=null&&(p.minzoom=n),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==n&&(u.slot=n,this._updateLayer(u))}setFilter(t,n,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!r.bn(p.filter,n))return n==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(ae,`layers.${p.id}.filter`,n,{layerType:p.type},u)||(p.filter=r.cq(n),this._updateLayer(p)))}getFilter(t){const n=this._checkLayer(t);if(n)return r.cq(n.filter)}setLayoutProperty(t,n,u,p={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!r.bn(g.getLayoutProperty(n),u)){if(u!=null&&(!p||p.validate!==!1)&&Rl(g,Ae.call(Ma,{key:`layers.${t}.layout.${n}`,layerType:g.type,objectKey:n,value:u,styleSpec:r.a5,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(n,u),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,n){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(n)}setPaintProperty(t,n,u,p={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||r.bn(g.getPaintProperty(n),u)||u!=null&&(!p||p.validate!==!1)&&Rl(g,ge.call(Ma,{key:`layers.${t}.paint.${n}`,layerType:g.type,objectKey:n,value:u,styleSpec:r.a5})))return;const b=g.setPaintProperty(n,u);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),b&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,n){const u=this._checkLayer(t);if(u)return u.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:L,importId:P}=t.target,k=this.getFragmentStyle(P),U=k.getFeaturesetLayers(L);for(const{source:j,sourceLayer:$}of U)k.setFeatureState({id:t.id,source:j,sourceLayer:$},n)}else if("layerId"in t.target){const{layerId:L}=t.target,P=this.getLayer(L);this.setFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},n)}return}const u=t.source,p=t.sourceLayer,g=this._checkSource(u);if(!g)return;const b=g.type;if(b==="geojson"&&p)return void this.fire(new r.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!p)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(u);for(const L of I)L.setFeatureState(p,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:L,importId:P}=t.target,k=this.getFragmentStyle(P),U=k.getFeaturesetLayers(L);for(const{source:j,sourceLayer:$}of U)k.removeFeatureState({id:t.id,source:j,sourceLayer:$},n)}else if("layerId"in t.target){const{layerId:L}=t.target,P=this.getLayer(L);this.removeFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},n)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const g=p.type,b=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!b)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.z(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(u);for(const L of I)L.removeFeatureState(b,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:b,importId:I}=t.target,L=this.getFragmentStyle(I),P=L.getFeaturesetLayers(b);for(const{source:k,sourceLayer:U}of P){const j=L.getFeatureState({id:t.id,source:k,sourceLayer:U});if(j&&!g)g=j;else if(!r.bn(g,j))return void this.fire(new r.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:b}=t.target,I=this.getLayer(b);g=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return g}const n=t.source,u=t.sourceLayer,p=this._checkSource(n);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(u,t.id);this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=r.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),u=r.C(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=I=>this._mergedLayers[I].is3D(!!this.terrain),u=this.order,p={},g=[];for(let I=u.length-1;I>=0;I--){const L=u[I];if(n(L)){p[L]=I;for(const P of t){const k=P[L];if(k)for(const U of k)g.push(U)}}}g.sort((I,L)=>L.intersectionZ-I.intersectionZ);const b=[];for(let I=u.length-1;I>=0;I--){const L=u[I];if(n(L))for(let P=g.length-1;P>=0;P--){const k=g[P].feature;if(k.layer&&p[k.layer.id]<I)break;b.push(k),g.pop()}else for(const P of t){const k=P[L];if(k)for(const U of k)b.push(U.feature)}}return b}queryRenderedFeatures(t,n,u){let p;n&&!Array.isArray(n)&&n.filter&&(this._validate(ae,"queryRenderedFeatures.filter",n.filter,null,n),p=r.a_(n.filter));const g={},b=k=>{if(Cu.has(k.type))return;const U=this.getOwnLayerSourceCache(k),j=g[U.id]=g[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};k.is3D(!!this.terrain)&&(j.has3DLayers=!0),j.layers[k.fqid]=j.layers[k.fqid]||{styleLayer:k,targets:[]},j.layers[k.fqid].targets.push({filter:p})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new r.z(new Error("parameters.layers must be an Array."))),[];for(const k of n.layers){const U=this._layers[k];if(!U)return this.fire(new r.z(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];b(U)}}else for(const k in this._layers)b(this._layers[k]);const I=this._queryRenderedFeatures(t,g,u),L=this._flattenAndSortRenderedFeatures(I),P=[];for(const k of L)r.ct(k.layer.id)===this.scope&&P.push(k);return P}queryRenderedFeatureset(t,n,u){let p;n&&!Array.isArray(n)&&n.filter&&(this._validate(ae,"queryRenderedFeatures.filter",n.filter,null,n),p=r.a_(n.filter));const g="mock",b=[];if(n&&n.target)b.push(Object.assign({},n,{targetId:g,filter:p}));else{const k=this.getFeaturesetDescriptors();for(const U of k)b.push({targetId:g,filter:p,target:U});for(const{style:U}of this.fragments){const j=U.getFeaturesetDescriptors();for(const $ of j)b.push({targetId:g,filter:p,target:$})}}const I=this.queryRenderedTargets(t,b,u),L=[],P=new Set;for(const k of I)for(const U of k.variants[g])Zo(U,k,P)||L.push(new r.cx(k,U));return L}queryRenderedTargets(t,n,u){const p={},g=(I,L,P,k)=>{const U=p[L.id]=p[L.id]||{sourceCache:L,layers:{},has3DLayers:!1};if(U.layers[I.fqid]=U.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(U.has3DLayers=!0),!k)return P.uniqueFeatureID=!1,void U.layers[I.fqid].targets.push(P);U.layers[I.fqid].targets.push(Object.assign({},P,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const I of n)if("featuresetId"in I.target){const{featuresetId:L,importId:P}=I.target,k=this.getFragmentStyle(P);if(!k||!k._featuresetSelectors)continue;const U=k._featuresetSelectors[L];if(!U){this.fire(new r.z(new Error(`The featureset '${L}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const j of U){const $=k.getOwnLayer(j.layerId);$&&!Cu.has($.type)&&g($,k.getOwnLayerSourceCache($),I,j)}}else if("layerId"in I.target){const{layerId:L}=I.target,P=this.getLayer(L);if(!P||Cu.has(P.type))continue;g(P,this.getLayerSourceCache(P),I)}const b=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(t,n,u){const p=[],g=!!this.map._showQueryGeometry,b=Nr.createFromScreenPoints(t,u);for(const I in n){const L=Ad(b,n[I],this._availableImages,u,g);Object.keys(L).length&&p.push(L)}if(this.placement)for(const I in n){if(!n[I].sourceCache._onlySymbols)continue;const L=gh(b.screenGeometry,n[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(L).length&&p.push(L)}return p}querySourceFeatures(t,n){const u=n&&n.filter;u&&this._validate(ae,"querySourceFeatures.filter",u,null,n);let p=[];const g=this.getOwnSourceCaches(t);for(const b of g)p=p.concat(am(b,n));return p}addSourceType(t,n,u){return Gs.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Gs.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,u={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const I in t)if(!r.bn(t[I],p[I])){g=!0;break}if(!g)return;const b=this._getTransitionParameters();this.light.setLight(t,n,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const I="terrain-dem-src";this.addSource(I,u.source),u=r.cq(u),u=r.l(u,{source:I})}const g=r.l({},u),b={};if(this.terrain&&p){g.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(b.style=I.serialize())}if(this._validate(ph,"terrain",g,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&n!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,n),this.fire(new r.A("data",{dataType:"style"}))}else{const g=this.terrain,b=g.get();for(const I of Object.keys(r.a5.terrain))!u.hasOwnProperty(I)&&r.a5.terrain[I].default&&(u[I]=r.a5.terrain[I].default);for(const I in t)if(!r.bn(t[I],b[I])){g.set(t,this.options),this.stylesheet.terrain=t;const L=this._getTransitionParameters({duration:0});g.updateTransitions(L),this.fire(new r.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new $i(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createSnow(t){const n=this.snow=new Dn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createRain(t){const n=this.rain=new kn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(n);this._loadColorTheme(u).then(()=>{this.fire(new r.A("colorthemeset")),t()}).catch(p=>{r.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=n,u._reloadColorTheme())}_getTransitionParameters(t){return{now:r.q.now(),transition:r.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):n.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const u=this.terrain=new lt(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,u,p,g={}){if(g&&g.validate===!1)return!1;const b=r.l({},this.serialize());return Rl(this,t.call(Ma,r.l({key:n,style:b,value:u,styleSpec:r.a5},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const u of n)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const u of n)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=qs(this.directionalLight));for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,u,p,g,b,I=!1){let L=!1,P=!1;const k={},U={};for(const j of this._mergedOrder){const $=this._mergedLayers[j];if($.type!=="symbol")continue;const Q=r.C($.source,$.scope);let W=k[Q];if(!W){const ne=this.getLayerSourceCache($);if(!ne)continue;const ce=ne.getRenderableIds(!0).map(me=>ne.getTileByID(me));U[Q]=ce.slice(),W=k[Q]=ce.sort((me,fe)=>fe.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(fe.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer($,W,n.center.lng,n.projection);L=L||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new r.A("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),n.zoom))&&(this.pauseablePlacement=new Ml(n,this._mergedOrder,I,u,p,g,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),P=!0),L&&this.pauseablePlacement.placement.setStale()),P||L){this._buildingIndex.onNewFrame(n.zoom);for(let j=0;j<this._mergedOrder.length;j++){const $=this._mergedLayers[this._mergedOrder[j]];if($.type!=="symbol")continue;const Q=this.isLayerClipped($);this.placement.updateLayerOpacities($,k[r.C($.source,$.scope)],j,Q?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:g})=>g===t.id)!==-1)return void this.fire(new r.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:g})=>g===n);return p===-1&&this.fire(new r.z(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==u[p].url&&this.setImportUrl(t,n.url),r.bn(n.config,u[p].config)||this.setImportConfig(t,n.config,n.data.schema),r.bn(n.data,u[p].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const g=this.getImportIndex(n);if(g===-1)return this;const b=u[p],I=this.fragments[p];return u=u.filter(({id:L})=>L!==t),this.fragments=this.fragments.filter(({id:L})=>L!==t),this.stylesheet.imports=u.slice(0,g).concat(b).concat(u.slice(g)),this.fragments=this.fragments.slice(0,g).concat(I).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=n;const g=this.fragments[p];return g.style=this._createFragmentStyle(u[p]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:n?(this.fragments[u].style.setState(n),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,n,u){this._checkLoaded();const p=this.getImportIndex(t),g=this.stylesheet.imports||[];if(p===-1)return this;n?g[p].config=n:delete g[p].config;const b=this.fragments[p];u&&b.style.stylesheet&&(b.style.stylesheet.schema=u);const I=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=n,b.style.updateConfig(n,I),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(n.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return n===-1&&this.fire(new r.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[n];u&&t.push(u.getSource())}return t}getSource(t,n){const u=this.getSourceCache(t,n);return u&&u.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const u=r.C(t,n);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const n=r.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const u=t[n];u==="reload"?this.reloadSource(n):u==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const u of n){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,n,u){this.imageManager.getImages(n.images,n.scope,u),this._updateTilesForChangedImages();const p=b=>{if(b){const I=n.images.map(L=>r.I.toString(L));b.setDependencies(n.tileID.key,n.type,I)}},g=r.C(n.source,n.scope);p(this._mergedOtherSourceCaches[g]),p(this._mergedSymbolSourceCaches[g])}rasterizeImages(t,n,u){this.imageManager.rasterizeImages(n,u)}getGlyphs(t,n,u){this.glyphManager.getGlyphs(n.stacks,n.scope,u)}getResource(t,n,u){return r.cz(n,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new r.z(new Error(`There is no source with ID '${t}'`))),!1):n.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(u||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Gs.getSourceType=function(h){return ps[h]},Gs.setSourceType=function(h,t){ps[h]=t},Gs.registerForPluginStateChange=r.ci;var Ld=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Mh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ch=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Od="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Dl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Ih=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Jo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ua=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Iu=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ja=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const oa=[];Ja(Ld,oa),Ja(Ch,oa),Ja(Mh,oa);const Hs={"_prelude_fog.vertex.glsl":Ih,"_prelude_terrain.vertex.glsl":Dl,"_prelude_shadow.vertex.glsl":Iu,"_prelude_fog.fragment.glsl":Pd,"_prelude_shadow.fragment.glsl":ja,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Jo,"_prelude_raster_particle.glsl":Ua},zl={};cn("",Dl),cn(Pd,Ih),cn(ja,Iu),cn(Jo,""),cn(Ua,"");const Ru=cn(Mh,Ch),Ec=Ld;var Ac={background:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:cn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:cn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:cn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:cn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:cn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:cn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:cn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:cn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:cn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:cn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:cn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:cn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:cn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:cn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:cn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Od),skyboxGradient:cn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Od),skyboxCapture:cn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:cn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:cn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:cn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:cn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:cn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:cn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:cn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ja(h,t){const n=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of n)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const g of p)t.includes(g)||t.push(g)}}function cn(h,t){const n=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(P=>{const k=P.split(" ");return k[k.length-1]}),p=[...new Set(p)]);const g={},b=[],I=[];if(h=h.replace(n,(P,k)=>(I.push(k),"")),(t=t.replace(n,(P,k)=>(b.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...oa];Ja(h,L),Ja(t,L);for(const P of[...b,...I])Hs[P]||console.error(`Undefined include: ${P}`),zl[P]||(zl[P]=[],Ja(Hs[P],zl[P])),L=[...L,...zl[P]];return{fragmentSource:h=h.replace(u,(P,k,U,j,$)=>(g[$]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${$}
in ${U} ${j} ${$};
#else
uniform ${U} ${j} u_${$};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${$}
    ${U} ${j} ${$} = u_${$};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${U} ${j} ${$};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(P,k,U,j,$)=>{const Q=j==="float"?"vec2":j,W=$.match(/color/)?"color":Q;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${$}
in ${U} ${j} a_${$};
#endif
`:g[$]?k==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Q} a_${$};
out ${U} ${j} ${$};
#else
uniform ${U} ${j} u_${$};
#endif
`:k==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${U} ${j} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${W}(a_${$}, u_${$}_t);
#else
    ${U} ${j} ${$} = u_${$};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${U} ${j} a_${$};
    out ${U} ${j} ${$};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${$} = a_${$};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Q} a_${$};
#else
uniform ${U} ${j} u_${$};
#endif
`:k==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${$}0;
in vec4 a_${$}1;
in vec4 a_${$}2;
in vec4 a_${$}3;
#else
uniform ${U} ${j} u_${$};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${Q} a_${$};
#else
uniform ${U} ${j} u_${$};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${U} ${j} ${$} = a_${$};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${j} ${$} = a_${$};
#else
    ${U} ${j} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${j} ${$} = unpack_mix_${W}(a_${$}, u_${$}_t);
#else
    ${U} ${j} ${$} = u_${$};
#endif
`}),staticAttributes:p,usedDefines:L,vertexIncludes:b,fragmentIncludes:I}}class Rh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,u,p,g,b,I,L){this.context=t;let P=this.boundPaintVertexBuffers.length!==p.length;for(let U=0;!P&&U<p.length;U++)this.boundPaintVertexBuffers[U]!==p[U]&&(P=!0);let k=this.boundDynamicVertexBuffers.length!==I.length;for(let U=0;!k&&U<I.length;U++)this.boundDynamicVertexBuffers[U]!==I[U]&&(k=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==u||P||k||this.boundIndexBuffer!==g||this.boundVertexOffset!==b)this.freshBind(n,u,p,g,b,I,L);else{t.bindVertexArrayOES.set(this.vao);for(const U of I)U&&(U.bind(),L&&U.instanceCount&&U.setVertexAttribDivisor(t.gl,n,L));g&&g.dynamicDraw&&g.bind()}}freshBind(t,n,u,p,g,b,I){const L=t.numAttributes,P=this.context,k=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=b,n.enableAttributes(k,t),n.bind(),n.setVertexAttribPointers(k,t,g);for(const U of u)U.enableAttributes(k,t),U.bind(),U.setVertexAttribPointers(k,t,g);for(const U of b)U&&(U.enableAttributes(k,t),U.bind(),U.setVertexAttribPointers(k,t,g),I&&U.instanceCount&&U.setVertexAttribDivisor(k,t,I));p&&p.bind(),P.currentNumAttributes=L}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Mc(h,t){const n=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new r.ac(0,u/n).toLngLat().lat,new r.ac(0,(u+1)/n).toLngLat().lat]}function Du(h,t,n,u,p,g,b){const I=h.context,L=I.gl,P=n.hillshadeFBO;if(!P)return;h.prepareDrawTile();const k=h.isTileAffectedByFog(t),U=h.getOrCreateProgram("hillshade",{overrideFog:k});I.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,P.colorAttachment.get());const j=((te,ne,ce,me)=>{const fe=ce.paint.get("hillshade-shadow-color"),we=ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ye=ce.paint.get("hillshade-highlight-color"),ve=ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",xe=ce.paint.get("hillshade-accent-color"),Se=ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ce=ce.paint.get("hillshade-emissive-strength");let Ke=r.ak(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")Ke-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const ct=te.style.directionalLight.properties.get("direction"),_t=r.cc(ct.x,ct.y,ct.z);Ke=r.ak(_t[1])}const Ge=!te.options.moving;return{u_matrix:me||te.transform.calculateProjMatrix(ne.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:Mc(0,ne.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Ke],u_shadow:fe.toRenderColor(we?null:ce.lut),u_highlight:ye.toRenderColor(ve?null:ce.lut),u_emissive_strength:Ce,u_accent:xe.toRenderColor(Se?null:ce.lut)}})(h,n,u,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(I,U,t.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Q,tileBoundsSegments:W}=h.getTileBoundsBuffers(n);U.draw(h,L.TRIANGLES,p,g,b,Ii.disabled,j,u.id,$,Q,W)}function Qa(h,t,n){if(!t.needsDEMTextureUpload)return;const u=h.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(n.stride);const g=n.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new r.T(u,g,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function ap(h,t,n){const u=h.context,p=u.gl;if(!t.dem)return;const g=t.dem;if(u.activeTexture.set(p.TEXTURE1),Qa(h,t,g),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const b=g.dim;u.activeTexture.set(p.TEXTURE0);let I=t.hillshadeFBO;if(!I){const j=new r.T(u,{width:b,height:b,data:null},p.RGBA8);j.bind(p.LINEAR,p.CLAMP_TO_EDGE),I=t.hillshadeFBO=u.createFramebuffer(b,b,!0,"renderbuffer"),I.colorAttachment.set(j.texture)}u.bindFramebuffer.set(I.framebuffer),u.viewport.set([0,0,b,b]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:P,tileBoundsSegments:k}=h.getMercatorTileBoundsBuffers(),U=[];h.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(h,p.TRIANGLES,mi.disabled,Ni.disabled,en.unblended,Ii.disabled,((j,$)=>{const Q=$.stride,W=r.ad.mat4.create();return r.ad.mat4.ortho(W,0,r.ai,-r.ai,0,0,1),r.ad.mat4.translate(W,W,[0,-r.ai,0]),{u_matrix:W,u_image:1,u_dimension:[Q,Q],u_zoom:j.overscaledZ}})(t.tileID,g),n.id,L,P,k),t.needsHillshadePrepare=!1}class jn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _m extends jn{getDefault(){return r.al.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zu extends jn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Qo extends jn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Dh extends jn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class zh extends jn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Cc extends jn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ic extends jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class kd extends jn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ll extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class qa extends jn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Rs extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class da extends jn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class uo extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Zs extends jn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class zo extends jn{getDefault(){return r.al.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Bd extends jn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Lh extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Oh extends jn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class wa extends jn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Or=class extends jn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class tr extends jn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Lo extends jn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ho extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Nd extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $s extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class gm extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ym extends jn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ph extends jn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class kh extends jn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class vm extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Bh extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Rc extends jn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class el extends Rc{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class fo extends Rc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ds extends Rc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Oo extends fo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Fd=(h,t,n)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),Nh=(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:n,u_zoom_transition:p,u_merc_center:g,u_image0:0,u_frustum_tl:b,u_frustum_tr:I,u_frustum_br:L,u_frustum_bl:P,u_globe_pos:k,u_globe_radius:U,u_viewport:j,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:$,u_far_z_cutoff:Q});function Ol(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const es=new class{constructor(){this.operations={}}newMorphing(h,t,n,u,p){if(h in this.operations){const g=this.operations[h];g.to.tileID.key!==n.tileID.key&&(g.queued=n)}else this.operations[h]={startTime:u,phase:0,duration:p,from:t,to:n,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const n=this.operations[t];for(n.phase=(h-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},tl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Pr(h,t,n){if(t===0)return 0;const u=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*u}function Lu(h,t){const n=1<<h.z;return!t&&(h.x===0||h.x===n-1)||h.y===0||h.y===n-1}const Dc=h=>({u_matrix:h});function Vd(h,t,n,u,p){if(p>0){const g=r.q.now(),b=(g-h.timeAdded)/p,I=t?(g-t.timeAdded)/p:-1,L=n.getSource(),P=u.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),k=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(h.tileID.overscaledZ-P),U=k&&h.refreshedUponExpiration?1:r.ay(k?b:1-I,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class xm extends Wa{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new r.D(r.cj(),null),p=mh("mock-dem",n,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class sp extends Wa{constructor(t){const n=mh("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new r.D(r.cj(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,b)=>{if(g[b.key]="",!this._tiles[b.key]){const I=new Vs(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom);I.state="loaded",this._tiles[b.key]=I}return g},{});for(const g in this._tiles)g in p||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const u=Object.values(n);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zr extends r.aH{constructor(t,n,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=u}}class Ud extends r.cK{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,g]=function(L){const P=new r.b5,k=new r.aV,U=131;P.reserve(17161),k.reserve(33800);const j=r.ai/128,$=r.ai+j/2,Q=$+j;for(let te=-j;te<Q;te+=j)for(let ne=-j;ne<Q;ne+=j){const ce=ne<0||ne>$||te<0||te>$?24575:0,me=r.ay(Math.round(ne),0,r.ai),fe=r.ay(Math.round(te),0,r.ai);P.emplaceBack(me+ce,fe)}const W=(te,ne)=>{const ce=ne*U+te;k.emplaceBack(ce+1,ce,ce+U),k.emplaceBack(ce+U,ce+U+1,ce+1)};for(let te=1;te<129;te++)for(let ne=1;ne<129;ne++)W(ne,te);return[0,129].forEach(te=>{for(let ne=0;ne<130;ne++)W(ne,te),W(te,ne)}),[P,k,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(u,r.b7.members),this.gridIndexBuffer=b.createIndexBuffer(p),this.gridSegments=r.b8.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=r.b8.simpleSegment(0,0,u.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new sp(n.map),this.orthoMatrix=r.ad.mat4.create(),r.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ai,0,r.ai,0,1);const I=b.gl;this._overlapStencilMode=new Ni({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new xm(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,g=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const I=t.terrain&&t.terrain.scope,L=p.get("source"),P=g?this._mockSourceCache:t.getSourceCache(L,I);if(!P)return void r.w(`Couldn't find terrain source "${L}".`);if(this.sourceCache=P,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(n):p.get("exaggeration"),!n.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(n,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),n.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=n!=null?u-n:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const g=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(g);let I=g-this._previousZoom;const L=this._previousUpdateTimestamp;let P=g;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(g-P)>.5&&(I=.5*(g-P+I)),I*p<0&&(P+=I)),this._evaluationZoom=P;const k=b.getExaggeration(P),U=k===b.getExaggeration(Math.max(0,P-.1));if(U&&Math.abs(k-this._exaggeration)<.01)return k;let j=Math.min(.1,.00375*(this._updateTimestamp-L));return(U||k<.1||Math.abs(I)<1e-4)&&(j=Math.min(.2,4*j)),r.ah(this._exaggeration,k,j)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(r.ac.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=n.getIds().map(L=>{const P=n.getTileByID(L).tileID;return P.projMatrix=u.calculateProjMatrix(P.toUnwrapped()),P});(function(L,P){const k=P.transform.pointCoordinate(P.transform.getCameraPoint()),U=new r.P(k.x,k.y);L.sort((j,$)=>{if($.overscaledZ-j.overscaledZ)return $.overscaledZ-j.overscaledZ;const Q=new r.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),W=new r.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),te=U.mult(1<<j.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(Q)-te.distSqr(W)})})(p,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},p.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const L in b){const P=b[L];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,t[L],g),P.usedForTerrain))continue;const k=t[L];P.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[n.id]=p.map(L=>new Zr(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const P=this.terrainTileForTile[L.key];if(!P)continue;const k=P.tileID.key;k in I||(this._visibleDemTiles.push(P),I[k]=k)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const u=this._findTileCoveringTileID(n,this.sourceCache);u&&(this.terrainTileForTile[n.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],g=p.dem;!g||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),Qa(this.painter,p,g))}}_prepareDemTileUniforms(t,n,u,p){if(!n||n.demTexture==null)return!1;const g=t.tileID.canonical,b=Math.pow(2,n.tileID.canonical.z-g.z),I=p||"";return u[`u_dem_tl${I}`]=[g.x*b%1,g.y*b%1],u[`u_dem_scale${I}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const g=p.dem.tree.minimums[0];return g>0&&t++,u+g},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new r.cL({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(p,{premultiply:!1}):g=this._emptyDEMTexture=new r.T(t,p,n.R32F,{premultiply:!1}),g}setupElevationDraw(t,n,u){const p=this.painter.context,g=p.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let I=null,L=null,P=1;if(u&&u.morphing&&this._useVertexMorphing){const $=u.morphing.srcDemTile,Q=u.morphing.dstDemTile;P=u.morphing.phase,$&&Q&&(this._prepareDemTileUniforms(t,$,b,"_prev")&&(L=$),this._prepareDemTileUniforms(t,Q,b)&&(I=Q))}const k=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let U=null;var j;if(this.enabled?L&&I?(U=I.demTexture,p.activeTexture.set(g.TEXTURE4),L.demTexture.bind(k(L),g.CLAMP_TO_EDGE),b.u_dem_lerp=P):(I=this.terrainTileForTile[t.tileID.key],U=this._prepareDemTileUniforms(t,I,b)?I.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,p.activeTexture.set(g.TEXTURE2),U&&(b.u_dem_size=(j=U).size[0]===1?1:j.size[0]-2,U.bind(k(I),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,n,b),u&&u.useMeterToDem&&I){const $=(1<<I.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=$}if(u&&u.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),n.setTerrainUniformValues(p,b),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);n.setGlobeUniformValues(p,$)}}globeUniformValues(t,n,u){const p=t.projection;return{u_tile_tl_up:p.upVector(n,0,0),u_tile_tr_up:p.upVector(n,r.ai,0),u_tile_br_up:p.upVector(n,r.ai,r.ai),u_tile_bl_up:p.upVector(n,0,r.ai),u_tile_up_scale:u?r.cM(1):p.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,g,b,I,L){if(p.transform.projection.name==="globe")(function(P,k,U,j,$){const Q=P.context,W=Q.gl;let te,ne;const ce=P.transform,me=r.cD(P,Q,ce),fe=(ct,_t)=>{if(ne===_t)return;const Ct=[tl[_t],"PROJECTION_GLOBE_VIEW"];me&&Ct.push("CUSTOM_ANTIALIASING");const Ve=P.isTileAffectedByFog(ct);te=P.getOrCreateProgram("globeRaster",{defines:Ct,overrideFog:Ve}),ne=_t},we=P.colorModeForRenderPass(),ye=new mi(W.LEQUAL,mi.ReadWrite,P.depthRangeFor3D);es.update($);const ve=r.cE(ce),xe=[r.av(ce.center.lng),r.aC(ce.center.lat)],Se=P.globeSharedBuffers,Ce=[ce.width*r.q.devicePixelRatio,ce.height*r.q.devicePixelRatio],Ke=Float32Array.from(ce.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const ct=P.transform,_t=Pr(ct.zoom,k.exaggeration(),k.sourceCache._source.tileSize);ne=-1;const Ct=W.TRIANGLES;for(const Ve of j){const ut=U.getTile(Ve),Ne=Ni.disabled,ht=k.prevTerrainTileForTile[Ve.key],nt=k.terrainTileForTile[Ve.key];Ol(ht,nt)&&es.newMorphing(Ve.key,ht,nt,$,250),Q.activeTexture.set(W.TEXTURE0),ut.texture&&ut.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const yt=es.getMorphValuesForProxy(Ve.key),et=yt?1:0;yt&&r.L(Ge,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:r.cC(yt.phase)}});const gt=r.cF(Ve.canonical),Vt=r.cG(gt.getCenter().lat),Ut=r.cH(Ve.canonical,gt,Vt,ct.worldSize/ct._pixelsPerMercatorPixel),Gt=r.bc(r.cI(Ve.canonical)),oi=Nh(ct.expandedFarZProjMatrix,Ke,ve,Gt,r.ag(ct.zoom),xe,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,Ce,_t,ct._farZ,Ut);if(fe(Ve,et),te&&(k.setupElevationDraw(ut,te,Ge),P.uploadCommonUniforms(Q,te,Ve.toUnwrapped()),Se)){const[Di,xi,Ri]=Se.getGridBuffers(Vt,_t!==0);te.draw(P,Ct,ye,Ne,we,Ii.backCCW,oi,"globe_raster",Di,xi,Ri)}}}if(Se&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&ct.push("CUSTOM_ANTIALIASING"),te=P.getOrCreateProgram("globeRaster",{defines:ct});for(const _t of j){const{x:Ct,y:Ve,z:ut}=_t.canonical,Ne=Ve===0,ht=Ve===(1<<ut)-1,[nt,yt,et,gt]=Se.getPoleBuffers(ut,!1);if(gt&&(Ne||ht)){const Vt=U.getTile(_t);Q.activeTexture.set(W.TEXTURE0),Vt.texture&&Vt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Ut=r.cJ(ut,Ct,ce);const Gt=r.bc(r.cI(_t.canonical)),oi=(Di,xi)=>Di.draw(P,W.TRIANGLES,ye,Ni.disabled,we,Ii.disabled,Nh(ce.expandedFarZProjMatrix,Ut,Ut,Gt,0,xe,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Ce,0,ce._farZ),"globe_pole_raster",xi,et,gt);k.setupElevationDraw(Vt,te,Ge),P.uploadCommonUniforms(Q,te,_t.toUnwrapped()),Ne&&P.renderDefaultNorthPole&&oi(te,nt),ht&&P.renderDefaultSouthPole&&(Ut=r.ad.mat4.scale(r.ad.mat4.create(),Ut,[1,-1,1]),oi(te,yt))}}}})(p,g,b,I,L);else{const P=p.context,k=P.gl;let U,j;const $=p.shadowRenderer,Q=Wo(p,p.longestCutoffRange),W=we=>{if(j===we)return;const ye=[];ye.push(tl[we]),Q.shouldRenderCutoff&&ye.push("RENDER_CUTOFF"),$&&(ye.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&ye.push("NORMAL_OFFSET")),U=p.getOrCreateProgram("terrainRaster",{defines:ye}),j=we},te=p.colorModeForRenderPass(),ne=new mi(k.LEQUAL,mi.ReadWrite,p.depthRangeFor3D);es.update(L);const ce=p.transform,me=Pr(ce.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let fe=[0,0,0];if($){const we=p.style.directionalLight,ye=p.style.ambientLight;we&&ye&&(fe=bc(p.style,we,ye))}{j=-1;const we=k.TRIANGLES,[ye,ve]=[g.gridIndexBuffer,g.gridSegments];for(const xe of I){const Se=b.getTile(xe),Ce=Ni.disabled,Ke=g.prevTerrainTileForTile[xe.key],Ge=g.terrainTileForTile[xe.key];Ol(Ke,Ge)&&es.newMorphing(xe.key,Ke,Ge,L,250),P.activeTexture.set(k.TEXTURE0),Se.texture&&Se.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const ct=es.getMorphValuesForProxy(xe.key),_t=ct?1:0;let Ct;ct&&(Ct={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:r.cC(ct.phase)}});const Ve=Fd(xe.projMatrix,Lu(xe.canonical,ce.renderWorldCopies)?me/10:me,fe);if(W(_t),!U)continue;g.setupElevationDraw(Se,U,Ct);const ut=xe.toUnwrapped();$&&$.setupShadows(ut,U),p.uploadCommonUniforms(P,U,ut,null,Q),U.draw(p,we,ne,Ce,te,Ii.backCCW,Ve,"terrain_raster",g.gridBuffer,ye,ve)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,u=this.painter.context,p=this.proxySourceCache,g=this.proxiedCoords[p.id],b=this._drapedRenderBatches.shift(),I=n.style.order,L=[];let P=0;for(const k of g){const U=p.getTileByID(k.proxyTileKey),j=p.proxyCachedFBO[k.key]?p.proxyCachedFBO[k.key][t]:void 0,$=j!==void 0?p.renderCache[j]:this.pool[P++],Q=j!==void 0;if(U.texture=$.tex,Q&&!$.dirty){L.push(U.tileID);continue}let W;u.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(u.clear({color:r.al.transparent,stencil:0}),$.dirty=!1);for(let te=b.start;te<=b.end;++te){const ne=n.style._mergedLayers[I[te]];if(ne.isHidden(n.transform.zoom))continue;const ce=n.style.getLayerSourceCache(ne),me=ce?this.proxyToSource[k.key][ce.id]:[k];if(!me)continue;const fe=me;u.viewport.set([0,0,$.fb.width,$.fb.height]),W!==(ce?ce.id:null)&&(this._setupStencil($,me,ne,ce),W=ce?ce.id:null),n.renderLayer(n,ce,ne,fe)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const ne=n.style._mergedLayers[I[te]];if(ne.isHidden(n.transform.zoom))continue;const ce=n.style.getLayerSourceCache(ne),me=ce?this.proxyToSource[k.key][ce.id]:[k];if(!me)continue;const fe=me;u.viewport.set([0,0,$.fb.width,$.fb.height]),W!==(ce?ce.id:null)&&(this._setupStencil($,me,ne,ce),W=ce?ce.id:null),n.renderLayer(n,ce,ne,fe)}this.renderedToTile?($.dirty=!0,L.push(U.tileID)):Q||--P,P===5&&(P=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let u=-1,p=n;for(let g=0;g<n;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?u=Math.max(u,g):p=Math.min(p,g);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const b=g.tileID,I=1<<b.overscaledZ,{x:L,y:P}=b.canonical,k=L/I,U=(L+1)/I,j=P/I,$=(P+1)/I;return{minx:k,miny:j,maxx:U,maxy:$,t:g.dem.tree.raycastRoot(k,j,U,$,t,n,u),tile:g}});p.sort((g,b)=>(g.t!==null?g.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const g of p){if(g.t==null)return null;const b=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,n,u);if(b!=null)return b}return null}_createFBO(){const t=this.painter.context,n=t.gl,u=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const p=new r.T(t,{width:u[0],height:u[1],data:null},n.RGBA8);p.bind(n.LINEAR,n.CLAMP_TO_EDGE);const g=t.createFramebuffer(u[0],u[1],!0,null);return g.colorAttachment.set(p.texture),g.depthAttachment=new Oo(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],u=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!u&&n.shouldRedrape():!u&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof vl){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(p);if(g&&!n[g.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof r.ab){n[g.id]=!0;for(const b of this.proxyCoords){const I=this.proxyToSource[b.key][g.id];if(I)for(const L of I)this._clearRenderCacheForTile(g.id,L)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Fs){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(p);if(!g||n[g.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const b=p.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const L=this.proxyToSource[I.key][g.id];if(L)for(const P of L){const k=Vd(g.getTile(P),g.findLoadedParent(P,0),g,this.painter.transform,b);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(g.id,P)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,g=0,b=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++g<n;)b=this._style._mergedLayers[t[g]];for(;g<n;++g){const I=this._style._mergedLayers[t[g]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?p===void 0&&(p=g):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),p!==void 0&&(u.push({start:p,end:g-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:g-1}),u.length!==0){const I=u[u.length-1];this._pendingGroundEffectLayers.every(L=>L>I.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const b=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let I=0;I<b.length;++I){const L=Object.values(b[I]);n.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let b=u.length-1;b>=0;b--){const I=u[b];if(n.getTileByID(I.key),n.proxyCachedFBO[I.key]!==void 0){const L=t[I.key],P=this.proxyToSource[I.key];let k=0;for(const U in P){const j=P[U],$=L[U];if(!$||$.length!==j.length||j.some((Q,W)=>Q!==$[W]||p[U]&&p[U].hasOwnProperty(Q.key))){k=-1;break}++k}for(const U in n.proxyCachedFBO[I.key])n.renderCache[n.proxyCachedFBO[I.key][U]].dirty=k<0||k!==Object.values(L).length}}const g=[...this._drapedRenderBatches];g.sort((b,I)=>I.end-I.start-(b.end-b.start));for(const b of g)for(const I of u){if(n.proxyCachedFBO[I.key])continue;let L=n.renderCachePool.pop();L===void 0&&n.renderCache.length<50&&(L=n.renderCache.length,n.renderCache.push(this._createFBO())),L!==void 0&&(n.proxyCachedFBO[I.key]={},n.proxyCachedFBO[I.key][b.start]=L,n.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,b=g.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let I;if(u.isTileClipped())I=n.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ni.disabled}_renderTileClippingMasks(t,n){const u=this.painter,p=this.painter.context,g=p.gl;u._tileClippingMaskIDs={},p.setColorMode(en.disabled),p.setDepthMode(mi.disabled);const b=u.getOrCreateProgram("clippingMask");for(const I of t){const L=u._tileClippingMaskIDs[I.key]=--n;b.draw(u,g.TRIANGLES,mi.disabled,new Ni({func:g.ALWAYS,mask:0},L,255,g.KEEP,g.KEEP,g.REPLACE),en.disabled,Ii.disabled,Dc(I.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const u=[t.x,t.y,1,1];r.ad.vec4.transformMat4(u,u,n.pixelMatrixInverse),r.ad.vec4.scale(u,u,1/u[3]),u[0]/=n.worldSize,u[1]/=n.worldSize;const p=n._camera.position,g=r.bH(1,n.center.lat),b=[p[0],p[1],p[2]/g,0],I=r.ad.vec3.subtract([],u.slice(0,3),b);r.ad.vec3.normalize(I,I);const L=this.raycast(b,I,this._exaggeration);return L!==null&&L?(r.ad.vec3.scaleAndAdd(b,b,I,L),b[3]=b[2],b[2]*=g,b):null}_setupProxiedCoordsForOrtho(t,n,u){if(t.getSource()instanceof r.aK)return this._setupProxiedCoordsForImageSource(t,n,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let L=0;L<g.length;L++){const P=g[L],k=this._findTileCoveringTileID(P,t);if(k){const U=this._createProxiedId(P,k,u[P.key]&&u[P.key][t.id]);p.push(U),this.proxyToSource[P.key][t.id]=[U]}}let b=!1;const I=new Set;for(let L=0;L<n.length;L++){const P=t.getTile(n[L]);if(!P||!P.hasData())continue;const k=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==P.tileID.canonical.z){const U=this.proxyToSource[k.tileID.key][t.id],j=this._createProxiedId(k.tileID,P,u[k.tileID.key]&&u[k.tileID.key][t.id]);U?U.splice(U.length-1,0,j):this.proxyToSource[k.tileID.key][t.id]=[j];const $=this.proxyToSource[k.tileID.key][t.id];I.has($)||I.add($),p.push(j),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const L of I)L.sort((P,k)=>k.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],g=this.proxyCoords,b=t.getSource(),I=b.tileID;if(!I)return;const L=new r.P(I.x,I.y)._div(1<<I.z),P=b.coordinates.map(r.ac.fromLngLat).reduce((U,j)=>(U.min.x=Math.min(U.min.x,j.x-L.x),U.min.y=Math.min(U.min.y,j.y-L.y),U.max.x=Math.max(U.max.x,j.x-L.x),U.max.y=Math.max(U.max.y,j.y-L.y),U),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(U,j)=>{const $=U.wrap+U.canonical.x/(1<<U.canonical.z),Q=U.canonical.y/(1<<U.canonical.z),W=r.ai/(1<<U.canonical.z),te=j.wrap+j.canonical.x/(1<<j.canonical.z),ne=j.canonical.y/(1<<j.canonical.z);return $+W<te+P.min.x||$>te+P.max.x||Q+W<ne+P.min.y||Q>ne+P.max.y};for(let U=0;U<g.length;U++){const j=g[U];for(let $=0;$<n.length;$++){const Q=t.getTile(n[$]);if(!Q||!Q.hasData()||k(j,Q.tileID))continue;const W=this._createProxiedId(j,Q,u[j.key]&&u[j.key][t.id]),te=this.proxyToSource[j.key][t.id];te?te.push(W):this.proxyToSource[j.key][t.id]=[W],p.push(W)}}}_createProxiedId(t,n,u){let p=this.orthoMatrix;if(u){const g=u.find(b=>b.key===n.tileID.key);if(g)return g}if(n.tileID.key!==t.key){const g=t.canonical.z-n.tileID.canonical.z;let b,I,L;p=r.ad.mat4.create();const P=n.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(b=r.ai>>g,I=b*((n.tileID.canonical.x<<g)-t.canonical.x+P),L=b*((n.tileID.canonical.y<<g)-t.canonical.y)):(b=r.ai<<-g,I=r.ai*(n.tileID.canonical.x-(t.canonical.x+P<<-g)),L=r.ai*(n.tileID.canonical.y-(t.canonical.y<<-g))),r.ad.mat4.ortho(p,0,b,0,b,0,1),r.ad.mat4.translate(p,p,[I,L,0])}return new Zr(n.tileID,t.key,p)}_findTileCoveringTileID(t,n){let u=n.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[n.id],g=p[t.key];if(u=g?n.getTileByID(g):null,u&&u.hasData()||g===null)return u;let b=u?u.tileID:t,I=b.overscaledZ;const L=n.getSource().minzoom,P=[];if(!g){const U=n.getSource().maxzoom;if(t.canonical.z>=U){const j=t.canonical.z-U;n.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,n.transform.tileZoom),b=new r.aH(I,t.wrap,U,t.canonical.x>>j,t.canonical.y>>j)):j!==0&&(I=U,b=new r.aH(I,t.wrap,U,t.canonical.x>>j,t.canonical.y>>j))}b.key!==t.key&&(P.push(b.key),u=n.getTile(b))}const k=U=>{P.forEach(j=>{p[j]=U}),P.length=0};for(I-=1;I>=L&&(!u||!u.hasData());I--){u&&k(u.tileID.key);const U=b.calculateScaledKey(I);if(u=n.getTileByID(U),u&&u.hasData())break;const j=p[U];if(j===null)break;j===void 0?P.push(U):u=n.getTileByID(j)}return k(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[n.key]=!0}}function Ou(h,t,n){const u=function(I,L,P){const k=r.ad.vec3.dot(L,I),U=r.ad.vec3.dot(P,[.2126,.7152,.0722]),j=(Q,W,te)=>(1-te)*Q+te*W,$=j(1-.3*Math.min(U,1),1,Math.min(k+1,1));return j(.92,1,Math.asin(r.ay(L[2],-1,1))/Math.PI+.5)*$}(h,[0,0,1],t),p=[0,0,0];r.ad.vec3.scale(p,n.slice(0,3),u);const g=[0,0,0];r.ad.vec3.scale(g,t.slice(0,3),h[2]);const b=[0,0,0];return r.ad.vec3.add(b,p,g),r.cg(b)}const il=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],op=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class zc{static cacheKey(t,n,u,p){let g=`${n}${p?p.cacheKey:""}`;for(const b of u)t.usedDefines.includes(b)&&(g+=`/${b}`);return g}constructor(t,n,u,p,g,b){const I=t.gl;this.program=I.createProgram(),this.configuration=p,this.name=n,this.fixedDefines=[...b];const L=p?p.getBinderAttributes():[],P=(u.staticAttributes||[]).concat(L);let k=p?p.defines():[];k=k.concat(b.map(te=>`#define ${te}`));const U=`#version 300 es
`;let j=U+k.concat("precision mediump float;",Ec,Ru.fragmentSource).join(`
`);for(const te of u.fragmentIncludes)j+=`
${Hs[te]}`;j+=`
${u.fragmentSource}`;let $=U+k.concat("precision highp float;",Ec,Ru.vertexSource).join(`
`);for(const te of u.vertexIncludes)$+=`
${Hs[te]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&($+=`
uniform int u_instanceID;
`),$+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&($=$.replaceAll("gl_InstanceID","u_instanceID"));const Q=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Q,j),I.compileShader(Q),I.attachShader(this.program,Q);const W=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(W,$),I.compileShader(W),I.attachShader(this.program,W),this.attributes={},this.numAttributes=P.length;for(let te=0;te<this.numAttributes;te++)if(P[te]){const ne=P[te].startsWith("a_")?P[te]:`a_${P[te]}`;I.bindAttribLocation(this.program,te,ne),this.attributes[ne]=te}I.linkProgram(this.program),I.deleteShader(W),I.deleteShader(Q),this.fixedUniforms=g(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(te=>({u_instanceID:new r.bN(te)}))(t)),(b.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=(te=>({u_dem:new r.bN(te),u_dem_prev:new r.bN(te),u_dem_tl:new r.bK(te),u_dem_scale:new r.bM(te),u_dem_tl_prev:new r.bK(te),u_dem_scale_prev:new r.bM(te),u_dem_size:new r.bM(te),u_dem_lerp:new r.bM(te),u_exaggeration:new r.bM(te),u_depth:new r.bN(te),u_depth_size_inv:new r.bK(te),u_depth_range_unpack:new r.bK(te),u_occluder_half_size:new r.bM(te),u_occlusion_depth_offset:new r.bM(te),u_meter_to_dem:new r.bM(te),u_label_plane_matrix_inv:new r.bJ(te)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new r.bL(te),u_tile_tr_up:new r.bL(te),u_tile_br_up:new r.bL(te),u_tile_bl_up:new r.bL(te),u_tile_up_scale:new r.bM(te)}))(t)),b.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new r.bJ(te),u_fog_range:new r.bK(te),u_fog_color:new r.cb(te),u_fog_horizon_blend:new r.bM(te),u_fog_vertical_limit:new r.bK(te),u_fog_temporal_offset:new r.bM(te),u_frustum_tl:new r.bL(te),u_frustum_tr:new r.bL(te),u_frustum_br:new r.bL(te),u_frustum_bl:new r.bL(te),u_globe_pos:new r.bL(te),u_globe_radius:new r.bM(te),u_globe_transition:new r.bM(te),u_is_globe:new r.bN(te),u_viewport:new r.bK(te)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(te=>({u_cutoff_params:new r.cb(te)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(te=>({u_lighting_ambient_color:new r.bL(te),u_lighting_directional_dir:new r.bL(te),u_lighting_directional_color:new r.bL(te),u_ground_radiance:new r.bL(te)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(te=>({u_light_matrix_0:new r.bJ(te),u_light_matrix_1:new r.bJ(te),u_fade_range:new r.bK(te),u_shadow_normal_offset:new r.bL(te),u_shadow_intensity:new r.bM(te),u_shadow_texel_size:new r.bM(te),u_shadow_map_resolution:new r.bM(te),u_shadow_direction:new r.bL(te),u_shadow_bias:new r.bL(te),u_shadowmap_0:new r.bN(te),u_shadowmap_1:new r.bN(te)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p]&&u[p].set(this.program,p,n[p])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p]&&u[p].set(this.program,p,n[p])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}_drawDebugWireframe(t,n,u,p,g,b,I,L,P,k){const U=t.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const j=t.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||t._terrain&&t._terrain.renderingToTexture||!il.includes(this.name))||!(!U.layers3D||!op.includes(this.name))))return;const $=j.gl,Q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,j);if(!Q)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const te=t.getOrCreateProgram(this.name,{config:this.configuration,defines:W});j.program.set(te.program);const ne=(fe,we,ye)=>{if(we[fe]&&ye[fe])for(const ve in we[fe])ye[fe][ve]&&ye[fe][ve].set(ye.program,ve,we[fe][ve].current)};P&&P.setUniforms(te.program,j,te.binderUniforms,I,{zoom:L}),ne("fixedUniforms",this,te),ne("terrainUniforms",this,te),ne("globeUniforms",this,te),ne("fogUniforms",this,te),ne("lightsUniforms",this,te),ne("shadowUniforms",this,te),Q.bind(),j.setColorMode(new en([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.ZERO,$.ONE],r.al.transparent,[!0,!0,!0,!1])),j.setDepthMode(new mi(n.func===$.LESS?$.LEQUAL:n.func,mi.ReadOnly,n.range)),j.setStencilMode(Ni.disabled);const ce=3*b.primitiveLength*2,me=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=k||1;for(let we=0;we<fe;++we)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),$.drawElements($.LINES,ce,$.UNSIGNED_SHORT,me)}else k&&k>1?$.drawElementsInstanced($.LINES,ce,$.UNSIGNED_SHORT,me,k):$.drawElements($.LINES,ce,$.UNSIGNED_SHORT,me);g.bind(),j.program.set(this.program),j.setDepthMode(n),j.setStencilMode(u),j.setColorMode(p)}checkUniforms(t,n,u){if(this.fixedDefines.includes(n)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${n} being defined`)}}draw(t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te){const ne=t.context,ce=ne.gl;if(this.failedToCreate)return;ne.program.set(this.program),ne.setDepthMode(u),ne.setStencilMode(p),ne.setColorMode(g),ne.setCullFace(b);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,I[we]);Q&&Q.setUniforms(this.program,ne,this.binderUniforms,j,{zoom:$});const me={[ce.POINTS]:1,[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[n];this.checkUniforms(L,"RENDER_SHADOWS",this.shadowUniforms);const fe=te&&te>0?1:void 0;for(const we of U.get()){const ye=we.vaos||(we.vaos={});if((ye[L]||(ye[L]=new Rh)).bind(ne,this,P,Q?Q.getPaintVertexBuffers():[],k,we.vertexOffset,W||[],fe),this.forceManualRenderingForInstanceIDShaders){const ve=te||1;for(let xe=0;xe<ve;++xe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",xe),k?ce.drawElements(n,we.primitiveLength*me,ce.UNSIGNED_SHORT,we.primitiveOffset*me*2):ce.drawArrays(n,we.vertexOffset,we.vertexLength)}else te&&te>1?ce.drawElementsInstanced(n,we.primitiveLength*me,ce.UNSIGNED_SHORT,we.primitiveOffset*me*2,te):k?ce.drawElements(n,we.primitiveLength*me,ce.UNSIGNED_SHORT,we.primitiveOffset*me*2):ce.drawArrays(n,we.vertexOffset,we.vertexLength);n===ce.TRIANGLES&&k&&this._drawDebugWireframe(t,u,p,g,k,we,j,$,Q,te)}}}function Pl(h,t){const n=Math.pow(2,t.tileID.overscaledZ),u=t.tileSize*Math.pow(2,h.transform.tileZoom)/n,p=u*(t.tileID.canonical.x+t.tileID.wrap*n),g=u*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.at(t,1,h.transform.tileZoom),u_pixel_coord_upper:[p>>16,g>>16],u_pixel_coord_lower:[65535&p,65535&g]}}const jd={terrain:0,flat:1},qd=r.ad.mat4.create(),Gd=(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te,ne)=>{const ce=t.style.light,me=ce.properties.get("position"),fe=[me.x,me.y,me.z],we=r.ad.mat3.create();ce.properties.get("anchor")==="viewport"&&(r.ad.mat3.fromRotation(we,-t.transform.angle),r.ad.vec3.transformMat3(fe,fe,we));const ye=ce.properties.get("color"),ve=t.transform,xe={u_matrix:h,u_lightpos:fe,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_vertical_gradient:+n,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:jd[P],u_base_type:jd[k],u_ao:p,u_edge_radius:g,u_width_scale:b,u_flood_light_color:Q,u_vertical_scale:W,u_flood_light_intensity:te,u_ground_shadow_factor:ne};return ve.projection.name==="globe"&&(xe.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],xe.u_zoom_transition=U,xe.u_inv_rot_matrix=$,xe.u_merc_center=j,xe.u_up_dir=ve.projection.upVector(new r.bT(0,0,0),j[0]*r.ai,j[1]*r.ai),xe.u_height_lift=L),xe},Lc=(h,t,n,u,p,g)=>({u_matrix:h,u_edge_radius:t,u_width_scale:n,u_vertical_scale:u,u_height_type:jd[p],u_base_type:jd[g]}),nl=(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te)=>{const ne=Gd(h,t,n,u,p,g,b,I,P,k,U,j,$,Q,W,te,1,[0,0,0]),ce={u_height_factor:-Math.pow(2,I.overscaledZ)/L.tileSize/8};return r.l(ne,Pl(t,L),ce)},kl=(h,t)=>({u_matrix:h,u_emissive_strength:t}),Pu=(h,t,n,u)=>r.l(kl(h,t),Pl(n,u)),Fh=(h,t,n)=>({u_matrix:h,u_world:n,u_emissive_strength:t}),Bl=(h,t,n,u,p)=>r.l(Pu(h,t,n,u),{u_world:p}),ku=(h,t,n,u,p)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:n,u_height_scale:u,u_reset_depth:p}),Vh=(h,t,n,u)=>{const p=r.ai/n.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},Hd=(h,t,n=1)=>({u_matrix:h,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),Oc=r.ad.mat4.create(),Pc=(h,t,n,u,p,g,b)=>{const I=h.transform,L=I.projection.name==="globe",P=L?r.cO(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:r.at(n,1,g),k={u_matrix:t.projMatrix,u_extrude_scale:P,u_intensity:b,u_inv_rot_matrix:Oc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){k.u_inv_rot_matrix=u,k.u_merc_center=p,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=r.ag(I.zoom);const U=p[0]*r.ai,j=p[1]*r.ai;k.u_up_dir=I.projection.upVector(new r.bT(0,0,0),U,j)}return k};function Wt(h,[t,n,u,p],[g,b]){if(g===b)return[0,0,0,0];const I=255*(h-1)/(h*(b-g));return[t*I,n*I,u*I,p*I]}function kc(h,t,[n,u]){return n===u?0:.5/h+(t-n)*(h-1)/(h*(u-n))}const Zd=(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te,ne,ce,me,fe)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:P,u_fade_t:k.mix,u_opacity:k.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:r.cP(U.paint.get("raster-saturation")),u_contrast_factor:r.cQ(U.paint.get("raster-contrast")),u_spin_weights:rl(U.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:$,u_zoom_transition:b,u_merc_center:I,u_cutoff_params:L,u_colorization_mix:Wt(r.cR,W,ne),u_colorization_offset:kc(r.cR,te,ne),u_color_ramp:Q,u_texture_offset:[me/(ce+2*me),ce/(ce+2*me)],u_texture_res:[ce+2*me,ce+2*me],u_emissive_strength:fe});function rl(h){h*=Math.PI/180;const t=Math.sin(h),n=Math.cos(h);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const la=.05,_i=(h,t,n,u,p,g,b,I,L,P,k,U)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:P,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:b,u_merc_center:I,u_cutoff_params:L}),Uh=(h,t,n,u,p,g,b,I,L,P)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:u,u_color_ramp:g,u_velocity_res:p,u_max_speed:b,u_uv_offset:I,u_data_scale:[255*L[0],255*L[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[la,la]}),Nl=(h,t,n,u,p,g,b,I,L,P)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:u,u_max_speed:p,u_speed_factor:g,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*L[0],255*L[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[la,la]}),al=r.ad.mat4.create(),Fl=(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te,ne,ce,me,fe,we)=>{const ye=p.transform,ve={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ye.getCameraToCenterDistance(ce),u_rotate_symbol:+n,u_aspect_ratio:ye.width/ye.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:b,u_coord_matrix:I,u_is_text:+P,u_elevation_from_sea:L?1:0,u_pitch_with_map:+u,u_texsize:k,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:al,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:al,u_up_vector:[0,-1,0],u_color_adj_mat:me,u_icon_transition:fe||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(ce)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:we||1};return ce.name==="globe"&&(ve.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],ve.u_zoom_transition=Q,ve.u_inv_rot_matrix=te,ve.u_merc_center=W,ve.u_camera_forward=ye._camera.forward(),ve.u_ecef_origin=r.cS(ye.globeMatrix,$.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(ye.globeMatrix),ve.u_up_vector=ne),ve},jh=(h,t,n,u)=>({u_matrix:h,u_emissive_strength:t,u_opacity:n,u_color:u}),$d=(h,t,n,u,p,g,b,I,L)=>r.l(function(P,k,U,j,$,Q){const{width:W,height:te}=j.imageManager.getPixelSize(k),ne=Math.pow(2,Q.tileID.overscaledZ),ce=Q.tileSize*Math.pow(2,j.transform.tileZoom)/ne,me=ce*(Q.tileID.canonical.x+Q.tileID.wrap*ne),fe=ce*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[W,te],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:$?[j.transform.width,-1*j.transform.height]:[1/r.at(Q,1,j.transform.tileZoom),1/r.at(Q,1,j.transform.tileZoom)],u_pixel_coord_upper:[me>>16,fe>>16],u_pixel_coord_lower:[65535&me,65535&fe]}}(0,g,b,u,I,L),{u_matrix:h,u_emissive_strength:t,u_opacity:n}),Vl=new Float32Array(r.ad.mat4.identity([])),Bc=(h,t,n,u,p,g,b,I,L,P,k,U,j,$=[0,0,0],Q)=>{const W=p.style.light,te=W.properties.get("position"),ne=[-te.x,-te.y,te.z],ce=r.ad.mat3.create();W.properties.get("anchor")==="viewport"&&(r.ad.mat3.fromRotation(ce,-p.transform.angle),r.ad.vec3.transformMat3(ne,ne,ce));const me=k.alphaMode==="MASK",fe=W.properties.get("color").toRenderColor(null),we=j.paint.get("model-ambient-occlusion-intensity"),ye=j.paint.get("model-color").constantOr(r.al.white).toRenderColor(null),ve=j.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:u||Vl,u_lightpos:ne,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:$,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+me,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:L,u_roughnessFactor:P,u_baseColorTexture:mr.BaseColor,u_metallicRoughnessTexture:mr.MetallicRoughness,u_normalTexture:mr.Normal,u_occlusionTexture:mr.Occlusion,u_emissionTexture:mr.Emission,u_lutTexture:mr.LUT,u_color_mix:[ye.r,ye.g,ye.b,ve],u_aoIntensity:we,u_emissive_strength:U,u_occlusionTextureTransform:Q||[0,0,0,0]}},lp=(h,t=Vl,n=Vl)=>({u_matrix:h,u_instance:t,u_node_matrix:n}),Xd={fillExtrusion:h=>({u_matrix:new r.bJ(h),u_lightpos:new r.bL(h),u_lightintensity:new r.bM(h),u_lightcolor:new r.bL(h),u_vertical_gradient:new r.bM(h),u_opacity:new r.bM(h),u_edge_radius:new r.bM(h),u_width_scale:new r.bM(h),u_ao:new r.bK(h),u_height_type:new r.bN(h),u_base_type:new r.bN(h),u_tile_id:new r.bL(h),u_zoom_transition:new r.bM(h),u_inv_rot_matrix:new r.bJ(h),u_merc_center:new r.bK(h),u_up_dir:new r.bL(h),u_height_lift:new r.bM(h),u_flood_light_color:new r.bL(h),u_vertical_scale:new r.bM(h),u_flood_light_intensity:new r.bM(h),u_ground_shadow_factor:new r.bL(h)}),fillExtrusionDepth:h=>({u_matrix:new r.bJ(h),u_edge_radius:new r.bM(h),u_width_scale:new r.bM(h),u_vertical_scale:new r.bM(h),u_height_type:new r.bN(h),u_base_type:new r.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new r.bJ(h),u_lightpos:new r.bL(h),u_lightintensity:new r.bM(h),u_lightcolor:new r.bL(h),u_vertical_gradient:new r.bM(h),u_height_factor:new r.bM(h),u_edge_radius:new r.bM(h),u_width_scale:new r.bM(h),u_ao:new r.bK(h),u_height_type:new r.bN(h),u_base_type:new r.bN(h),u_tile_id:new r.bL(h),u_zoom_transition:new r.bM(h),u_inv_rot_matrix:new r.bJ(h),u_merc_center:new r.bK(h),u_up_dir:new r.bL(h),u_height_lift:new r.bM(h),u_image:new r.bN(h),u_texsize:new r.bK(h),u_pixel_coord_upper:new r.bK(h),u_pixel_coord_lower:new r.bK(h),u_tile_units_to_pixels:new r.bM(h),u_opacity:new r.bM(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new r.bJ(h),u_opacity:new r.bM(h),u_ao_pass:new r.bM(h),u_meter_to_tile:new r.bM(h),u_ao:new r.bK(h),u_flood_light_intensity:new r.bM(h),u_flood_light_color:new r.bL(h),u_attenuation:new r.bM(h),u_edge_radius:new r.bM(h),u_fb:new r.bN(h),u_fb_size:new r.bM(h),u_dynamic_offset:new r.bM(h)}),fill:h=>({u_matrix:new r.bJ(h),u_emissive_strength:new r.bM(h)}),fillPattern:h=>({u_matrix:new r.bJ(h),u_emissive_strength:new r.bM(h),u_image:new r.bN(h),u_texsize:new r.bK(h),u_pixel_coord_upper:new r.bK(h),u_pixel_coord_lower:new r.bK(h),u_tile_units_to_pixels:new r.bM(h)}),fillOutline:h=>({u_matrix:new r.bJ(h),u_emissive_strength:new r.bM(h),u_world:new r.bK(h)}),fillOutlinePattern:h=>({u_matrix:new r.bJ(h),u_emissive_strength:new r.bM(h),u_world:new r.bK(h),u_image:new r.bN(h),u_texsize:new r.bK(h),u_pixel_coord_upper:new r.bK(h),u_pixel_coord_lower:new r.bK(h),u_tile_units_to_pixels:new r.bM(h)}),elevatedStructures:h=>({u_matrix:new r.bJ(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new r.bJ(h),u_camera_pos:new r.bL(h),u_depth_bias:new r.bM(h),u_height_scale:new r.bM(h),u_reset_depth:new r.bM(h)}),circle:r.cT,collisionBox:h=>({u_matrix:new r.bJ(h),u_camera_to_center_distance:new r.bM(h),u_extrude_scale:new r.bK(h)}),collisionCircle:h=>({u_matrix:new r.bJ(h),u_inv_matrix:new r.bJ(h),u_camera_to_center_distance:new r.bM(h),u_viewport_size:new r.bK(h)}),debug:h=>({u_color:new r.cA(h),u_matrix:new r.bJ(h),u_overlay:new r.bN(h),u_overlay_scale:new r.bM(h)}),clippingMask:h=>({u_matrix:new r.bJ(h)}),heatmap:h=>({u_extrude_scale:new r.bM(h),u_intensity:new r.bM(h),u_matrix:new r.bJ(h),u_inv_rot_matrix:new r.bJ(h),u_merc_center:new r.bK(h),u_tile_id:new r.bL(h),u_zoom_transition:new r.bM(h),u_up_dir:new r.bL(h)}),heatmapTexture:h=>({u_image:new r.bN(h),u_color_ramp:new r.bN(h),u_opacity:new r.bM(h)}),hillshade:h=>({u_matrix:new r.bJ(h),u_image:new r.bN(h),u_latrange:new r.bK(h),u_light:new r.bK(h),u_shadow:new r.cA(h),u_highlight:new r.cA(h),u_emissive_strength:new r.bM(h),u_accent:new r.cA(h)}),hillshadePrepare:h=>({u_matrix:new r.bJ(h),u_image:new r.bN(h),u_dimension:new r.bK(h),u_zoom:new r.bM(h)}),line:r.cU,linePattern:r.cV,raster:h=>({u_matrix:new r.bJ(h),u_normalize_matrix:new r.bJ(h),u_globe_matrix:new r.bJ(h),u_merc_matrix:new r.bJ(h),u_grid_matrix:new r.cB(h),u_tl_parent:new r.bK(h),u_scale_parent:new r.bM(h),u_fade_t:new r.bM(h),u_opacity:new r.bM(h),u_image0:new r.bN(h),u_image1:new r.bN(h),u_brightness_low:new r.bM(h),u_brightness_high:new r.bM(h),u_saturation_factor:new r.bM(h),u_contrast_factor:new r.bM(h),u_spin_weights:new r.bL(h),u_perspective_transform:new r.bK(h),u_raster_elevation:new r.bM(h),u_zoom_transition:new r.bM(h),u_merc_center:new r.bK(h),u_cutoff_params:new r.cb(h),u_colorization_mix:new r.cb(h),u_colorization_offset:new r.bM(h),u_color_ramp:new r.bN(h),u_texture_offset:new r.bK(h),u_texture_res:new r.bK(h),u_emissive_strength:new r.bM(h)}),rasterParticle:h=>({u_matrix:new r.bJ(h),u_normalize_matrix:new r.bJ(h),u_globe_matrix:new r.bJ(h),u_merc_matrix:new r.bJ(h),u_grid_matrix:new r.cB(h),u_tl_parent:new r.bK(h),u_scale_parent:new r.bM(h),u_fade_t:new r.bM(h),u_opacity:new r.bM(h),u_image0:new r.bN(h),u_image1:new r.bN(h),u_raster_elevation:new r.bM(h),u_zoom_transition:new r.bM(h),u_merc_center:new r.bK(h),u_cutoff_params:new r.cb(h)}),rasterParticleTexture:h=>({u_texture:new r.bN(h),u_opacity:new r.bM(h)}),rasterParticleDraw:h=>({u_particle_texture:new r.bN(h),u_particle_texture_side_len:new r.bM(h),u_tile_offset:new r.bK(h),u_velocity:new r.bN(h),u_color_ramp:new r.bN(h),u_velocity_res:new r.bK(h),u_max_speed:new r.bM(h),u_uv_offset:new r.bK(h),u_data_scale:new r.bK(h),u_data_offset:new r.bM(h),u_particle_pos_scale:new r.bM(h),u_particle_pos_offset:new r.bK(h)}),rasterParticleUpdate:h=>({u_particle_texture:new r.bN(h),u_particle_texture_side_len:new r.bM(h),u_velocity:new r.bN(h),u_velocity_res:new r.bK(h),u_max_speed:new r.bM(h),u_speed_factor:new r.bM(h),u_reset_rate:new r.bM(h),u_rand_seed:new r.bM(h),u_uv_offset:new r.bK(h),u_data_scale:new r.bK(h),u_data_offset:new r.bM(h),u_particle_pos_scale:new r.bM(h),u_particle_pos_offset:new r.bK(h)}),symbol:h=>({u_is_size_zoom_constant:new r.bN(h),u_is_size_feature_constant:new r.bN(h),u_size_t:new r.bM(h),u_size:new r.bM(h),u_camera_to_center_distance:new r.bM(h),u_rotate_symbol:new r.bN(h),u_aspect_ratio:new r.bM(h),u_fade_change:new r.bM(h),u_matrix:new r.bJ(h),u_label_plane_matrix:new r.bJ(h),u_coord_matrix:new r.bJ(h),u_is_text:new r.bN(h),u_elevation_from_sea:new r.bN(h),u_pitch_with_map:new r.bN(h),u_texsize:new r.bK(h),u_texsize_icon:new r.bK(h),u_texture:new r.bN(h),u_texture_icon:new r.bN(h),u_gamma_scale:new r.bM(h),u_device_pixel_ratio:new r.bM(h),u_tile_id:new r.bL(h),u_zoom_transition:new r.bM(h),u_inv_rot_matrix:new r.bJ(h),u_merc_center:new r.bK(h),u_camera_forward:new r.bL(h),u_tile_matrix:new r.bJ(h),u_up_vector:new r.bL(h),u_ecef_origin:new r.bL(h),u_is_halo:new r.bN(h),u_icon_transition:new r.bM(h),u_color_adj_mat:new r.bJ(h),u_scale_factor:new r.bM(h)}),background:h=>({u_matrix:new r.bJ(h),u_emissive_strength:new r.bM(h),u_opacity:new r.bM(h),u_color:new r.cA(h)}),backgroundPattern:h=>({u_matrix:new r.bJ(h),u_emissive_strength:new r.bM(h),u_opacity:new r.bM(h),u_image:new r.bN(h),u_pattern_tl:new r.bK(h),u_pattern_br:new r.bK(h),u_texsize:new r.bK(h),u_pattern_size:new r.bK(h),u_pixel_coord_upper:new r.bK(h),u_pixel_coord_lower:new r.bK(h),u_pattern_units_to_pixels:new r.bK(h)}),terrainRaster:h=>({u_matrix:new r.bJ(h),u_image0:new r.bN(h),u_skirt_height:new r.bM(h),u_ground_shadow_factor:new r.bL(h)}),skybox:h=>({u_matrix:new r.bJ(h),u_sun_direction:new r.bL(h),u_cubemap:new r.bN(h),u_opacity:new r.bM(h),u_temporal_offset:new r.bM(h)}),skyboxGradient:h=>({u_matrix:new r.bJ(h),u_color_ramp:new r.bN(h),u_center_direction:new r.bL(h),u_radius:new r.bM(h),u_opacity:new r.bM(h),u_temporal_offset:new r.bM(h)}),skyboxCapture:h=>({u_matrix_3f:new r.cB(h),u_sun_direction:new r.bL(h),u_sun_intensity:new r.bM(h),u_color_tint_r:new r.cb(h),u_color_tint_m:new r.cb(h),u_luminance:new r.bM(h)}),globeRaster:h=>({u_proj_matrix:new r.bJ(h),u_globe_matrix:new r.bJ(h),u_normalize_matrix:new r.bJ(h),u_merc_matrix:new r.bJ(h),u_zoom_transition:new r.bM(h),u_merc_center:new r.bK(h),u_image0:new r.bN(h),u_grid_matrix:new r.cB(h),u_skirt_height:new r.bM(h),u_far_z_cutoff:new r.bM(h),u_frustum_tl:new r.bL(h),u_frustum_tr:new r.bL(h),u_frustum_br:new r.bL(h),u_frustum_bl:new r.bL(h),u_globe_pos:new r.bL(h),u_globe_radius:new r.bM(h),u_viewport:new r.bK(h)}),globeAtmosphere:h=>({u_frustum_tl:new r.bL(h),u_frustum_tr:new r.bL(h),u_frustum_br:new r.bL(h),u_frustum_bl:new r.bL(h),u_horizon:new r.bM(h),u_transition:new r.bM(h),u_fadeout_range:new r.bM(h),u_color:new r.cb(h),u_high_color:new r.cb(h),u_space_color:new r.cb(h),u_temporal_offset:new r.bM(h),u_horizon_angle:new r.bM(h)}),model:h=>({u_matrix:new r.bJ(h),u_lighting_matrix:new r.bJ(h),u_normal_matrix:new r.bJ(h),u_node_matrix:new r.bJ(h),u_lightpos:new r.bL(h),u_lightintensity:new r.bM(h),u_lightcolor:new r.bL(h),u_camera_pos:new r.bL(h),u_opacity:new r.bM(h),u_baseColorFactor:new r.cb(h),u_emissiveFactor:new r.cb(h),u_metallicFactor:new r.bM(h),u_roughnessFactor:new r.bM(h),u_baseTextureIsAlpha:new r.bN(h),u_alphaMask:new r.bN(h),u_alphaCutoff:new r.bM(h),u_baseColorTexture:new r.bN(h),u_metallicRoughnessTexture:new r.bN(h),u_normalTexture:new r.bN(h),u_occlusionTexture:new r.bN(h),u_emissionTexture:new r.bN(h),u_lutTexture:new r.bN(h),u_color_mix:new r.cb(h),u_aoIntensity:new r.bM(h),u_emissive_strength:new r.bM(h),u_occlusionTextureTransform:new r.cb(h)}),modelDepth:h=>({u_matrix:new r.bJ(h),u_instance:new r.bJ(h),u_node_matrix:new r.bJ(h)}),groundShadow:h=>({u_matrix:new r.bJ(h),u_ground_shadow_factor:new r.bL(h)}),stars:h=>({u_matrix:new r.bJ(h),u_up:new r.bL(h),u_right:new r.bL(h),u_intensity_multiplier:new r.bM(h)}),snowParticle:h=>({u_modelview:new r.bJ(h),u_projection:new r.bJ(h),u_time:new r.bM(h),u_cam_pos:new r.bL(h),u_velocityConeAperture:new r.bM(h),u_velocity:new r.bM(h),u_horizontalOscillationRadius:new r.bM(h),u_horizontalOscillationRate:new r.bM(h),u_boxSize:new r.bM(h),u_billboardSize:new r.bM(h),u_simpleShapeParameters:new r.bK(h),u_screenSize:new r.bK(h),u_thinningCenterPos:new r.bK(h),u_thinningShape:new r.bL(h),u_thinningAffectedRatio:new r.bM(h),u_thinningParticleOffset:new r.bM(h),u_particleColor:new r.cb(h),u_direction:new r.bL(h)}),rainParticle:h=>({u_modelview:new r.bJ(h),u_projection:new r.bJ(h),u_time:new r.bM(h),u_cam_pos:new r.bL(h),u_texScreen:new r.bN(h),u_velocityConeAperture:new r.bM(h),u_velocity:new r.bM(h),u_boxSize:new r.bM(h),u_rainDropletSize:new r.bK(h),u_distortionStrength:new r.bM(h),u_rainDirection:new r.bL(h),u_color:new r.cb(h),u_screenSize:new r.bK(h),u_thinningCenterPos:new r.bK(h),u_thinningShape:new r.bL(h),u_thinningAffectedRatio:new r.bM(h),u_thinningParticleOffset:new r.bM(h),u_shapeDirectionalPower:new r.bM(h),u_shapeNormalPower:new r.bM(h),u_mode:new r.bM(h)}),vignette:h=>({u_vignetteShape:new r.bL(h),u_vignetteColor:new r.cb(h)}),occlusion:h=>({u_matrix:new r.bJ(h),u_anchorPos:new r.bL(h),u_screenSizePx:new r.bK(h),u_occluderSizePx:new r.bK(h),u_color:new r.cb(h)})};class ts{constructor(t,n,u,p){this.id=ts.uniqueIdxCounter,ts.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||p||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=ts.uniqueIdxCounter,ts.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ts.uniqueIdxCounter=0;const Bu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yd{constructor(t,n,u,p,g,b){this.length=n.length,this.attributes=u,this.itemSize=n.bytesPerElement,this.dynamicDraw=p,this.instanceCount=b,this.context=t;const I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||g||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let u=0;u<this.attributes.length;u++){const p=n.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,n,u){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],b=n.attributes[g.name];b!==void 0&&t.vertexAttribPointer(b,g.components,t[Bu[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,n,u){for(let p=0;p<this.attributes.length;p++){const g=n.attributes[this.attributes[p].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Da{constructor(t,n,u,p,g){this.context=t,this.width=n,this.height=u;const b=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new el(t,b)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new fo(t,b):new Ds(t,b))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class Po{constructor(t,n){this.gl=t,this.clearColor=new _m(this),this.clearDepth=new zu(this),this.clearStencil=new Qo(this),this.colorMask=new Dh(this),this.depthMask=new zh(this),this.stencilMask=new Cc(this),this.stencilFunc=new Ic(this),this.stencilOp=new kd(this),this.stencilTest=new Ll(this),this.depthRange=new qa(this),this.depthTest=new Rs(this),this.depthFunc=new da(this),this.blend=new uo(this),this.blendFunc=new Zs(this),this.blendColor=new zo(this),this.blendEquation=new Bd(this),this.cullFace=new Lh(this),this.cullFaceSide=new Oh(this),this.frontFace=new wa(this),this.program=new Or(this),this.activeTexture=new tr(this),this.viewport=new Lo(this),this.bindFramebuffer=new ho(this),this.bindRenderbuffer=new Nd(this),this.bindTexture=new $s(this),this.bindVertexBuffer=new gm(this),this.bindElementBuffer=new ym(this),this.bindVertexArrayOES=new Ph(this),this.pixelStoreUnpack=new kh(this),this.pixelStoreUnpackPremultiplyAlpha=new vm(this),this.pixelStoreUnpackFlipY=new Bh(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,u){return new ts(this,t,n,u)}createVertexBuffer(t,n,u,p,g){return new Yd(this,t,n,u,p,g)}createRenderbuffer(t,n,u){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,n,u),this.bindRenderbuffer.set(null),g}createFramebuffer(t,n,u,p){return new Da(this,t,n,u,p)}clear({color:t,depth:n,stencil:u,colorMask:p}){const g=this.gl;let b=0;t&&(b|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),n!==void 0&&(b|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),u!==void 0&&(b|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),g.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bn(t.blendFunction,en.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Xs;function Bn(h,t,n,u,p,g,b){const I=h.context,L=I.gl,P=h.transform,k=h.getOrCreateProgram("collisionBox"),U=[];let j=0,$=0;for(let fe=0;fe<u.length;fe++){const we=u[fe],ye=t.getTile(we),ve=ye.getBucket(n);if(!ve)continue;const xe=ep(we,ve,P);let Se=xe;p[0]===0&&p[1]===0||(Se=h.translatePosMatrix(xe,ye,p,g));const Ce=b?ve.textCollisionBox:ve.iconCollisionBox,Ke=ve.collisionCircleArray;if(Ke.length>0){const Ge=r.ad.mat4.create(),ct=Se;r.ad.mat4.mul(Ge,ve.placementInvProjMatrix,P.glCoordMatrix),r.ad.mat4.mul(Ge,Ge,ve.placementViewportMatrix),U.push({circleArray:Ke,circleOffset:$,transform:ct,invTransform:Ge,projection:ve.getProjection()}),j+=Ke.length/4,$=j}Ce&&(h.terrain&&h.terrain.setupElevationDraw(ye,k),k.draw(h,L.LINES,mi.disabled,Ni.disabled,h.colorModeForRenderPass(),Ii.disabled,Vh(Se,P,ye,ve.getProjection()),n.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,null,P.zoom,null,[Ce.collisionVertexBuffer,Ce.collisionVertexBufferExt]))}if(!b||!U.length)return;const Q=h.getOrCreateProgram("collisionCircle"),W=new r.cW;W.resize(4*j),W._trim();let te=0;for(const fe of U)for(let we=0;we<fe.circleArray.length/4;we++){const ye=4*we,ve=fe.circleArray[ye+0],xe=fe.circleArray[ye+1],Se=fe.circleArray[ye+2],Ce=fe.circleArray[ye+3];W.emplace(te++,ve,xe,Se,Ce,0),W.emplace(te++,ve,xe,Se,Ce,1),W.emplace(te++,ve,xe,Se,Ce,2),W.emplace(te++,ve,xe,Se,Ce,3)}(!Xs||Xs.length<2*j)&&(Xs=function(fe){const we=2*fe,ye=new r.aV;ye.resize(we),ye._trim();for(let ve=0;ve<we;ve++){const xe=6*ve;ye.uint16[xe+0]=4*ve+0,ye.uint16[xe+1]=4*ve+1,ye.uint16[xe+2]=4*ve+2,ye.uint16[xe+3]=4*ve+2,ye.uint16[xe+4]=4*ve+3,ye.uint16[xe+5]=4*ve+0}return ye}(j));const ne=I.createIndexBuffer(Xs,!0),ce=I.createVertexBuffer(W,r.cX.members,!0);for(const fe of U){const we={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(me=P).getCameraToCenterDistance(fe.projection),u_viewport_size:[me.width,me.height]};Q.draw(h,L.TRIANGLES,mi.disabled,Ni.disabled,h.colorModeForRenderPass(),Ii.disabled,we,n.id,ce,ne,r.b8.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,P.zoom)}var me;ce.destroy(),ne.destroy()}const ir=r.ad.mat4.create();function Vr(h){const t=h._camera.getWorldToCamera(h.worldSize,1),n=r.ad.mat4.multiply([],t,h.globeMatrix);r.ad.mat4.invert(n,n);const u=[0,0,0],p=[0,1,0,0];return r.ad.vec4.transformMat4(p,p,n),u[0]=p[0],u[1]=p[1],u[2]=p[2],r.ad.vec3.normalize(u,u),u}function qh({width:h,height:t,anchor:n,textOffset:u,textScale:p},g){const{horizontalAlign:b,verticalAlign:I}=r.bD(n),L=-(b-.5)*h,P=-(I-.5)*t,k=r.bC(n,u);return new r.P((L/p+k[0])*g,(P/p+k[1])*g)}function za(h,t,n,u,p,g,b,I,L,P,k){const U=h.text.placedSymbolArray,j=h.text.dynamicLayoutVertexArray,$=h.icon.dynamicLayoutVertexArray,Q={},W=h.getProjection(),te=ys(I,W,g),ne=g.elevation,ce=W.upVectorScale(I.canonical,g.center.lat,g.worldSize).metersToTile;j.clear();for(let me=0;me<U.length;me++){const fe=U.get(me),{tileAnchorX:we,tileAnchorY:ye,numGlyphs:ve}=fe,xe=fe.hidden||!fe.crossTileID||h.allowVerticalPlacement&&!fe.placedOrientation?null:u[fe.crossTileID];if(xe){let Se=0,Ce=0,Ke=0;if(ne){const nt=ne?ne.getAtTileOffset(I,we,ye):0,[yt,et,gt]=W.upVector(I.canonical,we,ye);Se=nt*yt*ce,Ce=nt*et*ce,Ke=nt*gt*ce}let[Ge,ct,_t,Ct]=Ka(fe.projectedAnchorX+Se,fe.projectedAnchorY+Ce,fe.projectedAnchorZ+Ke,n?te:b);const Ve=Su(g.getCameraToCenterDistance(W),Ct);let ut=p.evaluateSizeForFeature(h.textSizeData,P,fe)*Ve/r.bw;n&&(ut*=h.tilePixelRatio/L);const Ne=qh(xe,ut);n?({x:Ge,y:ct,z:_t}=W.projectTilePoint(we+Ne.x,ye+Ne.y,I.canonical),[Ge,ct,_t]=Ka(Ge+Se,ct+Ce,_t+Ke,b)):(t&&Ne._rotate(-g.angle),Ge+=Ne.x,ct+=Ne.y,_t=0);const ht=h.allowVerticalPlacement&&fe.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let nt=0;nt<ve;nt++)r.bt(j,Ge,ct,_t,ht);k&&fe.associatedIconIndex>=0&&(Q[fe.associatedIconIndex]={x:Ge,y:ct,z:_t,angle:ht})}else Cs(ve,j)}if(k){$.clear();const me=h.icon.placedSymbolArray;for(let fe=0;fe<me.length;fe++){const we=me.get(fe),{numGlyphs:ye}=we,ve=Q[fe];if(we.hidden||!ve)Cs(ye,$);else{const{x:xe,y:Se,z:Ce,angle:Ke}=ve;for(let Ge=0;Ge<ye;Ge++)r.bt($,xe,Se,Ce,Ke)}}h.icon.dynamicLayoutVertexBuffer.updateData($)}h.text.dynamicLayoutVertexBuffer.updateData(j)}function Ln(h,t,n,u,p,g,b={}){const I=n.paint.get("icon-translate"),L=n.paint.get("text-translate"),P=n.paint.get("icon-translate-anchor"),k=n.paint.get("text-translate-anchor"),U=n.layout.get("icon-rotation-alignment"),j=n.layout.get("text-rotation-alignment"),$=n.layout.get("icon-pitch-alignment"),Q=n.layout.get("text-pitch-alignment"),W=n.layout.get("icon-keep-upright"),te=n.layout.get("text-keep-upright"),ne=n.paint.get("icon-color-saturation"),ce=n.paint.get("icon-color-contrast"),me=n.paint.get("icon-color-brightness-min"),fe=n.paint.get("icon-color-brightness-max"),we=n.layout.get("symbol-elevation-reference")==="sea",ye=h.context,ve=ye.gl,xe=h.transform,Se=U==="map",Ce=j==="map",Ke=$==="map",Ge=Q==="map",ct=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let _t=!1;const Ct=h.depthModeForSublayer(0,mi.ReadOnly),Ve=[r.av(xe.center.lng),r.aC(xe.center.lat)],ut=n.layout.get("text-variable-anchor"),Ne=xe.projection.name==="globe",ht=[],nt=[0,-1,0];for(const yt of u){const et=t.getTile(yt),gt=et.getBucket(n);if(!gt||gt.projection.name==="mercator"&&Ne||gt.fullyClipped)continue;const Vt=gt.projection.name==="globe",Ut=Vt?r.ag(xe.zoom):0,Gt=ys(yt,gt.getProjection(),xe),oi=xe.calculatePixelsToTileUnitsMatrix(et),Di=ut&&gt.hasTextData(),xi=gt.hasIconTextFit()&&Di&&gt.hasIconData(),Ri=gt.getProjection().createInversionMatrix(xe,yt.canonical),Ci=pn=>{xe.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||h.terrain)&&(pn.push("DEPTH_D24"),pn.push("DEPTH_OCCLUSION"))},on=()=>{const pn=Se&&n.layout.get("symbol-placement")!=="point",hn=[];Ci(hn);const hr=pn||xi,rr=n.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&Ke&&hn.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(hn.push("PROJECTION_GLOBE_VIEW"),hr&&hn.push("PROJECTED_POS_ON_VIEWPORT")),rr>0&&hn.push("ICON_TRANSITION"),gt.icon.zOffsetVertexBuffer&&hn.push("Z_OFFSET"),ne===0&&ce===0&&me===0&&fe===1||hn.push("COLOR_ADJUSTMENT"),gt.sdfIcons&&hn.push("RENDER_SDF");const Pn=gt.icon.programConfigurations.get(n.id),vr=h.getOrCreateProgram("symbol",{config:Pn,defines:hn}),fa=et.imageAtlasTexture?et.imageAtlasTexture.size:[0,0],pa=gt.iconSizeData,Ki=r.bp(pa,xe.zoom),Zn=Ke||xe.pitch!==0,mn=Hr(Gt,et.tileID.canonical,Ke,Se,xe,gt.getProjection(),oi),fn=pr(Gt,et.tileID.canonical,Ke,Se,xe,gt.getProjection(),oi),ea=h.translatePosMatrix(fn,et,I,P,!0),Qn=h.translatePosMatrix(Gt,et,I,P),Dr=hr?ir:mn,Ls=Se&&!Ke&&!pn;let ta=nt;!Ne&&!xe.mercatorFromTransition||Se||(ta=Vr(xe));const xr=Vt?ta:nt,$r=n.getColorAdjustmentMatrix(ne,ce,me,fe),Oa=Fl(pa.kind,Ki,Ls,Ke,h,Qn,Dr,ea,we,!1,fa,[0,0],!0,yt,Ut,Ve,Ri,xr,gt.getProjection(),$r,rr),ma=et.imageAtlasTexture?et.imageAtlasTexture:null,_o=n.layout.get("icon-size").constantOr(0)!==1||gt.iconsNeedLinear,eo=gt.sdfIcons||h.options.rotating||h.options.zooming||_o||Zn?ve.LINEAR:ve.NEAREST,jo=gt.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,Wc=h.terrain&&Ke&&pn?r.ad.mat4.invert(r.ad.mat4.create(),mn):ir;if(pn&&gt.icon){const nc=xe.elevation,Ha=nc?nc.getAtTileOffsetFunc(yt,xe.center.lat,xe.worldSize,gt.getProjection()):null,_f=Lr(Gt,et.tileID.canonical,Ke,Se,xe,gt.getProjection(),oi);wl(gt,Gt,h,!1,_f,fn,Ke,W,Ha,yt)}return{program:vr,buffers:gt.icon,uniformValues:Oa,atlasTexture:ma,atlasTextureIcon:null,atlasInterpolation:eo,atlasInterpolationIcon:null,isSDF:gt.sdfIcons,hasHalo:jo,tile:et,labelPlaneMatrixInv:Wc}},Sn=()=>{const pn=Ce&&n.layout.get("symbol-placement")!=="point",hn=[],hr=pn||ut||xi;h.terrainRenderModeElevated()&&Ge&&hn.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(hn.push("PROJECTION_GLOBE_VIEW"),hr&&hn.push("PROJECTED_POS_ON_VIEWPORT")),gt.text.zOffsetVertexBuffer&&hn.push("Z_OFFSET"),gt.iconsInText&&hn.push("RENDER_TEXT_AND_SYMBOL"),hn.push("RENDER_SDF"),Ci(hn);const rr=gt.text.programConfigurations.get(n.id),Pn=h.getOrCreateProgram("symbol",{config:rr,defines:hn});let vr,fa=[0,0],pa=null;const Ki=gt.textSizeData;gt.iconsInText&&(fa=et.imageAtlasTexture?et.imageAtlasTexture.size:[0,0],pa=et.imageAtlasTexture?et.imageAtlasTexture:null,vr=Ge||xe.pitch!==0||h.options.rotating||h.options.zooming||Ki.kind==="composite"||Ki.kind==="camera"?ve.LINEAR:ve.NEAREST);const Zn=et.glyphAtlasTexture?et.glyphAtlasTexture.size:[0,0],mn=n.layout.get("text-size-scale-range"),fn=r.ay(h.scaleFactor,mn[0],mn[1]),ea=r.bp(Ki,xe.zoom,fn),Qn=Hr(Gt,et.tileID.canonical,Ge,Ce,xe,gt.getProjection(),oi),Dr=pr(Gt,et.tileID.canonical,Ge,Ce,xe,gt.getProjection(),oi),Ls=h.translatePosMatrix(Dr,et,L,k,!0),ta=h.translatePosMatrix(Gt,et,L,k),xr=hr?ir:Qn,$r=Ce&&!Ge&&!pn;let Oa=nt;!Ne&&!xe.mercatorFromTransition||Ce||(Oa=Vr(xe));const ma=Fl(Ki.kind,ea,$r,Ge,h,ta,xr,Ls,we,!0,Zn,fa,!0,yt,Ut,Ve,Ri,Vt?Oa:nt,gt.getProjection(),null,null,fn),_o=et.glyphAtlasTexture?et.glyphAtlasTexture:null,eo=ve.LINEAR,jo=n.paint.get("text-halo-width").constantOr(1)!==0,Wc=h.terrain&&Ge&&pn?r.ad.mat4.invert(r.ad.mat4.create(),Qn):ir;if(pn&&gt.text){const nc=xe.elevation,Ha=nc?nc.getAtTileOffsetFunc(yt,xe.center.lat,xe.worldSize,gt.getProjection()):null,_f=Lr(Gt,et.tileID.canonical,Ge,Ce,xe,gt.getProjection(),oi);wl(gt,Gt,h,!0,_f,Dr,Ge,te,Ha,yt)}return{program:Pn,buffers:gt.text,uniformValues:ma,atlasTexture:_o,atlasTextureIcon:pa,atlasInterpolation:eo,atlasInterpolationIcon:vr,isSDF:!0,hasHalo:jo,tile:et,labelPlaneMatrixInv:Wc}},Gi=gt.icon.segments.get().length,Ti=gt.text.segments.get().length,Fi=Gi&&!b.onlyText?on():null,li=Ti&&!b.onlyIcons?Sn():null,jt=n.paint.get("icon-opacity").constantOr(1),Hi=n.paint.get("text-opacity").constantOr(1);if(ct&&gt.canOverlap){_t=!0;const pn=jt&&!b.onlyText?gt.icon.segments.get():[],hn=Hi&&!b.onlyIcons?gt.text.segments.get():[];for(const hr of pn)ht.push({segments:new r.b8([hr]),sortKey:hr.sortKey,state:Fi});for(const hr of hn)ht.push({segments:new r.b8([hr]),sortKey:hr.sortKey,state:li})}else b.onlyText||ht.push({segments:jt?gt.icon.segments:new r.b8([]),sortKey:0,state:Fi}),b.onlyIcons||ht.push({segments:Hi?gt.text.segments:new r.b8([]),sortKey:0,state:li})}_t&&ht.sort((yt,et)=>yt.sortKey-et.sortKey);for(const yt of ht){const et=yt.state;if(et)if(h.terrain?h.terrain.setupElevationDraw(et.tile,et.program,{useDepthForOcclusion:xe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:et.labelPlaneMatrixInv}):h.setupDepthForOcclusion(xe.depthOcclusionForSymbolsAndCircles,et.program),ye.activeTexture.set(ve.TEXTURE0),et.atlasTexture&&et.atlasTexture.bind(et.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),et.atlasTextureIcon&&(ye.activeTexture.set(ve.TEXTURE1),et.atlasTextureIcon&&et.atlasTextureIcon.bind(et.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,et.program),et.hasHalo){const gt=et.uniformValues;gt.u_is_halo=1,sl(et.buffers,yt.segments,n,h,et.program,Ct,p,g,gt,2),gt.u_is_halo=0}else{if(et.isSDF){const gt=et.uniformValues;et.hasHalo&&(gt.u_is_halo=1,sl(et.buffers,yt.segments,n,h,et.program,Ct,p,g,gt,1)),gt.u_is_halo=0}sl(et.buffers,yt.segments,n,h,et.program,Ct,p,g,et.uniformValues,1)}}}function sl(h,t,n,u,p,g,b,I,L,P){const k=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,g,b,I,Ii.disabled,L,n.id,h.layoutVertexBuffer,h.indexBuffer,t,n.paint,u.transform.zoom,h.programConfigurations.get(n.id),k,P)}function Nc(h,t){const n=1<<h.canonical.z,u=(t.x*n-h.canonical.x-h.wrap*n)*r.ai,p=(t.y*n-h.canonical.y)*r.ai,g=r.d5(t.z,t.y);return r.ad.vec3.fromValues(u,p,g)}function Ul(h,t,n,u,p){if(!n.layout||n.layout.get("fill-elevation-reference")==="none")return;const g=h.context.gl,b=new mi(h.context.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D),I=new mi(h.context.gl.GREATER,mi.ReadWrite,h.depthRangeFor3D),L=function($){const Q=r.c4($.pitch);let W=.01;return $.isOrthographic&&(W=r.ah(1e-4,W,r.c9(Q>=Bt?1:Q/Bt))),2*W}(h.transform),P=h.transform.getFreeCameraOptions().position,k="elevatedStructuresDepthReconstruct",U=h.getOrCreateProgram(k,{defines:["DEPTH_RECONSTRUCTION"]}),j=h.getOrCreateProgram(k);for(const $ of u){const Q=t.getTile($),W=Q.getBucket(n);if(!W)continue;const te=W.elevatedStructures;if(!te)continue;const ne=W.elevationBufferData.heightRange,ce=Nc($.toUnwrapped(),P),me=h.translatePosMatrix($.projMatrix,Q,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));let fe,we,ye,ve;if(p==="initialize"){if(!ne||ne.min>=1||te.depthSegments.segments[0].primitiveLength===0)continue;fe=ku(me,ce,L,1,0),we=b,ye=te.depthSegments,ve=U}else if(p==="reset"){if(!ne||ne.min>=0||te.maskSegments.segments[0].primitiveLength===0)continue;fe=ku(me,ce,0,0,1),we=I,ye=te.maskSegments,ve=U}else if(p==="geometry"){if(te.depthSegments.segments[0].primitiveLength===0)continue;fe=ku(me,ce,L,1,0),we=b,ye=te.depthSegments,ve=j}ve.draw(h,g.TRIANGLES,we,Ni.disabled,en.disabled,Ii.disabled,fe,n.id,te.vertexBuffer,te.indexBuffer,ye,n.paint,h.transform.zoom)}}function Wd(h,t,n){const{painter:u,sourceCache:p,layer:g,coords:b,colorMode:I,elevationType:L,terrainEnabled:P,pass:k}=h,U=u.context.gl,j=g.paint.get("fill-pattern");let $=L;L!=="road"||t&&!P||($="none");const Q=$==="road",W=new mi(u.context.gl.LEQUAL,mi.ReadWrite,u.depthRangeFor3D),te=j&&j.constantOr(1),ne=(ce,me)=>{let fe,we,ye,ve,xe;me?(we=te&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",fe=U.LINES):(we=te?"fillPattern":"fill",fe=U.TRIANGLES);for(const Se of b){const Ce=p.getTile(Se);if(te&&!Ce.patternsLoaded())continue;const Ke=Ce.getBucket(g);if(!Ke)continue;const Ge=t?Ke.elevationBufferData:Ke.bufferData;if(Ge.isEmpty())continue;u.prepareDrawTile();const ct=Ge.programConfigurations.get(g.id),_t=u.isTileAffectedByFog(Se),Ct=[],Ve=[];Q&&(Ct.push("ELEVATED_ROADS"),Ve.push(Ge.elevatedLayoutVertexBuffer));const ut=u.getOrCreateProgram(we,{config:ct,overrideFog:_t,defines:Ct});te&&(u.context.activeTexture.set(U.TEXTURE0),Ce.imageAtlasTexture&&Ce.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),ct.updatePaintBuffers());const Ne=j.constantOr(null);if(Ne&&Ce.imageAtlas){const yt=Ce.imageAtlas,et=r.d0.from(Ne).getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),gt=yt.patternPositions.get(et);gt&&ct.setConstantPatternPositions(gt)}const ht=u.translatePosMatrix(Se.projMatrix,Ce,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor")),nt=g.paint.get("fill-emissive-strength");if(me){ve=Ge.lineIndexBuffer,xe=Ge.lineSegments;const yt=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];ye=we==="fillOutlinePattern"&&te?Bl(ht,nt,u,Ce,yt):Fh(ht,nt,yt)}else ve=Ge.indexBuffer,xe=Ge.triangleSegments,ye=te?Pu(ht,nt,u,Ce):kl(ht,nt);u.uploadCommonUniforms(u.context,ut,Se.toUnwrapped()),ut.draw(u,fe,$!=="none"?W:ce,n||u.stencilModeForClipping(Se),I,Ii.disabled,ye,g.id,Ge.layoutVertexBuffer,ve,xe,g.paint,u.transform.zoom,ct,Ve)}};u.renderPass===k&&ne(u.depthModeForSublayer(1,u.renderPass==="opaque"?mi.ReadWrite:mi.ReadOnly),!1),$==="none"&&u.renderPass==="translucent"&&g.paint.get("fill-antialias")&&ne(u.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,mi.ReadOnly),!0)}function Rr(h,t,n,u,p,g,b,I){n.resetLayerRenderingStats(h);const L=h.context,P=L.gl,k=h.transform,U=n.paint.get("fill-extrusion-pattern"),j=U.constantOr(1),$=n.paint.get("fill-extrusion-opacity"),Q=h.style.enable3dLights(),W=n.paint.get(Q&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),te=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),W],ne=n.layout.get("fill-extrusion-edge-radius"),ce=ne>0&&!n.paint.get("fill-extrusion-rounded-roof"),me=ce?0:ne,fe=k.projection.name==="globe"?r.d6():0,we=k.projection.name==="globe",ye=we?r.ag(k.zoom):0,ve=[r.av(k.center.lng),r.aC(k.center.lat)],xe=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Se=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(xe?null:n.lut).toArray01().slice(0,3),Ce=n.paint.get("fill-extrusion-flood-light-intensity"),Ke=n.paint.get("fill-extrusion-vertical-scale"),Ge=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ct=n.paint.get("fill-extrusion-height-alignment"),_t=n.paint.get("fill-extrusion-base-alignment"),Ct=Wo(h,n.paint.get("fill-extrusion-cutoff-fade-range")),Ve=[];let ut;we&&Ve.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&Ve.push("FAUX_AO"),ce&&Ve.push("ZERO_ROOF_RADIUS"),I&&Ve.push("HAS_CENTROID"),Ce>0&&Ve.push("FLOOD_LIGHT"),Ct.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),Ge&&Ve.push("RENDER_WALL_MODE");const Ne=h.renderPass==="shadow",ht=h.shadowRenderer,nt=Ne&&!!ht;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let yt=[0,0,0];if(ht){const Vt=h.style.directionalLight,Ut=h.style.ambientLight;Vt&&Ut&&(yt=bc(h.style,Vt,Ut)),Ne||(Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ht.useNormalOffset&&Ve.push("NORMAL_OFFSET")),ut=Ve.concat(["SHADOWS_SINGLE_CASCADE"])}const et=nt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",gt=n.getLayerRenderingStats();for(const Vt of u){const Ut=t.getTile(Vt),Gt=Ut.getBucket(n);if(!Gt||Gt.projection.name!==k.projection.name)continue;let oi=!1;ht&&(oi=ht.getMaxCascadeForTile(Vt.toUnwrapped())===0);const Di=h.isTileAffectedByFog(Vt),xi=Gt.programConfigurations.get(n.id),Ri=h.getOrCreateProgram(et,{config:xi,defines:oi?ut:Ve,overrideFog:Di});if(h.terrain&&h.terrain.setupElevationDraw(Ut,Ri,{useMeterToDem:!0}),!Gt.centroidVertexBuffer){const li=Ri.attributes.a_centroid_pos;li!==void 0&&P.vertexAttrib2f(li,0,0)}!Ne&&ht&&ht.setupShadows(Ut.tileID.toUnwrapped(),Ri,"vector-tile",Ut.tileID.overscaledZ),j&&(h.context.activeTexture.set(P.TEXTURE0),Ut.imageAtlasTexture&&Ut.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),xi.updatePaintBuffers());const Ci=U.constantOr(null);if(Ci&&Ut.imageAtlas){const li=Ut.imageAtlas,jt=r.d0.from(Ci).getPrimary().scaleSelf(r.q.devicePixelRatio),Hi=li.patternPositions.get(jt.toString());Hi&&xi.setConstantPatternPositions(Hi)}const on=n.paint.get("fill-extrusion-vertical-gradient"),Sn=1/Gt.tileToMeter;let Gi;if(Ne&&ht){if(Gl(Ut.tileID,Gt,h))continue;const li=ht.calculateShadowPassMatrixFromTile(Ut.tileID.toUnwrapped());Gi=Lc(li,me,Sn,Ke,ct,_t)}else{const li=h.translatePosMatrix(Vt.expandedProjMatrix,Ut,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),jt=k.projection.createInversionMatrix(k,Vt.canonical);Gi=j?nl(li,h,on,$,te,me,Sn,Vt,Ut,fe,ct,_t,ye,ve,jt,Se,Ke):Gd(li,h,on,$,te,me,Sn,Vt,fe,ct,_t,ye,ve,jt,Se,Ke,Ce,yt)}h.uploadCommonUniforms(L,Ri,Vt.toUnwrapped(),null,Ct);let Ti=Gt.segments;if(k.projection.name==="mercator"&&!Ne&&(Ti=Gt.getVisibleSegments(Ut.tileID,h.terrain,h.transform.getFrustum(0)),!Ti.get().length))continue;if(gt)if(Ne)for(const li of Ti.get())gt.numRenderedVerticesInShadowPass+=li.primitiveLength;else for(const li of Ti.get())gt.numRenderedVerticesInTransparentPass+=li.primitiveLength;const Fi=[];(h.terrain||I)&&Fi.push(Gt.centroidVertexBuffer),we&&Fi.push(Gt.layoutVertexExtBuffer),Ge&&Fi.push(Gt.wallVertexBuffer),Ri.draw(h,L.gl.TRIANGLES,p,g,b,Ii.backCCW,Gi,n.id,Gt.layoutVertexBuffer,Gt.indexBuffer,Ti,n.paint,h.transform.zoom,xi,Fi)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function jl(h,t,n,u,p,g,b,I,L,P,k,U,j,$,Q,W,te,ne,ce){const me=h.context,fe=me.gl,we=h.transform,ye=h.transform.zoom,ve=[],xe=Wo(h,n.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(ve.push("CLEAR_SUBPASS"),ce&&(ve.push("CLEAR_FROM_TEXTURE"),me.activeTexture.set(fe.TEXTURE0),ce.bind(fe.LINEAR,fe.CLAMP_TO_EDGE))):P==="sdf"&&ve.push("SDF_SUBPASS"),te&&ve.push("HAS_CENTROID"),xe.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const Se=n.layout.get("fill-extrusion-edge-radius"),Ce=(Ke,Ge,ct,_t,Ct)=>{const Ve=Ge.programConfigurations.get(n.id),ut=h.isTileAffectedByFog(Ke),Ne=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ve,defines:ve,overrideFog:ut}),ht=((yt,et,gt,Vt,Ut,Gt,oi,Di,xi,Ri,Ci)=>({u_matrix:et,u_opacity:gt,u_ao_pass:Vt?1:0,u_meter_to_tile:Ut,u_ao:Gt,u_flood_light_intensity:oi,u_flood_light_color:Di,u_attenuation:xi,u_edge_radius:Ri,u_fb:0,u_fb_size:Ci,u_dynamic_offset:1}))(0,_t,k,L,Ct,[U,j*Ct],$,Q,W,ye>=17?0:Se*Ct,ce?ce.size[0]:0),nt=[];te&&nt.push(Ge.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(me,Ne,Ke.toUnwrapped(),null,xe),Ne.draw(h,me.gl.TRIANGLES,p,g,b,I,ht,n.id,Ge.vertexBuffer,Ge.indexBuffer,ct,n.paint,ye,Ve,nt)};for(const Ke of u){const Ge=t.getTile(Ke),ct=Ge.getBucket(n);if(!ct||ct.projection.name!==we.projection.name||!ct.groundEffect||ct.groundEffect&&!ct.groundEffect.hasData())continue;const _t=ct.groundEffect,Ct=1/ct.tileToMeter;{const Ve=h.translatePosMatrix(Ke.projMatrix,Ge,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ut=_t.getDefaultSegment();Ce(Ke,_t,ut,Ve,Ct)}if(ne)for(let Ve=0;Ve<4;Ve++){const ut=r.d7[Ve](Ke),Ne=t.getTile(ut);if(!Ne)continue;const ht=Ne.getBucket(n);if(!ht||ht.projection.name!==we.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const nt=ht.groundEffect;let yt,et;Ve===0?(yt=[-r.ai,0,0],et=1):Ve===1?(yt=[r.ai,0,0],et=0):Ve===2?(yt=[0,-r.ai,0],et=3):(yt=[0,r.ai,0],et=2);const gt=nt.regionSegments[et];if(!gt)continue;const Vt=new Float32Array(16);r.ad.mat4.translate(Vt,Ke.projMatrix,yt),Ce(Ke,nt,gt,h.translatePosMatrix(Vt,Ge,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Ct)}}}function ql(h,t,n,u,p,g,b){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const I=g?g.findDEMTileFor(n):null;if(!(I&&I.dem||b))return;g&&I&&I.dem&&u.selfDEMTileTimestamp!==I.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=I.dem._timestamp);const L=ne=>new r.P(Math.ceil((ne+r.da)*r.db),0),P=ne=>{const ce=t.getSource().minzoom,me=we=>{const ye=t.getTileByID(we);if(ye&&ye.hasData())return ye.getBucket(p)},fe=[0,-1,1];for(const we of fe){if(ne.overscaledZ+we<ce)continue;const ye=me(ne.calculateScaledKey(ne.overscaledZ+we));if(ye)return ye}},k=[0,0,0],U=(ne,ce)=>(k[0]=Math.min(ne.min.y,ce.min.y),k[1]=Math.max(ne.max.y,ce.max.y),k[2]=r.ai-ce.min.x>ne.max.x?ce.min.x-r.ai:ne.max.x,k),j=(ne,ce)=>(k[0]=Math.min(ne.min.x,ce.min.x),k[1]=Math.max(ne.max.x,ce.max.x),k[2]=r.ai-ce.min.y>ne.max.y?ce.min.y-r.ai:ne.max.y,k),$=[(ne,ce)=>U(ne,ce),(ne,ce)=>U(ce,ne),(ne,ce)=>j(ne,ce),(ne,ce)=>j(ce,ne)],Q=(ne,ce,me,fe,we,ye,ve)=>{if(!g)return 0;const xe=[[ye?me:ne,ye?ne:me,0],[ye?me:ce,ye?ce:me,0]],Se=ve<0?r.ai+ve:ve,Ce=[ye?Se:(ne+ce)/2,ye?(ne+ce)/2:Se,0];return me===0&&ve<0||me!==0&&ve>0?g.getForTilePoints(we,[Ce],!0,fe):xe.push(Ce),g.getForTilePoints(n,xe,!0,I),Math.max(xe[0][2],xe[1][2],Ce[2])/g.exaggeration()};for(let ne=0;ne<4;ne++){const ce=u.borderFeatureIndices[ne];if(ce.length===0)continue;const me=r.d7[ne](n),fe=P(me);if(!(fe&&fe instanceof r.d8))continue;const we=g?g.findDEMTileFor(me):null;if(!(we&&we.dem||b)||(g&&we&&we.dem&&u.borderDEMTileTimestamp[ne]!==we.dem._timestamp&&(u.borderDoneWithNeighborZ[ne]=-1,u.borderDEMTileTimestamp[ne]=we.dem._timestamp),u.borderDoneWithNeighborZ[ne]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const ye=(ne<2?1:5)-ne,ve=fe.borderDoneWithNeighborZ[ye]!==u.canonical.z,xe=fe.borderFeatureIndices[ye];let Se=0;if(u.canonical.z!==fe.canonical.z){for(const Ce of ce)u.showCentroid(u.featuresOnBorder[Ce]);if(ve)for(const Ce of xe)fe.showCentroid(fe.featuresOnBorder[Ce]);u.borderDoneWithNeighborZ[ne]=fe.canonical.z,fe.borderDoneWithNeighborZ[ye]=u.canonical.z}for(const Ce of ce){const Ke=u.featuresOnBorder[Ce],Ge=u.centroidData[Ke.centroidDataIndex],ct=Ke.borders[ne];let _t;for(;Se<xe.length;){_t=fe.featuresOnBorder[xe[Se]];const Ct=_t.borders[ye];if(Ct[1]>ct[0]+3||Ct[0]>ct[0]-3)break;fe.showCentroid(_t),Se++}if(_t&&Se<xe.length){const Ct=Se;let Ve=0;for(;!(_t.borders[ye][0]>ct[1]-3)&&(Ve++,++Se!==xe.length);)_t=fe.featuresOnBorder[xe[Se]];_t=fe.featuresOnBorder[xe[Ct]];let ut=!1;if(Ve>=1){const nt=_t.borders[ye];Math.abs(ct[0]-nt[0])<3&&Math.abs(ct[1]-nt[1])<3&&(Ve=1,ut=!0,Se=Ct+1)}else if(Ve===0){u.showCentroid(Ke);continue}const Ne=fe.centroidData[_t.centroidDataIndex];b&&ut&&(((W=Ge).flags|(te=Ne).flags)&r.d9?(W.flags|=r.d9,te.flags|=r.d9):(W.flags&=~r.d9,te.flags&=~r.d9));const ht=Ke.intersectsCount()>1||_t.intersectsCount()>1;if(Ve>1)Se=Ct,Ge.centroidXY=Ne.centroidXY=new r.P(0,0);else if(we&&we.dem&&!ht){const nt=$[ne](Ge,Ne),yt=ne%2?r.ai-1:0,et=Q(nt[0],Math.min(r.ai-1,nt[1]),yt,we,me,ne<2,nt[2]);Ge.centroidXY=Ne.centroidXY=L(et)}else ht?Ge.centroidXY=Ne.centroidXY=new r.P(0,0):(Ge.centroidXY=u.encodeBorderCentroid(Ke),Ne.centroidXY=fe.encodeBorderCentroid(_t));u.writeCentroidToBuffer(Ge),fe.writeCentroidToBuffer(Ne)}else u.showCentroid(Ke)}u.borderDoneWithNeighborZ[ne]=fe.canonical.z,fe.borderDoneWithNeighborZ[ye]=u.canonical.z}var W,te;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(h)}const Fc=[1,0,0],Pt=[0,1,0],Kt=[0,0,1];function Gl(h,t,n){const u=n.transform,p=n.shadowRenderer;if(!p)return!0;const g=h.toUnwrapped(),b=u.tileSize*p._cascades[n.currentShadowCascade].scale;let I=t.maxHeight;if(u.elevation){const W=u.elevation.getMinMaxForTile(h);W&&(I+=W.max)}const L=[...p.shadowDirection];L[2]=-L[2];const P=p.computeSimplifiedTileShadowVolume(g,I,b,L);if(!P)return!1;const k=[Fc,Pt,Kt,L,[L[0],0,L[2]],[0,L[1],L[2]]],U=u.projection.name==="globe",j=u.scaleZoom(b),$=r.bR.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,j,!U),Q=p.getCurrentCascadeFrustum();return $.intersectsPrecise(P.vertices,P.planes,k)===0||Q.intersectsPrecise(P.vertices,P.planes,k)===0}function lr(h){return[h[0]*r.dc,h[1]*r.dc,h[2]*r.dc,0]}function $e(h,t,n,u,p,g,b,I,L){const P=u.getSource(),k=n.globeSharedBuffers;if(!k)return;let U,j,$;if(t&&(U=u.getTile(t)),P instanceof r.aK?(j=P.texture,$=r.cJ(0,0,n.transform)):U&&t&&(j=U.texture,$=r.cJ(t.canonical.z,t.canonical.x,n.transform)),!j||!$)return;h||($=r.ad.mat4.scale(r.ad.mat4.create(),$,[1,-1,1]));const Q=n.context,W=Q.gl,te=p.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,ne=n.colorModeForDrapableLayerRenderPass(g),ce=b.defines;ce.push("GLOBE_POLES");const me=new mi(W.LEQUAL,mi.ReadWrite,n.depthRangeFor3D),fe=Float32Array.from(n.transform.expandedFarZProjMatrix),we=Float32Array.from(r.bc(r.cI(new r.bT(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),Q.activeTexture.set(W.TEXTURE0),j.bind(te,W.CLAMP_TO_EDGE),Q.activeTexture.set(W.TEXTURE1),j.bind(te,W.CLAMP_TO_EDGE),"useMipmap"in j&&Q.extTextureFilterAnisotropic&&n.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);const[ye,ve,xe,Se]=t?k.getPoleBuffers(t.canonical.z,!1):k.getPoleBuffers(0,!0),Ce=p.paint.get("raster-elevation");let Ke;h?(Ke=ye,n.renderDefaultNorthPole=Ce!==0):(Ke=ve,n.renderDefaultSouthPole=Ce!==0);const Ge=lr(b.mix),ct=((Ct,Ve,ut,Ne,ht,nt,yt,et,gt,Vt,Ut,Gt,oi)=>Zd(Ct,Ve,ut,new Float32Array(16),new Float32Array(9),[0,0],Ne,[0,0],[0,0,0,0],1,{opacity:1,mix:0},nt,[0,0],et,2,Vt,Ut,Gt,1,0,oi))(fe,we,$,r.ag(n.transform.zoom),0,p,0,Ce,0,Ge,b.offset,b.range,g),_t=n.getOrCreateProgram("raster",{defines:ce});n.uploadCommonUniforms(Q,_t,null),_t.draw(n,W.TRIANGLES,me,L,ne,I,ct,p.id,Ke,xe,Se)}function is(h){const t=h._nearZ,n=h.projection.farthestPixelDistance(h),u=n-t,p=.2*h.height,g=t+p;return[t,n,(g-p-t)/u,(g-t)/u]}function Ur(h,t,n,u){if(h)return t instanceof Mo&&h instanceof Ia?t.getTextureDescriptor(h,n,!0):{texture:h.texture,mix:lr(u.mix),offset:u.offset,buffer:0,tileSize:1}}var Gh=r.dd([{name:"a_index",type:"Int16",components:1}]);class Vc{constructor(t,n,u,p){const g={width:u[0],height:u[1],data:null},b=t.gl;this.targetColorTexture=new r.T(t,g,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,g,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,p),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=n.width*n.height;this.particleTexture0=new r.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1});const g=new r.de;g.reserve(p);for(let b=0;b<p;b++)g.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(g,Gh.members,!0),this.particleSegment=r.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Hh(h,t,n){if(!h)return null;const u=t.getTextureDescriptor(h,n,!0);if(!u)return null;let{texture:p,mix:g,offset:b,tileSize:I,buffer:L,format:P}=u;if(!p||!P)return null;let k=!1;return P==="uint32"&&(k=!0,g[3]=0,g=Wt(r.df,g,[0,n.paint.get("raster-particle-max-speed")]),b=kc(r.df,b,[0,n.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[L/(I+2*L),I/(I+2*L)],tileSize:I,scalarData:k,scale:g,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function Kd(h){const t=h._nearZ,n=h.projection.farthestPixelDistance(h),u=n-t,p=.2*h.height,g=t+p;return[t,n,(g-p-t)/u,(g-t)/u]}const vs=new r.al(1,0,0,1),Jd=new r.al(0,1,0,1),cp=new r.al(0,0,1,1),Qd=new r.al(1,0,1,1),Zh=new r.al(0,1,1,1);function ol(h,t,n,u,p,g,b){const I=h.context,L=h.transform,P=I.gl,k=L.projection.name==="globe",U=k?["PROJECTION_GLOBE_VIEW"]:[];let j=r.ad.mat4.clone(n.projMatrix);if(k&&r.ag(L.zoom)>0){const Ge=r.bb(n.canonical,L),ct=r.dg(Ge);j=r.ad.mat4.multiply(new Float32Array(16),L.globeMatrix,ct),r.ad.mat4.multiply(j,L.projMatrix,j)}const $=r.ad.mat4.create();$[12]+=2*p/(r.q.devicePixelRatio*L.width),$[13]+=2*g/(r.q.devicePixelRatio*L.height),r.ad.mat4.multiply(j,$,j);const Q=h.getOrCreateProgram("debug",{defines:U}),W=t.getTileByID(n.key);h.terrain&&h.terrain.setupElevationDraw(W,Q);const te=mi.disabled,ne=Ni.disabled,ce=h.colorModeForRenderPass(),me="$debug";I.activeTexture.set(P.TEXTURE0),h.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),k?W._makeGlobeTileDebugBuffers(h.context,L):W._makeDebugTileBoundsBuffers(h.context,L.projection);const fe=W._tileDebugBuffer||h.debugBuffer,we=W._tileDebugIndexBuffer||h.debugIndexBuffer,ye=W._tileDebugSegments||h.debugSegments;if(Q.draw(h,P.LINE_STRIP,te,ne,ce,Ii.disabled,Hd(j,u),me,fe,we,ye,null,null,null,[W._globeTileDebugBorderBuffer]),b){const Ge=W.latestRawTileData,ct=Math.floor((Ge&&Ge.byteLength||0)/1024);let _t=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(_t+=` => ${n.overscaledZ}`),_t+=` ${W.state}`,_t+=` ${ct}kb`,function(Ct,Ve){Ct.initDebugOverlayCanvas();const ut=Ct.debugOverlayCanvas,Ne=Ct.context.gl,ht=Ct.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,ut.width,ut.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(Ve,5,5),ht.strokeText(Ve,5,5),Ct.debugOverlayTexture.update(ut),Ct.debugOverlayTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}(h,_t)}const ve=t.getTile(n).tileSize,xe=512/Math.min(ve,512)*(n.overscaledZ/L.zoom)*.5,Se=W._tileDebugTextBuffer||h.debugBuffer,Ce=W._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Ke=W._tileDebugTextSegments||h.debugSegments;Q.draw(h,P.TRIANGLES,te,ne,en.alphaBlended,Ii.disabled,Hd(j,r.al.transparent,xe),me,Se,Ce,Ke,null,null,null,[W._globeTileDebugTextBuffer])}function ef(h,t,n,u){Hl(h,0,t+n/2,h.transform.width,n,u)}function tf(h,t,n,u){Hl(h,t-n/2,0,n,h.transform.height,u)}function Hl(h,t,n,u,p,g){const b=h.context,I=b.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*r.q.devicePixelRatio,n*r.q.devicePixelRatio,u*r.q.devicePixelRatio,p*r.q.devicePixelRatio),b.clear({color:g}),I.disable(I.SCISSOR_TEST)}const $h=r.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zl}=$h;function ko(h,t,n,u){h.emplaceBack(t,n,u)}class bm{constructor(t){this.vertexArray=new r.dh,this.indices=new r.aV,ko(this.vertexArray,-1,-1,1),ko(this.vertexArray,1,-1,1),ko(this.vertexArray,-1,1,1),ko(this.vertexArray,1,1,1),ko(this.vertexArray,-1,-1,-1),ko(this.vertexArray,1,-1,-1),ko(this.vertexArray,-1,1,-1),ko(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Zl),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.b8.simpleSegment(0,0,36,12)}}function Jr(h,t,n,u,p,g){const b=h.context.gl,I=t.paint.get("sky-atmosphere-color"),L=t.paint.get("sky-atmosphere-halo-color"),P=t.paint.get("sky-atmosphere-sun-intensity"),k=((U,j,$,Q,W)=>({u_matrix_3f:U,u_sun_direction:j,u_sun_intensity:$,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(r.ad.mat3.fromMat4(r.ad.mat3.create(),u),p,P,I,L);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),n.draw(h,b.TRIANGLES,mi.disabled,Ni.disabled,en.unblended,Ii.frontCW,k,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const wm=r.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Nu{constructor(t){const n=new r.di;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const u=new r.aV;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,wm.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=r.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Hn=r.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class wn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class up{constructor(t){this.colorModeAlphaBlendedWriteRGB=new en([1,Is,1,Is],r.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new en([1,0,1,0],r.al.transparent,[!1,!1,!1,!0]),this.params=new wn,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Nu(n);const u=this.params.sizeRange,p=this.params.intensityRange,g=function(k){const U=r.dl(30),j=[];for(let $=0;$<k;++$){const Q=2*Math.PI*U(),W=Math.acos(1-2*U())-.5*Math.PI;j.push(r.ad.vec3.fromValues(Math.cos(W)*Math.cos(Q),Math.cos(W)*Math.sin(Q),Math.sin(W)))}return j}(this.params.starsCount),b=r.dl(300),I=new r.dj,L=new r.aV;let P=0;for(let k=0;k<g.length;++k){const U=r.ad.vec3.scale([],g[k],200),j=Math.max(0,1+.01*u*(1*b()-.5)),$=Math.max(0,1+.01*p*(1*b()-.5));I.emplaceBack(U[0],U[1],U[2],-1,-1,j,$),I.emplaceBack(U[0],U[1],U[2],1,-1,j,$),I.emplaceBack(U[0],U[1],U[2],1,1,j,$),I.emplaceBack(U[0],U[1],U[2],-1,1,j,$),L.emplaceBack(P+0,P+1,P+2),L.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=n.createVertexBuffer(I,Hn.members),this.starsIdx=n.createIndexBuffer(L),this.starsSegments=r.b8.simpleSegment(0,0,I.length,L.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const u=t.context,p=u.gl,g=t.transform,b=new mi(p.LEQUAL,mi.ReadOnly,[0,1]),I=r.ag(g.zoom),L=t.style.getLut(n.scope),P=n.properties.get("color-use-theme")==="none",k=n.properties.get("color").toRenderColor(P?null:L).toArray01(),U=n.properties.get("high-color-use-theme")==="none",j=n.properties.get("high-color").toRenderColor(U?null:L).toArray01(),$=n.properties.get("space-color-use-theme")==="none",Q=n.properties.get("space-color").toRenderColor($?null:L).toArray01PremultipliedAlpha(),W=5e-4,te=r.dk(n.properties.get("horizon-blend"),0,1,W,.25),ne=r.cD(t,u,g)&&te===W?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,ce=t.frameCounter/1e3%1,me=r.ad.vec3.length(g.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(me,2)-Math.pow(ne,2)),we=Math.acos(fe/me),ye=ve=>{const xe=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&xe.push("ALPHA_PASS");const Se=t.getOrCreateProgram("globeAtmosphere",{defines:xe}),Ce=((Ge,ct,_t,Ct,Ve,ut,Ne,ht,nt,yt,et,gt)=>({u_frustum_tl:Ge,u_frustum_tr:ct,u_frustum_br:_t,u_frustum_bl:Ct,u_horizon:Ve,u_transition:ut,u_fadeout_range:Ne,u_color:ht,u_high_color:nt,u_space_color:yt,u_temporal_offset:et,u_horizon_angle:gt}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,I,te,k,j,Q,ce,we);t.uploadCommonUniforms(u,Se);const Ke=this.atmosphereBuffer;Ke&&Se.draw(t,p.TRIANGLES,b,Ni.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ii.backCW,Ce,ve?"atmosphere_glow_alpha":"atmosphere_glow",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)};ye(!1),ye(!0)}drawStars(t,n){const u=r.ay(n.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,g=p.gl,b=t.transform,I=t.getOrCreateProgram("stars"),L=r.ad.quat.identity([]);r.ad.quat.rotateX(L,L,-b._pitch),r.ad.quat.rotateZ(L,L,-b.angle),r.ad.quat.rotateX(L,L,r.ak(b._center.lat)),r.ad.quat.rotateY(L,L,-r.ak(b._center.lng));const P=r.ad.mat4.fromQuat(new Float32Array(16),L),k=r.ad.mat4.multiply([],b.starsProjMatrix,P),U=r.ad.mat3.fromMat4([],P),j=r.ad.mat3.invert([],U),$=[0,1,0];r.ad.vec3.transformMat3($,$,j),r.ad.vec3.scale($,$,this.params.sizeMultiplier);const Q=[1,0,0];r.ad.vec3.transformMat3(Q,Q,j),r.ad.vec3.scale(Q,Q,this.params.sizeMultiplier);const W=(te=$,ne=Q,ce=u,{u_matrix:Float32Array.from(k),u_up:te,u_right:ne,u_intensity_multiplier:ce});var te,ne,ce;t.uploadCommonUniforms(p,I),this.starsVx&&this.starsIdx&&I.draw(t,g.TRIANGLES,mi.disabled,Ni.disabled,this.colorModeAlphaBlendedWriteRGB,Ii.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Bo(h,t){const n=[...h],u=t.cameraWorldSizeForFog/t.worldSize,p=r.ad.mat4.identity([]);return r.ad.mat4.scale(p,p,[u,u,1]),r.ad.mat4.multiply(n,p,n),r.ad.mat4.multiply(n,t.worldToFogMatrix,n),n}function Uc(h,t,n,u,p){const g=n.material,b=u.context,{baseColorTexture:I,metallicRoughnessTexture:L}=g.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:k,emissionTexture:U}=g;function j(Q,W,te){if(Q&&(h.push(W),b.activeTexture.set(b.gl.TEXTURE0+te),Q.gfxTexture)){const{minFilter:ne,magFilter:ce,wrapS:me,wrapT:fe}=Q.sampler;Q.gfxTexture.bindExtraParam(ne,ce,me,fe)}}j(I,"HAS_TEXTURE_u_baseColorTexture",mr.BaseColor),j(L,"HAS_TEXTURE_u_metallicRoughnessTexture",mr.MetallicRoughness),j(P,"HAS_TEXTURE_u_normalTexture",mr.Normal),j(k,"HAS_TEXTURE_u_occlusionTexture",mr.Occlusion),j(U,"HAS_TEXTURE_u_emissionTexture",mr.Emission),p&&(p.texture||(p.texture=new r.dn(u.context,p.image,[p.image.height,p.image.height,p.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+mr.LUT),p.texture&&p.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(h.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||h.push("DIFFUSE_SHADED");const $=u.shadowRenderer;$&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&h.push("NORMAL_OFFSET"))}function No(h,t,n,u,p,g){const b=n.paint.get("model-opacity").constantOr(1),I=t.context,L=new mi(t.context.gl.LEQUAL,mi.ReadWrite,t.depthRangeFor3D),P=t.transform,k=h.mesh,U=k.material,j=U.pbrMetallicRoughness,$=t.style.fog;let Q;Q=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:r.ad.mat4.multiply([],u.zScaleMatrix,h.nodeModelMatrix),r.ad.mat4.multiply(Q,u.negCameraPosMatrix,Q);const W=r.ad.mat4.invert([],Q);r.ad.mat4.transpose(W,W);const te=n.paint.get("model-color-use-theme").constantOr("default")==="none",ne=n.paint.get("model-emissive-strength").constantOr(0),ce=Bc(new Float32Array(h.worldViewProjection),new Float32Array(Q),new Float32Array(W),null,t,b,j.baseColorFactor.toRenderColor(null),U.emissiveFactor,j.metallicFactor,j.roughnessFactor,U,ne,n),me={defines:[]},fe=[],we=t.shadowRenderer;we&&(we.useNormalOffset=!1),Uc(me.defines,fe,k,t,te?null:n.lut);let ye=null;if($){const Se=Bo(h.nodeModelMatrix,t.transform);if(ye=new Float32Array(Se),P.projection.name!=="globe"){const Ce=k.aabb.min,Ke=k.aabb.max,[Ge,ct]=$.getOpacityForBounds(Se,Ce[0],Ce[1],Ke[0],Ke[1]);me.overrideFog=Ge>=Ht||ct>=Ht}}const ve=Wo(t,n.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const xe=t.getOrCreateProgram("model",me);t.uploadCommonUniforms(I,xe,null,ye,ve),t.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(h.nodeModelMatrix,xe),xe.draw(t,I.gl.TRIANGLES,L,p,g,k.material.doubleSided?Ii.disabled:Ii.backCCW,ce,n.id,k.vertexBuffer,k.indexBuffer,k.segments,n.paint,t.transform.zoom,void 0,fe)}function jc(h,t,n,u,p,g,b){let I;I=h.projection.name==="globe"?r.dp(n,h):[...n],r.ad.mat4.multiply(I,I,t.matrix);const L=r.ad.mat4.multiply([],u,I);if(t.meshes)for(const P of t.meshes){if(P.material.alphaMode!=="BLEND"){b.push({mesh:P,depth:0,modelIndex:p,worldViewProjection:L,nodeModelMatrix:I});continue}const k=r.ad.vec3.transformMat4([],P.centroid,L);!h.isOrthographic&&k[2]<=0||g.push({mesh:P,depth:k[2],modelIndex:p,worldViewProjection:L,nodeModelMatrix:I})}if(t.children)for(const P of t.children)jc(h,P,n,u,p,g,b)}function Fu(h,t,n,u){const p=n.shadowRenderer;if(!p)return;const g=p.getShadowPassDepthMode(),b=p.getShadowPassColorMode(),I=p.calculateShadowPassMatrixFromMatrix(t),L=lp(I);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,g,Ni.disabled,b,Ii.backCCW,L,u.id,h.vertexBuffer,h.indexBuffer,h.segments,u.paint,n.transform.zoom,void 0,void 0)}function $l(h,t,n){const u=t.updateZoomBasedPaintProperties(),p=function(g,b,I){let L,P,k,U=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&U>0){const j=g.terrain,$=j.findDEMTileFor(I);$&&$.dem?L=r.dr.create(j,I,$):U=0}if(U===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),U===b.validForExaggeration&&(U===0||L&&L._demTile&&L._demTile.tileID===b.validForDEMTile.id&&L._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const j in b.instancesPerModel){const $=b.instancesPerModel[j];for(let Q=0;Q<$.instancedDataArray.length;++Q){const W=(L?U*L.getElevationAt(0|$.instancedDataArray.float32[16*Q],0|$.instancedDataArray.float32[16*Q+1],!0,!0):0)+$.instancesEvaluatedElevation[Q];$.instancedDataArray.float32[16*Q+6]=W,P=P?Math.min(b.terrainElevationMin,W):W,k=k?Math.max(b.terrainElevationMax,W):W}}return b.terrainElevationMin=P||0,b.terrainElevationMax=k||0,b.validForExaggeration=U,b.validForDEMTile=L&&L._demTile?{id:L._demTile.tileID,timestamp:L._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,n);(u||p)&&(t.uploaded=!1,t.upload(h.context))}const ns={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.ce([0,0,0],[r.ai,r.ai,0])};function nf(h,t){const n=1<<h.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,g=h.canonical.x/n,b=(h.canonical.x+1)/n,I=h.canonical.y/n,L=(h.canonical.y+1)/n;let P=t._centerAltitude;if(p){const $=p.getMinMaxForTile(h);$&&$.max>P&&(P=$.max)}const k=r.ay(u.x,g,b)-u.x,U=r.ay(u.y,I,L)-u.y,j=r.bH(P,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(k*k+U*U+j*j))}function xs(h,t,n,u,p,g,b){const I=h.context,L=h.renderPass==="shadow",P=h.shadowRenderer,k=L&&P?P.getShadowPassDepthMode():new mi(I.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D),U=h.isTileAffectedByFog(g);if(n.meshes)for(const j of n.meshes){const $=["MODEL_POSITION_ON_GPU"],Q=[];let W,te,ne;u.instancedDataArray.length>20&&$.push("INSTANCED_ARRAYS");const ce=Wo(h,t.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&$.push("RENDER_CUTOFF"),L&&P)W=h.getOrCreateProgram("modelDepth",{defines:$}),te=lp(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(n.matrix)),ne=P.getShadowPassColorMode();else{Uc($,Q,j,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),W=h.getOrCreateProgram("model",{defines:$,overrideFog:U});const fe=j.material,we=fe.pbrMetallicRoughness,ye=t.paint.get("model-opacity").constantOr(1),ve=t.paint.get("model-emissive-strength").constantOr(0);te=Bc(g.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,h,ye,we.baseColorFactor.toRenderColor(null),fe.emissiveFactor,we.metallicFactor,we.roughnessFactor,fe,ve,t,p),P&&(b.shadowUniformsInitialized?W.setShadowUniformValues(I,P.getShadowUniformValues()):(P.setupShadows(g.toUnwrapped(),W,"model-tile",g.overscaledZ),b.shadowUniformsInitialized=!0)),ne=ce.shouldRenderCutoff||ye<1||fe.alphaMode!=="OPAQUE"?en.alphaBlended:en.unblended}h.uploadCommonUniforms(I,W,g.toUnwrapped(),null,ce);const me=j.material.doubleSided?Ii.disabled:Ii.backCCW;if(u.instancedDataArray.length>20)Q.push(u.instancedDataBuffer),W.draw(h,I.gl.TRIANGLES,k,Ni.disabled,ne,me,te,t.id,j.vertexBuffer,j.indexBuffer,j.segments,t.paint,h.transform.zoom,void 0,Q,u.instancedDataArray.length);else{const fe=L?"u_instance":"u_normal_matrix";for(let we=0;we<u.instancedDataArray.length;++we)te[fe]=new Float32Array(u.instancedDataArray.arrayBuffer,64*we,16),W.draw(h,I.gl.TRIANGLES,k,Ni.disabled,ne,me,te,t.id,j.vertexBuffer,j.indexBuffer,j.segments,t.paint,h.transform.zoom,void 0,Q)}}if(n.children)for(const j of n.children)xs(h,t,j,u,p,g,b)}const Ys=[1,-1,1];function Xh(h,t,n,u){if(!n.modelManager)return!0;const p=n.modelManager;if(!n.shadowRenderer)return!0;const g=n.shadowRenderer,b=t.aabb;let I=!0,L=h.maxHeight;if(L===0){let k=0;for(const U in h.instancesPerModel){const j=p.getModel(U,u);j?k=Math.max(k,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):I=!1}L=h.maxScale*k*1.41+h.maxVerticalOffset,I&&(h.maxHeight=L)}b.max[2]=L,b.min[2]+=h.terrainElevationMin,b.max[2]+=h.terrainElevationMax,r.ad.vec3.transformMat4(b.min,b.min,t.tileMatrix),r.ad.vec3.transformMat4(b.max,b.max,t.tileMatrix);const P=b.intersects(g.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=P===2),P===0}function Yh(h,t){const n=h.uniformValues.u_cutoff_params[0],u=h.uniformValues.u_cutoff_params[1],p=h.uniformValues.u_cutoff_params[2],g=h.uniformValues.u_cutoff_params[3];return u===n||g===p?1:r.ay(((t-n)/(u-n)-p)/(g-p),0,1)}function rf(h,t,n,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();r.ad.mat4.multiply(p,p,h);const g=r.ad.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let b=r.ad.vec4.transformMat4(r.ad.vec4.create(),g,p),I=b,L=b;g[1]=n.max[1],b=r.ad.vec4.transformMat4(r.ad.vec4.create(),g,p),I=b[1]<I[1]?b:I,L=b[1]>L[1]?b:L,g[0]=n.max[0],b=r.ad.vec4.transformMat4(r.ad.vec4.create(),g,p),I=b[1]<I[1]?b:I,L=b[1]>L[1]?b:L,g[1]=n.min[1],b=r.ad.vec4.transformMat4(r.ad.vec4.create(),g,p),I=b[1]<I[1]?b:I,L=b[1]>L[1]?b:L;const P=r.ay(u[0],0,1),k=100*t.pixelsPerMeter*r.ay(u[1],0,1),U=r.ay(u[2],0,1),j=r.ad.vec4.lerp(r.ad.vec4.create(),I,L,P),$=Math.tan(.5*t.fovX),Q=-j[2]*$;if(k===0)return j[1]<-Math.abs(Q)?U:1;const W=(-Math.abs(Q)-j[1])/k,te=(ce,me,fe)=>(1-fe)*ce+fe*me,ne=r.ay(te(1,U,W),U,1);return te(1,ne,r.ay((t.pitch-20)/20,0,1))}class af{}class Xl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,u){{const U=this._storage.get(n.id);if(U)return U.lastUsedFrameIdx=t,U.buf}const p=u.gl,g=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),b=new ArrayBuffer(g),I=new Int16Array(b);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const L=new r.dt;for(let U=0;U<g/2;U+=3){const j=I[U],$=I[U+1],Q=I[U+2];L.emplaceBack(j,$),L.emplaceBack($,Q),L.emplaceBack(Q,j)}const P=u.bindVertexArrayOES.current,k=new af;return k.buf=new ts(u,L),k.lastUsedFrameIdx=t,this._storage.set(n.id,k),u.bindVertexArrayOES.set(P),k.buf}update(t){for(const[n,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class sf{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Fo=r.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class of{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Vu{constructor(t,n){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Wh=r.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class lf{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new r.du,I=new r.aV;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(b,Wh.members),this.vignetteIdx=t.context.createIndexBuffer(I)}const p=r.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const b={u_vignetteShape:(g={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,mi.disabled,Ni.disabled,en.alphaBlended,Ii.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,p)}var g}}class ca{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),g=u.toLngLat(),b=r.ak(g.lng),I=r.ak(g.lat),L=t.pixelsPerMeter/n,P=b*r.dv,k=r.dv*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+k,j=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+P)*L,this._accumulatedOffsetY+=U*L,this._accumulatedElevation+=j*L,this._offsetXPrev=P,this._offsetYPrev=k,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function cf(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function Uu(h){const t=r.dl(1323123451230),n=[];for(let u=0;u<h;++u){const p=2*t()-1,g=2*t()-1,b=2*t()-1;n.push(r.ad.vec3.fromValues(p,g,b))}return n}function rs(h,t,n,u,p){const g=r.ay((p-n)/(u-n),0,1);return(1-g)*h+g*t}class Kh{constructor(t){this._movement=new ca,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new lf,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,g=r.ad.quat.identity([]);r.ad.quat.rotateX(g,g,r.ak(90)-u._pitch),r.ad.quat.rotateZ(g,g,-u.angle);const b=r.ad.mat4.fromQuat(new Float32Array(16),g),I=r.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),L=r.ad.mat4.transpose([],I),P=r.ad.mat4.multiply([],L,b),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*n,this._prevTime=k,{projectionMatrix:p,modelviewMatrix:P}}}class Jh extends Kh{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Vu(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=Uu(this.particlesCount),p=new r.dw,g=new r.aV;let b=0;const I=r.dl(1323123451230);for(let L=0;L<u.length;++L){const P=u[L],k=[2*I()-1,I(),I(),I()];p.emplaceBack(P[0],P[1],P[2],-1,-1,...k),p.emplaceBack(P[0],P[1],P[2],1,-1,...k),p.emplaceBack(P[0],P[1],P[2],1,1,...k),p.emplaceBack(P[0],P[1],P[2],-1,1,...k),g.emplaceBack(b+0,b+1,b+2),g.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=n.createVertexBuffer(p,Fo.members),this.particlesIdx=n.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(n.revealStart>u)return;const p=rs(0,1,n.revealStart,n.revealStart+n.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let b=[-g.direction.x,g.direction.y,-100];r.ad.vec3.normalize(b,b);const I=structuredClone(this._vignetteParams);I.strength*=p,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),b=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(t.style.rain.state.vignetteColor));const L=this.updateOnRender(t,g.timeFactor),P=t.context,k=P.gl,U=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(P,{width:t.width,height:t.height,data:null},k.RGBA8)),g.distortionStrength>0&&(P.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const j=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(P,j),P.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const $=[g.color.r,g.color.g,g.color.b,g.color.a],Q=(W,te)=>{const ne=cf(this._movement.getPosition(),W),ce=g.dropletSizeX,me=g.dropletSizeX*g.dropletSizeYScale,fe=t.width/2,we=t.height/2,ye=rs(0,g.screenThinning.start,0,1,g.screenThinning.intensity),ve=rs(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),xe=rs(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),Se=(Ce={modelview:L.modelviewMatrix,projection:L.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:W,rainDropletSize:[ce,me],distortionStrength:g.distortionStrength,rainDirection:b,color:$,screenSize:[U.width,U.height],thinningCenterPos:[fe,we],thinningShape:[ye,ve,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:xe,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_texScreen:0,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_boxSize:Ce.boxSize,u_rainDropletSize:Ce.rainDropletSize,u_distortionStrength:Ce.distortionStrength,u_rainDirection:Ce.rainDirection,u_color:Ce.color,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_shapeDirectionalPower:Ce.shapeDirectionalPower,u_shapeNormalPower:Ce.shapeNormalPower,u_mode:Ce.mode});var Ce;const Ke=Math.round(g.intensity*this.particlesCount),Ge=r.b8.simpleSegment(0,0,4*Ke,2*Ke);j.draw(t,k.TRIANGLES,mi.disabled,Ni.disabled,en.alphaBlended,Ii.disabled,Se,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};g.distortionStrength>0&&Q(g.boxSize,!0),Q(g.boxSize,!1),this._vignette.draw(t,I)}}const uf=r.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class qc extends Kh{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Vu(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=Uu(this.particlesCount),p=new r.dx,g=new r.aV;let b=0;const I=r.dl(1323123451230);for(let L=0;L<u.length;++L){const P=u[L],k=I(),U=I(),j=I(),$=[L/u.length,k,U,j],Q=[I(),I()];p.emplaceBack(P[0],P[1],P[2],-1,-1,...$,...Q),p.emplaceBack(P[0],P[1],P[2],1,-1,...$,...Q),p.emplaceBack(P[0],P[1],P[2],1,1,...$,...Q),p.emplaceBack(P[0],P[1],P[2],-1,1,...$,...Q),g.emplaceBack(b+0,b+1,b+2),g.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=n.createVertexBuffer(p,uf.members),this.particlesIdx=n.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let u=[-n.direction.x,n.direction.y,-100];r.ad.vec3.normalize(u,u);const p=structuredClone(this._vignetteParams),g=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=t.transform.zoom;if(g.revealStart>b)return;const I=rs(0,1,g.revealStart,g.revealStart+g.revealRange,b);p.strength*=I,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const L=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const P=t.context,k=P.gl,U=t.transform,j=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(P,j),(($,Q,W)=>{const te=cf(this._movement.getPosition(),$),ne=U.width/2,ce=U.height/2,me=rs(0,W.screenThinning.start,0,1,W.screenThinning.intensity),fe=rs(.001,W.screenThinning.range,0,1,W.screenThinning.intensity),we=rs(0,W.screenThinning.particleOffset,0,1,W.screenThinning.intensity),ye=(ve={modelview:L.modelviewMatrix,projection:L.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:W.velocityConeAperture,velocity:W.velocity,horizontalOscillationRadius:W.horizontalOscillationRadius,horizontalOscillationRate:W.horizontalOscillationRate,boxSize:$,billboardSize:1*W.billboardSize,simpleShapeParameters:[W.shapeFadeStart,W.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[ne,ce],thinningShape:[me,fe,Math.pow(10,W.screenThinning.fadePower)],thinningAffectedRatio:W.screenThinning.affectedRatio,thinningParticleOffset:we,color:[W.color.r,W.color.g,W.color.b,W.color.a],direction:u},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const xe=Math.round(W.intensity*this.particlesCount),Se=r.b8.simpleSegment(0,0,4*xe,2*xe);this.particlesVx&&this.particlesIdx&&j.draw(t,k.TRIANGLES,mi.disabled,Ni.disabled,en.alphaBlended,Ii.disabled,ye,"snow_particles",this.particlesVx,this.particlesIdx,Se)})(n.boxSize,0,n),this._vignette.draw(t,p)}}const Qh={symbol:function(h,t,n,u,p){if(h.renderPass!=="translucent")return;const g=Ni.disabled,b=h.colorModeForRenderPass(),I=n.layout.get("text-variable-anchor"),L=n.layout.get("text-size-scale-range"),P=r.ay(h.scaleFactor,L[0],L[1]);I&&function(j,$,Q,W,te,ne,ce,me){const fe=$.transform,we=te==="map",ye=ne==="map";for(const ve of j){const xe=W.getTile(ve),Se=xe.getBucket(Q);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const Ce=r.bp(Se.textSizeData,fe.zoom,me),Ke=ys(ve,Se.getProjection(),fe),Ge=fe.calculatePixelsToTileUnitsMatrix(xe),ct=Hr(Ke,xe.tileID.canonical,ye,we,fe,Se.getProjection(),Ge),_t=Se.hasIconTextFit()&&Se.hasIconData();if(Ce){const Ct=Math.pow(2,fe.zoom-xe.tileID.overscaledZ);za(Se,we,ye,ce,r.cY,fe,ct,ve,Ct,Ce,_t)}}}(u,h,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),p,P);const k=n.paint.get("icon-opacity").constantOr(1)!==0,U=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||U)?Ln(h,t,n,u,g,b):(k&&Ln(h,t,n,u,g,b,{onlyIcons:!0}),U&&Ln(h,t,n,u,g,b,{onlyText:!0})),t.map.showCollisionBoxes&&(Bn(h,t,n,u,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Bn(h,t,n,u,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,n,u){if(h.renderPass!=="translucent")return;const p=n.paint.get("circle-opacity"),g=n.paint.get("circle-stroke-width"),b=n.paint.get("circle-stroke-opacity"),I=n.layout.get("circle-sort-key").constantOr(1)!==void 0,L=n.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(g.constantOr(1)===0||b.constantOr(1)===0))return;const P=h.context,k=P.gl,U=h.transform,j=h.depthModeForSublayer(0,mi.ReadOnly),$=Ni.disabled,Q=h.colorModeForDrapableLayerRenderPass(L),W=U.projection.name==="globe",te=[r.av(U.center.lng),r.aC(U.center.lat)],ne=[];for(let me=0;me<u.length;me++){const fe=u[me],we=t.getTile(fe),ye=we.getBucket(n);if(!ye||ye.projection.name!==U.projection.name)continue;const ve=ye.programConfigurations.get(n.id),xe=r.cZ(n),Se=h.isTileAffectedByFog(fe);W&&xe.push("PROJECTION_GLOBE_VIEW"),xe.push("DEPTH_D24"),h.terrain&&U.depthOcclusionForSymbolsAndCircles&&xe.push("DEPTH_OCCLUSION");const Ce=h.getOrCreateProgram("circle",{config:ve,defines:xe,overrideFog:Se}),Ke=ye.layoutVertexBuffer,Ge=ye.globeExtVertexBuffer,ct=ye.indexBuffer,_t=U.projection.createInversionMatrix(U,fe.canonical),Ct={programConfiguration:ve,program:Ce,layoutVertexBuffer:Ke,globeExtVertexBuffer:Ge,indexBuffer:ct,uniformValues:r.c_(h,fe,we,_t,te,n),tile:we};if(I){const Ve=ye.segments.get();for(const ut of Ve)ne.push({segments:new r.b8([ut]),sortKey:ut.sortKey,state:Ct})}else ne.push({segments:ye.segments,sortKey:0,state:Ct})}I&&ne.sort((me,fe)=>me.sortKey-fe.sortKey);const ce={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const me of ne){const{programConfiguration:fe,program:we,layoutVertexBuffer:ye,globeExtVertexBuffer:ve,indexBuffer:xe,uniformValues:Se,tile:Ce}=me.state,Ke=me.segments;h.terrain&&h.terrain.setupElevationDraw(Ce,we,ce),h.uploadCommonUniforms(P,we,Ce.tileID.toUnwrapped()),we.draw(h,k.TRIANGLES,j,$,Q,Ii.disabled,Se,n.id,ye,xe,Ke,n.paint,U.zoom,fe,[ve])}},heatmap:function(h,t,n,u){if(n.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const p=h.context,g=p.gl,b=Ni.disabled,I=new en([g.ONE,g.ONE,g.ONE,g.ONE],r.al.transparent,[!0,!0,!0,!0]);(function($,Q,W,te){const ne=$.gl,ce=Q.width*te,me=Q.height*te;$.activeTexture.set(ne.TEXTURE1),$.viewport.set([0,0,ce,me]);let fe=W.heatmapFbo;if(!fe||fe&&(fe.width!==ce||fe.height!==me)){fe&&fe.destroy();const we=ne.createTexture();ne.bindTexture(ne.TEXTURE_2D,we),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MAG_FILTER,ne.LINEAR),fe=W.heatmapFbo=$.createFramebuffer(ce,me,!0,null),function(ye,ve,xe,Se,Ce,Ke){const Ge=ye.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,ye.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,Ce,Ke,0,Ge.RGBA,ye.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Se.colorAttachment.set(xe)}($,0,we,fe,ce,me)}else ne.bindTexture(ne.TEXTURE_2D,fe.colorAttachment.get()),$.bindFramebuffer.set(fe.framebuffer)})(p,h,n,h.transform.projection.name==="globe"?.5:.25),p.clear({color:r.al.transparent});const L=h.transform,P=L.projection.name==="globe",k=P?["PROJECTION_GLOBE_VIEW"]:[],U=P?Ii.frontCCW:Ii.disabled,j=[r.av(L.center.lng),r.aC(L.center.lat)];for(let $=0;$<u.length;$++){const Q=u[$];if(t.hasRenderableParent(Q))continue;const W=t.getTile(Q),te=W.getBucket(n);if(!te||te.projection.name!==L.projection.name)continue;const ne=h.isTileAffectedByFog(Q),ce=te.programConfigurations.get(n.id),me=h.getOrCreateProgram("heatmap",{config:ce,defines:k,overrideFog:ne}),{zoom:fe}=h.transform;h.terrain&&h.terrain.setupElevationDraw(W,me),h.uploadCommonUniforms(p,me,Q.toUnwrapped());const we=L.projection.createInversionMatrix(L,Q.canonical);me.draw(h,g.TRIANGLES,mi.disabled,b,I,U,Pc(h,Q,W,we,j,fe,n.paint.get("heatmap-intensity")),n.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,n.paint,h.transform.zoom,ce,P?[te.globeExtVertexBuffer]:null)}p.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(p,g){const b=p.context,I=b.gl,L=g.heatmapFbo;if(!L)return;b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,L.colorAttachment.get()),b.activeTexture.set(I.TEXTURE1);let P=g.colorRampTexture;P||(P=g.colorRampTexture=new r.T(b,g.colorRamp,I.RGBA8)),P.bind(I.LINEAR,I.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,I.TRIANGLES,mi.disabled,Ni.disabled,p.colorModeForRenderPass(),Ii.disabled,((k,U,j,$)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,g),g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(h,n))},line:function(h,t,n,u){if(h.renderPass!=="translucent")return;const p=n.paint.get("line-opacity"),g=n.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;const b=n.paint.get("line-emissive-strength"),I=n.paint.get("line-occlusion-opacity"),L=n.layout.get("line-elevation-reference"),P=n.layout.get("line-width-unit")==="meters",k=L==="sea",U=h.context,j=U.gl;if(n.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const $=n.layout.get("line-cross-slope"),Q=$!==void 0,W=$<1,te=h.colorModeForDrapableLayerRenderPass(b),ne=h.terrain&&h.terrain.renderingToTexture,ce=ne?1:r.q.devicePixelRatio,me=n.paint.get("line-dasharray"),fe=me.constantOr(1),we=n.layout.get("line-cap"),ye=me.constantOr(null),ve=we.constantOr(null),xe=n.paint.get("line-pattern"),Se=xe.constantOr(1),Ce=xe.constantOr(null),Ke=n.paint.get("line-opacity").constantOr(1);let Ge=!Se&&Ke!==1||h.depthOcclusion&&I>0&&I<1;const ct=n.paint.get("line-gradient"),_t=Se?"linePattern":"line",Ct=r.c$(n);let Ve;if(ne&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Ge=!1),I!==0&&h.depthOcclusion){const Ne=n.paint._values["line-opacity"];Ne&&Ne.value&&Ne.value.kind==="constant"?Ve=Ne.value:r.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&Ct.push("VARIABLE_LINE_WIDTH");const ut=(Ne,ht,nt,yt,et,gt)=>{for(const Vt of Ne){const Ut=t.getTile(Vt);if(Se&&!Ut.patternsLoaded())continue;const Gt=Ut.getBucket(n);if(!Gt||Gt.hasZOffset&&!et||!Gt.hasZOffset&&et)continue;h.prepareDrawTile();const oi=Gt.programConfigurations.get(n.id),Di=h.isTileAffectedByFog(Vt),xi=h.getOrCreateProgram(_t,{config:oi,defines:ht,overrideFog:Di,overrideRtt:!et&&void 0});if(Ce&&Ut.imageAtlas){const li=r.d0.from(Ce).getPrimary().scaleSelf(ce).toString(),jt=Ut.imageAtlas.patternPositions.get(li);jt&&oi.setConstantPatternPositions(jt)}if(!Se&&ye&&ve&&Ut.lineAtlas){const li=Ut.lineAtlas.getDash(ye,ve);li&&oi.setConstantPatternPositions(li)}let[Ri,Ci]=n.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&Ri!==Ci&&(Ri===0&&(Ri-=1),Ci===1&&(Ci+=1));const on=ne?Vt.projMatrix:null,Sn=P?1/Gt.tileToMeter/r.at(Ut,1,h.transform.zoom):1,Gi=P?1/Gt.tileToMeter/r.at(Ut,1,Math.floor(h.transform.zoom)):1,Ti=Se?r.d1(h,Ut,n,on,ce,Sn,Gi,[Ri,Ci]):r.d2(h,Ut,n,on,Gt.lineClipsArray.length,ce,Sn,Gi,[Ri,Ci]);if(ct){const li=Gt.gradients[n.id];let jt=li.texture;if(n.gradientVersion!==li.version){let Hi=256;if(n.stepInterpolant){const pn=t.getSource().maxzoom,hn=Vt.canonical.z===pn?Math.ceil(1<<h.transform.maxZoom-Vt.canonical.z):1;Hi=r.ay(r.d3(Gt.maxLineLength/r.ai*1024*hn),256,U.maxTextureSize)}li.gradient=r.d4({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:Hi,image:li.gradient||void 0,clips:Gt.lineClipsArray}),li.texture?li.texture.update(li.gradient):li.texture=new r.T(U,li.gradient,j.RGBA8),li.version=n.gradientVersion,jt=li.texture}U.activeTexture.set(j.TEXTURE1),jt.bind(n.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}fe&&(U.activeTexture.set(j.TEXTURE0),Ut.lineAtlasTexture&&Ut.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),oi.updatePaintBuffers()),Se&&(U.activeTexture.set(j.TEXTURE0),Ut.imageAtlasTexture&&Ut.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),oi.updatePaintBuffers()),et&&!k&&h.terrain.setupElevationDraw(Ut,xi),h.uploadCommonUniforms(U,xi,Vt.toUnwrapped());const Fi=li=>{Ve!=null&&(Ve.value=Ke*I),xi.draw(h,j.TRIANGLES,nt,li,te,Ii.disabled,Ti,n.id,Gt.layoutVertexBuffer,Gt.indexBuffer,Gt.segments,n.paint,h.transform.zoom,oi,[Gt.layoutVertexBuffer2,Gt.patternVertexBuffer,Gt.zOffsetVertexBuffer]),Ve!=null&&(Ve.value=Ke)};if(Ge&&!et){const li=h.stencilModeForClipping(Vt).ref;li===0&&ne&&U.clear({stencil:0});const jt={func:j.EQUAL,mask:255};Ti.u_alpha_discard_threshold=.8,Fi(new Ni(jt,li,255,j.KEEP,j.KEEP,j.INVERT)),Ti.u_alpha_discard_threshold=0,Fi(new Ni(jt,li,255,j.KEEP,j.KEEP,j.KEEP))}else Ti.u_alpha_discard_threshold=Ge&&et&&gt?.8:0,Fi(et?yt:h.stencilModeForClipping(Vt))}};if(n.hasNonElevatedBuckets){const Ne=!ne&&h.terrain;I!==0&&Ne?r.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ne?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):ut(u,Ct,h.depthModeForSublayer(0,mi.ReadOnly),Ni.disabled,!1,!0)}if(n.hasElevatedBuckets){Ct.push("ELEVATED"),Q&&Ct.push(W?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&Ct.push("ELEVATION_REFERENCE_SEA");const Ne=Ge?h.stencilModeFor3D():Ni.disabled,ht=new mi(h.depthOcclusion?j.GREATER:j.LEQUAL,mi.ReadOnly,h.depthRangeFor3D);h.forceTerrainMode=!0,ut(u,Ct,ht,Ne,!0,!0),Ge&&ut(u,Ct,ht,Ne,!0,!1),h.forceTerrainMode=!1}Ge&&(h.resetStencilClippingMasks(),ne&&U.clear({stencil:0})),I===0||h.depthOcclusion||ne||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,n,u){const p=n.paint.get("fill-color"),g=n.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const b=n.paint.get("fill-emissive-strength"),I=h.colorModeForDrapableLayerRenderPass(b),L=n.paint.get("fill-pattern"),P=h.opaquePassEnabledForLayer()&&!L.constantOr(1)&&p.constantOr(r.al.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let k="none";n.layout.get("fill-elevation-reference")!=="none"?k="road":n.paint.get("fill-z-offset").constantOr(1)!==0&&(k="offset");const U=!(!h.terrain||!h.terrain.enabled),j={painter:h,sourceCache:t,layer:n,coords:u,colorMode:I,elevationType:k,terrainEnabled:U,pass:P};if(k!=="offset"){if(Wd(j,!1),k==="road"){const $=!U&&h.renderPass==="translucent";$&&Ul(h,t,n,u,"geometry"),Wd(j,!0,Ni.disabled),$&&function(Q){const{painter:W,sourceCache:te,layer:ne,coords:ce,colorMode:me}=Q,fe=W.context.gl,we=new mi(W.context.gl.LEQUAL,mi.ReadOnly,W.depthRangeFor3D);for(const ye of ce){const ve=te.getTile(ye),xe=ve.getBucket(ne);if(!xe)continue;const Se=xe.elevatedStructures;if(!Se||!Se.renderableSegments||Se.renderableSegments.segments[0].primitiveLength===0)continue;W.prepareDrawTile();const Ce=xe.bufferData.programConfigurations.get(ne.id),Ke=W.isTileAffectedByFog(ye),Ge=W.getOrCreateProgram("elevatedStructures",{config:Ce,overrideFog:Ke,defines:["NORMAL_OFFSET"]}),ct={u_matrix:W.translatePosMatrix(ye.projMatrix,ve,ne.paint.get("fill-translate"),ne.paint.get("fill-translate-anchor"))};W.uploadCommonUniforms(W.context,Ge,ye.toUnwrapped()),Ge.draw(W,fe.TRIANGLES,we,Ni.disabled,me,Ii.backCCW,ct,ne.id,Se.vertexBuffer,Se.indexBuffer,Se.renderableSegments,ne.paint,W.transform.zoom,Ce,[Se.vertexBufferNormal])}}(j)}}else Wd(j,!1,h.stencilModeFor3D())},"fill-extrusion":function(h,t,n,u){const p=n.paint.get("fill-extrusion-opacity"),g=h.context,b=g.gl,I=h.terrain,L=I&&I.renderingToTexture;if(p===0)return;const P=h.conflationActive&&h.style.isLayerClipped(n,t.getSource()),k=h.style.order.indexOf(n.fqid);if(P&&function(U,j,$,Q,W){for(const te of Q){const ne=j.getTile(te).getBucket($);ne&&(ne.updateReplacement(te,U.replacementSource,W),ne.uploadCentroid(U.context))}}(h,t,n,u,k),I||P)for(const U of u){const j=t.getTile(U).getBucket(n);j&&ql(h.context,t,U,j,n,I,P)}if(h.renderPass==="shadow"&&h.shadowRenderer){const U=h.shadowRenderer;if(I&&p<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ab)return;const j=U.getShadowPassDepthMode(),$=U.getShadowPassColorMode();Rr(h,t,n,u,j,Ni.disabled,$,P)}else if(h.renderPass==="translucent"){const U=!n.paint.get("fill-extrusion-pattern").constantOr(1),j=n.paint.get("fill-extrusion-color").constantOr(r.al.white);if(!L&&j.a!==0){const $=new mi(h.context.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D);p===1&&U?Rr(h,t,n,u,$,Ni.disabled,en.unblended,P):(Rr(h,t,n,u,$,Ni.disabled,en.disabled,P),Rr(h,t,n,u,$,h.stencilModeFor3D(),h.colorModeForRenderPass(),P),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&U&&(!I&&h.transform.projection.name!=="globe"||L)){const $=n.paint.get("fill-extrusion-opacity"),Q=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=n.paint.get("fill-extrusion-flood-light-intensity"),ne=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ce=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(ne?null:n.lut).toArray01().slice(0,3),me=Q>0&&W>0,fe=te>0,we=(ve,xe,Se)=>(1-Se)*ve+Se*xe,ye=ve=>{const xe=h.depthModeForSublayer(1,mi.ReadOnly,b.LEQUAL,!0),Se=n.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ce=we(.1,3,Se),Ke=h._showOverdrawInspector;if(!Ke){const Ge=new Ni({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),ct=new en([b.ONE,b.ONE,b.ONE,b.ONE],r.al.transparent,[!1,!1,!1,!0],b.MIN);jl(h,t,n,u,xe,Ge,ct,Ii.disabled,ve,"sdf",$,Q,W,te,ce,Ce,P,!1)}{const Ge=Ke?Ni.disabled:new Ni({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),ct=Ke?h.colorModeForRenderPass():new en([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],r.al.transparent,[!0,!0,!0,!0]);jl(h,t,n,u,xe,Ge,ct,Ii.disabled,ve,"color",$,Q,W,te,ce,Ce,P,!1)}};if(L){const ve=(xe,Se,Ce)=>{const Ke=h.depthModeForSublayer(1,mi.ReadOnly,b.LEQUAL,!1),Ge=n.paint.get(xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ct=we(.1,3,Ge);{const _t=new en([b.ONE,b.ONE,b.ONE,b.ONE],r.al.transparent,[!1,!1,!1,!0]);jl(h,t,n,u,Ke,Ni.disabled,_t,Ii.disabled,xe,"clear",$,Q,W,te,ce,ct,P,Se)}{const _t=new Ni({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ct=new en([b.ONE,b.ONE,b.ONE,b.ONE],r.al.transparent,[!1,!1,!1,!0],b.MIN);jl(h,t,n,u,Ke,_t,Ct,Ii.disabled,xe,"sdf",$,Q,W,te,ce,ct,P,Se)}{const _t=xe?b.ZERO:b.ONE_MINUS_DST_ALPHA,Ct=new Ni({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ve=new en([_t,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],r.al.transparent,[!0,!0,!0,!0]);jl(h,t,n,u,Ke,Ct,Ve,Ii.disabled,xe,"color",$,Q,W,te,ce,ct,P,Se)}{const _t=new en([b.ONE,b.ONE,b.ONE,xe?b.ZERO:b.ONE],r.al.transparent,[!1,!1,!1,!0],xe?b.FUNC_ADD:b.MAX);jl(h,t,n,u,Ke,Ni.disabled,_t,Ii.disabled,xe,"clear",$,Q,W,te,ce,ct,P,Se,Ce)}};if(me||fe){let xe;if(h.prepareDrawTile(),I){const Se=I.drapeBufferSize[0],Ce=I.drapeBufferSize[1];xe=I.framebufferCopyTexture,xe&&(!xe||xe.size[0]===Se&&xe.size[1]===Ce)||(xe&&xe.destroy(),xe=I.framebufferCopyTexture=new r.T(g,new r.r({width:Se,height:Ce}),b.RGBA8)),xe.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,Se,Ce)}me&&ve(!0,!1,xe),fe&&ve(!1,!0,xe)}}else me&&ye(!0),fe&&ye(!1),(me||fe)&&h.resetStencilClippingMasks()}}},hillshade:function(h,t,n,u){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const p=h.context,g=h.terrain&&h.terrain.renderingToTexture,[b,I]=h.renderPass!=="translucent"||g?[{},u]:h.stencilConfigForOverlap(u);for(const L of I){const P=t.getTile(L);if(P.needsHillshadePrepare&&h.renderPass==="offscreen")ap(h,P,n);else if(h.renderPass==="translucent"){const k=h.depthModeForSublayer(0,mi.ReadOnly),U=n.paint.get("hillshade-emissive-strength"),j=h.colorModeForDrapableLayerRenderPass(U),$=g&&h.terrain?h.terrain.stencilModeForRTTOverlap(L):b[L.overscaledZ];Du(h,L,P,n,k,$,j)}}p.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,n,u,p,g){if(h.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const b=h.transform.projection.name==="globe",I=n.paint.get("raster-elevation")!==0,L=I&&b;if(h.renderElevatedRasterBackface&&!L)return;const P=h.context,k=P.gl,U=t.getSource(),j=function(ye,ve,xe,Se){const Ce=ve.paint.get("raster-color"),Ke=ye.type==="raster-array",Ge=[],ct=ve.paint.get("raster-resampling"),_t=ve.paint.get("raster-color-mix");let Ct=ve.paint.get("raster-color-range");const Ve=[_t[0],_t[1],_t[2],0],ut=_t[3];let Ne=ct==="nearest"?Se.NEAREST:Se.LINEAR;if(Ke&&(Ge.push("RASTER_ARRAY"),Ce||Ge.push("RASTER_COLOR"),ct==="linear"&&Ge.push("RASTER_ARRAY_LINEAR"),Ne=Se.NEAREST,!Ct&&ye.rasterLayers)){const ht=ye.rasterLayers.find(({id:nt})=>nt===ve.sourceLayer);ht&&ht.fields&&ht.fields.range&&(Ct=ht.fields.range)}if(Ct=Ct||[0,1],Ce){Ge.push("RASTER_COLOR"),xe.activeTexture.set(Se.TEXTURE2),ve.updateColorRamp(Ct);let ht=ve.colorRampTexture;ht||(ht=ve.colorRampTexture=new r.T(xe,ve.colorRamp,Se.RGBA8)),ht.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}return{mix:Ve,range:Ct,offset:ut,defines:Ge,resampling:Ne}}(U,n,P,k);if(U instanceof r.aK&&!u.length&&!b)return;const $=n.paint.get("raster-emissive-strength"),Q=h.colorModeForDrapableLayerRenderPass($),W=h.terrain&&h.terrain.renderingToTexture,te=!h.options.moving,ne=n.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(U instanceof r.aK&&!u.length&&(U.onNorthPole||U.onSouthPole)){const ye=I?h.stencilModeFor3D():Ni.disabled;return void $e(!!U.onNorthPole,null,h,t,n,$,j,Ii.disabled,ye)}if(!u.length)return;const[ce,me]=U instanceof r.aK||W?[{},u]:h.stencilConfigForOverlap(u),fe=me[me.length-1].overscaledZ;L&&j.defines.push("PROJECTION_GLOBE_VIEW"),I&&j.defines.push("RENDER_CUTOFF");const we=(ye,ve,xe)=>{for(const Se of ye){const Ce=Se.toUnwrapped(),Ke=t.getTile(Se);if(W&&(!Ke||!Ke.hasData()))continue;P.activeTexture.set(k.TEXTURE0);const Ge=Ur(Ke,U,n,j);if(!Ge||!Ge.texture)continue;const{texture:ct,mix:_t,offset:Ct,tileSize:Ve,buffer:ut}=Ge;let Ne,ht;W?(Ne=mi.disabled,ht=Se.projMatrix):I?(Ne=new mi(k.LEQUAL,mi.ReadWrite,h.depthRangeFor3D),ht=b?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Ce,te)):(Ne=h.depthModeForSublayer(Se.overscaledZ-fe,n.paint.get("raster-opacity")===1?mi.ReadWrite:mi.ReadOnly,k.LESS),ht=h.transform.calculateProjMatrix(Ce,te));const nt=h.terrain&&W?h.terrain.stencilModeForRTTOverlap(Se):ce[Se.overscaledZ],yt=g?0:n.paint.get("raster-fade-duration");Ke.registerFadeDuration(yt);const et=t.findLoadedParent(Se,0),gt=Vd(Ke,et,t,h.transform,yt);let Vt,Ut;h.terrain&&h.terrain.prepareDrawTile(),P.activeTexture.set(k.TEXTURE0),ct.bind(ne,k.CLAMP_TO_EDGE),P.activeTexture.set(k.TEXTURE1),et?(et.texture&&et.texture.bind(ne,k.CLAMP_TO_EDGE),Vt=Math.pow(2,et.tileID.overscaledZ-Ke.tileID.overscaledZ),Ut=[Ke.tileID.canonical.x*Vt%1,Ke.tileID.canonical.y*Vt%1]):ct.bind(ne,k.CLAMP_TO_EDGE),"useMipmap"in ct&&P.extTextureFilterAnisotropic&&h.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Gt=h.transform;let oi;const Di=I?is(Gt):[0,0,0,0];let xi,Ri,Ci,on,Sn,Gi=0;if(L&&U instanceof r.aK&&U.coordinates.length>3)xi=Float32Array.from(r.bc(r.cI(new r.bT(0,0,0)))),Ri=Float32Array.from(Gt.globeMatrix),Ci=Float32Array.from(r.cE(Gt)),on=[r.av(Gt.center.lng),r.aC(Gt.center.lat)],oi=U.elevatedGlobePerspectiveTransform,Sn=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(L){const jt=r.cF(Se.canonical);Gi=r.cG(jt.getCenter().lat),xi=Float32Array.from(r.bc(r.cI(Se.canonical))),Ri=Float32Array.from(Gt.globeMatrix),Ci=Float32Array.from(r.cE(Gt)),on=[r.av(Gt.center.lng),r.aC(Gt.center.lat)],oi=[0,0],Sn=Float32Array.from(r.cH(Se.canonical,jt,Gi,Gt.worldSize/Gt._pixelsPerMercatorPixel))}else oi=U instanceof r.aK?U.perspectiveTransform:[0,0],xi=new Float32Array(16),Ri=new Float32Array(9),Ci=new Float32Array(16),on=[0,0],Sn=new Float32Array(9);const Ti=Zd(ht,xi,Ri,Ci,Sn,Ut||[0,0],r.ag(h.transform.zoom),on,Di,Vt||1,gt,n,oi,I?n.paint.get("raster-elevation"):0,2,_t,Ct,j.range,Ve,ut,$),Fi=h.isTileAffectedByFog(Se),li=h.getOrCreateProgram("raster",{defines:j.defines,overrideFog:Fi});if(h.uploadCommonUniforms(P,li,Ce),U instanceof r.aK){const jt=U.elevatedGlobeVertexBuffer,Hi=U.elevatedGlobeIndexBuffer;if(W||!b)U.boundsBuffer&&U.boundsSegments&&li.draw(h,k.TRIANGLES,Ne,Ni.disabled,Q,Ii.disabled,Ti,n.id,U.boundsBuffer,h.quadTriangleIndexBuffer,U.boundsSegments);else if(jt&&Hi){const pn=Gt.zoom<=r.c6?U.elevatedGlobeSegments:U.getSegmentsForLongitude(Gt.center.lng);pn&&li.draw(h,k.TRIANGLES,Ne,Ni.disabled,Q,ve,Ti,n.id,jt,Hi,pn)}}else if(L){Ne=new mi(k.LEQUAL,mi.ReadOnly,h.depthRangeFor3D);const jt=h.globeSharedBuffers;if(jt){const[Hi,pn,hn]=jt.getGridBuffers(Gi,!1);li.draw(h,k.TRIANGLES,Ne,xe||nt,h.colorModeForRenderPass(),ve,Ti,n.id,Hi,pn,hn)}}else{const{tileBoundsBuffer:jt,tileBoundsIndexBuffer:Hi,tileBoundsSegments:pn}=h.getTileBoundsBuffers(Ke);li.draw(h,k.TRIANGLES,Ne,nt,Q,Ii.disabled,Ti,n.id,jt,Hi,pn)}}if(!(U instanceof r.aK)&&L)for(const Se of ye){const Ce=Se.canonical.y===(1<<Se.canonical.z)-1;Se.canonical.y===0&&$e(!0,Se,h,t,n,$,j,ve,xe||Ni.disabled),Ce&&$e(!1,Se,h,t,n,$,j,ve===Ii.frontCW?Ii.backCW:Ii.frontCW,xe||Ni.disabled)}};L?we(me,h.renderElevatedRasterBackface?Ii.backCW:Ii.frontCW,h.stencilModeFor3D()):we(me,Ii.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,n,u,p,g){h.renderPass==="offscreen"&&function(b,I,L,P){if(!P.length)return;const k=b.context,U=k.gl,j=I.getSource();if(!(j instanceof Mo))return;const $=Math.ceil(Math.sqrt(L.paint.get("raster-particle-count")));let Q=L.particlePositionRGBAImage;if(!Q||Q.width!==$){const me=function(fe){const we=fe*fe,ye=new Uint8Array(4*we),ve=function(Se){return Se|=0,Se=Math.imul(2747636419^Se,2654435769),Se=Math.imul(Se^Se>>>16,2654435769),((Se=Math.imul(Se^Se>>>16,2654435769))>>>0)/4294967296},xe=1/1.1;for(let Se=0;Se<we;Se++){const Ce=xe*(ve(2*Se+0)+la),Ke=xe*(ve(2*Se+1)+la),Ge=255*Ce%1,ct=255*Ke%1,_t=Ge,Ct=Ke-ct/255,Ve=ct;ye[4*Se+0]=255*(Ce-Ge/255),ye[4*Se+1]=255*_t,ye[4*Se+2]=255*Ct,ye[4*Se+3]=255*Ve}return ye}($);Q=L.particlePositionRGBAImage=new r.r({width:$,height:$},me)}let W=L.particleFramebuffer;W?W.width!==$&&(W.destroy(),W=L.particleFramebuffer=k.createFramebuffer($,$,!0,null)):W=L.particleFramebuffer=k.createFramebuffer($,$,!0,null);const te=[];for(const me of P){const fe=I.getTile(me);if(!(fe instanceof Ia))continue;const we=Hh(fe,j,L);if(!we)continue;const ye=[fe.tileSize,fe.tileSize];let ve=L.tileFramebuffer;ve||(ve=L.tileFramebuffer=k.createFramebuffer(ye[0],ye[1],!0,null));let xe=fe.rasterParticleState;xe||(xe=fe.rasterParticleState=new Vc(k,me,ye,Q));const Se=xe.update(L.lastInvalidatedAt);xe.particleTextureDimension!==$&&xe.updateParticleTexture(me,Q);const Ce=xe.targetColorTexture;xe.targetColorTexture=xe.backgroundColorTexture,xe.backgroundColorTexture=Ce;const Ke=xe.particleTexture0;xe.particleTexture0=xe.particleTexture1,xe.particleTexture1=Ke,te.push([me,we,xe,Se])}if(te.length===0)return;const ne=r.q.now(),ce=L.previousDrawTimestamp?.001*(ne-L.previousDrawTimestamp):.0167;if(L.previousDrawTimestamp=ne,L.hasColorMap()){k.activeTexture.set(U.TEXTURE0+2);let me=L.colorRampTexture;me||(me=L.colorRampTexture=new r.T(k,L.colorRamp,U.RGBA8)),me.bind(U.LINEAR,U.CLAMP_TO_EDGE)}k.bindFramebuffer.set(L.tileFramebuffer.framebuffer),function(me,fe,we){const ye=me.context,ve=ye.gl,xe=fe.tileFramebuffer;ye.activeTexture.set(ve.TEXTURE0);const Se={u_texture:0,u_opacity:1.05*(Ke=fe.paint.get("raster-particle-fade-opacity-factor"))/(Ke+.05)},Ce=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ke;for(const Ge of we){const[,,ct,_t]=Ge;xe.colorAttachment.set(ct.targetColorTexture.texture),ye.viewport.set([0,0,xe.width,xe.height]),ye.clear({color:r.al.transparent}),_t&&(ct.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),Ce.draw(me,ve.TRIANGLES,mi.disabled,Ni.disabled,en.alphaBlended,Ii.disabled,Se,fe.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}}(b,L,te),function(me,fe,we,ye){const ve=me.context,xe=ve.gl,Se=we.tileFramebuffer,Ce=me.transform.projection.name==="globe",Ke=we.paint.get("raster-particle-max-speed");for(const Ge of ye){const[ct,_t,Ct]=Ge;ve.activeTexture.set(xe.TEXTURE0+0),_t.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Se.colorAttachment.set(Ct.targetColorTexture.texture);const Ve=me.getOrCreateProgram("rasterParticleDraw",{defines:_t.defines,overrideFog:!1});ve.activeTexture.set(xe.TEXTURE0+1);const ut=_t.scalarData?[]:[0,1,2,3].map(nt=>r.d7[nt](ct));ut.push(ct);const Ne=ct.canonical.x,ht=ct.canonical.y;for(const nt of ut){const yt=fe.getTile(Ce?nt.wrapped():nt);if(!yt)continue;const et=yt.rasterParticleState;if(!et)continue;const gt=nt.canonical.x+(1<<nt.canonical.z)*(nt.wrap-ct.wrap),Vt=nt.canonical.y;et.particleTexture0.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const Ut=Uh(1,et.particleTexture0.size[0],[gt-Ne,Vt-ht],0,_t.texture.size,2,Ke,_t.textureOffset,_t.scale,_t.offset);Ve.draw(me,xe.POINTS,mi.disabled,Ni.disabled,en.alphaBlended,Ii.disabled,Ut,we.id,et.particleIndexBuffer,void 0,et.particleSegment)}}}(b,I,L,te),k.bindFramebuffer.set(L.particleFramebuffer.framebuffer),function(me,fe,we,ye){const ve=me.context,xe=ve.gl,Se=fe.paint.get("raster-particle-max-speed"),Ce=ye*fe.paint.get("raster-particle-speed-factor")*.15,Ke=function(ct){return Math.pow(ct,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),Ge=fe.particleFramebuffer;ve.viewport.set([0,0,Ge.width,Ge.height]);for(const ct of we){const[,_t,Ct]=ct;ve.activeTexture.set(xe.TEXTURE0+0),_t.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),ve.activeTexture.set(xe.TEXTURE0+1);const Ve=Ct.particleTexture0;Ve.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const ut=Nl(1,Ve.size[0],0,_t.texture.size,Se,Ce,Ke,_t.textureOffset,_t.scale,_t.offset);Ge.colorAttachment.set(Ct.particleTexture1.texture),ve.clear({color:r.al.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:_t.defines}).draw(me,xe.TRIANGLES,mi.disabled,Ni.disabled,en.unblended,Ii.disabled,ut,fe.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}}(b,L,te,ce)}(h,t,n,u),h.renderPass==="translucent"&&(function(b,I,L,P,k){const U=b.context,j=U.gl,$=I.getSource().tileSize,Q=5*(1-r.ae(r.bY,r.bY+1,b.transform.zoom))*$+L.paint.get("raster-particle-elevation"),W=!b.options.moving,te=b.transform.projection.name==="globe";if(!P.length)return;const[ne,ce]=b.stencilConfigForOverlap(P),me=[];te&&me.push("PROJECTION_GLOBE_VIEW");const fe=b.stencilModeFor3D();for(const we of ce){const ye=we.toUnwrapped(),ve=I.getTile(we);if(!ve.rasterParticleState)continue;const xe=ve.rasterParticleState,Se=100;ve.registerFadeDuration(Se);const Ce=I.findLoadedParent(we,0),Ke=Vd(ve,Ce,I,b.transform,Se);let Ge,ct;b.terrain&&b.terrain.prepareDrawTile(),U.activeTexture.set(j.TEXTURE0),xe.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),U.activeTexture.set(j.TEXTURE1),Ce&&Ce.rasterParticleState?(Ce.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ge=Math.pow(2,Ce.tileID.overscaledZ-ve.tileID.overscaledZ),ct=[ve.tileID.canonical.x*Ge%1,ve.tileID.canonical.y*Ge%1]):xe.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const _t=te?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(ye,W),Ct=b.transform,Ve=Kd(Ct),ut=r.cF(we.canonical),Ne=r.cG(ut.getCenter().lat);let ht,nt,yt,et,gt;te?(ht=Float32Array.from(r.bc(r.cI(we.canonical))),nt=Float32Array.from(Ct.globeMatrix),yt=Float32Array.from(r.cE(Ct)),et=[r.av(Ct.center.lng),r.aC(Ct.center.lat)],gt=Float32Array.from(r.cH(we.canonical,ut,Ne,Ct.worldSize/Ct._pixelsPerMercatorPixel))):(ht=new Float32Array(16),nt=new Float32Array(9),yt=new Float32Array(16),et=[0,0],gt=new Float32Array(9));const Vt=_i(_t,ht,nt,yt,gt,ct||[0,0],r.ag(b.transform.zoom),et,Ve,Ge||1,Ke,Q),Ut=b.isTileAffectedByFog(we),Gt=b.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:Ut});if(b.uploadCommonUniforms(U,Gt,ye),te){const oi=new mi(j.LEQUAL,mi.ReadOnly,b.depthRangeFor3D),Di=0,xi=b.globeSharedBuffers;if(xi){const[Ri,Ci,on]=xi.getGridBuffers(Ne,Di!==0);Gt.draw(b,j.TRIANGLES,oi,fe,en.alphaBlended,b.renderElevatedRasterBackface?Ii.frontCCW:Ii.backCCW,Vt,L.id,Ri,Ci,on)}}else{const oi=b.depthModeForSublayer(0,mi.ReadOnly),Di=ne[we.overscaledZ],{tileBoundsBuffer:xi,tileBoundsIndexBuffer:Ri,tileBoundsSegments:Ci}=b.getTileBoundsBuffers(ve);Gt.draw(b,j.TRIANGLES,oi,Di,en.alphaBlended,Ii.disabled,Vt,L.id,xi,Ri,Ci)}}b.resetStencilClippingMasks()}(h,t,n,u),h.style.map.triggerRepaint())},background:function(h,t,n,u){const p=n.paint.get("background-color"),g=n.paint.get("background-color-use-theme").constantOr("default")==="none",b=n.paint.get("background-opacity"),I=n.paint.get("background-emissive-strength"),L=n.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const P=h.context,k=P.gl,U=h.transform,j=U.tileSize,$=n.paint.get("background-pattern");let Q;if($!==void 0&&($===null||(Q=h.imageManager.getPattern(r.I.from($.toString()),n.scope,h.style.getLut(n.scope)),!Q)))return;const W=!$&&p.a===1&&b===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==W)return;const te=Ni.disabled,ne=h.depthModeForSublayer(0,W==="opaque"?mi.ReadWrite:mi.ReadOnly),ce=h.colorModeForDrapableLayerRenderPass(I),me=$?"backgroundPattern":"background";let fe,we=u;if(we||(fe=h.getBackgroundTiles(),we=Object.values(fe).map(ye=>ye.tileID)),$&&(P.activeTexture.set(k.TEXTURE0),h.imageManager.bind(h.context,n.scope)),L){const ye=h.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(r.ad.mat4.identity([])),xe=new r.aH(0,0,0,0,0),Se=$?$d(ve,I,b,h,0,n.scope,Q,L,{tileID:xe,tileSize:j}):jh(ve,I,b,p.toRenderColor(g?null:n.lut));ye.draw(h,k.TRIANGLES,ne,te,ce,Ii.disabled,Se,n.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const ye of we){const ve=h.isTileAffectedByFog(ye),xe=h.getOrCreateProgram(me,{overrideFog:ve}),Se=ye.toUnwrapped(),Ce=u?ye.projMatrix:h.transform.calculateProjMatrix(Se);h.prepareDrawTile();const Ke=t?t.getTile(ye):fe?fe[ye.key]:new Vs(ye,j,U.zoom,h),Ge=$?$d(Ce,I,b,h,0,n.scope,Q,L,{tileID:ye,tileSize:j}):jh(Ce,I,b,p.toRenderColor(g?null:n.lut));h.uploadCommonUniforms(P,xe,Se);const{tileBoundsBuffer:ct,tileBoundsIndexBuffer:_t,tileBoundsSegments:Ct}=h.getTileBoundsBuffers(Ke);xe.draw(h,k.TRIANGLES,ne,te,ce,Ii.disabled,Ge,n.id,ct,_t,Ct)}},sky:function(h,t,n){const u=h._atmosphere?r.ag(h.transform.zoom):1,p=n.paint.get("sky-opacity")*u;if(p===0)return;const g=h.context,b=n.paint.get("sky-type"),I=new mi(g.gl.LEQUAL,mi.ReadOnly,[0,1]),L=h.frameCounter/1e3%1;b==="atmosphere"?h.renderPass==="offscreen"?n.needsSkyboxCapture(h)&&(function(P,k,U,j){const $=P.context,Q=$.gl;let W=k.skyboxFbo;if(!W){W=k.skyboxFbo=$.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new bm($),k.skyboxTexture=$.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,k.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let me=0;me<6;++me)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(W.framebuffer),$.viewport.set([0,0,32,32]);const te=k.getCenter(P,!0),ne=P.getOrCreateProgram("skyboxCapture"),ce=new Float64Array(16);r.ad.mat4.identity(ce),r.ad.mat4.rotateY(ce,ce,.5*-Math.PI),Jr(P,k,ne,ce,te,0),r.ad.mat4.identity(ce),r.ad.mat4.rotateY(ce,ce,.5*Math.PI),Jr(P,k,ne,ce,te,1),r.ad.mat4.identity(ce),r.ad.mat4.rotateX(ce,ce,.5*-Math.PI),Jr(P,k,ne,ce,te,2),r.ad.mat4.identity(ce),r.ad.mat4.rotateX(ce,ce,.5*Math.PI),Jr(P,k,ne,ce,te,3),r.ad.mat4.identity(ce),Jr(P,k,ne,ce,te,4),r.ad.mat4.identity(ce),r.ad.mat4.rotateY(ce,ce,Math.PI),Jr(P,k,ne,ce,te,5),$.viewport.set([0,0,P.width,P.height])}(h,n),n.markSkyboxValid(h)):h.renderPass==="sky"&&function(P,k,U,j,$){const Q=P.context,W=Q.gl,te=P.transform,ne=P.getOrCreateProgram("skybox");Q.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,k.skyboxTexture);const ce=((me,fe,we,ye,ve)=>({u_matrix:me,u_sun_direction:fe,u_cubemap:0,u_opacity:ye,u_temporal_offset:ve}))(te.skyboxMatrix,k.getCenter(P,!1),0,j,$);P.uploadCommonUniforms(Q,ne),ne.draw(P,W.TRIANGLES,U,Ni.disabled,P.colorModeForRenderPass(),Ii.backCW,ce,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(h,n,I,p,L):b==="gradient"&&h.renderPass==="sky"&&function(P,k,U,j,$){const Q=P.context,W=Q.gl,te=P.transform,ne=P.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new bm(Q)),Q.activeTexture.set(W.TEXTURE0);let ce=k.colorRampTexture;ce||(ce=k.colorRampTexture=new r.T(Q,k.colorRamp,W.RGBA8)),ce.bind(W.LINEAR,W.CLAMP_TO_EDGE);const me=((fe,we,ye,ve,xe)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:we,u_radius:r.ak(ye),u_opacity:ve,u_temporal_offset:xe}))(te.skyboxMatrix,k.getCenter(P,!1),k.paint.get("sky-gradient-radius"),j,$);P.uploadCommonUniforms(Q,ne),ne.draw(P,W.TRIANGLES,U,Ni.disabled,P.colorModeForRenderPass(),Ii.backCW,me,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(h,n,I,p,L)},debug:function(h,t,n,u,p,g){for(let b=0;b<n.length;b++)if(p){const P=new r.al(u.r*.8,u.g*.8,u.b*.8,1);ol(h,t,n[b],u,-1,-1,g),ol(h,t,n[b],u,-1,1,g),ol(h,t,n[b],u,1,1,g),ol(h,t,n[b],u,1,-1,g),ol(h,t,n[b],P,0,0,g)}else ol(h,t,n[b],u,0,0,g)},custom:function(h,t,n,u){const p=h.context,g=n.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&n.isDraped(t)){if(h.renderPass==="offscreen"){const b=g.prerender;if(b){if(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const I=h.transform.pointMerc;b.call(g,p.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),r.ag(h.transform.zoom),[I.x,I.y],h.transform.pixelsPerMeterRatio)}else b.call(g,p.gl,h.transform.customLayerMatrix());p.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const I=g.renderToTile;if(I){const L=u[0].canonical,P=new r.ac(L.x+u[0].wrap*(1<<L.z),L.y,L.z);p.setDepthMode(mi.disabled),p.setStencilMode(Ni.disabled),p.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),I.call(g,p.gl,P),p.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(Ni.disabled);const b=g.renderingMode==="3d"?new mi(h.context.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,mi.ReadOnly);if(p.setDepthMode(b),h.transform.projection.name==="globe"){const I=h.transform.pointMerc;g.render(p.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),r.ag(h.transform.zoom),[I.x,I.y],h.transform.pixelsPerMeterRatio)}else g.render(p.gl,h.transform.customLayerMatrix());p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,n,u){if(h.renderPass==="opaque")return;const p=n.paint.get("model-opacity").constantOr(1);if(p===0)return;const g=n.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!g||h.terrain&&p<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof r.ab))return;const b=h.shadowRenderer,I=n.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,I||(b.enabled=!1));const L=()=>{b&&(b.useNormalOffset=!0,I||(b.enabled=!0))},P=t.getSource();if(h.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(ne,ce,me,fe,we){const ye=ne.transform;if(ye.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${ye.projection.name} projection is not yet implemented`);const ve=ye.getFreeCameraOptions().position;if(!ne.modelManager)return;const xe=ne.modelManager;me.modelManager=xe;const Se=ne.shadowRenderer;if(!me._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ce=me._unevaluatedLayout._values["model-id"],Ke=Object.assign({},me.layout.get("model-id").parameters),Ge=ne.style.order.indexOf(me.fqid);for(const ct of fe){const _t=ce.getTile(ct).getBucket(me);if(!_t||_t.projection.name!==ye.projection.name)continue;const Ct=_t.getModelUris();Ct&&!_t.modelsRequested&&(xe.addModelsFromBucket(Ct,we),_t.modelsRequested=!0);const Ve=nf(ct,ye);Ke.zoom=Ve;const ut=Ce.possiblyEvaluate(Ke);if($l(ne,_t,ct),ns.shadowUniformsInitialized=!1,ns.useSingleShadowCascade=!!Se&&Se.getMaxCascadeForTile(ct.toUnwrapped())===0,ne.renderPass==="shadow"&&Se){if(ne.currentShadowCascade===1&&_t.isInsideFirstShadowMapFrustum)continue;const nt=ye.calculatePosMatrix(ct.toUnwrapped(),ye.worldSize);if(ns.tileMatrix.set(nt),ns.shadowTileMatrix=Float32Array.from(Se.calculateShadowPassMatrixFromMatrix(nt)),ns.aabb.min.fill(0),ns.aabb.max[0]=ns.aabb.max[1]=r.ai,ns.aabb.max[2]=0,Xh(_t,ns,ne,me.scope))continue}const Ne=1<<ct.canonical.z,ht=[((ve.x-ct.wrap)*Ne-ct.canonical.x)*r.ai,(ve.y*Ne-ct.canonical.y)*r.ai,ve.z*Ne*r.ai];ne.conflationActive&&Object.keys(_t.instancesPerModel).length>0&&ne.style.isLayerClipped(me,ce.getSource())&&_t.updateReplacement(ct,ne.replacementSource,Ge,we)&&(_t.uploaded=!1,_t.upload(ne.context));for(let nt in _t.instancesPerModel){const yt=_t.instancesPerModel[nt];yt.features.length>0&&(nt=ut.evaluate(yt.features[0].feature,{}));const et=xe.getModel(nt,we);if(et&&et.uploaded)for(const gt of et.nodes)xs(ne,me,gt,yt,ht,ct,ns)}}}(h,t,n,u,P.type==="vector"?n.scope:""),void L();if(!P.loaded())return;if(P.type==="batched-model")return function(ne,ce,me,fe){me.resetLayerRenderingStats(ne);const we=ne.context,ye=ne.transform,ve=ne.style.fog,xe=ne.shadowRenderer;if(ye.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ye.projection.name} projection is not yet implemented`);const Se=ne.transform.getFreeCameraOptions().position,Ce=r.ad.vec3.scale([],[Se.x,Se.y,Se.z],ne.transform.worldSize),Ke=r.ad.vec3.negate([],Ce),Ge=r.ad.mat4.identity([]),ct=r.dm(ye.center.lat,ye.zoom),_t=r.ad.mat4.fromScaling([],[1,1,1/ct]);r.ad.mat4.translate(Ge,Ge,Ke);const Ct=me.paint.get("model-opacity").constantOr(1),Ve=new mi(we.gl.LEQUAL,mi.ReadWrite,ne.depthRangeFor3D),ut=new mi(we.gl.LEQUAL,mi.ReadOnly,ne.depthRangeFor3D),Ne=new r.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ht=ne.renderPass==="shadow",nt=ht&&xe?xe.getCurrentCascadeFrustum():ye.getFrustum(ye.scaleZoom(ye.worldSize)),yt=me.paint.get("model-front-cutoff"),et=yt[2]<1,gt=Wo(ne,me.paint.get("model-cutoff-fade-range")),Vt=me.getLayerRenderingStats();(function(Ut,Gt,oi,Di){const xi=Ut.terrain?Ut.terrain.exaggeration():0,Ri=Ut.transform.zoom;for(const Ci of Di){const on=Gt.getTile(Ci).getBucket(oi);on&&(on.setFilter(oi.filter),Ut.conflationActive&&on.updateReplacement(Ci,Ut.replacementSource),on.evaluateScale(Ut,oi),Ut.terrain&&xi>0&&on.elevationUpdate(Ut.terrain,xi,Ci,oi.source),on.needsReEvaluation(Ut,Ri,oi)&&on.evaluate(oi))}})(ne,ce,me,fe),function(){let Ut,Gt,oi;et?(Ut=fe.length-1,Gt=-1,oi=-1):(Ut=0,Gt=fe.length,oi=1);const Di=new Float64Array(16),xi=r.ad.vec3.create(),Ri=new r.P(0,0);for(let Ci=Ut;Ci!==Gt;Ci+=oi){const on=fe[Ci],Sn=ce.getTile(on).getBucket(me);if(!Sn||!Sn.uploaded)continue;let Gi=!1;xe&&(Gi=xe.getMaxCascadeForTile(on.toUnwrapped())===0);const Ti=ye.calculatePosMatrix(on.toUnwrapped(),ye.worldSize),Fi=Sn.modelTraits;!ht&&et&&(r.ad.mat4.invert(Di,Ti),r.ad.vec3.transformMat4(xi,Ce,Di),Ri.x=xi[0],Ri.y=xi[1]);const li=[];Sn.setFilter(me.filter);for(const jt of Sn.getNodesInfo()){if(jt.hiddenByReplacement||!jt.node.meshes)continue;const Hi=jt.node;let pn=0;ne.terrain&&Hi.elevation&&(pn=Hi.elevation*ne.terrain.exaggeration());const hn=(()=>{const fn=jt.aabb;return Ne.min=[...fn.min],Ne.max=[...fn.max],Ne.min[2]+=pn,Ne.max[2]+=pn,r.ad.vec3.transformMat4(Ne.min,Ne.min,Ti),r.ad.vec3.transformMat4(Ne.max,Ne.max,Ti),Ne})(),hr=jt.evaluatedScale;if(hr[0]<=1&&hr[1]<=1&&hr[2]<=1&&hn.intersects(nt)===0)continue;if(!ht&&et){const fn=.16666666666666666;jt.cameraCollisionOpacity=Ce[0]>hn.min[0]&&Ce[0]<hn.max[0]&&Ce[1]>hn.min[1]&&Ce[1]<hn.max[1]&&Ce[2]*ct<hn.max[2]&&Hi.footprint&&r.bA(Ri,Hi.footprint)?Math.max(jt.cameraCollisionOpacity-fn,0):Math.min(1,jt.cameraCollisionOpacity+fn)}const rr=[...Ti],Pn=Hi.anchor?Hi.anchor[0]:0,vr=Hi.anchor?Hi.anchor[1]:0;r.ad.mat4.translate(rr,rr,[Pn*(hr[0]-1),vr*(hr[1]-1),pn]),r.ad.vec3.exactEquals(hr,r.dq)||r.ad.mat4.scale(rr,rr,hr);const fa=r.ad.mat4.multiply([],rr,Hi.matrix),pa=r.ad.mat4.multiply([],ye.expandedFarZProjMatrix,fa),Ki=r.ad.mat4.multiply([],ye.expandedFarZProjMatrix,rr),Zn=r.ad.vec4.transformMat4([],[Pn,vr,pn,1],pa)[2];Hi.hidden=!1;let mn=Ct;ht||(et&&(mn*=jt.cameraCollisionOpacity,mn*=rf(rr,ye,jt.aabb,yt)),mn*=Yh(gt,Zn)),mn!==0?li.push({nodeInfo:jt,depth:Zn,opacity:mn,wvpForNode:pa,wvpForTile:Ki,nodeModelMatrix:fa,tileModelMatrix:rr}):Hi.hidden=!0}ht||li.sort((jt,Hi)=>!et||jt.opacity===1&&Hi.opacity===1?jt.depth<Hi.depth?-1:1:jt.opacity===1?-1:Hi.opacity===1?1:jt.depth>Hi.depth?-1:1);for(const jt of li){const Hi=jt.nodeInfo,pn=Hi.node;let hn=r.ad.mat4.multiply([],_t,jt.tileModelMatrix);r.ad.mat4.multiply(hn,Ge,hn);const hr=r.ad.mat4.invert([],hn);r.ad.mat4.transpose(hr,hr),r.ad.mat4.scale(hr,hr,Ys),hn=r.ad.mat4.multiply(hn,hn,pn.matrix);const rr=ne.renderPass==="light-beam",Pn=me.paint.get("model-color-use-theme").constantOr("default")==="none",vr=Fi&r.ds.HasMapboxMeshFeatures,fa=vr?0:Hi.evaluatedRMEA[0][2];for(let pa=0;pa<pn.meshes.length;++pa){const Ki=pn.meshes[pa],Zn=pa===pn.lightMeshIndex;let mn=jt.wvpForNode;if(Zn){if(!rr&&!ne.terrain&&ne.shadowRenderer){ne.currentLayer<ne.firstLightBeamLayer&&(ne.firstLightBeamLayer=ne.currentLayer);continue}mn=jt.wvpForTile}else if(rr)continue;const fn={defines:[]},ea=[];if(!ht&&xe&&(xe.useNormalOffset=!!Ki.normalBuffer),Uc(fn.defines,ea,Ki,ne,Pn?null:me.lut),vr||fn.defines.push("DIFFUSE_SHADED"),Gi&&fn.defines.push("SHADOWS_SINGLE_CASCADE"),Vt&&(ht?Vt.numRenderedVerticesInShadowPass+=Ki.vertexArray.length:Vt.numRenderedVerticesInTransparentPass+=Ki.vertexArray.length),ht){Fu(Ki,jt.nodeModelMatrix,ne,me);continue}let Qn=null;if(ve){const Oa=Bo(jt.nodeModelMatrix,ne.transform);if(Qn=new Float32Array(Oa),ye.projection.name!=="globe"){const ma=Ki.aabb.min,_o=Ki.aabb.max,[eo,jo]=ve.getOpacityForBounds(Oa,ma[0],ma[1],_o[0],_o[1]);fn.overrideFog=eo>=Ht||jo>=Ht}}const Dr=Ki.material;let Ls;Dr.occlusionTexture&&Dr.occlusionTexture.offsetScale&&(Ls=Dr.occlusionTexture.offsetScale,fn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ta=ne.getOrCreateProgram("model",fn);!ht&&xe&&xe.setupShadowsFromMatrix(jt.tileModelMatrix,ta,xe.useNormalOffset),ne.uploadCommonUniforms(we,ta,null,Qn);const xr=Dr.pbrMetallicRoughness;xr.metallicFactor=.9,xr.roughnessFactor=.5;const $r=Bc(new Float32Array(mn),new Float32Array(hn),new Float32Array(hr),new Float32Array(pn.matrix),ne,jt.opacity,xr.baseColorFactor.toRenderColor(null),Dr.emissiveFactor,xr.metallicFactor,xr.roughnessFactor,Dr,fa,me,[0,0,0],Ls);!Zn&&(Hi.hasTranslucentParts||jt.opacity<1)&&ta.draw(ne,we.gl.TRIANGLES,Ve,Ni.disabled,en.disabled,Ii.backCCW,$r,me.id,Ki.vertexBuffer,Ki.indexBuffer,Ki.segments,me.paint,ne.transform.zoom,void 0,ea),ta.draw(ne,we.gl.TRIANGLES,Zn?ut:Ve,Ni.disabled,Zn||jt.opacity<1||Hi.hasTranslucentParts?en.alphaBlended:en.unblended,Ii.backCCW,$r,me.id,Ki.vertexBuffer,Ki.indexBuffer,Ki.segments,me.paint,ne.transform.zoom,void 0,ea)}}}}()}(h,t,n,u),void L();if(P.type!=="model")return;const k=P.getModels(),U=[],j=h.transform.getFreeCameraOptions().position,$=r.ad.vec3.scale([],[j.x,j.y,j.z],h.transform.worldSize);r.ad.vec3.negate($,$);const Q=[],W=[];let te=0;for(const ne of k){const ce=n.paint.get("model-rotation").constantOr(null),me=n.paint.get("model-scale").constantOr(null),fe=n.paint.get("model-translation").constantOr(null);ne.computeModelMatrix(h,ce,me,fe,!0,!0,!1);const we=r.ad.mat4.identity([]),ye=r.dm(ne.position.lat,h.transform.zoom),ve=r.ad.mat4.fromScaling([],[1,1,1/ye]);r.ad.mat4.translate(we,we,$),U.push({zScaleMatrix:ve,negCameraPosMatrix:we});for(const xe of ne.nodes)jc(h.transform,xe,ne.matrix,h.transform.expandedFarZProjMatrix,te,Q,W);te++}if(Q.sort((ne,ce)=>ce.depth-ne.depth),h.renderPass!=="shadow"){if(p===1)for(const ne of W)No(ne,h,n,U[ne.modelIndex],Ni.disabled,h.colorModeForRenderPass());else{for(const ne of W)No(ne,h,n,U[ne.modelIndex],Ni.disabled,en.disabled);for(const ne of W)No(ne,h,n,U[ne.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const ne of Q)No(ne,h,n,U[ne.modelIndex],Ni.disabled,h.colorModeForRenderPass());L()}else{for(const ne of W)Fu(ne.mesh,ne.nodeModelMatrix,h,n);for(const ne of Q)Fu(ne.mesh,ne.nodeModelMatrix,h,n);L()}}},hf={line:function(h,t,n){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const g=t.getTile(p).getBucket(h);if(g&&(g.hasZOffset?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,n){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,u.type==="vector"?h.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const g of p)g.upload(n.context)},raster:function(h,t,n){const u=t.getSource();if(!(u instanceof Mo&&u.loaded()))return;const p=h.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const g=h.paint.get("raster-array-band")||u.getInitialBand(p);if(g==null)return;const b=t.getIds().map(I=>t.getTileByID(I));for(const I of b)I.updateNeeded(p,g)&&u.prepareTile(I,p,g)},"raster-particle":function(h,t,n){const u=t.getSource();if(!(u instanceof Mo&&u.loaded()))return;const p=h.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const g=h.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(g==null)return;const b=t.getIds().map(I=>t.getTileByID(I));for(const I of b)I.updateNeeded(p,g)&&u.prepareTile(I,p,g)}},ed={fill:Ul};class Yl{constructor(t,n,u,p,g){this.context=new Po(t,n),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const b=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const L of b)this._debugParams.enabledLayers[L]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of b)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new sf(g),this.setup(),this.numSublayers=Wa.maxUnderzooming+Wa.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ko(this),this._wireframeDebugCache=new Xl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p}updateTerrain(t,n){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ud(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,n),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=n.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const g=u+.78*(p-u);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ud(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*r.q.devicePixelRatio,this.height=n*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,n=new r.b5;n.emplaceBack(0,0),n.emplaceBack(r.ai,0),n.emplaceBack(0,r.ai),n.emplaceBack(r.ai,r.ai),this.tileExtentBuffer=t.createVertexBuffer(n,r.b7.members),this.tileExtentSegments=r.b8.simpleSegment(0,0,4,2);const u=new r.b5;u.emplaceBack(0,0),u.emplaceBack(r.ai,0),u.emplaceBack(0,r.ai),u.emplaceBack(r.ai,r.ai),this.debugBuffer=t.createVertexBuffer(u,r.b7.members),this.debugSegments=r.b8.simpleSegment(0,0,4,5);const p=new r.b5;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,r.b7.members),this.viewportSegments=r.b8.simpleSegment(0,0,4,2);const g=new r.aU;g.emplaceBack(0,0,0,0),g.emplaceBack(r.ai,0,r.ai,0),g.emplaceBack(0,r.ai,0,r.ai),g.emplaceBack(r.ai,r.ai,r.ai,r.ai),this.mercatorBoundsBuffer=t.createVertexBuffer(g,r.ba.members),this.mercatorBoundsSegments=r.b8.simpleSegment(0,0,4,2);const b=new r.aV;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const I=new r.b6;for(const P of[0,1,3,2,0])I.emplaceBack(P);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new r.T(t,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.ad.mat4.create();const L=this.context.gl;this.stencilClearMode=new Ni({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,mi.disabled,this.stencilClearMode,en.disabled,Ii.disabled,Dc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,u){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const L of u)if(this._tileClippingMaskIDs[L.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=n.id;const p=this.context,g=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(en.disabled),p.setDepthMode(mi.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of u){const L=n.getTile(I),P=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:U,tileBoundsSegments:j}=this.getTileBoundsBuffers(L);b.draw(this,g.TRIANGLES,mi.disabled,new Ni({func:g.ALWAYS,mask:0},P,255,g.KEEP,g.KEEP,g.REPLACE),en.disabled,Ii.disabled,Dc(I.projMatrix),"$clipping",k,U,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Ni({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new Ni({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,u=t.sort((b,I)=>I.overscaledZ-b.overscaledZ),p=u[u.length-1].overscaledZ,g=u[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const b={};for(let I=0;I<g;I++)b[I+p]=new Ni({func:n.GEQUAL,mask:255},I+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=g,[b,u]}return[{[p]:Ni.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new en([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?en.unblended:en.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new en([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new r.al(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,u,p=!1){if(this.depthOcclusion)return new mi(this.context.gl.GREATER,mi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return mi.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new mi(u||this.context.gl.LEQUAL,n,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&u!==0&&(this.depthFBO=new Da(this.context,n,u,!1,"texture"),this.depthTexture=new r.T(this.context,{width:n,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,u,0,0,n,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const u=r.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const p=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(g).filter(Ve=>{const ut=p[Ve];return!(ut.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ut.type]});let I=b(),L=!1,P=!1;for(const Ve of I){const ut=p[Ve];ut.type==="circle"&&(L=!0),ut.type==="symbol"&&(ut.hasInitialOcclusionOpacityProperties?P=!0:L=!0)}let k=I.map(Ve=>p[Ve]);const U=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let j=0,$=!1;for(const Ve in U){const ut=U[Ve];ut.used&&(ut.prepare(this.context),ut.getSource().usedInConflation&&++j)}let Q=!1;for(const Ve of k)Ve.isHidden(this.transform.zoom)||(Ve.type==="clip"&&(Q=!0),this.prepareLayer(Ve));const W={},te={},ne={},ce={},me={};for(const Ve in U){const ut=U[Ve];W[Ve]=ut.getVisibleCoordinates(),te[Ve]=W[Ve].slice().reverse(),ne[Ve]=ut.getVisibleCoordinates(!0).reverse(),ce[Ve]=ut.getShadowCasterCoordinates(),me[Ve]=ut.sortCoordinatesByDistance(W[Ve])}const fe=Ve=>{const ut=this.style.getLayerSourceCache(Ve);return ut&&ut.used?ut.getSource():null};if(j||Q||this._clippingActiveLastFrame){const Ve=[],ut=[];let Ne=0;for(const ht of k)this.isSourceForClippingOrConflation(ht,fe(ht))&&(Ve.push(ht),ut.push(Ne)),Ne++;if(Ve&&(Q||Ve.length>1)||this._clippingActiveLastFrame){Q=!1;const ht=[];for(let nt=0;nt<Ve.length;nt++){const yt=Ve[nt],et=ut[nt],gt=this.style.getLayerSourceCache(yt);if(!gt||!gt.used||!gt.getSource().usedInConflation&&yt.type!=="clip")continue;let Vt=r.dA,Ut=r.by.None;const Gt=[];let oi=!0;if(yt.type==="clip"){Vt=et;for(const Di of yt.layout.get("clip-layer-types"))Ut|=Di==="model"?r.by.Model:Di==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(const Di of yt.layout.get("clip-layer-scope"))Gt.push(Di);yt.isHidden(this.transform.zoom)?oi=!1:Q=!0}oi&&ht.push({layer:yt.fqid,cache:gt,order:Vt,clipMask:Ut,clipScope:Gt})}this.replacementSource.setSources(ht),$=!0}}this._clippingActiveLastFrame=Q,$||this.replacementSource.clear(),this.conflationActive=$,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ve=0;Ve<k.length;Ve++){const ut=k[Ve],Ne=ut.cutoffRange();if(this.longestCutoffRange=Math.max(Ne,this.longestCutoffRange),Ne>0){const ht=fe(ut);ht&&(this.minCutoffZoom=Math.max(ht.minzoom,this.minCutoffZoom)),ut.minzoom&&(this.minCutoffZoom=Math.max(ut.minzoom,this.minCutoffZoom))}ut.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ve),this._lastOcclusionLayer=Ve)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ne),this.opaquePassCutoff=0,I=b(),k=I.map(Ve=>p[Ve]));const ye=this._shadowRenderer;if(ye){ye.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ve in U)for(const ut of W[Ve]){let Ne={min:0,max:0};this.terrain&&(Ne=this.terrain.getMinMaxForTile(ut)||Ne),ye.addShadowReceiver(ut.toUnwrapped(),Ne.min,Ne.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new up(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ve&&!this._snow&&(this._snow=new qc(this)),!ve&&this._snow&&(this._snow.destroy(),delete this._snow),xe&&!this._rain&&(this._rain=new Jh(this)),!xe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!us.has(this.context.gl))return;this.renderPass="offscreen";for(const Ve of k){const ut=t.getLayerSourceCache(Ve);if(!Ve.hasOffscreenPass()||Ve.isHidden(this.transform.zoom))continue;const Ne=ut?te[ut.id]:void 0;(Ve.type==="custom"||Ve.type==="raster"||Ve.type==="raster-particle"||Ve.isSky()||Ne&&Ne.length)&&this.renderLayer(this,ut,Ve,Ne)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ce=(()=>{if(n.showOverdrawInspector)return r.al.black;const Ve=this.style.fog;if(Ve&&this.transform.projection.supportsFog){const ut=this.style.getLut(Ve.scope);if(!Se){const Ne=Ve.properties.get("color-use-theme")==="none",ht=Ve.properties.get("color").toRenderColor(Ne?null:ut).toArray01();return new r.al(...ht)}if(Se){const Ne=Ve.properties.get("space-color-use-theme")==="none",ht=Ve.properties.get("space-color").toRenderColor(Ne?null:ut).toArray01();return new r.al(...ht)}}return r.al.transparent})();if(this.context.clear({color:Ce,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Ve=k[this.currentLayer],ut=t.getLayerSourceCache(Ve);if(Ve.isSky())continue;const Ne=ut?(Ve.is3D(g)?me:te)[ut.id]:void 0;this._renderTileClippingMasks(Ve,ut,Ne),this.renderLayer(this,ut,Ve,Ne)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Ve=k[this.currentLayer],ut=t.getLayerSourceCache(Ve);Ve.isSky()&&this.renderLayer(this,ut,Ve,ut?te[ut.id]:void 0)}function Ke(Ve,ut){let Ne;return ut&&(Ne=(Ve.type==="symbol"?ne:Ve.is3D(g)?me:te)[ut.id]),Ne}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Ve=k[this.currentLayer];if(Ve.type==="raster"||Ve.type==="raster-particle"){const ut=t.getLayerSourceCache(Ve);this.renderLayer(this,ut,Ve,Ke(Ve,ut))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ge=0;ye&&(Ge=ye.getShadowCastingLayerCount());let ct=!1,_t=-1;for(let Ve=0;Ve<I.length;++Ve){const ut=k[Ve];ut.isHidden(this.transform.zoom)||ut.is3D(g)&&(_t=Ve)}P&&_t===-1&&(L=!0);let Ct=!1;for(;this.currentLayer<I.length;){const Ve=k[this.currentLayer],ut=t.getLayerSourceCache(Ve);if(Ve.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ve)){if(Ve.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ct&&Ve.is3D(g)&&!g){const Ne=this.currentLayer,ht=nt=>{for(this.currentLayer=0;this.currentLayer<k.length;this.currentLayer++){const yt=k[this.currentLayer];if(ed[yt.type]){const et=this.style.getLayerSourceCache(yt);ed[yt.type](this,et,yt,Ke(yt,et),nt)}}};ht("initialize"),ht("reset"),this.currentLayer=Ne,Ct=!0}if(L&&!ct&&this.terrain&&!this.transform.isOrthographic&&(ct=!0,this.blitDepth()),P&&_t!==-1&&this.currentLayer===_t+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ve,ut,ut?W[ut.id]:void 0),this.renderLayer(this,ut,Ve,Ke(Ve,ut)),!this.terrain&&ye&&Ge>0&&Ve.hasShadowPass()&&--Ge==0&&(ye.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ne=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ne;this.currentLayer++){const ht=k[this.currentLayer];if(!ht.hasLightBeamPass())continue;const nt=t.getLayerSourceCache(ht);this.renderLayer(this,nt,ht,nt?te[nt.id]:void 0)}this.currentLayer=Ne,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ne=this.currentLayer;this.depthOcclusion=!0;for(const ht of this.layersWithOcclusionOpacity){this.currentLayer=ht;const nt=k[this.currentLayer],yt=t.getLayerSourceCache(nt),et=yt?te[yt.id]:void 0;this.terrain||this._renderTileClippingMasks(nt,yt,yt?W[yt.id]:void 0),this.renderLayer(this,yt,nt,et)}this.depthOcclusion=!1,this.currentLayer=Ne,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ve=null;k.forEach(ut=>{const Ne=t.getLayerSourceCache(ut);Ne&&!ut.isHidden(this.transform.zoom)&&Ne.getVisibleCoordinates().length&&(!Ve||Ve.getSource().maxzoom<Ne.getSource().maxzoom)&&(Ve=Ne)}),Ve&&this.options.showTileBoundaries&&Qh.debug(this,Ve,Ve.getVisibleCoordinates(),r.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Qh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ve){const ut=Ve.transform.padding;ef(Ve,Ve.transform.height-(ut.top||0),3,vs),ef(Ve,ut.bottom||0,3,Jd),tf(Ve,ut.left||0,3,cp),tf(Ve,Ve.transform.width-(ut.right||0),3,Qd);const Ne=Ve.transform.centerPoint;(function(ht,nt,yt,et){Hl(ht,nt-1,yt-10,2,20,et),Hl(ht,nt-10,yt-1,20,2,et)})(Ve,Ne.x,Ve.transform.height-Ne.y,Zh)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),$||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,u=!n||!n.includes(t.type);if(hf[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);hf[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,n,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Qh[u.type](t,n,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(n.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,u=n.createQuery();this.deferredRenderGpuTimeQueries.push(u),n.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const u in t){const p=t[u],g=this.context.extTimerQuery,b=g.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(p.query),n[u]=b}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let u=0;for(const p of t)u+=n.getQueryParameter(p,n.QUERY_RESULT)/1e6,n.deleteQuery(p);return u}translatePosMatrix(t,n,u,p,g){if(!u[0]&&!u[1])return t;const b=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(b){const P=Math.sin(b),k=Math.cos(b);u=[u[0]*k-u[1]*P,u[0]*P+u[1]*k]}const I=[g?u[0]:r.at(n,u[0],this.transform.zoom),g?u[1]:r.at(n,u[1],this.transform.zoom),0],L=new Float32Array(16);return r.ad.mat4.translate(L,t,I),L}saveTileTexture(t){const n=t.size[0],u=this._tileTextures[n];u?u.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||p||n!==void 0&&!n||g.push("FOG","FOG_DITHERING"),p&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,n){this.cache=this.cache||{};const u=n&&n.defines||[],p=n&&n.config,g=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(u),b=zc.cacheKey(Ac[t],t,g,p);return this.cache[b]||(this.cache[b]=new zc(this.context,t,Ac[t],p,Xd[t],g)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const g=((b,I,L)=>{const P=b.properties.get("direction"),k=b.properties.get("color-use-theme")==="none",U=b.properties.get("color").toRenderColor(k?null:L.getLut(b.scope)).toArray01(),j=b.properties.get("intensity"),$=I.properties.get("color-use-theme")==="none",Q=I.properties.get("color").toRenderColor($?null:L.getLut(I.scope)).toArray01(),W=I.properties.get("intensity"),te=[P.x,P.y,P.z],ne=r.cN(Q,W),ce=r.cN(U,j);return{u_lighting_ambient_color:ne,u_lighting_directional_dir:te,u_lighting_directional_color:ce,u_ground_radiance:Ou(te,ce,ne)}})(u,p,this.style);n.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,n,u,p,g){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const I=b.getOpacity(this.transform.pitch),L=((P,k,U,j,$,Q,W,te,ne,ce,me,fe)=>{const we=P.transform,ye=k.properties.get("color-use-theme")==="none",ve=k.properties.get("color").toRenderColor(ye?null:P.style.getLut(k.scope)).toArray01();ve[3]=j;const xe=P.frameCounter/1e3%1,[Se,Ce]=k.properties.get("vertical-range");return{u_fog_matrix:U?we.calculateFogTileMatrix(U):fe||P.identityMat,u_fog_range:k.getFovAdjustedRange(we._fov),u_fog_color:ve,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Se,Ce),Ce],u_fog_temporal_offset:xe,u_frustum_tl:$,u_frustum_tr:Q,u_frustum_br:W,u_frustum_bl:te,u_globe_pos:ne,u_globe_radius:ce,u_viewport:me,u_globe_transition:r.ag(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,b,u,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],p);n.setFogUniformValues(t,L)}g&&n.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)n[p.key]=t[p.key]||new Vs(p,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=Ht||n[1]>=Ht}setupDepthForOcclusion(t,n,u){const p=this.context,g=p.gl,b=!!u;var I;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),p.activeTexture.set(g.TEXTURE0),b||n.setTerrainUniformValues(p,u)}}function ju(h,t){let n=!1,u=null;const p=()=>{u=null,n&&(h(),u=setTimeout(p,t),n=!1)};return()=>(n=!0,u||p(),u)}class qu{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ju(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=df(t);if(this._hashName){const u=this._hashName;let p=!1;const g=location.hash.slice(1).split("&").map(b=>{const I=b.split("=")[0];return I===u?(p=!0,`${I}=${n}`):b}).filter(b=>b);return p||g.push(`${u}=${n}`),`#${g.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(n=u)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(u=>isNaN(u))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function df(h,t){const n=h.getCenter(),u=Math.round(100*h.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),b=Math.round(n.lng*g)/g,I=Math.round(n.lat*g)/g,L=h.getBearing(),P=h.getPitch();let k=t?`/${b}/${I}/${u}`:`${u}/${I}/${b}`;return(L||P)&&(k+="/"+Math.round(10*L)/10),P&&(k+=`/${Math.round(P)}`),k}const Gu={linearity:.3,easing:r.dB(0,0,.3,1)},td=r.l({deceleration:2500,maxSpeed:1400},Gu),hp=r.l({deceleration:20,maxSpeed:1400},Gu),dp=r.l({deceleration:1e3,maxSpeed:360},Gu),Tm=r.l({deceleration:1e3,maxSpeed:90},Gu);class Gc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=r.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)n.zoom+=g.zoomDelta||0,n.bearing+=g.bearingDelta||0,n.pitch+=g.pitchDelta||0,g.panDelta&&n.pan._add(g.panDelta),g.around&&(n.around=g.around),g.pinchAround&&(n.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(n.pan.mag()){const g=Wl(n.pan.mag(),u,r.l({},td,t||{}));p.offset=n.pan.mult(g.amount/n.pan.mag()),p.center=this._map.transform.center,ll(p,g)}if(n.zoom){const g=Wl(n.zoom,u,hp);p.zoom=this._map.transform.zoom+g.amount,ll(p,g)}if(n.bearing){const g=Wl(n.bearing,u,dp);p.bearing=this._map.transform.bearing+r.ay(g.amount,-179,179),ll(p,g)}if(n.pitch){const g=Wl(n.pitch,u,Tm);p.pitch=this._map.transform.pitch+g.amount,ll(p,g)}if(p.zoom||p.bearing){const g=n.pinchAround===void 0?n.around:n.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function ll(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Wl(h,t,n){const{maxSpeed:u,linearity:p,deceleration:g}=n,b=r.ay(h*p/(t/1e3),-u,u),I=Math.abs(b)/(g*p);return{easing:n.easing,duration:1e3*I,amount:b*(I/2)}}class Ta extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u,p={}){const g=hi(n.getCanvasContainer(),u),b=n.unproject(g);super(t,r.l({point:g,lngLat:b,originalEvent:u},p)),this._defaultPrevented=!1,this.target=n}}class Kl extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){const p=t==="touchend"?u.changedTouches:u.touches,g=Mi(n.getCanvasContainer(),p),b=g.map(L=>n.unproject(L)),I=g.reduce((L,P,k,U)=>L.add(P.div(U.length)),new r.P(0,0));super(t,{points:g,point:I,lngLats:b,lngLat:n.unproject(I),originalEvent:u}),this._defaultPrevented=!1}}class fp extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class pp{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new fp(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Ta(t.type,this._map,t))}mouseup(t){this._map.fire(new Ta(t.type,this._map,t))}preclick(t){const n=r.l({},t);n.type="preclick",this._map.fire(new Ta(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Ta(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Ta(t.type,this._map,t))}mouseover(t){this._map.fire(new Ta(t.type,this._map,t))}mouseout(t){this._map.fire(new Ta(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Kl(t.type,this._map,t))}touchmove(t){this._map.fire(new Kl(t.type,this._map,t))}touchend(t){this._map.fire(new Kl(t.type,this._map,t))}touchcancel(t){this._map.fire(new Kl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hu{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Ta(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ta("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Ta(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sm{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(Tt(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const u=n,p=this._startPos,g=this._lastPos;if(!p||!g||g.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Fe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(p.x,u.x),I=Math.max(p.x,u.x),L=Math.min(p.y,u.y),P=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${L}px)`,this._box.style.width=I-b+"px",this._box.style.height=P-L+"px")})}mouseupWindow(t,n){if(!this._active)return;const u=this._startPos,p=n;if(u&&t.button===0){if(this.reset(),ot(),u.x!==p.x||u.y!==p.y)return this._map.fire(new r.A("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),kt(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new r.A(t,{originalEvent:n}))}}function On(h,t){const n={};for(let u=0;u<h.length;u++)n[h[u].identifier]=t[u];return n}class po{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const g=new r.P(0,0);for(const b of p)g._add(b);return g.div(p.length)}(n),this.touches=On(u,n)))}touchmove(t,n,u){if(this.aborted||!this.centroid)return;const p=On(u,n);for(const g in this.touches){const b=p[g];(!b||b.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,n,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Vo{constructor(t){this.singleTap=new po(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,u){this.singleTap.touchstart(t,n,u)}touchmove(t,n,u){this.singleTap.touchmove(t,n,u)}touchend(t,n,u){const p=this.singleTap.touchend(t,n,u);if(p){const g=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(p)<30;if(g&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Em{constructor(){this._zoomIn=new Vo({numTouches:1,numTaps:2}),this._zoomOut=new Vo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,u){this._zoomIn.touchstart(t,n,u),this._zoomOut.touchstart(t,n,u)}touchmove(t,n,u){this._zoomIn.touchmove(t,n,u),this._zoomOut.touchmove(t,n,u)}touchend(t,n,u){const p=this._zoomIn.touchend(t,n,u),g=this._zoomOut.touchend(t,n,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ws={0:1,2:2},mo={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class jr{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const u=ti(t);this._correctButton(t,u)&&(this._lastPoint=n,this._eventButton=u)}mousemoveWindow(t,n){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,g){const b=Ws[g];return p.buttons===void 0||(p.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(u,n)}}mouseupWindow(t){this._lastPoint&&ti(t)===this._eventButton&&(this._moved&&ot(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hc extends jr{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class Ks extends jr{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?mo[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const u=.8*(n.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Zc extends jr{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?mo[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const u=-.5*(n.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Tr{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),r.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,n,u){return this._calculateTransform(t,n,u)}touchmove(t,n,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!r.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,u)}}touchend(t,n,u){this._calculateTransform(t,n,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,u){u.length>0&&(this._active=!0);const p=On(u,n),g=new r.P(0,0),b=new r.P(0,0);let I=0;for(const P in p){const k=p[P],U=this._touches[P];U&&(g._add(k),b._add(k.sub(U)),I++,p[P]=k)}if(this._touches=p,I<this._minTouches||!b.mag())return;const L=b.div(I);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(I),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class zs{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,u){return{}}touchstart(t,n,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[g,b]=p,I=Js(u,n,g),L=Js(u,n,b);if(!I||!L)return;const P=this._aroundCenter?null:I.add(L).div(2);return this._move([I,L],P,t)}touchend(t,n,u){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,b=Js(u,n,p),I=Js(u,n,g);b&&I||(this._active&&ot(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Js(h,t,n){for(let u=0;u<h.length;u++)if(h[u].identifier===n)return t[u]}function Jl(h,t){return Math.log(h/t)/Math.LN2}class mp extends zs{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jl(this._distance,u),pinchAround:n}}}function _p(h,t){return 180*h.angleWith(t)/Math.PI}class Zu extends zs{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:_p(this._vector,u),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=_p(t,u);return Math.abs(p)<n}}function $u(h){return Math.abs(h.y)>Math.abs(h.x)}class Am extends zs{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,$u(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,u){const p=this._lastPoints;if(!p)return;const g=t[0].sub(p[0]),b=t[1].sub(p[1]);return this._map._cooperativeGestures&&!r.dC()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(g,b,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5})}gestureBeginsVertically(t,n,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=n.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const b=t.y>0==n.y>0;return $u(t)&&$u(n)&&b}}const id={panStep:100,bearingStep:15,pitchStep:10};class ff{constructor(){const t=id;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,u=0,p=0,g=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:I=>{const L=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Xu,zoom:n?Math.round(L)+n*(t.shiftKey?2:1):L,bearing:I.getBearing()+u*this._bearingStep,pitch:I.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-b*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xu(h){return h*(2-h)}const $c=4.000244140625,Uo=1/450;class yr{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Uo,r.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=r.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,n!==0&&n%$c==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=hi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>$c?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&k!==0&&(k=1/k);const U=n(),j=Math.pow(2,U),$=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom($*k))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:n(),p=this._startZoom,g=this._easing;let b,I=!1;if(this._type==="wheel"&&p&&g){const P=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),k=g(P);b=r.ah(p,u,k),P<1?this._frameId||(this._frameId=!0):I=!0}else b=u,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let L=b-n();return L*this._lastDelta<0&&(L=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:L,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=r.dD;if(this._prevEase){const u=this._prevEase,p=(r.q.now()-u.start)/u.duration,g=u.easing(p+.01)-u.easing(p),b=.27/Math.sqrt(g*g+1e-4)*.01,I=Math.sqrt(.0729-b*b);n=r.dB(b,I,.25,1)}return this._prevEase={start:r.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class kr{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ql{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cl{constructor(){this._tap=new Vo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=n[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,n,u))}touchmove(t,n,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=n[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,n,u)}touchend(t,n,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,n,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mm{constructor(t,n,u){this._el=t,this._mousePan=n,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Cm{constructor(t,n,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Im{constructor(t,n,u,p){this._el=t,this._touchZoom=n,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xc=h=>h.zoom||h.drag||h.pitch||h.rotate;class pf extends r.A{}class La{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const u=r.ad.vec3.sub([],n,t);this.radius=r.ad.vec3.length(u[2]<0?r.ad.vec3.div([],u,this.constants):[u[0],u[1],0])}projectRay(t){r.ad.vec3.div(t,t,this.constants),r.ad.vec3.normalize(t,t),r.ad.vec3.mul(t,t,this.constants);const n=r.ad.vec3.scale([],t,this.radius);if(n[2]>0){const u=r.ad.vec3.scale([],[0,0,1],r.ad.vec3.dot(n,[0,0,1])),p=r.ad.vec3.scale([],r.ad.vec3.normalize([],[n[0],n[1],0]),this.radius),g=r.ad.vec3.add([],n,r.ad.vec3.scale([],r.ad.vec3.sub([],r.ad.vec3.add([],p,u),n),2));n[0]=g[0],n[1]=g[1]}return n}}function Yc(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class gp{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gc(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new La,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),r.aQ(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,b]of this._listeners){const I=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(g,I,b)}}destroy(){for(const[t,n,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,p,u)}}_addDefaultHandlers(t){const n=this._map,u=n.getCanvasContainer();this._add("mapEvent",new pp(n,t));const p=n.boxZoom=new Sm(n,t);this._add("boxZoom",p);const g=new Em,b=new Ql;n.doubleClickZoom=new kr(b,g),this._add("tapZoom",g),this._add("clickZoom",b);const I=new cl;this._add("tapDragZoom",I);const L=n.touchPitch=new Am(n);this._add("touchPitch",L);const P=new Ks(t),k=new Zc(t);n.dragRotate=new Cm(t,P,k),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new Hc(t),j=new Tr(n,t);n.dragPan=new Mm(u,U,j),this._add("mousePan",U),this._add("touchPan",j,["touchZoom","touchRotate"]);const $=new Zu,Q=new mp;n.touchZoomRotate=new Im(u,Q,$,I),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hu(n));const W=n.scrollZoom=new yr(n,this);this._add("scrollZoom",W,["mousePan"]);const te=n.keyboard=new ff;this._add("keyboard",te);for(const ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ne]&&n[ne].enable(t[ne])}_add(t,n,u){this._handlers.push({handlerName:t,handler:n,allowed:u}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,u){for(const p in t)if(p!==u&&(!n||n.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const u of t)this._el.contains(u.target)&&n.push(u);return n}handleEvent(t,n){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,g={needsRenderFrame:!1},b={},I={},L=t.touches?this._getMapTouches(t.touches):void 0,P=L?Mi(this._el,L):u?void 0:hi(this._el,t);for(const{handlerName:j,handler:$,allowed:Q}of this._handlers){if(!$.isEnabled())continue;let W;this._blockedByActive(I,Q,j)?$.reset():$[n||t.type]&&(W=$[n||t.type](t,P,L),this.mergeHandlerResult(g,b,W,j,p),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||$.isActive())&&(I[j]=$)}const k={};for(const j in this._previousActiveHandlers)I[j]||(k[j]=p);this._previousActiveHandlers=I,(Object.keys(k).length||Yc(g))&&(this._changes.push([g,b,k]),this._triggerRenderFrame()),(Object.keys(I).length||Yc(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=g;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,n,u,p,g){if(!u)return;r.l(t,u);const b={handlerName:p,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(n.zoom=b),u.panDelta!==void 0&&(n.drag=b),u.pitchDelta!==void 0&&(n.pitch=b),u.bearingDelta!==void 0&&(n.rotate=b)}_applyChanges(){const t={},n={},u={};for(const[p,g,b]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),r.l(n,g),r.l(u,b);this._updateMapTransform(t,n,u),this._changes=[]}_updateMapTransform(t,n,u){const p=this._map,g=p.transform,b=ce=>[ce.x,ce.y,ce.z];if((ce=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!Yc(t)){const ce=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),ce!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&p._stop(!0),!Yc(t))return void this._fireEvents(n,u,!0);let{panDelta:I,zoomDelta:L,bearingDelta:P,pitchDelta:k,around:U,aroundCoord:j,pinchAround:$}=t;g._isCameraConstrained&&(L>0&&(L=0),g._isCameraConstrained=!1),$!==void 0&&(U=$),(L||(ce=>n[ce]&&!this._eventsInProgress[ce])("drag"))&&U&&(this._dragOrigin=b(g.pointCoordinate3D(U)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",p._stop(!0),U=U||p.transform.centerPoint,P&&(g.bearing+=P),k&&(g.pitch+=k),g._updateCameraState();const Q=[0,0,0];if(I)if(g.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(U).dir),me=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(U.sub(I)).dir);Q[0]=me[0]-ce[0],Q[1]=me[1]-ce[1]}else{const ce=g.pointCoordinate(U);if(g.projection.name==="globe"){I=I.rotate(-g.angle);const me=g._pixelsPerMercatorPixel/g.worldSize;Q[0]=-I.x*r.dE(r.aT(ce.y))*me,Q[1]=-I.y*r.dE(g.center.lat)*me}else{const me=g.pointCoordinate(U.sub(I));ce&&me&&(Q[0]=me.x-ce.x,Q[1]=me.y-ce.y)}}const W=g.zoom,te=[0,0,0];if(L){const ce=b(j||g.pointCoordinate3D(U)),me={dir:r.ad.vec3.normalize([],r.ad.vec3.sub([],ce,g._camera.position))};if(me.dir[2]<0){const fe=g.zoomDeltaToMovement(ce,L);r.ad.vec3.scale(te,me.dir,fe)}}const ne=r.ad.vec3.add(Q,Q,te);g._translateCameraConstrained(ne),L&&Math.abs(g.zoom-W)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,u,!0)}_fireEvents(t,n,u){const p=Xc(this._eventsInProgress),g=Xc(t),b={};for(const k in t){const{originalEvent:U}=t[k];this._eventsInProgress[k]||(b[`${k}start`]=U),this._eventsInProgress[k]=t[k]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const k in b)this._fireEvent(k,b[k]);g&&this._fireEvent("move",g.originalEvent);for(const k in t){const{originalEvent:U}=t[k];this._fireEvent(k,U)}const I={};let L;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:j}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],L=n[U]||j,I[`${k}end`]=L)}for(const k in I)this._fireEvent(k,I[k]);const P=Xc(this._eventsInProgress);if(u&&(p||g)&&!P){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:L})):(this._map.fire(new r.A("moveend",{originalEvent:L})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new r.A(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new pf("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const mf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ec extends r.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,r.aQ(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,u){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,r.l({offset:t},n),u)}panTo(t,n,u){return this.easeTo(r.l({center:t},n),u)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,u){return this.easeTo(r.l({zoom:t},n),u)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,u){return this.easeTo(r.l({bearing:t},n),u)}resetNorth(t,n){return this.rotateTo(0,r.l({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=r.aB.convert(t);const u=n&&n.bearing||0,p=n&&n.pitch||0,g=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,g,b,u,p,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?r.l({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:r.l({},n,t)}_extendCameraOptions(t){return(t=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const u=n.max[0]-n.min[0],p=n.max[1]-n.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,u,p,g,b){const I=t.clone(),L=this._extendCameraOptions(b);I.bearing=p,I.pitch=g;const P=r.bO.convert(n),k=r.bO.convert(u),U=.5*(P.lat+k.lat),j=.5*(P.lng+k.lng),$=r.dF(U,j),Q=r.ad.vec3.normalize([],$),W=r.ad.vec3.normalize([],r.ad.vec3.cross([],Q,[0,1,0])),te=r.ad.vec3.cross([],W,Q),ne=[W[0],W[1],W[2],0,te[0],te[1],te[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],ce=[$,r.dF(P.lat,P.lng),r.dF(k.lat,P.lng),r.dF(k.lat,k.lng),r.dF(P.lat,k.lng),r.dF(U,P.lng),r.dF(U,k.lng),r.dF(P.lat,j),r.dF(k.lat,j)];let me=r.ce.fromPoints(ce.map(nt=>[r.ad.vec3.dot(W,nt),r.ad.vec3.dot(te,nt),r.ad.vec3.dot(Q,nt)]));const fe=r.ad.vec3.transformMat4([],me.center,ne);r.ad.vec3.squaredLength(fe)===0&&r.ad.vec3.set(fe,0,0,1),r.ad.vec3.normalize(fe,fe),r.ad.vec3.scale(fe,fe,r.az),I.center=r.dG(fe);const we=I.getWorldToCameraMatrix(),ye=r.ad.mat4.invert(new Float64Array(16),we);me=r.ce.applyTransform(me,r.ad.mat4.multiply([],we,ne));const ve=this._extendAABB(me,I,L,p);if(!ve)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=ve,r.ad.vec3.transformMat4(fe,fe,we);const xe=.5*(me.max[2]-me.min[2]),Se=this._minimumAABBFrustumDistance(I,me),Ce=r.ad.vec3.scale([],[0,0,1],xe),Ke=r.ad.vec3.add(Ce,fe,Ce),Ge=Se+(I.pitch===0?0:r.ad.vec3.distance(fe,Ke)),ct=I.globeCenterInViewSpace,_t=r.ad.vec3.sub([],fe,[ct[0],ct[1],ct[2]]);r.ad.vec3.normalize(_t,_t),r.ad.vec3.scale(_t,_t,Ge);const Ct=r.ad.vec3.add([],fe,_t);r.ad.vec3.transformMat4(Ct,Ct,ye);const Ve=r.dv/r.az,ut=r.ad.vec3.length(Ct),Ne=r.bH(Math.max(ut*Ve-r.dv,Number.EPSILON),0),ht=Math.min(I.zoomFromMercatorZAdjusted(Ne),L.maxZoom);return ht>.5*(r.c6+r.bY)?(I.setProjection({name:"mercator"}),I.zoom=ht,this._cameraForBounds(I,n,u,p,g,b)):{center:I.center,zoom:ht,bearing:p,pitch:g}}_extendAABB(t,n,u,p){const g=.5*((u.padding.left||0)+(u.padding.right||0)),b=.5*((u.padding.top||0)+(u.padding.bottom||0)),I=b,L=g,P=g,k=b,U=n.width-(L+P),j=n.height-(I+k),$=r.ad.vec3.sub([],t.max,t.min),Q=Math.min(U/$[0],j/$[1]),W=Math.min(n.scaleZoom(n.scale*Q),u.maxZoom);if(isNaN(W))return null;const te=n.scale/n.zoomScale(W),ne=new r.ce([t.min[0]-L*te,t.min[1]-k*te,t.min[2]],[t.max[0]+P*te,t.max[1]+I*te,t.max[2]]),ce=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new r.P(u.offset.x,u.offset.y):r.P.convert(u.offset)).rotate(-r.ak(p));return ne.center[0]-=ce.x*te,ne.center[1]+=ce.y*te,ne}queryTerrainElevation(t,n){const u=this.transform.elevation;return u?(n=r.l({},{exaggerated:!0},n),u.getAtPoint(r.ac.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,u,p,g,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,u,p,g,b);const I=t.clone(),L=this._extendCameraOptions(b);I.bearing=p,I.pitch=g;const P=r.bO.convert(n),k=r.bO.convert(u),U=new r.bO(P.lng,k.lat),j=new r.bO(k.lng,P.lat),$=I.project(P),Q=I.project(k),W=this.queryTerrainElevation(P),te=this.queryTerrainElevation(k),ne=this.queryTerrainElevation(U),ce=this.queryTerrainElevation(j),me=[[$.x,$.y,Math.min(W||0,te||0,ne||0,ce||0)],[Q.x,Q.y,Math.max(W||0,te||0,ne||0,ce||0)]];let fe=r.ce.fromPoints(me);const we=I.getWorldToCameraMatrix(),ye=r.ad.mat4.invert(new Float64Array(16),we);fe=r.ce.applyTransform(fe,we);const ve=this._extendAABB(fe,I,L,p);if(!ve)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=ve;const xe=.5*r.ad.vec3.sub([],fe.max,fe.min)[2],Se=this._minimumAABBFrustumDistance(I,fe),Ce=[0,0,1,0];r.ad.vec4.transformMat4(Ce,Ce,we),r.ad.vec4.normalize(Ce,Ce);const Ke=r.ad.vec3.scale([],Ce,Se+xe),Ge=r.ad.vec3.add([],fe.center,Ke);r.ad.vec3.transformMat4(fe.center,fe.center,ye),r.ad.vec3.transformMat4(Ge,Ge,ye);const ct=I.unproject(new r.P(fe.center[0],fe.center[1])),_t=r.dH(I.projection,ct),Ct=Math.pow(2,_t),Ve=Math.min(I._zoomFromMercatorZ(Ge[2]*I.pixelsPerMeter*Ct/I.worldSize),L.maxZoom);return I.mercatorFromTransition&&Ve<.5*(r.c6+r.bY)?(I.setProjection({name:"globe"}),I.zoom=Ve,this._cameraForBounds(I,n,u,p,g,b)):{center:ct,zoom:Ve,bearing:p,pitch:g}}fitBounds(t,n,u){const p=this.cameraForBounds(t,n);return this._fitInternal(p,n,u)}fitScreenCoordinates(t,n,u,p,g){const b=r.P.convert(t),I=r.P.convert(n),L=new r.P(Math.min(b.x,I.x),Math.min(b.y,I.y)),P=new r.P(Math.max(b.x,I.x),Math.max(b.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,I))return this;const k=this.transform.pointLocation3D(L),U=this.transform.pointLocation3D(P),j=this.transform.pointLocation3D(new r.P(L.x,P.y)),$=this.transform.pointLocation3D(new r.P(P.x,L.y)),Q=[Math.min(k.lng,U.lng,j.lng,$.lng),Math.min(k.lat,U.lat,j.lat,$.lat)],W=[Math.max(k.lng,U.lng,j.lng,$.lng),Math.max(k.lat,U.lat,j.lat,$.lat)],te=p&&p.pitch?p.pitch:this.getPitch(),ne=this._cameraForBounds(this.transform,Q,W,u,te,p);return this._fitInternal(ne,p,g)}_fitInternal(t,n,u){return t?(n=r.l(t,n)).linear?this.easeTo(n,u):this.flyTo(n,u):this}jumpTo(t,n){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,g=!1,b=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=r.bO.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(g=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(b=!0,u.pitch=+t.pitch);const I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(I))if(t.retainPadding===!1){const L=u.clone();L.padding=I,u.setLocationAtPoint(u.center,L.centerPoint)}else u.padding=I;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new r.A("movestart",n)).fire(new r.A("move",n)),p&&this.fire(new r.A("zoomstart",n)).fire(new r.A("zoom",n)).fire(new r.A("zoomend",n)),g&&this.fire(new r.A("rotatestart",n)).fire(new r.A("rotate",n)).fire(new r.A("rotateend",n)),b&&this.fire(new r.A("pitchstart",n)).fire(new r.A("pitch",n)).fire(new r.A("pitchend",n)),this.fire(new r.A("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(mf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const u=this.transform;if(!u.projection.supportsFreeCamera)return r.w(mf),this;this.stop();const p=u.zoom,g=u.pitch,b=u.bearing;u.setFreeCameraOptions(t);const I=p!==u.zoom,L=g!==u.pitch,P=b!==u.bearing;return this.fire(new r.A("movestart",n)).fire(new r.A("move",n)),I&&this.fire(new r.A("zoomstart",n)).fire(new r.A("zoom",n)).fire(new r.A("zoomend",n)),P&&this.fire(new r.A("rotatestart",n)).fire(new r.A("rotate",n)).fire(new r.A("rotateend",n)),L&&this.fire(new r.A("pitchstart",n)).fire(new r.A("pitch",n)).fire(new r.A("pitchend",n)),this.fire(new r.A("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=r.l({offset:[0,0],duration:500,easing:r.dD},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),g=this.getBearing(),b=this.getPitch(),I=this.getPadding(),L="zoom"in t?+t.zoom:p,P="bearing"in t?this._normalizeBearing(t.bearing,g):g,k="pitch"in t?+t.pitch:b,U=this._extendPadding(t.padding),j=r.P.convert(t.offset);let $,Q,W;if(u.projection.name==="globe"){const Ce=r.ac.fromLngLat(u.center),Ke=j.rotate(-u.angle);Ce.x+=Ke.x/u.worldSize,Ce.y+=Ke.y/u.worldSize;const Ge=Ce.toLngLat(),ct=r.bO.convert(t.center||Ge);this._normalizeCenter(ct),$=u.centerPoint.add(Ke),Q=new r.P(Ce.x,Ce.y).mult(u.worldSize),W=new r.P(r.av(ct.lng),r.aC(ct.lat)).mult(u.worldSize).sub(Q)}else{$=u.centerPoint.add(j);const Ce=u.pointLocation($),Ke=r.bO.convert(t.center||Ce);this._normalizeCenter(Ke),Q=u.project(Ce),W=u.project(Ke).sub(Q)}const te=u.zoomScale(L-p);let ne,ce;t.around&&(ne=r.bO.convert(t.around),ce=u.locationPoint(ne));const me=this._zooming||L!==p,fe=this._rotating||g!==P,we=this._pitching||k!==b,ye=!u.isPaddingEqual(U),ve=t.retainPadding===!1?u.clone():u,xe=Ce=>Ke=>{if(me&&(Ce.zoom=r.ah(p,L,Ke)),fe&&(Ce.bearing=r.ah(g,P,Ke)),we&&(Ce.pitch=r.ah(b,k,Ke)),ye&&(ve.interpolatePadding(I,U,Ke),$=ve.centerPoint.add(j)),ne)Ce.setLocationAtPoint(ne,ce);else{const Ge=Ce.zoomScale(Ce.zoom-p),ct=L>p?Math.min(2,te):Math.max(.5,te),_t=Math.pow(ct,1-Ke),Ct=Ce.unproject(Q.add(W.mult(Ke*_t)).mult(Ge));Ce.setLocationAtPoint(Ce.renderWorldCopies?Ct.wrap():Ct,$)}return t.preloadOnly||this._fireMoveEvents(n),Ce};if(t.preloadOnly){const Ce=this._emulate(xe,t.duration,u);return this._preloadTiles(Ce),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=fe,this._pitching=we,this._padding=ye,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,Se),this._ease(xe(u),Ce=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(n,Ce)},t),this}_prepareEase(t,n,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||u.moving||this.fire(new r.A("movestart",t)),this._zooming&&!u.zooming&&this.fire(new r.A("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new r.A("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new r.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.A("move",t)),this._zooming&&this.fire(new r.A("zoom",t)),this._rotating&&this.fire(new r.A("rotate",t)),this._pitching&&this.fire(new r.A("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new r.A("zoomend",t)),p&&this.fire(new r.A("rotateend",t)),g&&this.fire(new r.A("pitchend",t)),this.fire(new r.A("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const nt=r.aA(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(nt,n)}this.stop(),t=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dD},t);const u=this.transform,p=this.getZoom(),g=this.getBearing(),b=this.getPitch(),I=this.getPadding(),L="zoom"in t?r.ay(+t.zoom,u.minZoom,u.maxZoom):p,P="bearing"in t?this._normalizeBearing(t.bearing,g):g,k="pitch"in t?+t.pitch:b,U=this._extendPadding(t.padding),j=u.zoomScale(L-p),$=r.P.convert(t.offset);let Q=u.centerPoint.add($);const W=u.pointLocation(Q),te=r.bO.convert(t.center||W);this._normalizeCenter(te);const ne=u.project(W),ce=u.project(te).sub(ne);let me=t.curve;const fe=Math.max(u.width,u.height),we=fe/j,ye=ce.mag();if("minZoom"in t){const nt=r.ay(Math.min(t.minZoom,p,L),u.minZoom,u.maxZoom),yt=fe/u.zoomScale(nt-p);me=Math.sqrt(yt/ye*2)}const ve=me*me;function xe(nt){const yt=(we*we-fe*fe+(nt?-1:1)*ve*ve*ye*ye)/(2*(nt?we:fe)*ve*ye);return Math.log(Math.sqrt(yt*yt+1)-yt)}function Se(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function Ce(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const Ke=xe(0);let Ge=function(nt){return Ce(Ke)/Ce(Ke+me*nt)},ct=function(nt){return fe*((Ce(Ke)*(Se(yt=Ke+me*nt)/Ce(yt))-Se(Ke))/ve)/ye;var yt},_t=(xe(1)-Ke)/me;if(Math.abs(ye)<1e-6||!isFinite(_t)){if(Math.abs(fe-we)<1e-6)return this.easeTo(t,n);const nt=we<fe?-1:1;_t=Math.abs(Math.log(we/fe))/me,ct=function(){return 0},Ge=function(yt){return Math.exp(nt*me*yt)}}t.duration="duration"in t?+t.duration:1e3*_t/("screenSpeed"in t?+t.screenSpeed/me:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Ct=g!==P,Ve=k!==b,ut=!u.isPaddingEqual(U),Ne=t.retainPadding===!1?u.clone():u,ht=nt=>yt=>{const et=yt*_t,gt=1/Ge(et);nt.zoom=yt===1?L:p+nt.scaleZoom(gt),Ct&&(nt.bearing=r.ah(g,P,yt)),Ve&&(nt.pitch=r.ah(b,k,yt)),ut&&(Ne.interpolatePadding(I,U,yt),Q=Ne.centerPoint.add($));const Vt=yt===1?te:nt.unproject(ne.add(ce.mult(ct(et))).mult(gt));return nt.setLocationAtPoint(nt.renderWorldCopies?Vt.wrap():Vt,Q),nt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),nt};if(t.preloadOnly){const nt=this._emulate(ht,t.duration,u);return this._preloadTiles(nt),this}return this._zooming=!0,this._rotating=Ct,this._pitching=Ve,this._padding=ut,this._prepareEase(n,!1),this._ease(ht(u),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,n)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,n,u){u.animate===!1||u.duration===0?(t(1),n()):(this._easeStart=r.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=r.bF(t,-180,180);const u=Math.abs(t-n);return Math.abs(t-360-n)<u&&(t-=360),Math.abs(t+360-n)<u&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const u=t.lng-n.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,u){const p=Math.ceil(15*n/1e3),g=[],b=t(u.clone());for(let I=0;I<=p;I++){const L=b(I/p);g.push(L.clone())}return g}_preloadTiles(t,n){}}class Yu{constructor(t={}){this.options=t,r.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Fe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=Fe("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=Fe("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const u=n.reduce((p,g,b)=>(g.value&&(p+=`${g.key}=${g.value}${b<n.length-1?"&":""}`),p),"?");t.href=`${r.e.FEEDBACK_URL}/${u}#${df(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const n=this._map.style._mergedSourceCaches;for(const p in n){const g=n[p];if(g.used){const b=g.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let b=g+1;b<t.length;b++)if(t[b].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class bs{constructor(){r.aQ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Fe("div","mapboxgl-ctrl");const n=Fe("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const u=t[n].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class as{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,u=n?this._queue.concat(n):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const u of n)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ul{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=r.cC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,u){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+u}}const hl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class tc extends r.A{constructor(t,n,u,p){const{point:g,lngLat:b,originalEvent:I,target:L}=t;super(t.type,{point:g,lngLat:b,originalEvent:I,target:L}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=u,this.feature=p}}class nd{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=n.filter;let p=n.type;u&&this.filters.set(t,r.a_(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const g=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):g.size===0&&this.map.on(p,this.handleType),g.size===0&&this.interactionsByType.set(p,g),g.set(t,n),this.typeById.set(t,p)}get(t){const n=this.typeById.get(t);if(!n)return;const u=this.interactionsByType.get(n);return u?u.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(n);u&&(u.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const u=[];for(const[p,g]of n)g.target&&u.push({targetId:p,target:g.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const u=new Map;for(const[p,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(g.id,g);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const u=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!n;n=n||this.queryTargets(t.point,u);const g=t.type==="mouseenter";let b=!1;const I=new Set;for(const L of n){for(const[P,k]of u){if(!k.target)continue;const U=L.variants?L.variants[P]:null;if(U){for(const j of U){if(Zo(j,L,I,P))continue;const $=new r.cx(L,j),Q=_h(j,L,P);p&&($.state=this.map.getFeatureState($));const W=g?this.prevHoveredFeatures.get(Q):null,te=new tc(t,P,k,$),ne=W?W.stop:k.handler(te);if(g&&this.hoveredFeatures.set(Q,{feature:L,stop:ne}),ne!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[L,P]of u){const{handler:k,target:U}=P;if(!U&&k(new tc(t,L,P,null))!==!1)break}}}function Tn(h,t){if(Array.isArray(h)&&Array.isArray(t)){const n=new Set(h),u=new Set(t);return n.size===u.size&&h.every(p=>u.has(p))}return r.bn(h,t)}const Ga={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},yp={showCompass:!0,showZoom:!0,visualizePitch:!1};class G_{constructor(t,n,u=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Ks({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Zc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),Tt()}move(t,n){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,n),g=p&&p.bearingDelta;if(g&&u.setBearing(u.getBearing()+g),this.mousePitch){const b=this.mousePitch.mousemoveWindow(t,n),I=b&&b.pitchDelta;I&&u.setPitch(u.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){kt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(r.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),hi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,hi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Mi(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Mi(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function rd(h,t,n){if(h=new r.bO(h.lng,h.lat),t){const u=new r.bO(h.lng-360,h.lat),p=new r.bO(h.lng+360,h.lat),g=360*Math.ceil(Math.abs(h.lng-n.center.lng)/360),b=n.locationPoint3D(h).distSqr(t),I=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint3D(u).distSqr(t)<b&&(I||Math.abs(u.lng-n.center.lng)<g)?h=u:n.locationPoint3D(p).distSqr(t)<b&&(I||Math.abs(p.lng-n.center.lng)<g)&&(h=p)}for(;Math.abs(h.lng-n.center.lng)>180;){const u=n.locationPoint3D(h);if(u.x>=0&&u.y>=0&&u.x<=n.width&&u.y<=n.height)break;h.lng>n.center.lng?h.lng-=360:h.lng+=360}return h}const Sa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ss={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Qr extends r.E{constructor(t,n){super(),(t instanceof HTMLElement||n)&&(t=r.l({element:t},n)),r.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),t=r.l({},ss,t),this._anchor=t.anchor,this._color=t.color,this._scale=t.scale,this._draggable=t.draggable,this._clickTolerance=t.clickTolerance,this._rotation=t.rotation,this._rotationAlignment=t.rotationAlignment,this._pitchAlignment=t.pitchAlignment,this._occludedOpacity=t.occludedOpacity,this._altitude=t.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const u=this._element.classList;for(const g in Sa)u.remove(`mapboxgl-marker-anchor-${g}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=t&&t.className?t.className.trim().split(/\s+/):[];u.add(...p),this._popup=null}_createDefaultMarker(){const t=Fe("div"),n=qe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=qe("radialGradient",{id:"shadowGradient"},qe("defs",{},n));qe("stop",{offset:"10%","stop-opacity":.4},u),qe("stop",{offset:"100%","stop-opacity":.05},u),qe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n)}return qe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),qe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),qe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||ss.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,u=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,u=this._element;this._popup&&(n===u||u.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const u=t.unproject(n,this._altitude),p=t.getFreeCameraOptions();if(!p.position)return!1;const g=p.position.toLngLat();return g.distanceTo(u)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(n,this._altitude);let p;t._showingGlobe()&&r.dK(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Sa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,u=this.getPitchAlignment();if(!n||!t||u!=="map")return"";if(!n._showingGlobe()){const L=n.getPitch();return L?`rotateX(${L}deg)`:""}const p=r.c4(r.dL(n.transform,this._lngLat)),g=t.sub(r.dM(n.transform)),b=Math.abs(g.x)+Math.abs(g.y);if(b===0)return"";const I=p/b;return`rotateX(${-g.y*I}deg) rotateY(${g.x*I}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(n._showingGlobe()){const g=n.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=n.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);u=r.c4(Math.atan2(b.y,b.x))-90}else u=-n.getBearing();else if(p==="horizon"){const g=r.ae(4,6,n.getZoom()),b=r.dM(n.transform);b.y+=g*n.transform.height;const I=t.sub(b),L=r.c4(Math.atan2(I.y,I.x));u=(L>90?L-270:L+90)*(1-g)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=rd(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const g=this._clickTolerance||n._clickTolerance;if(t.point.dist(u)<g)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=n.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.A("dragstart"))),this.fire(new r.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.A("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,u=this._pos;n&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||ss.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||ss.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||ss.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||ss.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ea={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vn={maxWidth:100,unit:"metric"},vp={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},os={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},xp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qs(h=new r.P(0,0),t="bottom"){if(typeof h=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new r.P(0,h);case"top-left":return new r.P(n,n);case"top-right":return new r.P(-n,n);case"bottom":return new r.P(0,-h);case"bottom-left":return new r.P(n,-n);case"bottom-right":return new r.P(-n,-n);case"left":return new r.P(h,0);case"right":return new r.P(-h,0)}return new r.P(0,0)}return h instanceof r.P||Array.isArray(h)?r.P.convert(h):r.P.convert(h[t]||[0,0])}return{version:re,supported:Le.supported,setRTLTextPlugin:r.dN,getRTLTextPluginStatus:r.dO,Map:class extends ec{constructor(h){oe.mark(J.create);const t=h;if((h=r.l({},Ga,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&r.dI(window)&&(h.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Eh(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new as,this._domRenderTaskQueue=new as,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aW(),this._locale=r.l({},hl,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ul(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new di(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const n=document.getElementById(h.container);if(!n)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=n}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,r.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new of),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new gp(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||r.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new Tc(this),h.hash&&(this._hash=new qu(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const n=h.bounds;n&&(this.resize(),this.fitBounds(n,r.l({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Yu({customAttribution:h.customAttribution})),this._logoControl=new bs,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new r.A(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new r.A(`${n.dataType}dataloading`,n))}),this._interactions=new nd(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new r.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=h.onAdd(this);this._controls.push(h);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(n,u.firstChild):u.appendChild(n),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new r.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.A("movestart",h)).fire(new r.A("move",h)),this.fire(new r.A("resize",h)),t&&this.fire(new r.A("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(r.aB.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let n;t==="globe"&&h.zoom>=r.bY?(h.setMercatorFromTransition(),n=!0):t==="mercator"&&h.zoom<r.bY&&(h.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;return t=h.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(r.bO.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(r.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,n){const u=p=>{let g=[];if(Array.isArray(t)){const b=t.filter(I=>this.getLayer(I));g=b.length?this.queryRenderedFeatures(p,{layers:b}):[]}else g=this.queryRenderedFeatures(p,{target:t});return g};if(h==="mouseenter"||h==="mouseover"){let p=!1;return{listener:n,targets:t,delegates:{mousemove:b=>{const I=u(b.point);I.length?p||(p=!0,n.call(this,new Ta(h,this,b.originalEvent,{features:I}))):p=!1},mouseout:()=>{p=!1}}}}if(h==="mouseleave"||h==="mouseout"){let p=!1;return{listener:n,targets:t,delegates:{mousemove:I=>{u(I.point).length?p=!0:p&&(p=!1,n.call(this,new Ta(h,this,I.originalEvent)))},mouseout:I=>{p&&(p=!1,n.call(this,new Ta(h,this,I.originalEvent)))}}}}{const p=g=>{const b=u(g.point);b.length&&(g.features=b,n.call(this,g),delete g.features)};return{listener:n,targets:t,delegates:{[h]:p}}}}on(h,t,n){if(typeof t=="function"||n===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(h,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(h,t,n){if(typeof t=="function"||n===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(h,t,n);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(h,t,n){if(typeof t=="function"||n===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[h]:void 0;return u&&(p=>{for(let g=0;g<p.length;g++){const b=p[g];if(b.listener===n&&Tn(b.targets,t)){for(const I in b.delegates)this.off(I,b.delegates[I]);return p.splice(g,1),this}}})(u),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof r.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(h,void 0,this.transform),b=this.style.queryRenderedFeatureset(h,void 0,this.transform);return g.concat(b)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(h,t,this.transform))),n&&(p=p.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),p}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(n,u)=>{n?(r.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(h,t)):u&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const n=r.l({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new Gs(this,n).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new r.z(new Error("IDs can't be empty."))),!1):!r.cs(h)||(this.fire(new r.z(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,n)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:n=1,sdf:u=!1,stretchX:p,stretchY:g,content:b}={}){this._lazyInitEmptyStyle();const I=r.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:L,height:P,data:k}=r.q.getImageData(t);this.style.addImage(I,{data:new r.r({width:L,height:P},k),pixelRatio:n,stretchX:p,stretchY:g,content:b,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:L,height:P}=t,k=t;this.style.addImage(I,{data:new r.r({width:L,height:P},new Uint8Array(k.data)),pixelRatio:n,stretchX:p,stretchY:g,content:b,sdf:u,usvg:!1,version:0,userImage:k}),k.onAdd&&k.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const n=r.I.from(h),u=this.style.getImage(n);if(!u)return void this.fire(new r.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.q.getImageData(t):t,{width:g,height:b,data:I}=p;if(g===void 0||b===void 0)return void this.fire(new r.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||b!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new r.z(new Error(`The width and height of the updated image (${g}, ${b})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const L=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let P=!1;u.usvg?(u.data=new r.r({width:g,height:b},new Uint8Array(I)),u.usvg=!1,u.icon=void 0,P=!0):u.data.replace(I,L),this.style.updateImage(n,u,P)}hasImage(h){return h?!!this.style&&!!this.style.getImage(r.I.from(h)):(this.fire(new r.z(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(r.I.from(h))}loadImage(h,t){r.o(this._requestManager.transformRequest(h,r.R.Image),(n,u)=>{t(n,u instanceof HTMLImageElement?r.q.getImageData(u):u)})}listImages(){return this.style.listImages().map(h=>h.name)}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new r.z(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,n){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,n),this._update(!0)):this}setFilter(h,t,n={}){return this._isValidId(h)?(this.style.setFilter(h,t,n),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,n,u={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,n,u),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,n,u={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,n,u),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,n){return this.style.setConfigProperty(h,t,n),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,u,p,g=this._container;for(;g&&(!u||!p);){const b=window.getComputedStyle(g).transform;b&&b!=="none"&&(n=b.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(u=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(p=n[3])),g=g.parentElement}this._containerWidth=u?Math.abs(h/u):h,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Fe("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Fe("div","mapboxgl-canvas-container",h);this._canvas=Fe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Fe("div","mapboxgl-control-container",h),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=Fe("div",`mapboxgl-ctrl-${p}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const n=r.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(h),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=r.l({},Le.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(Ts(t,!0),this.painter=new Yl(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(t)):this.fire(new r.z(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.A("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new r.A("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new r.A("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,u=r.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,k=this.transform.pitch,U=r.q.now(),j=new r.aa(P,{now:U,fadeDuration:g,pitch:k,transition:this.style.transition});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(u);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,oe.mark(J.load),this.fire(new r.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const P=r.q.now()-u;p.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const k=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new r.A("gpu-timing-frame",{cpuTime:P,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(P);this.fire(new r.A("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(P);this.fire(new r.A("gpu-timing-deferred-render",{gpuTime:k}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(L||this._repaint)this.triggerRepaint();else{const P=this.idle();if(P&&(b=this._updateAverageElevation(u,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new r.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new r.A("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,oe.mark(J.fullLoad),this._performanceMetricsCollection&&sr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const n=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=h;const b=Math.abs(p-g);if(b>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(g),n(g);this._averageElevation.easeTo(g,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(g),n(g)}return!!this._averageElevation.isEasing(h)&&n(this._averageElevation.getValue(h))}_authenticate(){de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===Si||h.status===401)){const t=this.painter.context.gl;Ts(t,!1),this._logoControl instanceof bs&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ji(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Xi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,u=n.createFramebuffer();function p(g){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,g,0);const b=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,b),b}return n.bindFramebuffer(n.FRAMEBUFFER,u),this._canvasPixelComparison(p(h),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(h,t,n){let u=n[1]-n[0];const p=h.length/4;for(let g=0;g<t.length;g++){const b=t[g];let I=0;for(let L=0;L<b.length;L+=4)b[L]===h[L]&&b[L+1]===h[L+1]&&b[L+2]===h[L+2]&&b[L+3]===h[L+3]&&(I+=1);u+=(n[g+2]-n[g+1])*(1-I/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),us.delete(this.painter.context.gl),Aa.remove(),Ot.remove(),this._removed=!0,this.fire(new r.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=r.q.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return r.bl(t,(n,u)=>n._preloadTiles(h,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){r.dJ(h,t)}get version(){return re}},NavigationControl:class{constructor(h={}){this.options=r.l({},yp,h),this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Fe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Fe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Fe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),n=t===h.getMaxZoom(),u=t===h.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new G_(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const n=Fe("button",h,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(h,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",n),h.firstElementChild&&h.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends r.E{constructor(h={}){super();const t=navigator.geolocation;this.options=r.l({geolocation:t},Ea,h),r.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ju(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,h(n)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),n=h.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new r.A("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("geolocate",h)),this._finish()}}_updateCamera(h){const t=new r.bO(h.coords.longitude,h.coords.latitude),n=h.coords.accuracy,u=this._map.getBearing(),p=r.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),p,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new r.bO(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=r.bH(1,h._center.lat)*h.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Fe("button","mapboxgl-ctrl-geolocate",this._container),Fe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Fe("div","mapboxgl-user-location"),this._dotElement.appendChild(Fe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Fe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Qr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Fe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.A("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Yu,ScaleControl:class{constructor(h={}){this.options=r.l({},Vn,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,u=t._containerWidth/2-h/2,p=t.unproject([u,n]),g=t.unproject([u+h,n]),b=p.distanceTo(g);if(this.options.unit==="imperial"){const I=3.2808*b;I>5280?this._setScale(h,I/5280,"mile"):this._setScale(h,I,"foot")}else this.options.unit==="nautical"?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,t,n){this._map._requestDomTask(()=>{const u=function(g){const b=Math.pow(10,`${Math.floor(g)}`.length-1);let I=g/b;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(L){const P=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*P)/P}(I),b*I}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(u):`${u}&nbsp;${vp[n]}`,this._container.style.width=h*p+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:r.w("Full screen control 'container' must be a DOM element.")),r.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Fe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Fe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Fe("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(h){super(),this.options=r.l(Object.create(os),h),this._altitude=this.options.altitude,r.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new r.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new r.A("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=r.bO.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),n=document.createElement("body");let u;for(n.innerHTML=h;u=n.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Fe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const n=this._closeButton=Fe("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,u=this._pos;if(!t||!n||!u)return"bottom";const p=n.offsetWidth,g=n.offsetHeight,b=u.x<p/2,I=u.x>t.transform.width-p/2;if(u.y+h<g)return b?"top-left":I?"top-right":"top";if(u.y>t.transform.height-g){if(b)return"bottom-left";if(I)return"bottom-right"}return b?"left":I?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let u=this._container;if(u||(u=this._container=Fe("div","mapboxgl-popup",t.getContainer()),this._tip=Fe("div","mapboxgl-popup-tip",u),u.appendChild(n)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rd(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const p=this._pos=this._trackPointer&&h instanceof r.P?h:t.project(this._lngLat,this._altitude),g=Qs(this.options.offset),b=this._anchor=this._getAnchor(g.y),I=Qs(this.options.offset,b),L=p.add(I).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Sa[b]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=r.dK(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(xp);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Qr,Style:Gs,LngLat:r.bO,LngLatBounds:r.aB,Point:r.P,MercatorCoordinate:r.ac,FreeCameraOptions:Rd,Evented:r.E,config:r.e,prewarm:r.dP,clearPrewarmedResources:r.dQ,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(h){r.e.ACCESS_TOKEN=h},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(h){r.e.API_URL=h},get workerCount(){return r.dR.workerCount},set workerCount(h){r.dR.workerCount=h},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){r.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){r.dS(h)},get workerUrl(){return r.dT.workerUrl},set workerUrl(h){r.dT.workerUrl=h},get workerClass(){return r.dT.workerClass},set workerClass(h){r.dT.workerClass=h},get workerParams(){return r.dT.workerParams},set workerParams(h){r.dT.workerParams=h},get dracoUrl(){return r.dU()},set dracoUrl(h){r.dV(h)},get meshoptUrl(){return r.dW()},set meshoptUrl(h){r.dX(h)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var X=O;return X})}(Hv)),Hv.exports}var gO=_O();const Hg=y1(gO);function yO(){var ti;const{id:m}=ET(),v=Wf(),{toast:S}=X1(),[D,O]=Ie.useState(null),[F,X]=Ie.useState(!0),[r,re]=Ie.useState(null),[J,oe]=Ie.useState(0),[ze,je]=Ie.useState([]),[ft,Le]=Ie.useState({rating:1,content:""}),[Fe,qe]=Ie.useState("default");Ie.useEffect(()=>{const Rt=async()=>{try{const Si=await So.get(`/campgrounds/${m}`);console.log("Campground data:",Si.data),console.log("Campground author:",Si.data.author),O(Si.data),je(Si.data.reviews||[]),X(!1)}catch(Si){console.error("Error fetching campground:",Si),S({title:"Error",description:"Failed to load campground details",variant:"destructive"}),v("/campgrounds")}},ui=async()=>{try{const Si=localStorage.getItem("token");if(Si){const di=await So.get("/profile",{headers:{Authorization:`Bearer ${Si}`}});console.log("Current user:",di.data),re(di.data)}}catch(Si){console.error("Error fetching current user:",Si)}};Rt(),ui()},[m,v]),Ie.useEffect(()=>{if(D&&D.geometry){const Rt="pk.eyJ1Ijoic3VzaGFudDMwIiwiYSI6ImNtMjdkMzlidjBwc3IyaXM5bzVnNmJseTQifQ.BhnxquY7YYUV85E7XT-xOg";Hg.accessToken=Rt;const ui=new Hg.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:D.geometry.coordinates,zoom:10});return new Hg.Marker().setLngLat(D.geometry.coordinates).setPopup(new Hg.Popup({offset:25}).setHTML(`<h3>${D.title}</h3><p>${D.location}</p>`)).addTo(ui),ui.addControl(new Hg.NavigationControl),()=>ui.remove()}},[D]);const He=()=>{D&&D.images.length>0&&oe(Rt=>Rt===D.images.length-1?0:Rt+1)},tt=()=>{D&&D.images.length>0&&oe(Rt=>Rt===0?D.images.length-1:Rt-1)},mt=async()=>{if(window.confirm("Are you sure you want to delete this campground?"))try{await So.delete(`/campgrounds/${m}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),S({title:"Success",description:"Campground deleted successfully"}),v("/campgrounds")}catch(Rt){console.error("Error deleting campground:",Rt),S({title:"Error",description:"Failed to delete campground",variant:"destructive"})}},Tt=async Rt=>{Rt.preventDefault();try{const ui=await So.post(`/campgrounds/${m}/reviews`,{review:ft},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});je([...ze,ui.data]),Le({rating:1,content:""}),S({title:"Success",description:"Review submitted successfully"})}catch(ui){console.error("Error submitting review:",ui),S({title:"Error",description:"Failed to submit review",variant:"destructive"})}},kt=async Rt=>{if(window.confirm("Are you sure you want to delete this review?"))try{await So.delete(`/campgrounds/${m}/reviews/${Rt}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),je(ze.filter(ui=>ui._id!==Rt)),S({title:"Success",description:"Review deleted successfully"})}catch(ui){console.error("Error deleting review:",ui),S({title:"Error",description:"Failed to delete review",variant:"destructive"})}},At=Rt=>{qe(Rt);let ui=[...ze];Rt==="ascending"?ui.sort((Si,di)=>Si.rating-di.rating):Rt==="descending"&&ui.sort((Si,di)=>di.rating-Si.rating),je(ui)},ot=async Rt=>{try{await So.post(`/campgrounds/${m}/${Rt}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),O({...D,approved:Rt==="approve"}),S({title:"Success",description:`Campground ${Rt==="approve"?"approved":"revoked"} successfully`})}catch(ui){console.error(`Error ${Rt}ing campground:`,ui),S({title:"Error",description:`Failed to ${Rt} campground`,variant:"destructive"})}};if(F)return _e.jsx("div",{className:"container mx-auto p-6 pt-20 flex justify-center items-center h-screen",children:_e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"})});if(!D)return _e.jsxs("div",{className:"container mx-auto p-6 pt-20 text-center",children:[_e.jsx("h2",{className:"text-2xl font-bold",children:"Campground not found"}),_e.jsx(lc,{onClick:()=>v("/campgrounds"),className:"mt-4",children:"Back to Campgrounds"})]});const hi=r&&D.author&&(r._id===D.author._id||r.id===D.author._id||r._id===D.author.id),Mi=r&&r.isAdmin;return _e.jsxs("div",{className:"container mx-auto p-6 pt-20",children:[_e.jsx(Q1,{}),_e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[_e.jsxs("div",{children:[_e.jsx("div",{className:"relative rounded-xl overflow-hidden h-96 mb-6 bg-gray-200",children:D.images&&D.images.length>0?_e.jsxs(_e.Fragment,{children:[_e.jsx("img",{src:D.images[J].url,alt:D.title,className:"w-full h-full object-cover",crossOrigin:"anonymous"}),D.images.length>1&&_e.jsxs(_e.Fragment,{children:[_e.jsx("button",{onClick:tt,className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full","aria-label":"Previous image",children:_e.jsx(e1,{className:"h-6 w-6"})}),_e.jsx("button",{onClick:He,className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full","aria-label":"Next image",children:_e.jsx(jI,{className:"h-6 w-6"})})]})]}):_e.jsx("div",{className:"flex items-center justify-center h-full",children:_e.jsx("p",{className:"text-gray-500",children:"No images available"})})}),_e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[_e.jsx("h1",{className:"text-3xl font-bold mb-2",children:D.title}),_e.jsx("p",{className:"text-gray-700 mb-4 whitespace-pre-line",children:D.description}),_e.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[_e.jsx(rS,{className:"h-5 w-5 mr-2"}),_e.jsx("span",{children:D.location})]}),_e.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[_e.jsx("span",{className:"font-semibold",children:"Submitted by:"}),_e.jsx("span",{className:"ml-2",children:((ti=D.author)==null?void 0:ti.username)||"Unknown"})]}),_e.jsxs("div",{className:"text-xl font-bold text-green-600 mb-4",children:["₹",D.price,"/night"]}),_e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[_e.jsxs(lc,{onClick:()=>v("/campgrounds"),variant:"outline",className:"flex items-center",children:[_e.jsx(e1,{className:"h-4 w-4 mr-1"})," Back"]}),hi&&_e.jsxs(_e.Fragment,{children:[_e.jsxs(lc,{onClick:()=>v(`/campgrounds/${m}/edit`),variant:"outline",className:"flex items-center text-blue-600 border-blue-600 hover:bg-blue-50",children:[_e.jsx(WI,{className:"h-4 w-4 mr-1"})," Edit"]}),_e.jsxs(lc,{onClick:mt,variant:"outline",className:"flex items-center text-red-600 border-red-600 hover:bg-red-50",children:[_e.jsx(QI,{className:"h-4 w-4 mr-1"})," Delete"]})]}),Mi&&_e.jsx(lc,{onClick:()=>ot(D.approved?"revoke":"approve"),variant:D.approved?"destructive":"default",className:"flex items-center",children:D.approved?"Revoke":"Approve"})]})]})]}),_e.jsxs("div",{children:[_e.jsx("div",{id:"map",className:"h-64 rounded-xl mb-6 bg-gray-200",style:{minHeight:"300px"}}),_e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[_e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Reviews"}),r&&(!D.author||r._id!==D.author._id&&r.id!==D.author._id&&r._id!==D.author.id)&&_e.jsxs("div",{className:"mb-6",children:[_e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Leave a Review"}),_e.jsxs("form",{onSubmit:Tt,className:"space-y-4",children:[_e.jsxs("div",{children:[_e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rating"}),_e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(Rt=>_e.jsx("button",{type:"button",onClick:()=>Le({...ft,rating:Rt}),className:"focus:outline-none",children:_e.jsx(V2,{className:`h-6 w-6 ${Rt<=ft.rating?"text-yellow-400 fill-yellow-400":"text-gray-300"}`})},Rt))})]}),_e.jsxs("div",{children:[_e.jsx("label",{htmlFor:"review-content",className:"block text-sm font-medium mb-1",children:"Your Review"}),_e.jsx("textarea",{id:"review-content",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:ft.content,onChange:Rt=>Le({...ft,content:Rt.target.value}),required:!0})]}),_e.jsx(lc,{type:"submit",className:"w-full",children:"Submit Review"})]})]}),ze.length>0&&_e.jsxs("div",{className:"mb-4",children:[_e.jsx("label",{htmlFor:"sort-reviews",className:"block text-sm font-medium mb-1",children:"Sort by Rating"}),_e.jsxs("select",{id:"sort-reviews",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:Fe,onChange:Rt=>At(Rt.target.value),children:[_e.jsx("option",{value:"default",children:"Default"}),_e.jsx("option",{value:"ascending",children:"Lowest to Highest"}),_e.jsx("option",{value:"descending",children:"Highest to Lowest"})]})]}),_e.jsx("div",{className:"space-y-4",children:ze.length>0?ze.map(Rt=>{var ui;return _e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4","data-rating":Rt.rating,children:[_e.jsxs("div",{className:"flex justify-between items-start",children:[_e.jsx("h4",{className:"font-semibold",children:((ui=Rt.author)==null?void 0:ui.username)||"Anonymous"}),_e.jsx("div",{className:"flex items-center",children:[...Array(5)].map((Si,di)=>_e.jsx(V2,{className:`h-4 w-4 ${di<Rt.rating?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},di))})]}),_e.jsx("p",{className:"mt-2 text-gray-700",children:Rt.content}),r&&Rt.author&&(r._id===Rt.author._id||r.id===Rt.author._id||r._id===Rt.author.id)&&_e.jsx(lc,{onClick:()=>kt(Rt._id),variant:"outline",size:"sm",className:"mt-2 text-red-600 border-red-600 hover:bg-red-50",children:"Delete"})]},Rt._id)}):_e.jsx("p",{className:"text-gray-500 italic",children:"No reviews yet. Be the first to leave a review!"})})]})]})]})]})}const vO=oh.object({title:oh.string().min(3,{message:"Title must be at least 3 characters"}),location:oh.string().min(3,{message:"Location is required"}),description:oh.string().min(10,{message:"Description must be at least 10 characters"}),price:oh.string().refine(m=>!isNaN(Number(m))&&Number(m)>0,{message:"Price must be a positive number"})});function xO(){const{id:m}=ET(),v=Wf(),{toast:S}=X1(),[D,O]=Ie.useState([]),[F,X]=Ie.useState([]),[r,re]=Ie.useState([]),[J,oe]=Ie.useState([]),[ze,je]=Ie.useState(!1),[ft,Le]=Ie.useState(!0),[Fe,qe]=Ie.useState(null),He=MS({resolver:IS(vO),defaultValues:async()=>{try{const ot=(await So.get(`/campgrounds/${m}`)).data;return{title:ot.title,location:ot.location,description:ot.description,price:ot.price.toString()}}catch(At){return console.error("Error loading campground data:",At),{title:"",location:"",description:"",price:""}}},mode:"onChange"});Ie.useEffect(()=>{(async()=>{try{const hi=(await So.get(`/campgrounds/${m}`)).data;qe(hi),O(hi.images||[]),Le(!1)}catch(ot){console.error("Error fetching campground:",ot),S({title:"Error",description:"Failed to load campground details",variant:"destructive"}),v("/campgrounds")}})()},[m,v,S]);const tt=At=>{if(!At.target.files||At.target.files.length===0)return;const ot=Array.from(At.target.files);X(Mi=>[...Mi,...ot]);const hi=ot.map(Mi=>URL.createObjectURL(Mi));re(Mi=>[...Mi,...hi])},mt=At=>{URL.revokeObjectURL(r[At]),X(F.filter((ot,hi)=>hi!==At)),re(r.filter((ot,hi)=>hi!==At))},Tt=At=>{J.includes(At)?oe(J.filter(ot=>ot!==At)):oe([...J,At])};async function kt(At){je(!0);try{const ot=new FormData;Object.entries(At).forEach(([hi,Mi])=>{ot.append(`campground[${hi}]`,Mi)}),F.forEach(hi=>{ot.append("image",hi)}),J.forEach(hi=>{ot.append("deleteImages[]",hi)}),await So.put(`/campgrounds/${m}`,ot,{headers:{"Content-Type":"multipart/form-data"}}),S({title:"Success!",description:"Your campground has been updated"}),v(`/campgrounds/${m}`)}catch(ot){console.error("Error updating campground:",ot),S({title:"Error",description:"Failed to update campground. Please try again.",variant:"destructive"})}finally{je(!1)}}return ft?_e.jsx("div",{className:"container mx-auto pt-20 px-4 md:px-6 flex justify-center items-center h-screen",children:_e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"})}):_e.jsxs("div",{className:"container mx-auto pt-20 px-4 md:px-6",style:{minHeight:"94vh"},children:[_e.jsx(Q1,{}),_e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-lg shadow-2xl border border-black",children:_e.jsxs(U1,{className:"border-none shadow-lg",children:[_e.jsxs(j1,{className:"bg-primary/5 rounded-t-lg",children:[_e.jsx(q1,{className:"text-4xl font-bold mb-2",children:"Edit Campground"}),_e.jsx(G1,{className:"text-lg",children:"Update the details of your campground"})]}),_e.jsx(H1,{className:"p-8",children:_e.jsx(QS,{...He,children:_e.jsxs("form",{onSubmit:He.handleSubmit(kt),className:"space-y-8",children:[_e.jsx(Hf,{control:He.control,name:"title",render:({field:At})=>_e.jsxs(md,{children:[_e.jsx(cc,{className:"text-xl font-semibold",children:"Campground Name"}),_e.jsx(_d,{children:_e.jsx(vd,{placeholder:"Sunset Peak Campsite",...At,className:"text-lg py-6"})}),_e.jsx(gd,{className:"text-base",children:"Give your campground a descriptive name"}),_e.jsx(yd,{className:"text-base"})]})}),_e.jsx(Hf,{control:He.control,name:"location",render:({field:At})=>_e.jsxs(md,{children:[_e.jsx(cc,{className:"text-xl font-semibold",children:"Location"}),_e.jsx(_d,{children:_e.jsx(vd,{placeholder:"Himachal Pradesh, India",...At,className:"text-lg py-6"})}),_e.jsx(gd,{className:"text-base",children:"Where is this campground located?"}),_e.jsx(yd,{className:"text-base"})]})}),_e.jsx(Hf,{control:He.control,name:"description",render:({field:At})=>_e.jsxs(md,{children:[_e.jsx(cc,{className:"text-xl font-semibold",children:"Description"}),_e.jsx(_d,{children:_e.jsx($1,{placeholder:"Describe the campground, its surroundings, and what makes it special...",className:"min-h-[150px] text-lg",value:At.value,onChange:At.onChange})}),_e.jsx(gd,{className:"text-base",children:"Include details about amenities, views, and nearby attractions"}),_e.jsx(yd,{className:"text-base"})]})}),_e.jsx(Hf,{control:He.control,name:"price",render:({field:At})=>_e.jsxs(md,{children:[_e.jsx(cc,{className:"text-xl font-semibold",children:"Price per night (₹)"}),_e.jsx(_d,{children:_e.jsxs("div",{className:"relative",children:[_e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"₹"}),_e.jsx(vd,{className:"pl-7 text-lg py-6",placeholder:"1000",value:At.value,onChange:At.onChange})]})}),_e.jsx(gd,{className:"text-base",children:"Set a reasonable price per night in Indian Rupees"}),_e.jsx(yd,{className:"text-base"})]})}),_e.jsxs("div",{className:"space-y-4",children:[_e.jsx(cc,{className:"block text-xl font-semibold",children:"Current Images"}),D.length>0?_e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:D.map((At,ot)=>_e.jsxs("div",{className:"relative group",children:[_e.jsx("img",{src:At.url,alt:`Campground image ${ot+1}`,className:`h-32 w-full object-cover rounded-md ${J.includes(At.filename)?"opacity-50":""}`,crossOrigin:"anonymous"}),_e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[_e.jsx("input",{type:"checkbox",id:`delete-${At.filename}`,checked:J.includes(At.filename),onChange:()=>Tt(At.filename),className:"h-5 w-5"}),_e.jsx("label",{htmlFor:`delete-${At.filename}`,className:"ml-2 text-white font-medium drop-shadow-lg",children:"Delete?"})]})]},ot))}):_e.jsx("p",{className:"text-gray-500",children:"No current images"})]}),_e.jsxs("div",{className:"space-y-4",children:[_e.jsx(cc,{className:"block text-xl font-semibold",children:"Add New Images"}),_e.jsxs("div",{className:"flex items-center gap-4",children:[_e.jsxs("label",{htmlFor:"new-image",className:"flex items-center justify-center gap-2 px-6 py-4 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors text-lg",children:[_e.jsx(aS,{className:"h-6 w-6 text-gray-500"}),_e.jsx("span",{children:"Upload Photos"}),_e.jsx(vd,{id:"new-image",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:tt})]}),_e.jsxs("p",{className:"text-base text-gray-500",children:[F.length," ",F.length===1?"file":"files"," selected"]})]}),r.length>0&&_e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4",children:r.map((At,ot)=>_e.jsxs("div",{className:"relative group",children:[_e.jsx("img",{src:At,alt:`New preview ${ot+1}`,className:"h-32 w-full object-cover rounded-md"}),_e.jsx("button",{type:"button",onClick:()=>mt(ot),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:_e.jsx(z1,{className:"h-5 w-5"})})]},ot))})]})]})})}),_e.jsx(Z1,{className:"flex justify-between p-6 border-t",children:_e.jsxs("div",{className:"flex w-full justify-between",children:[_e.jsxs(lc,{type:"button",variant:"outline",onClick:()=>v(`/campgrounds/${m}`),className:"text-lg px-6 py-5 flex items-center",children:[_e.jsx(e1,{className:"mr-2 h-5 w-5"})," Back"]}),_e.jsx(lc,{type:"submit",disabled:ze,onClick:He.handleSubmit(kt),className:"text-lg px-8 py-5",children:ze?_e.jsxs(_e.Fragment,{children:[_e.jsx(D1,{className:"mr-2 h-5 w-5 animate-spin"}),"Updating..."]}):"Update Campground"})]})})]})})]})}function bO(){return _e.jsx(GR,{children:_e.jsxs($C,{basename:"/githubs_pages",children:[_e.jsx(VR,{position:"top-right",autoClose:3e3}),_e.jsxs(SC,{children:[_e.jsx(sh,{index:!0,path:"/",element:_e.jsx(nR,{})}),_e.jsxs(sh,{path:"/",element:_e.jsx(s3,{}),children:[_e.jsx(sh,{path:"/campgrounds",element:_e.jsx(iR,{})}),_e.jsx(sh,{path:"/campgrounds/new",element:_e.jsx(pO,{})}),_e.jsx(sh,{path:"/campgrounds/:id",element:_e.jsx(yO,{})}),_e.jsx(sh,{path:"/campgrounds/:id/edit",element:_e.jsx(xO,{})}),_e.jsx(sh,{path:"/login",element:_e.jsx(UR,{})}),_e.jsx(sh,{path:"/register",element:_e.jsx(jR,{})})]}),_e.jsx(sh,{path:"*",element:_e.jsx(bC,{to:"/",replace:!0})})]})]})})}RM.createRoot(document.getElementById("root")).render(_e.jsx(Ie.StrictMode,{children:_e.jsx(bO,{})}));
